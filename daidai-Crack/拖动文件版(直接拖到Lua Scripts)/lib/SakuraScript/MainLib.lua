PanNvbiA9IHJlcXVpcmUgImxpYi5TYWt1cmFTY3JpcHQubWFpbi5qc29uLmpzb24iCgotLS0tLS0tLS0tCi0tc2hhcmUgZnVuY3Rpb24KLS0tLS0tLS0tLQoKLS0tLemUmeivr+iusOW9lQpmdW5jdGlvbiBMT0cobWVzc2FnZSkKICAgIGxvY2FsIGRpciA9IGZpbGVzeXN0ZW0uc3RhbmRfZGlyKCkgLi4gIlNha3VyYS5sb2ciCiAgICBsb2NhbCBmaWxlID0gaW8ub3BlbihkaXIsICJhKyIpCiAgICBmaWxlOndyaXRlKG9zLmRhdGUoIlxuWyVZLSVtLSVkICVIOiVNOiVTXSIpIC4uICIgIiAuLiBtZXNzYWdlKQogICAgZmlsZTpjbG9zZSgpCmVuZApmdW5jdGlvbiBFUlJPUl9MT0coZXJyb3JfbWVzc2FnZSkKICAgIExPRygiW0VSUk9SXSAiIC4uIGVycm9yX21lc3NhZ2UpCiAgICB1dGlsLnRvYXN0KCJbRVJST1JdICIgLi4gIlxuIiAuLiBlcnJvcl9tZXNzYWdlKQogICAgdXRpbC5zdG9wX3NjcmlwdCgpCmVuZAoKLS0tLeaSreaUvumfs+mikQotLeadpeiHqmh0dHBzOi8vZ2l0aHViLmNvbS9jYWxhbWl0eS1pbmMvU291cC1MdWEtQmluZGluZ3MvYmxvYi9tYWluL0xVQV9BUEkubWQKLS3kvLzkuY7mraPluLjml6Dms5XlgZzmraIKZnVuY3Rpb24gUGxheVNvdW5kKGRpciktLWRpci3mjIflkJHnu53lr7nmlofku7YobG9jYWwgZGlyID0gZmlsZXN5c3RlbS5zY3JpcHRzX2RpcigpIC4uICdcXGRhaWRhaVNjcmlwdFxcYXVkaW9cXHBheXBob25lLndhdicpCiAgICBsb2NhbCBmciA9IHNvdXAuRmlsZVJlYWRlcihkaXIpCiAgICBsb2NhbCB3YXYgPSBzb3VwLmF1ZFdhdihmcikKICAgIGxvY2FsIGRldiA9IHNvdXAuYXVkRGV2aWNlLmdldERlZmF1bHQoKS0t6YCJ5oup6buY6K6k6Z+z6aKR6amx5YqoCiAgICBsb2NhbCBkZXZuYW1lID0gZGV2OmdldE5hbWUoKS0t6I635Y+W5pKt5pS+6amx5Yqo5ZCNCiAgICBsb2NhbCBwYiA9IGRldjpvcGVuKHdhdi5jaGFubmVscykKICAgIGxvY2FsIG1peCA9IHNvdXAuYXVkTWl4ZXIoKQoKICAgIG1peC5zdG9wX3BsYXliYWNrX3doZW5fZG9uZSA9IHRydWUKICAgIG1peDpzZXRPdXRwdXQocGIpCiAgICBtaXg6cGxheVNvdW5kKHdhdikKCiAgICB3aGlsZSBwYjppc1BsYXlpbmcoKSBkbyAKICAgICAgICAtLeaOp+WItuaSreaUvuaXtumXtAogICAgICAgICAgICB1dGlsLnlpZWxkKDEwKSAKICAgICAgICAgICAgLS1yZXR1cm4KICAgIGVuZAplbmQKCi0tLS3mnaHku7bnrYnlvoUKZnVuY3Rpb24gY29uZGl0aW9uX3dhaXQoY29uZGl0aW9uLCB0aW1lcikKICAgIGxvY2FsIGVuZF90aW1lID0gb3MudGltZSgpICsgKHRpbWVyIG9yIDApCiAgICB3aGlsZSBjb25kaXRpb24gYW5kIGVuZF90aW1lID4gb3MudGltZSgpIGRvCiAgICAgICAgdXRpbC55aWVsZCgpCiAgICBlbmQKZW5kCgotLS0t6YCa55+lCi0t6K+35rGC57q555CGKOacqueUqCkKZnVuY3Rpb24gcmVxdWVzdF9zdHJlYW1lZF90ZXh0dXJlX2RpY3QodGV4dHVyZURpY3QsIHRpbWVvdXQpCiAgICBsb2NhbCBlbmRfdGltZSA9IG9zLnRpbWUoKSArICh0aW1lb3V0IG9yIDEpCiAgICBHUkFQSElDUy5SRVFVRVNUX1NUUkVBTUVEX1RFWFRVUkVfRElDVCh0ZXh0dXJlRGljdCwgZmFsc2UpCiAgICB3aGlsZSBub3QgR1JBUEhJQ1MuSEFTX1NUUkVBTUVEX1RFWFRVUkVfRElDVF9MT0FERUQodGV4dHVyZURpY3QpIGFuZCBlbmRfdGltZSA+IG9zLnRpbWUoKSBkbwogICAgICAgIEdSQVBISUNTLlJFUVVFU1RfU1RSRUFNRURfVEVYVFVSRV9ESUNUKHRleHR1cmVEaWN0LCBmYWxzZSkKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAplbmQKZnVuY3Rpb24gbm90aWZpY2F0aW9uKGZvcm1hdCwgY29sb3VyLCB0aXRsZSkKICAgIGxvY2FsIHRpdGxlZCA9IHRpdGxlIG9yICLpgJrnn6UiCglsb2NhbCBtc2cgPSBzdHJpbmcuZm9ybWF0KGZvcm1hdCkKCUhVRC5USEVGRUVEX1NFVF9CQUNLR1JPVU5EX0NPTE9SX0ZPUl9ORVhUX1BPU1QoY29sb3VyIG9yIEh1ZENvbG91ci5ibHVlKQogICAgSFVELkJFR0lOX1RFWFRfQ09NTUFORF9USEVGRUVEX1BPU1QoIlNUUklORyIpCglIVUQuQUREX1RFWFRfQ09NUE9ORU5UX1NVQlNUUklOR19QTEFZRVJfTkFNRShtc2cpCglIVUQuRU5EX1RFWFRfQ09NTUFORF9USEVGRUVEX1BPU1RfTUVTU0FHRVRFWFQoIkNIQVJfU09DSUFMX0NMVUIiLCAiQ0hBUl9TT0NJQUxfQ0xVQiIsIHRydWUsIDQsICJTYWt1cmEiLCAifmJ+Ii4udGl0bGVkKSAtLSB5b3V0dWJlICJDSEFSX1lPVVRVQkUiICBodHRwczovL3Bhc3RlYmluLmNvbS9YZHBKVmJIegoJSFVELkVORF9URVhUX0NPTU1BTkRfVEhFRkVFRF9QT1NUX1RJQ0tFUihmYWxzZSwgZmFsc2UpCmVuZApmdW5jdGlvbiBub3RpZnkoZm9ybWF0LCBjb2xvdXIpCiAgICBIVUQuVEhFRkVFRF9TRVRfQkFDS0dST1VORF9DT0xPUl9GT1JfTkVYVF9QT1NUKGNvbG91ciBvciBIdWRDb2xvdXIuYmx1ZSkKICAgIEhVRC5CRUdJTl9URVhUX0NPTU1BTkRfVEhFRkVFRF9QT1NUKCJDRUxMX0VNQUlMX0JDT04iKSAtLeWMheWQq+aMiemSru+8jOm7mOiupOS4uuKAnFNUUklOR+KAnQogICAgbG9jYWwgbGVuZ3RoID0gI2Zvcm1hdAogICAgbG9jYWwgbWF4U3RyaW5nTGVuZ3RoID0gNDAgICAtLTHkuKpTdHJpbmdMZW5ndGggPSAxMOWtl+espigx5rGJ5a2XPTPlrZfnrKYpICAgIDHooYwyM+S4quWtl+espgogICAgZm9yIGkgPSAxLCBsZW5ndGgsIG1heFN0cmluZ0xlbmd0aCBkbwogICAgICAgIGxvY2FsIHN1YnN0cmluZyA9IGZvcm1hdDpzdWIoaSwgbWF0aC5taW4oaSArIG1heFN0cmluZ0xlbmd0aCAtIDEsIGxlbmd0aCkpCiAgICAgICAgSFVELkFERF9URVhUX0NPTVBPTkVOVF9TVUJTVFJJTkdfUExBWUVSX05BTUUoc3Vic3RyaW5nKQogICAgZW5kCiAgICBIVUQuRU5EX1RFWFRfQ09NTUFORF9USEVGRUVEX1BPU1RfVElDS0VSKGZhbHNlLCBmYWxzZSkKZW5kCi0t5pi+56S65biu5Yqp5paH5pysCmZ1bmN0aW9uIHNob3dfaGVscF90ZXh0KHN0cikKICAgIEhVRC5CRUdJTl9URVhUX0NPTU1BTkRfRElTUExBWV9IRUxQKCJDRUxMX0VNQUlMX0JDT04iKSAtLeWMheWQq+aMiemSru+8jOm7mOiupOS4uuKAnFNUUklOR+KAnQogICAgSFVELkFERF9URVhUX0NPTVBPTkVOVF9TVUJTVFJJTkdfUExBWUVSX05BTUUoc3RyKQogICAgSFVELkVORF9URVhUX0NPTU1BTkRfRElTUExBWV9IRUxQKDAsIGZhbHNlLCBmYWxzZSwgLTEpCmVuZAotLeaYvuekuuagh+mimApmdW5jdGlvbiBzaG93X3N1YnRpdGxlKHN0ciwgZHVyYXRpb24pCiAgICBIVUQuQkVHSU5fVEVYVF9DT01NQU5EX1BSSU5UKCJDRUxMX0VNQUlMX0JDT04iKQogICAgSFVELkFERF9URVhUX0NPTVBPTkVOVF9TVUJTVFJJTkdfUExBWUVSX05BTUUoImR3YWR3IikKICAgIEhVRC5FTkRfVEVYVF9DT01NQU5EX1BSSU5UKGR1cmF0aW9uLCAxKQplbmQKLS0tLee7mOWItuaWh+WtlwpmdW5jdGlvbiBkcmF3X3N0cmluZyhzdHIsIHgsIHksIHNjYWxlLCBmb250KS0tZm9udD005peg5rOV5pi+56S65Lit5paHLOezu+e7n+iLseivreWPr+aYvuekuuaWnOS9k+S6keWtl+S9kwoJSFVELlNFVF9URVhUX0ZPTlQoZm9udCBvciAxKQoJSFVELlNFVF9URVhUX1NDQUxFKHNjYWxlLCBzY2FsZSkKCUhVRC5TRVRfVEVYVF9EUk9QX1NIQURPVygpCglIVUQuU0VUX1RFWFRfV1JBUCgwLjAsIDEuMCkKCUhVRC5TRVRfVEVYVF9EUk9QU0hBRE9XKDEsIDAsIDAsIDAsIDApCglIVUQuU0VUX1RFWFRfT1VUTElORSgpCglIVUQuU0VUX1RFWFRfRURHRSgxLCAwLCAwLCAwLCAwKQogICAgSFVELkJFR0lOX1RFWFRfQ09NTUFORF9ESVNQTEFZX1RFWFQoIlNUUklORyIpCglIVUQuQUREX1RFWFRfQ09NUE9ORU5UX1NVQlNUUklOR19QTEFZRVJfTkFNRShzdHIpCglIVUQuRU5EX1RFWFRfQ09NTUFORF9ESVNQTEFZX1RFWFQoeCwgeSwgMCkKICAgIC0tSFVELlNFVF9URVhUX0NPTE9VUigyNTUsIDAsIDI1NSwgMjU1KQplbmQKLS0tLeiOt+WPluagh+etvuaWh+acrApmdW5jdGlvbiBnZXRfbGFiZWxfdGV4dChsYWJlbE5hbWUpCiAgICByZXR1cm4gSFVELkdFVF9GSUxFTkFNRV9GT1JfQVVESU9fQ09OVkVSU0FUSU9OKGxhYmVsTmFtZSkKZW5kCgoKLS0tLeiuoeaXtuWZqApmdW5jdGlvbiBuZXdUaW1lcigpCglsb2NhbCBzZWxmID0ge3N0YXJ0ID0gdXRpbC5jdXJyZW50X3RpbWVfbWlsbGlzKCl9Cglsb2NhbCBmdW5jdGlvbiByZXNldCgpCgkJc2VsZi5zdGFydCA9IHV0aWwuY3VycmVudF90aW1lX21pbGxpcygpIC0t6I635Y+WbXPnuqfml7bpl7QKCWVuZAoJbG9jYWwgZnVuY3Rpb24gZWxhcHNlZCgpCgkJcmV0dXJuIHV0aWwuY3VycmVudF90aW1lX21pbGxpcygpIC0gc2VsZi5zdGFydAoJZW5kCglyZXR1cm4KCXsKCQlyZXNldCA9IHJlc2V0LAoJCWVsYXBzZWQgPSBlbGFwc2VkCgl9CmVuZDt0aW1lciA9IG5ld1RpbWVyKCkKLS0tLeWjsOmfs2NyZWF0ZQpmdW5jdGlvbiBTb3VuZF9uZXcobmFtZSwgcmVmZXJlbmNlKS0tLS3ljp/lh73mlbDlkI1Tb3VuZC5uZXcKICAgIGxvY2FsIGluc3QgPSBzZXRtZXRhdGFibGUoe30sIFNvdW5kKQogICAgaW5zdC5uYW1lID0gbmFtZQogICAgaW5zdC5yZWZlcmVuY2UgPSByZWZlcmVuY2UKICAgIHJldHVybiBpbnN0CmVuZApmdW5jdGlvbiBuZXdfY29sb3VyKFIsIEcsIEIsIEEpCiAgICByZXR1cm4ge3IgPSBSIC8gMjU1LCBnID0gRyAvIDI1NSwgYiA9IEIgLyAyNTUsIGEgPSBBfQplbmQKCi0tLS3liJvlu7rmlYjmnpwKRWZmZWN0ID0ge2Fzc2V0ID0gIiIsIG5hbWUgPSAiIiwgc2NhbGUgPSAxLjB9CkVmZmVjdC5fX2luZGV4ID0gRWZmZWN0CmZ1bmN0aW9uIEVmZmVjdC5uZXcoYXNzZXQsIG5hbWUsIHNjYWxlKQoJbG9jYWwgaW5zdCA9IHNldG1ldGF0YWJsZSh7fSwgRWZmZWN0KQoJaW5zdC5uYW1lID0gbmFtZQoJaW5zdC5hc3NldCA9IGFzc2V0CglpbnN0LnNjYWxlID0gc2NhbGUKCXJldHVybiBpbnN0CmVuZAoKCgoKCi0t6K+35rGC5qih5Z6LCmZ1bmN0aW9uIHJlcXVlc3RfbW9kZWwoaGFzaCwgdGltZW91dCkKICAgIGxvY2FsIGVuZF90aW1lID0gb3MudGltZSgpICsgKHRpbWVvdXQgb3IgMykKICAgIFNUUkVBTUlORy5SRVFVRVNUX01PREVMKGhhc2gpCiAgICB3aGlsZSBub3QgU1RSRUFNSU5HLkhBU19NT0RFTF9MT0FERUQoaGFzaCkgYW5kIGVuZF90aW1lID4gb3MudGltZSgpIGRvCiAgICAgICAgU1RSRUFNSU5HLlJFUVVFU1RfTU9ERUwoaGFzaCkKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAogICAgcmV0dXJuIFNUUkVBTUlORy5IQVNfTU9ERUxfTE9BREVEKGhhc2gpCmVuZApmdW5jdGlvbiByZXF1ZXN0X21vZGVscyguLi4pLS3mqKHlnovooagKCWxvY2FsIGFyZyA9IHsuLi59Cglmb3IgXywgbW9kZWwgaW4gaXBhaXJzKGFyZykgZG8KICAgICAgICBsb2NhbCBlbmRfdGltZSA9IG9zLnRpbWUoKSArIDMKICAgICAgICBTVFJFQU1JTkcuUkVRVUVTVF9NT0RFTChtb2RlbCkKCQl3aGlsZSBub3QgU1RSRUFNSU5HLkhBU19NT0RFTF9MT0FERUQobW9kZWwpIGFuZCBlbmRfdGltZSA+IG9zLnRpbWUoKSBkbwogICAgICAgICAgICBTVFJFQU1JTkcuUkVRVUVTVF9NT0RFTChtb2RlbCkKCQkJdXRpbC55aWVsZCgpCgkJZW5kCgllbmQKZW5kCi0tLS3or7fmsYLmlYjmnpwKZnVuY3Rpb24gcmVxdWVzdF9wdGZ4X2Fzc2V0KGFzc2V0LCB0aW1lb3V0KQogICAgbG9jYWwgZW5kX3RpbWUgPSBvcy50aW1lKCkgKyAodGltZW91dCBvciAzKQogICAgU1RSRUFNSU5HLlJFUVVFU1RfTkFNRURfUFRGWF9BU1NFVChhc3NldCkKICAgIHdoaWxlIG5vdCBTVFJFQU1JTkcuSEFTX05BTUVEX1BURlhfQVNTRVRfTE9BREVEKGFzc2V0KSBhbmQgZW5kX3RpbWUgPiBvcy50aW1lKCkgZG8KCQlTVFJFQU1JTkcuUkVRVUVTVF9OQU1FRF9QVEZYX0FTU0VUKGFzc2V0KQoJCXV0aWwueWllbGQoKQoJZW5kCiAgICBHUkFQSElDUy5VU0VfUEFSVElDTEVfRlhfQVNTRVQoYXNzZXQpCmVuZAotLeenu+mZpOaViOaenApmdW5jdGlvbiByZW1vdmVfcGFydGljbGVfZngocHRmeHMpCiAgICBpZiB0eXBlKHB0ZnhzKSA9PSAidGFibGUiIHRoZW4KICAgICAgICBmb3IgaywgcHRmeCBpbiBwYWlycyhwdGZ4cykgZG8KICAgICAgICAgICAgaWYgR1JBUEhJQ1MuRE9FU19QQVJUSUNMRV9GWF9MT09QRURfRVhJU1QocHRmeCkgdGhlbiAtLWxvb3DnspLlrZAKICAgICAgICAgICAgICAgIEdSQVBISUNTLlJFTU9WRV9QQVJUSUNMRV9GWChwdGZ4KQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogICAgaWYgR1JBUEhJQ1MuRE9FU19QQVJUSUNMRV9GWF9MT09QRURfRVhJU1QocHRmeHMpIHRoZW4KICAgICAgICBHUkFQSElDUy5SRU1PVkVfUEFSVElDTEVfRlgocHRmeHMpCiAgICBlbmQKZW5kCi0t6K+35rGC5o6n5Yi2CmZ1bmN0aW9uIHJlcXVlc3RfY29udHJvbChlbnRpdHksIHRpbWVvdXQpCiAgICBsb2NhbCBlbmRfdGltZSA9IG9zLnRpbWUoKSArICh0aW1lb3V0IG9yIDEpCiAgICBORVRXT1JLLk5FVFdPUktfUkVRVUVTVF9DT05UUk9MX09GX0VOVElUWShlbnRpdHkpCiAgICB3aGlsZSBub3QgTkVUV09SSy5ORVRXT1JLX0hBU19DT05UUk9MX09GX0VOVElUWShlbnRpdHkpIGFuZCBlbmRfdGltZSA+IG9zLnRpbWUoKSBkbwogICAgICAgIGxvY2FsIG5ldGlkID0gTkVUV09SSy5ORVRXT1JLX0dFVF9ORVRXT1JLX0lEX0ZST01fRU5USVRZKGVudGl0eSkKICAgICAgICBORVRXT1JLLlNFVF9ORVRXT1JLX0lEX0NBTl9NSUdSQVRFKG5ldGlkLCB0cnVlKQogICAgICAgIE5FVFdPUksuTkVUV09SS19SRVFVRVNUX0NPTlRST0xfT0ZfRU5USVRZKGVudGl0eSkKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAogICAgcmV0dXJuIE5FVFdPUksuTkVUV09SS19IQVNfQ09OVFJPTF9PRl9FTlRJVFkoZW50aXR5KQplbmQKLS3or7fmsYLliqjkvZzmiafooYwKZnVuY3Rpb24gcmVxdWVzdF9hbmltX2RpY3QoYW5pbURpY3QsIHRpbWVvdXQpLS3ooajmvJTliqjkvZwKICAgIGxvY2FsIGVuZF90aW1lID0gb3MudGltZSgpICsgKHRpbWVvdXQgb3IgMykKICAgIFNUUkVBTUlORy5SRVFVRVNUX0FOSU1fRElDVChhbmltRGljdCkKICAgIHdoaWxlIG5vdCBTVFJFQU1JTkcuSEFTX0FOSU1fRElDVF9MT0FERUQoYW5pbURpY3QpIGFuZCBlbmRfdGltZSA+IG9zLnRpbWUoKSBkbwogICAgICAgIFNUUkVBTUlORy5SRVFVRVNUX0FOSU1fRElDVChhbmltRGljdCkKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAplbmQKLS3miafooYzliqjkvZwKZnVuY3Rpb24gcGxheV9hbmltYXRpb24ocGVkLCBhbmltRGljdCwgYW5pbU5hbWUsIGJsZW5kSW5TcGVlZCwgYmxlbmRPdXRTcGVlZCwgZHVyYXRpb24sIGZsYWcsIHBsYXliYWNrUmF0ZSkKICAgIHJlcXVlc3RfYW5pbV9kaWN0KGFuaW1EaWN0KQogICAgVEFTSy5UQVNLX1BMQVlfQU5JTShwZWQsIGFuaW1EaWN0LCBhbmltTmFtZSwgYmxlbmRJblNwZWVkLCBibGVuZE91dFNwZWVkLCBkdXJhdGlvbiwgZmxhZywgcGxheWJhY2tSYXRlIG9yIDAuMCwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKZW5kCi0t6K+35rGC5Yqo5L2c6K6+572uCmZ1bmN0aW9uIHJlcXVlc3RfYW5pbV9zZXQoZGljdCwgdGltZW91dCktLeenu+WKqOaWueW8jwogICAgbG9jYWwgZW5kX3RpbWUgPSBvcy50aW1lKCkgKyAodGltZW91dCBvciAzKQogICAgU1RSRUFNSU5HLlJFUVVFU1RfQU5JTV9TRVQoZGljdCkKICAgIHdoaWxlIG5vdCBTVFJFQU1JTkcuSEFTX0FOSU1fU0VUX0xPQURFRChkaWN0KSBhbmQgZW5kX3RpbWUgPiBvcy50aW1lKCkgZG8KICAgICAgICBTVFJFQU1JTkcuUkVRVUVTVF9BTklNX1NFVChkaWN0KQogICAgICAgIHV0aWwueWllbGQoKQogICAgZW5kCmVuZAotLeivt+axguatpuWZqOaViOaenApmdW5jdGlvbiByZXF1ZXN0X3dlYXBvbl9hc3NldChoYXNoLCB0aW1lb3V0KQogICAgbG9jYWwgZW5kX3RpbWUgPSBvcy50aW1lKCkgKyAodGltZW91dCBvciAzKQogICAgV0VBUE9OLlJFUVVFU1RfV0VBUE9OX0FTU0VUKGhhc2gsIDMxLCAwKQoJd2hpbGUgbm90IFdFQVBPTi5IQVNfV0VBUE9OX0FTU0VUX0xPQURFRChoYXNoKSBhbmQgZW5kX3RpbWUgPiBvcy50aW1lKCkgZG8KICAgICAgICBXRUFQT04uUkVRVUVTVF9XRUFQT05fQVNTRVQoaGFzaCwgMzEsIDApCiAgICAgICAgdXRpbC55aWVsZCgpIAogICAgZW5kCmVuZAotLS0t6K+35rGCSVBMCmZ1bmN0aW9uIHJlcXVlc3RfaXBsKG5hbWUsIHRpbWVvdXQpCiAgICBsb2NhbCBlbmRfdGltZSA9IG9zLnRpbWUoKSArICh0aW1lb3V0IG9yIDMpCiAgICBTVFJFQU1JTkcuUkVRVUVTVF9JUEwobmFtZSkKICAgIHdoaWxlIG5vdCBTVFJFQU1JTkcuSVNfSVBMX0FDVElWRShuYW1lKSBhbmQgZW5kX3RpbWUgPiBvcy50aW1lKCkgZG8KICAgICAgICBTVFJFQU1JTkcuUkVRVUVTVF9JUEwobmFtZSkKICAgICAgICB1dGlsLnlpZWxkKCkgCiAgICBlbmQKZW5kCi0tLS3np7vpmaRJUEwKZnVuY3Rpb24gcmVtb3ZlX2lwbChuYW1lKQogICAgaWYgU1RSRUFNSU5HLklTX0lQTF9BQ1RJVkUobmFtZSkgdGhlbgogICAgICAgIFNUUkVBTUlORy5SRU1PVkVfSVBMKG5hbWUpCiAgICBlbmQKZW5kCgotLS0t5Yib5bu6UEVECmZ1bmN0aW9uIGNyZWF0ZV9wZWQocGVkdHlwZSwgaGFzaCwgeCwgeSwgeiwgaGVhZCkKICAgIHJlcXVlc3RfbW9kZWwoaGFzaCkKICAgIGxvY2FsIHBlZCA9ICBQRUQuQ1JFQVRFX1BFRChwZWR0eXBlLCBoYXNoLCAwLCAwLCAwLCBoZWFkLCB0cnVlLCBmYWxzZSkKICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEUyhwZWQsIHgsIHksIHosIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgcmV0dXJuIHBlZAplbmQKLS0tLeWIm+W7uui9veWFtwpmdW5jdGlvbiBjcmVhdGVfdmVoaWNsZShoYXNoLCB4LCB5LCB6LCBoZWFkKQogICAgcmVxdWVzdF9tb2RlbChoYXNoKQogICAgbG9jYWwgdmVoID0gIFZFSElDTEUuQ1JFQVRFX1ZFSElDTEUoaGFzaCwgMCwgMCwgMCwgaGVhZCwgdHJ1ZSwgdHJ1ZSwgZmFsc2UpCiAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFModmVoLCB4LCB5LCB6LCBmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfTU9EX0tJVCh2ZWgsIDApIC0t6K6+572u5ZCO5omN6IO95pu05pS56L295YW35aWX5Lu2CiAgICByZXR1cm4gdmVoCmVuZAotLS0t5Yib5bu654mp5L2TCmZ1bmN0aW9uIGNyZWF0ZV9vYmplY3QoaGFzaCwgeCwgeSwgeikKICAgIHJlcXVlc3RfbW9kZWwoaGFzaCkKICAgIGxvY2FsIG9iaiA9ICBPQkpFQ1QuQ1JFQVRFX09CSkVDVChoYXNoLCAwLCAwLCAwLCB0cnVlLCBmYWxzZSwgdHJ1ZSkKICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEUyhvYmosIHgsIHksIHosIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgcmV0dXJuIG9iagplbmQKLS0tLeWIm+W7uuaLvuWPlueJqQpmdW5jdGlvbiBjcmVhdGVfYW1iaWVudF9waWNrdXAoeCwgeSwgeiwgaGFzaCwgbW9kZWxoYXNoKQogICAgcmVxdWVzdF9tb2RlbChtb2RlbGhhc2gpCiAgICBPQkpFQ1QuQ1JFQVRFX0FNQklFTlRfUElDS1VQKGhhc2gsIHgsIHksIHosIDAsIDEsIG1vZGVsaGFzaCwgZmFsc2UsIHRydWUpCmVuZAotLS0t5Yig6Zmk5a6e5L2TCmZ1bmN0aW9uIGRlbGV0ZV9lbnRpdHkoLi4uKQogICAgbG9jYWwgZW50cyA9IHsuLi59Cglmb3IgXywgZW50IGluIGlwYWlycyhlbnRzKSBkbwogICAgICAgIGlmIEVOVElUWS5ET0VTX0VOVElUWV9FWElTVChlbnQpIHRoZW4KICAgICAgICAgICAgTkVUV09SSy5ORVRXT1JLX1JFUVVFU1RfQ09OVFJPTF9PRl9FTlRJVFkoZW50KQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9BU19NSVNTSU9OX0VOVElUWShlbnQsIHRydWUsIHRydWUpLS3orr7nva7kuLrku7vliqHlrp7kvZPljbPlj6/mraPluLjliKDpmaQKICAgICAgICAgICAgZW50aXRpZXMuZGVsZXRlKGVudCkKICAgICAgICBlbmQKCWVuZAplbmQKCi0tLS3mlofku7blhpnlhaUKZnVuY3Rpb24gZmlsZXdyaXRlKGZpbGVwYXRoLCBtZXRob2QsIGNvbnRlbnQpCiAgICBsb2NhbCBmaWxlID0gaW8ub3BlbihmaWxlcGF0aCwgbWV0aG9kKS0tIncrIuaWh+S7tuS4jeWtmOWcqOWNs+WIm+W7ugogICAgZmlsZTp3cml0ZShjb250ZW50KQogICAgZmlsZTpjbG9zZSgpCmVuZAotLS0t6K+75Y+W5paH5Lu2CmZ1bmN0aW9uIGZpbGVyZWFkKGZpbGVwYXRoLCBtZXRob2QsIHJ0eXBlKQogICAgaWYgZmlsZXN5c3RlbS5leGlzdHMoZmlsZXBhdGgpIHRoZW4KICAgICAgICBsb2NhbCBmaWxlID0gaW8ub3BlbihmaWxlcGF0aCwgbWV0aG9kKQogICAgICAgIGxvY2FsIGRhdGEgPSBmaWxlOnJlYWQocnR5cGUpLS0nKmFsbCfku47lvZPliY3kvY3nva7or7vlj5bmlbTkuKrmlofku7YKICAgICAgICBmaWxlOmNsb3NlKCkKICAgICAgICByZXR1cm4gZGF0YQogICAgZW5kCmVuZAotLS0t6K+75Y+W5paH5Lu25L+h5oGvCmZ1bmN0aW9uIHJlYWRfZmlsZWluZm8ocGF0aCktLeaMh+WvvOivtOaYjmh0dHBzOi8vYmxvZy5jc2RuLm5ldC9sYW5nZWxkZXAvYXJ0aWNsZS9kZXRhaWxzLzg0NTU3ODMKICAgIGxvY2FsIGluZm8gPSB7fQogICAgICAgIGluZm8uZnVsbG5hbWUgPSBzdHJpbmcubWF0Y2gocGF0aCwgIi4rXFwoW15cXF0qJS4ldyspJCIpLS3lhajlkI0KICAgICAgICBpbmZvLmV4dCA9IHBhdGg6bWF0Y2goIi4rJS4oJXcrKSQiKS0t5omp5bGV5ZCNCiAgICAgICAgaW5mby5uYW1lID0gcGF0aDpzdWIocGF0aDpyZmluZCgiXFwiKSsxLCBwYXRoOm1hdGNoKCIuKygpJS4ldyskIikgLSAxKS0t5LuF5paH5Lu25ZCNCiAgICAgICAgLS1sb2NhbCBmaWxlZGlyLCBmdWxsbmFtZSwgZXh0ID0gc3RyaW5nLm1hdGNoKHBhdGgsICIoLi0pKFteXFwvXS0lLj8oW14lLlxcL10qKSkkIiktLWZpbGVkaXIgPSDot6/lvoQsIG5hbWUgPSDmlofku7blkI0o5YyF5ZCr5omp5bGV5ZCNKSwgZXh0ID0g5LuF5omp5bGV5ZCNCiAgICByZXR1cm4gaW5mbwplbmQKLS0tLeivu+WPlnR4dOaWh+S7tgpmdW5jdGlvbiByZWFkX3R4dGZpbGUoZGlyKQogICAgbG9jYWwgdGV4dCA9IHt9CiAgICBpZiBmaWxlc3lzdGVtLmV4aXN0cyhkaXIpIHRoZW4KICAgICAgICBsb2NhbCBvcGVuID0gaW8ub3BlbihkaXIsICJyIikKICAgICAgICBmb3IgbGluZSBpbiBvcGVuOmxpbmVzKCkgZG8KICAgICAgICAgICAgaWYgbm90IHN0cmluZy5jb250YWlucyhsaW5lLCAiIyIpIGFuZCBsaW5lIH49ICIiIHRoZW4gLS0iIyLpu5jorqTkuLp0eHTmlofmnKzms6jph4rnrKblj7cKICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydCh0ZXh0LCBsaW5lKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICBvcGVuOmNsb3NlKCkKICAgIGVsc2UKICAgICAgICBFUlJPUl9MT0coInVuYWJsZSB0byBmaW5kIHRhcmdldCBmaWxlIikKICAgIGVuZAogICAgcmV0dXJuIHRleHQKZW5kCi0tLS3liqDovb1MdWHku6PnoIEKZnVuY3Rpb24gbG9hZF9jb2RlKGNvZGUpCiAgICAtLSDliqDovb3lubbmiafooYzor7vlj5bnmoTku6PnoIEKICAgIGxvY2FsIGNodW5rLCBlcnIgPSBsb2FkKGNvZGUpCiAgICBpZiBjaHVuayB0aGVuCiAgICAgICAgY2h1bmsoKSAtLSDmiafooYzliqDovb3nmoTku6PnoIEKICAgIGVuZAplbmQKCgotLS0t5pu05pS55qih5Z6LCmZ1bmN0aW9uIGNoYW5nZV9tb2RlbChwbGF5ZXIsIGhhc2gpCglyZXF1ZXN0X21vZGVsKGhhc2gpCiAgICBpZiBTVFJFQU1JTkcuSEFTX01PREVMX0xPQURFRChoYXNoKSB0aGVuCiAgICAgICAgUExBWUVSLlNFVF9QTEFZRVJfTU9ERUwocGxheWVyLCBoYXNoKQogICAgICAgIFBFRC5TRVRfUEVEX0RFRkFVTFRfQ09NUE9ORU5UX1ZBUklBVElPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgIFBFRC5DTEVBUl9BTExfUEVEX1BST1BTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICAgICAgU1RSRUFNSU5HLlNFVF9NT0RFTF9BU19OT19MT05HRVJfTkVFREVEKGhhc2gpCiAgICAgICAgLS1bWyBnaXZlX2FsbF93ZWFwb24ocGxheWVyKSBdXQogICAgZW5kCmVuZAoKLS0tLeS4quS6uuS8oOmAgQpmdW5jdGlvbiB0ZWxlcG9ydCh4LCB5LCB6LCBrZWVwX3ZlaCkKICAgIGlmIHggPT0gMCBhbmQgeSA9PSAwIGFuZCB6ID09IDAgdGhlbgogICAgICAgIHV0aWwudG9hc3QoIuaJvuS4jeWIsOWdkOaghyIpCiAgICBlbHNlCiAgICAgICAgaWYga2VlcF92ZWggdGhlbgogICAgICAgICAgICBQRUQuU0VUX1BFRF9DT09SRFNfS0VFUF9WRUhJQ0xFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHgsIHksIHopCiAgICAgICAgZWxzZQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgeCwgeSwgeiwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgotLS0t6am+6am26L295YW3CmZ1bmN0aW9uIGRyaXZlX3ZlaGljbGUodmVoaWNsZSkKICAgIGlmIEVOVElUWS5JU19FTlRJVFlfQV9WRUhJQ0xFKHZlaGljbGUpIHRoZW4KICAgICAgICBsb2NhbCBkcml2ZXIgPSBWRUhJQ0xFLkdFVF9QRURfSU5fVkVISUNMRV9TRUFUKHZlaGljbGUsIC0xKQogICAgICAgIGlmIEVOVElUWS5ET0VTX0VOVElUWV9FWElTVChkcml2ZXIpIGFuZCBub3QgUEVELklTX1BFRF9BX1BMQVlFUihkcml2ZXIpIHRoZW4KICAgICAgICAgICAgZGVsZXRlX2VudGl0eShkcml2ZXIpCiAgICAgICAgZW5kCiAgICAgICAgUEVELlNFVF9QRURfSU5UT19WRUhJQ0xFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHZlaGljbGUsIC0xKQogICAgZW5kCmVuZAoKCi0tLS3lhbbku5bnva7pobYKCi0t6K6+572u5a6e5L2T5a6M5YWo5Y+v6KeBCmZ1bmN0aW9uIHNldF9lbnRpdHlfZnVsbF92aXNpYmxlKGVudGl0eSwgdG9nZ2xlZCkKICAgIGlmIHRvZ2dsZWQgdGhlbgogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0FMUEhBKGVudGl0eSwgMjU1LCBmYWxzZSkKICAgIGVsc2UKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9BTFBIQShlbnRpdHksIDAsIGZhbHNlKQogICAgZW5kCiAgICBFTlRJVFkuU0VUX0VOVElUWV9WSVNJQkxFKGVudGl0eSwgdG9nZ2xlZCwgZmFsc2UpCmVuZAoKLS3lhrfpnZko6Z2Z5q2iKVBFRApmdW5jdGlvbiBjYWxtX3BlZChwZWQsIHRvZ2dsZSkKICAgIGlmIEVOVElUWS5JU19FTlRJVFlfQV9QRUQocGVkKSA9PSAwIHRoZW4gcmV0dXJuIGVuZAogICAgTkVUV09SSy5ORVRXT1JLX1JFUVVFU1RfQ09OVFJPTF9PRl9FTlRJVFkocGVkKQogICAgUEVELlNFVF9CTE9DS0lOR19PRl9OT05fVEVNUE9SQVJZX0VWRU5UUyhwZWQsIHRvZ2dsZSkKICAgIFBFRC5TRVRfUEVEX0ZMRUVfQVRUUklCVVRFUyhwZWQsIDAsIG5vdCB0b2dnbGUpCiAgICBQRUQuU0VUX1BFRF9DT01CQVRfQVRUUklCVVRFUyhwZWQsIDE3LCB0b2dnbGUpCmVuZAoKLS0tLeiOt+WPlui3neemuwpmdW5jdGlvbiBHZXRfZGlzdGFuY2UocG9zMSwgcG9zMiwgdXNlWikKICAgIGxvY2FsIGRpc3RhbmNlID0gTUlTQy5HRVRfRElTVEFOQ0VfQkVUV0VFTl9DT09SRFMocG9zMS54LCBwb3MxLnksIHBvczEueiwgcG9zMi54LCBwb3MyLnksIHBvczIueiwgdXNlWikKICAgIC0tbG9jYWwgZGlzdGFuY2UgPSBtYXRoLnNxcnQoKHBvczEueC1wb3MyLngpKihwb3MxLngtcG9zMi54KSArIChwb3MxLnktcG9zMi55KSoocG9zMS55LXBvczIueSkgKyAocG9zMS56LXBvczIueikqKHBvczEuei1wb3MyLnopKS0t5bmz5pa55qC56K6h566X6Led56a7CiAgICAtLWxvY2FsIGRpc3RhbmNlID0gdmVjdG9yMy5kaXN0YW5jZShwb3MxLCBwb3MyKSAtLXYz6K6h566XCiAgICByZXR1cm4gZGlzdGFuY2UKZW5kCi0tLS3ojrflj5blnLDpnaLlnZDmoIcKZnVuY3Rpb24gd2F5cG9pbnRfY29vcmQoeCwgeSwgeikKICAgIGxvY2FsIGNvb3JkID0ge3ggPSB4LHkgPSB5LHogPSB6fQogICAgbG9jYWwgYm9vbHBhcmEsIHBvc3ogPSB1dGlsLmdldF9ncm91bmRfeih4LCB5KS0tTUlTQy5HRVRfR1JPVU5EX1pfRk9SXzNEX0NPT1JEKHBvcy54LCBwb3MueSwgcG9zLnosIGdyb3VuZF9wdHIsIGZhbHNlLCBmYWxzZSkKICAgIGxvY2FsIGVzbGlwb3N6ID0gMAogICAgd2hpbGUgbm90IGJvb2xwYXJhIGFuZCBlc2xpcG9zeiA8PSAxMDAgZG8KICAgICAgICBib29scGFyYSwgcG9zeiA9IHV0aWwuZ2V0X2dyb3VuZF96KHgsIHkpCiAgICAgICAgZXNsaXBvc3ogPSBlc2xpcG9zeiArIDEKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAogICAgaWYgYm9vbHBhcmEgdGhlbgogICAgICAgIGNvb3JkLnogPSBwb3N6CiAgICBlbmQKICAgIHJldHVybiBjb29yZAplbmQKCi0t5LiW55WM5Z2Q5qCH6L2s5bGP5bmV5Z2Q5qCHCmZ1bmN0aW9uIHdvcmxkX3RvX3NjcmVlbl9jb29yZHMoeCwgeSwgeikKICAgIGxvY2FsIHNjX3ggPSBtZW1vcnkuYWxsb2MoOCkKICAgIGxvY2FsIHNjX3kgPSBtZW1vcnkuYWxsb2MoOCkKICAgIEdSQVBISUNTLkdFVF9TQ1JFRU5fQ09PUkRfRlJPTV9XT1JMRF9DT09SRCh4LCB5LCB6LCBzY194LCBzY195KQogICAgbG9jYWwgcmV0ID0gewogICAgICAgIHggPSBtZW1vcnkucmVhZF9mbG9hdChzY194KSwKICAgICAgICB5ID0gbWVtb3J5LnJlYWRfZmxvYXQoc2NfeSkKICAgIH0KICAgIHJldHVybiByZXQKZW5kCgotLS0t6K6+572u5a6e5L2T6Z2i5a+55a6e5L2TCmZ1bmN0aW9uIHNldF9lbnRpdHlfZmFjZV9lbnRpdHkoZW50aXR5LCB0YXJnZXQsIHVzZVBpdGNoKQogICAgbG9jYWwgcG9zMSA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhlbnRpdHksIGZhbHNlKQogICAgbG9jYWwgcG9zMiA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyh0YXJnZXQsIGZhbHNlKQogICAgbG9jYWwgcmVsID0gdjMuc3ViKHBvczIsIHBvczEpCiAgICBsb2NhbCByb3QgPSB2My50b1JvdChyZWwpCiAgICBpZiBub3QgdXNlUGl0Y2ggdGhlbiAtLeS4iuS4i+aXi+i9rAogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0hFQURJTkcoZW50aXR5LCByb3QueikKICAgIGVsc2UKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9ST1RBVElPTihlbnRpdHksIHJvdC54LCByb3QueSwgcm90LnosIDIsIDApCiAgICBlbmQKZW5kCgotLeiOt+WPluatpuWZqGhhc2gKZnVuY3Rpb24gZ2V0X3dlYXBvbl9oYXNoKHBlZCkKICAgIGxvY2FsIHdwbl9wdHIgPSBtZW1vcnkuYWxsb2NfaW50KCkKICAgIGlmIFdFQVBPTi5HRVRfQ1VSUkVOVF9QRURfVkVISUNMRV9XRUFQT04ocGVkLCB3cG5fcHRyKSB0aGVuIC0tIOWPquacieW9k+atpuWZqOaYr+i9pui+huatpuWZqOaXtuaJjei/lOWbnnRydWUKICAgICAgICByZXR1cm4gbWVtb3J5LnJlYWRfaW50KHdwbl9wdHIpLCB0cnVlCiAgICBlbmQKICAgIHJldHVybiBXRUFQT04uR0VUX1NFTEVDVEVEX1BFRF9XRUFQT04ocGVkKSwgZmFsc2UKZW5kCgotLS0t6I635Y+W556E5YeG5a6e5L2T5L+h5oGvCmZ1bmN0aW9uIGdldF9lbnRpdHlfaW5mbyhlbnQpCiAgICBsb2NhbCBpbmZvID0ge30KICAgIGxvY2FsIGVudF90eXBlcyA9IHsibmlsIiwiUEVEIiwgIui9veWFtyIsICLniankvZMifQogICAgaWYgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKGVudCkgdGhlbgogICAgICAgIGluZm9bImhhc2giXSA9IEVOVElUWS5HRVRfRU5USVRZX01PREVMKGVudCkKICAgICAgICBpbmZvWyJoZWFsdGgiXSA9IEVOVElUWS5HRVRfRU5USVRZX0hFQUxUSChlbnQpCiAgICAgICAgaW5mb1sidHlwZSJdID0gRU5USVRZLkdFVF9FTlRJVFlfVFlQRShlbnQpCiAgICAgICAgaW5mb1sidHlwZV9uYW1lIl0gPSBlbnRfdHlwZXNbRU5USVRZLkdFVF9FTlRJVFlfVFlQRShlbnQpKzFdCiAgICAgICAgaW5mb1sic3BlZWQiXSA9IG1hdGguZmxvb3IoRU5USVRZLkdFVF9FTlRJVFlfU1BFRUQoZW50KSkKICAgICAgICByZXR1cm4gaW5mbwogICAgZW5kCiAgICByZXR1cm4gMAplbmQKLS0tLS3ojrflj5bnnoTlh4blrp7kvZPlj6Xmn4QKZnVuY3Rpb24gZ2V0X2VudGl0eV9wbGF5ZXJfaXNfYWltaW5nX2F0KHBsYXllcikKICAgIGxvY2FsIGVudGl0eSA9IDAKCWlmIG5vdCBQTEFZRVIuSVNfUExBWUVSX0ZSRUVfQUlNSU5HKHBsYXllcikgdGhlbgoJCXJldHVybiAwCgllbmQKICAgIGxvY2FsIGFpbWVkX2VudGl0eSA9IG1lbW9yeS5hbGxvY19pbnQoKQoJaWYgUExBWUVSLkdFVF9FTlRJVFlfUExBWUVSX0lTX0ZSRUVfQUlNSU5HX0FUKHBsYXllciwgYWltZWRfZW50aXR5KSB0aGVuCgkJZW50aXR5ID0gbWVtb3J5LnJlYWRfaW50KGFpbWVkX2VudGl0eSkKCWVuZAoJaWYgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKGVudGl0eSkgYW5kIEVOVElUWS5JU19FTlRJVFlfQV9QRUQoZW50aXR5KSBhbmQgUEVELklTX1BFRF9JTl9BTllfVkVISUNMRShlbnRpdHksIGZhbHNlKSB0aGVuIC0t5aaC5p6c5a6e5L2T5Zyo6L295YW3LOWImei/lOWbnui9veWFt+S/oeaBrwoJCWVudGl0eSA9IFBFRC5HRVRfVkVISUNMRV9QRURfSVNfSU4oZW50aXR5LCBmYWxzZSkKCWVuZAoJcmV0dXJuIGVudGl0eQplbmQKCi0tLS3ku47nm7jmnLrojrflj5blgY/np7vph48KZnVuY3Rpb24gZ2V0X29mZnNldF9mcm9tX2NhbWVyYShkaXN0YW5jZSkKICAgIGxvY2FsIGNhbV9yb3QgPSBDQU0uR0VUX0ZJTkFMX1JFTkRFUkVEX0NBTV9ST1QoMCkKICAgIGxvY2FsIGNhbV9wb3MgPSBDQU0uR0VUX0ZJTkFMX1JFTkRFUkVEX0NBTV9DT09SRCgpCiAgICBsb2NhbCBkaXJlY3Rpb24gPSB2ZWN0b3IzLnRvRGlyKGNhbV9yb3QpIC0tIHYzLnRvRGlyKGNhbV9yb3QpCiAgICBsb2NhbCBkZXN0aW5hdGlvbiA9CiAgICB7CiAgICAgICAgeCA9IGNhbV9wb3MueCArIGRpcmVjdGlvbi54ICogKGRpc3RhbmNlIG9yIDApLAogICAgICAgIHkgPSBjYW1fcG9zLnkgKyBkaXJlY3Rpb24ueSAqIChkaXN0YW5jZSBvciAwKSwKICAgICAgICB6ID0gY2FtX3Bvcy56ICsgZGlyZWN0aW9uLnogKiAoZGlzdGFuY2Ugb3IgMCkKICAgIH0KICAgIHJldHVybiBkZXN0aW5hdGlvbgplbmQKCi0tLS3pmYTliqAKZnVuY3Rpb24gYXR0YWNoX3RvX3BsYXllcihoYXNoLCBib25lLCB4LCB5LCB6LCB4cm90LCB5cm90LCB6cm90KSAgICAgICAgICAgCiAgICBsb2NhbCB1c2VyX3BlZCA9IFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkKICAgIGhhc2ggPSB1dGlsLmpvYWF0KGhhc2gpCiAgICByZXF1ZXN0X21vZGVsKGhhc2gpCiAgICBsb2NhbCBvYmplY3QgPSBPQkpFQ1QuQ1JFQVRFX09CSkVDVChoYXNoLCAwLjAsMC4wLDAsIHRydWUsIHRydWUsIGZhbHNlKQogICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKG9iamVjdCwgdXNlcl9wZWQsIFBFRC5HRVRfUEVEX0JPTkVfSU5ERVgoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgYm9uZSksIHgsIHksIHosIHhyb3QsIHlyb3QsIHpyb3QsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCAwLCB0cnVlLCAwKSAKZW5kCgotLS0t5Yik5pat5a6e5L2T5Zyo5rC05LiKCmZ1bmN0aW9uIGlzX2VudGl0eV9vbl93YXRlcihlbnQpCiAgICBsb2NhbCBodCA9IG1lbW9yeS5hbGxvYyg0KQogICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKGVudCkKICAgIHJldHVybiBXQVRFUi5HRVRfV0FURVJfSEVJR0hUKHBvcy54LCBwb3MueSwgcG9zLnosIGh0KS0tKEVOVElUWS5JU19FTlRJVFlfSU5fV0FURVIoZW50KeWIpOaWreWunuS9k+aYr+WQpuWcqOawtOS4rS/msLTkuIrov5Tlm55mYWxzZSkKZW5kCgotLS0t6ISa5pysCi0t5Yik5pat6ISa5pys6L+Q6KGMCmZ1bmN0aW9uIElTX1NDUklQVF9SVU5OSU5HKHNjcmlwdG5hbWUpCiAgICByZXR1cm4gU0NSSVBULkdFVF9OVU1CRVJfT0ZfVEhSRUFEU19SVU5OSU5HX1RIRV9TQ1JJUFRfV0lUSF9USElTX0hBU0godXRpbC5qb2FhdChzY3JpcHRuYW1lKSkgPiAwCmVuZAotLeivt+axguiEmuacrApmdW5jdGlvbiByZXF1ZXN0X3NjcmlwdChzY3JpcHRuYW1lLCB0aW1lb3V0KQogICAgbG9jYWwgZW5kX3RpbWUgPSBvcy50aW1lKCkgKyAodGltZW91dCBvciAzKQogICAgU0NSSVBULlJFUVVFU1RfU0NSSVBUKHNjcmlwdG5hbWUpCiAgICB3aGlsZSBub3QgU0NSSVBULkhBU19TQ1JJUFRfTE9BREVEKHNjcmlwdG5hbWUpIGFuZCBlbmRfdGltZSA+IG9zLnRpbWUoKSBkbwoJCVNDUklQVC5SRVFVRVNUX1NDUklQVChzY3JpcHRuYW1lKQoJCXV0aWwueWllbGQoKQoJZW5kCiAgICByZXR1cm4gU0NSSVBULkhBU19TQ1JJUFRfTE9BREVEKHNjcmlwdG5hbWUpCmVuZAotLeW8gOWni+iEmuacrApmdW5jdGlvbiBTVEFSVF9TQ1JJUFQobmFtZSkKICAgIGlmIHJlcXVlc3Rfc2NyaXB0KG5hbWUpIHRoZW4KICAgICAgICBTWVNURU0uU1RBUlRfTkVXX1NDUklQVChuYW1lLCA1MDAwKQogICAgZWxzZQogICAgICAgIG5vdGlmeSgi6ISa5pys6K+35rGC5aSx6LSlIikKICAgIGVuZAplbmQKCi0tLS1CSVQKZnVuY3Rpb24gU0VUX0JJVChiaXRzLCBwbGFjZSkgLS0gQ3JlZGl0IGdvZXMgdG8gV2lyaVNjcmlwdAogICAgcmV0dXJuIChiaXRzIHwgKDEgPDwgcGxhY2UpKQplbmQKZnVuY3Rpb24gQ0xFQVJfQklUKGJpdHMsIHBsYWNlKQoJcmV0dXJuIChiaXRzICYgfigxIDw8IHBsYWNlKSkKZW5kCmZ1bmN0aW9uIFRFU1RfQklUKGJpdHMsIHBsYWNlKQoJcmV0dXJuIChiaXRzICYgKDEgPDwgcGxhY2UpKSB+PSAwCmVuZAoKCgotLS0t6ZqP5py65a2X56ym5LiyCmZ1bmN0aW9uIHJhbmRvbV9zdHJpbmcobGVuZ3RoKQogICAgbG9jYWwgbmFtZSA9ICIiCiAgICBsb2NhbCBzdHJpbmdzID0gImFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6QUJDRURGR0hJSktMTU5PUFFSU1RVVldYWVowMTIzNDU2Nzg5IgogICAgZm9yIGkgPSAxLCBsZW5ndGggZG8gCiAgICAgICAgbmFtZSA9IG5hbWUgLi4gc3RyaW5nc1ttYXRoLnJhbmRvbSgjc3RyaW5ncyldICAKICAgIGVuZAogICAgcmV0dXJuIG5hbWUKZW5kCi0tLS3ku47ooajlj5bpmo/mnLrlhYPntKAKZnVuY3Rpb24gdGJsX3RvX3JhbmRvbSh0YmwpCiAgICBsb2NhbCByID0gbWF0aC5yYW5kb20oI3RibCkKICAgIHJldHVybiB0Ymxbcl0KZW5kCgoKLS0tLeihqOafpeivogpmdW5jdGlvbiB0YWJsZV9maW5kKHRibCwgdmFsKQogICAgaWYgdHlwZSh0YmwpID09ICJ0YWJsZSIgdGhlbgogICAgICAgIC0tIOmBjeWOhuihqOS4reeahOavj+S4gOS4qumUruWAvOWvuQogICAgICAgIGZvciBfLCB2YWx1ZSBpbiBwYWlycyh0YmwpIGRvCiAgICAgICAgICAgIC0tIOWmguaenOaJvuWIsOWMuemFjeeahOWAvO+8jOi/lOWbniB0cnVlCiAgICAgICAgICAgIGlmIHZhbHVlID09IHZhbCB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgLS0g5aaC5p6c5YC85piv5LiA5Liq6KGo77yM6YCS5b2S5qOA5p+lCiAgICAgICAgICAgIGlmIHR5cGUodmFsdWUpID09ICJ0YWJsZSIgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgZXhpc3RzID0gdGFibGVfZmluZCh2YWx1ZSwgdmFsKQogICAgICAgICAgICAgICAgLS0g5aaC5p6c6YCS5b2S6LCD55So6L+U5ZueIHRydWXvvIzor7TmmI7mib7liLDkuobvvIznm7TmjqXov5Tlm54KICAgICAgICAgICAgICAgIGlmIGV4aXN0cyB0aGVuCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogICAgLS0g6YGN5Y6G57uT5p2f77yM5pyq5om+5Yiw5Yy56YWN55qE5YC877yM6L+U5ZueIGZhbHNlCiAgICByZXR1cm4gZmFsc2UKZW5kCgotLS0tanNvbuWtl+espuS4sui9rOWPmOS4uiB0YWJsZeihqApmdW5jdGlvbiBKc29uVG9UYWJsZShzdHJpbmdzKQogICAgcmV0dXJuIGpzb24uZGVjb2RlKHN0cmluZ3MpCmVuZAotLS0tdGFibGXooajovaxqc29u5a2X56ym5LiyCmZ1bmN0aW9uIFRhYmxlVG9Kc29uKHRibCkKICAgIHJldHVybiBqc29uLnN0cmluZ2lmeSh0YmwsIG5pbCwgNCkgLS3pu5jorqTnqbrmoLzlrZfnrKY0CmVuZAotLS0tdGFibGXooajovazlrZfnrKbkuLIKZnVuY3Rpb24gVGFibGVUb1N0cmluZyh0YmwpCiAgICBsb2NhbCByZXN1bHQgPSAieyIKICAgIGxvY2FsIHNlcGFyYXRvciA9ICIiCiAgICBmb3IgaywgdiBpbiBwYWlycyh0YmwpIGRvCiAgICAgICAgcmVzdWx0ID0gcmVzdWx0IC4uIHNlcGFyYXRvcgogICAgICAgIGlmIHR5cGUoaykgPT0gIm51bWJlciIgdGhlbgogICAgICAgICAgICByZXN1bHQgPSByZXN1bHQgLi4gIlsiIC4uIGsgLi4gIl0iCiAgICAgICAgZWxzZQogICAgICAgICAgICByZXN1bHQgPSByZXN1bHQgLi4gawogICAgICAgIGVuZAogICAgICAgIHJlc3VsdCA9IHJlc3VsdCAuLiAiPSIKICAgICAgICBpZiB0eXBlKHYpID09ICJ0YWJsZSIgdGhlbgogICAgICAgICAgICByZXN1bHQgPSByZXN1bHQgLi4gVGFibGVUb1N0cmluZyh2KQogICAgICAgIGVsc2VpZiB0eXBlKHYpID09ICJzdHJpbmciIHRoZW4KICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0IC4uIHN0cmluZy5mb3JtYXQoIiVxIiwgdikKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdCAuLiB0b3N0cmluZyh2KQogICAgICAgIGVuZAogICAgICAgIHNlcGFyYXRvciA9ICIsIgogICAgZW5kCiAgICByZXN1bHQgPSByZXN1bHQgLi4gIn0iCiAgICByZXR1cm4gcmVzdWx0CmVuZAoKLS0tLeS7jmpzb27ojrflj5bkv6Hmga8KZnVuY3Rpb24gZ2V0X2luZm9fZnJvbV9qc29uZmlsZShmaWxlcGF0aCkKICAgIGxvY2FsIGZpbGUgPSBpby5vcGVuKGZpbGVwYXRoLCAiciIpCiAgICBpZiBmaWxlIHRoZW4KICAgICAgICBsb2NhbCBkYXRhID0ganNvbi5kZWNvZGUoZmlsZTpyZWFkKCIqYSIpKQogICAgICAgIGZpbGU6Y2xvc2UoKQogICAgICAgIHJldHVybiBkYXRhCiAgICBlbHNlCiAgICAgICAgRVJST1JfTE9HKCLml6Dms5Xor7vlj5bmlofku7YiIC4uIGZpbGVwYXRoIC4uICInIikKICAgIGVuZAplbmQKCi0t56aB5q2i5oyJ6ZSu5rS75YqoCmZ1bmN0aW9uIGRpc2FibGVfY29udHJvbF9hY3Rpb24oLi4uKQogICAgbG9jYWwga2V5cyA9IHsuLi59CiAgICBmb3IgaywgdiBpbiBwYWlycyhrZXlzKSBkbwogICAgICAgIFBBRC5ESVNBQkxFX0NPTlRST0xfQUNUSU9OKDAsIHYsIHRydWUpCiAgICBlbmQKZW5kCi0t5pi+56S65oyJ6ZSuCmZ1bmN0aW9uIGRpc3BsYXlfYnV0dG9ucyh0YmwpCiAgICAtLUhlYWQKICAgIEhVRC5ISURFX0hVRF9DT01QT05FTlRfVEhJU19GUkFNRSg2KQogICAgSFVELkhJREVfSFVEX0NPTVBPTkVOVF9USElTX0ZSQU1FKDcpCiAgICBIVUQuSElERV9IVURfQ09NUE9ORU5UX1RISVNfRlJBTUUoOCkKICAgIEhVRC5ISURFX0hVRF9DT01QT05FTlRfVEhJU19GUkFNRSg5KQogICAgc2YuQ0xFQVJfQUxMKCkKICAgIHNmLlRPR0dMRV9NT1VTRV9CVVRUT05TKGZhbHNlKQogICAgLS1Cb2R5CiAgICBmb3IgaywgdiBpbiBwYWlycyh0YmwpIGRvCiAgICAgICAgc2YuU0VUX0RBVEFfU0xPVCh2WzFdLCBQQUQuR0VUX0NPTlRST0xfSU5TVFJVQ1RJT05BTF9CVVRUT05TX1NUUklORygwLCB2WzJdLCB0cnVlKSwgdlszXSkKICAgIGVuZAogICAgLS1lbmQKICAgIHNmLkRSQVdfSU5TVFJVQ1RJT05BTF9CVVRUT05TKCkKICAgIHNmOmRyYXdfZnVsbHNjcmVlbigpCmVuZAoKLS0tLeeOqeWutuWKoOWFpeemu+W8gApsb2NhbCBKTF9zdGF0ZSA9IHt9CmZ1bmN0aW9uIHBsYXllcl9qb2luKGZ1bmMpCiAgICBpZiBORVRXT1JLLk5FVFdPUktfSVNfU0VTU0lPTl9BQ1RJVkUoKSB0aGVuCiAgICAgICAgLS3lrp7ml7bmiJjlsYDnjqnlrrYKICAgICAgICBsb2NhbCBhbGxfcGxheWVyID0ge30KICAgICAgICBmb3IgcGlkID0gMCwgMzIgZG8KICAgICAgICAgICAgaWYgUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkgfj0gMCB0aGVuCiAgICAgICAgICAgICAgICBhbGxfcGxheWVyW3BpZF0gPSBQTEFZRVIuR0VUX1BMQVlFUl9OQU1FKHBpZCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICAgICAgLS3njqnlrrbliqDlhaUKICAgICAgICBmb3IgcGlkLCBuYW1lIGluIHBhaXJzKGFsbF9wbGF5ZXIpIGRvCiAgICAgICAgICAgIGlmIG5vdCB0YWJsZV9maW5kKEpMX3N0YXRlLCBuYW1lKSB0aGVuCiAgICAgICAgICAgICAgICBKTF9zdGF0ZVtwaWRdID0gbmFtZQogICAgICAgICAgICAgICAgaWYgdHlwZShmdW5jKSA9PSAiZnVuY3Rpb24iIHRoZW4KICAgICAgICAgICAgICAgICAgICBmdW5jKHBpZCwgbmFtZSkgIC0t6L+U5ZuecGlkLCBuYW1lCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgSkxfc3RhdGUgPSB7fQogICAgZW5kCmVuZApmdW5jdGlvbiBwbGF5ZXJfbGVhdmUoZnVuYykKICAgIGlmIE5FVFdPUksuTkVUV09SS19JU19TRVNTSU9OX0FDVElWRSgpIHRoZW4KICAgICAgICAtLeWunuaXtuaImOWxgOeOqeWutgogICAgICAgIGxvY2FsIGFsbF9wbGF5ZXIgPSB7fQogICAgICAgIGZvciBwaWQgPSAwLCAzMiBkbwogICAgICAgICAgICBpZiBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSB+PSAwIHRoZW4KICAgICAgICAgICAgICAgIGFsbF9wbGF5ZXJbcGlkXSA9IFBMQVlFUi5HRVRfUExBWUVSX05BTUUocGlkKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICAtLeeOqeWutuWKoOWFpQogICAgICAgIGZvciBwaWQsIG5hbWUgaW4gcGFpcnMoYWxsX3BsYXllcikgZG8KICAgICAgICAgICAgaWYgbm90IHRhYmxlX2ZpbmQoSkxfc3RhdGUsIG5hbWUpIHRoZW4KICAgICAgICAgICAgICAgIEpMX3N0YXRlW3BpZF0gPSBuYW1lCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIC0t546p5a6256a75byACiAgICAgICAgZm9yIHBpZCwgbmFtZSBpbiBwYWlycyhKTF9zdGF0ZSkgZG8KICAgICAgICAgICAgaWYgbm90IHRhYmxlX2ZpbmQoYWxsX3BsYXllciwgbmFtZSkgdGhlbgogICAgICAgICAgICAgICAgSkxfc3RhdGVbcGlkXSA9IG5pbAogICAgICAgICAgICAgICAgaWYgdHlwZShmdW5jKSA9PSAiZnVuY3Rpb24iIHRoZW4KICAgICAgICAgICAgICAgICAgICBmdW5jKHBpZCwgbmFtZSkgIC0t6L+U5ZuecGlkLCBuYW1lCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgSkxfc3RhdGUgPSB7fQogICAgZW5kCmVuZAoKLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLS0tLeWNgeWFrei/m+WItuminOiJsuWAvOi9rOaNouS4ulJHQuagvOW8jwpmdW5jdGlvbiBoZXhUb1JHQihoZXgsIGFscGhhKQogICAgLS0g56e76Zmk5Y+v6IO95a2Y5Zyo55qEI+WPtwogICAgaGV4ID0gaGV4OmdzdWIoIiMiLCIiKQogICAgbG9jYWwgY29sb3IgPSB7YSA9IGFscGhhIG9yIDF9CiAgICAtLSDojrflj5bpopzoibLnmoRS44CBR+OAgULliIbph48KICAgIGNvbG9yLnIgPSB0b251bWJlcihoZXg6c3ViKDEsMiksIDE2KSAvIDI1NQogICAgY29sb3IuZyA9IHRvbnVtYmVyKGhleDpzdWIoMyw0KSwgMTYpIC8gMjU1CiAgICBjb2xvci5iID0gdG9udW1iZXIoaGV4OnN1Yig1LDYpLCAxNikgLyAyNTUKICAgIC0tIOi/lOWbnlJHQuWAvAogICAgcmV0dXJuIGNvbG9yCmVuZAotLeWwhlJHQuminOiJsuWAvOi9rOaNouS4uuWNgeWFrei/m+WItuagvOW8jwpmdW5jdGlvbiBSR0JUb0hleChyLCBnLCBiKQogICAgLS0g5bCGUkdC5YC86L2s5o2i5Li65Y2B5YWt6L+b5Yi25qC85byPCiAgICBsb2NhbCBoZXggPSBzdHJpbmcuZm9ybWF0KCIjJTAyWCUwMlglMDJYIiwgbWF0aC5mbG9vcihyICogMjU1KSwgbWF0aC5mbG9vcihnICogMjU1KSwgbWF0aC5mbG9vcihiICogMjU1KSkKICAgIC0tIOi/lOWbnuWNgeWFrei/m+WItuminOiJsuWAvAogICAgcmV0dXJuIGhleAplbmQKCgoKLS0tLeenu+mZpOaJgOacieaRhOWDj+WktApmdW5jdGlvbiByZW1vdmVfYWxsX2NhbWVyYSgpCiAgICBmb3IgXywgZW50IGluIHBhaXJzKGVudGl0aWVzLmdldF9hbGxfb2JqZWN0c19hc19oYW5kbGVzKCkpIGRvCiAgICAgICAgZm9yIF9fLCBjYW0gaW4gcGFpcnMoQ2FtTGlzdCkgZG8KICAgICAgICAgICAgaWYgRU5USVRZLkdFVF9FTlRJVFlfTU9ERUwoZW50KSA9PSBjYW0gdGhlbgogICAgICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQVNfTUlTU0lPTl9FTlRJVFkoZW50LHRydWUsdHJ1ZSkgLS3lhYjorr7nva7kuLrku7vliqHlrp7kvZMg5LiN5omn6KGM6L+Z5Liq5LiL6Z2i5Lya5Yig6Zmk5aSx6LSlCiAgICAgICAgICAgICAgICBkZWxldGVfZW50aXR5KGVudCkgICAgICAgICAgICAgCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZAoKLS0tLS3pgI/op4bml6DkurrmnLoKZnVuY3Rpb24gc2hvd19uYW5vX2Ryb25lKCkKICAgIGxvY2FsIG9ianMgPSBlbnRpdGllcy5nZXRfYWxsX29iamVjdHNfYXNfcG9pbnRlcnMoKQogICAgZm9yIF8sIG9iaiBpbiBwYWlycyhvYmpzKSBkbwogICAgICAgIGlmIChlbnRpdGllcy5nZXRfbW9kZWxfaGFzaChvYmopID09IDQzMDg0MTY3Nykgb3IgKGVudGl0aWVzLmdldF9tb2RlbF9oYXNoKG9iaikgPT0gLTEzMjQ5NDI2NzEpIHRoZW4gLS1uYW5vIGRyb25lIG9iamVjdAogICAgICAgICAgICBsb2NhbCBwb3MgPSBlbnRpdGllcy5nZXRfcG9zaXRpb24ob2JqKQogICAgICAgICAgICBsb2NhbCBvdXJwZWRwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpCiAgICAgICAgICAgIEdSQVBISUNTLkRSQVdfTElORShvdXJwZWRwb3MueCwgb3VycGVkcG9zLnksIG91cnBlZHBvcy56LCBwb3MueCwgcG9zLnksIHBvcy56LCAyNTUsIDI1NSwgMjU1LCAyNTUpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgotLS0t5by65Yi25omA5pyJ5r2c6ImH5rWu5Ye65rC06Z2iCmZ1bmN0aW9uIEZvcmNlX3N1cmZhY2VfYWxsX3N1YnModG9nZ2xlZCkKICAgIGxvY2FsIHZlaEhhbmRsZXMgPSBlbnRpdGllcy5nZXRfYWxsX3ZlaGljbGVzX2FzX2hhbmRsZXMoKQogICAgZm9yIGkgPSAxLCAjdmVoSGFuZGxlcyBkbwogICAgICAgIGlmIEVOVElUWS5HRVRfRU5USVRZX01PREVMKHZlaEhhbmRsZXNbaV0pID09IDEzMzY4NzIzMDQgdGhlbiAtLSBpZiBLb3NhdGthCiAgICAgICAgICAgIFZFSElDTEUuRk9SQ0VfU1VCTUFSSU5FX1NVUkZBQ0VfTU9ERSh2ZWhIYW5kbGVzW2ldLCB0b2dnbGUpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgoKLS0tLeWKoOi9vUlQTOWcsOWbvgpmdW5jdGlvbiBsb2FkX0lQTChJUExfbGlzdCwgeCwgeSwgeiwgdmFsKQogICAgaWYgdmFsID09IDEgdGhlbgogICAgICAgIGZvciBpID0gMSwgI0lQTF9saXN0IGRvCiAgICAgICAgICAgIHJlcXVlc3RfaXBsKElQTF9saXN0W2ldKQogICAgICAgIGVuZAogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgeCwgeSwgeiwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgIGVsc2UKICAgICAgICBmb3IgaSA9IDEsICNJUExfbGlzdCBkbwogICAgICAgICAgICByZW1vdmVfaXBsKElQTF9saXN0W2ldKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKLS3ojrflj5bmnIDov5HnmoTovb3lhbcKZnVuY3Rpb24gZ2V0X2Nsb3Nlc3RfdmVoaWNsZShlbnRpdHkgLCBjbG9zZXN0ZGlzdCkKICAgIGxvY2FsIGNvb3JkcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhlbnRpdHksIHRydWUpCiAgICBsb2NhbCB2ZWhpY2xlcyA9IGVudGl0aWVzLmdldF9hbGxfdmVoaWNsZXNfYXNfaGFuZGxlcygpCiAgICBjbG9zZXN0ZGlzdCA9IGNsb3Nlc3RkaXN0IG9yIDEwMDAwMDAKICAgIGxvY2FsIGNsb3Nlc3R2ZWggPSAwCiAgICBmb3IgaywgdmVoIGluIHBhaXJzKHZlaGljbGVzKSBkbwogICAgICAgIC0t5Yik5pat5a6e5L2T5piv5ZCm5Li6UEVECiAgICAgICAgaWYgRU5USVRZLkdFVF9FTlRJVFlfVFlQRShlbnRpdHkpID09IDEgdGhlbgoKICAgICAgICAgICAgLS3liKTmlq3or6VwZWTmmK/lkKblnKjovb3lhbcKICAgICAgICAgICAgaWYgUEVELklTX1BFRF9JTl9BTllfVkVISUNMRShlbnRpdHksIGZhbHNlKSB0aGVuCiAgICAgICAgICAgICAgICBpZiB2ZWggfj0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19JTihlbnRpdHksIGZhbHNlKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgdmVoY29vcmQgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFModmVoLCB0cnVlKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGRpc3QgPSBHZXRfZGlzdGFuY2UoY29vcmRzLCB2ZWhjb29yZCwgdHJ1ZSkKICAgICAgICAgICAgICAgICAgICBpZiBkaXN0IDwgY2xvc2VzdGRpc3QgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBjbG9zZXN0ZGlzdCA9IGRpc3QKICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VzdHZlaCA9IHZlaAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGxvY2FsIHZlaGNvb3JkID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHZlaCwgdHJ1ZSkKICAgICAgICAgICAgICAgIGxvY2FsIGRpc3QgPSBHZXRfZGlzdGFuY2UoY29vcmRzLCB2ZWhjb29yZCwgdHJ1ZSkKICAgICAgICAgICAgICAgIGlmIGRpc3QgPCBjbG9zZXN0ZGlzdCB0aGVuCiAgICAgICAgICAgICAgICAgICAgY2xvc2VzdGRpc3QgPSBkaXN0CiAgICAgICAgICAgICAgICAgICAgY2xvc2VzdHZlaCA9IHZlaAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAoKICAgICAgICBlbHNlCiAgICAgICAgICAgIC0t5a6e5L2T5Li66Z2ecGVk5pe2CiAgICAgICAgICAgIGxvY2FsIHZlaGNvb3JkID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHZlaCwgdHJ1ZSkKICAgICAgICAgICAgbG9jYWwgZGlzdCA9IEdldF9kaXN0YW5jZShjb29yZHMsIHZlaGNvb3JkLCB0cnVlKQogICAgICAgICAgICBpZiBkaXN0IDwgY2xvc2VzdGRpc3QgdGhlbgogICAgICAgICAgICAgICAgY2xvc2VzdGRpc3QgPSBkaXN0CiAgICAgICAgICAgICAgICBjbG9zZXN0dmVoID0gdmVoCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgIGVuZAogICAgcmV0dXJuIGNsb3Nlc3R2ZWgKZW5kCgotLeiOt+WPluacgOi/keeahFBFRApmdW5jdGlvbiBnZXRfY2xvc2VzdF9wZWQoZW50LCBkaXN0KQogICAgbG9jYWwgY2xvc2VzdF9wZWQgPSBuaWwKICAgIGxvY2FsIGNsb3Nlc3RfZGlzdCA9IGRpc3Qgb3IgMTAwMDAwMAogICAgbG9jYWwgdGhpc19kaXN0ID0gMAogICAgbG9jYWwgY29vcmRzID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKGVudCwgZmFsc2UpCiAgICBmb3IgXywgcGVkIGluIHBhaXJzKGVudGl0aWVzLmdldF9hbGxfcGVkc19hc19oYW5kbGVzKCkpIGRvCiAgICAgICAgdGhpc19kaXN0ID0gdjMuZGlzdGFuY2UoY29vcmRzLCBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMocGVkKSkKICAgICAgICBpZiB0aGlzX2Rpc3QgPCBjbG9zZXN0X2Rpc3QgYW5kIHBlZCB+PSBQTEFZRVIuUExBWUVSX1BFRF9JRCgpIHRoZW4KICAgICAgICAgICAgY2xvc2VzdF9wZWQgPSBwZWQKICAgICAgICAgICAgY2xvc2VzdF9kaXN0ID0gdGhpc19kaXN0CiAgICAgICAgZW5kCiAgICBlbmQKICAgIHJldHVybiBjbG9zZXN0X3BlZAplbmQKLS3ojrflj5bmnIDov5HnmoTnjqnlrrYKZnVuY3Rpb24gZ2V0X2Nsb3Nlc3RfcGxheWVyKGVudCwgZGlzdCkKICAgIGxvY2FsIGNsb3Nlc3RfcGVkID0gbmlsCiAgICBsb2NhbCBjbG9zZXN0X2Rpc3QgPSBkaXN0IG9yIDEwMDAwMDAKICAgIGxvY2FsIHRoaXNfZGlzdCA9IDAKICAgIGxvY2FsIGNvb3JkcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhlbnQsIGZhbHNlKQogICAgZm9yIF8sIHBlZCBpbiBwYWlycyhlbnRpdGllcy5nZXRfYWxsX3BlZHNfYXNfaGFuZGxlcygpKSBkbwogICAgICAgIHRoaXNfZGlzdCA9IHYzLmRpc3RhbmNlKGNvb3JkcywgRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHBlZCkpCiAgICAgICAgaWYgdGhpc19kaXN0IDwgY2xvc2VzdF9kaXN0IGFuZCBwZWQgfj0gUExBWUVSLlBMQVlFUl9QRURfSUQoKSBhbmQgUEVELklTX1BFRF9BX1BMQVlFUihwZWQpIHRoZW4KICAgICAgICAgICAgY2xvc2VzdF9wZWQgPSBwZWQKICAgICAgICAgICAgY2xvc2VzdF9kaXN0ID0gdGhpc19kaXN0CiAgICAgICAgZW5kCiAgICBlbmQKICAgIHJldHVybiBjbG9zZXN0X3BlZAplbmQKCgoKCgoKCgoKCgoKCgotLS0t57KS5a2Q5p6qCmxvY2FsIGhhZF9zbGVfcGFydGljbGVfZ3VuID0ge2xpYiA9ICdzY3JfcmNiYXJyeTInLCBuYW1lID0gJ3Njcl9jbG93bl9hcHBlYXJzJ30tLem7mOiupApmdW5jdGlvbiBzZWxldGVfcGFydGljbGVfZ3VuKGluZGV4KQogICAgaGFkX3NsZV9wYXJ0aWNsZV9ndW4gPSBwYXJ0aWNsZV9ndW5kLnZhbHVlW2luZGV4XQplbmQKZnVuY3Rpb24gcGFydGljbGVfZ3VuKCkKICAgIGlmIFBFRC5JU19QRURfU0hPT1RJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgdGhlbgogICAgICAgIGxvY2FsIGhhc2ggPSB1dGlsLmpvYWF0KCJ3X2xyX2ZpcmV3b3JrX3JvY2tldCIpCiAgICAgICAgbG9jYWwgcGxheWVyX3BvcyA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwLjAsIDAuNSwgMC41KQogICAgICAgIGxvY2FsIGRpciA9IHt9CiAgICAgICAgbG9jYWwgYzIgPSB7fQogICAgICAgIGMyID0gZ2V0X29mZnNldF9mcm9tX2NhbWVyYSgxNSkKICAgICAgICBkaXIueCA9IChjMi54IC0gcGxheWVyX3Bvcy54KSAqIDE1CiAgICAgICAgZGlyLnkgPSAoYzIueSAtIHBsYXllcl9wb3MueSkgKiAxNQogICAgICAgIGRpci56ID0gKGMyLnogLSBwbGF5ZXJfcG9zLnopICogMTUKCiAgICAgICAgaWYgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKHBhcnRpY2xlX2d1bl9idWxsZXQpIHRoZW4KICAgICAgICAgICAgZGVsZXRlX2VudGl0eShwYXJ0aWNsZV9ndW5fYnVsbGV0KQogICAgICAgIGVuZAogICAgICAgIHBhcnRpY2xlX2d1bl9idWxsZXQgPSBjcmVhdGVfb2JqZWN0KGhhc2gsIHBsYXllcl9wb3MueCwgcGxheWVyX3Bvcy55LCBwbGF5ZXJfcG9zLnopCiAgICAgICAgc2V0X2VudGl0eV9mdWxsX3Zpc2libGUocGFydGljbGVfZ3VuX2J1bGxldCxmYWxzZSkKCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRShwYXJ0aWNsZV9ndW5fYnVsbGV0LHRydWUpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09MTElTSU9OKHBhcnRpY2xlX2d1bl9idWxsZXQsIGZhbHNlLCB0cnVlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0hBU19HUkFWSVRZKHBhcnRpY2xlX2d1bl9idWxsZXQsIGZhbHNlKQoKICAgICAgICBsb2NhbCBjYW1fcm90ID0gQ0FNLkdFVF9HQU1FUExBWV9DQU1fUk9UKDApCiAgICAgICAgRU5USVRZLkFQUExZX0ZPUkNFX1RPX0VOVElUWV9DRU5URVJfT0ZfTUFTUyhwYXJ0aWNsZV9ndW5fYnVsbGV0LCAxLCBkaXIueCwgZGlyLnksIGRpci56LCBmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9ST1RBVElPTihwYXJ0aWNsZV9ndW5fYnVsbGV0LCBjYW1fcm90LngsIGNhbV9yb3QueSwgY2FtX3JvdC56LCAwLCB0cnVlKQoKICAgICAgICByZXF1ZXN0X3B0ZnhfYXNzZXQoaGFkX3NsZV9wYXJ0aWNsZV9ndW4ubGliKQogICAgICAgIEdSQVBISUNTLlVTRV9QQVJUSUNMRV9GWF9BU1NFVChoYWRfc2xlX3BhcnRpY2xlX2d1bi5saWIpCiAgICAgICAgR1JBUEhJQ1MuU1RBUlRfTkVUV09SS0VEX1BBUlRJQ0xFX0ZYX05PTl9MT09QRURfT05fRU5USVRZKGhhZF9zbGVfcGFydGljbGVfZ3VuLm5hbWUsIHBhcnRpY2xlX2d1bl9idWxsZXQsIDAsIDAsIDAsIDAsIDE4MCwgMCwgMSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkKICAgIGVuZAplbmQKCi0tLS3ku47pk7booYzlj5blh7rpkrEKZnVuY3Rpb24gYmFua190b193YWxsZXQoKQogICAgbG9jYWwgYmFua0Nhc2ggPSBNT05FWS5ORVRXT1JLX0dFVF9WQ19CQU5LX0JBTEFOQ0UoKQogICAgaWYgYmFua0Nhc2ggPiAwIHRoZW4KICAgICAgICBORVRTSE9QUElORzEuX05FVF9HQU1FU0VSVkVSX1RSQU5TRkVSX0JBTktfVE9fV0FMTEVUKDAsIGJhbmtDYXNoKQogICAgICAgIHV0aWwudG9hc3QoIuWPluWHuiAiLi5iYW5rQ2FzaC4uIiQg5Yiw6ZKx5YyFIikKICAgIGVsc2UKICAgICAgICB1dGlsLnRvYXN0KCLkvZnpop3kuI3otrMs5Lqk5piT5aSx6LSlIikKICAgIGVuZAplbmQKLS0tLeWwhumSseWtmOWFpemTtuihjApmdW5jdGlvbiB3YWxsZXRfdG9fYmFuaygpCiAgICBsb2NhbCB3YWxsZXRDYXNoID0gTU9ORVkuTkVUV09SS19HRVRfVkNfV0FMTEVUX0JBTEFOQ0UoMCkKICAgIGlmIHdhbGxldENhc2ggPiAwIHRoZW4KICAgICAgICBORVRTSE9QUElORzEuX05FVF9HQU1FU0VSVkVSX1RSQU5TRkVSX1dBTExFVF9UT19CQU5LKDAsIHdhbGxldENhc2gpCiAgICAgICAgdXRpbC50b2FzdCgi5a2Y5YWlICIuLndhbGxldENhc2guLiIkIOWIsOmTtuihjCIpCiAgICBlbHNlCiAgICAgICAgdXRpbC50b2FzdCgi5L2Z6aKd5LiN6LazLOS6pOaYk+Wksei0pSIpCiAgICBlbmQKZW5kCi0tLS3oh6rliqjlrZjmrL4KZnVuY3Rpb24gYXV0b19kZXBvc2l0KCkKICAgIGxvY2FsIHdhbGxldENhc2ggPSBNT05FWS5ORVRXT1JLX0dFVF9WQ19XQUxMRVRfQkFMQU5DRSgwKQogICAgaWYgd2FsbGV0Q2FzaCA+IDAgdGhlbgogICAgICAgIE5FVFNIT1BQSU5HMS5fTkVUX0dBTUVTRVJWRVJfVFJBTlNGRVJfV0FMTEVUX1RPX0JBTksoMCwgd2FsbGV0Q2FzaCkKICAgICAgICB1dGlsLnRvYXN0KCLlt7LlsIYiLi53YWxsZXRDYXNoLi4iJOWtmOWFpemTtuihjCIpCiAgICBlbmQKZW5kCgotLS0t5riF6Zmk5Li+5oqlCmZ1bmN0aW9uIHJlbW92ZV9yZXBvcnRzKCkKICAgIFNUQVRfU0VUX0lOVCgiTVBQTFlfRlJJRU5ETFkiLCAwKSAtLeS5kOS6juWKqeS6ugogICAgU1RBVF9TRVRfSU5UKCJNUFBMWV9IRUxQRlVMIiwgMCkgLS3lj4vmlrkKICAgIFNUQVRfU0VUX0lOVCgiTVBQTFlfR1JJRUZJTkciLCAwKSAtLeaBtuaEj+aIluegtOWdj+aAp+ihjOS4ugogICAgU1RBVF9TRVRfSU5UKCJNUFBMWV9WQ19BTk5PWUlOR01FIiwgMCkgLS3or63pn7PogYrlpKk6IOmqmuaJsOaIkQogICAgU1RBVF9TRVRfSU5UKCJNUFBMWV9WQ19IQVRFIiwgMCkgLS3or63pn7PogYrlpKk6IOS9v+eUqOS7h+aBqOiogOiuugogICAgU1RBVF9TRVRfSU5UKCJNUFBMWV9UQ19BTk5PWUlOR01FIiwgMCkgLS3mloflrZfogYrlpKk6IOmqmuaJsOaIkQogICAgU1RBVF9TRVRfSU5UKCJNUFBMWV9UQ19IQVRFIiwgMCkgLS3mloflrZfogYrlpKk6IOS9v+eUqOS7h+aBqOiogOiuugogICAgU1RBVF9TRVRfSU5UKCJNUFBMWV9PRkZFTlNJVkVfTEFOR1VBR0UiLCAwKSAtLeS+rui+seaAp+ivreiogAogICAgU1RBVF9TRVRfSU5UKCJNUFBMWV9PRkZFTlNJVkVfVEFHUExBVEUiLCAwKSAtLeaUu+WHu+aAp+agh+etvueJjAogICAgU1RBVF9TRVRfSU5UKCJNUFBMWV9PRkZFTlNJVkVfVUdDIiwgMCkgLS3mlLvlh7vmgKflhoXlrrkKICAgIFNUQVRfU0VUX0lOVCgiTVBQTFlfQkFEX0NSRVdfTkFNRSIsIDApIC0t5LiN5ZaE55qE5biu5Lya5ZCN56ewCiAgICBTVEFUX1NFVF9JTlQoIk1QUExZX0JBRF9DUkVXX01PVFRPIiwgMCkgLS3kuI3lloTnmoTluK7kvJrluqflj7Ppk60KICAgIFNUQVRfU0VUX0lOVCgiTVBQTFlfQkFEX0NSRVdfU1RBVFVTIiwgMCkgLS3kuI3lloTnmoTluK7kvJrnirbmgIEKICAgIFNUQVRfU0VUX0lOVCgiTVBQTFlfQkFEX0NSRVdfRU1CTEVNIiwgMCkgLS3kuI3lloTnmoTluK7kvJrli4vnq6AKICAgIFNUQVRfU0VUX0lOVCgiTVBQTFlfRVhQTE9JVFMiLCAwKSAtLeS9nOW8iuaIluS/ruaUuQogICAgU1RBVF9TRVRfSU5UKCJNUFBMWV9CRUNBTUVfQkFEU1BPUlRfTlVNIiwgMCkgLS3lj5jmiJDmgbbmhI/njqnlrrbmrKHmlbAKICAgIFNUQVRfU0VUX0lOVCgiTVBQTFlfR0FNRV9FWFBMT0lUUyIsIDApIC0t6Zi756KN5oiW5rul55So5ri45oiP5Yqf6IO9CmVuZAoKLS0tLS3np7vpmaTmlLbmlK/lt64KZnVuY3Rpb24gYmFsYW5jaW5nX2Jvb2tzKCkKICAgIC0t5oC76Iqx6LS5CiAgICBsb2NhbCBzdmMgPSBTVEFUX0dFVF9JTlQoIk1QUExZX1RPVEFMX1NWQyIpCiAgICAtLeaAu+aUtuWFpQogICAgbG9jYWwgZXZjID0gU1RBVF9HRVRfSU5UKCJNUFBMWV9UT1RBTF9FVkMiKQogICAgLS3pk7booYzkvZnpop0KICAgIGxvY2FsIGJhbmtDYXNoID0gTU9ORVkuTkVUV09SS19HRVRfVkNfQkFOS19CQUxBTkNFKCkKICAgIC0t546w6YeRCiAgICBsb2NhbCB3YWxsZXRDYXNoID0gTU9ORVkuTkVUV09SS19HRVRfVkNfV0FMTEVUX0JBTEFOQ0UoMCkKCiAgICAtLeaUtuaUr+W3rgogICAgbG9jYWwgU0UgPSBldmMgLSBzdmMgLSBiYW5rQ2FzaCAtIHdhbGxldENhc2ggLS0tLeaAu+aUtuWFpSAtIOaAu+iKsei0uSA9IOeOsOmHkSArIOmTtuihjO+8jCAo5oC75pS25YWlIC0g5oC76Iqx6LS5IC0g546w6YeRIC3pk7booYwpID0gMAoKICAgIGlmIFNFIH49IDAgdGhlbiAKICAgICAgICBTVEFUX1NFVF9JTlQoIk1QUExZX1RPVEFMX0VWQyIsIHN2YyArIGJhbmtDYXNoICsgd2FsbGV0Q2FzaCArIG1hdGgucmFuZG9tKDIwMDAwKSkgLS3kuqfnlJ/kuIDkuKrpmo/mnLrlt67pop0KICAgICAgICAtLVNUQVRfU0VUX0lOVCgiTVBQTFlfVE9UQUxfU1ZDIiwgZXZjIC0gYmFua0Nhc2ggLSB3YWxsZXRDYXNoICkKICAgICAgICB1dGlsLnRvYXN0KCLlt7Lnp7vpmaTovoPlpKfmlLbmlK/lt67pop0iKQogICAgZWxzZQogICAgICAgIHV0aWwudG9hc3QoIuaCqOeahOaUtuaUr+W3ruWujOWFqOato+W4uCIpCiAgICBlbmQKZW5kCgoKLS0tLS0t5q2m5Zmo5aix5LmQCgotLS0t6Zyw5by55p6q5qih5byPCmZ1bmN0aW9uIHN1cGVyX3Nob3RndW4oKQogICAgbG9jYWwgcG9zID0gdjMubmV3KCkgLS12MyBhZGRyCiAgICBpZiBXRUFQT04uR0VUX1BFRF9MQVNUX1dFQVBPTl9JTVBBQ1RfQ09PUkQoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgcG9zKSBhbmQgbm90IFBFRC5JU19QRURfSU5fQU5ZX1ZFSElDTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgdGhlbgogICAgICAgIGxvY2FsIHIgPSA1CiAgICAgICAgbG9jYWwgeCA9IHttaW4gPSBtYXRoLmNlaWwocG9zLnggLSByKSwgbWF4ID0gbWF0aC5jZWlsKHBvcy54ICsgcil9CiAgICAgICAgbG9jYWwgeSA9IHttaW4gPSBtYXRoLmNlaWwocG9zLnkgLSByKSwgbWF4ID0gbWF0aC5jZWlsKHBvcy55ICsgcil9CiAgICAgICAgbG9jYWwgeiA9IHttaW4gPSBtYXRoLmNlaWwocG9zLnogLSByKSwgbWF4ID0gbWF0aC5jZWlsKHBvcy56ICsgcil9CgogICAgICAgIGZvciBpID0gMSAsIDE1IGRvCiAgICAgICAgICAgIEZJUkUuQUREX0VYUExPU0lPTihtYXRoLnJhbmRvbSh4Lm1pbiwgeC5tYXgpLCBtYXRoLnJhbmRvbSh5Lm1pbiwgeS5tYXgpLCBtYXRoLnJhbmRvbSh6Lm1pbiwgei5tYXgpLCAyLCAxLjAsIHRydWUsIGZhbHNlLCAwLCBmYWxzZSkKICAgICAgICBlbmQKICAgICAgICAtLVtbIC0t6L295YW35q2m5Zmo5Y+N5bqUCiAgICAgICAgbG9jYWwgd3BuX3B0ciA9IG1lbW9yeS5hbGxvY19pbnQoKQogICAgICAgIGlmIFBFRC5JU19QRURfSU5fQU5ZX1ZFSElDTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgYW5kIFdFQVBPTi5HRVRfQ1VSUkVOVF9QRURfVkVISUNMRV9XRUFQT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgd3BuX3B0cikgdGhlbgogICAgICAgICAgICBXRUFQT04uU0VUX0NVUlJFTlRfUEVEX1dFQVBPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBtZW1vcnkucmVhZF9pbnQod3BuX3B0ciksIHRydWUpCiAgICAgICAgICAgIC0tdXRpbC50b2FzdChtZW1vcnkucmVhZF9pbnQod3BuX3B0cikpCiAgICAgICAgZW5kIF1dCiAgICBlbmQKZW5kCgotLS0tCmZ1bmN0aW9uIGNsdXN0ZXJfc2hvdGd1bigpCiAgICBsb2NhbCBwb3MgPSB2My5uZXcoKQogICAgaWYgV0VBUE9OLkdFVF9QRURfTEFTVF9XRUFQT05fSU1QQUNUX0NPT1JEKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHBvcykgdGhlbgogICAgICAgIGxvY2FsIGhhc2ggPSB1dGlsLmpvYWF0KCJ3ZWFwb25faG9taW5nbGF1bmNoZXIiKQogICAgICAgIHJlcXVlc3Rfd2VhcG9uX2Fzc2V0KGhhc2gpCgogICAgICAgIGZvciBpID0gMSwgNDAgZG8KICAgICAgICAgICAgTUlTQy5TSE9PVF9TSU5HTEVfQlVMTEVUX0JFVFdFRU5fQ09PUkRTKHBvcy54IAogICAgICAgICAgICArIG1hdGgucmFuZG9tKC0xMCwgMTApLCBwb3MueSAKICAgICAgICAgICAgKyBtYXRoLnJhbmRvbSgtMTAsIDEwKSwgcG9zLnogKyAzNS4wCiAgICAgICAgICAgICsgbWF0aC5yYW5kb20oLTEwLCAxMCksIHBvcy54CiAgICAgICAgICAgICsgbWF0aC5yYW5kb20oLTEwLCAxMCksIHBvcy55CiAgICAgICAgICAgICsgbWF0aC5yYW5kb20oLTEwLCAxMCksIHBvcy56CiAgICAgICAgICAgICsgbWF0aC5yYW5kb20oLTEwLCAxMCksIDAsCiAgICAgICAgICAgIHRydWUsIGhhc2gsIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUsIGZhbHNlLCAwKQogICAgICAgICAgICB1dGlsLnlpZWxkKDUwKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKCi0tLS3nu7PntKLmnqoKZnVuY3Rpb24gcm9wZV9ndW4oKQogICAgLS3lrprkuYnlsYDpg6gKICAgIGxvY2FsIGVudGl0eV9jb29yZHMxO2xvY2FsIGVudGl0eV9jb29yZHMyCiAgICBsb2NhbCBtX3JvcGVfZ3VuX2VudGl0aWVzMTtsb2NhbCBtX3JvcGVfZ3VuX2VudGl0aWVzMgoKICAgIC0t6I635Y+W56ys5LiA5Liq5a6e5L2TCiAgICB1dGlsLnRvYXN0KCLnrYnlvoXojrflj5bnrKzkuIDkuKrlrp7kvZMiKQogICAgd2hpbGUgbm90IEVOVElUWS5ET0VTX0VOVElUWV9FWElTVChtX3JvcGVfZ3VuX2VudGl0aWVzMSkgZG8KICAgICAgICBpZiBQRUQuSVNfUEVEX1NIT09USU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpIHRoZW4KICAgICAgICAgICAgbV9yb3BlX2d1bl9lbnRpdGllczEgPSBnZXRfZW50aXR5X3BsYXllcl9pc19haW1pbmdfYXQoUExBWUVSLlBMQVlFUl9JRCgpKQogICAgICAgIGVuZAogICAgICAgIHV0aWwueWllbGQoKQogICAgZW5kCiAgICBpZiBFTlRJVFkuRE9FU19FTlRJVFlfRVhJU1QobV9yb3BlX2d1bl9lbnRpdGllczEpIHRoZW4KICAgICAgICByZXF1ZXN0X2NvbnRyb2wobV9yb3BlX2d1bl9lbnRpdGllczEsIDMpCiAgICAgICAgZW50aXR5X2Nvb3JkczEgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMobV9yb3BlX2d1bl9lbnRpdGllczEsIGZhbHNlKQogICAgICAgIGxvY2FsIGVudG5hbWUgPSAi5a6e5L2TMTogIiAuLiB1dGlsLnJldmVyc2Vfam9hYXQoRU5USVRZLkdFVF9FTlRJVFlfTU9ERUwobV9yb3BlX2d1bl9lbnRpdGllczEpKQogICAgICAgIHV0aWwudG9hc3QoZW50bmFtZSkKICAgIGVuZAoKICAgIHV0aWwueWllbGQoKQoKICAgIC0t6I635Y+W56ys5LqM5Liq5a6e5L2TCiAgICB1dGlsLnRvYXN0KCLnrYnlvoXojrflj5bnrKzkuozkuKrlrp7kvZMiKQogICAgd2hpbGUgbm90IEVOVElUWS5ET0VTX0VOVElUWV9FWElTVChtX3JvcGVfZ3VuX2VudGl0aWVzMikgb3IgbV9yb3BlX2d1bl9lbnRpdGllczEgPT0gbV9yb3BlX2d1bl9lbnRpdGllczIgZG8KICAgICAgICBpZiBQRUQuSVNfUEVEX1NIT09USU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpIHRoZW4KICAgICAgICAgICAgbV9yb3BlX2d1bl9lbnRpdGllczIgPSBnZXRfZW50aXR5X3BsYXllcl9pc19haW1pbmdfYXQoUExBWUVSLlBMQVlFUl9JRCgpKQogICAgICAgIGVuZAogICAgICAgIHV0aWwueWllbGQoKQogICAgZW5kCiAgICBpZiBFTlRJVFkuRE9FU19FTlRJVFlfRVhJU1QobV9yb3BlX2d1bl9lbnRpdGllczIpIHRoZW4KICAgICAgICByZXF1ZXN0X2NvbnRyb2wobV9yb3BlX2d1bl9lbnRpdGllczIsIDMpCiAgICAgICAgZW50aXR5X2Nvb3JkczIgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMobV9yb3BlX2d1bl9lbnRpdGllczIsIGZhbHNlKQogICAgICAgIGxvY2FsIGVudG5hbWUgPSAi5a6e5L2TMjogIiAuLiB1dGlsLnJldmVyc2Vfam9hYXQoRU5USVRZLkdFVF9FTlRJVFlfTU9ERUwobV9yb3BlX2d1bl9lbnRpdGllczIpKQogICAgICAgIHV0aWwudG9hc3QoZW50bmFtZSkKICAgIGVuZAoKICAgIC0t5Yib5bu657uz5a2QICYmIOi/nuaOpee7s+WtkAogICAgbG9jYWwgcm9wZV9sZW5ndGggPSBHZXRfZGlzdGFuY2UoZW50aXR5X2Nvb3JkczEsIGVudGl0eV9jb29yZHMyLCB0cnVlKQogICAgbG9jYWwgbV9yb3BlX2d1bl9vYmplY3QgPSBQSFlTSUNTLkFERF9ST1BFKGVudGl0eV9jb29yZHMxLngsIGVudGl0eV9jb29yZHMxLnksIGVudGl0eV9jb29yZHMxLnosIDAsIDAsIDAsIHJvcGVfbGVuZ3RoLCA0LCByb3BlX2xlbmd0aCwgMC41LCAwLjUsIGZhbHNlLCBmYWxzZSwgdHJ1ZSwgMSwgZmFsc2UsIDApCiAgICBQSFlTSUNTLlJPUEVfTE9BRF9URVhUVVJFUygpCiAgICBQSFlTSUNTLkFDVElWQVRFX1BIWVNJQ1MobV9yb3BlX2d1bl9vYmplY3QpCiAgICAgICAgCiAgICBQSFlTSUNTLkFUVEFDSF9FTlRJVElFU19UT19ST1BFKG1fcm9wZV9ndW5fb2JqZWN0LCBtX3JvcGVfZ3VuX2VudGl0aWVzMSwgbV9yb3BlX2d1bl9lbnRpdGllczIsIGVudGl0eV9jb29yZHMxLngsIGVudGl0eV9jb29yZHMxLnksIGVudGl0eV9jb29yZHMxLnosIGVudGl0eV9jb29yZHMyLngsIGVudGl0eV9jb29yZHMyLnksIGVudGl0eV9jb29yZHMyLnosIHJvcGVfbGVuZ3RoLCBmYWxzZSwgZmFsc2UsIDAsIDApIAogICAgUEhZU0lDUy5QSU5fUk9QRV9WRVJURVgobV9yb3BlX2d1bl9vYmplY3QsIFBIWVNJQ1MuR0VUX1JPUEVfVkVSVEVYX0NPVU5UKG1fcm9wZV9ndW5fb2JqZWN0KSAtIDEsIGVudGl0eV9jb29yZHMyLngsIGVudGl0eV9jb29yZHMyLnksIGVudGl0eV9jb29yZHMyLnopCmVuZAoKLS0tLeWQuOmZhOaeqgpmdW5jdGlvbiBBZHNvcnB0aW9uX2d1bigpCiAgICBpZiBQRUQuSVNfUEVEX1NIT09USU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpIHRoZW4KICAgICAgICBsb2NhbCBlbnQgPSBnZXRfZW50aXR5X3BsYXllcl9pc19haW1pbmdfYXQoUExBWUVSLlBMQVlFUl9JRCgpKQogICAgICAgIHV0aWwueWllbGQoKQogICAgICAgIHdoaWxlIEVOVElUWS5ET0VTX0VOVElUWV9FWElTVChlbnQpIGFuZCBQTEFZRVIuSVNfUExBWUVSX0ZSRUVfQUlNSU5HKFBMQVlFUi5QTEFZRVJfSUQoKSkgYW5kIEVOVElUWS5JU19FTlRJVFlfQV9WRUhJQ0xFKGVudCkgZG8KICAgICAgICAgICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKQogICAgICAgICAgICBsb2NhbCByb3QgPSBDQU0uR0VUX0dBTUVQTEFZX0NBTV9ST1QoKQogICAgICAgICAgICBsb2NhbCBjb29yZHMgPSBnZXRfb2Zmc2V0X2Zyb21fY2FtZXJhKDEwLjApCgogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFNfTk9fT0ZGU0VUKGVudCwgY29vcmRzLngsIGNvb3Jkcy55LCBjb29yZHMueiwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04oZW50LCByb3QueCwgcm90LnksIHJvdC56LCAwKQoKICAgICAgICAgICAgaWYgUEVELklTX1BFRF9TSE9PVElORyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSB0aGVuCiAgICAgICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9ST1RBVElPTihlbnQsIHJvdC54LCByb3QueSwgcm90LnosIDApCiAgICAgICAgICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0ZPUldBUkRfU1BFRUQoZW50LCAxMDAwMDApCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHV0aWwueWllbGQoKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKLS0tLeW0lOS9m+eahOi9pgpmdW5jdGlvbiB0cmV2b3JfY2FyKCkKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgIGxvY2FsIHZlaCA9IGNyZWF0ZV92ZWhpY2xlKC0xNDM1OTE5NDM0LCBwb3MueCwgcG9zLnksIHBvcy56LCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpKQogICAgbG9jYWwgdmVoYXR0ID0gY3JlYXRlX3ZlaGljbGUoLTE0MzU5MTk0MzQsIHBvcy54LCBwb3MueSwgcG9zLnosIEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkpCiAgICBFTlRJVFkuU0VUX0VOVElUWV9WSVNJQkxFKHZlaCwgZmFsc2UsIGZhbHNlKQogICAgRU5USVRZLlNFVF9FTlRJVFlfQUxQSEEodmVoLCAwLCBmYWxzZSkKICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWSh2ZWhhdHQsIHZlaCwgMCwgMCwgLTAuNSwgMSwgLTEwLCAxODAsIDAsIHRydWUsIGZhbHNlLCBmYWxzZSwgdHJ1ZSwgMCwgdHJ1ZSwgMCkKICAgIFBFRC5TRVRfUEVEX0lOVE9fVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB2ZWgsIC0xKQplbmQKCi0tLS3lva3ni5fmo7rmnZAKZnVuY3Rpb24gRnJpZXphX2NvZmZpbigpCiAgICBsb2NhbCBoYXNoLCBwZWRoYXNoID0gMHhGMThCRDY0LCAweDJGNEU1QzdCCiAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMCwgNCwgMCkKICAgIGxvY2FsIG9iaiA9IGNyZWF0ZV9vYmplY3QoaGFzaCwgcG9zLngsIHBvcy55LCBwb3MueikKICAgIGxvY2FsIHBlZCA9IGNyZWF0ZV9wZWQoNCwgcGVkaGFzaCwgcG9zLngrMSwgcG9zLnkrMSwgcG9zLnosIDE4MC4wKQogICAgV0VBUE9OLkdJVkVfREVMQVlFRF9XRUFQT05fVE9fUEVEKHBlZCwgMHg5RDA3Rjc2NCwgNSwgdHJ1ZSkKICAgIFRBU0suVEFTS19TSE9PVF9BVF9FTlRJVFkocGVkICwgb2JqLCA1MDAwLCAweEM2RUU2QjRDKQogICAgbG9jYWwgZW5kdGltZSA9IG9zLnRpbWUoKSArIDcKICAgIHdoaWxlIGVuZHRpbWUgPiBvcy50aW1lKCkgZG8KICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAogICAgZGVsZXRlX2VudGl0eShvYmosIHBlZCkKZW5kCgotLS0t5oao6LGG55qE6L2mCmxvY2FsIEJlYW5fdGJsID17fQpmdW5jdGlvbiBCZWFuX2Z1bih0b2dnbGVkKQogICAgQmVhbl90YmwudG9nZ2xlZCA9IHRvZ2dsZWQKICAgIGlmIHRvZ2dsZWQgdGhlbgogICAgICAgIGxvY2FsIHZlaGhzYWggPSA5MzEyODA2MDkgLS3ovb3lhbdoYXNoCiAgICAgICAgbG9jYWwgY2hhaXJoYXNoID0gNjA0NTUzNjQzICAtLeakheWtkGhhc2gKICAgICAgICBsb2NhbCBmbGFnaGFzaCA9IHV0aWwuam9hYXQoImluZF9wcm9wX2RsY19mbGFnXzAxIikgLS3ml5flrZAKICAgICAgICBsb2NhbCBhbmltR3JvdXAgPSAidGltZXRhYmxlQHJldW5pdGVkQGlnXzEwIiAKICAgICAgICBsb2NhbCBhbmltTmFtZSA9ICJiYXNlX2FtYW5kYSIKCiAgICAgICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKQogICAgICAgIEJlYW5fdGJsLnZlaCA9IGNyZWF0ZV92ZWhpY2xlKHZlaGhzYWgsIHBvcy54LCBwb3MueSwgcG9zLnosIEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkpCiAgICAgICAgQmVhbl90YmwuY2hhaXIgPSBjcmVhdGVfb2JqZWN0KGNoYWlyaGFzaCwgcG9zLngsIHBvcy55LCBwb3MueikKICAgICAgICBCZWFuX3RibC5mbGFnID0gY3JlYXRlX29iamVjdChmbGFnaGFzaCwgcG9zLngsIHBvcy55LCBwb3MueikKCiAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9NT0QoQmVhbl90YmwudmVoLCA3LCAyLCB0cnVlKQogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfTlVNQkVSX1BMQVRFX1RFWFQoQmVhbl90YmwudmVoLCAiU0xXIDI4N1IiKQogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfQ1VTVE9NX1BSSU1BUllfQ09MT1VSKEJlYW5fdGJsLnZlaCwgMjU1LCAyNTUsIDUwKQogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfQ1VTVE9NX1NFQ09OREFSWV9DT0xPVVIoQmVhbl90YmwudmVoLCAyNTUsIDI1NSwgNTApCgogICAgICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWShCZWFuX3RibC5jaGFpciwgQmVhbl90YmwudmVoLCAwLCAwLCAtMC41LCAxLjUzLCAwLCAwLCAxODAsIGZhbHNlLCB0cnVlLCBmYWxzZSwgdHJ1ZSwgMSwgdHJ1ZSkKICAgICAgICBFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkoQmVhbl90YmwuZmxhZywgQmVhbl90YmwuY2hhaXIsIDAsIC0wLjQsIDAsIDAsIDAsIDAsIDAsIGZhbHNlLCB0cnVlLCBmYWxzZSwgdHJ1ZSwgMSwgdHJ1ZSkKCiAgICAgICAgQmVhbl90YmwucGVkID0gUEVELkNMT05FX1BFRChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlLCBmYWxzZSwgdHJ1ZSkKICAgICAgICBjYWxtX3BlZChCZWFuX3RibC5wZWQsIHRydWUpCiAgICAgICAgUEVELlNFVF9QRURfSU5UT19WRUhJQ0xFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIEJlYW5fdGJsLnZlaCwgLTEpCgogICAgICAgIGxvY2FsIGJvbmVJbmRleCA9IFBFRC5HRVRfUEVEX0JPTkVfSU5ERVgoQmVhbl90YmwucGVkLCA2NDcyOSkKICAgICAgICBFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkoQmVhbl90YmwucGVkLCBCZWFuX3RibC5jaGFpciwgMCwgLTAuMiwgLTAuOCwgMC41LCAwLCAwLCAxODAsIGZhbHNlLCB0cnVlLCBmYWxzZSwgdHJ1ZSwgMSwgdHJ1ZSkKCiAgICAgICAgd2hpbGUgQmVhbl90YmwudG9nZ2xlZCBkbwogICAgICAgICAgICBpZiBub3QgRU5USVRZLklTX0VOVElUWV9QTEFZSU5HX0FOSU0oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgYW5pbUdyb3VwLCBhbmltTmFtZSwgMykgdGhlbgogICAgICAgICAgICAgICAgcGxheV9hbmltYXRpb24oQmVhbl90YmwucGVkLCBhbmltR3JvdXAsIGFuaW1OYW1lLCA1LjAsIDUuMCwgLTEsIDEsIDAuMCkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBQRUQuSVNfUEVEX0lOX1ZFSElDTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgQmVhbl90YmwudmVoLCBmYWxzZSkgdGhlbgogICAgICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRShCZWFuX3RibC52ZWgsdHJ1ZSkKICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0lOVklOQ0lCTEUoQmVhbl90YmwuY2hhaXIsdHJ1ZSkKICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0lOVklOQ0lCTEUoQmVhbl90YmwuZmxhZyx0cnVlKQogICAgICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRShCZWFuX3RibC5wZWQsdHJ1ZSkKICAgIAogICAgICAgICAgICAgICAgTkVUV09SSy5TRVRfRU5USVRZX0xPQ0FMTFlfSU5WSVNJQkxFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICAgICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9WSVNJQkxFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfVklTSUJMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlLCBmYWxzZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHV0aWwueWllbGQoKQogICAgICAgIGVuZAogICAgZWxzZQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1ZJU0lCTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSwgZmFsc2UpCiAgICAgICAgZGVsZXRlX2VudGl0eShCZWFuX3RibC52ZWgsQmVhbl90YmwuY2hhaXIsQmVhbl90YmwuZmxhZyxCZWFuX3RibC5wZWQpCiAgICBlbmQKZW5kCgotLS0t55CD5b2i5YyW5pyvCmxvY2FsIGJlY29tZV9iYWxsT2JqCmZ1bmN0aW9uIGJlY29tZV9iYWxsKHRvZ2dsZWQpCiAgICBiZWNvbWVfYmFsbF90b2dnbGVkID0gdG9nZ2xlZAogICAgd2hpbGUgYmVjb21lX2JhbGxfdG9nZ2xlZCBkbwogICAgICAgIGxvY2FsIGJhbGxNZGwgPSB1dGlsLmpvYWF0KCJzdHRfcHJvcF9zdHVudF9zb2NjZXJfc2JhbGwiKQogICAgICAgIHJlcXVlc3RfbW9kZWwoYmFsbE1kbCkKICAgICAgICBpZiBub3QgUEVELklTX1BFRF9JTl9BTllfVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSB0aGVuCiAgICAgICAgICAgIGlmIG5vdCBFTlRJVFkuRE9FU19FTlRJVFlfRVhJU1QoYmVjb21lX2JhbGxPYmopIHRoZW4KICAgICAgICAgICAgICAgIGJlY29tZV9iYWxsT2JqID0gZW50aXRpZXMuY3JlYXRlX29iamVjdChiYWxsTWRsLCBwbGF5ZXJzLmdldF9wb3NpdGlvbihwbGF5ZXJzLnVzZXIoKSkpCiAgICAgICAgICAgICAgICBUQVNLLkNMRUFSX1BFRF9UQVNLU19JTU1FRElBVEVMWShQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgICAgICAgICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGJlY29tZV9iYWxsT2JqLCAwLCAwLjAsIDAuMCwgMC4wLCAwLjAsIDAuMCwgMC4wLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgMCwgdHJ1ZSwgZmFsc2UpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgQ0FNLlNFVF9HQU1FUExBWV9DQU1fSUdOT1JFX0VOVElUWV9DT0xMSVNJT05fVEhJU19VUERBVEUoYmVjb21lX2JhbGxPYmopCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1ZJU0lCTEUoYmVjb21lX2JhbGxPYmosIHRydWUpCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBjYW1Sb3QgPSBDQU0uR0VUX0dBTUVQTEFZX0NBTV9ST1QoMikKICAgICAgICAgICAgbG9jYWwgY2FtSGVhZGluZ0RpcmVjdGlvbiA9IC1jYW1Sb3QueiAvIDE4MCAqIG1hdGgucGkKICAgICAgICAgICAgbG9jYWwgY2FtSGVhZGluZ1NpZGUgPSBjYW1IZWFkaW5nRGlyZWN0aW9uICsgbWF0aC5waSAvIDIKICAgICAgICAgICAgbG9jYWwgbW92ZURpcmVjdGlvbiA9IHYzKG1hdGguc2luKGNhbUhlYWRpbmdEaXJlY3Rpb24pLCBtYXRoLmNvcyhjYW1IZWFkaW5nRGlyZWN0aW9uKSwgMCkKCiAgICAgICAgICAgIC0t5YmN5ZCOCiAgICAgICAgICAgIGxvY2FsIGZvcmNlID0gLSBQQUQuR0VUX0NPTlRST0xfTk9STUFMKDIsIDMxKSAvIDIuMAogICAgICAgICAgICBtb3ZlRGlyZWN0aW9uOm11bChmb3JjZSkKCiAgICAgICAgICAgIC0t5bem5Y+zCiAgICAgICAgICAgIGxvY2FsIGlucHV0U2lkZSA9IFBBRC5HRVRfQ09OVFJPTF9OT1JNQUwoMiwgMzApIC8gMi4wCiAgICAgICAgICAgIGxvY2FsIG1vdmVTaWRlID0gdjMobWF0aC5zaW4oY2FtSGVhZGluZ1NpZGUpLCBtYXRoLmNvcyhjYW1IZWFkaW5nU2lkZSksIDApCiAgICAgICAgICAgIG1vdmVTaWRlOm11bChpbnB1dFNpZGUpCiAgICAgICAgICAgIG1vdmVEaXJlY3Rpb246YWRkKG1vdmVTaWRlKQoKICAgICAgICAgICAgLS3kuIrkuIsKICAgICAgICAgICAgbG9jYWwgbW92ZUFsdGl0dWRlID0gUEFELklTX0NPTlRST0xfUFJFU1NFRCgwLCAxMDIpIGFuZCAxLjAgb3IgKFBBRC5JU19DT05UUk9MX1BSRVNTRUQoMCwgMzYpIGFuZCAtMS4wIG9yIChFTlRJVFkuSVNfRU5USVRZX0lOX1dBVEVSKGJlY29tZV9iYWxsT2JqKSBhbmQgMC4yOCBvciAwLjApKQogICAgICAgICAgICAKICAgICAgICAgICAgRU5USVRZLkFQUExZX0ZPUkNFX1RPX0VOVElUWShiZWNvbWVfYmFsbE9iaiwgMywgbW92ZURpcmVjdGlvbi54LG1vdmVEaXJlY3Rpb24ueSxtb3ZlQWx0aXR1ZGUsIDAsIDAsIDAsIDAsIGZhbHNlLCBmYWxzZSwgdHJ1ZSwgZmFsc2UsIHRydWUpCiAgICAgICAgZW5kCiAgICAgICAgdXRpbC55aWVsZCgpCiAgICBlbmQKICAgIGRlbGV0ZV9lbnRpdHkoYmVjb21lX2JhbGxPYmopCiAgICAtLVRBU0suQ0xFQVJfUEVEX1RBU0tTX0lNTUVESUFURUxZKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICBFTlRJVFkuU0VUX0VOVElUWV9WSVNJQkxFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUpCmVuZAoKLS0tLeaImOaWl+mZgOieugpmdW5jdGlvbiBCZXlibGFkZSh0b2dnbGVkKQogICAgQmV5YmxhZGVfdG9nZ2xlID0gdG9nZ2xlZAogICAgbG9jYWwgZXhwbF9iZXlibGFkZV9yb3RhdGlvbiA9IDAKICAgIHdoaWxlIEJleWJsYWRlX3RvZ2dsZSBkbwogICAgICAgIGlmIG5vdCBQRUQuSVNfUEVEX0lOX0FOWV9WRUhJQ0xFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpIHRoZW4KICAgICAgICAgICAgcGxheV9hbmltYXRpb24oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgIm1waF9uYXJfZmluX2V4dC0zMiIsICJtcF9tX2ZyZWVtb2RlXzAxX2R1YWwtMzIiLCA4LjAsIDguMCwgLTEsIDAsIDAuMCkKICAgICAgICAKICAgICAgICAgICAgbG9jYWwgY2FtX3JvdCA9IENBTS5HRVRfR0FNRVBMQVlfQ0FNX1JPVCgwKQogICAgICAgICAgICBsb2NhbCB5YXcgPSBtYXRoLnJhZChjYW1fcm90LnopCiAgICAgICAgICAgIGxvY2FsIGRpcmVjdGlvbnNYID0gLW1hdGguc2luKHlhdykKICAgICAgICAgICAgbG9jYWwgZGlyZWN0aW9uc1kgPSBtYXRoLmNvcyh5YXcpCgogICAgICAgICAgICBsb2NhbCB1c2VyX3JvdCA9IEVOVElUWS5HRVRfRU5USVRZX1JPVEFUSU9OKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDApCiAgICAgICAgICAgIGxvY2FsIHNwZWVkID0gRU5USVRZLkdFVF9FTlRJVFlfU1BFRUQoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgKiAyLjIzNjkzNgogICAgICAgICAgICAKICAgICAgICAgICAgbG9jYWwgb2Zmc2V0ID0ge30KICAgICAgICAgICAgb2Zmc2V0WzFdID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDAuMCwgMTAsIDAuMCkKICAgICAgICAgICAgb2Zmc2V0WzJdID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDAuMCwgLTEwLCAwLjApCgogICAgICAgICAgICBQRUQuU0VUX1BFRF9DQU5fUkFHRE9MTChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdXNlcl9yb3QueCwgdXNlcl9yb3QueSwgZXhwbF9iZXlibGFkZV9yb3RhdGlvbiwgMiwgdHJ1ZSkKICAgICAgICAgICAgZm9yIGkgPSAxLCAyIGRvCiAgICAgICAgICAgICAgICBGSVJFLkFERF9FWFBMT1NJT04ob2Zmc2V0W2ldLngsIG9mZnNldFtpXS55LCBvZmZzZXRbaV0ueiwgMTgsIDEsIGZhbHNlLCBmYWxzZSwgMC4wLCBmYWxzZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIHNwZWVkIDw9IDUwIGFuZCBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsMzIpIHRoZW4KICAgICAgICAgICAgICAgIEVOVElUWS5BUFBMWV9GT1JDRV9UT19FTlRJVFkoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMywgZGlyZWN0aW9uc1gsIGRpcmVjdGlvbnNZLCAwLjAsIDAuMCwgMC4wLCAwLjAsIDAuMCwgZmFsc2UsIGZhbHNlLCB0cnVlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBleHBsX2JleWJsYWRlX3JvdGF0aW9uID0gZXhwbF9iZXlibGFkZV9yb3RhdGlvbiArIDE1CiAgICAgICAgZW5kCiAgICAgICAgdXRpbC55aWVsZCgpCiAgICBlbmQKICAgIFBFRC5TRVRfUEVEX0NBTl9SQUdET0xMKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUpCiAgICBUQVNLLlNUT1BfQU5JTV9UQVNLKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksICJtcGhfbmFyX2Zpbl9leHQtMzIiLCAibXBfbV9mcmVlbW9kZV8wMV9kdWFsLTMyIiwgMSkKZW5kCgotLS0t6aOe6KGM5panCmxvY2FsIGVudGl0eV9heGUKbG9jYWwgZ2V0X2Fyb3VuZF9wb3NpdGlvbl9pdGVyYXRvciA9IDAgIApmdW5jdGlvbiBnZXRfYXJvdW5kX3Bvc2l0aW9uKGVudCwgZmFyX2Rpc3RhbmNlLCB1cF9kb3duX2Rpc3RhbmNlKQogICAgbG9jYWwgYW5nbGVJbmNyZW1lbnQgPSA0NS4wCiAgICBsb2NhbCBhbmdsZSA9IGdldF9hcm91bmRfcG9zaXRpb25faXRlcmF0b3IgKiBhbmdsZUluY3JlbWVudDsKICAgIGdldF9hcm91bmRfcG9zaXRpb25faXRlcmF0b3IgPSAoZ2V0X2Fyb3VuZF9wb3NpdGlvbl9pdGVyYXRvciArIDEpICUgOAoKICAgIGxvY2FsIGFuZ2xlSW5SYWRpYW5zID0gYW5nbGUgKiAobWF0aC5waSAvIDE4MC4wKQogICAgbG9jYWwgeCA9IGZhcl9kaXN0YW5jZSAqIG1hdGguY29zKGFuZ2xlSW5SYWRpYW5zKTsKICAgIGxvY2FsIHkgPSBmYXJfZGlzdGFuY2UgKiBtYXRoLnNpbihhbmdsZUluUmFkaWFucyk7CgogICAgcmV0dXJuIEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhlbnQsIHgsIHksIDAuMCArIHVwX2Rvd25fZGlzdGFuY2UpCmVuZApmdW5jdGlvbiBsZXJwKGEsIGIsIHQpCiAgICByZXR1cm4gYSArIHQgKiAoYiAtIGEpOwplbmQKZnVuY3Rpb24gZ2V0X2VudGl0eV9oaWdoZXN0X2Nvb3JkKGVudCkKICAgIGxvY2FsIGhpZ2hlc3RfY29vcmQgPSBuaWwKICAgIGxvY2FsIGhpZ2hlc3QgPSAwCiAgICAKICAgIHdoaWxlIHRydWUgZG8KICAgICAgICBsb2NhbCBjb29yZHMgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoZW50LCBmYWxzZSkKICAgICAgICBpZiBjb29yZHMueiA+IGhpZ2hlc3QgdGhlbgogICAgICAgICAgICBoaWdoZXN0ID0gY29vcmRzLnoKICAgICAgICAgICAgaGlnaGVzdF9jb29yZCA9IGNvb3JkcwogICAgICAgIGVsc2UKICAgICAgICAgICAgaWYgaGlnaGVzdF9jb29yZCB+PSBuaWwgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIGhpZ2hlc3RfY29vcmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICAgICAgdXRpbC55aWVsZCgpCiAgICBlbmQKICAgIHJldHVybiAwCmVuZApmdW5jdGlvbiBmbHlpbmdfYXhlKHRvZ2dsZWQpCiAgICBmbHlpbmdfYXhlX3RvZ2dsZWQgPSB0b2dnbGVkCiAgICBpZiBmbHlpbmdfYXhlX3RvZ2dsZWQgdGhlbgogICAgICAgIFdFQVBPTi5HSVZFX1dFQVBPTl9UT19QRUQoUExBWUVSLkdFVF9QTEFZRVJfUEVEX1NDUklQVF9JTkRFWChQTEFZRVIuUExBWUVSX0lEKCkpLC0xNTY5NjE1MjYxLDE1LHRydWUsdHJ1ZSktLee7meS6iOW+kuaJiwogICAgICAgIFBFRC5TRVRfUEVEX0NBTl9TV0lUQ0hfV0VBUE9OKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksZmFsc2UpLS3npoHmraLliIfmjaLmrablmagKICAgIGVuZAogICAgbG9jYWwgbXlwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpCiAgICBsb2NhbCBheGVfZmx5aW5nX2Nvb3JkcyA9IHZlY3RvcjMubmV3KG15cG9zLngrbWF0aC5yYW5kb20oMzAsNDApLG15cG9zLnkrbWF0aC5yYW5kb20oMzAsNDApLG15cG9zLnorbWF0aC5yYW5kb20oMjAsMzApKQogICAgd2hpbGUgZmx5aW5nX2F4ZV90b2dnbGVkIGRvCiAgICAgICAgZGlzYWJsZV9jb250cm9sX2FjdGlvbigyNCwgMjUsIDQ2KQoKICAgICAgICBpZiBub3QgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKGVudGl0eV9heGUpIHRoZW4KICAgICAgICAgICAgbG9jYWwgY29vcmRpbmF0ZXMgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMCwgMCwgNi41KQogICAgICAgICAgICBsb2NhbCBheGVfbW9kZWwgPSB1dGlsLmpvYWF0KCJwcm9wX2xkX2ZpcmVheGUiKQogICAgICAgICAgICAKICAgICAgICAgICAgZW50aXR5X2F4ZSA9IGNyZWF0ZV9vYmplY3QoYXhlX21vZGVsLGNvb3JkaW5hdGVzLngsY29vcmRpbmF0ZXMueSxjb29yZGluYXRlcy56KQogICAgICAgICAgICBsb2NhbCBheGVfbmV0X2lkID0gTkVUV09SSy5PQkpfVE9fTkVUKGVudGl0eV9heGUpCiAgICAgICAgICAgIE5FVFdPUksuTkVUV09SS19SRUdJU1RFUl9FTlRJVFlfQVNfTkVUV09SS0VEKGVudGl0eV9heGUpOwogICAgICAgICAgICBORVRXT1JLLlNFVF9ORVRXT1JLX0lEX0VYSVNUU19PTl9BTExfTUFDSElORVMoYXhlX25ldF9pZCwgdHJ1ZSkKCiAgICAgICAgICAgIGxvY2FsIGJsaXAgPSBIVUQuQUREX0JMSVBfRk9SX0VOVElUWShlbnRpdHlfYXhlKQogICAgICAgICAgICBIVUQuU0VUX0JMSVBfRElTUExBWShibGlwLCA4KQogICAgICAgICAgICBIVUQuU0VUX0JMSVBfU1BSSVRFKGJsaXAsIDE1NCkKICAgICAgICAgICAgSFVELlNFVF9CTElQX0NPTE9VUihibGlwLCAzOCkKICAgICAgICBlbHNlCiAgICAgICAgICAgIGlmIHRpbWVyLmVsYXBzZWQoKSA+IDMwMCB0aGVuCgogICAgICAgICAgICAgICAgLS0tLeaViOaenAogICAgICAgICAgICAgICAgcmVxdWVzdF9wdGZ4X2Fzc2V0KCJzY3JfcG93ZXJwbGF5IikKICAgICAgICAgICAgICAgIEdSQVBISUNTLlNUQVJUX1BBUlRJQ0xFX0ZYX05PTl9MT09QRURfT05fRU5USVRZX0JPTkUoInNwX3Bvd2VycGxheV9iZWFzdF9hcHBlYXJfdHJhaWxzIiwgZW50aXR5X2F4ZSwgMCwgMCwgMCwgMCwgMCwgMC4wLCAwLCAwLjUsIHRydWUsIHRydWUsIHRydWUpCiAgICAgICAgICAgICAgICByZXF1ZXN0X3B0ZnhfYXNzZXQoInNjcl9wYWxldG9zY29yZSIpCiAgICAgICAgICAgICAgICBHUkFQSElDUy5TVEFSVF9ORVRXT1JLRURfUEFSVElDTEVfRlhfTk9OX0xPT1BFRF9PTl9FTlRJVFkoInNjcl9wYWxldG9fYm94X3NwYXJrcyIsIGVudGl0eV9heGUsIDAsIDAsIDAsIDAsIDAsIDAuMCwgMC4xLCB0cnVlLCB0cnVlLCB0cnVlKQogICAgICAgICAgICAgICAgLS3np7vpmaTngavnhLAKICAgICAgICAgICAgICAgIEZJUkUuU1RPUF9FTlRJVFlfRklSRShlbnRpdHlfYXhlKQoKICAgICAgICAgICAgICAgIC0t5Zu057uV5peL6L2sCiAgICAgICAgICAgICAgICBpZiBub3QgRU5USVRZLklTX0VOVElUWV9BVFRBQ0hFRChlbnRpdHlfYXhlKSB0aGVuIC0t5aSE5LqO6Zey572u54q25oCBCiAgICAgICAgICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfTk9fQ09MTElTSU9OX0VOVElUWShlbnRpdHlfYXhlLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIG5ld19heGVfZmx5aW5nX2Nvb3JkcyA9IGdldF9hcm91bmRfcG9zaXRpb24oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMjAsIDUpCgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGZhY3RvciA9IDAuOAogICAgICAgICAgICAgICAgICAgIGF4ZV9mbHlpbmdfY29vcmRzLnggPSBsZXJwKGF4ZV9mbHlpbmdfY29vcmRzLngsIG5ld19heGVfZmx5aW5nX2Nvb3Jkcy54LCBmYWN0b3IpCiAgICAgICAgICAgICAgICAgICAgYXhlX2ZseWluZ19jb29yZHMueSA9IGxlcnAoYXhlX2ZseWluZ19jb29yZHMueSwgbmV3X2F4ZV9mbHlpbmdfY29vcmRzLnksIGZhY3RvcikKICAgICAgICAgICAgICAgICAgICBheGVfZmx5aW5nX2Nvb3Jkcy56ID0gbGVycChheGVfZmx5aW5nX2Nvb3Jkcy56LCBuZXdfYXhlX2ZseWluZ19jb29yZHMueiwgZmFjdG9yKQoKICAgICAgICAgICAgICAgICAgICBsb2NhbCBheGVfY29vcmRzICAgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoZW50aXR5X2F4ZSwgMCk7CiAgICAgICAgICAgICAgICAgICAgbG9jYWwgcm90ID0gRU5USVRZLkdFVF9FTlRJVFlfUk9UQVRJT04oZW50aXR5X2F4ZSwgMik7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgc3VidHJhY3RfY29vcmRzID0gdmVjdG9yMy5zdWIoYXhlX2ZseWluZ19jb29yZHMsIGF4ZV9jb29yZHMpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgZW50X3ZlbG9jaXR5ID0gRU5USVRZLkdFVF9FTlRJVFlfVkVMT0NJVFkoZW50aXR5X2F4ZSkKCiAgICAgICAgICAgICAgICAgICAgRU5USVRZLkFQUExZX0ZPUkNFX1RPX0VOVElUWShlbnRpdHlfYXhlLCAzLAogICAgICAgICAgICAgICAgICAgICAgICAoc3VidHJhY3RfY29vcmRzLngpIC0gKCgyLjAxICsgMikgKiAwLjMgKiBlbnRfdmVsb2NpdHkueCksCiAgICAgICAgICAgICAgICAgICAgICAgIChzdWJ0cmFjdF9jb29yZHMueSkgLSAoMi4wMSAqIDAuMyAqIGVudF92ZWxvY2l0eS55KSwKICAgICAgICAgICAgICAgICAgICAgICAgKHN1YnRyYWN0X2Nvb3Jkcy56KSAtICgyLjAxICogMC4zICogZW50X3ZlbG9jaXR5LnopICsgMC4xLAogICAgICAgICAgICAgICAgICAgICAgICAwLjAsMCwwLDAsZmFsc2UsdHJ1ZSx0cnVlLGZhbHNlLHRydWUpCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICB0aW1lci5yZXNldCgpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgLS3mjIlF5Y+s5ZSk5pan5a2QCiAgICAgICAgICAgIGlmIFBBRC5JU19ESVNBQkxFRF9DT05UUk9MX1BSRVNTRUQoMCwgNDYpIGFuZCBub3QgRU5USVRZLklTX0VOVElUWV9BVFRBQ0hFRChlbnRpdHlfYXhlKSBhbmQgbm90IFBFRC5JU19QRURfSU5fQU5ZX1ZFSElDTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIGFuaW1hdGlvbl9kaWN0ICAgPSAiY292ZXJAZmlyc3RfcGVyc29uQHdlYXBvbkBncmVuYWRlIgogICAgICAgICAgICAgICAgbG9jYWwgYW5pbWF0aW9uID0gImxvd19sX3Rocm93X2xvbmciCiAgICAgICAgICAgICAgICBpZiBub3QgRU5USVRZLklTX0VOVElUWV9QTEFZSU5HX0FOSU0oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgYW5pbWF0aW9uX2RpY3QsIGFuaW1hdGlvbiwgMykgdGhlbgogICAgICAgICAgICAgICAgICAgIFNUUkVBTUlORy5SRVFVRVNUX0FOSU1fRElDVChhbmltYXRpb25fZGljdCkKICAgICAgICAgICAgICAgICAgICBpZiBTVFJFQU1JTkcuSEFTX0FOSU1fRElDVF9MT0FERUQoKGFuaW1hdGlvbl9kaWN0KSkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBUQVNLLlRBU0tfUExBWV9BTklNKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGFuaW1hdGlvbl9kaWN0LCBhbmltYXRpb24sIDguMDAsIDguMDAsIC0xLCA0OCwgMCwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgICAgICAgICAgICAgTUlTQy5GT1JDRV9MSUdIVE5JTkdfRkxBU0goKSAtLemXqueUtQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgbG9jYWwgYm9uZSA9IEVOVElUWS5HRVRfRU5USVRZX0JPTkVfSU5ERVhfQllfTkFNRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAiSUtfUl9IYW5kIikKICAgICAgICAgICAgICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWShlbnRpdHlfYXhlLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBib25lLCAwLCAtMC4wNSwgLTAuMDUsIC02MS4sIDI4LjQsIC00OC44LCBmYWxzZSwgZmFsc2UsIHRydWUsIHRydWUsIDAsIHRydWUsIDApCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgLS3nnoTlh4YKICAgICAgICAgICAgaWYgUEFELklTX0RJU0FCTEVEX0NPTlRST0xfUFJFU1NFRCgwLCAyNSkgYW5kIEVOVElUWS5JU19FTlRJVFlfQVRUQUNIRUQoZW50aXR5X2F4ZSkgYW5kIG5vdCBQRUQuSVNfUEVEX0lOX0FOWV9WRUhJQ0xFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBjYW1yb3QgPSBDQU0uR0VUX0dBTUVQTEFZX0NBTV9ST1QoMikKICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKChQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSwgY2Ftcm90LngsIGNhbXJvdC55LCBjYW1yb3QueiwgMiwgMCkKICAgICAgICAgICAgICAgIEhVRC5ESVNQTEFZX1NOSVBFUl9TQ09QRV9USElTX0ZSQU1FKCkgLS0tLeaYvuekuuWHhuaYnwoKICAgICAgICAgICAgICAgIC0t5Lii5Ye65pan5a2QCiAgICAgICAgICAgICAgICBpZiBQQUQuSVNfRElTQUJMRURfQ09OVFJPTF9QUkVTU0VEKDAsIDI0KSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcGxheV9hbmltYXRpb24oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgIndlYXBvbnNAZmlyc3RfcGVyc29uQGFpbV9ybmdAZ2VuZXJpY0Bwcm9qZWN0aWxlQGdyZW5hZGVfc3RyIiwgInRocm93X21fZmJfZm9yd2FyZCIsIDguMDAsIDguMDAsIC0xLCA0OCwgMC4wKQogICAgICAgICAgICAgICAgICAgIHV0aWwueWllbGQoMzAwKQogICAgICAgICAgICAgICAgICAgIEVOVElUWS5ERVRBQ0hfRU5USVRZKGVudGl0eV9heGUsIDAsIHRydWUpCgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGMyID0gZ2V0X29mZnNldF9mcm9tX2NhbWVyYSgxNSkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBkaXIgPSB7fQogICAgICAgICAgICAgICAgICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgICAgICAgICAgICAgICAgICBkaXIueCA9IChjMi54IC0gcG9zLngpICogMTAwMDAwCiAgICAgICAgICAgICAgICAgICAgZGlyLnkgPSAoYzIueSAtIHBvcy55KSAqIDEwMDAwMAogICAgICAgICAgICAgICAgICAgIGRpci56ID0gKGMyLnogLSBwb3MueikgKiAxMDAwMDAKICAgICAgICAgICAgICAgICAgICBFTlRJVFkuQVBQTFlfRk9SQ0VfVE9fRU5USVRZX0NFTlRFUl9PRl9NQVNTKGVudGl0eV9heGUsIDEsIGRpci54LCBkaXIueSwgZGlyLnosIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlKQoKICAgICAgICAgICAgICAgICAgICAtLVtbIHdoaWxlIG5vdCBFTlRJVFkuSEFTX0VOVElUWV9DT0xMSURFRF9XSVRIX0FOWVRISU5HKGVudGl0eV9heGUpIGFuZCBub3QgRU5USVRZLklTX0VOVElUWV9JTl9XQVRFUihlbnRpdHlfYXhlKSBkbwogICAgICAgICAgICAgICAgICAgICAgICB1dGlsLnlpZWxkKCkKICAgICAgICAgICAgICAgICAgICBlbmQgXV0KICAgICAgICAgICAgICAgICAgICB1dGlsLnlpZWxkKDgwMCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAogICAgUEVELlNFVF9QRURfQ0FOX1NXSVRDSF9XRUFQT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSktLeino+mZpOemgeatouWIh+aNouatpuWZqAogICAgZGVsZXRlX2VudGl0eShlbnRpdHlfYXhlKQplbmQKCi0tLS3npZblm73kuroKZnVuY3Rpb24gdGhlX2hvbWVsYW5kZXIodG9nZ2xlZCkKICAgIHN1cGVyX2hvbWVsYW5kZXIgPSB0b2dnbGVkCiAgICBpZiBzdXBlcl9ob21lbGFuZGVyIHRoZW4KCiAgICAgICAgLS3muJDov5vljYfpq5gKICAgICAgICBmb3IgaSA9IDEsIDEwIGRvCiAgICAgICAgICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHBvcy54LCBwb3MueSwgcG9zLnogKyAwLjUsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICB1dGlsLnlpZWxkKDEwKQogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIFRBU0suQ0xFQVJfUEVEX1RBU0tTX0lNTUVESUFURUxZKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICAgICAgcGxheV9hbmltYXRpb24oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgIm1pc3NmYW01X3lvZ2EiLCAiYzhfdG9fc3RhcnQiLCA0LCAxLCAtMSwgMiB8IDE2IHwgMzIgfCAxMzEwNzIgfCAxMDQ4NTc2LCAwLjApCiAgICAgICAgcGxheV9hbmltYXRpb24oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgInNreWRpdmVAcGFyYWNodXRlQGZpcnN0X3BlcnNvbiIsICJjaHV0ZV9pZGxlX2FsdF9sb29rcmlnaHQiLCA0LCAxLCAtMSwgMSB8IDEwNDg1NzYsIDAuMCkKCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfVkVMT0NJVFkoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMCwgMCwgMSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksdHJ1ZSkKCiAgICBlbmQKICAgIHdoaWxlIHN1cGVyX2hvbWVsYW5kZXIgZG8KICAgICAgICAtLea/gOWFieecvAogICAgICAgIGxhc2VyX2V5ZXMoKQogICAgICAgIC0t6K6+572u55u45py66KeG6KeSCiAgICAgICAgbG9jYWwgcm90ID0gQ0FNLkdFVF9HQU1FUExBWV9DQU1fUk9UKDUpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgcm90LngsIHJvdC55LCByb3QueiwgNSwgdHJ1ZSkKICAgICAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlKQogICAgICAgIC0t56e75YqoCiAgICAgICAgaWYgUEFELklTX0NPTlRST0xfUFJFU1NFRCgwLDMyKSB0aGVuLS3liY3ov5sKICAgICAgICAgICAgcG9zID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDAsIDEsIDApCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgcG9zLngsIHBvcy55LCBwb3MueiwgdHJ1ZSwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgICAgICBlbHNlaWYgUEFELklTX0NPTlRST0xfUFJFU1NFRCgwLDMzKSB0aGVuLS3lkI7pgIAKICAgICAgICAgICAgcG9zID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDAsIC0xLCAwKQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFNfTk9fT0ZGU0VUKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHBvcy54LCBwb3MueSwgcG9zLnosIHRydWUsIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpCiAgICAgICAgZW5kCiAgICAgICAgaWYgUEFELklTX0NPTlRST0xfUFJFU1NFRCgwLDM0KSB0aGVuLS3lt6YKICAgICAgICAgICAgcG9zID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIC0xLCAwLCAwKQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFNfTk9fT0ZGU0VUKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHBvcy54LCBwb3MueSwgcG9zLnosIHRydWUsIGZhbHNlLCBmYWxzZSkKICAgICAgICBlbHNlaWYgUEFELklTX0NPTlRST0xfUFJFU1NFRCgwLDM1KSB0aGVuLS3lj7MKICAgICAgICAgICAgcG9zID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDEsIDAsIDApCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgcG9zLngsIHBvcy55LCBwb3MueiwgdHJ1ZSwgZmFsc2UsIGZhbHNlKQogICAgICAgIGVuZAogICAgICAgIGlmIFBBRC5JU19DT05UUk9MX1BSRVNTRUQoMCwyMSkgdGhlbi0t5LiKCiAgICAgICAgICAgIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFNfTk9fT0ZGU0VUKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHBvc1sneCddLCBwb3NbJ3knXSwgcG9zWyd6J10rMSwgdHJ1ZSwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgICAgICBlbHNlaWYgUEFELklTX0NPTlRST0xfUFJFU1NFRCgwLDM2KSB0aGVuLS3kuIsKICAgICAgICAgICAgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgcG9zWyd4J10sIHBvc1sneSddLCBwb3NbJ3onXS0xLCB0cnVlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKQogICAgICAgIGVuZAoKCiAgICAgICAgdXRpbC55aWVsZCgpCiAgICBlbmQKCiAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgIFRBU0suQ0xFQVJfUEVEX1RBU0tTX0lNTUVESUFURUxZKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCmVuZAoKCi0tLS3mlrDlnovmu5Hmnb/ovaYKZnVuY3Rpb24gcmVzX3NrYXRlYm9hcmQodG9nZ2xlZCkKICAgIE5ld19TY29vdGVyID0gdG9nZ2xlZAogICAgd2hpbGUgTmV3X1Njb290ZXIgZG8KICAgICAgICBpZiBub3QgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKGhhc3NrYXRlYm9hcmQyKSBvciBub3QgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKGhhc3NrYXRlYm9hcmQpIHRoZW4KICAgICAgICAgICAgbG9jYWwgc2thdGVib2FyZCA9IHV0aWwuam9hYXQoInZfcmVzX3NrYXRlYm9hcmQiKSAtLea7keadvwogICAgICAgICAgICBsb2NhbCBza2F0ZWJvYXJkMiA9IHV0aWwuam9hYXQoInByb3BfYmlnX3NoaXRfMDIiKSAtLeS+v+S+vwogICAgICAgICAgICByZXF1ZXN0X21vZGVscyhza2F0ZWJvYXJkLHNrYXRlYm9hcmQyKQogICAgICAgICAgICBsb2NhbCByZXNwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpCiAgICAgICAgICAgIGhhc3NrYXRlYm9hcmQgPSBjcmVhdGVfb2JqZWN0KHNrYXRlYm9hcmQsIHJlc3Bvcy54LCByZXNwb3MueSwgcmVzcG9zLnogLSAxKQogICAgICAgICAgICBoYXNza2F0ZWJvYXJkMiA9IGNyZWF0ZV9vYmplY3Qoc2thdGVib2FyZDIsIHJlc3Bvcy54LCByZXNwb3MueSwgcmVzcG9zLnogLSAxKQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9WSVNJQkxFKGhhc3NrYXRlYm9hcmQyLCBmYWxzZSkKICAgICAgICAgICAgLS3mgaLlpI3lvaLmgIHvvIzpgb/lhY3pmYTliqDlpLHotKUKICAgICAgICAgICAgVEFTSy5DTEVBUl9QRURfVEFTS1NfSU1NRURJQVRFTFkoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHdoaWxlIG5vdCBFTlRJVFkuSVNfRU5USVRZX0FUVEFDSEVEX1RPX0VOVElUWShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBoYXNza2F0ZWJvYXJkMikgZG8KICAgICAgICAgICAgICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBoYXNza2F0ZWJvYXJkMiwgMCwgMCwgMC4wLCAxLjE1LCAwLjAsIDAuMCwgMC4wLCB0cnVlLCBmYWxzZSwgdHJ1ZS0tW1sg56Kw5pKeIF1dLCB0cnVlLCAwLCB0cnVlLCAwKQogICAgICAgICAgICAgICAgdXRpbC55aWVsZCgpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICB1dGlsLnlpZWxkKDEpCiAgICAgICAgICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWShoYXNza2F0ZWJvYXJkLCBoYXNza2F0ZWJvYXJkMiwgMCwgMCwgMC4wLCAwLCAwLjAsIDAuMCwgMTAwLCB0cnVlLCBmYWxzZSwgdHJ1ZS0tW1sg56Kw5pKeIF1dLCB0cnVlLCAwLCB0cnVlLCAwKQogICAgCiAgICAgICAgICAgIHJlcXVlc3RfYW5pbV9kaWN0KCJtb3ZlX3N0cmFmZUBmaXJzdF9wZXJzb25AZHJ1bmsiKQogICAgICAgICAgICBUQVNLLlRBU0tfUExBWV9BTklNKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksICJtb3ZlX3N0cmFmZUBmaXJzdF9wZXJzb25AZHJ1bmsiLCAiaWRsZSIsIDguMCwgLTguMCwgLTEsIDEsIDAuMCwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgICAgICBlbHNlCiAgICAgICAgICAgIGxvY2FsIGNhbXJvdCA9IENBTS5HRVRfR0FNRVBMQVlfQ0FNX1JPVCgwKQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9ST1RBVElPTihoYXNza2F0ZWJvYXJkMiwgMCwgMCwgY2Ftcm90LnosIDAsIHRydWUpCiAgICAKICAgICAgICAgICAgbG9jYWwgYzIgPSBnZXRfb2Zmc2V0X2Zyb21fY2FtZXJhKDE1KQogICAgICAgICAgICBsb2NhbCBkaXIgPSB7fQogICAgICAgICAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpCiAgICAgICAgICAgIGlmIFBBRC5JU19DT05UUk9MX1BSRVNTRUQoMCwgMzIpIHRoZW4gLS0gVwogICAgICAgICAgICAgICAgZGlyLnggPSAoYzIueCAtIHBvcy54KSAvIDEuMwogICAgICAgICAgICAgICAgZGlyLnkgPSAoYzIueSAtIHBvcy55KSAvIDEuMwogICAgICAgICAgICAgICAgRU5USVRZLkFQUExZX0ZPUkNFX1RPX0VOVElUWV9DRU5URVJfT0ZfTUFTUyhoYXNza2F0ZWJvYXJkMiwgMSwgZGlyLngsIGRpci55LCAwLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgaWYgUEFELklTX0NPTlRST0xfUFJFU1NFRCgwLCA2MSkgdGhlbiAtLSBTaGlmdAogICAgICAgICAgICAgICAgZGlyLnggPSAoYzIueCAtIHBvcy54KQogICAgICAgICAgICAgICAgZGlyLnkgPSAoYzIueSAtIHBvcy55KQogICAgICAgICAgICAgICAgRU5USVRZLkFQUExZX0ZPUkNFX1RPX0VOVElUWV9DRU5URVJfT0ZfTUFTUyhoYXNza2F0ZWJvYXJkMiwgMSwgZGlyLngsIGRpci55LCAwLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgaWYgUEFELklTX0RJU0FCTEVEX0NPTlRST0xfSlVTVF9QUkVTU0VEKDAsIDIyKXRoZW4gLS0g56m65qC8CiAgICAgICAgICAgICAgICBpZiBub3QgRU5USVRZLklTX0VOVElUWV9JTl9BSVIoaGFzc2thdGVib2FyZDIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBFTlRJVFkuQVBQTFlfRk9SQ0VfVE9fRU5USVRZX0NFTlRFUl9PRl9NQVNTKGhhc3NrYXRlYm9hcmQyLCAxLCAwLjAsIDAuMCwgMTUuMCwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgIAogICAgICAgICAgICBpZiBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsIDczKSB0aGVuIC0tIHgKICAgICAgICAgICAgICAgIGlmIEVOVElUWS5JU19FTlRJVFlfSU5fQUlSKGhhc3NrYXRlYm9hcmQyKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgZm9yIHRpbWUgPSAxLCAxOCBkbwogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBteXJvdCA9IEVOVElUWS5HRVRfRU5USVRZX1JPVEFUSU9OKGhhc3NrYXRlYm9hcmQyLCAyKQogICAgICAgICAgICAgICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9ST1RBVElPTihoYXNza2F0ZWJvYXJkMiwgMCwgMCwgbXlyb3QueiArIDIwLCAxLCB0cnVlKQogICAgICAgICAgICAgICAgICAgICAgICB1dGlsLnlpZWxkKCkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAogICAgVEFTSy5DTEVBUl9QRURfVEFTS1NfSU1NRURJQVRFTFkoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgIGRlbGV0ZV9lbnRpdHkoaGFzc2thdGVib2FyZCwgaGFzc2thdGVib2FyZDIpCmVuZAoKLS0tLeeBq+eureWPkeWwhApmdW5jdGlvbiBsYXVuY2hpbmdfcm9ja2V0KCkKICAgIGxvY2FsIGhhc2ggPSBNSVNDLkdFVF9IQVNIX0tFWSgiaDRfcHJvcF9oNF9haXJtaXNzaWxlXzAxYSIpCiAgICBsb2NhbCBjcG9zID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDAsIDUwLCAwKQogICAgbG9jYWwgbWlzc2lvbiA9IGNyZWF0ZV9vYmplY3QoaGFzaCwgY3Bvcy54LCBjcG9zLnksIGNwb3MueikKICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKG1pc3Npb24sIDI3MCwgMCwgMCwgMSwgdHJ1ZSkKICAgIHV0aWwueWllbGQoNTAwMCkKCiAgICBsb2NhbCBoZWlnaHQgPSAwCiAgICB3aGlsZSBFTlRJVFkuR0VUX0VOVElUWV9IRUlHSFRfQUJPVkVfR1JPVU5EKG1pc3Npb24pIDwgMjAwMCBkbwogICAgICAgIGlmIGhlaWdodCA8IDAuNzUgdGhlbgogICAgICAgICAgICBoZWlnaHQgPSBoZWlnaHQgKyAwLjAwMgogICAgICAgIGVuZAogICAgICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhtaXNzaW9uLCBmYWxzZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFMobWlzc2lvbiwgcG9zLngsIHBvcy55LCBwb3MueiArIGhlaWdodCwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04obWlzc2lvbiwgMjcwLCAwLCAwLCAxLCB0cnVlKQoKICAgICAgICByZXF1ZXN0X3B0ZnhfYXNzZXQoImNvcmUiKQogICAgICAgIEdSQVBISUNTLlNUQVJUX05FVFdPUktFRF9QQVJUSUNMRV9GWF9OT05fTE9PUEVEX0FUX0NPT1JEKCdleHBfYWlyX21vbG90b3YnLCBwb3MueCwgcG9zLnksIHBvcy56KzAuNCwgMCwgMCwgMCwgMS4wLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKCiAgICAgICAgdXRpbC55aWVsZCgpCiAgICBlbmQKZW5kCgotLS0t5rC05L2T5ryp5rahCmZ1bmN0aW9uIHdhdGVyX3ZvcnRleCgpCiAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSxmYWxzZSkKICAgIFdBVEVSLlNFVF9ERUVQX09DRUFOX1NDQUxFUigwLjApCiAgICBXQVRFUi5NT0RJRllfV0FURVIocG9zLngsIHBvcy55LCAtNTAwMDAwLjAsIDAuMikKICAgIFdBVEVSLk1PRElGWV9XQVRFUihwb3MueCsyLCBwb3MueSwgLTUwMDAwMC4wLCAwLjIpCiAgICBXQVRFUi5NT0RJRllfV0FURVIocG9zLngsIHBvcy55KzIsIC01MDAwMDAuMCwgMC4yKQogICAgV0FURVIuTU9ESUZZX1dBVEVSKHBvcy54LTIsIHBvcy55LCAtNTAwMDAwLjAsIDAuMikKICAgIFdBVEVSLk1PRElGWV9XQVRFUihwb3MueCwgcG9zLnktMiwgLTUwMDAwMC4wLCAwLjIpCiAgICBXQVRFUi5NT0RJRllfV0FURVIocG9zLngrbWF0aC5yYW5kb20oNCwxMCksIHBvcy55LCAtNTAwMDAwLjAsIDAuMikKICAgIFdBVEVSLk1PRElGWV9XQVRFUihwb3MueCwgcG9zLnkrbWF0aC5yYW5kb20oNCwxMCksIC01MDAwMDAuMCwgMC4yKQogICAgV0FURVIuTU9ESUZZX1dBVEVSKHBvcy54LW1hdGgucmFuZG9tKDQsMTApLCBwb3MueSwgLTUwMDAwMC4wLCAwLjIpCiAgICBXQVRFUi5NT0RJRllfV0FURVIocG9zLngsIHBvcy55LW1hdGgucmFuZG9tKDQsMTApLCAtNTAwMDAwLjAsIDAuMikKZW5kCgotLS0t6YCa5b6A5aSp5aCCCmZ1bmN0aW9uIFRvX0hlYXZlbigpCiAgICBpZiBub3QgUEVELklTX1BFRF9JTl9BTllfVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkgdGhlbiAKICAgICAgICB1dGlsLnRvYXN0KCLor7flhYjov5vlhaXovb3lhbciKQogICAgICAgIHJldHVybgogICAgZW5kCiAgICBpZiBQRUQuSVNfUEVEX0lOX0FOWV9WRUhJQ0xFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKSB0aGVuIAogICAgICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgICAgICBsb2NhbCB2ZWhpY2xlID0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19JTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgICAgICBsb2NhbCBqZXN1c19oYXNoID0gdXRpbC5qb2FhdCgidV9tX21famVzdXNfMDEiKS0t6IC256ijCiAgICAgICAgbG9jYWwgamVzdXNfcGVkID0gY3JlYXRlX3BlZCgyNiwgamVzdXNfaGFzaCwgcG9zLngsIHBvcy55LCBwb3MueiwgMCkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKGplc3VzX3BlZCwgdHJ1ZSkKCiAgICAgICAgUEVELlNFVF9QRURfSU5UT19WRUhJQ0xFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHZlaGljbGUsIDApCiAgICAgICAgUEVELlNFVF9QRURfSU5UT19WRUhJQ0xFKGplc3VzX3BlZCwgdmVoaWNsZSwgLTEpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09MTElTSU9OKHZlaGljbGUsIGZhbHNlLCBmYWxzZSkKICAgICAgICBsb2NhbCB2ZWwgPSB7eCA9IDAsIHkgPSAwLCB6ID0gMTAwMDB9CiAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9HUkFWSVRZKHZlaGljbGUsIGZhbHNlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1ZFTE9DSVRZKHZlaGljbGUsIHZlbC54LCB2ZWwueSwgdmVsLnopCiAgICAgICAgdXRpbC55aWVsZCg1MDAwKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0hFQUxUSChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwLCAwKQogICAgZW5kCmVuZAoKLS0tLeicmOibm+S+oOmjnuihjApmdW5jdGlvbiBzdXBlcm1hbl9mbHkob24pCiAgICBsb2NhbCBjdXJfcGl0Y2ggPSAwCiAgICBsb2NhbCBjID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKQogICAgbG9jYWwgY3VyX3lhdyA9IEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgIHN1cGVybWFuZCA9IG9uIAogICAgaWYgc3VwZXJtYW5kIHRoZW4KICAgICAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlKQogICAgICAgIFRBU0suQ0xFQVJfUEVEX1RBU0tTX0lNTUVESUFURUxZKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICAgICAgY2FtZXJhID0gQ0FNLkNSRUFURV9DQU1fV0lUSF9QQVJBTVMoJ0RFRkFVTFRfU0NSSVBURURfQ0FNRVJBJywgYy54LCBjLnksIGMueiwgMC4wLCAwLjAsIDAuMCwgMTIwLCB0cnVlLCAwKQogICAgICAgIENBTS5SRU5ERVJfU0NSSVBUX0NBTVModHJ1ZSwgZmFsc2UsIDAsIHRydWUsIHRydWUsIDApCiAgICAgICAgcmVxdWVzdF9hbmltX2RpY3QoJ3NreWRpdmVAZnJlZWZhbGwnKQogICAgICAgIFRBU0suVEFTS19QTEFZX0FOSU0oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgJ3NreWRpdmVAZnJlZWZhbGwnLCAnZnJlZV9mb3J3YXJkJywgMS4wLCAxLjAsIC0xLCAzLCAwLjUsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCiAgICBlbHNlIAogICAgICAgIFRBU0suQ0xFQVJfUEVEX1RBU0tTX0lNTUVESUFURUxZKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpIAogICAgICAgIGlmIHN1cHBvcnRfZW50IH49IDAgdGhlbiAKICAgICAgICAgICAgZGVsZXRlX2VudGl0eShzdXBwb3J0X2VudCkKICAgICAgICBlbmQKICAgICAgICBpZiBjYW1lcmEgfj0gMCB0aGVuIAogICAgICAgICAgICBDQU0uUkVOREVSX1NDUklQVF9DQU1TKGZhbHNlLCBmYWxzZSwgMCwgdHJ1ZSwgdHJ1ZSwgMCkKICAgICAgICAgICAgQ0FNLkRFU1RST1lfQ0FNKGNhbWVyYSwgZmFsc2UpIAogICAgICAgICAgICBjYW1lcmEgPSAwCiAgICAgICAgZW5kCiAgICAgICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpCiAgICBlbmQKICAgIHdoaWxlIHN1cGVybWFuZCBkbwogICAgICAgIGxvY2FsIHJvdGF0ZV9sciA9IC0yKlBBRC5HRVRfQ09OVFJPTF9OT1JNQUwoMSwgMSkKICAgICAgICBsb2NhbCByb3RhdGVfdWQgPSAgLTIqUEFELkdFVF9DT05UUk9MX05PUk1BTCgyLCAyKQogICAgICAgIGxvY2FsIGxhdGVyYWwgPSBQQUQuR0VUX0NPTlRST0xfTk9STUFMKDMwLCAzMCkKICAgICAgICBpZiBtYXRoLmFicyhjdXJfcGl0Y2gpID49IDEyMCB0aGVuIAogICAgICAgICAgICByb3RhdGVfbHIgPSAtcm90YXRlX2xyCiAgICAgICAgZW5kCiAgICAKICAgICAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpCgogICAgICAgIGN1cl9waXRjaCA9IGN1cl9waXRjaCArIHJvdGF0ZV91ZCAqIDIKICAgICAgICBjdXJfeWF3ID0gY3VyX3lhdyArIHJvdGF0ZV9sciAqIDIKICAgIAogICAgICAgIGxvY2FsIGp1bXAgPSBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsIDU1KQogICAgICAgIGxvY2FsIHNoaWZ0ID0gUEFELklTX0NPTlRST0xfUFJFU1NFRCgwLCAyMSkKICAgICAgICBpZiBtYXRoLmFicyhjdXJfcGl0Y2gpID49IDM2MCB0aGVuIAogICAgICAgICAgICBjdXJfcGl0Y2ggPSAwCiAgICAgICAgZW5kCiAgICAgICAgaWYgbWF0aC5hYnMoY3VyX3lhdykgPj0gMzYwIHRoZW4gCiAgICAgICAgICAgIGN1cl95YXcgPSAwCiAgICAgICAgZW5kCiAgICAKICAgICAgICBpZiBFTlRJVFkuRE9FU19FTlRJVFlfRVhJU1Qoc3VwcG9ydF9lbnQpIHRoZW4gCiAgICAgICAgICAgIGxvY2FsIHJvdCA9IEVOVElUWS5HRVRfRU5USVRZX1JPVEFUSU9OKHN1cHBvcnRfZW50LCAxKQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9ST1RBVElPTihzdXBwb3J0X2VudCwgY3VyX3BpdGNoLCAwLjAsIGN1cl95YXcsIDEsIHRydWUpCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX01BWF9TUEVFRChzdXBwb3J0X2VudCwgNjAwKQogICAgICAgICAgICBsb2NhbCBmb3J3YXJkX2NvbnRyb2wgPSBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsIDMyKQogICAgICAgICAgICBsb2NhbCBiYWNrd2FyZF9jb250cm9sID0gUEFELklTX0NPTlRST0xfUFJFU1NFRCgwLCAzMykgCiAgICAgICAgICAgIGxvY2FsIHZlbCA9IEVOVElUWS5HRVRfRU5USVRZX1NQRUVEX1ZFQ1RPUihzdXBwb3J0X2VudCwgdHJ1ZSkKCiAgICAgICAgICAgIGxvY2FsIHNpZGVfc3BlZWQgPSB2ZWwueAogICAgICAgICAgICBpZiBtYXRoLmFicyhzaWRlX3NwZWVkKSA+IDUgdGhlbiAKICAgICAgICAgICAgICAgIEVOVElUWS5BUFBMWV9GT1JDRV9UT19FTlRJVFlfQ0VOVEVSX09GX01BU1Moc3VwcG9ydF9lbnQsIDAsIC1zaWRlX3NwZWVkLCAwLCAwLCB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgZm9yd2FyZF9jb250cm9sIHRoZW4KICAgICAgICAgICAgICAgIEVOVElUWS5BUFBMWV9GT1JDRV9UT19FTlRJVFlfQ0VOVEVSX09GX01BU1Moc3VwcG9ydF9lbnQsIDAsIDAsIDYwMCwgMCwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIGJhY2t3YXJkX2NvbnRyb2wgdGhlbgogICAgICAgICAgICAgICAgRU5USVRZLkFQUExZX0ZPUkNFX1RPX0VOVElUWV9DRU5URVJfT0ZfTUFTUyhzdXBwb3J0X2VudCwgMCwgMCwgLTYwMCwgMCwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIGp1bXAgdGhlbiAKICAgICAgICAgICAgICAgIEVOVElUWS5BUFBMWV9GT1JDRV9UT19FTlRJVFlfQ0VOVEVSX09GX01BU1Moc3VwcG9ydF9lbnQsIDAsIDAsIDAsIDYwMCAvIDIsIHRydWUsIHRydWUsIHRydWUsIHRydWUpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBzaGlmdCB0aGVuIAogICAgICAgICAgICAgICAgRU5USVRZLkFQUExZX0ZPUkNFX1RPX0VOVElUWV9DRU5URVJfT0ZfTUFTUyhzdXBwb3J0X2VudCwgMCwgMCwgMCwgLTYwMCAvIDIsIHRydWUsIHRydWUsIHRydWUsIHRydWUpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBsYXRlcmFsIHRoZW4gCiAgICAgICAgICAgICAgICBFTlRJVFkuQVBQTFlfRk9SQ0VfVE9fRU5USVRZX0NFTlRFUl9PRl9NQVNTKHN1cHBvcnRfZW50LCAwLCBsYXRlcmFsKjYwMCwgMCwgMC4wLCB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIENBTS5IQVJEX0FUVEFDSF9DQU1fVE9fRU5USVRZKGNhbWVyYSwgUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMC4wLCAwLjAsIDAuMCwgMC4wLCAtNS4wLCAuMCwgdHJ1ZSkKICAgICAgICBlbHNlCiAgICAgICAgICAgIHN1cHBvcnRfZW50ID0gY3JlYXRlX29iamVjdCh1dGlsLmpvYWF0KCdJR19Sb29zdGVyTWNDcmF3JyksIHBvcy54LCBwb3MueSwgcG9zLnopCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKHN1cHBvcnRfZW50LCAtOTAsIDkwLCA5MCwgMCkKICAgICAgICAgICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHN1cHBvcnRfZW50LCA5MCwgMCwgMCwgMCwgMCwgMCwgMCwgdHJ1ZSwgZmFsc2UsIGZhbHNlLCB0cnVlLCAwLCB0cnVlLCAwKQogICAgICAgIGVuZAogICAgICAgIHV0aWwueWllbGQoKQogICAgZW5kCmVuZAoKLS0tLeenu+mZpOeIhueCuOeJqQpmdW5jdGlvbiByZW1vdmVfZXhwbG9zaXZlKCkKICAgIFdFQVBPTi5SRU1PVkVfQUxMX1BST0pFQ1RJTEVTX09GX1RZUEUoNzQxODE0NzQ1LCBmYWxzZSkKICAgIFdFQVBPTi5SRU1PVkVfQUxMX1BST0pFQ1RJTEVTX09GX1RZUEUoLTEzMTIxMzExNTEsIGZhbHNlKQogICAgV0VBUE9OLlJFTU9WRV9BTExfUFJPSkVDVElMRVNfT0ZfVFlQRSgtMTU2ODM4NjgwNSwgZmFsc2UpCiAgICBXRUFQT04uUkVNT1ZFX0FMTF9QUk9KRUNUSUxFU19PRl9UWVBFKDIxMzgzNDc0OTMsIGZhbHNlKQogICAgV0VBUE9OLlJFTU9WRV9BTExfUFJPSkVDVElMRVNfT0ZfVFlQRSgxNjcyMTUyMTMwLCBmYWxzZSkKICAgIFdFQVBPTi5SRU1PVkVfQUxMX1BST0pFQ1RJTEVTX09GX1RZUEUoMTI1OTU5NzU0LCBmYWxzZSkKICAgIFdFQVBPTi5SRU1PVkVfQUxMX1BST0pFQ1RJTEVTX09GX1RZUEUoLTE4MTM4OTcwMjcsIGZhbHNlKQogICAgV0VBUE9OLlJFTU9WRV9BTExfUFJPSkVDVElMRVNfT0ZfVFlQRSg2MTU2MDg0MzIsIGZhbHNlKQogICAgV0VBUE9OLlJFTU9WRV9BTExfUFJPSkVDVElMRVNfT0ZfVFlQRSgxNDIwNDA3OTE3LCBmYWxzZSkKICAgIFdFQVBPTi5SRU1PVkVfQUxMX1BST0pFQ1RJTEVTX09GX1RZUEUoMTE2OTgyMzU2MCwgZmFsc2UpCmVuZAoKLS0tLei9r+i2tOi2tOenu+WKqApmdW5jdGlvbiBzb2Z0X21vdmluZygpCiAgICAtLeaRlOWAkgogICAgUEVELlNFVF9QRURfVE9fUkFHRE9MTChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAyMDAwLCAyMDAwLCAwLCB0cnVlLCB0cnVlLCB0cnVlKQoKICAgIC0t56e75YqoCiAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpCiAgICBpZiBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsMzIpIHRoZW4tLeWJjei/mwogICAgICAgIGxvY2FsIGMyID0gZ2V0X29mZnNldF9mcm9tX2NhbWVyYSgxNSkKICAgICAgICBsb2NhbCBkaXIgPSB2ZWN0b3IzLm11bFNjYWxhcih2ZWN0b3IzLnN1YihjMiwgcG9zKSwgMTUuMCkKICAgICAgICBFTlRJVFkuQVBQTFlfRk9SQ0VfVE9fRU5USVRZX0NFTlRFUl9PRl9NQVNTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDEsIGRpci54LCBkaXIueSwgZGlyLnosIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgZWxzZWlmIFBBRC5JU19DT05UUk9MX1BSRVNTRUQoMCwzMykgdGhlbi0t5ZCO6YCACiAgICAgICAgbG9jYWwgYzIgPSBnZXRfb2Zmc2V0X2Zyb21fY2FtZXJhKC0xNSkKICAgICAgICBsb2NhbCBkaXIgPSB2ZWN0b3IzLm11bFNjYWxhcih2ZWN0b3IzLnN1YihjMiwgcG9zKSwgMTUuMCkKICAgICAgICBFTlRJVFkuQVBQTFlfRk9SQ0VfVE9fRU5USVRZX0NFTlRFUl9PRl9NQVNTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDEsIGRpci54LCBkaXIueSwgZGlyLnosIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgZW5kCiAgICBpZiBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsMzQpIHRoZW4tLeW3pgogICAgICAgIGxvY2FsIGMyID0gZ2V0X29mZnNldF9mcm9tX2NhbWVyYSgxNSkKICAgICAgICBsb2NhbCBkaXIgPSB2ZWN0b3IzLm11bFNjYWxhcih2ZWN0b3IzLnN1YihjMiwgcG9zKSwgMTUuMCkKICAgICAgICBFTlRJVFkuQVBQTFlfRk9SQ0VfVE9fRU5USVRZX0NFTlRFUl9PRl9NQVNTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDEsIC1kaXIueSwgZGlyLngsIGRpci56LCBmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgIGVsc2VpZiBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsMzUpIHRoZW4tLeWPswogICAgICAgIGxvY2FsIGMyID0gZ2V0X29mZnNldF9mcm9tX2NhbWVyYSgxNSkKICAgICAgICBsb2NhbCBkaXIgPSB2ZWN0b3IzLm11bFNjYWxhcih2ZWN0b3IzLnN1YihjMiwgcG9zKSwgMTUuMCkKICAgICAgICBFTlRJVFkuQVBQTFlfRk9SQ0VfVE9fRU5USVRZX0NFTlRFUl9PRl9NQVNTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDEsIGRpci55LCAtZGlyLngsIGRpci56LCBmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgIGVuZAogICAgaWYgUEFELklTX0NPTlRST0xfUFJFU1NFRCgwLDIxKSB0aGVuLS3kuIoKICAgICAgICBFTlRJVFkuQVBQTFlfRk9SQ0VfVE9fRU5USVRZX0NFTlRFUl9PRl9NQVNTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDEsIDAsIDAsIDEuMCwgdHJ1ZSwgZmFsc2UsIHRydWUsIHRydWUpCiAgICBlbHNlaWYgUEFELklTX0NPTlRST0xfUFJFU1NFRCgwLDM2KSB0aGVuLS3kuIsKICAgICAgICBFTlRJVFkuQVBQTFlfRk9SQ0VfVE9fRU5USVRZX0NFTlRFUl9PRl9NQVNTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDEsIDAsIDAsIC0xLjAsIHRydWUsIGZhbHNlLCB0cnVlLCB0cnVlKQogICAgZW5kCmVuZAoKLS0tLeatu+S6oeS5i+ecvApmdW5jdGlvbiBkZWFkX2V5ZSgpCiAgICBpZiBQTEFZRVIuSVNfUExBWUVSX0ZSRUVfQUlNSU5HKFBMQVlFUi5QTEFZRVJfSUQoKSkgdGhlbgogICAgICAgIE1JU0MuU0VUX1RJTUVfU0NBTEUoMC4yKQogICAgICAgIEdSQVBISUNTLlNFVF9USU1FQ1lDTEVfTU9ESUZJRVIoIkxvc3RUaW1lRmxhc2giKQogICAgZWxzZQogICAgICAgIE1JU0MuU0VUX1RJTUVfU0NBTEUoMSkKICAgICAgICBHUkFQSElDUy5TRVRfVElNRUNZQ0xFX01PRElGSUVSKCJERUZBVUxUIikKICAgIGVuZAplbmQKCi0tLS0zROeOr+e7leeBrwpmdW5jdGlvbiB2ZWhfY2lyY2xlX2xpZ2h0KCkKICAgIGxvY2FsIHJlZCA9IG1hdGgucmFuZG9tKDAsIDI1NSkKICAgIGxvY2FsIGdyZWVuID0gbWF0aC5yYW5kb20oMCwgMjU1KQogICAgbG9jYWwgYmx1ZSA9IG1hdGgucmFuZG9tKDAsIDI1NSkKICAgIGxvY2FsIHZtb2QgPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0lOKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKQogICAgVkVISUNMRS5TRVRfVkVISUNMRV9ORU9OX0NPTE9VUih2bW9kLCByZWQsIGdyZWVuLCBibHVlKQogICAgVkVISUNMRS5TRVRfVkVISUNMRV9ORU9OX0VOQUJMRUQodm1vZCwgMiwgdHJ1ZSkKICAgIC0tVkVISUNMRS5TRVRfVkVISUNMRV9YRU5PTl9MSUdIVF9DT0xPUl9JTkRFWCh2bW9kLCA4KS0t6L295YW35aSn54GvCiAgICBmb3IgaSA9IDAsIDEgZG8KICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX05FT05fRU5BQkxFRCh2bW9kLCBpLCBmYWxzZSkKICAgIGVuZAogICAgVkVISUNMRS5TRVRfVkVISUNMRV9ORU9OX0VOQUJMRUQodm1vZCwgMywgZmFsc2UpCiAgICB1dGlsLnlpZWxkKDEwMCkKICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfTkVPTl9FTkFCTEVEKHZtb2QsIDAsIHRydWUpCiAgICBmb3IgaSA9IDEsIDMgZG8KICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX05FT05fRU5BQkxFRCh2bW9kLCBpLCBmYWxzZSkKICAgIGVuZAogICAgdXRpbC55aWVsZCgxMDApCiAgICBmb3IgaSA9IDAsIDIgZG8KICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX05FT05fRU5BQkxFRCh2bW9kLCBpLCBmYWxzZSkKICAgIGVuZAogICAgVkVISUNMRS5TRVRfVkVISUNMRV9ORU9OX0VOQUJMRUQodm1vZCwgMywgdHJ1ZSkKICAgIHV0aWwueWllbGQoMTAwKQogICAgZm9yIGkgPSAyLCAzIGRvCiAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9ORU9OX0VOQUJMRUQodm1vZCwgaSwgZmFsc2UpCiAgICBlbmQKICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfTkVPTl9FTkFCTEVEKHZtb2QsIDAsIGZhbHNlKQogICAgVkVISUNMRS5TRVRfVkVISUNMRV9ORU9OX0VOQUJMRUQodm1vZCwgMSwgdHJ1ZSkKICAgIHV0aWwueWllbGQoMTAwKQplbmQKCi0tLS3pqpHkuZjnjqnlrrYxCmZ1bmN0aW9uIHJpZGVfcGxheWVyMShwaWQsIG9uKQogICAgCiAgICBpZiBvbiB0aGVuCiAgICAgICAgaWYgUExBWUVSLlBMQVlFUl9QRURfSUQoKSA9PSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSB0aGVuIHJldHVybiBlbmQKICAgICAgICBFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCksIDAsIC0wLjA1OCwgMC4xOTcsIDAuNTk1LCAyLjAsIDEuMCwxLCB0cnVlLCB0cnVlLCB0cnVlLCBmYWxzZSwgMCwgdHJ1ZSkKICAgICAgICByZXF1ZXN0X2FuaW1fZGljdCgiYW5pbUBoZWlzdHNAaGVpc3Rfc2FmZWhvdXNlX2ludHJvQHBob25lX2NvdWNoQG1hbGUiKQogICAgICAgIFRBU0suVEFTS19QTEFZX0FOSU0oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgImFuaW1AaGVpc3RzQGhlaXN0X3NhZmVob3VzZV9pbnRyb0BwaG9uZV9jb3VjaEBtYWxlIiwgInBob25lX2NvdWNoX21hbGVfaWRsZSIsIDMuMCwgMi4wLCAtMSwgMywgMS4wLCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgZWxzZQogICAgICAgIEVOVElUWS5ERVRBQ0hfRU5USVRZKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgRU5USVRZLkRFVEFDSF9FTlRJVFkoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UsIGZhbHNlKQogICAgICAgIFRBU0suQ0xFQVJfUEVEX1RBU0tTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICBlbmQKZW5kCi0t6aqR5LmY546p5a62MgpmdW5jdGlvbiByaWRlX3BsYXllcjIocGlkLCBvbikKICAgIAogICAgaWYgb24gdGhlbgogICAgICAgIGlmIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkgPT0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCAwLCAwLCAwLjU5NywgMC45OTUsIDIuMCwgMS4wLDEsIHRydWUsIHRydWUsIHRydWUsIGZhbHNlLCAwLCB0cnVlKQogICAgICAgIHJlcXVlc3RfYW5pbV9kaWN0KCJ0aW1ldGFibGVAamltbXlAbWljczNfaWdfMTVAIikKICAgICAgICBUQVNLLlRBU0tfUExBWV9BTklNKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksICJ0aW1ldGFibGVAamltbXlAbWljczNfaWdfMTVAIiwgImlkbGVfYV90cmFjeSIsIDMuMCwgMi4wLCAtMSwgMywgMS4wLCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgZWxzZQogICAgICAgIEVOVElUWS5ERVRBQ0hfRU5USVRZKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgRU5USVRZLkRFVEFDSF9FTlRJVFkoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UsIGZhbHNlKQogICAgICAgIFRBU0suQ0xFQVJfUEVEX1RBU0tTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICBlbmQKZW5kCgoKLS0tLemZjeiQveWIsOeOqeWutgpmdW5jdGlvbiBsYW5kaW5nX29uX3BsYXllcihwaWQpCiAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCksIDAsIC0xMDAsIDEwMCkKICAgIGxvY2FsIHBvczEgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCksIGZhbHNlKQogICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHBvcy54LCBwb3MueSwgcG9zLnosIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgV0VBUE9OLkdJVkVfREVMQVlFRF9XRUFQT05fVE9fUEVEKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHV0aWwuam9hYXQoImdhZGdldF9wYXJhY2h1dGUiKSwgMSwgMCkKICAgIHdoaWxlIHRydWUgZG8KICAgICAgICBsb2NhbCBteXBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgICAgICBsb2NhbCBkaXN0YW5jZSA9IEdldF9kaXN0YW5jZShwb3MxLCBteXBvcywgdHJ1ZSkKICAgICAgICBpZiBkaXN0YW5jZSA8IDEyMyB0aGVuCiAgICAgICAgICAgIFBFRC5GT1JDRV9QRURfVE9fT1BFTl9QQVJBQ0hVVEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZW5kCiAgICAgICAgdXRpbC55aWVsZCgpCiAgICBlbmQKZW5kCgotLS0t5Y+N5Ye75pWM5Lq6CmZ1bmN0aW9uIHJldGFsaWF0ZV9lbmVteShwaWQpCiAgICBpZiBFTlRJVFkuR0VUX0VOVElUWV9IRUFMVEgoUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkpIDwgMTAwIHRoZW4KICAgICAgICBsb2NhbCBraWxsZXIgPSBQRUQuR0VUX1BFRF9TT1VSQ0VfT0ZfREVBVEgoUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkpCiAgICAgICAgaWYgUEVELklTX1BFRF9BX1BMQVlFUihraWxsZXIpIGFuZCBraWxsZXIgfj0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkgdGhlbgogICAgICAgICAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoa2lsbGVyLCBmYWxzZSkKICAgICAgICAgICAgRklSRS5BRERfRVhQTE9TSU9OKHBvcy54LCBwb3MueSwgcG9zLnosIDAsIDEuMCwgdHJ1ZSwgZmFsc2UsIDAuNSwgZmFsc2UpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgotLS0t6K6+572u5a+86Iiq54K5CmZ1bmN0aW9uIHNldF93YXlwb2ludChwaWQpCiAgICBpZiBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSB+PSAwIGFuZCBub3QgUExBWUVSLklTX1BMQVlFUl9ERUFEKHBpZCkgdGhlbgogICAgICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSwgZmFsc2UpCiAgICAgICAgSFVELlNFVF9ORVdfV0FZUE9JTlQocG9zLngsIHBvcy55KQogICAgICAgIHV0aWwueWllbGQoNTAwKQogICAgZWxzZQogICAgICAgIEhVRC5TRVRfV0FZUE9JTlRfT0ZGKCkKICAgIGVuZAplbmQKCgotLS0t5L+d5a2Y546p5a625L+h5oGvCmxvY2FsIFNhdmVQcm9maWxlID0gewoJbmFtZSA9ICIiLAoJcmlkID0gIiIsCgljcmV3ID0gIiIsCglpcCA9ICIiLAp9ClNhdmVQcm9maWxlLl9fcGFpcnMgPSBmdW5jdGlvbih0YmwpLS3mm7TmlLnmjpLluo8KCWxvY2FsIGsgPSB7Im5hbWUiLCAicmlkIiwgImNyZXciLCAiaXAifQoJbG9jYWwgaSA9IDAKCWxvY2FsIGl0ZXIgPSBmdW5jdGlvbigpCgkJaSA9IGkgKyAxCgkJaWYgdGJsW2tbaV1dID09IG5pbCB0aGVuIHJldHVybiBuaWwgZW5kCgkJcmV0dXJuIGtbaV0sIHRibFtrW2ldXQoJZW5kCglyZXR1cm4gaXRlcgplbmQKZnVuY3Rpb24gZ2V0X3BsYXllcl9jcmV3KHBpZCkKICAgIGxvY2FsIGNyZXcgPSB7fQogICAgbG9jYWwgbmV0d29ya0hhbmRsZSA9IG1lbW9yeS5hbGxvYygxMDQpCiAgICBsb2NhbCBjbGFuRGVzYyA9IG1lbW9yeS5hbGxvYygyODApCiAgICBORVRXT1JLLk5FVFdPUktfSEFORExFX0ZST01fUExBWUVSKHBpZCwgbmV0d29ya0hhbmRsZSwgMTMpCiAgICBpZiBORVRXT1JLLk5FVFdPUktfSVNfSEFORExFX1ZBTElEKG5ldHdvcmtIYW5kbGUsIDEzKSBhbmQgTkVUV09SSy5ORVRXT1JLX0NMQU5fUExBWUVSX0dFVF9ERVNDKGNsYW5EZXNjLCAzNSwgbmV0d29ya0hhbmRsZSkgdGhlbgogICAgICAgIGNyZXcuaWNvbiA9IG1lbW9yeS5yZWFkX2ludChjbGFuRGVzYykKICAgICAgICBjcmV3Lm5hbWUgPSBtZW1vcnkucmVhZF9zdHJpbmcoY2xhbkRlc2MgKyAweDA4KQogICAgICAgIGNyZXcudGFnID0gbWVtb3J5LnJlYWRfc3RyaW5nKGNsYW5EZXNjICsgMHg4OCkKICAgICAgICBjcmV3LnJhbmsgPSBtZW1vcnkucmVhZF9zdHJpbmcoY2xhbkRlc2MgKyAweEIwKQogICAgICAgIGNyZXcubW90dG8gPSBwbGF5ZXJzLmNsYW5fZ2V0X21vdHRvKHBpZCkKICAgICAgICBjcmV3LmFsdF9iYWRnZSA9IG1lbW9yeS5yZWFkX2J5dGUoY2xhbkRlc2MgKyAweEEwKSB+PSAwIGFuZCAiT24iIG9yICJPZmYiCiAgICBlbmQKICAgIHJldHVybiBjcmV3CmVuZApmdW5jdGlvbiBzYXZlX3BsYXllcl9pbmZvKHBpZCkKICAgIGxvY2FsIGluZm8gPSBzZXRtZXRhdGFibGUoe30sIFNhdmVQcm9maWxlKQogICAgaW5mby5uYW1lID0gUExBWUVSLkdFVF9QTEFZRVJfTkFNRShwaWQpCiAgICBpbmZvLnJpZCA9IHBsYXllcnMuZ2V0X3JvY2tzdGFyX2lkKHBpZCkKICAgIGluZm8uY3JldyA9IGdldF9wbGF5ZXJfY3JldyhwaWQpCiAgICBpbmZvLmlwID0gaW50VG9JcChwbGF5ZXJzLmdldF9jb25uZWN0X2lwKHBpZCkpCgogICAgbG9jYWwgY29udGVudCA9IFRhYmxlVG9Kc29uKGluZm8pCiAgICBsb2NhbCBkaXIgPSBmaWxlc3lzdGVtLnNjcmlwdHNfZGlyKCkgLi4gJ2RhaWRhaVNjcmlwdC9wcm9maWxlcy8nLi5pbmZvLm5hbWUuLiIuanNvbiIKICAgIGZpbGV3cml0ZShkaXIsICJ3KyIsIGNvbnRlbnQgb3IgMCkKICAgIG5vdGlmaWNhdGlvbigifnl+fmJvbGR+5L+h5oGv5bey5L+d5a2YIiwgSHVkQ29sb3VyLmJsdWUpCmVuZAoKCgotLS0t6ZuG5p2f54K45by5CmZ1bmN0aW9uIGNsdXN0ZXJfYm9tYihwaWQpCiAgICAKICAgIGxvY2FsIHBsYXllclBlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICBpZiBwbGF5ZXJQZWQgfj0gMCB0aGVuCiAgICAgICAgbG9jYWwgcGxheWVyUG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpKQogICAgICAgIGxvY2FsIG1heEV4cGxvc2lvbnMgPSAxMjAwIC0tIOacgOWkp+eIhueCuOasoeaVsAogICAgICAgIGxvY2FsIGV4cGxvc2lvblJhZGl1cyA9IDAuMDAxIC0tIOWIneWni+eIhueCuOWNiuW+hAogICAgICAgIGxvY2FsIGV4cGxvc2lvblJhZGl1c1N0ZXAgPSAwLjAzIC0tIOavj+asoeeIhueCuOeahOeIhueCuOWNiuW+hOWinuWKoAogICAgICAgIAogICAgICAgIC0tIOS7juWkmuS4quaWueWQkeW8leWPkeeIhueCuAogICAgICAgIGZvciBpID0gMSwgbWF4RXhwbG9zaW9ucyBkbwogICAgICAgICAgICAtLSDmr4/mrKHniIbngrjliY3nmoTlu7bov58KICAgICAgICAgICAgdXRpbC55aWVsZCgwLjAwMDAwMSkKICAgICAgICAgICAgCiAgICAgICAgICAgIC0tIOiuoeeul+avj+S4quaWueWQkeeahOmaj+acuuinkuW6pgogICAgICAgICAgICBsb2NhbCBhbmdsZSA9IG1hdGgucmFkKG1hdGgucmFuZG9tKDAsIDM2MCkpCiAgICAgICAgICAgIAogICAgICAgICAgICAtLSDmoLnmja7op5LluqblkozljYrlvoTorqHnrpfniIbngrjkvY3nva4KICAgICAgICAgICAgbG9jYWwgb2Zmc2V0WCA9IG1hdGguY29zKGFuZ2xlKSAqIGV4cGxvc2lvblJhZGl1cwogICAgICAgICAgICBsb2NhbCBvZmZzZXRZID0gbWF0aC5zaW4oYW5nbGUpICogZXhwbG9zaW9uUmFkaXVzCiAgICAgICAgICAgIGxvY2FsIGV4cGxvc2lvblBvcyA9IHYzKHBsYXllclBvcy54ICsgb2Zmc2V0WCwgcGxheWVyUG9zLnkgKyBvZmZzZXRZLCBwbGF5ZXJQb3MueikKICAgICAgICAgICAgCiAgICAgICAgICAgIEZJUkUuQUREX0VYUExPU0lPTihleHBsb3Npb25Qb3MueCwgZXhwbG9zaW9uUG9zLnksIGV4cGxvc2lvblBvcy56LCAwLCAxMDAsIHRydWUsIGZhbHNlLCAwLCBmYWxzZSkKICAgICAgICAgICAgCiAgICAgICAgICAgIC0tIOWinuWKoOeIhueCuOWNiuW+hAogICAgICAgICAgICBleHBsb3Npb25SYWRpdXMgPSBleHBsb3Npb25SYWRpdXMgKyBleHBsb3Npb25SYWRpdXNTdGVwCiAgICAgICAgZW5kCiAgICAgICAgdXRpbC55aWVsZCgwLjAwMSkKICAgIGVuZAplbmQKCi0tLS3noLjmrbsKZnVuY3Rpb24gU21hc2hkZWFkX3BsYXllcihwaWQpCiAgICAKICAgIGxvY2FsIGNvb3JkcyA9IHBsYXllcnMuZ2V0X3Bvc2l0aW9uKHBpZCkKICAgIGxvY2FsIHBsYXllclBlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRF9TQ1JJUFRfSU5ERVgocGlkKQogICAgY29vcmRzLnogPSBjb29yZHMueiArIDUKICAgIGxvY2FsIHBsYXllckNhciA9IFBFRC5HRVRfVkVISUNMRV9QRURfSVNfSU4ocGxheWVyUGVkLCBmYWxzZSkKICAgIGlmIHBsYXllckNhciA+IDAgdGhlbgogICAgICAgIGRlbGV0ZV9lbnRpdHkocGxheWVyQ2FyKQogICAgZW5kCiAgICBsb2NhbCBjYXJIYXNoID0gdXRpbC5qb2FhdCgiZHVrZXMyIikKICAgIHJlcXVlc3RfbW9kZWwoY2FySGFzaCkKICAgIGxvY2FsIGNhciA9IGVudGl0aWVzLmNyZWF0ZV92ZWhpY2xlKGNhckhhc2gsIGNvb3JkcywgMCkKICAgIEVOVElUWS5TRVRfRU5USVRZX1ZJU0lCTEUoY2FyLCBmYWxzZSwgMCkKICAgIEVOVElUWS5BUFBMWV9GT1JDRV9UT19FTlRJVFkoY2FyLCAxLCAwLjAsIDAuMCwgLTY1LCAwLjAsIDAuMCwgMC4wLCAxLCBmYWxzZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkKZW5kCgoKLS0tLei9veWFt+WcsOWIugpmdW5jdGlvbiB2ZWhfcHJpY2tsZShwaWQpCiAgICAKICAgIGxvY2FsIHZlaGljbGUgPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX1VTSU5HKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpKQogICAgaWYgUEVELklTX1BFRF9JTl9BTllfVkVISUNMRShQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSkgYW5kIEVOVElUWS5HRVRfRU5USVRZX0hFSUdIVF9BQk9WRV9HUk9VTkQodmVoaWNsZSkgPCAxLjAgdGhlbgogICAgICAgIGxvY2FsIGhhc2ggPSB1dGlsLmpvYWF0KCJ4c19wcm9wX2FyZW5hX3NwaWtlc18wMmEiKQogICAgICAgIHJlcXVlc3RfbW9kZWwoaGFzaCkKICAgICAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFModmVoaWNsZSwgMC4wLCA4LjAsIC0wLjM4KQogICAgICAgIGxvY2FsIHNwaWtlcyA9IGNyZWF0ZV9vYmplY3QoaGFzaCwgcG9zLngsIHBvcy55LCBwb3MueikKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9IRUFESU5HKHNwaWtlcywgRU5USVRZLkdFVF9FTlRJVFlfSEVBRElORyh2ZWhpY2xlKSAtIDE4MCkKICAgICAgICB1dGlsLnlpZWxkKDIwMDApCiAgICAgICAgZGVsZXRlX2VudGl0eShzcGlrZXMpCiAgICBlbmQKZW5kCgotLS0t6L295YW35rKl6Z2SCmZ1bmN0aW9uIFZlaGljbGVfYXNwaGFsdChwaWQpCiAgICAKICAgIGlmIFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpIH49IDAgYW5kIFBFRC5JU19QRURfSU5fQU5ZX1ZFSElDTEUoUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkpIHRoZW4KICAgICAgICBsb2NhbCB2ZWggPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0lOKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCBmYWxzZSkKICAgICAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFModmVoLCBmYWxzZSkKICAgICAgICBGSVJFLkFERF9FWFBMT1NJT04ocG9zLngsIHBvcy55LCBwb3MueiwgNjcsIDEsIHRydWUsIGZhbHNlLCAwLCBmYWxzZSkKICAgICAgICB1dGlsLnlpZWxkKDEwMCkKICAgIGVuZAplbmQKCi0tLS3lsaDmnYDovb3lhbcKZnVuY3Rpb24gbWFzc2FjcmVfdmVoaWNsZShwaWQpCiAgICAKICAgIGxvY2FsIHBsYXllclZlaGljbGUgPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0lOKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCBmYWxzZSkKICAgIGlmIHBsYXllclZlaGljbGUgfj0gbmlsIHRoZW4KICAgICAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkpCiAgICAgICAgbG9jYWwgZm9yY2VNdWx0aXBsaWVyID0gOTk5OTk5LjAKICAgICAgICByZXF1ZXN0X2NvbnRyb2wocGxheWVyVmVoaWNsZSwgMykKICAgICAgICBmb3IgaSA9IDEsIDEwMDAgZG8KICAgICAgICAgICAgbG9jYWwgZm9yY2VYID0gbWF0aC5yYW5kb20oLWZvcmNlTXVsdGlwbGllciwgZm9yY2VNdWx0aXBsaWVyKQogICAgICAgICAgICBsb2NhbCBmb3JjZVkgPSBtYXRoLnJhbmRvbSgtZm9yY2VNdWx0aXBsaWVyLCBmb3JjZU11bHRpcGxpZXIpCiAgICAgICAgICAgIGxvY2FsIGZvcmNlWiA9IC1mb3JjZU11bHRpcGxpZXIKICAgICAgICAgICAgLS1lbnRpdHkuYXBwbHlfZm9yY2VfdG9fZW50aXR5KHBsYXllclZlaGljbGUsIDEsIHBvcy54LCBwb3MueSwgcG9zLnosIGZvcmNlWCwgZm9yY2VZLCBmb3JjZVosIHRydWUsIHRydWUpCiAgICAgICAgICAgIEVOVElUWS5BUFBMWV9GT1JDRV9UT19FTlRJVFkocGxheWVyVmVoaWNsZSwgMSwgcG9zLngsIHBvcy55LCBwb3MueiwgZm9yY2VYLCBmb3JjZVksIGZvcmNlWiwgMCwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgZmFsc2UsIHRydWUpCiAgICAgICAgICAgIHV0aWwueWllbGQoMSkKICAgICAgICBlbmQKICAgICAgICB1dGlsLnlpZWxkKDEpCiAgICBlbmQKZW5kCgotLS0t6bG86ZuoCmxvY2FsIGZpc2hfdGFiID0ge30KZnVuY3Rpb24gZmlzaF9yYWluKCkKICAgIGxvY2FsIGhhc2hlcyA9IHt1dGlsLmpvYWF0KCdhX2NfZmlzaCcpLCB1dGlsLmpvYWF0KCdhX2Nfc3RpbmdyYXknKX0KICAgIGxvY2FsIGZpc2hfaGFzaCA9IGhhc2hlc1ttYXRoLnJhbmRvbSgjaGFzaGVzKV0KICAgIGxvY2FsIGMgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpCiAgICBjLnggPSBjLnggKyBtYXRoLnJhbmRvbSgtMzAsIDMwKQogICAgYy55ID0gYy55ICsgbWF0aC5yYW5kb20oLTMwLCAzMCkKICAgIGMueiA9IGMueiArIDUwCiAgICBsb2NhbCBteWZpc2ggPSBjcmVhdGVfcGVkKDI4LCBmaXNoX2hhc2gsIGMueCwgYy55LCBjLnosIG1hdGgucmFuZG9tKDI3MCkpCiAgICBmaXNoX3RhYlsjZmlzaF90YWIgKyAxXSA9IG15ZmlzaAogICAgRU5USVRZLlNFVF9FTlRJVFlfSEVBTFRIKG15ZmlzaCwgMC4wLCAxKQogICAgRU5USVRZLkFQUExZX0ZPUkNFX1RPX0VOVElUWShteWZpc2gsIDEsIDAuMCwgMC4wLCAxLjAsIDAuMCwgMC4wLCAwLjAsIDAsIGZhbHNlLCBmYWxzZSwgdHJ1ZSwgZmFsc2UsIHRydWUpCiAgICBpZiAjZmlzaF90YWIgPiA0MCB0aGVuCiAgICAgICAgZGVsZXRlX2VudGl0eShmaXNoX3RhYlsxXSkKICAgICAgICB0YWJsZS5yZW1vdmUoZmlzaF90YWIsIDEpCiAgICBlbmQKICAgIHV0aWwueWllbGQoMjAwKQplbmQKCi0tLS3lj43lkJHpqb7pqbYKZnVuY3Rpb24gZm9yY2VfbnBjX3JldmVyc2VfdHJhdmVsKCkKICAgIGZvciBfLCBwZWQgaW4gaXBhaXJzKGVudGl0aWVzLmdldF9hbGxfcGVkc19hc19oYW5kbGVzKCkpIGRvCiAgICAgICAgaWYgbm90IFBFRC5JU19QRURfQV9QTEFZRVIocGVkKSB0aGVuIAogICAgICAgICAgICBsb2NhbCB2ZWggPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0lOKHBlZCwgdHJ1ZSkKICAgICAgICAgICAgaWYgdmVoIH49IDAgYW5kIFZFSElDTEUuR0VUX1BFRF9JTl9WRUhJQ0xFX1NFQVQodmVoLCAtMSkgPT0gcGVkIHRoZW4gCiAgICAgICAgICAgICAgICByZXF1ZXN0X2NvbnRyb2wocGVkKQogICAgICAgICAgICAgICAgVEFTSy5TRVRfRFJJVkVfVEFTS19EUklWSU5HX1NUWUxFKHBlZCwgMTQ3MSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgotLS0t5by65Yi25Ya757uTbnBjCmZ1bmN0aW9uIGZvcmNlX2ZyZWV6ZV9ucGMoKQogICAgZm9yIF8sIHBlZCBpbiBwYWlycyhlbnRpdGllcy5nZXRfYWxsX3BlZHNfYXNfaGFuZGxlcygpKSBkbwogICAgICAgIGlmIG5vdCBQRUQuSVNfUEVEX0FfUExBWUVSKHBlZCkgdGhlbgogICAgICAgICAgICBUQVNLLkNMRUFSX1BFRF9UQVNLU19JTU1FRElBVEVMWShwZWQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCi0t5Ya757uTTlBDCmZ1bmN0aW9uIGZyZWV6ZV9ucGMoKQogICAgZm9yIF8sIHBlZCBpbiBwYWlycyhlbnRpdGllcy5nZXRfYWxsX3BlZHNfYXNfaGFuZGxlcygpKSBkbwogICAgICAgIGlmIG5vdCBQRUQuSVNfUEVEX0FfUExBWUVSKHBlZCkgdGhlbgogICAgICAgICAgICBUQVNLLkNMRUFSX1BFRF9UQVNLUyhwZWQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgotLS0t56aB5q2i6LWw54GrCmZ1bmN0aW9uIGJsb2NrX25wY19taXNmaXJlKCkKICAgIGZvciBfLCBwZWQgaW4gcGFpcnMoZW50aXRpZXMuZ2V0X2FsbF9wZWRzX2FzX2hhbmRsZXMoKSkgZG8KICAgICAgICBpZiBub3QgUEVELklTX1BFRF9BX1BMQVlFUihwZWQpIHRoZW4KICAgICAgICAgICAgUEVELlNUT1BfUEVEX1dFQVBPTl9GSVJJTkdfV0hFTl9EUk9QUEVEKHBlZCkKICAgICAgICBlbmQKICAgIGVuZAplbmQKLS0tLeemgeatouWPl+S8pOihjOS4ugpmdW5jdGlvbiBibG9ja19ucGNfaW5qdXJ5KCkKICAgIGZvciBfLCBwZWQgaW4gcGFpcnMoZW50aXRpZXMuZ2V0X2FsbF9wZWRzX2FzX2hhbmRsZXMoKSkgZG8KICAgICAgICBpZiBub3QgUEVELklTX1BFRF9BX1BMQVlFUihwZWQpIHRoZW4KICAgICAgICAgICAgUEVELkRJU0FCTEVfUEVEX0lOSlVSRURfT05fR1JPVU5EX0JFSEFWSU9VUihwZWQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgotLS0t5by65YyWTlBDCmZ1bmN0aW9uIGluY3JlYXNlX25wYyhwZWQpCiAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKHBlZCwgdHJ1ZSkKICAgIEVOVElUWS5TRVRfRU5USVRZX1BST09GUyhwZWQsIHRydWUsIHRydWUsIHRydWUsIHRydWUsIHRydWUsIHRydWUsIHRydWUsIHRydWUpCiAgICBQRUQuU0VUX1BFRF9DQU5fUkFHRE9MTChwZWQsIGZhbHNlKQoKICAgIFBFRC5TRVRfUEVEX0hJR0hMWV9QRVJDRVBUSVZFKHBlZCwgdHJ1ZSkKICAgIFBFRC5TRVRfUEVEX1ZJU1VBTF9GSUVMRF9QRVJJUEhFUkFMX1JBTkdFKHBlZCwgNTAwLjApCiAgICBQRUQuU0VUX1BFRF9TRUVJTkdfUkFOR0UocGVkLCA1MDAuMCkKICAgIFBFRC5TRVRfUEVEX0hFQVJJTkdfUkFOR0UocGVkLCA1MDAuMCkKCiAgICBXRUFQT04uU0VUX1BFRF9JTkZJTklURV9BTU1PX0NMSVAocGVkLCB0cnVlKQogICAgUEVELlNFVF9QRURfU0hPT1RfUkFURShwZWQsIDEwMDAuMCkKICAgIFBFRC5TRVRfUEVEX0FDQ1VSQUNZKHBlZCwgMTAwLjApCiAgICBQRUQuU0VUX1BFRF9DQU5fQkVfU0hPVF9JTl9WRUhJQ0xFKHBlZCwgdHJ1ZSkKCiAgICBQRUQuU0VUX1BFRF9DT01CQVRfQVRUUklCVVRFUyhwZWQsIDUsIHRydWUpIC0tIEFsd2F5c0ZpZ2h0CiAgICBQRUQuU0VUX1BFRF9DT01CQVRfQVRUUklCVVRFUyhwZWQsIDEyLCB0cnVlKSAtLSBCbGluZEZpcmVXaGVuSW5Db3ZlcgogICAgUEVELlNFVF9QRURfQ09NQkFUX0FUVFJJQlVURVMocGVkLCAyNywgdHJ1ZSkgLS0gUGVyZmVjdEFjY3VyYWN5CiAgICBQRUQuU0VUX1BFRF9DT01CQVRfTU9WRU1FTlQocGVkLCAyKQogICAgUEVELlNFVF9QRURfQ09NQkFUX0FCSUxJVFkocGVkLCAyKQogICAgUEVELlNFVF9QRURfQ09NQkFUX1JBTkdFKHBlZCwgMikKICAgIFBFRC5TRVRfUEVEX1RBUkdFVF9MT1NTX1JFU1BPTlNFKHBlZCwgMSkKICAgIFBFRC5TRVRfQ09NQkFUX0ZMT0FUKHBlZCwgMTAsIDUwMC4wKQplbmQKLS3lvLrljJbmiYDmnIlOUEMKZnVuY3Rpb24gaW5jcmVhc2VfYWxsbnBjKCkKICAgIGZvciBfLCBwZWQgaW4gcGFpcnMoZW50aXRpZXMuZ2V0X2FsbF9wZWRzX2FzX2hhbmRsZXMoKSkgZG8KICAgICAgICBpZiBub3QgUEVELklTX1BFRF9BX1BMQVlFUihwZWQpIHRoZW4KICAgICAgICAgICAgaW5jcmVhc2VfbnBjKHBlZCkKICAgICAgICBlbmQKICAgIGVuZAplbmQKCgotLS0tOTEx5LqL5Lu2CmZ1bmN0aW9uIGF0dGFja3NfOTExKCkKICAgIGxvY2FsIHBvcyA9IHt4ID0gLTkxNC4xNzA3LCB5ID0gLTExNjQuOTM5Niwgej0yNTB9CiAgICBsb2NhbCBwbGFuZV9oYXNoID0gdXRpbC5qb2FhdCgnamV0JykKICAgIHJlcXVlc3RfbW9kZWwocGxhbmVfaGFzaCkKICAgIGxvY2FsIHBsYW5lID0gY3JlYXRlX3ZlaGljbGUocGxhbmVfaGFzaCwgcG9zLngsIHBvcy55LCBwb3MueiwgLTY4KQogICAgVkVISUNMRS5TRVRfSEVMSV9CTEFERVNfRlVMTF9TUEVFRChwbGFuZSkKICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRU5HSU5FX09OKHBsYW5lLCB0cnVlLCB0cnVlLCBmYWxzZSkKICAgIFZFSElDTEUuQ09OVFJPTF9MQU5ESU5HX0dFQVIocGxhbmUsIDMpCiAgICBWRUhJQ0xFLlNFVF9QTEFORV9UVVJCVUxFTkNFX01VTFRJUExJRVIocGxhbmUsIDAuMCkKICAgIGZvciBpPTEsIDUgZG8gCiAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9GT1JXQVJEX1NQRUVEKHBsYW5lLCAxNTAuMCkKICAgICAgICB1dGlsLnlpZWxkKDEwMDApCiAgICBlbmQKZW5kCgotLS0t5rS+5Y+q6Zuq5oCqCmZ1bmN0aW9uIHNlbmRfc25vd19tb25zdGVyKHBpZCkKICAgIAogICAgbG9jYWwgaGFzaCA9IC0xOTMxMDQxNjc0CiAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCksIG1hdGgucmFuZG9tKDEwKSwgbWF0aC5yYW5kb20oMTApLCAwKQogICAgbG9jYWwgUGVkcyA9IGNyZWF0ZV9wZWQoNCwgaGFzaCwgcG9zLngsIHBvcy55LCBwb3MueiwgMS4wKQogICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRShQZWRzLHRydWUpCiAgICBUQVNLLlRBU0tfQ09NQkFUX1BFRChQZWRzLCBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSwgMCwgMTYpCmVuZAoKLS0tLU5QQ+eUteWHu+eOqeWutgpmdW5jdGlvbiBzZW5kX3BlZF9zdHVuKHBpZCwgaW5kZXgpCiAgICAKICAgIGxvY2FsIHdlYWhhc2ggPSB7IjExNzExMDI5NjMiLCItNjI0OTUxMjU5In0KICAgIGxvY2FsIHBlZGhhc2ggPSB1dGlsLmpvYWF0KCJ1X21fbV9qZXN1c18wMSIpCiAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCksIG1hdGgucmFuZG9tKDUpLCBtYXRoLnJhbmRvbSg1KSwgMCkKICAgIGxvY2FsIFBlZCA9IGNyZWF0ZV9wZWQoNCwgcGVkaGFzaCwgcG9zLngsIHBvcy55LCBwb3MueiwgMS4wKQogICAgV0VBUE9OLkdJVkVfV0VBUE9OX1RPX1BFRChQZWQsIHdlYWhhc2hbaW5kZXhdLCA5OTk5LCBmYWxzZSwgZmFsc2UpCiAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKFBlZCx0cnVlKQogICAgVEFTSy5UQVNLX0NPTUJBVF9QRUQoUGVkLCBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSwgMCwgMTYpCmVuZAoKLS0tLea2iOmYsui9puaUu+WHuwpmdW5jdGlvbiBmaXJlZmlnaHRlcl90aHJlYWQocGVkLCBwX3BlZCwgdHJ1Y2spCiAgICBUQVNLLlNFVF9UQVNLX1ZFSElDTEVfQ0hBU0VfQkVIQVZJT1JfRkxBRyhwZWQsIDEsIHRydWUpCiAgICBUQVNLLlNFVF9UQVNLX1ZFSElDTEVfQ0hBU0VfSURFQUxfUFVSU1VJVF9ESVNUQU5DRShwZWQsIDEwLjApCiAgICB3aGlsZSBwZWQgZG8KICAgICAgICBpZiBub3QgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKHRydWNrKSBvciBub3QgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKHBlZCkgb3IgRU5USVRZLkdFVF9FTlRJVFlfSEVBTFRIKHRydWNrKSA9PSAwIHRoZW4gCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAogICAgICAgIGxvY2FsIHBlZF9jID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKHBfcGVkLCBtYXRoLnJhbmRvbSgtNSw1KSwgbWF0aC5yYW5kb20oLTUsNSksIDAuMCkKICAgICAgICBsb2NhbCBjID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHRydWNrKQogICAgICAgIGlmIEdldF9kaXN0YW5jZShwZWRfYywgYywgdHJ1ZSkgPj0gMTAgdGhlbiAKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTKHRydWNrLCBwZWRfYy54LCBwZWRfYy55LCBwZWRfYy56KQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9IRUFESU5HKHRydWNrLCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKHBfcGVkKSArIDkwKQogICAgICAgIGVuZAogICAgICAgIFRBU0suVEFTS19WRUhJQ0xFX1NIT09UX0FUX1BFRChwZWQsIHBfcGVkLCAxLjApCiAgICAgICAgdXRpbC55aWVsZCgzMDAwKQogICAgZW5kCmVuZApmdW5jdGlvbiBGaXJldHJ1Y2tfYXR0YWNrKHBpZCkKICAgIAogICAgbG9jYWwgdl9oYXNoID0gdXRpbC5qb2FhdCgnZmlyZXRydWsnKQogICAgbG9jYWwgcF9oYXNoID0gdXRpbC5qb2FhdCgiU19NX1lfRmlyZW1hbl8wMSIpCiAgICBsb2NhbCBwX3BlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICBsb2NhbCBjID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKHBfcGVkLCBtYXRoLnJhbmRvbSgtNSw1KSwgbWF0aC5yYW5kb20oLTUsNSksIDAuMCkgICAgIAogICAgbG9jYWwgdHJ1Y2sgPSBjcmVhdGVfdmVoaWNsZSh2X2hhc2gsIGMueCwgYy55LCBjLnosIEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcocF9wZWQpKQogICAgVkVISUNMRS5TRVRfVkVISUNMRV9TSVJFTih0cnVjaywgdHJ1ZSkKICAgIEVOVElUWS5TRVRfRU5USVRZX0hFQURJTkcodHJ1Y2ssIEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcocF9wZWQpICsgOTApCiAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0VOR0lORV9PTih0cnVjaywgdHJ1ZSwgdHJ1ZSwgZmFsc2UpCiAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX1dFQVBPTl9DQU5fVEFSR0VUX09CSkVDVFModHJ1Y2ssIHRydWUpCiAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0RPT1JTX0xPQ0tFRCh0cnVjaywgMikKICAgIGxvY2FsIHBlZCA9IGNyZWF0ZV9wZWQoMSwgcF9oYXNoLCBjLngsIGMueSwgYy56LCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKHBfcGVkKSkKICAgIFBFRC5TRVRfUEVEX0NPTUJBVF9BVFRSSUJVVEVTKHBlZCwgNSwgdHJ1ZSkKICAgIFBFRC5TRVRfUEVEX0ZMRUVfQVRUUklCVVRFUyhwZWQsIDAsIGZhbHNlKQogICAgUEVELlNFVF9QRURfQ09NQkFUX0FUVFJJQlVURVMocGVkLCA0NiwgdHJ1ZSkgICAgICAgICAgICAKICAgIFRBU0suVEFTS19DT01CQVRfUEVEKHBlZCwgcF9wZWQsIDAsIDE2KQogICAgUEVELlNFVF9QRURfSU5UT19WRUhJQ0xFKHBlZCwgdHJ1Y2ssIC0xKQogICAgVEFTSy5TRVRfVEFTS19WRUhJQ0xFX0NIQVNFX0JFSEFWSU9SX0ZMQUcocGVkLCAxLCB0cnVlKQogICAgVEFTSy5TRVRfVEFTS19WRUhJQ0xFX0NIQVNFX0lERUFMX1BVUlNVSVRfRElTVEFOQ0UocGVkLCAxMC4wKQogICAgVEFTSy5UQVNLX1ZFSElDTEVfQ0hBU0UocGVkLCBwX3BlZCkKICAgIGZpcmVmaWdodGVyX3RocmVhZChwZWQsIHBfcGVkLCB0cnVjaykKICAgIEVOVElUWS5TRVRfRU5USVRZX0lOVklOQ0lCTEUocGVkLCB0cnVlKQogICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRSh0cnVjaywgdHJ1ZSkKZW5kCgoKCgoKCi0tLS3mtL7pgaPorabovaYKZnVuY3Rpb24gc3Bhd25fcG9saWNlX2NhcihwaWQpCiAgICAKICAgIGxvY2FsIHRhcmdldFBlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICBsb2NhbCBvZmZzZXQgPSBnZXRfcmFuZG9tX29mZnNldF9mcm9tX2VudGl0eSh0YXJnZXRQZWQsIDUwLjAsIDYwLjApCiAgICBsb2NhbCBvdXRDb29yZHMgPSB2My5uZXcoKQogICAgbG9jYWwgb3V0SGVhZGluZyA9IG1lbW9yeS5hbGxvYyg0KQogICAgaWYgUEFUSEZJTkQuR0VUX0NMT1NFU1RfVkVISUNMRV9OT0RFX1dJVEhfSEVBRElORyhvZmZzZXQueCwgb2Zmc2V0LnksIG9mZnNldC56LCBvdXRDb29yZHMsIG91dEhlYWRpbmcsIDEsIDMuMCwgMCkgdGhlbgogICAgICAgIGxvY2FsIHZlaGljbGVIYXNoIDxjb25zdD4gPSB1dGlsLmpvYWF0KCJwb2xpY2UzIikKICAgICAgICBsb2NhbCBwZWRIYXNoIDxjb25zdD4gPSB1dGlsLmpvYWF0KCJzX21feV9jb3BfMDEiKQogICAgICAgIHJlcXVlc3RfbW9kZWwodmVoaWNsZUhhc2gpOyByZXF1ZXN0X21vZGVsKHBlZEhhc2gpCgogICAgICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyh0YXJnZXRQZWQsIGZhbHNlKQogICAgICAgIGxvY2FsIHZlaGljbGUgPSBlbnRpdGllcy5jcmVhdGVfdmVoaWNsZSh2ZWhpY2xlSGFzaCwgcG9zLCAwLjApCiAgICAgICAgaWYgbm90IEVOVElUWS5ET0VTX0VOVElUWV9FWElTVCh2ZWhpY2xlKSB0aGVuIHJldHVybiBlbmQKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFModmVoaWNsZSwgb3V0Q29vcmRzLngsIG91dENvb3Jkcy55LCBvdXRDb29yZHMueiwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSEVBRElORyh2ZWhpY2xlLCBtZW1vcnkucmVhZF9mbG9hdChvdXRIZWFkaW5nKSkKICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX1NJUkVOKHZlaGljbGUsIHRydWUpCiAgICAgICAgQVVESU8uQkxJUF9TSVJFTih2ZWhpY2xlKQogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRU5HSU5FX09OKHZlaGljbGUsIHRydWUsIHRydWUsIHRydWUpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRSh2ZWhpY2xlLCB0cnVlKQoKICAgICAgICBsb2NhbCBwU2VxdWVuY2UgPSBtZW1vcnkuYWxsb2NfaW50KCkKICAgICAgICBUQVNLLk9QRU5fU0VRVUVOQ0VfVEFTSyhwU2VxdWVuY2UpCiAgICAgICAgVEFTSy5UQVNLX0NPTUJBVF9QRUQoMCwgdGFyZ2V0UGVkLCAwLCAxNikKICAgICAgICBUQVNLLlRBU0tfR09fVE9fRU5USVRZKDAsIHRhcmdldFBlZCwgNjAwMCwgMTAuMCwgMy4wLCAwLjAsIDApCiAgICAgICAgVEFTSy5TRVRfU0VRVUVOQ0VfVE9fUkVQRUFUKG1lbW9yeS5yZWFkX2ludChwU2VxdWVuY2UpLCB0cnVlKQogICAgICAgIFRBU0suQ0xPU0VfU0VRVUVOQ0VfVEFTSyhtZW1vcnkucmVhZF9pbnQocFNlcXVlbmNlKSkKCiAgICAgICAgZm9yIHNlYXQgPSAtMSwgMCBkbwogICAgICAgICAgICBsb2NhbCBjb3AgPSBlbnRpdGllcy5jcmVhdGVfcGVkKDUsIHBlZEhhc2gsIG91dENvb3JkcywgMC4wKQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9BU19NSVNTSU9OX0VOVElUWShjb3AsIHRydWUsIGZhbHNlKQogICAgICAgICAgICBERUNPUkFUT1IuREVDT1JfU0VUX0lOVChjb3AsICJDYXNpbm9fR2FtZV9JbmZvX0RlY29yYXRvciIsIDEgPDwgMikKICAgICAgICAgICAgUEVELlNFVF9QRURfSU5UT19WRUhJQ0xFKGNvcCwgdmVoaWNsZSwgc2VhdCkKICAgICAgICAgICAgUEVELlNFVF9QRURfUkFORE9NX0NPTVBPTkVOVF9WQVJJQVRJT04oY29wLCAwKQogICAgICAgICAgICBsb2NhbCB3ZWFwb24gPSAoc2VhdCA9PSAtMSkgYW5kICJ3ZWFwb25fcGlzdG9sIiBvciAid2VhcG9uX3B1bXBzaG90Z3VuIgogICAgICAgICAgICBXRUFQT04uR0lWRV9XRUFQT05fVE9fUEVEKGNvcCwgdXRpbC5qb2FhdCh3ZWFwb24pLCAtMSwgZmFsc2UsIHRydWUpCiAgICAgICAgICAgIFBFRC5TRVRfUEVEX0NPTUJBVF9BVFRSSUJVVEVTKGNvcCwgMSwgdHJ1ZSkKICAgICAgICAgICAgUEVELlNFVF9QRURfQVNfQ09QKGNvcCwgdHJ1ZSkKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRShjb3AsIHRydWUpCiAgICAgICAgICAgIFRBU0suVEFTS19QRVJGT1JNX1NFUVVFTkNFKGNvcCwgbWVtb3J5LnJlYWRfaW50KHBTZXF1ZW5jZSkpCiAgICAgICAgZW5kCgogICAgICAgIFRBU0suQ0xFQVJfU0VRVUVOQ0VfVEFTSyhwU2VxdWVuY2UpCiAgICAgICAgQVVESU8uUExBWV9QT0xJQ0VfUkVQT1JUKCJTQ1JJUFRFRF9TQ0FOTkVSX1JFUE9SVF9GUkFOTElOXzBfS0lETkFQIiwgMC4wKQogICAgZW5kCmVuZAoKLS0tLeenu+mZpOi9pumXqApmdW5jdGlvbiByZW1vdmVfZG9vcnMocGlkKQogICAgCiAgICBsb2NhbCB2ZWhpY2xlID0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19JTihQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSwgZmFsc2UpCiAgICByZXF1ZXN0X2NvbnRyb2wodmVoaWNsZSwgMykKICAgIGxvY2FsIGRvb3JzID0gVkVISUNMRS5HRVRfTlVNQkVSX09GX1ZFSElDTEVfRE9PUlModmVoaWNsZSkKICAgIGZvciBpPSAwLCBkb29ycyBkbwogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRE9PUl9CUk9LRU4odmVoaWNsZSwgaSwgZmFsc2UpCiAgICBlbmQKZW5kCi0tLS3liIbnprvovb3lhbfpm7bku7YKZnVuY3Rpb24gZGV0YWNoX3ZlaGljbGVfcGFydHMocGlkKQogICAgCiAgICBsb2NhbCB2ZWhpY2xlID0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19JTihQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSwgZmFsc2UpCiAgICByZXF1ZXN0X2NvbnRyb2wodmVoaWNsZSwgMykKICAgIC0t56e76Zmk6L2m6ZeoCiAgICBsb2NhbCBkb29ycyA9IFZFSElDTEUuR0VUX05VTUJFUl9PRl9WRUhJQ0xFX0RPT1JTKHZlaGljbGUpCiAgICBmb3IgaT0gMCwgZG9vcnMgZG8KICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0RPT1JfQlJPS0VOKHZlaGljbGUsIGksIGZhbHNlKQogICAgZW5kCiAgICAtLeenu+mZpOW8leaTjueblizlkI7lpIfnrrHliY3jgIHlkI4KICAgIGZvciBpPSA0LCA2IGRvCiAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9ET09SX0JST0tFTih2ZWhpY2xlLCBpLCBmYWxzZSkKICAgIGVuZAogICAgLS3liIbnprvovabovobmjKHpo47njrvnkoMKICAgIFZFSElDTEUuUE9QX09VVF9WRUhJQ0xFX1dJTkRTQ1JFRU4odmVoaWNsZSkKICAgIC0t56C05Z2P56qX5oi3CiAgICBmb3IgaSA9IDAsIDcgZG8KICAgICAgICBWRUhJQ0xFLlNNQVNIX1ZFSElDTEVfV0lORE9XKHZlaGljbGUsIGkpCiAgICBlbmQKCiAgICAtLeWIhuemu+i9pui+hui9ruiDjgogICAgZm9yIGkgPSAwLCA1IGRvIAogICAgICAgIGVudGl0aWVzLmRldGFjaF93aGVlbChlbnRpdGllcy5oYW5kbGVfdG9fcG9pbnRlcih2ZWhpY2xlKSwgaSkKICAgIGVuZAplbmQKCgotLS0t54y0546LCmZ1bmN0aW9uIG1vbmtleV9raW5nKCkKICAgIGxvY2FsIG1vbmtleSA9IDB4QTg2ODM3MTUgLS3njLTlrZAKICAgIGxvY2FsIG1vbmtleUtJTkcgPSAweEMyRDA2RjUzIC0t54y0546LCiAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMCwgLTIsIDApCiAgICBjaGFuZ2VfbW9kZWwoUExBWUVSLlBMQVlFUl9JRCgpLCBtb25rZXlLSU5HKQogICAgZm9yIGkgPSAxLCA1IGRvCiAgICAgICAgbG9jYWwgcGVkID0gY3JlYXRlX3BlZCgyOCwgbW9ua2V5LCBwb3MueCwgcG9zLnksIHBvcy56LCA3MikKICAgICAgICBqb2luX2dyb3VwKHBlZCkKICAgIGVuZAplbmQKCgotLS0t5b2p5by55p6qCmZ1bmN0aW9uIFBhaW50YmFsbF9ndW4oKQogICAgaWYgUEVELklTX1BFRF9TSE9PVElORyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSB0aGVuCiAgICAgICAgbG9jYWwgZW50aXR5ID0gZ2V0X2VudGl0eV9wbGF5ZXJfaXNfYWltaW5nX2F0KFBMQVlFUi5QTEFZRVJfSUQoKSkKICAgICAgICBpZiBlbnRpdHkgfj0gTlVMTCBhbmQgRU5USVRZLklTX0VOVElUWV9BX1ZFSElDTEUoZW50aXR5KSBhbmQgcmVxdWVzdF9jb250cm9sKGVudGl0eSkgdGhlbgogICAgICAgICAgICBsb2NhbCBwcmltYXJ5LCBzZWN1bmRhcnkgPSByYW5kb21fY29sb3VyKCksIHJhbmRvbV9jb2xvdXIoKQogICAgICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0NVU1RPTV9QUklNQVJZX0NPTE9VUihlbnRpdHksIHByaW1hcnkuciwgcHJpbWFyeS5nLCBwcmltYXJ5LmIpCiAgICAgICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfQ1VTVE9NX1NFQ09OREFSWV9DT0xPVVIoZW50aXR5LCBzZWN1bmRhcnkuciwgc2VjdW5kYXJ5LmcsIHNlY3VuZGFyeS5iKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKCi0tLS3pgJ/luqbooagKbG9jYWwgZ2VhcnMgPSB7fSAtLeaMoeS9jeWbvuaghwpmb3IgaT0gMCwgNyBkbyAKICAgIGdlYXJzW2ldID0gZGlyZWN0eC5jcmVhdGVfdGV4dHVyZShmaWxlc3lzdGVtLnJlc291cmNlc19kaXIoKSAuLiAnXFxTYWt1cmFTY3JpcHRcXHNwZWVkb21ldGVyXFwnIC4uICcvZ2Vhcl8nIC4uIHRvc3RyaW5nKGkpIC4uICcucG5nJykKZW5kCmxvY2FsIHNwZWVkX251bXMgPSB7fSAtLemAn+W6puWAvOWbvuaghwpmb3IgaT0gMCwgOSBkbyAKICAgIHNwZWVkX251bXNbaV0gPSBkaXJlY3R4LmNyZWF0ZV90ZXh0dXJlKGZpbGVzeXN0ZW0ucmVzb3VyY2VzX2RpcigpIC4uICdcXFNha3VyYVNjcmlwdFxcc3BlZWRvbWV0ZXJcXCcgLi4gJy9tcGhfJyAuLiB0b3N0cmluZyhpKSAuLiAnLnBuZycpCmVuZApsb2NhbCBnYXVnZV9iZyA9IGRpcmVjdHguY3JlYXRlX3RleHR1cmUoZmlsZXN5c3RlbS5yZXNvdXJjZXNfZGlyKCkgLi4gJ1xcU2FrdXJhU2NyaXB0XFxzcGVlZG9tZXRlclxcJyAuLiAnL2RpYWwucG5nJyktLeS4u+S9k+Wbvuaghwpsb2NhbCBuZWVkbGUgPSBkaXJlY3R4LmNyZWF0ZV90ZXh0dXJlKGZpbGVzeXN0ZW0ucmVzb3VyY2VzX2RpcigpIC4uICdcXFNha3VyYVNjcmlwdFxcc3BlZWRvbWV0ZXJcXCcgLi4gJy9uZWVkbGUucG5nJyktLeaMh+mSiOWbvuaghwpsb2NhbCBrcGhfbGFiZWwgPSBkaXJlY3R4LmNyZWF0ZV90ZXh0dXJlKGZpbGVzeXN0ZW0ucmVzb3VyY2VzX2RpcigpIC4uICdcXFNha3VyYVNjcmlwdFxcc3BlZWRvbWV0ZXJcXCcgLi4gJy9rcGhfbGFiZWwucG5nJykgLS3ljZXkvY0KCmxvY2FsIGNhcnBvc1ggPSAwLjg0CmxvY2FsIGNhcnBvc1kgPSAwLjc1CmZ1bmN0aW9uIHNwZWVkb21ldGVyX1goeCkKICAgIGNhcnBvc1ggPSB4IC8gMTAwCmVuZApmdW5jdGlvbiBzcGVlZG9tZXRlcl9ZKHkpCiAgICBjYXJwb3NZID0geSAvIDEwMAplbmQKZnVuY3Rpb24gc3BlZWRvbWV0ZXIoKQogICAgbG9jYWwgY2FyX3B0ciA9IGVudGl0aWVzLmdldF91c2VyX3ZlaGljbGVfYXNfcG9pbnRlcihmYWxzZSkKICAgIGxvY2FsIGNhciA9IGVudGl0aWVzLnBvaW50ZXJfdG9faGFuZGxlKGNhcl9wdHIpCiAgICBpZiBjYXJfcHRyIH49IDAgdGhlbgogICAgICAgIGxvY2FsIHJwbSA9IGVudGl0aWVzLmdldF9ycG0oY2FyX3B0ciktLeavj+WIhumSn+i9rOaVsAogICAgICAgIGxvY2FsIG1heF9yb3RhdGlvbiA9IG1hdGgucmFkKDAuNTAxICogMTgwKSAtLSDpkojlj6/ku6Xovr7liLDnmoTmnIDlpKfml4vovazop5LluqbvvIjlvKfluqbvvIkKCiAgICAgICAgLS0tLeagueaNruaxvei9pueahOmAn+W6puWSjOacgOWkp+mAn+W6puiuoeeul+aJk+aNhumSiOeahOaXi+i9rAogICAgICAgIGxvY2FsIG5lZWRsZV9yb3RhdGlvbiA9IChycG0gLyAxKS8xLjQ4NSAgLSAwLjE3MAogICAgICAgIGxvY2FsIGdlYXIgPSBlbnRpdGllcy5nZXRfY3VycmVudF9nZWFyKGNhcl9wdHIpCiAgICAgICAgZGlyZWN0eC5kcmF3X3RleHR1cmUoZ2F1Z2VfYmcsIDAuMDgsIDAuMDgsIDAuNSwgMC41LCBjYXJwb3NYLCBjYXJwb3NZIC0gMC4wMDQsIDAsIDEsIDEsIDEsIDEpIC0t5Li75Zu+5qCHCiAgICAgICAgZGlyZWN0eC5kcmF3X3RleHR1cmUobmVlZGxlLCAwLjA4LCAwLjA4LCAwLjUsIDAuNSwgY2FycG9zWCwgY2FycG9zWSwgbmVlZGxlX3JvdGF0aW9uLCAxLjAsIDEuMCwgMS4wLCAxKQogICAgICAgIGlmIGdlYXIgPCA4IHRoZW4tLWd0YXYg6L295YW36buY6K6k5pyA6auY5oyh5L2NNyzkvYbnrKzkuInmlrnovoXliqnlj6/ku6Xkv67mlLnlhbblgLws5Y2z6YCg5oiQZ290IG5pbAogICAgICAgICAgICBkaXJlY3R4LmRyYXdfdGV4dHVyZShnZWFyc1tnZWFyXSwgMC4wOCwgMC4wOCwgMC41LCAwLjUsIGNhcnBvc1ggLSAwLjAwMDEsIGNhcnBvc1kgLSAwLjAwNSwgMCwgMSwgMSwgMSwgMSkKICAgICAgICBlbHNlCiAgICAgICAgICAgIGRpcmVjdHguZHJhd190ZXh0dXJlKGdlYXJzWzddLCAwLjA4LCAwLjA4LCAwLjUsIDAuNSwgY2FycG9zWCAtIDAuMDAwMSwgY2FycG9zWSAtIDAuMDA1LCAwLCAxLCAxLCAxLCAxKQogICAgICAgIGVuZAoKICAgICAgICAtLS0t6YCf5bqmCiAgICAgICAgbG9jYWwgc3BlZWQgPSBtYXRoLmNlaWwoRU5USVRZLkdFVF9FTlRJVFlfU1BFRUQoY2FyKSAqIDMuNikKICAgICAgICBsb2NhbCBzcGVlZF9zdHIgPSB0b3N0cmluZyhzcGVlZCkKICAgICAgICBsb2NhbCBjdXJfc3BlZWRfbnVtX29mZnNldCA9IDAKICAgICAgICBmb3IgaT0xLCAjc3BlZWRfc3RyIGRvCiAgICAgICAgICAgIGRpcmVjdHguZHJhd190ZXh0dXJlKHNwZWVkX251bXNbdG9udW1iZXIoc3BlZWRfc3RyOnN1YihpLGkpKV0gLCAwLjA2LCAwLjA2LCAwLjUsIDAuNSwgKGNhcnBvc1gpICsgY3VyX3NwZWVkX251bV9vZmZzZXQgLSAwLjAwNSwgY2FycG9zWSArIDAuMSwgMCwgMS4wLCAxLjAsIDEuMCwgMSkKICAgICAgICAgICAgY3VyX3NwZWVkX251bV9vZmZzZXQgPSBjdXJfc3BlZWRfbnVtX29mZnNldCArIDAuMDYgLyAyCiAgICAgICAgZW5kCgogICAgICAgIC0t6YCf5bqm5Y2V5L2NCiAgICAgICAgY3VyX3NwZWVkX251bV9vZmZzZXQgPSBjdXJfc3BlZWRfbnVtX29mZnNldCArIDAuMDExCiAgICAgICAgZGlyZWN0eC5kcmF3X3RleHR1cmUoa3BoX2xhYmVsLCAwLjA2LCAwLjA2LCAwLjUsIDAuNSwgKGNhcnBvc1gpICsgY3VyX3NwZWVkX251bV9vZmZzZXQgLSAwLjAwNSwgY2FycG9zWSArIDAuMTMsIDAsIDEuMCwgMS4wLCAxLjAsIDEpCiAgICBlbmQKZW5kCgoKLS0tLemUgeWumueOqeWutgpmdW5jdGlvbiBsb2NrX3BsYXllcih0b2dnbGVkKQogICAgbG9ja2VkX3BsYXllciA9IHRvZ2dsZWQKICAgIHdoaWxlIGxvY2tlZF9wbGF5ZXIgZG8KICAgICAgICBmb3IgXywgcGlkIGluIHBsYXllcnMubGlzdChmYWxzZSwgdHJ1ZSwgdHJ1ZSkgZG8KICAgICAgICAgICAgUExBWUVSLkFERF9QTEFZRVJfVEFSR0VUQUJMRV9FTlRJVFkoUExBWUVSLlBMQVlFUl9JRCgpLCBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSkKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSVNfVEFSR0VUX1BSSU9SSVRZKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCBmYWxzZSwgNDAwLjApICAgIAogICAgICAgIGVuZAogICAgICAgIHV0aWwueWllbGQoKQogICAgZW5kCiAgICBmb3IgXywgcGlkIGluIHBsYXllcnMubGlzdChmYWxzZSwgdHJ1ZSwgdHJ1ZSkgZG8KICAgICAgICBQTEFZRVIuUkVNT1ZFX1BMQVlFUl9UQVJHRVRBQkxFX0VOVElUWShQTEFZRVIuUExBWUVSX0lEKCksIFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpKQogICAgZW5kCmVuZAoKLS0tLeWvvOW8uembt+i+vgpmdW5jdGlvbiBNaXNzaWxlX3JhZGFyKCkKICAgIGZvciBrLCBvYmogaW4gcGFpcnMoZW50aXRpZXMuZ2V0X2FsbF9vYmplY3RzX2FzX2hhbmRsZXMoKSkgZG8KICAgICAgICBpZiBpc19lbnRpdHlfYV9wcm9qZWN0aWxlKEVOVElUWS5HRVRfRU5USVRZX01PREVMKG9iaikpIHRoZW4KICAgICAgICAgICAgaWYgSFVELkdFVF9CTElQX0ZST01fRU5USVRZKG9iaikgPT0gMCB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBwcm9qX2JsaXAgPSBIVUQuQUREX0JMSVBfRk9SX0VOVElUWShvYmopCiAgICAgICAgICAgICAgICBIVUQuU0VUX0JMSVBfU1BSSVRFKHByb2pfYmxpcCwgNDQzKQogICAgICAgICAgICAgICAgSFVELlNFVF9CTElQX0NPTE9VUihwcm9qX2JsaXAsIDc1KQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQKLS0tLei9veWFt+ivhuWIqwpmdW5jdGlvbiBWZWhpY2xlX2lkZW50aWZ5KCkKICAgIGxvY2FsIGNvbnRhY3QgPSBkaXJlY3R4LmNyZWF0ZV90ZXh0dXJlKGZpbGVzeXN0ZW0uc2NyaXB0c19kaXIoKSAuLiAnXFxkYWlkYWlTY3JpcHRcXCcgLi4gJ1xcZmxpZ2h0cmVkdXhcXCcuLiAnY29udGFjdC5wbmcnKQogICAgZm9yIGssdmVoIGluIHBhaXJzKGVudGl0aWVzLmdldF9hbGxfdmVoaWNsZXNfYXNfaGFuZGxlcygpKSBkbwogICAgICAgIGxvY2FsIG1kbCA9IEVOVElUWS5HRVRfRU5USVRZX01PREVMKHZlaCkKICAgICAgICBpZiBFTlRJVFkuR0VUX0VOVElUWV9IRUFMVEgodmVoKSA+IDAgdGhlbgogICAgICAgICAgICBsb2NhbCBjID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHZlaCkKICAgICAgICAgICAgbG9jYWwgZHJhd19wb3MgPSB3b3JsZF90b19zY3JlZW5fY29vcmRzKGMueCwgYy55LCBjLnopCiAgICAgICAgICAgIGRpcmVjdHguZHJhd190ZXh0dXJlKGNvbnRhY3QsIDAuMDA1LCAwLjAwNSwgMC41LCAwLjUsIGRyYXdfcG9zLngsIGRyYXdfcG9zLnksIDAsIDAsIDEsIDAsIDEpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgoKLS0tLeWPrOWbnui9veWFtwpmdW5jdGlvbiByZWNhbGxfdmVoaWNsZSgpCiAgICBsb2NhbCBsYXN0Y2FyID0gUExBWUVSLkdFVF9QTEFZRVJTX0xBU1RfVkVISUNMRSgpCiAgICBpZiBsYXN0Y2FyIH49IDAgdGhlbgogICAgICAgIGxvY2FsIGNvb3JkcyA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwLjAsIDUuMCwgMC4wKQogICAgICAgIGxvY2FsIHBlZGhhc2ggPSAtNjc1MzM3MTkKICAgICAgICByZXF1ZXN0X21vZGVsKHBlZGhhc2gpCiAgICAgICAgbG9jYWwgdGVzbGFfcGVkID0gZW50aXRpZXMuY3JlYXRlX3BlZCgzMiwgcGVkaGFzaCwgY29vcmRzLCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1ZJU0lCTEUodGVzbGFfcGVkLCBmYWxzZSwgZmFsc2UpLS3kuI3lj6/op4FOUEMKICAgICAgICBsb2NhbCB0ZXNsYV9ibGlwID0gSFVELkFERF9CTElQX0ZPUl9FTlRJVFkobGFzdGNhcikKICAgICAgICBIVUQuU0VUX0JMSVBfQ09MT1VSKHRlc2xhX2JsaXAsIDcpCiAgICAgICAgUEVELlNFVF9QRURfSU5UT19WRUhJQ0xFKHRlc2xhX3BlZCwgbGFzdGNhciwgLTEpCiAgICAgICAgVEFTSy5UQVNLX1ZFSElDTEVfRFJJVkVfVE9fQ09PUkRfTE9OR1JBTkdFKHRlc2xhX3BlZCwgbGFzdGNhciwgY29vcmRzWyd4J10sIGNvb3Jkc1sneSddLCBjb29yZHNbJ3onXSwgMTUuMCwgNzg2OTk2LCA1KQogICAgICAgIHdoaWxlIHRlc2xhX3BlZCBkbwogICAgICAgICAgICBpZiBQRUQuSVNfUEVEX0dFVFRJTkdfSU5UT19BX1ZFSElDTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgdmVoID0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19FTlRFUklORyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgICAgICAgICAgaWYgdmVoID09IGxhc3RjYXIgdGhlbgogICAgICAgICAgICAgICAgICAgIGRlbGV0ZV9lbnRpdHkodGVzbGFfcGVkKQogICAgICAgICAgICAgICAgICAgIHV0aWwucmVtb3ZlX2JsaXAodGVzbGFfYmxpcCkgCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgdXRpbC55aWVsZCgpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgoKLS0tLeivu+WPluWkluinggpmdW5jdGlvbiByZWFkX2FwcGVhcmFuY2UoKQogICAgbG9jYWwgcGF0aCA9IGZpbGVzeXN0ZW0uc2NyaXB0c19kaXIoKSAuLiAnZGFpZGFpU2NyaXB0L091dGZpdHMvQS10ZXN0LnR4dCcKCiAgICBsb2NhbCBkYXRhID0gZmlsZXJlYWQocGF0aCwgJ3InLCAnKmFsbCcpCiAgICBpZiBkYXRhIH49ICIiIHRoZW4KICAgICAgICBmaWxld3JpdGUocGF0aCwgIncrIiwgIiIpCiAgICBlbmQKCiAgICBmb3IgaSA9IDAsIDExIGRvCiAgICAgICAgbG9jYWwgaW5kZXggPSBQRUQuR0VUX1BFRF9EUkFXQUJMRV9WQVJJQVRJT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgaSktLWRyYXdhYmxlSWQKICAgICAgICBsb2NhbCB0ZXh0dXJlID0gUEVELkdFVF9QRURfVEVYVFVSRV9WQVJJQVRJT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgaSktLXRleHR1cmVJZAoKICAgICAgICBsb2NhbCBrayA9ICJEUkFXQUJMRSAiLi5pLi4iOiAiLi5pbmRleC4uIiwiLi50ZXh0dXJlLi4iXG4iCiAgICAgICAgZmlsZXdyaXRlKHBhdGgsICJhKyIsIGtrKQogICAgZW5kCgogICAgZm9yIGkgPSAwLCA5IGRvCiAgICAgICAgbG9jYWwgaW5kZXggPSBQRUQuR0VUX1BFRF9QUk9QX0lOREVYKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGkpLS1kcmF3YWJsZUlkCiAgICAgICAgbG9jYWwgdGV4dHVyZSA9IFBFRC5HRVRfUEVEX1BST1BfVEVYVFVSRV9JTkRFWChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBpKS0tdGV4dHVyZUlkCgogICAgICAgIGxvY2FsIGtrID0gIlBST1BTICIuLmkuLiI6ICIuLmluZGV4Li4iLCIuLnRleHR1cmUuLiJcbiIKICAgICAgICBmaWxld3JpdGUocGF0aCwgImErIiwga2spCiAgICBlbmQKICAgIHV0aWwudG9hc3QoIuivu+WGmeWujOaIkCIpCmVuZAoKCi0tLS3nqbrkuK3ooYzotbAKZnVuY3Rpb24gd2Fsa19vbl9haXIob24pCiAgICB3YWxrb25haXIgPSBvbgogICAgaWYgd2Fsa29uYWlyIHRoZW4KICAgICAgICB3aGlsZSB3YWxrb25haXIgZG8KICAgICAgICAgICAgLS3mmL7npLrmjInplK4KICAgICAgICAgICAgZGlzcGxheV9idXR0b25zKHt7MCwgMzgsICflkJHkuIonfSx7MSwgNDQsICflkJHkuIsnfX0pCgogICAgICAgICAgICAtLea4hemZpOeBq+eEsCjnlJ/miJDnmoTlrp7kvZPooqvngq7lh7vlj6/og73lrZjlnKjngavnhLApCiAgICAgICAgICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgICAgICBGSVJFLlNUT1BfRklSRV9JTl9SQU5HRShwb3MueCwgcG9zLnksIHBvcy56LCA1MDApCiAgICAgICAgICAgIEZJUkUuU1RPUF9FTlRJVFlfRklSRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSAKCiAgICAgICAgICAgIGlmIG5vdCBQRUQuSVNfUEVEX0lOX0FOWV9WRUhJQ0xFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpIHRoZW4KICAgICAgICAgICAgICAgIGlmIGFpcl9ibG9jayA9PSAwIG9yIG5vdCBFTlRJVFkuRE9FU19FTlRJVFlfRVhJU1QoYWlyX2Jsb2NrKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgaGFzaCA9IDEzNTI3NzU3MTcKICAgICAgICAgICAgICAgICAgICBsb2NhbCBjID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKQogICAgICAgICAgICAgICAgICAgIGFpcmJfaHQgPSBjWyd6J10tMS40CiAgICAgICAgICAgICAgICAgICAgYWlyX2Jsb2NrID0gY3JlYXRlX29iamVjdChoYXNoLCBjWyd4J10sIGNbJ3knXSwgYWlyYl9odCkKICAgICAgICAgICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKGFpcl9ibG9jayx0cnVlKQogICAgICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0FMUEhBKGFpcl9ibG9jaywgMCkKICAgICAgICAgICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9WSVNJQkxFKGFpcl9ibG9jaywgZmFsc2UsIDApCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgICAgICAgICAgICAgIGxvY2FsIGJveF9wb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoYWlyX2Jsb2NrLCBmYWxzZSkKICAgICAgICAgICAgICAgIGlmIEdldF9kaXN0YW5jZShwb3MsIGJveF9wb3MsIHRydWUpID4gMS40IHRoZW4KICAgICAgICAgICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFMoYWlyX2Jsb2NrLCBwb3MueCwgcG9zLnksIHBvcy56LTEuNCwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9IRUFESU5HKGFpcl9ibG9jaywgRU5USVRZLkdFVF9FTlRJVFlfSEVBRElORyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgUEFELklTX0NPTlRST0xfUFJFU1NFRCgwLCAzOCkgdGhlbi0tRQogICAgICAgICAgICAgICAgICAgIGFpcmJfaHQgPSBhaXJiX2h0ICsgMC4xCiAgICAgICAgICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTKGFpcl9ibG9jaywgcG9zLngsIHBvcy55LCBhaXJiX2h0LCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgcG9zLngsIHBvcy55LCBhaXJiX2h0ICsgMS41LCB0cnVlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSEVBRElORyhhaXJfYmxvY2ssIEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGlmIFBBRC5JU19DT05UUk9MX1BSRVNTRUQoMCwgNDQpIHRoZW4tLVEKICAgICAgICAgICAgICAgICAgICBhaXJiX2h0ID0gYWlyYl9odCAtIDAuMQogICAgICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEUyhhaXJfYmxvY2ssIHBvcy54LCBwb3MueSwgYWlyYl9odCwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFNfTk9fT0ZGU0VUKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHBvcy54LCBwb3MueSwgYWlyYl9odCArIDEuNSwgdHJ1ZSwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0hFQURJTkcoYWlyX2Jsb2NrLCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICB1dGlsLnlpZWxkKCkKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICBkZWxldGVfZW50aXR5KGFpcl9ibG9jaykKICAgIGVuZAplbmQKCi0tLS3mgqzmta7mqKHlvI8KZnVuY3Rpb24gbGV2aXRhdGVfbW9kZSh0b2dnbGVkKQogICAgbW92ZW1lbnRfdG9nZ2xlID0gdG9nZ2xlZAogICAgbG9jYWwgdGFyZ2V0X2VudAogICAgd2hpbGUgbW92ZW1lbnRfdG9nZ2xlIGRvCiAgICAgICAgZGlzYWJsZV9jb250cm9sX2FjdGlvbigzNiwgMjEsIDIyLCAzMCwgMzEpCiAgICAgICAgZGlzcGxheV9idXR0b25zKHt7MCwgMjIsICfliqDpgJ8nfSx7MSwgMzYsICfkuIvpmY0nfSx7MiwgMjEsICfkuIrljYcnfX0pCgogICAgICAgIC0t5oGi5aSN5b2i5oCB77yM6Ziy5q2i5Z2g6JC9XOi3s+S8nuWKqOS9nAogICAgICAgIGlmIFBFRC5JU19QRURfRkFMTElORyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSBvciAKICAgICAgICBQRUQuR0VUX1BFRF9QQVJBQ0hVVEVfU1RBVEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgPT0gMCBvciAKICAgICAgICBQRUQuR0VUX1BFRF9QQVJBQ0hVVEVfU1RBVEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgPT0gMSBvciAKICAgICAgICBQRUQuR0VUX1BFRF9QQVJBQ0hVVEVfU1RBVEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgPT0gMiB0aGVuCiAgICAgICAgICAgIFRBU0suQ0xFQVJfUEVEX1RBU0tTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICAgICAgICAgIFRBU0suQ0xFQVJfUEVEX1NFQ09OREFSWV9UQVNLKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICAgICAgZW5kCgogICAgICAgIGlmIFBFRC5JU19QRURfSU5fQU5ZX1ZFSElDTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSkgdGhlbgogICAgICAgICAgICB0YXJnZXRfZW50ID0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19VU0lORyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgIGVsc2UKICAgICAgICAgICAgaWYgRU5USVRZLkdFVF9FTlRJVFlfVFlQRSh0YXJnZXRfZW50KSA9PSAyIHRoZW4KICAgICAgICAgICAgICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKHRhcmdldF9lbnQsIGZhbHNlKQogICAgICAgICAgICAgICAgRU5USVRZLkFQUExZX0ZPUkNFX1RPX0VOVElUWSh0YXJnZXRfZW50LCAwLCAwLjAsIDAuMCwgMC4wLCAwLjAsIDAuMCwgMC4wLCAwLCBmYWxzZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHRhcmdldF9lbnQgPSBQTEFZRVIuUExBWUVSX1BFRF9JRCgpCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIHJvdCA9IENBTS5HRVRfR0FNRVBMQVlfQ0FNX1JPVCg1KS0t5o6n5Yi26KeG6YeOCiAgICAgICAgbG9jYWwgc3BlZWQgPSBQQUQuSVNfRElTQUJMRURfQ09OVFJPTF9QUkVTU0VEKDAsMjIpIGFuZCAzIG9yIDEKICAgICAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTih0YXJnZXRfZW50LCB0cnVlKQogICAgICAgIAoKICAgICAgICBpZiBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsMzIpIHRoZW4tLeWJjei/mwogICAgICAgICAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFModGFyZ2V0X2VudCwgMCwgc3BlZWQsIDApCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQodGFyZ2V0X2VudCwgcG9zLngsIHBvcy55LCBwb3MueiwgdHJ1ZSwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9ST1RBVElPTih0YXJnZXRfZW50LCAwLCAwLCByb3QueiwgNSwgdHJ1ZSkKICAgICAgICBlbmQKICAgICAgICBpZiBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsMzMpIHRoZW4tLeWQjumAgAogICAgICAgICAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFModGFyZ2V0X2VudCwgMCwgLXNwZWVkLCAwKQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFNfTk9fT0ZGU0VUKHRhcmdldF9lbnQsIHBvcy54LCBwb3MueSwgcG9zLnosIHRydWUsIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04odGFyZ2V0X2VudCwgMCwgMCwgcm90LnosIDUsIHRydWUpCiAgICAgICAgZW5kCiAgICAgICAgaWYgUEFELklTX0NPTlRST0xfUFJFU1NFRCgwLDM0KSB0aGVuLS3lt6YKICAgICAgICAgICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKHRhcmdldF9lbnQsIC1zcGVlZCwgMCwgMCkKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTX05PX09GRlNFVCh0YXJnZXRfZW50LCBwb3MueCwgcG9zLnksIHBvcy56LCB0cnVlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKHRhcmdldF9lbnQsIDAsIDAsIHJvdC56LCA1LCB0cnVlKQogICAgICAgIGVuZAogICAgICAgIGlmIFBBRC5JU19DT05UUk9MX1BSRVNTRUQoMCwzNSkgdGhlbi0t5Y+zCiAgICAgICAgICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyh0YXJnZXRfZW50LCBzcGVlZCwgMCwgMCkKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTX05PX09GRlNFVCh0YXJnZXRfZW50LCBwb3MueCwgcG9zLnksIHBvcy56LCB0cnVlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKHRhcmdldF9lbnQsIDAsIDAsIHJvdC56LCA1LCB0cnVlKQogICAgICAgIGVuZAogICAgICAgIGlmIFBBRC5JU19ESVNBQkxFRF9DT05UUk9MX1BSRVNTRUQoMCwyMSkgdGhlbi0t5LiKCiAgICAgICAgICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyh0YXJnZXRfZW50KQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFNfTk9fT0ZGU0VUKHRhcmdldF9lbnQsIHBvcy54LCBwb3MueSwgcG9zLnogKyBzcGVlZCwgdHJ1ZSwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9ST1RBVElPTih0YXJnZXRfZW50LCAwLCAwLCByb3QueiwgNSwgdHJ1ZSkKICAgICAgICBlbmQKICAgICAgICBpZiBQQUQuSVNfRElTQUJMRURfQ09OVFJPTF9QUkVTU0VEKDAsMzYpIHRoZW4tLeS4iwogICAgICAgICAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFModGFyZ2V0X2VudCkKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTX05PX09GRlNFVCh0YXJnZXRfZW50LCBwb3MueCwgcG9zLnksIHBvcy56IC0gc3BlZWQsIHRydWUsIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04odGFyZ2V0X2VudCwgMCwgMCwgcm90LnosIDUsIHRydWUpCiAgICAgICAgZW5kCgogICAgICAgIHV0aWwueWllbGQoKQogICAgZW5kCiAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKHRhcmdldF9lbnQsIGZhbHNlKQogICAgRU5USVRZLkFQUExZX0ZPUkNFX1RPX0VOVElUWSh0YXJnZXRfZW50LCAwLCAwLjAsIDAuMCwgMC4wLCAwLjAsIDAuMCwgMC4wLCAwLCBmYWxzZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkKZW5kCgotLS0t5a+86Iiq5Yiw5pyA6L+R55qE5Yqg5rK556uZCmZ1bmN0aW9uIEdldENsb3Nlc3RHYXNTdGF0aW9uKCkKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKCWxvY2FsIGNvb3JkCglsb2NhbCBkaXN0YW5jZQoJZm9yIF8sIHYgaW4gaXBhaXJzKEdBU19TVEFUSU9OX0NPT1JEUykgZG8KCQlsb2NhbCBkaXN0ID0gR2V0X2Rpc3RhbmNlKHYsIHBvcywgdHJ1ZSkKCQlpZiBub3QgZGlzdGFuY2Ugb3IgKGRpc3RhbmNlIGFuZCBkaXN0YW5jZSA+IGRpc3QpIHRoZW4KCQkJZGlzdGFuY2UgPSBkaXN0CgkJCWNvb3JkID0gdgoJCWVuZAogICAgICAgIHV0aWwueWllbGQoKQoJZW5kCglIVUQuU0VUX05FV19XQVlQT0lOVChjb29yZC54LCBjb29yZC55KQplbmQKCgotLS0t5LiW55WM6L2w54K4CmZ1bmN0aW9uIFdvcmxkX0JvbWJpbmcoKQogICAgbG9jYWwgYWxsdmVoID0gZW50aXRpZXMuZ2V0X2FsbF92ZWhpY2xlc19hc19oYW5kbGVzKCkKCWxvY2FsIGFsbHBlZHMgPSBlbnRpdGllcy5nZXRfYWxsX3BlZHNfYXNfaGFuZGxlcygpCglsb2NhbCBhbGxvYmogPSBlbnRpdGllcy5nZXRfYWxsX29iamVjdHNfYXNfaGFuZGxlcygpCgl1dGlsLnlpZWxkKDEwMCkKCWxvY2FsIHZlbCwgdmVsbyA9IHt9LCB7fQoJdmVsby54ID0gMC4wCgl2ZWxvLnkgPSAwLjAKCXZlbG8ueiA9IDEwMDAuMDAKICAgIGxvY2FsIG15dmVoID0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19JTihQTEFZRVIuR0VUX1BMQVlFUl9QRUQoUExBWUVSLlBMQVlFUl9JRCgpKSwgZmFsc2UpCglmb3IgaSA9IDEsICNhbGxwZWRzIGRvCgkJaWYgbm90IFBFRC5JU19QRURfQV9QTEFZRVIoYWxscGVkc1tpXSkgdGhlbgoJCQl2ZWwueCA9IG1hdGgucmFuZG9tKDEwMDAuMCwgMTAwMDAuMCkKCQkJdmVsLnkgPSBtYXRoLnJhbmRvbSgxMDAwLjAsIDEwMDAwLjApCgkJCXZlbC56ID0gbWF0aC5yYW5kb20oMTAwMC4wLCA3NTAwLjApCgkJCUVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKGFsbHBlZHNbaV0sIGZhbHNlKQogICAgICAgICAgICBFTlRJVFkuQVBQTFlfRk9SQ0VfVE9fRU5USVRZKGFsbHBlZHNbaV0sIDUsIDEwMC4wLCAxMDAuMCwgMTAwLjAsIDEwMC4wLCAxMDAuMCwgMTAwLjAsIDAsIDEsIDEsIDEsIDAsIDEpCgkJCUVOVElUWS5TRVRfRU5USVRZX1ZFTE9DSVRZKGFsbHBlZHNbaV0sIHZlbC54LCB2ZWwueSwgdmVsLnopCgkJZW5kCgllbmQKCWZvciB5ID0gMSwgI2FsbHZlaCBkbwoJCWlmIGFsbHZlaFt5XSB+PSBteXZlaCB0aGVuCgkJCXZlbC54ID0gbWF0aC5yYW5kb20oMTAwMC4wLCAxMDAwMC4wKQoJCQl2ZWwueSA9IG1hdGgucmFuZG9tKDEwMDAuMCwgMTAwMDAuMCkKCQkJdmVsLnogPSBtYXRoLnJhbmRvbSgxMDAwLjAsIDc1MDAuMCkKCQkJRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04oYWxsdmVoW3ldLCBmYWxzZSkKCQkJVkVISUNMRS5TRVRfVkVISUNMRV9HUkFWSVRZKGFsbHZlaFt5XSwgZmFsc2UpCgkJCUVOVElUWS5TRVRfRU5USVRZX1ZFTE9DSVRZKGFsbHZlaFt5XSwgdmVsby54LCB2ZWxvLnksIHZlbG8ueikKCQkJdXRpbC55aWVsZCgyNSkKCQkJRU5USVRZLlNFVF9FTlRJVFlfVkVMT0NJVFkoYWxsdmVoW3ldLCB2ZWwueCwgdmVsLnksIHZlbC56KQoJCWVuZAoJZW5kCglmb3IgeCA9IDEsICNhbGxvYmogZG8KCQl2ZWwueCA9IG1hdGgucmFuZG9tKDEwMDAuMCwgMTAwMDAuMCkKCQl2ZWwueSA9IG1hdGgucmFuZG9tKDEwMDAuMCwgMTAwMDAuMCkKCQl2ZWwueiA9IG1hdGgucmFuZG9tKDEwMDAuMCwgNzUwMC4wKQoJCUVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKGFsbG9ialt4XSwgZmFsc2UpCgkJRU5USVRZLlNFVF9FTlRJVFlfVkVMT0NJVFkoYWxsb2JqW3hdLCB2ZWwueCwgdmVsLnksIHZlbC56KQoJZW5kCmVuZAoKLS0tLempvumptui0reeJqei9pgpmdW5jdGlvbiBkcml2ZV9zaG9wcGluZ19jYXJ0KCkKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgIGxvY2FsIHZlaCA9IGNyZWF0ZV92ZWhpY2xlKDEzNTMxMjA2NjgsIHBvcy54LCBwb3MueSwgcG9zLnosIEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkpCiAgICBFTlRJVFkuU0VUX0VOVElUWV9BTFBIQSh2ZWgsIDAsIGZhbHNlKQogICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRSh2ZWgsIHRydWUpCiAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0VOR0lORV9PTih2ZWgsIHRydWUsIHRydWUsIGZhbHNlKQogICAgUEVELlNFVF9QRURfSU5UT19WRUhJQ0xFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHZlaCwgLTEpCgogICAgbG9jYWwgb2JqX2hhc2ggPSB1dGlsLmpvYWF0KCJwcm9wX3J1Yl90cm9sbGV5MDJhIikKICAgIGxvY2FsIG9iaiA9IGNyZWF0ZV9vYmplY3Qob2JqX2hhc2gsIHBvcy54LCBwb3MueSwgcG9zLnopCiAgICBFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkob2JqLCB2ZWgsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIHRydWUsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDAsIHRydWUsIDApCmVuZAoKCi0t5Yay5rWqCmZ1bmN0aW9uIHN1cmYoKQogICAgaWYgbm90IGlzX2VudGl0eV9vbl93YXRlcihQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSB0aGVuCiAgICAgICAgbm90aWZpY2F0aW9uKCJ+eX5+Ym9sZH7kuI3lnKjmsLTkuIo6KSIsIEh1ZENvbG91ci5ibHVlKQogICAgICAgIHJldHVybgogICAgZW5kCiAgICBsb2NhbCB2ZWhfaGFzaCA9IC0zMTEwMjIyNjMgLS3ovb3lhbcKICAgIGxvY2FsIHN1cmZib2FyZF9oYXNoID0gNTkxNDAyODAgLS3lhrLmtarmnb8KICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgcmVxdWVzdF9tb2RlbHModmVoX2hhc2gsc3VyZmJvYXJkX2hhc2gpCiAgICBsb2NhbCBwZWQgPSBQRUQuQ0xPTkVfUEVEKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUsIGZhbHNlLCB0cnVlKQogICAgbG9jYWwgdmVoID0gIFZFSElDTEUuQ1JFQVRFX1ZFSElDTEUodmVoX2hhc2gsIHBvcy54LCBwb3MueSwgcG9zLnosIEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSksIHRydWUsIHRydWUsIGZhbHNlKQogICAgbG9jYWwgc3VyZmJvYXJkID0gT0JKRUNULkNSRUFURV9PQkpFQ1Qoc3VyZmJvYXJkX2hhc2gsIHBvcy54LCBwb3MueSwgcG9zLnosIHRydWUsIGZhbHNlLCB0cnVlKQogICAgUEVELlNFVF9QRURfSU5UT19WRUhJQ0xFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHZlaCwgLTEpCiAgICBFTlRJVFkuU0VUX0VOVElUWV9WSVNJQkxFKHZlaCwgZmFsc2UsIGZhbHNlKQogICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKHN1cmZib2FyZCwgdmVoLCAwLCAwLCAwLCAwLCAyNzAsIDAsIDAsIHRydWUsIGZhbHNlLCBmYWxzZSwgdHJ1ZSwgMCwgdHJ1ZSwgMCkKICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWShwZWQsIHN1cmZib2FyZCwgMCwgMCwgLTEsIDAsIDkwLCAtOTAsIDAsIHRydWUsIGZhbHNlLCBmYWxzZSwgdHJ1ZSwgMCwgdHJ1ZSwgMCkKICAgIAogICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRSh2ZWgsdHJ1ZSkKICAgIEVOVElUWS5TRVRfRU5USVRZX0FMUEhBKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDAsIGZhbHNlKQogICAgd2hpbGUgcGVkIGRvCgogICAgICAgIHJlcXVlc3RfYW5pbV9kaWN0KCJtb3ZlX3N0cmFmZUBmaXJzdF9wZXJzb25AZHJ1bmsiKQogICAgICAgIFRBU0suVEFTS19QTEFZX0FOSU0ocGVkLCAibW92ZV9zdHJhZmVAZmlyc3RfcGVyc29uQGRydW5rIiwgImlkbGUiLCA4LjAsIC04LjAsIC0xLCAxLCAwLjAsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCgogICAgICAgIGxvY2FsIGNhciA9IFBFRC5HRVRfVkVISUNMRV9QRURfSVNfSU4oUExBWUVSLkdFVF9QTEFZRVJfUEVEKFBMQVlFUi5QTEFZRVJfSUQoKSksIGZhbHNlKQogICAgICAgIGlmIG5vdCBQRUQuSVNfUEVEX0lOX0FOWV9WRUhJQ0xFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpIGFuZCBFTlRJVFkuRE9FU19FTlRJVFlfRVhJU1QodmVoKSBhbmQgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKHN1cmZib2FyZCkgdGhlbi0t5LiL6L2m5Yig6ZmkCiAgICAgICAgICAgIGRlbGV0ZV9lbnRpdHkodmVoLCBwZWQsIHN1cmZib2FyZCkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZWxzZWlmIGNhciB+PSB2ZWggYW5kIEVOVElUWS5ET0VTX0VOVElUWV9FWElTVCh2ZWgpIGFuZCBFTlRJVFkuRE9FU19FTlRJVFlfRVhJU1Qoc3VyZmJvYXJkKSB0aGVuLS3mjaLovabliKDpmaQKICAgICAgICAgICAgZGVsZXRlX2VudGl0eSh2ZWgsIHBlZCwgc3VyZmJvYXJkKQogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbmQKCiAgICAgICAgdXRpbC55aWVsZCgpCiAgICBlbmQKZW5kCgotLS0t5pyA5aSn55Sf5ZG95YC8CmxvY2FsIG1vZGRlZEhlYWx0aCA9IDMyOApmdW5jdGlvbiBtYXhfaGVhbHRoX2xvb3AoKQogICAgUEVELlNFVF9QRURfTUFYX0hFQUxUSChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBtb2RkZWRIZWFsdGgpCiAgICBFTlRJVFkuU0VUX0VOVElUWV9IRUFMVEgoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgbW9kZGVkSGVhbHRoLCAwKQogICAgbG9jYWwgaGVhbHRoID0gRU5USVRZLkdFVF9FTlRJVFlfSEVBTFRIKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICBsb2NhbCBzdHJnID0gIn5ifiBIRUFMVEggfnd+ICIuLmhlYWx0aAogICAgZHJhd19zdHJpbmcoc3RyZywgMC4wMywgMC4wNSwgMC42LCA0KQplbmQKZnVuY3Rpb24gc2V0X21heF9oZWFsdGgodmFsdWUpCiAgICBtb2RkZWRIZWFsdGggPSB2YWx1ZQplbmQKCgotLS0t5YWJ57q/5oqV5b2x57uY5Yi2CmZ1bmN0aW9uIHJheWNhc3RfZ2FtZXBsYXlfY2FtKGZsYWcsIGRpc3RhbmNlKQogICAgbG9jYWwgcHRyMSwgcHRyMiwgcHRyMywgcHRyNCA9IG1lbW9yeS5hbGxvYygpLCBtZW1vcnkuYWxsb2MoKSwgbWVtb3J5LmFsbG9jKCksIG1lbW9yeS5hbGxvYygpCiAgICBsb2NhbCBjYW1fcm90ID0gQ0FNLkdFVF9HQU1FUExBWV9DQU1fUk9UKDIpCiAgICBsb2NhbCBjYW1fcG9zID0gQ0FNLkdFVF9HQU1FUExBWV9DQU1fQ09PUkQoKQogICAgbG9jYWwgZGlyZWN0aW9uID0gdG9EaXJlY3Rpb24oQ0FNLkdFVF9HQU1FUExBWV9DQU1fUk9UKDApKQogICAgbG9jYWwgZGVzdGluYXRpb24gPQogICAgewogICAgICAgIHggPSBjYW1fcG9zLnggKyBkaXJlY3Rpb24ueCAqIGRpc3RhbmNlLAogICAgICAgIHkgPSBjYW1fcG9zLnkgKyBkaXJlY3Rpb24ueSAqIGRpc3RhbmNlLAogICAgICAgIHogPSBjYW1fcG9zLnogKyBkaXJlY3Rpb24ueiAqIGRpc3RhbmNlCiAgICB9CiAgICBTSEFQRVRFU1QuR0VUX1NIQVBFX1RFU1RfUkVTVUxUKAogICAgICAgIFNIQVBFVEVTVC5TVEFSVF9FWFBFTlNJVkVfU1lOQ0hST05PVVNfU0hBUEVfVEVTVF9MT1NfUFJPQkUoCiAgICAgICAgICAgIGNhbV9wb3MueCwKICAgICAgICAgICAgY2FtX3Bvcy55LAogICAgICAgICAgICBjYW1fcG9zLnosCiAgICAgICAgICAgIGRlc3RpbmF0aW9uLngsCiAgICAgICAgICAgIGRlc3RpbmF0aW9uLnksCiAgICAgICAgICAgIGRlc3RpbmF0aW9uLnosCiAgICAgICAgICAgIGZsYWcsCiAgICAgICAgICAgIC0xLAogICAgICAgICAgICAxCiAgICAgICAgKSwgcHRyMSwgcHRyMiwgcHRyMywgcHRyNCkKICAgIGxvY2FsIHAxID0gbWVtb3J5LnJlYWRfaW50KHB0cjEpCiAgICBsb2NhbCBwMiA9IG1lbW9yeS5yZWFkX3ZlY3RvcjMocHRyMikKICAgIGxvY2FsIHAzID0gbWVtb3J5LnJlYWRfdmVjdG9yMyhwdHIzKQogICAgbG9jYWwgcDQgPSBtZW1vcnkucmVhZF9pbnQocHRyNCkKICAgIHJldHVybiB7cDEsIHAyLCBwMywgcDR9CmVuZAoKCi0tLS3ojrflj5bmqKHlnovlsLrlr7gKZnVuY3Rpb24gZ2V0X21vZGVsX3NpemUoaGFzaCkKICAgIGxvY2FsIG1pbnB0ciA9IG1lbW9yeS5hbGxvYygyNCkKICAgIGxvY2FsIG1heHB0ciA9IG1lbW9yeS5hbGxvYygyNCkKICAgIE1JU0MuR0VUX01PREVMX0RJTUVOU0lPTlMoaGFzaCwgbWlucHRyLCBtYXhwdHIpCiAgICBsb2NhbCBtaW4gPSBtZW1vcnkucmVhZF92ZWN0b3IzKG1pbnB0cikKICAgIGxvY2FsIG1heCA9IG1lbW9yeS5yZWFkX3ZlY3RvcjMobWF4cHRyKQogICAgbG9jYWwgc2l6ZSA9IHt9CiAgICBzaXplWyd4J10gPSBtYXhbJ3gnXSAtIG1pblsneCddCiAgICBzaXplWyd5J10gPSBtYXhbJ3knXSAtIG1pblsneSddCiAgICBzaXplWyd6J10gPSBtYXhbJ3onXSAtIG1pblsneiddCiAgICBzaXplWydtYXgnXSA9IG1hdGgubWF4KHNpemVbJ3gnXSwgc2l6ZVsneSddLCBzaXplWyd6J10pCiAgICByZXR1cm4gc2l6ZQplbmQKCi0tLS3liKDpmaTniankvZMKZnVuY3Rpb24gZGVsZXRlX29iamVjdChtb2RlbCkKICAgIGxvY2FsIGhhc2ggPSB1dGlsLmpvYWF0KG1vZGVsKQogICAgZm9yIGssIG9iamVjdCBpbiBwYWlycyhlbnRpdGllcy5nZXRfYWxsX29iamVjdHNfYXNfaGFuZGxlcygpKSBkbwogICAgICAgIGlmIEVOVElUWS5HRVRfRU5USVRZX01PREVMKG9iamVjdCkgPT0gaGFzaCB0aGVuCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0FTX01JU1NJT05fRU5USVRZKG9iamVjdCwgZmFsc2UsIGZhbHNlKSAKICAgICAgICAgICAgZGVsZXRlX2VudGl0eShvYmplY3QpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgotLS0tVUZP5byV5YqbCmZ1bmN0aW9uIFVGT19ncmF2aXRhdGlvbihwaWQpCiAgICAKICAgIGxvY2FsIGNvb3JkcyA9IHBsYXllcnMuZ2V0X3Bvc2l0aW9uKHBpZCkKICAgIGNvb3Jkcy56ID0gY29vcmRzLnogKyA2MwogICAgbG9jYWwgdWZvTW9kZWwgPSBNSVNDLkdFVF9IQVNIX0tFWSgicF9zcGlubmluZ19hbnVzX3MiKQogICAgbG9jYWwgdWZvID0gZW50aXRpZXMuY3JlYXRlX29iamVjdCh1Zm9Nb2RlbCwgY29vcmRzKQogICAgbG9jYWwgcGxheWVyID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgIGxvY2FsIHZlaGljbGUgPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0lOKHBsYXllciwgZmFsc2UpCgogICAgaWYgUEVELklTX1BFRF9JTl9WRUhJQ0xFKHBsYXllciwgdmVoaWNsZSwgZmFsc2UpIHRoZW4KICAgICAgICByZXF1ZXN0X2NvbnRyb2wodmVoaWNsZSwgMykKICAgICAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCksIGZhbHNlKQogICAgICAgIFZFSElDTEUuQlJJTkdfVkVISUNMRV9UT19IQUxUKHZlaGljbGUsIDAuMCwgMSwgZmFsc2UpCiAgICAgICAgRklSRS5BRERfRVhQTE9TSU9OKHBvcy54LCBwb3MueSwgcG9zLnosIDgzLCAxMDAuMCwgZmFsc2UsIHRydWUsIDAuMCkKICAgICAgICB1dGlsLnlpZWxkKDEwMDApCiAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9FTkdJTkVfT04odmVoaWNsZSwgZmFsc2UsIHRydWUsIHRydWUpCiAgICAgICAgRU5USVRZLkFQUExZX0ZPUkNFX1RPX0VOVElUWSh2ZWhpY2xlLCAxLCAwLjAsIDAuMCwgNjUsIDAuMCwgMC4wLCAwLjAsIDEsIGZhbHNlLCB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlKQogICAgICAgIHV0aWwueWllbGQoNjAwMCkKICAgICAgICBkZWxldGVfZW50aXR5KHVmbykKICAgIGVsc2UKICAgICAgICBkZWxldGVfZW50aXR5KHVmbykKICAgICAgICB1dGlsLnRvYXN0KCLnm67moIfkuI3lnKjovabovobkuK0iKSAKICAgIGVuZAplbmQKCi0tLS3pmLLltKnop4bop5IKZnVuY3Rpb24gYW50aV9jcmFzaF9jYW0odG9nZ2xlZCkKICAgIGlmIHRvZ2dsZWQgdGhlbgogICAgICAgIGlmIG5vdCBDQU0uRE9FU19DQU1fRVhJU1QoYW50aUNyYXNoQ2FtKSB0aGVuCiAgICAgICAgICAgIGFudGlDcmFzaENhbSA9IENBTS5DUkVBVEVfQ0FNX1dJVEhfUEFSQU1TKCJERUZBVUxUX1NDUklQVEVEX0NBTUVSQSIsIC0xMDAwMCwgLTEwMDAwLCAzMDAwLCAwLCAwLCA5MCwgNzAsIHRydWUsIDEpCiAgICAgICAgZW5kCiAgICAgICAgQ0FNLlJFTkRFUl9TQ1JJUFRfQ0FNUyh0cnVlLCB0cnVlLCAxLCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgICAgIENBTS5TRVRfQ0FNX0FDVElWRShhbnRpQ3Jhc2hDYW0sIHRydWUpCiAgICAgICAgUExBWUVSLlNFVF9QTEFZRVJfQ09OVFJPTChQTEFZRVIuUExBWUVSX0lEKCksIGZhbHNlLCAwKQogICAgZWxzZQogICAgICAgIENBTS5TRVRfQ0FNX0FDVElWRShhbnRpQ3Jhc2hDYW0sIGZhbHNlKQogICAgICAgIENBTS5SRU5ERVJfU0NSSVBUX0NBTVMoZmFsc2UsIHRydWUsIDEwLCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgICAgIENBTS5ERVNUUk9ZX0NBTShhbnRpQ3Jhc2hDYW0sIGZhbHNlKQogICAgICAgIFBMQVlFUi5TRVRfUExBWUVSX0NPTlRST0woUExBWUVSLlBMQVlFUl9JRCgpLCB0cnVlLCAwKQogICAgZW5kCmVuZAoKLS0tLeemgeatoumVnOWktOaKluWKqApmdW5jdGlvbiBibG9ja19jYW1fc2hha2UoKQogICAgaWYgQ0FNLklTX0dBTUVQTEFZX0NBTV9TSEFLSU5HKCkgdGhlbgogICAgICAgIENBTS5TSEFLRV9HQU1FUExBWV9DQU0oIkNMVUJfREFOQ0VfU0hBS0UiLCAwLjApCiAgICAgICAgQ0FNLlNIQUtFX0dBTUVQTEFZX0NBTSgiREFNUEVEX0hBTkRfU0hBS0UiLCAwLjApCiAgICAgICAgQ0FNLlNIQUtFX0dBTUVQTEFZX0NBTSgiREVBVEhfRkFJTF9JTl9FRkZFQ1RfU0hBS0UiLCAwLjApCiAgICAgICAgQ0FNLlNIQUtFX0dBTUVQTEFZX0NBTSgiRFJPTkVfQk9PU1RfU0hBS0UiLCAwLjApCiAgICAgICAgQ0FNLlNIQUtFX0dBTUVQTEFZX0NBTSgiRFJVTktfU0hBS0UiLCAwLjApCiAgICAgICAgQ0FNLlNIQUtFX0dBTUVQTEFZX0NBTSgiRkFNSUxZNV9EUlVHX1RSSVBfU0hBS0UiLCAwLjApCiAgICAgICAgQ0FNLlNIQUtFX0dBTUVQTEFZX0NBTSgiZ2FtZXBsYXlfZXhwbG9zaW9uX3NoYWtlIiwgMC4wKQogICAgICAgIENBTS5TSEFLRV9HQU1FUExBWV9DQU0oIkdSRU5BREVfRVhQTE9TSU9OX1NIQUtFIiwgMC4wKQogICAgICAgIENBTS5TSEFLRV9HQU1FUExBWV9DQU0oIkdVTlJVTk5JTkdfQlVNUF9TSEFLRSIsIDAuMCkKICAgICAgICBDQU0uU0hBS0VfR0FNRVBMQVlfQ0FNKCJHVU5SVU5OSU5HX0VOR0lORV9TVEFSVF9TSEFLRSIsIDAuMCkKICAgICAgICBDQU0uU0hBS0VfR0FNRVBMQVlfQ0FNKCJHVU5SVU5OSU5HX0VOR0lORV9TVE9QX1NIQUtFIiwgMC4wKQogICAgICAgIENBTS5TSEFLRV9HQU1FUExBWV9DQU0oIkdVTlJVTk5JTkdfTE9PUF9TSEFLRSIsIDAuMCkKICAgICAgICBDQU0uU0hBS0VfR0FNRVBMQVlfQ0FNKCJIQU5EX1NIQUtFIiwgMC4wKQogICAgICAgIENBTS5TSEFLRV9HQU1FUExBWV9DQU0oIkhJR0hfRkFMTF9TSEFLRSIsIDAuMCkKICAgICAgICBDQU0uU0hBS0VfR0FNRVBMQVlfQ0FNKCJqb2x0X1NIQUtFIiwgMC4wKQogICAgICAgIENBTS5TSEFLRV9HQU1FUExBWV9DQU0oIkxBUkdFX0VYUExPU0lPTl9TSEFLRSIsIDAuMCkKICAgICAgICBDQU0uU0hBS0VfR0FNRVBMQVlfQ0FNKCJNRURJVU1fRVhQTE9TSU9OX1NIQUtFIiwgMC4wKQogICAgICAgIENBTS5TSEFLRV9HQU1FUExBWV9DQU0oIlBMQU5FX1BBUlRfU1BFRURfU0hBS0UiLCAwLjApCiAgICAgICAgQ0FNLlNIQUtFX0dBTUVQTEFZX0NBTSgiUk9BRF9WSUJSQVRJT05fU0hBS0UiLCAwLjApCiAgICAgICAgQ0FNLlNIQUtFX0dBTUVQTEFZX0NBTSgiU0tZX0RJVklOR19TSEFLRSIsIDAuMCkKICAgICAgICBDQU0uU0hBS0VfR0FNRVBMQVlfQ0FNKCJTTUFMTF9FWFBMT1NJT05fU0hBS0UiLCAwLjApCiAgICAgICAgQ0FNLlNIQUtFX0dBTUVQTEFZX0NBTSgiVklCUkFURV9TSEFLRSIsIDAuMCkKCiAgICAgICAgQ0FNLlNFVF9HQU1FUExBWV9DQU1fU0hBS0VfQU1QTElUVURFKDAuMDAxKQogICAgICAgIENBTS5TVE9QX0dBTUVQTEFZX0NBTV9TSEFLSU5HKHRydWUpCiAgICBlbmQKZW5kCgotLS0tUkdC6ZqP5py66aKc6ImyCmZ1bmN0aW9uIHJhbmRvbV9jb2xvdXIoKQoJbG9jYWwgY29sb3VyID0ge2EgPSAyNTV9Cgljb2xvdXIuciA9IG1hdGgucmFuZG9tKDAsMjU1KQoJY29sb3VyLmcgPSBtYXRoLnJhbmRvbSgwLDI1NSkKCWNvbG91ci5iID0gbWF0aC5yYW5kb20oMCwyNTUpCglyZXR1cm4gY29sb3VyCmVuZAotLS0t5riQ5Y+YUkdC6aKc6ImyCmZ1bmN0aW9uIGdyYWRpZW50X2NvbG91cih0aW1lciwgZnJlcXVlbmN5KQogICAgbG9jYWwgY29sb3VyID0ge2EgPSAyNTV9CiAgICBsb2NhbCBjdXJ0aW1lID0gdGltZXIgLyAxMDAwIAogICAgY29sb3VyLnIgPSBtYXRoLmZsb29yKCBtYXRoLnNpbiggY3VydGltZSAqIGZyZXF1ZW5jeSArIDAgKSAqIDEyNyArIDEyOCApCiAgICBjb2xvdXIuZyA9IG1hdGguZmxvb3IoIG1hdGguc2luKCBjdXJ0aW1lICogZnJlcXVlbmN5ICsgMiApICogMTI3ICsgMTI4ICkKICAgIGNvbG91ci5iID0gbWF0aC5mbG9vciggbWF0aC5zaW4oIGN1cnRpbWUgKiBmcmVxdWVuY3kgKyA0ICkgKiAxMjcgKyAxMjggKQogICAgcmV0dXJuIGNvbG91cgplbmQKCi0tLS3ojrflj5bniLHlv4PlvaLnirblnZDmoIfooagKZnVuY3Rpb24gZ2VuZXJhdGVfaGVhcnRfY29vcmRpbmF0ZXMoY2VudGVyX3gsIGNlbnRlcl95LCBudW1fcG9pbnRzLCBzY2FsZSkKICAgIGxvY2FsIGNvb3JkaW5hdGVzID0ge30KICAgIGxvY2FsIHBpID0gbWF0aC5waQoKICAgIGZvciBpID0gMCwgbnVtX3BvaW50cyBkbwogICAgICAgIGxvY2FsIHQgPSAoaSAvIG51bV9wb2ludHMpICogMiAqIHBpCiAgICAgICAgbG9jYWwgeCA9IDE2ICogbWF0aC5zaW4odCleMyAqIHNjYWxlCiAgICAgICAgbG9jYWwgeSA9ICgxMyAqIG1hdGguY29zKHQpIC0gNSAqIG1hdGguY29zKDIgKiB0KSAtIDIgKiBtYXRoLmNvcygzICogdCkgLSBtYXRoLmNvcyg0ICogdCkpICogc2NhbGUKICAgICAgICAKICAgICAgICAtLSDlubPnp7vlnZDmoIfliLDmjIflrprkuK3lv4PngrkKICAgICAgICB0YWJsZS5pbnNlcnQoY29vcmRpbmF0ZXMsIHt4ICsgY2VudGVyX3gsIHkgKyBjZW50ZXJfeX0pCiAgICBlbmQKCiAgICByZXR1cm4gY29vcmRpbmF0ZXMKZW5kCi0t6Jyh54Ob5p6qCmZ1bmN0aW9uIGNhbmRsZV9ndW4oKQogICAgbG9jYWwgcG9zID0gdjMubmV3KCkKICAgIGlmIFdFQVBPTi5HRVRfUEVEX0xBU1RfV0VBUE9OX0lNUEFDVF9DT09SRChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBwb3MpIHRoZW4KICAgICAgICAtLSDnlJ/miJDniLHlv4PlvaLnirbnmoTlnZDmoIfooajvvIzorr7nva7kuK3lv4PngrnkuLooMCwgMCnvvIznlJ/miJA1MOS4queCue+8jOWwuuWvuDAuMQogICAgICAgIGxvY2FsIGhlYXJ0X2Nvb3JkaW5hdGVzID0gZ2VuZXJhdGVfaGVhcnRfY29vcmRpbmF0ZXMocG9zLngsIHBvcy55LCA1MCwgMC4yKQogICAgICAgIAogICAgICAgIGZvciBfLCBjb29yZCBpbiBpcGFpcnMoaGVhcnRfY29vcmRpbmF0ZXMpIGRvCiAgICAgICAgICAgIGNyZWF0ZV9vYmplY3QodXRpbC5qb2FhdCgndl9wcm9wX2Zsb2F0Y2FuZGxlJyksIGNvb3JkWzFdLCBjb29yZFsyXSwgcG9zLnopCiAgICAgICAgICAgIHV0aWwueWllbGQoMjApCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgoKLS0tLeWKoOWFpee7hC/kv53plZYKZnVuY3Rpb24gam9pbl9ncm91cChwZWQpCiAgICBpZiBub3QgUEVELklTX1BFRF9JTl9HUk9VUChwZWQpIHRoZW4KICAgICAgICBQRUQuU0VUX1BFRF9BU19HUk9VUF9NRU1CRVIocGVkLCBQTEFZRVIuR0VUX1BMQVlFUl9HUk9VUChQTEFZRVIuUExBWUVSX0lEKCkpKQogICAgICAgIFBFRC5TRVRfUEVEX05FVkVSX0xFQVZFU19HUk9VUChwZWQsIHRydWUpCiAgICBlbmQKICAgIFBFRC5TRVRfUEVEX1JFTEFUSU9OU0hJUF9HUk9VUF9IQVNIKHBlZCwgTUlTQy5HRVRfSEFTSF9LRVkoInJnRk1fSGF0ZUV2ZXJ5T25lIikpIC0tInJnRk1fSGF0ZUV2ZXJ5T25lIgogICAgUEVELlNFVF9HUk9VUF9TRVBBUkFUSU9OX1JBTkdFKFBMQVlFUi5HRVRfUExBWUVSX0dST1VQKFBMQVlFUi5QTEFZRVJfSUQoKSksIDk5OTkuMCkKICAgIFBFRC5TRVRfR1JPVVBfRk9STUFUSU9OX1NQQUNJTkcoUExBWUVSLkdFVF9QTEFZRVJfR1JPVVAoUExBWUVSLlBMQVlFUl9JRCgpKSwgMS4wLCAwLjksIDMuMCkKICAgIFBFRC5TRVRfR1JPVVBfRk9STUFUSU9OKFBMQVlFUi5HRVRfUExBWUVSX0dST1VQKFBMQVlFUi5QTEFZRVJfSUQoKSksIDApCmVuZAoKLS0tLeiHquWumuS5ieS8oOmAgQpmdW5jdGlvbiBDdXN0b21fdGVsZXBvcnQoKQogICAgbG9jYWwgbGFiZWwgPSB1dGlsLnJlZ2lzdGVyX2xhYmVsKCLovpPlhaXlnZDmoIcoeCx5LHopLOS7pScsJ+WIhuW8gCIpCglsb2NhbCBpbnB1dCA9IGdldF9pbnB1dF9mcm9tX3NjcmVlbl9rZXlib2FyZChsYWJlbCwgMjAsICIiKQogICAgaWYgaW5wdXQgPT0gIiIgdGhlbiByZXR1cm4gZW5kCiAgICBpbnB1dCA9IHN0cmluZy5nc3ViKGlucHV0LCAi77yMIiwgIiwiKQogICAgbG9jYWwgdGFiID0gc3RyaW5nLnNwbGl0KGlucHV0LCIsIikKICAgIGZvciBpID0gMSwgMyBkbwogICAgICAgIHRhYltpXSA9IHRvbnVtYmVyKHRhYltpXSkKICAgICAgICBpZiB0eXBlKHRhYltpXSkgfj0gIm51bWJlciIgb3IgI3RhYiB+PSAzIHRoZW4KICAgICAgICAgICAgdXRpbC50b2FzdCgi5qC85byP6ZSZ6K+vIikKICAgICAgICAgICAgcmV0dXJuIAogICAgICAgIGVuZAogICAgZW5kCiAgICB0ZWxlcG9ydCh0YWJbMV0sIHRhYlsyXSwgdGFiWzNdLCB0cnVlKQplbmQKCi0tLS3pqb7pqbbotoXnuqfmuLjoiYcKZnVuY3Rpb24gc3VwZXJfeWFjaHQoKQogICAgaWYgbm90IGlzX2VudGl0eV9vbl93YXRlcihQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSB0aGVuCiAgICAgICAgbm90aWZpY2F0aW9uKCJ+eX5+Ym9sZH7kuI3lnKjmsLTkuIo6RCIsIEh1ZENvbG91ci5ibHVlKQogICAgICAgIHJldHVybgogICAgZW5kCiAgICBsb2NhbCBDb3JlU3Bhd25Qb2ludCA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwLCAwLCAwKQogICAgbG9jYWwgQ29yZVNwYXduSGVhZGluZyA9IEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgIGxvY2FsIENvcmVIYXNoID0gdXRpbC5qb2FhdCgia29zYXRrYSIpCiAgICByZXF1ZXN0X21vZGVsKENvcmVIYXNoKQogICAgbG9jYWwgQ29yZSA9IGVudGl0aWVzLmNyZWF0ZV92ZWhpY2xlKENvcmVIYXNoLCBDb3JlU3Bhd25Qb2ludCwgQ29yZVNwYXduSGVhZGluZykKICAgIFBFRC5TRVRfUEVEX0lOVE9fVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBDb3JlLCAtMSkKICAgIEVOVElUWS5TRVRfRU5USVRZX1ZJU0lCTEUoQ29yZSwgZmFsc2UsIGZhbHNlKQogICAgbG9jYWwgWWFjaHRIYXNoID0gdXRpbC5qb2FhdCgicHJvcF9jal9iaWdfYm9hdCIpCiAgICByZXF1ZXN0X21vZGVsKFlhY2h0SGFzaCkKICAgIGxvY2FsIFlhY2h0ID0gZW50aXRpZXMuY3JlYXRlX29iamVjdChZYWNodEhhc2gsIENvcmVTcGF3blBvaW50LCBDb3JlU3Bhd25IZWFkaW5nKQogICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKFlhY2h0LCBDb3JlLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCB0cnVlLCBmYWxzZSwgZmFsc2UsIHRydWUsIDAsIHRydWUsIDApCiAgICBFTlRJVFkuU0VUX0VOVElUWV9DT0xMSVNJT04oWWFjaHQsIHRydWUsIGZhbHNlKQogICAgRU5USVRZLlNFVF9FTlRJVFlfQ09MTElTSU9OKENvcmUsIGZhbHNlLCBmYWxzZSkKZW5kCgoKLS0tLeelnumjjueCrgpmdW5jdGlvbiBjcmVhdGVfc2hvb3RpbmdfdGFyZ2V0KHgsIHksIHopCiAgICBsb2NhbCBoYXNoID0gNTEwNjI4MzY0CiAgICBsb2NhbCB0YXJnZXQgPSBjcmVhdGVfb2JqZWN0KGhhc2gsIHgsIHksIHopLS3pnbblrZAKICAgIEVOVElUWS5TRVRfRU5USVRZX1ZJU0lCTEUodGFyZ2V0LCB0cnVlLCBmYWxzZSktLeWPr+ingQogICAgRU5USVRZLlNFVF9FTlRJVFlfQ09MTElTSU9OKHRhcmdldCwgZmFsc2UpLS3norDmkp4KICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKHRhcmdldCwgdHJ1ZSktLeWGu+e7kwogICAgcmV0dXJuIHRhcmdldAplbmQKbG9jYWwgSmV0U3F1YWRyb25SZWFsTmFtZXMgPSB7IkxhemVyIiwicmFpanUiLCAibW9sb3RvayIsICJweXJvIiwgInN0cmlrZWZvcmNlIiwgInNlYWJyZWV6ZSIgLCAiaG93YXJkIiwgImJlc3JhIiwgInN0YXJsaW5nIiwgInJvZ3VlIiwgIlN0dW50IiwgImFscGhhejEiLCAibmltYnVzIiwgImx1eG9yMiIsICJtb2d1bCIsICJzdHJlYW1lcjIxNiIsICJ2ZXN0cmEiLCAiY3ViYW44MDAiLCAiZG9kbyIsICJ2ZWx1bSIsICJtYW1tYXR1cyIsICJkdXN0ZXIiLCAibWljcm9saWdodCJ9CmZ1bmN0aW9uIEthbWlrYXplX0d1bigpCiAgICBsb2NhbCBwb3MgPSB2My5uZXcoKQogICAgaWYgV0VBUE9OLkdFVF9QRURfTEFTVF9XRUFQT05fSU1QQUNUX0NPT1JEKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHBvcykgYW5kIG5vdCBQRUQuSVNfUEVEX0lOX0FOWV9WRUhJQ0xFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpIHRoZW4KICAgICAgICBsb2NhbCBQSF9oYXNoID0gMTI2NzcxODAxMwogICAgICAgIHJlcXVlc3RfbW9kZWwoUEhfaGFzaCkKICAgICAgICBsb2NhbCBQSCA9IE9CSkVDVC5DUkVBVEVfT0JKRUNUKFBIX2hhc2gsIHBvcy54LCBwb3MueSwgcG9zLnogKyAwLjEsIHRydWUsIGZhbHNlLCB0cnVlKS0t5Yib5bu65YWJ5qCHCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04oUEgsIDAsIDAsIDkwLCAyLCB0cnVlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1ZJU0lCTEUoUEgsIGZhbHNlLCBmYWxzZSktLeS4jeWPr+ingQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPTExJU0lPTihQSCwgZmFsc2UpLS3norDmkp4KICAgICAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihQSCwgdHJ1ZSktLeWGu+e7kwoKICAgICAgICBsb2NhbCB0YXJnZXQgPSBjcmVhdGVfc2hvb3RpbmdfdGFyZ2V0KHBvcy54LCBwb3MueSwgcG9zLnopLS3nm67moIfpnbYKCiAgICAgICAgbG9jYWwgUHBlZG0gPSBQTEFZRVIuR0VUX1BMQVlFUl9QRURfU0NSSVBUX0lOREVYKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICAgICAgbG9jYWwgcmFuZG9tUGxhbmUgPSB1dGlsLmpvYWF0KEpldFNxdWFkcm9uUmVhbE5hbWVzW21hdGgucmFuZG9tKDEsICNKZXRTcXVhZHJvblJlYWxOYW1lcyldKQogICAgICAgIHJlcXVlc3RfbW9kZWwocmFuZG9tUGxhbmUpCiAgICAgICAgbG9jYWwgT2Zmc2V0ID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKFBILCBtYXRoLnJhbmRvbSgtMjAwLCAyMDApLCBtYXRoLnJhbmRvbSgtMjAwLCAyMDApLCBtYXRoLnJhbmRvbSgxMDAsIDUwMCkpCiAgICAgICAgbG9jYWwgS2FtaWthemUgPSBlbnRpdGllcy5jcmVhdGVfdmVoaWNsZShyYW5kb21QbGFuZSwgT2Zmc2V0LCBtYXRoLnJhbmRvbSgtMTgwLCAxODApKS0t5Yib5bu66aOe5py6CiAgICAgICAgbG9jYWwgS2FtaWthemVDYW0gPSBDQU0uQ1JFQVRFX0NBTUVSQSgyNjM3OTk0NSwgdHJ1ZSkKCiAgICAgICAgdXRpbC5jcmVhdGVfdGlja19oYW5kbGVyKGZ1bmN0aW9uKCkKICAgICAgICAgICAgLS3pmLLmraLnorDmkp4KICAgICAgICAgICAgbG9jYWwgZGlzdGFuY2UgPSBHZXRfZGlzdGFuY2UoRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHRhcmdldCwgZmFsc2UpLCBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoS2FtaWthemUsIGZhbHNlKSwgdHJ1ZSkKICAgICAgICAgICAgaWYgZGlzdGFuY2UgPiAxMCB0aGVuIEVOVElUWS5TRVRfRU5USVRZX0NPTExJU0lPTihLYW1pa2F6ZSwgZmFsc2UsIHRydWUpIGVsc2UgRU5USVRZLlNFVF9FTlRJVFlfQ09MTElTSU9OKEthbWlrYXplLCB0cnVlLCB0cnVlKSBlbmQKCiAgICAgICAgICAgIGlmIEVOVElUWS5ET0VTX0VOVElUWV9FWElTVChLYW1pa2F6ZSkgdGhlbi0t56aB5q2i5omn6KGM5Lit6YeN5aSN55Sf5oiQ5qih5Z6LCiAgICAgICAgICAgICAgICBQTEFZRVIuRElTQUJMRV9QTEFZRVJfRklSSU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUpCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIFBMQVlFUi5ESVNBQkxFX1BMQVlFUl9GSVJJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBzZXRfZW50aXR5X2ZhY2VfZW50aXR5KEthbWlrYXplLCBQSCwgdHJ1ZSkKICAgICAgICAgICAgRU5USVRZLkFQUExZX0ZPUkNFX1RPX0VOVElUWV9DRU5URVJfT0ZfTUFTUyhLYW1pa2F6ZSwgMSwgMCwgMS41LCAwLjAsIHRydWUsIHRydWUsIHRydWUsIHRydWUpCiAgICAgICAgICAgIENBTS5SRU5ERVJfU0NSSVBUX0NBTVModHJ1ZSwgZmFsc2UsIDMwMDAsIDEsIDAsIDApCiAgICAgICAgICAgIENBTS5TSEFLRV9DQU0oS2FtaWthemVDYW0sICJEUlVOS19TSEFLRSIsIDEpCiAgICAgICAgICAgIEdSQVBISUNTLkFOSU1QT1NURlhfUExBWSgiTVBfY29yb25hX3N3aXRjaF9zdXBlcm1vZCIsIDAsIHRydWUpCiAgICAgICAgICAgIEdSQVBISUNTLkFOSU1QT1NURlhfUExBWSgiTVBfT3JiaXRhbENhbm5vbiIsIDAsIHRydWUpCgogICAgICAgICAgICBpZiBFTlRJVFkuSEFTX0VOVElUWV9DT0xMSURFRF9XSVRIX0FOWVRISU5HKEthbWlrYXplKSB0aGVuLS3liKTmlq3lrp7kvZPmmK/lkKbkuI7ku7vkvZXniankvZPnorDmkp4KICAgICAgICAgICAgICAgIGxvY2FsIEthbWlrYXplT2Zmc2V0ID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKEthbWlrYXplLCAgbWF0aC5yYW5kb20oLTUsIDUpLCAgbWF0aC5yYW5kb20oLTUsIDUpLCAgbWF0aC5yYW5kb20oLTUsIDUpKQogICAgICAgICAgICAgICAgRklSRS5BRERfRVhQTE9TSU9OKEthbWlrYXplT2Zmc2V0LngsIEthbWlrYXplT2Zmc2V0LnksIEthbWlrYXplT2Zmc2V0LnosIDU5LCAxLCB0cnVlLCBmYWxzZSwgMS4wLCBmYWxzZSkKICAgICAgICAgICAgICAgIEFVRElPLlBMQVlfU09VTkRfRlJPTV9FTlRJVFkoLTEsICJETENfWE1fRXhwbG9zaW9uc19PcmJpdGFsX0Nhbm5vbiIsIEthbWlrYXplLCAwLCB0cnVlLCAwKQoKICAgICAgICAgICAgICAgIHV0aWwueWllbGQoMTUwMCkKICAgICAgICAgICAgICAgIC0t6L+Y5Y6f55u45py6CiAgICAgICAgICAgICAgICBDQU0uUkVOREVSX1NDUklQVF9DQU1TKGZhbHNlLCBmYWxzZSwgMzAwMCwgMSwgMCwgMCk7CiAgICAgICAgICAgICAgICBDQU0uREVTVFJPWV9DQU0oS2FtaWthemVDYW0sIHRydWUpCiAgICAgICAgICAgICAgICBHUkFQSElDUy5BTklNUE9TVEZYX1NUT1AoIk1QX09yYml0YWxDYW5ub24iLCAwLCB0cnVlKQogICAgICAgICAgICAgICAgR1JBUEhJQ1MuQU5JTVBPU1RGWF9TVE9QKCJNUF9PcmJpdGFsQ2Fubm9uIiwgMCwgdHJ1ZSkKICAgICAgICAgICAgICAgIEdSQVBISUNTLkFOSU1QT1NURlhfU1RPUCgiTVBfY29yb25hX3N3aXRjaF9zdXBlcm1vZCIsIDAsIHRydWUpCiAgICAgICAgICAgICAgICBHUkFQSElDUy5BTklNUE9TVEZYX1NUT1AoIk1QX2Nvcm9uYV9zd2l0Y2hfc3VwZXJtb2QiLCAwLCB0cnVlKQogICAgICAgICAgICAgICAgZGVsZXRlX2VudGl0eShLYW1pa2F6ZSkKICAgICAgICAgICAgICAgIGRlbGV0ZV9lbnRpdHkoUEgpCiAgICAgICAgICAgICAgICBkZWxldGVfZW50aXR5KHRhcmdldCkKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICAgICAgQ0FNLkhBUkRfQVRUQUNIX0NBTV9UT19FTlRJVFkoS2FtaWthemVDYW0sIEthbWlrYXplLCAtMTAsIDAsIDAsIDAsIC0xMCwgNiwgdHJ1ZSkKICAgICAgICBsb2NhbCBjYXVzZSA9IFZFSElDTEUuR0VUX1ZFSElDTEVfQ0FVU0VfT0ZfREVTVFJVQ1RJT04oS2FtaWthemUpCiAgICAgICAgVkVISUNMRS5TRVRfQUxMT1dfVkVISUNMRV9FWFBMT0RFU19PTl9DT05UQUNUKEthbWlrYXplLCB0cnVlKQogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRU5HSU5FX09OKEthbWlrYXplLCB0cnVlLCB0cnVlLCAwKQogICAgICAgIEthbWlrYXplUGlsb3QgPSBQRUQuQ1JFQVRFX1JBTkRPTV9QRURfQVNfRFJJVkVSKEthbWlrYXplLCAxKQogICAgICAgIFZFSElDTEUuQ09OVFJPTF9MQU5ESU5HX0dFQVIoS2FtaWthemUsIDMpCiAgICBlbmQKZW5kCgotLeWPkemAgeelnumjjueCrgpmdW5jdGlvbiBTZW5kX0thbWlrYXplX0d1bihwaWQpCiAgICAKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSkKICAgIGxvY2FsIHJhbmRvbVBsYW5lID0gdXRpbC5qb2FhdChKZXRTcXVhZHJvblJlYWxOYW1lc1ttYXRoLnJhbmRvbSgxLCAjSmV0U3F1YWRyb25SZWFsTmFtZXMpXSkKICAgIHJlcXVlc3RfbW9kZWwocmFuZG9tUGxhbmUpCiAgICBsb2NhbCBPZmZzZXQgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCksIG1hdGgucmFuZG9tKC0yMDAsIDIwMCksIG1hdGgucmFuZG9tKC0yMDAsIDIwMCksIG1hdGgucmFuZG9tKDEwMCwgNTAwKSkKICAgIGxvY2FsIEthbWlrYXplID0gZW50aXRpZXMuY3JlYXRlX3ZlaGljbGUocmFuZG9tUGxhbmUsIE9mZnNldCwgbWF0aC5yYW5kb20oLTE4MCwgMTgwKSktLeWIm+W7uumjnuacugogICAgbG9jYWwgS2FtaWthemVDYW0gPSBDQU0uQ1JFQVRFX0NBTUVSQSgyNjM3OTk0NSwgdHJ1ZSkKCiAgICB1dGlsLmNyZWF0ZV90aWNrX2hhbmRsZXIoZnVuY3Rpb24oKQogICAgICAgIC0t6Ziy5q2i56Kw5pKeCiAgICAgICAgbG9jYWwgZGlzdGFuY2UgPSBHZXRfZGlzdGFuY2UoRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCBmYWxzZSksIEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhLYW1pa2F6ZSwgZmFsc2UpLCB0cnVlKQogICAgICAgIGlmIGRpc3RhbmNlID4gMTAgdGhlbiBFTlRJVFkuU0VUX0VOVElUWV9DT0xMSVNJT04oS2FtaWthemUsIGZhbHNlLCB0cnVlKSBlbHNlIEVOVElUWS5TRVRfRU5USVRZX0NPTExJU0lPTihLYW1pa2F6ZSwgdHJ1ZSwgdHJ1ZSkgZW5kCgogICAgICAgIHNldF9lbnRpdHlfZmFjZV9lbnRpdHkoS2FtaWthemUsIFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCB0cnVlKQogICAgICAgIEVOVElUWS5BUFBMWV9GT1JDRV9UT19FTlRJVFlfQ0VOVEVSX09GX01BU1MoS2FtaWthemUsIDEsIDAsIDEuNSwgMC4wLCB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlKQogICAgICAgIENBTS5SRU5ERVJfU0NSSVBUX0NBTVModHJ1ZSwgZmFsc2UsIDMwMDAsIDEsIDAsIDApCiAgICAgICAgQ0FNLlNIQUtFX0NBTShLYW1pa2F6ZUNhbSwgIkRSVU5LX1NIQUtFIiwgMSkKICAgICAgICBHUkFQSElDUy5BTklNUE9TVEZYX1BMQVkoIk1QX2Nvcm9uYV9zd2l0Y2hfc3VwZXJtb2QiLCAwLCB0cnVlKQogICAgICAgIEdSQVBISUNTLkFOSU1QT1NURlhfUExBWSgiTVBfT3JiaXRhbENhbm5vbiIsIDAsIHRydWUpCgogICAgICAgIGlmIEVOVElUWS5IQVNfRU5USVRZX0NPTExJREVEX1dJVEhfQU5ZVEhJTkcoS2FtaWthemUpIHRoZW4tLeWIpOaWreWunuS9k+aYr+WQpuS4juS7u+S9leeJqeS9k+eisOaSngogICAgICAgICAgICBsb2NhbCBLYW1pa2F6ZU9mZnNldCA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhLYW1pa2F6ZSwgIG1hdGgucmFuZG9tKC01LCA1KSwgIG1hdGgucmFuZG9tKC01LCA1KSwgIG1hdGgucmFuZG9tKC01LCA1KSkKICAgICAgICAgICAgRklSRS5BRERfRVhQTE9TSU9OKEthbWlrYXplT2Zmc2V0LngsIEthbWlrYXplT2Zmc2V0LnksIEthbWlrYXplT2Zmc2V0LnosIDU5LCAxLCB0cnVlLCBmYWxzZSwgMS4wLCBmYWxzZSkKICAgICAgICAgICAgQVVESU8uUExBWV9TT1VORF9GUk9NX0VOVElUWSgtMSwgIkRMQ19YTV9FeHBsb3Npb25zX09yYml0YWxfQ2Fubm9uIiwgS2FtaWthemUsIDAsIHRydWUsIDApCgogICAgICAgICAgICB1dGlsLnlpZWxkKDE1MDApCiAgICAgICAgICAgIENBTS5SRU5ERVJfU0NSSVBUX0NBTVMoZmFsc2UsIGZhbHNlLCAzMDAwLCAxLCAwLCAwKTsKICAgICAgICAgICAgQ0FNLkRFU1RST1lfQ0FNKEthbWlrYXplQ2FtLCB0cnVlKQogICAgICAgICAgICBHUkFQSElDUy5BTklNUE9TVEZYX1NUT1AoIk1QX09yYml0YWxDYW5ub24iLCAwLCB0cnVlKQogICAgICAgICAgICBHUkFQSElDUy5BTklNUE9TVEZYX1NUT1AoIk1QX09yYml0YWxDYW5ub24iLCAwLCB0cnVlKQogICAgICAgICAgICBHUkFQSElDUy5BTklNUE9TVEZYX1NUT1AoIk1QX2Nvcm9uYV9zd2l0Y2hfc3VwZXJtb2QiLCAwLCB0cnVlKQogICAgICAgICAgICBHUkFQSElDUy5BTklNUE9TVEZYX1NUT1AoIk1QX2Nvcm9uYV9zd2l0Y2hfc3VwZXJtb2QiLCAwLCB0cnVlKQogICAgICAgICAgICBkZWxldGVfZW50aXR5KEthbWlrYXplKQogICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICBlbmQKICAgIGVuZCkKICAgIENBTS5IQVJEX0FUVEFDSF9DQU1fVE9fRU5USVRZKEthbWlrYXplQ2FtLCBLYW1pa2F6ZSwgLTEwLCAwLCAwLCAwLCAtMTAsIDYsIHRydWUpCiAgICBsb2NhbCBjYXVzZSA9IFZFSElDTEUuR0VUX1ZFSElDTEVfQ0FVU0VfT0ZfREVTVFJVQ1RJT04oS2FtaWthemUpCiAgICBWRUhJQ0xFLlNFVF9BTExPV19WRUhJQ0xFX0VYUExPREVTX09OX0NPTlRBQ1QoS2FtaWthemUsIHRydWUpCiAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0VOR0lORV9PTihLYW1pa2F6ZSwgdHJ1ZSwgdHJ1ZSwgMCkKICAgIEthbWlrYXplUGlsb3QgPSBQRUQuQ1JFQVRFX1JBTkRPTV9QRURfQVNfRFJJVkVSKEthbWlrYXplLCAxKQogICAgVkVISUNMRS5DT05UUk9MX0xBTkRJTkdfR0VBUihLYW1pa2F6ZSwgMykKZW5kCgoKLS0tLeeOqeWutuagjwpmdW5jdGlvbiBwbGF5ZXJfYmFyKCkKICAgIGxvY2FsIHBvc3ggPSAwLjAxCiAgICBsb2NhbCBwb3N5ID0gMC4wMDUKCiAgICBmb3IgcGlkID0gMCwgMzIgZG8KICAgICAgICBpZiBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSB+PSAwIHRoZW4KICAgICAgICAgICAgbG9jYWwgbmFtZSA9IFBMQVlFUi5HRVRfUExBWUVSX05BTUUocGlkKQogICAgICAgICAgICBsb2NhbCBpbmZvdGFncyA9ICIgWyIKICAgICAgICAgICAgbG9jYWwgaW5mb2NvbG9yID0gIn53fiI7bG9jYWwgaW5mb2NvbG9yMiA9ICJ+b34iCiAgICAgICAgICAgIGxvY2FsIG5ldHdvcmsgPSBtZW1vcnkuYWxsb2MoMTMqNCkKICAgICAgICAgICAgTkVUV09SSy5ORVRXT1JLX0hBTkRMRV9GUk9NX1BMQVlFUihwaWQsbmV0d29yaywxMykKICAgICAgICAtLeagh+etvgogICAgICAgICAgICBpZiBwbGF5ZXJzLmdldF9ob3N0KCkgPT0gcGlkIHRoZW4KICAgICAgICAgICAgICAgIGluZm90YWdzID0gaW5mb3RhZ3MgLi4gIkgiCiAgICAgICAgICAgICAgICBpbmZvY29sb3IgPSAifnl+IgogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgcGxheWVycy5nZXRfc2NyaXB0X2hvc3QoKSA9PSBwaWQgdGhlbgogICAgICAgICAgICAgICAgaW5mb3RhZ3MgPSBpbmZvdGFncyAuLiAiUyIKICAgICAgICAgICAgICAgIGluZm9jb2xvciA9ICJ+Yn4iCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBwbGF5ZXJzLmlzX21hcmtlZF9hc19tb2RkZXIocGlkKSB0aGVuCiAgICAgICAgICAgICAgICBpbmZvdGFncyA9IGluZm90YWdzIC4uICJNIgogICAgICAgICAgICAgICAgaW5mb2NvbG9yID0gIn5yfiIKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIHBsYXllcnMuaXNfZ29kbW9kZShwaWQpIHRoZW4gCiAgICAgICAgICAgICAgICBpbmZvdGFncyA9IGluZm90YWdzIC4uICJHIgogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgcGxheWVycy5pc19pbl9pbnRlcmlvcihwaWQpIHRoZW4KICAgICAgICAgICAgICAgIGluZm90YWdzID0gaW5mb3RhZ3MgLi4gIkkiCiAgICAgICAgICAgICAgICBpbmZvY29sb3IgPSAifmd+IgogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgTkVUV09SSy5ORVRXT1JLX0lTX0ZSSUVORChuZXR3b3JrKSB0aGVuCiAgICAgICAgICAgICAgICBpbmZvdGFncyA9IGluZm90YWdzIC4uICJGIgogICAgICAgICAgICAgICAgaW5mb2NvbG9yID0gIn5xfiIKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBpZiBQTEFZRVIuUExBWUVSX0lEKCkgPT0gcGlkIHRoZW4KICAgICAgICAgICAgICAgIGluZm9jb2xvciA9ICJ+Yn4iCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgaW5mb3RhZ3MgPT0gIiBbIiB0aGVuCiAgICAgICAgICAgICAgICBpbmZvdGFncyA9ICIiCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGluZm90YWdzID0gaW5mb3RhZ3MuLiJdIgogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGRyYXdfc3RyaW5nKGluZm9jb2xvci4ubmFtZS4uaW5mb2NvbG9yMi4uaW5mb3RhZ3MsIHBvc3gsIHBvc3ksIDAuNCwgNCkKCiAgICAgICAgICAgIHBvc3ggPSBwb3N4ICsgKCNuYW1lICsgI2luZm90YWdzKS80MDAgKyAwLjA0CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBwb3N4ID4gMC45MyB0aGVuCiAgICAgICAgICAgICAgICBwb3N5ID0gcG9zeSArIDAuMDIKICAgICAgICAgICAgICAgIHBvc3ggPSAwLjAxCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZAoKCi0tLS3liKDpmaTmnqoKZnVuY3Rpb24gZGVsZXRlX2d1bigpCiAgICBpZiBQRUQuSVNfUEVEX1NIT09USU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpIHRoZW4KICAgICAgICBsb2NhbCBlbnRpdHkgPSBnZXRfZW50aXR5X3BsYXllcl9pc19haW1pbmdfYXQoUExBWUVSLlBMQVlFUl9JRCgpKQogICAgICAgIE5FVFdPUksuTkVUV09SS19SRVFVRVNUX0NPTlRST0xfT0ZfRU5USVRZKGVudGl0eSkKICAgICAgICBpZiBub3QgUEVELklTX1BFRF9BX1BMQVlFUihlbnRpdHkpIHRoZW4KICAgICAgICAgICAgZGVsZXRlX2VudGl0eShlbnRpdHkpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgoKLS0tLeWWh+WPreeIhueCuApmdW5jdGlvbiBob3JuX2JvbWIoKQogICAgbG9jYWwgdmVoaWNsZSA9IFBFRC5HRVRfVkVISUNMRV9QRURfSVNfSU4oUExBWUVSLkdFVF9QTEFZRVJfUEVEKFBMQVlFUi5QTEFZRVJfSUQoKSksIGZhbHNlKQogICAgaWYgQVVESU8uSVNfSE9STl9BQ1RJVkUodmVoaWNsZSkgdGhlbgogICAgICAgIGxvY2FsIGNvb3JkcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyh2ZWhpY2xlKQogICAgICAgIGxvY2FsIHNob290Q29vcmRzID0gdjMubmV3KGNvb3JkcykKICAgICAgICBmb3IgaSA9IDEsIDMgZG8KICAgICAgICAgICAgbG9jYWwgcm90ID0gRU5USVRZLkdFVF9FTlRJVFlfUk9UQVRJT04odmVoaWNsZSwgMik6dG9EaXIoKQogICAgICAgICAgICBsb2NhbCB2ZWwgPSBFTlRJVFkuR0VUX0VOVElUWV9WRUxPQ0lUWSh2ZWhpY2xlKQogICAgICAgICAgICB2My5tdWwocm90LCAyNSArIG1hdGguYWJzKHZlbC54KSkKICAgICAgICAgICAgdjMuYWRkKHNob290Q29vcmRzLCByb3QpCiAgICAgICAgICAgIEZJUkUuQUREX09XTkVEX0VYUExPU0lPTihWRUhJQ0xFLkdFVF9QRURfSU5fVkVISUNMRV9TRUFUKHZlaGljbGUsIC0xKSwgc2hvb3RDb29yZHMueCArIG1hdGgucmFuZG9tKC0yLCAyKSwgc2hvb3RDb29yZHMueSArIG1hdGgucmFuZG9tKC0yLCAyKSwgc2hvb3RDb29yZHMueiwgMTAsIDEwMCx0cnVlLCBmYWxzZSwgMC4xKQogICAgICAgICAgICB1dGlsLnlpZWxkKCkKICAgICAgICBlbmQKICAgIGVuZAplbmQKCgotLS0t5o6o5Yqo546p5a62CmZ1bmN0aW9uIERyaXZpbmdfUGxheWVyKHBpZCkKICAgIGlmIFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpIH49IDAgdGhlbgogICAgICAgIAogICAgICAgIGxvY2FsIHBsYXllciA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICAgICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHBsYXllciwgZmFsc2UpCiAgICAgICAgbG9jYWwgZ2xpdGNoX2hhc2ggPSB1dGlsLmpvYWF0KCJwcm9wX3NodXR0ZXJpbmcwMyIpCiAgICAgICAgcmVxdWVzdF9tb2RlbChnbGl0Y2hfaGFzaCkKICAgICAgICBFTlRJVFkuQVBQTFlfRk9SQ0VfVE9fRU5USVRZKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCAzLCA1MCwgNTAsIDAsIDAuMCwgMC4wLCAwLjAsIDAsIGZhbHNlLCBmYWxzZSwgdHJ1ZSwgZmFsc2UsIGZhbHNlKQogICAgICAgIGxvY2FsIGR1bWJfb2JqZWN0X2Zyb250ID0gZW50aXRpZXMuY3JlYXRlX29iamVjdChnbGl0Y2hfaGFzaCwgRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCAwLCAxLCAwKSkKICAgICAgICBsb2NhbCBkdW1iX29iamVjdF9iYWNrID0gZW50aXRpZXMuY3JlYXRlX29iamVjdChnbGl0Y2hfaGFzaCwgRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCAwLCAwLCAwKSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9WSVNJQkxFKGR1bWJfb2JqZWN0X2Zyb250LCBmYWxzZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9WSVNJQkxFKGR1bWJfb2JqZWN0X2JhY2ssIGZhbHNlKQogICAgICAgIHV0aWwueWllbGQoKQogICAgICAgIGRlbGV0ZV9lbnRpdHkoZHVtYl9vYmplY3RfZnJvbnQpCiAgICAgICAgZGVsZXRlX2VudGl0eShkdW1iX29iamVjdF9iYWNrKQogICAgICAgIHV0aWwueWllbGQoKQogICAgZW5kCmVuZAoKCgotLS0t5LuT6byg55CDCmZ1bmN0aW9uIEhhbXN0ZXJfQmFsbChwaWQpCiAgICAKICAgIGxvY2FsIGhhc2ggPSAxNzY4OTU2MTgxCiAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCksIDAsIDAsIC0xKQogICAgbG9jYWwgb2JqID0ge30KICAgIGZvciBpID0gMSwgMTggZG8KICAgICAgICBvYmpbaV0gPSBjcmVhdGVfb2JqZWN0KGhhc2gsIHBvcy54LCBwb3MueSwgcG9zLnopCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04ob2JqW2ldLCAwLCAwLCBpICogMTAgLCAxLCB0cnVlKQogICAgZW5kCmVuZAoKLS0tLeeyieeijuacugpmdW5jdGlvbiBzaHJlZGRlcihwaWQpCiAgICAKICAgIGxvY2FsIGhhc2ggPSB1dGlsLmpvYWF0KCdzcl9tcF9zcGVjX3JhY2VzX3Rha2VfZmxpZ2h0X3NpZ24nKQogICAgZm9yIGk9LTMsIDUgZG8gCiAgICAgICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCAwLCBpLCAyKQogICAgICAgIGxvY2FsIGNydXNoZXIgPSBjcmVhdGVfb2JqZWN0KGhhc2gsIHBvcy54LCBwb3MueSwgcG9zLnopCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04oY3J1c2hlciwgMCwgMTgwLCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpKSArIDkwLCAyKQogICAgZW5kCmVuZAoKLS0tLeWNh+WkqeeUteairwpmdW5jdGlvbiBiaWtlcl9saWZ0KG9uLHBpZCkKICAgIGJpa2VyX3RvZ2dsZWQgPSBvbgogICAgaWYgYmlrZXJfdG9nZ2xlZCB0aGVuCiAgICAgICAgCiAgICAgICAgbG9jYWwgaGFzaCA9IC0xMzQyMjgxODIwCiAgICAgICAgcmVxdWVzdF9tb2RlbChoYXNoKQogICAgICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSkKICAgICAgICBwb3MueiA9IHBvcy56IC0gMTAKICAgICAgICBzZW5kX2Jpa2VyID0gT0JKRUNULkNSRUFURV9PQkpFQ1RfTk9fT0ZGU0VUKGhhc2gsIHBvcy54LCBwb3MueSwgcG9zLnosIHRydWUsIGZhbHNlLCB0cnVlKQogICAgICAgIHdoaWxlIGJpa2VyX3RvZ2dsZWQgZG8KICAgICAgICAgICAgbG9jYWwgcG9zMiA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSkKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTX05PX09GRlNFVChzZW5kX2Jpa2VyLCBwb3MyLngsIHBvczIueSwgcG9zLnosIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICBwb3MueiA9IHBvcy56ICsgMC4xCiAgICAgICAgICAgIHV0aWwueWllbGQoMTApCiAgICAgICAgICAgIGxvY2FsIHBvczMgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkpCiAgICAgICAgICAgIGxvY2FsIGhpZ2h0ID0gcG9zMy56CiAgICAgICAgICAgIGlmIHBvcy56ID4gaGlnaHQgdGhlbgogICAgICAgICAgICAgICAgRU5USVRZLkFQUExZX0ZPUkNFX1RPX0VOVElUWShQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSwgMywgNTAsIDUwLCAwLCAwLjAsIDAuMCwgMC4wLCAwLCBmYWxzZSwgZmFsc2UsIHRydWUsIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgICAgIEVOVElUWS5BUFBMWV9GT1JDRV9UT19FTlRJVFkoUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19JTihQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSwgZmFsc2UpLCAzLCA1MCwgNTAsIDAsIDAuMCwgMC4wLCAwLjAsIDAsIGZhbHNlLCBmYWxzZSwgdHJ1ZSwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICAgICAgcG9zLnogPSBoaWdodCAtIDEwCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZWxzZQogICAgICAgIGRlbGV0ZV9lbnRpdHkoc2VuZF9iaWtlcikKICAgIGVuZAplbmQKCgotLS0t5p6B6ZmQ6Lez6LeDCmZ1bmN0aW9uIGV4dHJlbWVfanVtcChpbmRleCkKICAgIGlmIGluZGV4ID09IDEgdGhlbgogICAgICAgIFNwYXduSGVpZ2h0ID0gMjUwCiAgICBlbHNlaWYgaW5kZXggPT0gMiB0aGVuCiAgICAgICAgU3Bhd25IZWlnaHQgPSA1MDAKICAgIGVsc2VpZiBpbmRleCA9PSAzIHRoZW4KICAgICAgICBTcGF3bkhlaWdodCA9IDEwMDAKICAgIGVuZAoKICAgIGxvY2FsIHBlZG0gPSBQTEFZRVIuUExBWUVSX1BFRF9JRCgpCiAgICBsb2NhbCBQbGFuZUhhc2ggPSAzNjgyMTE4MTAKICAgIGxvY2FsIENhckhhc2ggPSA5NDE0OTQ0NjEtLTE0NTU5OTAyNTUKICAgIHJlcXVlc3RfbW9kZWwoUGxhbmVIYXNoKQogICAgcmVxdWVzdF9tb2RlbChDYXJIYXNoKQogICAgbG9jYWwgaGVhZGluZyA9IEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcocGVkbSkKICAgIGxvY2FsIFBsYW5lU3Bhd25Mb2MgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMocGVkbSwgMCwgMCwgU3Bhd25IZWlnaHQpCiAgICBsb2NhbCBDYXJTcGF3bkxvYyA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhwZWRtLCAwLCAwLCBTcGF3bkhlaWdodCArIDQpIC0tMTA0CiAgICAKICAgIGxvY2FsIFBsYW5lID0gZW50aXRpZXMuY3JlYXRlX3ZlaGljbGUoUGxhbmVIYXNoLCBQbGFuZVNwYXduTG9jLCBoZWFkaW5nKQogICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRShQbGFuZSwgdHJ1ZSkKICAgIGlmIFBFRC5JU19QRURfSU5fQU5ZX1ZFSElDTEUocGVkbSwgdHJ1ZSkgdGhlbgogICAgICAgIENhciA9IGVudGl0aWVzLmdldF91c2VyX3ZlaGljbGVfYXNfaGFuZGxlKCkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9IRUFESU5HKENhciwgaGVhZGluZyArIDE4MCkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9WRUxPQ0lUWShDYXIsIDAsIDEwMCwgMCkKICAgIGVsc2UgCiAgICAgICAgQ2FyID0gZW50aXRpZXMuY3JlYXRlX3ZlaGljbGUoQ2FySGFzaCwgQ2FyU3Bhd25Mb2MsIDApCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSEVBRElORyhDYXIsIGhlYWRpbmcgKyAxODApCiAgICAgICAgUEVELlNFVF9QRURfSU5UT19WRUhJQ0xFKHBlZG0sIENhciwgLTEpCiAgICBlbmQKICAgIEVOVElUWS5BUFBMWV9GT1JDRV9UT19FTlRJVFlfQ0VOVEVSX09GX01BU1MoUGxhbmUsIDEsIDAsIDEwMCwgMCwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkKICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEUyhDYXIsIENhclNwYXduTG9jLngsIENhclNwYXduTG9jLnksIENhclNwYXduTG9jLnosIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgRU5USVRZLkFQUExZX0ZPUkNFX1RPX0VOVElUWV9DRU5URVJfT0ZfTUFTUyhDYXIsIDEsIDAsIC0xMDAsIDAsIHRydWUsIHRydWUsIHRydWUsIHRydWUpCgogICAgbG9jYWwgVGltZXIgPSAzNTAKICAgIHV0aWwuY3JlYXRlX3RpY2tfaGFuZGxlcihmdW5jdGlvbigpCiAgICAgICAgVGltZXIgPSBUaW1lciAtIDEKICAgICAgICB1dGlsLmRyYXdfY2VudHJlZF90ZXh0KCLlvIDku5PlgJLorqHml7YgOiAiIC4uIFRpbWVyKQogICAgICAgIGlmIFRpbWVyIDwgMCB0aGVuCiAgICAgICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRE9PUl9PUEVOKFBsYW5lLCAyLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgIGVuZAogICAgZW5kKQplbmQKCgotLS0t6aOe5py65pKe5ZCR6Iqx5Zut6ZO26KGMCmZ1bmN0aW9uIHBsYW5ldG9iYW5rKCkKICAgIGxvY2FsIHBvcyA9IHt4ID0gLTkxNC4xNzA3LCB5ID0gLTExNjQuOTM5Niwgej0yNTB9CiAgICBsb2NhbCBwbGFuZSA9IGNyZWF0ZV92ZWhpY2xlKHV0aWwuam9hYXQoJ2pldCcpLCBwb3MueCwgcG9zLnksIHBvcy56LCAtNjgpCiAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0VOR0lORV9PTihwbGFuZSwgdHJ1ZSwgdHJ1ZSwgZmFsc2UpCiAgICBWRUhJQ0xFLkNPTlRST0xfTEFORElOR19HRUFSKHBsYW5lLCAzKQogICAgVkVISUNMRS5TRVRfUExBTkVfVFVSQlVMRU5DRV9NVUxUSVBMSUVSKHBsYW5lLCAwLjApCiAgICBmb3IgaT0xLCA1IGRvIAogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRk9SV0FSRF9TUEVFRChwbGFuZSwgMTUwLjApCiAgICAgICAgdXRpbC55aWVsZCgxMDAwKQogICAgZW5kCmVuZAoKLS0tLeeUn+aIkOaAquWFveWGm+mYnwpmdW5jdGlvbiBDcmVhdGVfTW9uc3Rlcl9Bcm15KHBpZCkKICAgIAogICAgbG9jYWwgcGxheWVyX1l1bGVfYXJteSA9IHt9CiAgICBsb2NhbCBwZWQgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKQogICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHBlZCwgZmFsc2UpCiAgICBwb3MueSA9IHBvcy55IC0gNQogICAgcG9zLnogPSBwb3MueiArIDEKICAgIGxvY2FsIFl1bGUgPSB1dGlsLmpvYWF0KCJVX01fTV9ZdWxlTW9uc3RlciIpCiAgICByZXF1ZXN0X21vZGVsKFl1bGUpCiAgICBmb3IgaSA9IDEsIDQ4IGRvCiAgICAgICAgcGxheWVyX1l1bGVfYXJteVtpXSA9IGVudGl0aWVzLmNyZWF0ZV9wZWQoMjgsIFl1bGUsIHBvcywgMCkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKHBsYXllcl9ZdWxlX2FybXlbaV0sIHRydWUpCiAgICAgICAgUEVELlNFVF9CTE9DS0lOR19PRl9OT05fVEVNUE9SQVJZX0VWRU5UUyhwbGF5ZXJfWXVsZV9hcm15W2ldLCB0cnVlKQogICAgICAgIFBFRC5TRVRfUEVEX0NPTVBPTkVOVF9WQVJJQVRJT04ocGxheWVyX1l1bGVfYXJteVtpXSwgMCwgMCwgMSwgMCkKICAgICAgICBUQVNLLlRBU0tfRk9MTE9XX1RPX09GRlNFVF9PRl9FTlRJVFkocGxheWVyX1l1bGVfYXJteVtpXSwgcGVkLCAwLCAtMC4zLCAwLCA3LjAsIC0xLCAxMCwgdHJ1ZSkKICAgICAgICBXRUFQT04uR0lWRV9XRUFQT05fVE9fUEVEKHBsYXllcl9ZdWxlX2FybXlbaV0sIHV0aWwuam9hYXQoJ1dFQVBPTl9DQU5EWUNBTkUnKSwgIDk5OTksIHRydWUsIHRydWUpCiAgICAgICAgUEVELlNFVF9QRURfQ09NQkFUX0FUVFJJQlVURVMocGxheWVyX1l1bGVfYXJteVtpXSwgMjAsIHRydWUpCiAgICAgICAgUEVELlNFVF9QRURfU0hPT1RfUkFURShwbGF5ZXJfWXVsZV9hcm15W2ldLCAxMDAwKQogICAgICAgIHV0aWwueWllbGQoKQogICAgZW5kIAplbmQKCi0tLS3ngrjlvLnovaYKZnVuY3Rpb24gYm9tYl9jYXIoKQogICAgbG9jYWwgaGFzaCA9IHV0aWwuam9hYXQoInNwZWVkbzIiKQogICAgcmVxdWVzdF9tb2RlbChoYXNoKQogICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDAsIDAsIDApCiAgICBsb2NhbCBoZWFkaW5nID0gRU5USVRZLkdFVF9FTlRJVFlfSEVBRElORyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgbG9jYWwgc3Bhd25lZENhciA9IGVudGl0aWVzLmNyZWF0ZV92ZWhpY2xlKGhhc2gsIHBvcywgaGVhZGluZykKICAgIFBFRC5TRVRfUEVEX0lOVE9fVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBzcGF3bmVkQ2FyLCAtMSkgCiAgICB1dGlsLnRvYXN0KCd+b37mjInkuIvpvKDmoIflj7PplK7lvJXniIbovb3lhbcnKQogICAgdXRpbC5jcmVhdGVfdGlja19oYW5kbGVyKGZ1bmN0aW9uKCkKICAgICAgICBpZiBub3QgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKHNwYXduZWRDYXIpIHRoZW4gcmV0dXJuIGZhbHNlIGVuZAogICAgICAgIFZFSElDTEUuU1RBUlRfVkVISUNMRV9IT1JOKHNwYXduZWRDYXIsIDMwMCwgMTMzMDE0MDQxOCwgZmFsc2UpCiAgICAgICAgdXRpbC55aWVsZCg1MDApCiAgICBlbmQpCiAgICB3aGlsZSBzcGF3bmVkQ2FyIGRvCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRShzcGF3bmVkQ2FyLCBmYWxzZSkKICAgICAgICBpZiBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsIDY4KSB0aGVuCiAgICAgICAgICAgIGxvY2FsIEJvbWJvZmZzZXQgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoc3Bhd25lZENhciwgMCwgMCwgMCkKICAgICAgICAgICAgRklSRS5BRERfRVhQTE9TSU9OKEJvbWJvZmZzZXQueCwgQm9tYm9mZnNldC55LCBCb21ib2Zmc2V0LnosIDU5LCAxLCB0cnVlLCBmYWxzZSwgMS4wLCBmYWxzZSkKICAgICAgICAgICAgdXRpbC55aWVsZCgxMDAwKQogICAgICAgICAgICBkZWxldGVfZW50aXR5KHNwYXduZWRDYXIpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZW5kCiAgICAgICAgdXRpbC55aWVsZCgpCiAgICBlbmQKZW5kCgoKCgotLS0t54yr54yr54K45by5CmZ1bmN0aW9uIGNhdF9ib21iKHBpZCkKICAgIAogICAgbG9jYWwgdGFyZ2V0X3BlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICBsb2NhbCBjb29yZHMgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFModGFyZ2V0X3BlZCwgZmFsc2UpCiAgICBjb29yZHMueCA9IGNvb3Jkc1sneCddCiAgICBjb29yZHMueSA9IGNvb3Jkc1sneSddCiAgICBjb29yZHMueiA9IGNvb3Jkc1sneiddCiAgICBoYXNoID0gdXRpbC5qb2FhdCgiYV9jX2NhdF8wMSIpCiAgICByZXF1ZXN0X21vZGVsKGhhc2gpCiAgICBmb3IgaT0xLCAzMCBkbwogICAgICAgIGxvY2FsIGNhdCA9IGVudGl0aWVzLmNyZWF0ZV9wZWQoMjgsIGhhc2gsIGNvb3JkcywgbWF0aC5yYW5kb20oMCwgMjcwKSkKICAgICAgICBsb2NhbCByYW5kX3ggPSBtYXRoLnJhbmRvbSgtMTAsIDEwKSo1CiAgICAgICAgbG9jYWwgcmFuZF95ID0gbWF0aC5yYW5kb20oLTEwLCAxMCkqNQogICAgICAgIGxvY2FsIHJhbmRfeiA9IG1hdGgucmFuZG9tKC0xMCwgMTApKjUKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKGNhdCwgdHJ1ZSkKICAgICAgICBFTlRJVFkuQVBQTFlfRk9SQ0VfVE9fRU5USVRZX0NFTlRFUl9PRl9NQVNTKGNhdCwgMSwgcmFuZF94LCByYW5kX3ksIHJhbmRfeiwgdHJ1ZSwgZmFsc2UsIHRydWUsIHRydWUpCiAgICAgICAgQVVESU8uUExBWV9QQUlOKGNhdCwgNywgMCkKICAgIGVuZAplbmQKCi0tLS3lpI3mtLtQRUQKZnVuY3Rpb24gcmVzdXJyZWN0X3BlZChwZWQpCiAgICBUQVNLLkNMRUFSX1BFRF9UQVNLU19JTU1FRElBVEVMWShwZWQpCiAgICBQRUQuUkVTVVJSRUNUX1BFRChwZWQpCiAgICBQRUQuU0VUX1BFRF9LRUVQX1RBU0socGVkLCB0cnVlKQogICAgUEVELlNFVF9QRURfUkVMQVRJT05TSElQX0dST1VQX0hBU0gocGVkLCBNSVNDLkdFVF9IQVNIX0tFWSgicmdGTV9IYXRlRXZlcnlPbmUiKSkKICAgIFBFRC5TRVRfUEVEX0NPTUJBVF9BVFRSSUJVVEVTKHBlZCwgNSwgdHJ1ZSkKICAgIFBFRC5TRVRfUEVEX0NPTUJBVF9BVFRSSUJVVEVTKHBlZCwgMCwgZmFsc2UpCiAgICBQRUQuU0VUX1BFRF9GTEVFX0FUVFJJQlVURVMocGVkLCA1MTIsIHRydWUpCiAgICBQRUQuU0VUX1BFRF9DT01CQVRfUkFOR0UocGVkLCAyKQogICAgRU5USVRZLlNFVF9FTlRJVFlfSEVBTFRIKHBlZCwgTUlTQy5HRVRfUkFORE9NX0lOVF9JTl9SQU5HRSgxMjUsIDE1MCksIDApCiAgICBQRUQuU0VUX0JMT0NLSU5HX09GX05PTl9URU1QT1JBUllfRVZFTlRTKHBlZCwgdHJ1ZSkKZW5kCgotLS0t6Ieq5Yqo5bCx57uq5Li75py6CmZ1bmN0aW9uIEF1dG9SZWFkeUhvc3QoKQogICAgaWYgTkVUV09SSy5ORVRXT1JLX0lTX1NFU1NJT05fU1RBUlRFRCgpIHRoZW4KICAgICAgICBsb2NhbCBob3N0eHZsaWUgPSBwbGF5ZXJzLmdldF9ob3N0X3F1ZXVlX3Bvc2l0aW9uKFBMQVlFUi5QTEFZRVJfSUQoKSkKICAgICAgICBsb2NhbCBob3N0ID0gTkVUV09SSy5ORVRXT1JLX0dFVF9IT1NUX1BMQVlFUl9JTkRFWCgpCiAgICAgICAgaWYgaG9zdHh2bGllID09IDEgYW5kIChob3N0IH49IFBMQVlFUi5QTEFZRVJfSUQoKSkgdGhlbgogICAgICAgICAgICBsb2NhbCBob3N0bmFtZSA9IFBMQVlFUi5HRVRfUExBWUVSX05BTUUoaG9zdCkKICAgICAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJraWNrICIgLi4gaG9zdG5hbWUpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgotLS0t6L+H5rih54q25oCBCmZ1bmN0aW9uIGdldFRyYW5zaXRpb25TdGF0ZSgpCglyZXR1cm4gbWVtb3J5LnJlYWRfaW50KG1lbW9yeS5zY3JpcHRfZ2xvYmFsKDE1NzUwMTEpKSAgCmVuZAotLei/lOWbnuW9k+WJjei/h+a4oeWQjeWtlwpmdW5jdGlvbiBnZXRUcmFuc2l0aW9uU3RhdGVOYW1lKCkgLS0gY3JlZGl0IHRvIHNhcHBoaXJlIGZvciB0aGlzIGZ1bmN0aW9uCiAgICBsb2NhbCBzdGF0ZSA9IGdldFRyYW5zaXRpb25TdGF0ZSgpCiAgICByZXR1cm4gVHJhbnNpdGlvblN0YXRlW3N0YXRlXQplbmQKZnVuY3Rpb24gc2hvd190cmFuc2l0aW9uX2FjdGl2ZSgpCiAgICBpZiB1dGlsLmlzX3Nlc3Npb25fdHJhbnNpdGlvbl9hY3RpdmUoKSB0aGVuCiAgICAgICAgSFVELkJFR0lOX1RFWFRfQ09NTUFORF9CVVNZU1BJTk5FUl9PTigiU1RSSU5HIikKICAgICAgICBIVUQuQUREX1RFWFRfQ09NUE9ORU5UX1NVQlNUUklOR19QTEFZRVJfTkFNRShnZXRUcmFuc2l0aW9uU3RhdGVOYW1lKCkpCiAgICAgICAgSFVELkVORF9URVhUX0NPTU1BTkRfQlVTWVNQSU5ORVJfT04oNSkKICAgIGVsc2UKICAgICAgICBIVUQuQlVTWVNQSU5ORVJfT0ZGKCkKICAgIGVuZAogICAgdXRpbC55aWVsZCgxMDAwKQplbmQKCi0tLS3nu5jliLbnjqnlrrbmqKHlnosKbG9jYWwgY3VyX3JvdCA9IDAKbG9jYWwgY3VyX2ZvY3VzZWRfcGxheWVyID0gbmlsCmxvY2FsIGN1cl9jbG9uZSA9IDAKZnVuY3Rpb24gY3JlYXRlX3BsYXllcl9jbG9uZShwaWQpCiAgICBsb2NhbCBuZXdfcGVkID0gUEVELkNMT05FX1BFRChQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSwgZmFsc2UsIGZhbHNlLCB0cnVlKQogICAgLS3liKTmlq3njqnlrrbmmK/lkKbmrbvkuqHvvIzlpI3mtLvmqKHlnovlj6/pmLLmraLmqKHlnovourrlnKjlnLDkuIoKICAgIGlmIFBFRC5JU19QRURfREVBRF9PUl9EWUlORyhuZXdfcGVkLCB0cnVlKSB0aGVuCiAgICAgICAgVEFTSy5DTEVBUl9QRURfVEFTS1NfSU1NRURJQVRFTFkobmV3X3BlZCkKICAgICAgICBQRUQuUkVTVVJSRUNUX1BFRChuZXdfcGVkKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0hFQUxUSChuZXdfcGVkLCBNSVNDLkdFVF9SQU5ET01fSU5UX0lOX1JBTkdFKDEyNSwgMTUwKSwgMCkKICAgIGVuZAogICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04obmV3X3BlZCwgdHJ1ZSkKICAgIEVOVElUWS5TRVRfRU5USVRZX0lOVklOQ0lCTEUobmV3X3BlZCwgdHJ1ZSkKICAgIFBFRC5TRVRfQkxPQ0tJTkdfT0ZfTk9OX1RFTVBPUkFSWV9FVkVOVFMobmV3X3BlZCwgdHJ1ZSkKICAgIFRBU0suVEFTS19TRVRfQkxPQ0tJTkdfT0ZfTk9OX1RFTVBPUkFSWV9FVkVOVFMobmV3X3BlZCwgdHJ1ZSkKICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEUyhuZXdfcGVkLCAwLCAwLCAtNTAsIHRydWUsIHRydWUsIHRydWUsIGZhbHNlKQogICAgRU5USVRZLlNFVF9FTlRJVFlfQUxQSEEobmV3X3BlZCwgMjAwLCBmYWxzZSkKICAgIEVOVElUWS5TRVRfRU5USVRZX0NPTExJU0lPTihuZXdfcGVkLCBmYWxzZSwgdHJ1ZSkKICAgIHJldHVybiBuZXdfcGVkCmVuZApmdW5jdGlvbiBEcmF3X3BsYXllcl9tb2RlbCgpCiAgICBsb2NhbCBmb2N1c2VkID0gcGxheWVycy5nZXRfZm9jdXNlZCgpCiAgICBpZiAoZm9jdXNlZFsxXSB+PSBuaWwgYW5kIGZvY3VzZWRbMl0gPT0gbmlsKSBhbmQgbWVudS5pc19vcGVuKCkgdGhlbgogICAgICAgIGxvY2FsIHBpZCA9IGZvY3VzZWRbMV0KICAgICAgICBpZiBwaWQgfj0gY3VyX2ZvY3VzZWRfcGxheWVyIHRoZW4KICAgICAgICAgICAgaWYgY3VyX2Nsb25lIH49IDAgdGhlbgogICAgICAgICAgICAgICAgZGVsZXRlX2VudGl0eShjdXJfY2xvbmUpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBjdXJfZm9jdXNlZF9wbGF5ZXIgPSBwaWQKICAgICAgICAgICAgY3VyX2Nsb25lID0gY3JlYXRlX3BsYXllcl9jbG9uZShwaWQpCiAgICAgICAgZW5kCiAgICAgICAgbG9jYWwgbXlwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpCiAgICAgICAgbG9jYWwgb2Zmc2V0ID0gZ2V0X29mZnNldF9mcm9tX2NhbWVyYSg4KS0t5LuO55u45py66I635Y+W5YGP56e76YePCiAgICAgICAgLS1FTlRJVFkuU0VUX0VOVElUWV9DT09SRFMoY3VyX2Nsb25lLCBvZmZzZXQueCwgb2Zmc2V0LnksIG9mZnNldC56LTEsIHRydWUsIHRydWUsIHRydWUsIGZhbHNlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEUyhjdXJfY2xvbmUsIG9mZnNldC54LCBvZmZzZXQueSwgbXlwb3MueiAtIDAuNSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgZmFsc2UpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04oY3VyX2Nsb25lLCAwLCAwLCBjdXJfcm90LCAwLCB0cnVlKQogICAgICAgIC0tdXRpbC5kcmF3X2JveCh2My5uZXcob2Zmc2V0LngsIG9mZnNldC55LCBvZmZzZXQueiArIDAuMSksIHYzLm5ldygwLCAwLCBjdXJfcm90KSwgdjMubmV3KDEsIDEsIDIpLCAyNTUsIDI1NSwgMjU1LCA1MCkKICAgICAgICB1dGlsLmRyYXdfYm94KHYzLm5ldyhvZmZzZXQueCwgb2Zmc2V0LnksIG15cG9zLnogKyAwLjUpLCB2My5uZXcoMCwgMCwgY3VyX3JvdCksIHYzLm5ldygxLCAxLCAyKSwgMjU1LCAyNTUsIDI1NSwgNTApCiAgICAgICAgaWYgY3VyX3JvdCA+PSAzNjAgdGhlbgogICAgICAgICAgICBjdXJfcm90ID0gMCAKICAgICAgICBlbHNlIAogICAgICAgICAgICBjdXJfcm90ID0gY3VyX3JvdCArIDEKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICBpZiBjdXJfZm9jdXNlZF9wbGF5ZXIgfj0gbmlsIHRoZW4KICAgICAgICAgICAgZGVsZXRlX2VudGl0eShjdXJfY2xvbmUpCiAgICAgICAgICAgIGN1cl9jbG9uZSA9IDAKICAgICAgICAgICAgY3VyX2ZvY3VzZWRfcGxheWVyID0gbmlsCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgoKCgotLS0t5aix5LmQ57KS5a2Q5pWI5p6cCmxvY2FsIHNlbHB0ZnggPSB7YT0gInNjcl9yY2JhcnJ5MiIsYj0gInNjcl9jbG93bl9hcHBlYXJzIixjID0iNSJ9CmZ1bmN0aW9uIHB0ZnhfZnVuKCkKICAgIGxvY2FsIHRhcmdldHMgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRURfU0NSSVBUX0lOREVYKFBMQVlFUi5QTEFZRVJfSUQoKSkKICAgIGxvY2FsIHRhcjEgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFModGFyZ2V0cywgdHJ1ZSkKICAgIHJlcXVlc3RfcHRmeF9hc3NldChzZWxwdGZ4LmEpCiAgICBHUkFQSElDUy5VU0VfUEFSVElDTEVfRlhfQVNTRVQoc2VscHRmeC5hKQogICAgR1JBUEhJQ1MuU1RBUlRfTkVUV09SS0VEX1BBUlRJQ0xFX0ZYX05PTl9MT09QRURfQVRfQ09PUkQoc2VscHRmeC5iLCB0YXIxLngsIHRhcjEueSwgdGFyMS56LCAwLCAwLCAwLCBzZWxwdGZ4LmMsIHRydWUsIHRydWUsIGZhbHNlKQogICAgdXRpbC55aWVsZCgyMDApCmVuZApmdW5jdGlvbiBzZWxfcHRmeF9mdW4odmFsdWUpCiAgICBsb2NhbCBwdGZ4ID0gZnVucHRmeC52YWx1ZVt2YWx1ZV0KICAgIHNlbHB0ZnguYyA9IHB0ZnhbM10tLXNpemUKICAgIHNlbHB0ZnguYiA9IHB0ZnhbMl0tLWVmZgogICAgc2VscHRmeC5hID0gcHRmeFsxXS0tcHRmeAplbmQKCi0tLS3nspLlrZDmlYjmnpzovbDngrgKbG9jYWwgcHRmeHggPSB7bGliID0gJ2NvcmUnLCBzZWwgPSAnZW50X2RzdF9jb25jcmV0ZV9sYXJnZSd9CmZ1bmN0aW9uIHBfZWZmX2JvbWIocGlkKQogICAgCiAgICBsb2NhbCB0YXJnZXRzID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgIGxvY2FsIHRhcjEgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFModGFyZ2V0cywgdHJ1ZSkKICAgIHJlcXVlc3RfcHRmeF9hc3NldChwdGZ4eC5saWIpCiAgICBHUkFQSElDUy5VU0VfUEFSVElDTEVfRlhfQVNTRVQocHRmeHgubGliKQogICAgR1JBUEhJQ1MuU1RBUlRfTkVUV09SS0VEX1BBUlRJQ0xFX0ZYX05PTl9MT09QRURfQVRfQ09PUkQocHRmeHguc2VsLCB0YXIxLngsIHRhcjEueSwgdGFyMS56ICsgMSwgMCwgMCwgMCwgNSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkKZW5kCmZ1bmN0aW9uIHNlbF9wX2VmZl9ib21iKHZhbHVlKQogICAgcHRmeHguc2VsID0gRnhjb3JlLnZhbHVlW3ZhbHVlXQogICAgcHRmeHgubGliID0gJ2NvcmUnCmVuZAoKLS0tLeS6i+WKoeWkhOeQhueoi+W6jwpmdW5jdGlvbiBUcmFuc2FjdGlvblNldHRlcihoYXNoLCBhbW91bnQpCiAgICBTRVRfSU5UX0dMT0JBTChHbG9iYWxfQmFzZS5UcmFuc2FjdGlvbl9HbG9iYWwgKyAxLCBJTlRfTUFYIC0gMSkKICAgIFNFVF9JTlRfR0xPQkFMKEdsb2JhbF9CYXNlLlRyYW5zYWN0aW9uX0dsb2JhbCArIDcsIElOVF9NQVgpCiAgICBTRVRfSU5UX0dMT0JBTChHbG9iYWxfQmFzZS5UcmFuc2FjdGlvbl9HbG9iYWwgKyA2LCAwKQogICAgU0VUX0lOVF9HTE9CQUwoR2xvYmFsX0Jhc2UuVHJhbnNhY3Rpb25fR2xvYmFsICsgNSwgMCkKICAgIFNFVF9JTlRfR0xPQkFMKEdsb2JhbF9CYXNlLlRyYW5zYWN0aW9uX0dsb2JhbCArIDMsIGhhc2gpCiAgICBTRVRfSU5UX0dMT0JBTChHbG9iYWxfQmFzZS5UcmFuc2FjdGlvbl9HbG9iYWwgKyAyLCBhbW91bnQpCiAgICBTRVRfSU5UX0dMT0JBTChHbG9iYWxfQmFzZS5UcmFuc2FjdGlvbl9HbG9iYWwsIDEpCmVuZAoKLS0tLeS7u+WKoeS6pOaYk+WIt+mSsQpmdW5jdGlvbiB0YXNrX3RyYW5zYWN0aW9uKGNhdGVnb3J5LCBhY3Rpb25fdHlwZSwgZmxhZywgaXRlbV90KQogICAgbG9jYWwgYXJncyA9IHtbIml0ZW0iXSA9IGl0ZW1fdFsxXSwgWyJ2YWx1ZSJdID0gaXRlbV90WzJdfQogICAgaWYgTkVUU0hPUFBJTkcuTkVUX0dBTUVTRVJWRVJfQkFTS0VUX0lTX0FDVElWRSgpIHRoZW4KICAgICAgICBORVRTSE9QUElORy5ORVRfR0FNRVNFUlZFUl9CQVNLRVRfRU5EKCkKICAgIGVuZAogICAgbG9jYWwgbWVtID0gbWVtb3J5LmFsbG9jKCkKICAgIGxvY2FsIGJvb2wgPSBORVRTSE9QUElORy5ORVRfR0FNRVNFUlZFUl9CRUdJTl9TRVJWSUNFKG1lbSwgY2F0ZWdvcnksIGFyZ3MuaXRlbSwgYWN0aW9uX3R5cGUsIGFyZ3MudmFsdWUsIGZsYWcpCiAgICB1dGlsLnNwb29mX3NjcmlwdCgic2hvcF9jb250cm9sbGVyIiwgZnVuY3Rpb24oKQogICAgICAgIGlmIGJvb2wgdGhlbgogICAgICAgICAgICBsb2NhbCBpZCA9IG1lbW9yeS5yZWFkX2ludChtZW0pCiAgICAgICAgICAgIE5FVFNIT1BQSU5HLk5FVF9HQU1FU0VSVkVSX0NIRUNLT1VUX1NUQVJUKGlkKQogICAgICAgIGVuZAogICAgZW5kKQogICAgcmVwZWF0CiAgICAgICAgdXRpbC55aWVsZCgpCiAgICB1bnRpbCBub3QgTkVUU0hPUFBJTkcuTkVUX0dBTUVTRVJWRVJfVFJBTlNBQ1RJT05fSU5fUFJPR1JFU1MoKQplbmQKZnVuY3Rpb24gdGFza190cmFuc2FjdGlvbl9tb25leSgpCiAgICBmb3IgaSwgdiBpbiBpcGFpcnModGFza190cmFuc2FjdGlvbnMpIGRvCiAgICAgICAgbWVudS5hY3Rpb24odGFza190cmFuc2FjdGlvbl9vcHQsIHYubmFtZSwge30sICIiLCBmdW5jdGlvbigpCiAgICAgICAgICAgIHRhc2tfdHJhbnNhY3Rpb24odXRpbC5qb2FhdCgiQ0FURUdPUllfU0VSVklDRV9XSVRIX1RIUkVTSE9MRCIpLCB1dGlsLmpvYWF0KCJORVRfU0hPUF9BQ1RJT05fRUFSTiIpLCA0LCB7dXRpbC5qb2FhdCh2LnRhc2tfbmFtZSksIHYudmFsdWV9KQogICAgICAgIGVuZCkKICAgIGVuZAplbmQKCi0t5b+r6YCf5Yi36ZKxCmZ1bmN0aW9uIHF1aWNrX2JydXNoX21vbmV5KGluZGV4KQogICAgLS3ojrflj5blj6/lvpfmnIDlpKflgLwKICAgIGxvY2FsIG1heF9hbW91bnQgPSBORVRTSE9QUElORy5ORVRfR0FNRVNFUlZFUl9HRVRfUFJJQ0UodXRpbC5qb2FhdCgiU0VSVklDRV9FQVJOX0pVR0dBTE9fU1RPUllfTUlTU0lPTiIpLCB1dGlsLmpvYWF0KCJDQVRFR09SWV9TRVJWSUNFX1dJVEhfVEhSRVNIT0xEIiksIHRydWUpCiAgICB0YXNrX3RyYW5zYWN0aW9uKHV0aWwuam9hYXQoIkNBVEVHT1JZX1NFUlZJQ0VfV0lUSF9USFJFU0hPTEQiKSwgdXRpbC5qb2FhdCgiTkVUX1NIT1BfQUNUSU9OX0VBUk4iKSwgaW5kZXggPT0gMSBhbmQgNCBvciAxLCB7dXRpbC5qb2FhdCgiU0VSVklDRV9FQVJOX0pVR0dBTE9fU1RPUllfTUlTU0lPTiIpLCBtYXhfYW1vdW50fSkKZW5kCi0t5b+r6YCf5Yig6ZKxCmZ1bmN0aW9uIHF1aWNrX3JlbW92ZV9tb25leShpbmRleCkKICAgIC0t6I635Y+W5Y+v5b6X5pyA5aSn5YC8CiAgICBsb2NhbCBtYXhfYW1vdW50ID0gTkVUU0hPUFBJTkcuTkVUX0dBTUVTRVJWRVJfR0VUX1BSSUNFKHV0aWwuam9hYXQoIlNFUlZJQ0VfRUFSTl9KVUdHQUxPX1NUT1JZX01JU1NJT04iKSwgdXRpbC5qb2FhdCgiQ0FURUdPUllfU0VSVklDRV9XSVRIX1RIUkVTSE9MRCIpLCB0cnVlKQogICAgdGFza190cmFuc2FjdGlvbih1dGlsLmpvYWF0KCJDQVRFR09SWV9TRVJWSUNFX1dJVEhfVEhSRVNIT0xEIiksIHV0aWwuam9hYXQoIk5FVF9TSE9QX0FDVElPTl9TUEVORCIpLCBpbmRleCA9PSAxIGFuZCA0IG9yIDEsIHt1dGlsLmpvYWF0KCJTRVJWSUNFX0VBUk5fSlVHR0FMT19TVE9SWV9NSVNTSU9OIiksIG1heF9hbW91bnR9KQplbmQKCi0tLS3mlrDmjonpkrHooosKZnVuY3Rpb24gbmV3X2Ryb3BfbW9uZXkoKQogICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKQogICAgbG9jYWwgcGVkID0gY3JlYXRlX3BlZCg0LCA2MDU2MDI4NjQsIHBvcy54LCBwb3MueSwgcG9zLnosIDApCiAgICBQRUQuU0VUX0FNQklFTlRfUEVEU19EUk9QX01PTkVZKHRydWUpCiAgICBQRUQuU0VUX1BFRF9NT05FWShwZWQsIG1hdGgucmFuZG9tKDIwMDApKQogICAgRU5USVRZLlNFVF9FTlRJVFlfQUxQSEEocGVkLCAwLCBmYWxzZSkKICAgIEVOVElUWS5TRVRfRU5USVRZX05PX0NPTExJU0lPTl9FTlRJVFkocGVkLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlKQogICAgdXRpbC55aWVsZCg1MCkKICAgIEVOVElUWS5TRVRfRU5USVRZX0hFQUxUSChwZWQsIDAsIDApCiAgICB1dGlsLnlpZWxkKDEwMCkKICAgIGRlbGV0ZV9lbnRpdHkocGVkKQplbmQKCgotLS0t6Ieq5YqoQ0VPL+mmlumihgpmdW5jdGlvbiBhdXRvX0NFTygpCiAgICBpZiBub3QgTkVUV09SSy5ORVRXT1JLX0lTX1NFU1NJT05fU1RBUlRFRCgpIHRoZW4gcmV0dXJuIGVuZCAKICAgIGZvciBfLCBsYWJlbCBpbiBwYWlycyhDRU9MYWJlbHMpIGRvCiAgICAgICAgaWYgSVNfSEVMUF9NU0dfRElTUExBWUVEKGxhYmVsKSB0aGVuCiAgICAgICAgICAgIGlmIHBsYXllcnMuZ2V0X2Jvc3MoUExBWUVSLlBMQVlFUl9JRCgpKSA9PSAtMSB0aGVuIG1lbnUudHJpZ2dlcl9jb21tYW5kcygiY2Vvc3RhcnQiKSBlbmQKICAgICAgICAgICAgaWYgcGxheWVycy5nZXRfb3JnX3R5cGUoUExBWUVSLlBMQVlFUl9JRCgpKSA9PSAxIHRoZW4gbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJjZW90b21jIikgZW5kCiAgICAgICAgICAgIHV0aWwudG9hc3QoIueci+i1t+adpeS9oOmcgOimgeaIkOS4uuS4gOS4qkNFTyIpCiAgICAgICAgZW5kCiAgICBlbmQKICAgIGZvciBfLCBsYWJlbCBpbiBwYWlycyhNQ0xhYmVscykgZG8KICAgICAgICBpZiBJU19IRUxQX01TR19ESVNQTEFZRUQobGFiZWwpIHRoZW4KICAgICAgICAgICAgaWYgcGxheWVycy5nZXRfYm9zcyhQTEFZRVIuUExBWUVSX0lEKCkpID09IC0xIHRoZW4gbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJtY3N0YXJ0IikgZW5kCiAgICAgICAgICAgIGlmIHBsYXllcnMuZ2V0X29yZ190eXBlKFBMQVlFUi5QTEFZRVJfSUQoKSkgPT0gMCB0aGVuIG1lbnUudHJpZ2dlcl9jb21tYW5kcygiY2VvdG9tYyIpIGVuZAogICAgICAgICAgICB1dGlsLnRvYXN0KCLnnIvotbfmnaXkvaDpnIDopoHmiJDkuLrkuIDkuKrpppbpooYiKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKLS0tLeiHquWKqOS7u+WKoeiEmuacrOS4u+acugpmdW5jdGlvbiBhdXRvX3Rhc2tfc2NyaXB0X2hvc3QoKQogICAgaWYgSVNfU0NSSVBUX1JVTk5JTkcoImZtX21pc3Npb25fY29udHJvbGxlcl8yMDIwIikgdGhlbgogICAgICAgIC0t5L2p6YeM56eR5bKbCiAgICAgICAgaWYgTkVUV09SSy5ORVRXT1JLX0dFVF9IT1NUX09GX1NDUklQVCgiZm1fbWlzc2lvbl9jb250cm9sbGVyXzIwMjAiLCAwLCAwKSA9PSBQTEFZRVIuUExBWUVSX0lEKCkgdGhlbgogICAgICAgICAgICBkcmF3X3N0cmluZygi6I635b6X5b2T5YmN5Lu75Yqh6ISa5pys5Li75py6IiwgMC4wMywgMC4wNSwgMC40LCAxKQogICAgICAgIGVsc2UKICAgICAgICAgICAgZm9yY2Vfc2NyaXB0X2hvc3QoImZtX21pc3Npb25fY29udHJvbGxlcl8yMDIwIikKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGlmIElTX1NDUklQVF9SVU5OSU5HKCJmbV9taXNzaW9uX2NvbnRyb2xsZXIiKSB0aGVuCiAgICAgICAgLS3lhbbku5bku7vliqEKICAgICAgICBpZiBORVRXT1JLLk5FVFdPUktfR0VUX0hPU1RfT0ZfU0NSSVBUKCJmbV9taXNzaW9uX2NvbnRyb2xsZXIiLCAwLCAwKSA9PSBQTEFZRVIuUExBWUVSX0lEKCkgdGhlbgogICAgICAgICAgICBkcmF3X3N0cmluZygi6I635b6X5b2T5YmN5Lu75Yqh6ISa5pys5Li75py6IiwgMC4wMywgMC4wNSwgMC40LCAxKQogICAgICAgIGVsc2UKICAgICAgICAgICAgZm9yY2Vfc2NyaXB0X2hvc3QoImZtX21pc3Npb25fY29udHJvbGxlciIpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgotLS0t6aKE6K6+5pyN6KOFCmZ1bmN0aW9uIGxvYWRfY2xvdGhlcyhkaXJlY3RvcnkpCiAgICBsb2NhbCBsb2FkZWRfY2xvdGggPSB7fQogICAgZm9yIGksIGZpbGVwYXRoIGluIGlwYWlycyhmaWxlc3lzdGVtLmxpc3RfZmlsZXMoZGlyZWN0b3J5KSkgZG8KICAgICAgICBsb2NhbCBfLCBmaWxlbmFtZSwgZXh0ID0gc3RyaW5nLm1hdGNoKGZpbGVwYXRoLCAiKC4tKShbXlxcL10tJS4/KFteJS5cXC9dKikpJCIpCiAgICAgICAgaWYgbm90IGZpbGVzeXN0ZW0uaXNfZGlyKGZpbGVwYXRoKSBhbmQgZXh0ID09ICJqc29uIiB0aGVuCiAgICAgICAgICAgIGxvY2FsIGNsb3RoX2RhdGUgPSBnZXRfaW5mb19mcm9tX2pzb25maWxlKGZpbGVwYXRoKQogICAgICAgICAgICB0YWJsZS5pbnNlcnQobG9hZGVkX2Nsb3RoLCBjbG90aF9kYXRlKQogICAgICAgIGVuZAogICAgZW5kCiAgICByZXR1cm4gbG9hZGVkX2Nsb3RoCmVuZApmdW5jdGlvbiBQcmVzZXRfb3V0Zml0cygpCiAgICBsb2NhbCBvdXRmaXRfZm9sZGVyID0gZmlsZXN5c3RlbS5zY3JpcHRzX2RpcigpIC4uICJkYWlkYWlTY3JpcHRcXE91dGZpdHMiCgogICAgb3V0c19mb2xmZXIgPSBtZW51LmFjdGlvbihteV9jbG90aCwgIuaJk+W8gOaWh+S7tuWkuSIsIHt9LCAiIiwgZnVuY3Rpb24oKQogICAgICAgIHV0aWwub3Blbl9mb2xkZXIob3V0Zml0X2ZvbGRlcikKICAgIGVuZCkKICAgIG91dHNfZGl2ID0gbWVudS5kaXZpZGVyKG15X2Nsb3RoLCAi6KGj5p+cIikKCiAgICBwcmVzZXRjbG90aGVzID0gbG9hZF9jbG90aGVzKG91dGZpdF9mb2xkZXIpCiAgICBmb3IgXywgY2xvdGggaW4gcGFpcnMocHJlc2V0Y2xvdGhlcykgZG8KICAgICAgICBjbG90aC5uYW1lID0gbWVudS5hY3Rpb24obXlfY2xvdGgsIGNsb3RoLm5hbWUuLiJbIi4uY2xvdGgudHlwZS4uIl0iLCB7fSwgIiIsIGZ1bmN0aW9uKCkKICAgICAgICAgICAgaWYgY2xvdGgudHlwZSA9PSAi5aWz5oCnIiB0aGVuLS1tcF9mX2ZyZWVtb2RlXzAxCiAgICAgICAgICAgICAgICAtLWNoYW5nZV9tb2RlbChQTEFZRVIuUExBWUVSX0lEKCksIE1JU0MuR0VUX0hBU0hfS0VZKCJtcF9mX2ZyZWVtb2RlXzAxIikpCiAgICAgICAgICAgICAgICBtZW51LnRyaWdnZXJfY29tbWFuZHMoIm1wZmVtYWxlIikKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgLS1jaGFuZ2VfbW9kZWwoUExBWUVSLlBMQVlFUl9JRCgpLCBNSVNDLkdFVF9IQVNIX0tFWSgibXBfbV9mcmVlbW9kZV8wMSIpKQogICAgICAgICAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJtcG1hbGUiKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgUEVELlNFVF9QRURfQ09NUE9ORU5UX1ZBUklBVElPTihQTEFZRVIuR0VUX1BMQVlFUl9QRUQoUExBWUVSLlBMQVlFUl9JRCgpKSwgMCwgY2xvdGguSGVhZCwgY2xvdGguSGVhZF9WYXJpYXRpb24sIDApLS3lpLTpg6gKICAgICAgICAgICAgUEVELlNFVF9QRURfQ09NUE9ORU5UX1ZBUklBVElPTihQTEFZRVIuR0VUX1BMQVlFUl9QRUQoUExBWUVSLlBMQVlFUl9JRCgpKSwgMSwgY2xvdGguTWFzaywgY2xvdGguTWFza19WYXJpYXRpb24sIDApLS3pnaLlhbcKICAgICAgICAgICAgUEVELlNFVF9QRURfQ09NUE9ORU5UX1ZBUklBVElPTihQTEFZRVIuR0VUX1BMQVlFUl9QRUQoUExBWUVSLlBMQVlFUl9JRCgpKSwgMiwgY2xvdGguSGFpciwgMCwgMCktLeWPkeWeiwogICAgICAgICAgICBQRUQxLl9TRVRfUEVEX0hBSVJfQ09MT1IoUExBWUVSLkdFVF9QTEFZRVJfUEVEKFBMQVlFUi5QTEFZRVJfSUQoKSksIGNsb3RoLkhhaXJfQ29sb3VyLCBjbG90aC5oaWdobGlnaHRfQ29sb3IpLS3lj5HlnovpopzoibIKICAgICAgICAgICAgUEVELlNFVF9QRURfQ09NUE9ORU5UX1ZBUklBVElPTihQTEFZRVIuR0VUX1BMQVlFUl9QRUQoUExBWUVSLlBMQVlFUl9JRCgpKSwgMywgY2xvdGguR2xvdmVzX1RvcnNvLCBjbG90aC5HbG92ZXNfVG9yc29fVmFyaWF0aW9uLCAwKS0t5omL5aWXL+i6r+W5sgogICAgICAgICAgICBQRUQuU0VUX1BFRF9DT01QT05FTlRfVkFSSUFUSU9OKFBMQVlFUi5HRVRfUExBWUVSX1BFRChQTEFZRVIuUExBWUVSX0lEKCkpLCA0LCBjbG90aC5QYW50cywgY2xvdGguUGFudHNfVmFyaWF0aW9uLCAwKS0t6KOk5a2QCiAgICAgICAgICAgIFBFRC5TRVRfUEVEX0NPTVBPTkVOVF9WQVJJQVRJT04oUExBWUVSLkdFVF9QTEFZRVJfUEVEKFBMQVlFUi5QTEFZRVJfSUQoKSksIDUsIGNsb3RoLlBhcmFjaHV0ZV9CYWcsIGNsb3RoLlBhcmFjaHV0ZV9CYWdfVmFyaWF0aW9uLCAwKS0t6ZmN6JC95LyeL+iDjOWMhQogICAgICAgICAgICBQRUQuU0VUX1BFRF9DT01QT05FTlRfVkFSSUFUSU9OKFBMQVlFUi5HRVRfUExBWUVSX1BFRChQTEFZRVIuUExBWUVSX0lEKCkpLCA2LCBjbG90aC5TaG9lcywgY2xvdGguU2hvZXNfVmFyaWF0aW9uLCAwKS0t6Z6L5a2QCiAgICAgICAgICAgIFBFRC5TRVRfUEVEX0NPTVBPTkVOVF9WQVJJQVRJT04oUExBWUVSLkdFVF9QTEFZRVJfUEVEKFBMQVlFUi5QTEFZRVJfSUQoKSksIDcsIGNsb3RoLkFjY2Vzc29yaWVzLCBjbG90aC5BY2Nlc3Nvcmllc19WYXJpYXRpb24sIDApLS3phY3ku7YKICAgICAgICAgICAgUEVELlNFVF9QRURfQ09NUE9ORU5UX1ZBUklBVElPTihQTEFZRVIuR0VUX1BMQVlFUl9QRUQoUExBWUVSLlBMQVlFUl9JRCgpKSwgOCwgY2xvdGguVG9wXzIsIGNsb3RoLlRvcF8yX1ZhcmlhdGlvbiwgMCktLeS4iui6qzIKICAgICAgICAgICAgUEVELlNFVF9QRURfQ09NUE9ORU5UX1ZBUklBVElPTihQTEFZRVIuR0VUX1BMQVlFUl9QRUQoUExBWUVSLlBMQVlFUl9JRCgpKSwgOSwgY2xvdGguVG9wXzMsIGNsb3RoLlRvcF8zX1ZhcmlhdGlvbiwgMCktLeS4iui6qzMKICAgICAgICAgICAgUEVELlNFVF9QRURfQ09NUE9ORU5UX1ZBUklBVElPTihQTEFZRVIuR0VUX1BMQVlFUl9QRUQoUExBWUVSLlBMQVlFUl9JRCgpKSwgMTAsIGNsb3RoLkRlY2FscywgY2xvdGguRGVjYWxzX1ZhcmlhdGlvbiwgMCktLei0tOiKsQogICAgICAgICAgICBQRUQuU0VUX1BFRF9DT01QT05FTlRfVkFSSUFUSU9OKFBMQVlFUi5HRVRfUExBWUVSX1BFRChQTEFZRVIuUExBWUVSX0lEKCkpLCAxMSwgY2xvdGguVG9wLCBjbG90aC5Ub3BfVmFyaWF0aW9uLCAwKS0t5LiK6LqrCgogICAgICAgICAgICBQRUQuU0VUX1BFRF9QUk9QX0lOREVYKFBMQVlFUi5HRVRfUExBWUVSX1BFRChQTEFZRVIuUExBWUVSX0lEKCkpLCAwLCBjbG90aC5IYXQsIGNsb3RoLkhhdF9WYXJpYXRpb24sIDApLS3luL3lrZAKICAgICAgICAgICAgUEVELlNFVF9QRURfUFJPUF9JTkRFWChQTEFZRVIuR0VUX1BMQVlFUl9QRUQoUExBWUVSLlBMQVlFUl9JRCgpKSwgMSwgY2xvdGguR2xhc3NlcywgY2xvdGguR2xhc3Nlc19WYXJpYXRpb24sIDApLS3nnLzplZwKICAgICAgICAgICAgUEVELlNFVF9QRURfUFJPUF9JTkRFWChQTEFZRVIuR0VUX1BMQVlFUl9QRUQoUExBWUVSLlBMQVlFUl9JRCgpKSwgMiwgY2xvdGguRWFyd2VhciwgY2xvdGguRWFyd2Vhcl9WYXJpYXRpb24sIDApLS3ogLPppbAKICAgICAgICAgICAgUEVELlNFVF9QRURfUFJPUF9JTkRFWChQTEFZRVIuR0VUX1BMQVlFUl9QRUQoUExBWUVSLlBMQVlFUl9JRCgpKSwgNiwgY2xvdGguV2F0Y2gsIGNsb3RoLldhdGNoX1ZhcmlhdGlvbiwgMCktLeaJi+ihqAogICAgICAgICAgICBQRUQuU0VUX1BFRF9QUk9QX0lOREVYKFBMQVlFUi5HRVRfUExBWUVSX1BFRChQTEFZRVIuUExBWUVSX0lEKCkpLCA3LCBjbG90aC5CcmFjZWxldCwgY2xvdGguQnJhY2VsZXRfVmFyaWF0aW9uLCAwKS0t5omL6ZO+CgogICAgICAgIGVuZCkKICAgIGVuZAplbmQKZnVuY3Rpb24gZW5kUHJlc2V0X291dGZpdHMoKQogICAgbWVudS5kZWxldGUob3V0c19mb2xmZXIpCiAgICBtZW51LmRlbGV0ZShvdXRzX2RpdikKICAgIGZvciBfLCBjbG90aCBpbiBwYWlycyhwcmVzZXRjbG90aGVzKSBkbwogICAgICAgIGlmIGNsb3RoLm5hbWUgdGhlbgogICAgICAgICAgICBtZW51LmRlbGV0ZShjbG90aC5uYW1lKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKCi0tLS3kuI3lj6/op4EKZnVuY3Rpb24gaW52aXNpYmxlKGVudGl0eSwgdmFsdWUpCiAgICBWSVNJQkxFX1ZBTFVFID0gdmFsdWUKICAgIHdoaWxlIFZJU0lCTEVfVkFMVUUgfj0gMSBkbwogICAgICAgIGlmIFZJU0lCTEVfVkFMVUUgPT0gMiB0aGVuICAtLeacrOWcsOWPr+ingQogICAgICAgICAgICBORVRXT1JLLlNFVF9FTlRJVFlfTE9DQUxMWV9WSVNJQkxFKGVudGl0eSkKICAgICAgICBlbHNlaWYgVklTSUJMRV9WQUxVRSA9PSAzIHRoZW4gIC0t5LiN5Y+v6KeBCiAgICAgICAgICAgIE5FVFdPUksuU0VUX0VOVElUWV9MT0NBTExZX0lOVklTSUJMRShlbnRpdHkpCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1ZJU0lCTEUoZW50aXR5LCBmYWxzZSwgZmFsc2UpCiAgICAgICAgZW5kCiAgICAgICAgdXRpbC55aWVsZCgpCiAgICBlbmQKICAgIEVOVElUWS5TRVRfRU5USVRZX1ZJU0lCTEUoZW50aXR5LCB0cnVlLCBmYWxzZSkKZW5kCgoKLS0tLeS8oOmAgeWIsOS7lueahOi9veWFtwpmdW5jdGlvbiB0cF9wX2NhcihwaWQpCiAgICBpZiBQRUQuSVNfUEVEX0lOX0FOWV9WRUhJQ0xFKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpKSB0aGVuCiAgICAgICAgbG9jYWwgcGxheWVyX3ZlaCA9IFBFRC5HRVRfVkVISUNMRV9QRURfSVNfVVNJTkcoUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkpCiAgICAgICAgbG9jYWwgaGFzaCA9IEVOVElUWS5HRVRfRU5USVRZX01PREVMKHBsYXllcl92ZWgpCiAgICAgICAgbG9jYWwgc2VhdF9jb3VudCA9IFZFSElDTEUuR0VUX1ZFSElDTEVfTU9ERUxfTlVNQkVSX09GX1NFQVRTKGhhc2gpCiAgICAgICAgZm9yIGkgPSAwLCBzZWF0X2NvdW50IC0gMSBkbwogICAgICAgICAgICBpZiBWRUhJQ0xFLkFSRV9BTllfVkVISUNMRV9TRUFUU19GUkVFKHBsYXllcl92ZWgpIHRoZW4KICAgICAgICAgICAgICAgIFBFRC5TRVRfUEVEX0lOVE9fVkVISUNMRShQTEFZRVIuR0VUX1BMQVlFUl9QRUQoUExBWUVSLlBMQVlFUl9JRCgpKSwgcGxheWVyX3ZlaCwgaSkKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZWxzZQogICAgICAgIHV0aWwudG9hc3QoIueOqeWutuS4jeWcqOi9veWFtyIpCiAgICBlbmQKZW5kCgoKCgoKLS0tLS3ml6DkurrmnLrmipXmjrfngrjlvLkKZnVuY3Rpb24gZHJvbmVfZHJvcChwaWQpCiAgICAKCiAgICBORVRXT1JLLk5FVFdPUktfU0VUX0lOX1NQRUNUQVRPUl9NT0RFKHRydWUsIFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpKQogICAgSFVELlNFVF9NSU5JTUFQX0lOX1NQRUNUQVRPUl9NT0RFKHRydWUsIFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpKQogICAgdXRpbC55aWVsZCgxMDAwKQoKICAgIGxvY2FsIGRyb25laGFzaCA9IDE2NTc2NDcyMTUKICAgIGxvY2FsIGJvbWJoYXNoID0gLTQ0OTg0MDI4NgogICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCAwLCAwLCA1KQogICAgbG9jYWwgZHJvbmUgPSBjcmVhdGVfb2JqZWN0KGRyb25laGFzaCwgcG9zLngsIHBvcy55LCBwb3MueikKICAgIGxvY2FsIGJvbWIgPSBjcmVhdGVfb2JqZWN0KGJvbWJoYXNoLCBwb3MueCwgcG9zLnksIHBvcy56KQogICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKGJvbWIsIGRyb25lLCAwLCAwLCAwLCAtMC4xLCA5MCwgMCwgMCwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDAsIHRydWUsIDApIAoKICAgIGxvY2FsIGRyb25lcG9zID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCAwLCAtNiwgOCkKICAgIGxvY2FsIGNhbSA9IENBTS5DUkVBVEVfQ0FNX1dJVEhfUEFSQU1TKCJERUZBVUxUX1NDUklQVEVEX0NBTUVSQSIsIGRyb25lcG9zLngsIGRyb25lcG9zLnksIGRyb25lcG9zLnosIDAsIDAsIDAsIDIsIDIpCiAgICBsb2NhbCBoZWFkID0gRU5USVRZLkdFVF9FTlRJVFlfUk9UQVRJT04oUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCksIDApCiAgICBDQU0uU0VUX0NBTV9ST1QoY2FtLGhlYWQueCAtIDQ1LCBoZWFkLnksIGhlYWQueiwgMikKICAgIENBTS5TRVRfQ0FNX0FDVElWRShjYW0sIHRydWUpCiAgICBDQU0uU0VUX0NBTV9GT1YoY2FtLCA5MCkKICAgIENBTS5SRU5ERVJfU0NSSVBUX0NBTVModHJ1ZSwgdHJ1ZSwgMTAwLCB0cnVlLCB0cnVlLCAwKQogICAgCiAgICBsb2NhbCBlbmRfdGltZSA9IG9zLnRpbWUoKSArIDIKICAgIHdoaWxlIGVuZF90aW1lID4gb3MudGltZSgpIGRvCiAgICAgICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCAwLCAwLCA1KQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEUyhkcm9uZSwgcG9zLngsIHBvcy55LCBwb3MueiwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgdXRpbC55aWVsZCgpCiAgICBlbmQKCiAgICBFTlRJVFkuREVUQUNIX0VOVElUWShib21iLCB0cnVlLCB0cnVlKQogICAgd2hpbGUgbm90IEVOVElUWS5IQVNfRU5USVRZX0NPTExJREVEX1dJVEhfQU5ZVEhJTkcoYm9tYikgYW5kIG5vdCBFTlRJVFkuSVNfRU5USVRZX0lOX1dBVEVSKGJvbWIpIGRvCiAgICAgICAgdXRpbC55aWVsZCgpCiAgICBlbmQKICAgIGxvY2FsIGJvbWJwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoYm9tYiwgZmFsc2UpCiAgICBGSVJFLkFERF9FWFBMT1NJT04oYm9tYnBvcy54LCBib21icG9zLnksIGJvbWJwb3MueiwgMiwgMS4wLCB0cnVlLCBmYWxzZSwgMSwgZmFsc2UpCgogICAgdXRpbC55aWVsZCgxMDAwKQogICAgQ0FNLlJFTkRFUl9TQ1JJUFRfQ0FNUyhmYWxzZSwgdHJ1ZSwgMTAwLCB0cnVlLCB0cnVlLCAwKQogICAgQ0FNLkRFU1RST1lfQ0FNKGNhbSwgZmFsc2UpCiAgICBkZWxldGVfZW50aXR5KGRyb25lLCBib21iKQogICAgTkVUV09SSy5ORVRXT1JLX1NFVF9JTl9TUEVDVEFUT1JfTU9ERSh0cnVlLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgSFVELlNFVF9NSU5JTUFQX0lOX1NQRUNUQVRPUl9NT0RFKHRydWUsIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCmVuZAoKLS0tLeWcsOWbvuadgApmdW5jdGlvbiB0aGVfTWFwX0tpbGwocGlkKQogICAgCiAgICBsb2NhbCBjYXIgPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0lOKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCB0cnVlKQogICAgaWYgY2FyIH49IDAgdGhlbgogICAgICAgIHJlcXVlc3RfY29udHJvbChjYXIsIDMpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTX05PX09GRlNFVChjYXIsIDkwMDAsIDkwMDAsIC01MCwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgICAgICB1dGlsLnlpZWxkKDEwMDApCiAgICAgICAgZGVsZXRlX2VudGl0eShjYXIpCiAgICBlbHNlCiAgICAgICAgbm90aWZ5KCLnjqnlrrbkuI3lnKjovb3lhbciKQogICAgZW5kCmVuZAoKLS0tLem7keS6uueIhueCuApmdW5jdGlvbiBuaWdnZXJzX2JvbWIocGlkKQogICAgCiAgICBsb2NhbCB0YXJnZXRQbGF5ZXJQZWQgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKQogICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHRhcmdldFBsYXllclBlZCwgdHJ1ZSkKICAgIGxvY2FsIG1vZGVsID0gTUlTQy5HRVRfSEFTSF9LRVkoIlBsYXllcl9PbmUiKQogICAgZm9yIGkgPSAwLCAyNSBkbwogICAgICAgIGNyZWF0ZV9wZWQoMSwgbW9kZWwsIHBvcy54LCBwb3MueSwgcG9zLnosIDApCiAgICBlbmQKICAgIEZJUkUuQUREX09XTkVEX0VYUExPU0lPTih0YXJnZXRQbGF5ZXJQZWQsIHBvcy54LCBwb3MueSwgcG9zLnosIDIsIDUwLCB0cnVlLCBmYWxzZSwgMC4wKQplbmQKCi0tLS3nu5jliLblrp7kvZPmipbliqjlhYnmoIcKZnVuY3Rpb24gZHJhd19lbnRfbWFya2VycyhlbnQpCiAgICBsb2NhbCBtb2RlbEhhc2ggPSBFTlRJVFkuR0VUX0VOVElUWV9NT0RFTChlbnQpCiAgICBsb2NhbCBzaXplID0gZ2V0X21vZGVsX3NpemUobW9kZWxIYXNoKQogICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKGVudCwgZmFsc2UpCiAgICBHUkFQSElDUy5EUkFXX01BUktFUigwLCBwb3MueCwgcG9zLnksIHBvcy56ICsgc2l6ZS56KjIvMywgMCwgMTgwLCAwLCAwLCAwLCAwLCAwLjQsIDAuNCwgMC4zLCAyMDAsIDEyMCwgMjUwLCAyNTUsIHRydWUsIHRydWUsIDAsIDAsIDAsIDAsIGZhbHNlKQplbmQKCi0tLS3pgb/lhY3kuovmlYUKZnVuY3Rpb24gYWFfdGhyZWFkKCkKICAgIGxvY2FsIHBsYXllcl9jdXJfY2FyID0gZW50aXRpZXMuZ2V0X3VzZXJfdmVoaWNsZV9hc19oYW5kbGUoKQogICAgaWYgcGxheWVyX2N1cl9jYXIgfj0gMCB0aGVuCiAgICAgICAgbG9jYWwgYyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhwbGF5ZXJfY3VyX2NhciwgdHJ1ZSkKICAgICAgICBsb2NhbCBzaXplID0gZ2V0X21vZGVsX3NpemUoRU5USVRZLkdFVF9FTlRJVFlfTU9ERUwocGxheWVyX2N1cl9jYXIpKQogICAgICAgIGZvciBpPSAxLCAzIGRvCiAgICAgICAgICAgIGlmIGkgPT0gMSB0aGVuCiAgICAgICAgICAgICAgICBhYWQgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMocGxheWVyX2N1cl9jYXIsIC1zaXplWyd4J10sIHNpemVbJ3knXSswLjEsIHNpemVbJ3onXS8yKQogICAgICAgICAgICBlbHNlaWYgaSA9PSAyIHRoZW4KICAgICAgICAgICAgICAgIGFhZCA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhwbGF5ZXJfY3VyX2NhciwgMC4wLCBzaXplWyd5J10rMC4xLCBzaXplWyd6J10vMikKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgYWFkID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKHBsYXllcl9jdXJfY2FyLCBzaXplWyd4J10sIHNpemVbJ3knXSswLjEsIHNpemVbJ3onXS8yKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgRU5USVRZLkdFVF9FTlRJVFlfU1BFRUQocGxheWVyX2N1cl9jYXIpID4gMTAgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgcHRyMSwgcHRyMiwgcHRyMywgcHRyNCA9IG1lbW9yeS5hbGxvYygpLCBtZW1vcnkuYWxsb2MoKSwgbWVtb3J5LmFsbG9jKCksIG1lbW9yeS5hbGxvYygpCiAgICAgICAgICAgICAgICBTSEFQRVRFU1QuR0VUX1NIQVBFX1RFU1RfUkVTVUxUKFNIQVBFVEVTVC5TVEFSVF9FWFBFTlNJVkVfU1lOQ0hST05PVVNfU0hBUEVfVEVTVF9MT1NfUFJPQkUoYy54LGMueSxjLnosYWFkLngsYWFkLnksYWFkLnosLTEscGxheWVyX2N1cl9jYXIsNCksIHB0cjEsIHB0cjIsIHB0cjMsIHB0cjQpCiAgICAgICAgICAgICAgICBsb2NhbCBwMSA9IG1lbW9yeS5yZWFkX2ludChwdHIxKQogICAgICAgICAgICAgICAgbG9jYWwgcDIgPSBtZW1vcnkucmVhZF92ZWN0b3IzKHB0cjIpCiAgICAgICAgICAgICAgICBsb2NhbCBwMyA9IG1lbW9yeS5yZWFkX3ZlY3RvcjMocHRyMykKICAgICAgICAgICAgICAgIGxvY2FsIHA0ID0gbWVtb3J5LnJlYWRfaW50KHB0cjQpCiAgICAgICAgICAgICAgICBsb2NhbCByZXN1bHRzID0ge3AxLCBwMiwgcDMsIHA0fQogICAgICAgICAgICAgICAgaWYgcmVzdWx0c1sxXSB+PSAwIHRoZW4KICAgICAgICAgICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9WRUxPQ0lUWShwbGF5ZXJfY3VyX2NhciwgMC4wLCAwLjAsIDAuMCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQKCgoKLS0tLei9veWFt+W8leaTjuW/q+mAn+W8gOWQrwpmdW5jdGlvbiBmYXN0b25jYXIoKQogICAgbG9jYWwgbG9jYWxwZWQgPSBQTEFZRVIuUExBWUVSX1BFRF9JRCgpCiAgICBpZiBQRUQuSVNfUEVEX0dFVFRJTkdfSU5UT19BX1ZFSElDTEUobG9jYWxwZWQpIHRoZW4KICAgICAgICBsb2NhbCB2ZWggPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0VOVEVSSU5HKGxvY2FscGVkKQogICAgICAgIGlmIG5vdCBWRUhJQ0xFLkdFVF9JU19WRUhJQ0xFX0VOR0lORV9SVU5OSU5HKHZlaCkgdGhlbgogICAgICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0VOR0lORV9IRUFMVEgodmVoLCAxMDAwKQogICAgICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0VOR0lORV9PTih2ZWgsIHRydWUsIHRydWUsIGZhbHNlKQogICAgICAgIGVuZAogICAgICAgIGlmIFZFSElDTEUuR0VUX1ZFSElDTEVfQ0xBU1ModmVoKSA9PSAxNSB0aGVuCiAgICAgICAgICAgIFZFSElDTEUuU0VUX0hFTElfQkxBREVTX0ZVTExfU1BFRUQodmVoKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKLS0tLeiHquWKqOmUgemXqApmdW5jdGlvbiBhdXRvX2xvY2tlZCh0b2dnbGVkKQogICAgYXV0b19sb2NrX2Rvb3IgPSB0b2dnbGVkCiAgICBpZiBhdXRvX2xvY2tfZG9vciB0aGVuIAogICAgICAgIHdoaWxlIGF1dG9fbG9ja19kb29yIGRvCiAgICAgICAgICAgIGlmIFBFRC5JU19QRURfSU5fQU5ZX1ZFSElDTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSkgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgY2FyID0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19JTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgICAgICAgICAgICAgIHJlcXVlc3RfY29udHJvbChjYXIpCiAgICAgICAgICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0RPT1JTX0xPQ0tFRChjYXIsIDIpCiAgICAgICAgICAgICAgICBpZiBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAgLCAyMykgdGhlbiAKICAgICAgICAgICAgICAgICAgICBUQVNLLkNMRUFSX1BFRF9UQVNLU19JTU1FRElBVEVMWShQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGxvY2FsIGxhc3RjYXIgPSBQTEFZRVIuR0VUX1BMQVlFUlNfTEFTVF9WRUhJQ0xFKCkKICAgICAgICAgICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRE9PUlNfTE9DS0VEKGxhc3RjYXIsIDEpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICB1dGlsLnlpZWxkKCkKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICBsb2NhbCBjYXIgPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0lOKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKQogICAgICAgIGxvY2FsIGxhc3RjYXIgPSBQTEFZRVIuR0VUX1BMQVlFUlNfTEFTVF9WRUhJQ0xFKCkKICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0RPT1JTX0xPQ0tFRChjYXIsIDEpCiAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9ET09SU19MT0NLRUQobGFzdGNhciwgMSkKICAgIGVuZAplbmQKCi0tLS3op6PplIHmraPlnKjov5vlhaXnmoTovb3lhbcKZnVuY3Rpb24gdW5sb2NrY2FyKCkKICAgIGxvY2FsIHZlaCA9IFBFRC5HRVRfVkVISUNMRV9QRURfSVNfVFJZSU5HX1RPX0VOVEVSKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICBpZiBQRUQuSVNfUEVEX0lOX0FOWV9WRUhJQ0xFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKSB0aGVuCiAgICAgICAgbG9jYWwgdiA9IFBFRC5HRVRfVkVISUNMRV9QRURfSVNfSU4oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpCiAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9ET09SU19MT0NLRUQodiwgMSkKICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0RPT1JTX0xPQ0tFRF9GT1JfQUxMX1BMQVlFUlModiwgZmFsc2UpCiAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9ET09SU19MT0NLRURfRk9SX1BMQVlFUih2LCBQTEFZRVIuUExBWUVSX0lEKCksIGZhbHNlKQogICAgICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKHZlaGljbGUsIGZhbHNlKQogICAgICAgIHV0aWwueWllbGQoKQogICAgZWxzZQogICAgICAgIGlmIHZlaCB+PSAwIHRoZW4KICAgICAgICAgICAgcmVxdWVzdF9jb250cm9sKHZlaCkKICAgICAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9ET09SU19MT0NLRUQodmVoLCAxKQogICAgICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0RPT1JTX0xPQ0tFRF9GT1JfQUxMX1BMQVlFUlModmVoLCBmYWxzZSkKICAgICAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9ET09SU19MT0NLRURfRk9SX1BMQVlFUih2ZWgsIFBMQVlFUi5QTEFZRVJfSUQoKSwgZmFsc2UpCiAgICAgICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfSEFTX0JFRU5fT1dORURfQllfUExBWUVSKHZlaCwgZmFsc2UpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgotLS0t57uZ5LqI5omA5pyJ5q2m5ZmoCmZ1bmN0aW9uIGdpdmVfYWxsX3dlYXBvbihwZWQpCiAgICBmb3IgXywgd2VhcG9uIGluIHBhaXJzKHdlYXBvbl9saXN0KSBkbyAKICAgICAgICBXRUFQT04uR0lWRV9XRUFQT05fVE9fUEVEKHBlZCwgd2VhcG9uLmhhc2gsIDk5OTksIGZhbHNlLCBmYWxzZSkKICAgIGVuZAplbmQKLS0tLeenu+mZpOaJgOacieatpuWZqApmdW5jdGlvbiByZW1vdmVfYWxsX3dlYXBvbihwZWQpCiAgICBmb3IgXywgd2VhcG9uIGluIHBhaXJzKHdlYXBvbl9saXN0KSBkbyAKICAgICAgICBXRUFQT04uUkVNT1ZFX1dFQVBPTl9GUk9NX1BFRChwZWQsIHdlYXBvbi5oYXNoKQogICAgZW5kCmVuZAotLS0t6YeN5Z6L54uZ5Ye75p6q5pS75Ye7CmZ1bmN0aW9uIEhlYXZ5X2d1bl90b19wbGF5ZXIocGlkKQogICAgaWYgUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkgfj0gMCB0aGVuCiAgICAgICAgCiAgICAgICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCBmYWxzZSkKICAgICAgICBsb2NhbCBoYXNoID0gdXRpbC5qb2FhdCgid2VhcG9uX2hlYXZ5c25pcGVyIikKICAgICAgICByZXF1ZXN0X3dlYXBvbl9hc3NldChoYXNoKQogICAgICAgIFdFQVBPTi5HSVZFX1dFQVBPTl9UT19QRUQoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgaGFzaCwgMTIwLCB0cnVlLCBmYWxzZSkKICAgICAgICBNSVNDLlNIT09UX1NJTkdMRV9CVUxMRVRfQkVUV0VFTl9DT09SRFMocG9zLngsIHBvcy55LCBwb3MueiArIDUsIHBvcy54LCBwb3MueSwgcG9zLnosIDIwMCwgZmFsc2UsIGhhc2gsIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUsIGZhbHNlLCAyNTAwLjApCiAgICBlbmQKZW5kCi0tLS3ng5/oirHmlLvlh7sKZnVuY3Rpb24gZmlyZXdvcmtfdG9fcGxheWVyKHBpZCkKICAgIGlmIFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpIH49IDAgdGhlbgogICAgICAgIAogICAgICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSwgZmFsc2UpCiAgICAgICAgbG9jYWwgaGFzaCA9IHV0aWwuam9hYXQoIndlYXBvbl9maXJld29yayIpCiAgICAgICAgcmVxdWVzdF93ZWFwb25fYXNzZXQoaGFzaCkKICAgICAgICBXRUFQT04uR0lWRV9XRUFQT05fVE9fUEVEKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGhhc2gsIDEyMCwgdHJ1ZSwgZmFsc2UpCiAgICAgICAgTUlTQy5TSE9PVF9TSU5HTEVfQlVMTEVUX0JFVFdFRU5fQ09PUkRTKHBvcy54LCBwb3MueSwgcG9zLnogKyAzLjAsIHBvcy54LCBwb3MueSwgcG9zLnogLSAyLjAsIDIwMCwgZmFsc2UsIGhhc2gsIDAsIHRydWUsIGZhbHNlLCAyNTAwLjApCiAgICBlbmQKZW5kCi0tLS3ljp/lrZDms6LmlLvlh7sKZnVuY3Rpb24gYXRvbV93YXZlc190b19wbGF5ZXIocGlkKQogICAgaWYgUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkgfj0gMCB0aGVuCiAgICAgICAgCiAgICAgICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCBmYWxzZSkKICAgICAgICBsb2NhbCBoYXNoID0gdXRpbC5qb2FhdCgid2VhcG9uX3JheXBpc3RvbCIpCiAgICAgICAgcmVxdWVzdF93ZWFwb25fYXNzZXQoaGFzaCkKICAgICAgICBXRUFQT04uR0lWRV9XRUFQT05fVE9fUEVEKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGhhc2gsIDEyMCwgdHJ1ZSwgZmFsc2UpCiAgICAgICAgTUlTQy5TSE9PVF9TSU5HTEVfQlVMTEVUX0JFVFdFRU5fQ09PUkRTKHBvcy54LCBwb3MueSwgcG9zLnogKyAzLjAsIHBvcy54LCBwb3MueSwgcG9zLnogLSAyLjAsIDIwMCwgZmFsc2UsIGhhc2gsIDAsIHRydWUsIGZhbHNlLCAyNTAwLjApCiAgICBlbmQKZW5kCi0tLS3nh4Png6flvLnmlLvlh7sKZnVuY3Rpb24gSW5jZW5kaWFyeV90b19wbGF5ZXIocGlkKQogICAgaWYgUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkgfj0gMCB0aGVuCiAgICAgICAgCiAgICAgICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCBmYWxzZSkKICAgICAgICBsb2NhbCBoYXNoID0gdXRpbC5qb2FhdCgid2VhcG9uX21vbG90b3YiKQogICAgICAgIHJlcXVlc3Rfd2VhcG9uX2Fzc2V0KGhhc2gpCiAgICAgICAgV0VBUE9OLkdJVkVfV0VBUE9OX1RPX1BFRChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBoYXNoLCAxMjAsIHRydWUsIGZhbHNlKQogICAgICAgIE1JU0MuU0hPT1RfU0lOR0xFX0JVTExFVF9CRVRXRUVOX0NPT1JEUyhwb3MueCwgcG9zLnksIHBvcy56LCBwb3MueCwgcG9zLnksIHBvcy56IC0gMi4wLCAyMDAsIGZhbHNlLCBoYXNoLCAwLCB0cnVlLCBmYWxzZSwgMjUwMC4wKQogICAgZW5kCmVuZAotLS0t55S156OB6ISJ5Yay5pS75Ye7CmZ1bmN0aW9uIEVsZWN0cm9NYWduZXRpY19QdWxzZV90b19wbGF5ZXIocGlkKQogICAgaWYgUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkgfj0gMCB0aGVuCiAgICAgICAgCiAgICAgICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCBmYWxzZSkKICAgICAgICBsb2NhbCBoYXNoID0gdXRpbC5qb2FhdCgid2VhcG9uX2VtcGxhdW5jaGVyIikKICAgICAgICByZXF1ZXN0X3dlYXBvbl9hc3NldChoYXNoKQogICAgICAgIFdFQVBPTi5HSVZFX1dFQVBPTl9UT19QRUQoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgaGFzaCwgMTIwLCB0cnVlLCBmYWxzZSkKICAgICAgICBNSVNDLlNIT09UX1NJTkdMRV9CVUxMRVRfQkVUV0VFTl9DT09SRFMocG9zLngsIHBvcy55LCBwb3MueiwgcG9zLngsIHBvcy55LCBwb3MueiAtIDIuMCwgMjAwLCBmYWxzZSwgaGFzaCwgMCwgdHJ1ZSwgZmFsc2UsIDI1MDAuMCkKICAgIGVuZAplbmQKCi0tLS3ojIPlm7TliKDpmaQKZnVuY3Rpb24gU2NvcGVfZGVsZXRpb24ocGlkKQogICAgCiAgICBsb2NhbCBnbGl0Y2hfaGFzaCA9IHV0aWwuam9hYXQoInBfc3Bpbm5pbmdfYW51c19zIikKICAgIHJlcXVlc3RfbW9kZWwoZ2xpdGNoX2hhc2gpCiAgICBsb2NhbCBwbGF5ZXIgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKQogICAgbG9jYWwgcGxheWVycG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHBsYXllciwgZmFsc2UpIAogICAgaWYgUEVELklTX1BFRF9JTl9BTllfVkVISUNMRShwbGF5ZXIsIHRydWUpIHRoZW4KICAgICAgICBkZWxlcGxheWVyY2FyKHBpZCkKICAgIGVuZAogICAgbG9jYWwgc3R1cGlkX29iamVjdCA9IGVudGl0aWVzLmNyZWF0ZV9vYmplY3QoZ2xpdGNoX2hhc2gsIHBsYXllcnBvcykKICAgIEVOVElUWS5TRVRfRU5USVRZX1ZJU0lCTEUoc3R1cGlkX29iamVjdCwgZmFsc2UpCiAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKHN0dXBpZF9vYmplY3QsIHRydWUpCiAgICBFTlRJVFkuU0VUX0VOVElUWV9DT0xMSVNJT04oc3R1cGlkX29iamVjdCwgdHJ1ZSwgdHJ1ZSkKICAgIGRlbGV0ZV9lbnRpdHkoc3R1cGlkX29iamVjdCkKZW5kCgotLS0t5by56aOe546p5a62CmZ1bmN0aW9uIEJvdW5jZV9GbHlpbmdfUGxheWVyKHBpZCkKICAgIAogICAgaWYgUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkgfj0gMCB0aGVuCiAgICAgICAgbG9jYWwgcG9vcHlfYnV0dCA9IHV0aWwuam9hYXQoImFkZGVyIikKICAgICAgICBsb2NhbCBwbGF5ZXIgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKQogICAgICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhwbGF5ZXIpCiAgICAgICAgcG9zLnogPSBwb3MueiAtIDEwCiAgICAgICAgcmVxdWVzdF9tb2RlbChwb29weV9idXR0KQogICAgICAgIGxvY2FsIHZlaGljbGUgPSBlbnRpdGllcy5jcmVhdGVfdmVoaWNsZShwb29weV9idXR0LCBwb3MsIDApCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfVklTSUJMRSh2ZWhpY2xlLCBmYWxzZSkKICAgICAgICB1dGlsLnlpZWxkKDI1MCkKICAgICAgICBpZiB2ZWhpY2xlIH49IDAgdGhlbgogICAgICAgICAgICBFTlRJVFkuQVBQTFlfRk9SQ0VfVE9fRU5USVRZKHZlaGljbGUsIDEsIDAuMCwgMC4wLCAxMDAsIDAuMCwgMC4wLCAwLjAsIDAsIDEsIDEsIDEsIDAsIDEpCiAgICAgICAgICAgIHV0aWwueWllbGQoMjUwKQogICAgICAgICAgICBkZWxldGVfZW50aXR5KHZlaGljbGUpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgotLS0t54Of6Iqx5Y+R5bCE546p5a62CmZ1bmN0aW9uIGZpcmV3b3JrX3NlbmRfcGxheWVyKHBpZCkKICAgIAogICAgaWYgUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkgfj0gMCB0aGVuCiAgICAgICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCBmYWxzZSkKICAgICAgICBsb2NhbCBoYXNoID0gdXRpbC5qb2FhdCgid2VhcG9uX2ZpcmV3b3JrIikKICAgICAgICByZXF1ZXN0X3dlYXBvbl9hc3NldChoYXNoKQogICAgICAgIFdFQVBPTi5HSVZFX1dFQVBPTl9UT19QRUQoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgaGFzaCwgMTIwLCB0cnVlLCBmYWxzZSkKICAgICAgICBNSVNDLlNIT09UX1NJTkdMRV9CVUxMRVRfQkVUV0VFTl9DT09SRFMocG9zLngsIHBvcy55LCBwb3MueiArIDMuMCwgcG9zLngsIHBvcy55LCBwb3MueiAtIDIuMCwgMjAwLCBmYWxzZSwgaGFzaCwgMCwgdHJ1ZSwgZmFsc2UsIDI1MDAuMCkKCiAgICAgICAgbG9jYWwgcG9vcHlfYnV0dCA9IHV0aWwuam9hYXQoImFkZGVyIikKICAgICAgICBsb2NhbCBwbGF5ZXIgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKQogICAgICAgIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhwbGF5ZXIpCiAgICAgICAgcG9zLnogPSBwb3MueiAtIDEwCiAgICAgICAgcmVxdWVzdF9tb2RlbChwb29weV9idXR0KQogICAgICAgIGxvY2FsIHZlaGljbGUgPSBlbnRpdGllcy5jcmVhdGVfdmVoaWNsZShwb29weV9idXR0LCBwb3MsIDApCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfVklTSUJMRSh2ZWhpY2xlLCBmYWxzZSkKICAgICAgICBpZiB2ZWhpY2xlIH49IDAgdGhlbgogICAgICAgICAgICBFTlRJVFkuQVBQTFlfRk9SQ0VfVE9fRU5USVRZKHZlaGljbGUsIDEsIDAuMCwgMC4wLCAxMDAsIDAuMCwgMC4wLCAwLjAsIDAsIDEsIDEsIDEsIDAsIDEpCiAgICAgICAgICAgIHV0aWwueWllbGQoMTAwKQogICAgICAgICAgICBkZWxldGVfZW50aXR5KHZlaGljbGUpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgoKLS0tLeepuuiiremjnuacugpmdW5jdGlvbiBhaXJfc3RyaWtlX3BsYW5lKHRvZ2dsZWQpCiAgICBhaXJfc3RyaWtlX3RvZ2dsZWQgPSB0b2dnbGVkCiAgICBsb2NhbCBjb250cm9sID0gZnVuQ29uZmlnLmNvbnRyb2xzLmFpcnN0cmlrZWFpcmNyYWZ0CiAgICBpZiBhaXJfc3RyaWtlX3RvZ2dsZWQgdGhlbgogICAgICAgIG5vdGlmaWNhdGlvbigifnl+fmJvbGR+56m66KKt6aOe5py65Y+v55So5LqO6aOe5py65ZKM55u05Y2H5py6IiwgSHVkQ29sb3VyLmJsdWUpCiAgICAgICAgbG9jYWwgbXNnID0gIuaMiSB+JXN+IOS7peS9v+eUqOepuuiiremjnuacuiIKICAgICAgICB1dGlsLnNob3dfY29ybmVyX2hlbHAobXNnOmZvcm1hdCgiSU5QVVRfVkVIX0hPUk4iKSkKICAgIGVuZAogICAgd2hpbGUgYWlyX3N0cmlrZV90b2dnbGVkIGRvCiAgICAgICAgaWYgUEVELklTX1BFRF9JTl9GTFlJTkdfVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSBhbmQgUEFELklTX0NPTlRST0xfUFJFU1NFRCgyLCBjb250cm9sKSB0aGVuCiAgICAgICAgICAgIGxvY2FsIHZlaGljbGUgPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0lOKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKQogICAgICAgICAgICBsb2NhbCB2ZWhQb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFModmVoaWNsZSwgZmFsc2UpCiAgICAgICAgICAgIGxvY2FsIGNvb3JkID0gd2F5cG9pbnRfY29vcmQodmVoUG9zLngsIHZlaFBvcy55LCB2ZWhQb3MueikKCiAgICAgICAgICAgIGlmIHZlaFBvcy56IC0gY29vcmQueiA8IDEwLjAgdGhlbiAtLeWIpOaWreWcsOmdoumrmOW6pgogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBsb2NhbCBwb3MgPSBnZXRfcmFuZG9tX29mZnNldF9pbl9yYW5nZSh2ZWhQb3MsIDAuMCwgNS4wKQogICAgICAgICAgICBNSVNDLlNIT09UX1NJTkdMRV9CVUxMRVRfQkVUV0VFTl9DT09SRFMocG9zLngsIHBvcy55LCBwb3MueiAtIDMuMCxwb3MueCwgcG9zLnksIGNvb3JkLnosMjAwLHRydWUsIHV0aWwuam9hYXQoIndlYXBvbl9haXJzdHJpa2Vfcm9ja2V0IiksUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSwgZmFsc2UsIDEwMDAuMCkKICAgICAgICAgICAgdXRpbC55aWVsZCg4MDApCiAgICAgICAgZW5kCiAgICAgICAgdXRpbC55aWVsZCgpCiAgICBlbmQKZW5kCgoKLS0tLeeDn+iKseaeqgpmdW5jdGlvbiBGaXJld29ya19HdW4oKQogICAgaWYgV0VBUE9OLkdFVF9TRUxFQ1RFRF9QRURfV0VBUE9OKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpID09IDIxMzgzNDc0OTMgYW5kIG5vdCBFTlRJVFkuRE9FU19FTlRJVFlfRVhJU1QoZmlyZXdvcmspIHRoZW4KICAgICAgICBQTEFZRVIuRElTQUJMRV9QTEFZRVJfRklSSU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUpCiAgICAgICAgaWYgUEFELklTX0RJU0FCTEVEX0NPTlRST0xfUFJFU1NFRCgwLCAyNCkgdGhlbgogICAgICAgICAgICBsb2NhbCBoYXNoID0gdXRpbC5qb2FhdCgid19scl9maXJld29ya19yb2NrZXQiKQogICAgICAgICAgICByZXF1ZXN0X21vZGVsKGhhc2gpCiAgICAgICAgICAgIGxvY2FsIHBsYXllcl9wb3MgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMC4wLCAwLjUsIDAuNSkKICAgICAgICAgICAgbG9jYWwgZGlyID0ge30KICAgICAgICAgICAgbG9jYWwgYzIgPSBnZXRfb2Zmc2V0X2Zyb21fY2FtZXJhKDE1KQogICAgICAgICAgICBkaXIueCA9IChjMi54IC0gcGxheWVyX3Bvcy54KSAqIDE1CiAgICAgICAgICAgIGRpci55ID0gKGMyLnkgLSBwbGF5ZXJfcG9zLnkpICogMTUKICAgICAgICAgICAgZGlyLnogPSAoYzIueiAtIHBsYXllcl9wb3MueikgKiAxNQoKICAgICAgICAgICAgZmlyZXdvcmsgPSBPQkpFQ1QuQ1JFQVRFX09CSkVDVF9OT19PRkZTRVQoaGFzaCwgcGxheWVyX3Bvcy54LCBwbGF5ZXJfcG9zLnksIHBsYXllcl9wb3MueiwgdHJ1ZSwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICBsb2NhbCBjYW1fcm90ID0gQ0FNLkdFVF9HQU1FUExBWV9DQU1fUk9UKDApCiAgICAgICAgICAgIEVOVElUWS5BUFBMWV9GT1JDRV9UT19FTlRJVFlfQ0VOVEVSX09GX01BU1MoZmlyZXdvcmssIDEsIGRpci54LCBkaXIueSwgZGlyLnosIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9ST1RBVElPTihmaXJld29yaywgY2FtX3JvdC54LCBjYW1fcm90LnksIGNhbV9yb3QueiwgMCwgdHJ1ZSkKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSEFTX0dSQVZJVFkoZmlyZXdvcmssIGZhbHNlKQoKICAgICAgICAgICAgcmVxdWVzdF9wdGZ4X2Fzc2V0KCJzY3JfcmNwYXBhcmF6em8xIikKICAgICAgICAgICAgR1JBUEhJQ1MuVVNFX1BBUlRJQ0xFX0ZYX0FTU0VUKCJzY3JfcmNwYXBhcmF6em8xIikKICAgICAgICAgICAgbG9jYWwgZWZmZWN0ID0gR1JBUEhJQ1MuU1RBUlRfTkVUV09SS0VEX1BBUlRJQ0xFX0ZYX0xPT1BFRF9PTl9FTlRJVFkoInNjcl9taWNoNF9maXJld29ya190cmFpbF9zcGF3biIsIGZpcmV3b3JrLCAwLjAsIDAuMCwgMC4wLCAwLjAsIDAuMCwgMC4wLCAxLjAsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDAsIDAsIDAsIDApCiAgICAgICAgICAgIEdSQVBISUNTLlNFVF9QQVJUSUNMRV9GWF9MT09QRURfQ09MT1VSKGVmZmVjdCwgMjU1LCAyNTUsIDI1NSwgMCkKICAgICAgICAgICAgbG9jYWwgdGltZXIgPSAxNTAKICAgICAgICAgICAgd2hpbGUgbm90IEVOVElUWS5IQVNfRU5USVRZX0NPTExJREVEX1dJVEhfQU5ZVEhJTkcoZmlyZXdvcmspIGFuZCB0aW1lciA+IDAgZG8KICAgICAgICAgICAgICAgIGlmIFdFQVBPTi5HRVRfU0VMRUNURURfUEVEX1dFQVBPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSA9PSAyMTM4MzQ3NDkzIHRoZW4KICAgICAgICAgICAgICAgICAgICBQTEFZRVIuRElTQUJMRV9QTEFZRVJfRklSSU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIHRpbWVyID0gdGltZXIgLSAxCiAgICAgICAgICAgICAgICB1dGlsLnlpZWxkKCkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIHRpbWVyIDw9IDAgb3IgRU5USVRZLkhBU19FTlRJVFlfQ09MTElERURfV0lUSF9BTllUSElORyhmaXJld29yaykgdGhlbgogICAgICAgICAgICAgICAgR1JBUEhJQ1MuU1RPUF9QQVJUSUNMRV9GWF9MT09QRUQoZWZmZWN0LCBmYWxzZSkKICAgICAgICAgICAgICAgIGxvY2FsIGZpcmV3b3JrUG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKGZpcmV3b3JrLCB0cnVlKQogICAgICAgICAgICAgICAgZGVsZXRlX2VudGl0eShmaXJld29yaykKICAgICAgICAgICAgICAgIGZvciBpID0gMSwgMTAgZG8KICAgICAgICAgICAgICAgICAgICBsb2NhbCBtb2RlbCA9IHV0aWwuam9hYXQoImFkZGVyIikKICAgICAgICAgICAgICAgICAgICByZXF1ZXN0X21vZGVsKG1vZGVsKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIHZlaGljbGUgPSBlbnRpdGllcy5jcmVhdGVfdmVoaWNsZShtb2RlbCwgZmlyZXdvcmtQb3MsIDApCiAgICAgICAgICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09MTElTSU9OKHZlaGljbGUsIGZhbHNlLCB0cnVlKQogICAgICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKHZlaGljbGUsIG1hdGgucmFuZG9tKC0xODAuMCwgMTgwLjApLCBtYXRoLnJhbmRvbSgtMTgwLjAsIDE4MC4wKSwgbWF0aC5yYW5kb20oLTE4MC4wLCAxODAuMCksIDAsIHRydWUpCiAgICAgICAgICAgICAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9GT1JXQVJEX1NQRUVEKHZlaGljbGUsIDI1KQogICAgICAgICAgICAgICAgICAgIHV0aWwueWllbGQoMjUwKQogICAgICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPTExJU0lPTih2ZWhpY2xlLCB0cnVlLCB0cnVlKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZAoKLS0tLeerr+eykuaeqgpmdW5jdGlvbiBUZWxvbWVyZV9ndW4oKQogICAgZHJhd19zdHJpbmcoIn5ifuW3suWHhuWkh+Wwsee7qiIsIDAuMDIsIDAuMDUsIDAuNCwgMSkKICAgIGlmIFBFRC5JU19QRURfU0hPT1RJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgdGhlbgogICAgICAgIGxvY2FsIGhhc2ggPSB1dGlsLmpvYWF0KCJ3X2xyX2ZpcmV3b3JrX3JvY2tldCIpCiAgICAgICAgbG9jYWwgcGxheWVyX3BvcyA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwLjAsIDAuNSwgMC41KQogICAgICAgIGxvY2FsIGRpciA9IHt9CiAgICAgICAgbG9jYWwgYzIgPSBnZXRfb2Zmc2V0X2Zyb21fY2FtZXJhKDE1KQogICAgICAgIGRpci54ID0gKGMyLnggLSBwbGF5ZXJfcG9zLngpICogMTUKICAgICAgICBkaXIueSA9IChjMi55IC0gcGxheWVyX3Bvcy55KSAqIDE1CiAgICAgICAgZGlyLnogPSAoYzIueiAtIHBsYXllcl9wb3MueikgKiAxNQoKICAgICAgICBpZiBFTlRJVFkuRE9FU19FTlRJVFlfRVhJU1QocGFydGljbGVfZ3VuX2J1bGxldCkgdGhlbgogICAgICAgICAgICBkZWxldGVfZW50aXR5KHBhcnRpY2xlX2d1bl9idWxsZXQpCiAgICAgICAgZW5kCiAgICAgICAgcGFydGljbGVfZ3VuX2J1bGxldCA9IGNyZWF0ZV9vYmplY3QoaGFzaCwgcGxheWVyX3Bvcy54LCBwbGF5ZXJfcG9zLnksIHBsYXllcl9wb3MueikKICAgICAgICBzZXRfZW50aXR5X2Z1bGxfdmlzaWJsZShwYXJ0aWNsZV9ndW5fYnVsbGV0LGZhbHNlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0lOVklOQ0lCTEUocGFydGljbGVfZ3VuX2J1bGxldCx0cnVlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPTExJU0lPTihwYXJ0aWNsZV9ndW5fYnVsbGV0LCBmYWxzZSwgdHJ1ZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9IQVNfR1JBVklUWShwYXJ0aWNsZV9ndW5fYnVsbGV0LCBmYWxzZSkKCiAgICAgICAgbG9jYWwgY2FtX3JvdCA9IENBTS5HRVRfR0FNRVBMQVlfQ0FNX1JPVCgwKQogICAgICAgIEVOVElUWS5BUFBMWV9GT1JDRV9UT19FTlRJVFlfQ0VOVEVSX09GX01BU1MocGFydGljbGVfZ3VuX2J1bGxldCwgMSwgZGlyLngsIGRpci55LCBkaXIueiwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04ocGFydGljbGVfZ3VuX2J1bGxldCwgY2FtX3JvdC54LCBjYW1fcm90LnksIGNhbV9yb3QueiwgMCwgdHJ1ZSkKCiAgICAgICAgdXRpbC55aWVsZCgyMDApCiAgICAgICAgbG9jYWwgZW5kX3RpbWUgPSBvcy50aW1lKCkgKyA0CiAgICAgICAgd2hpbGUgZW5kX3RpbWUgPj0gb3MudGltZSgpIGRvCiAgICAgICAgICAgIGRyYXdfc3RyaW5nKCJ+cn7lhYXog73kuK0uLi4iLCAwLjAyLCAwLjA1LCAwLjQsIDEpCiAgICAgICAgICAgIFBMQVlFUi5ESVNBQkxFX1BMQVlFUl9GSVJJTkcoUExBWUVSLlBMQVlFUl9JRCgpLCB0cnVlKQogICAgICAgICAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMocGFydGljbGVfZ3VuX2J1bGxldCwgZmFsc2UpCiAgICAgICAgICAgIEZJUkUuQUREX0VYUExPU0lPTihwb3MueCwgcG9zLnksIHBvcy56LCA1LCAxLCB0cnVlLCBmYWxzZSwgMCwgZmFsc2UpCiAgICAgICAgICAgIHV0aWwueWllbGQoKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKLS0tLeaKk+mSqeaeqgpmdW5jdGlvbiBncmFwcGxpbmdfZ3VuKCkKICAgIGlmIFBFRC5JU19QRURfU0hPT1RJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgYW5kIFBFRC5HRVRfVkVISUNMRV9QRURfSVNfSU4oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpIHRoZW4KICAgICAgICBsb2NhbCByYXljYXN0X2Nvb3JkID0gcmF5Y2FzdF9nYW1lcGxheV9jYW0oLTEsIDEwMDAwLjApCiAgICAgICAgaWYgcmF5Y2FzdF9jb29yZFsxXSA9PSAxIHRoZW4KICAgICAgICAgICAgbG9jYWwgbGFzdGRpc3QgPSBuaWwKICAgICAgICAgICAgVEFTSy5UQVNLX1NLWV9ESVZFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICAgICAgICAgIHdoaWxlIHRydWUgZG8KICAgICAgICAgICAgICAgIGlmIFBBRC5JU19DT05UUk9MX0pVU1RfUFJFU1NFRCg0NSwgNDUpIHRoZW4gCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgcmF5Y2FzdF9jb29yZFs0XSB+PSAwIGFuZCBFTlRJVFkuR0VUX0VOVElUWV9UWVBFKHJheWNhc3RfY29vcmRbNF0pID49IDEgYW5kIEVOVElUWS5HRVRfRU5USVRZX1RZUEUocmF5Y2FzdF9jb29yZFs0XSkgPCAzIHRoZW4KICAgICAgICAgICAgICAgICAgICBnZ2MxID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHJheWNhc3RfY29vcmRbNF0sIHRydWUpCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgZ2djMSA9IHJheWNhc3RfY29vcmRbMl0KICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgbG9jYWwgYzIgPSBwbGF5ZXJzLmdldF9wb3NpdGlvbihQTEFZRVIuUExBWUVSX0lEKCkpCiAgICAgICAgICAgICAgICBsb2NhbCBkaXN0ID0gR2V0X2Rpc3RhbmNlKGdnYzEsIGMyLCB0cnVlKQogICAgICAgICAgICAgICAgLS0gc2FmZXR5CiAgICAgICAgICAgICAgICBpZiBub3QgbGFzdGRpc3Qgb3IgZGlzdCA8IGxhc3RkaXN0IHRoZW4gCiAgICAgICAgICAgICAgICAgICAgbGFzdGRpc3QgPSBkaXN0CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgRU5USVRZLklTX0VOVElUWV9ERUFEKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpIHRoZW4KICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBpZiBkaXN0ID49IDEwIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBkaXIgPSB7fQogICAgICAgICAgICAgICAgICAgIGRpclsneCddID0gKGdnYzFbJ3gnXSAtIGMyWyd4J10pICogZGlzdAogICAgICAgICAgICAgICAgICAgIGRpclsneSddID0gKGdnYzFbJ3knXSAtIGMyWyd5J10pICogZGlzdAogICAgICAgICAgICAgICAgICAgIGRpclsneiddID0gKGdnYzFbJ3onXSAtIGMyWyd6J10pICogZGlzdAogICAgICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1ZFTE9DSVRZKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGRpclsneCddLCBkaXJbJ3knXSwgZGlyWyd6J10pCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIHV0aWwueWllbGQoKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQKCi0tLS3ljZXkurrlvLrliLblkK/liqgKZnVuY3Rpb24gYWxsb3dfcGxheV9hbG9uZSgpCiAgICBpZiBJU19TQ1JJUFRfUlVOTklORygiZm1tY19sYXVuY2hlciIpIHRoZW4KICAgICAgICBpZiBHRVRfSU5UX0xPQ0FMKCJmbW1jX2xhdW5jaGVyIiwgMTk3MDkgKyAzNCkgfj0gMCB0aGVuCiAgICAgICAgICAgIGlmIEdFVF9JTlRfTE9DQUwoImZtbWNfbGF1bmNoZXIiLCAxOTcwOSArIDE1KSA+IDEgdGhlbgogICAgICAgICAgICAgICAgU0VUX0lOVF9MT0NBTCgiZm1tY19sYXVuY2hlciIsIDE5NzA5ICsgMTUsIDEpCiAgICAgICAgICAgICAgICBTRVRfSU5UX0dMT0JBTCg3OTQ3NDQgKyA0ICsgMSArIChHRVRfSU5UX0xPQ0FMKCJmbW1jX2xhdW5jaGVyIiwgMTk3MDkgKyAzNCkgKiA4OSkgKyA2OSwgMSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBTRVRfSU5UX0dMT0JBTCg0NzE4NTkyICsgMzUyNiwgMSkKICAgICAgICAgICAgU0VUX0lOVF9HTE9CQUwoNDcxODU5MiArIDM1MjcsIDEpCiAgICAgICAgICAgIFNFVF9JTlRfR0xPQkFMKDQ3MTg1OTIgKyAzNTI5ICsgMSwgMSkKICAgICAgICAgICAgU0VUX0lOVF9HTE9CQUwoNDcxODU5MiArIDE3ODgyMSArIDEsIDApCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgotLS0t57uY5Yi26L+e57q/CmZ1bmN0aW9uIGRyYXdfbGluZV9lbnRpdHlfdG9fZW50aXR5KGVudDEsIGVudDIsIGNvbG9yKQogICAgY29sb3IgPSBjb2xvciBvciB7ciA9IDAsIGcgPSAwICwgYiA9IDI1NSwgYSA9IDI1NX0KICAgIGxvY2FsIHBvczEgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoZW50MSwgdHJ1ZSkKICAgIGxvY2FsIHBvczIgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoZW50MiwgdHJ1ZSkKICAgIEdSQVBISUNTLkRSQVdfTElORShwb3MxLngsIHBvczEueSwgcG9zMS56LCBwb3MyLngsIHBvczIueSwgcG9zMi56LCBjb2xvci5yLCBjb2xvci5nLCBjb2xvci5iLCBjb2xvci5hKQplbmQKCi0tLS3otKfov5Dnm7TljYfmnLoKZnVuY3Rpb24gc3Bhd25fY2FyZ29ib2Jfd2l0aF9tYWduZXQoKQogICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUpCiAgICBsb2NhbCBoZWFkaW5nID0gRU5USVRZLkdFVF9FTlRJVFlfSEVBRElORyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgbG9jYWwgY2FyZ29ib2IgPSBjcmVhdGVfdmVoaWNsZSh1dGlsLmpvYWF0KCJjYXJnb2JvYiIpLCBwb3MueCwgcG9zLnksIHBvcy56ICsgNSwgaGVhZGluZykKICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfT05fR1JPVU5EX1BST1BFUkxZKGNhcmdvYm9iLCAxLjApCiAgICBWRUhJQ0xFLlNFVF9IRUxJX0JMQURFU19GVUxMX1NQRUVEKGNhcmdvYm9iKQogICAgVkVISUNMRS5DUkVBVEVfUElDS19VUF9ST1BFX0ZPUl9DQVJHT0JPQihjYXJnb2JvYiwgMSkKICAgIFBFRC5TRVRfUEVEX0lOVE9fVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBjYXJnb2JvYiwgLTEpCmVuZAotLS0t6L+Q5YW155u05Y2H5py6CmZ1bmN0aW9uIHNwYXduX2NhcmdvYm9iKCkKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlKQogICAgbG9jYWwgaGVhZGluZyA9IEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgIGxvY2FsIGNhcmdvYm9iID0gY3JlYXRlX3ZlaGljbGUodXRpbC5qb2FhdCgiY2FyZ29ib2IiKSwgcG9zLngsIHBvcy55LCBwb3MueiArIDUsIGhlYWRpbmcpCiAgICBWRUhJQ0xFLlNFVF9IRUxJX0JMQURFU19GVUxMX1NQRUVEKGNhcmdvYm9iKQogICAgUEVELlNFVF9QRURfSU5UT19WRUhJQ0xFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGNhcmdvYm9iLCAtMSkKICAgIGlmIG5vdCBWRUhJQ0xFLkRPRVNfQ0FSR09CT0JfSEFWRV9QSUNLX1VQX1JPUEUoY2FyZ29ib2IpIHRoZW4KICAgICAgICBWRUhJQ0xFLkNSRUFURV9QSUNLX1VQX1JPUEVfRk9SX0NBUkdPQk9CKGNhcmdvYm9iLCAwKSAtLeWIm+W7uuaLvuWPlue7swogICAgZW5kCgogICAgbG9jYWwgcmFkaXVzID0gMTUuMAogICAgd2hpbGUgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKGNhcmdvYm9iKSBkbwogICAgICAgIGxvY2FsIGNhcmdvYm9iUG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKGNhcmdvYm9iLCB0cnVlKQogICAgICAgIGxvY2FsIHZlaGljbGUgPSBWRUhJQ0xFLkdFVF9DTE9TRVNUX1ZFSElDTEUoY2FyZ29ib2JQb3MueCwgY2FyZ29ib2JQb3MueSwgY2FyZ29ib2JQb3MueiwgcmFkaXVzLCAwLCA3MCkgLS3lj6rojrflj5bpmYblnLDovb3lhbcKICAgICAgICBpZiBFTlRJVFkuRE9FU19FTlRJVFlfRVhJU1QodmVoaWNsZSkgdGhlbgogICAgICAgICAgICAtLee7mOWItui/nue6vwogICAgICAgICAgICBkcmF3X2xpbmVfZW50aXR5X3RvX2VudGl0eShjYXJnb2JvYiwgVkVISUNMRS5HRVRfQ0xPU0VTVF9WRUhJQ0xFKGNhcmdvYm9iUG9zLngsIGNhcmdvYm9iUG9zLnksIGNhcmdvYm9iUG9zLnosIHJhZGl1cywgMCwgNzApKQogICAgICAgICAgICAtLeWIhuemu+mZhOWKoAogICAgICAgICAgICBpZiBQQUQuSVNfQ09OVFJPTF9KVVNUX1JFTEVBU0VEKDAsIDEwNCkgdGhlbiAtLUgKICAgICAgICAgICAgICAgIHJlcXVlc3RfY29udHJvbCh2ZWhpY2xlKQogICAgICAgICAgICAgICAgaWYgbm90IFZFSElDTEUuSVNfVkVISUNMRV9BVFRBQ0hFRF9UT19DQVJHT0JPQihjYXJnb2JvYiwgdmVoaWNsZSkgdGhlbgogICAgICAgICAgICAgICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfT05fR1JPVU5EX1BST1BFUkxZKHZlaGljbGUsIDUuMCkgLS3lubPmlL7ovb3lhbcKICAgICAgICAgICAgICAgICAgICBFTlRJVFkuU0VUX1BJQ0tfVVBfQllfQ0FSR09CT0JfRElTQUJMRUQodmVoaWNsZSwgZmFsc2UpICAtLeemgeeUqOi9veWFt+iiq+mSqQogICAgICAgICAgICAgICAgICAgIFZFSElDTEUuQVRUQUNIX1ZFSElDTEVfVE9fQ0FSR09CT0IoY2FyZ29ib2IsIHZlaGljbGUsIC0xICwgMC4wLCAwLjAsIC0xLjApCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICAgICAgdXRpbC55aWVsZCgpCiAgICBlbmQKZW5kCi0tLS3lkIrmjILnm7TljYfmnLoKZnVuY3Rpb24gc3Bhd25fc2t5bGlmdCgpCiAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSkKICAgIGxvY2FsIGhlYWRpbmcgPSBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICBsb2NhbCBza3lsaWZ0ID0gY3JlYXRlX3ZlaGljbGUodXRpbC5qb2FhdCgic2t5bGlmdCIpLCBwb3MueCwgcG9zLnksIHBvcy56ICsgNSwgaGVhZGluZykKICAgIFZFSElDTEUuU0VUX0hFTElfQkxBREVTX0ZVTExfU1BFRUQoc2t5bGlmdCkKICAgIFBFRC5TRVRfUEVEX0lOVE9fVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBza3lsaWZ0LCAtMSkKICAgIGxvY2FsIHJhZGl1cyA9IDE1LjAKICAgIHdoaWxlIEVOVElUWS5ET0VTX0VOVElUWV9FWElTVChza3lsaWZ0KSBkbwogICAgICAgIGxvY2FsIHNreWxpZnRQb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoc2t5bGlmdCwgdHJ1ZSkKICAgICAgICBsb2NhbCB2ZWhpY2xlID0gVkVISUNMRS5HRVRfQ0xPU0VTVF9WRUhJQ0xFKHNreWxpZnRQb3MueCwgc2t5bGlmdFBvcy55LCBza3lsaWZ0UG9zLnosIHJhZGl1cywgMCwgNzApIC0t5Y+q6I635Y+W6ZmG5Zyw6L295YW3CiAgICAgICAgaWYgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKHZlaGljbGUpIHRoZW4KICAgICAgICAgICAgLS3nu5jliLbov57nur8KICAgICAgICAgICAgZHJhd19saW5lX2VudGl0eV90b19lbnRpdHkoc2t5bGlmdCwgdmVoaWNsZSwge3IgPSAwLCBnID0gMCAsIGIgPSAyNTUsIGEgPSAyNTV9KQogICAgICAgICAgICAtLeWIhuemu+mZhOWKoAogICAgICAgICAgICBpZiBQQUQuSVNfRElTQUJMRURfQ09OVFJPTF9KVVNUX1BSRVNTRUQoMCwgNDYpIHRoZW4KICAgICAgICAgICAgICAgIHJlcXVlc3RfY29udHJvbCh2ZWhpY2xlKQogICAgICAgICAgICAgICAgaWYgRU5USVRZLklTX0VOVElUWV9BVFRBQ0hFRF9UT19FTlRJVFkodmVoaWNsZSwgc2t5bGlmdCkgdGhlbgogICAgICAgICAgICAgICAgICAgIEVOVElUWS5ERVRBQ0hfRU5USVRZKHZlaGljbGUsIHRydWUsIHRydWUpCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKHZlaGljbGUsIHNreWxpZnQsIDAsIDAuMCwgLTMuNSwgLTIuMCwgMC4wLCAwLjAsIDAuMCwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgZmFsc2UsIDAsIHRydWUsIDApIAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIHV0aWwueWllbGQoKQogICAgZW5kCmVuZAoKLS0tLeelnumjjuaVouatu+mYnwpmdW5jdGlvbiBrYW1pa2F6ZV9kYXJlKGluZGV4LCBwaWQpCiAgICAKICAgIGxvY2FsIHZlaGljbGVzID0geyJMYXplciIsICJNYW1tYXR1cyIsICAiQ3ViYW44MDAifQogICAgbG9jYWwgcGxhbmUgPSB2ZWhpY2xlc1tpbmRleF0KICAgIGxvY2FsIGhhc2ggID0gdXRpbC5qb2FhdChwbGFuZSkKICAgIHJlcXVlc3RfbW9kZWwoaGFzaCkKICAgIGxvY2FsIHRhcmdldFBlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICBsb2NhbCBwb3MgPSBnZXRfcmFuZG9tX29mZnNldF9mcm9tX2VudGl0eSh0YXJnZXRQZWQsIDIwLjAsIDIwLjApCiAgICBwb3MueiA9IHBvcy56ICsgMzAuMAogICAgbG9jYWwgcGxhbmVkID0gZW50aXRpZXMuY3JlYXRlX3ZlaGljbGUoaGFzaCwgcG9zLCAwLjApCiAgICBzZXRfZW50aXR5X2ZhY2VfZW50aXR5KHBsYW5lZCwgdGFyZ2V0UGVkLCB0cnVlKQogICAgVkVISUNMRS5TRVRfVkVISUNMRV9GT1JXQVJEX1NQRUVEKHBsYW5lZCwgMTUwLjApCiAgICBWRUhJQ0xFLkNPTlRST0xfTEFORElOR19HRUFSKHBsYW5lZCwgMykKICAgIHV0aWwueWllbGQoMTAwMCkKICAgIGRlbGV0ZV9lbnRpdHkocGxhbmVkKQplbmQKLS0tLeaSnuWHu+eOqeWutgpmdW5jdGlvbiBJbXBhY3RfcGxheWVyKGluZGV4LCBwaWQpCiAgICAKICAgIGxvY2FsIHZlaGljbGVzID0geyJpbnN1cmdlbnQyIiwgInBoYW50b20yIiwgImFkZGVyIn0KICAgIGxvY2FsIHZlaGljbGVOYW1lID0gdmVoaWNsZXNbaW5kZXhdCiAgICBsb2NhbCB2ZWhpY2xlSGFzaCA9IHV0aWwuam9hYXQodmVoaWNsZU5hbWUpCiAgICByZXF1ZXN0X21vZGVsKHZlaGljbGVIYXNoKQogICAgbG9jYWwgdGFyZ2V0UGVkID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgIGxvY2FsIGNvb3JkID0gZ2V0X3JhbmRvbV9vZmZzZXRfZnJvbV9lbnRpdHkodGFyZ2V0UGVkLCAxMi4wLCAxMi4wKQogICAgbG9jYWwgdmVoaWNsZSA9IGVudGl0aWVzLmNyZWF0ZV92ZWhpY2xlKHZlaGljbGVIYXNoLCBjb29yZCwgMC4wKQogICAgc2V0X2VudGl0eV9mYWNlX2VudGl0eSh2ZWhpY2xlLCB0YXJnZXRQZWQsIGZhbHNlKQogICAgVkVISUNMRS5TRVRfVkVISUNMRV9ET09SU19MT0NLRUQodmVoaWNsZSwgMikKICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRk9SV0FSRF9TUEVFRCh2ZWhpY2xlLCAxMDAuMCkKICAgIHV0aWwueWllbGQoMTAwMCkKICAgIGRlbGV0ZV9lbnRpdHkodmVoaWNsZSkKZW5kCgotLS0t6buR5rSeCmxvY2FsIGJsYWNrSG9sZVR5cGUgPSAxCmxvY2FsIGJsYWNrSG9sZVBvcyA9IHt4ID0gMCwgeSA9IDAsIHogPSAwfQpsb2NhbCBwdXNoU3RyZW5ndGggPSAxCmxvY2FsIHB1c2hUb1ggPSAxCmxvY2FsIHB1c2hUb1kgPSAxCmxvY2FsIHB1c2hUb1ogPSAxCmZ1bmN0aW9uIGJsYWNrX2hvbGVfdHlwZShhKQogICAgYmxhY2tIb2xlVHlwZSA9IGEKZW5kCmZ1bmN0aW9uIGJsYWNrX2hvbGVfU3RoKGEpCiAgICBwdXNoU3RyZW5ndGggPSBhCmVuZApmdW5jdGlvbiBibGFja19ob2xlX3Bvc3VzZXIoKQogICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRChQTEFZRVIuUExBWUVSX0lEKCkpKQogICAgbWVudS5zZXRfdmFsdWUoYmxhY2tIb2xlUG9zWCwgbWF0aC5mbG9vcihwb3MueCkpLS3lkJHkuIvlj5bmlbQKICAgIG1lbnUuc2V0X3ZhbHVlKGJsYWNrSG9sZVBvc1ksIG1hdGguZmxvb3IocG9zLnkpKQogICAgbWVudS5zZXRfdmFsdWUoYmxhY2tIb2xlUG9zWiwgbWF0aC5mbG9vcihwb3MueikpCiAgICBibGFja0hvbGVQb3MueCA9IHBvcy54CiAgICBibGFja0hvbGVQb3MueSA9IHBvcy55CiAgICBibGFja0hvbGVQb3MueiA9IHBvcy56CmVuZApmdW5jdGlvbiBibGFja19ob2xlX3Bvc3goYSkKICAgIGJsYWNrSG9sZVBvcy54ID0gYQplbmQKZnVuY3Rpb24gYmxhY2tfaG9sZV9wb3N5KGEpCiAgICBibGFja0hvbGVQb3MueSA9IGEKZW5kCmZ1bmN0aW9uIGJsYWNrX2hvbGVfcG9zeihhKQogICAgYmxhY2tIb2xlUG9zLnogPSBhCmVuZApmdW5jdGlvbiBzaG93X2JhbGNraG9sZSgpCiAgICBHUkFQSElDUy5EUkFXX01BUktFUl9TUEhFUkUoYmxhY2tIb2xlUG9zLngsIGJsYWNrSG9sZVBvcy55LCBibGFja0hvbGVQb3MueiwgMSwgMCwgMCwgMCwgMC44KQplbmQKZnVuY3Rpb24gYmxhY2tfaG9sZSgpCiAgICBsb2NhbCBibGFja0hvbGVwZWRzID0gZW50aXRpZXMuZ2V0X2FsbF9wZWRzX2FzX2hhbmRsZXMoKQogICAgbG9jYWwgYmxhY2tIb2xlVmVoaWNsZSA9IGVudGl0aWVzLmdldF9hbGxfdmVoaWNsZXNfYXNfaGFuZGxlcygpCgogICAgZm9yIGksIHBlZCBpbiBpcGFpcnMoYmxhY2tIb2xlcGVkcykgZG8KICAgICAgICBpZiBwZWQgfj0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKFBMQVlFUi5QTEFZRVJfSUQoKSkgdGhlbgogICAgICAgICAgICBibGFja0hvbGVWZWhpY2xlWyNibGFja0hvbGVWZWhpY2xlKzFdID0gcGVkCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBmb3IgaW5kZXgsIHZhbHVlIGluIGlwYWlycyhibGFja0hvbGVWZWhpY2xlKSBkbwogICAgICAgIHZlaGljbGVQb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFModmFsdWUpCiAgICAgICAgaWYgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKHZhbHVlKSA9PSB0cnVlIHRoZW4KICAgICAgICAgICAgaWYgTkVUV09SSy5ORVRXT1JLX0hBU19DT05UUk9MX09GX0VOVElUWSh2YWx1ZSkgPT0gZmFsc2UgdGhlbgogICAgICAgICAgICAgICAgTkVUV09SSy5ORVRXT1JLX1JFUVVFU1RfQ09OVFJPTF9PRl9FTlRJVFkodmFsdWUpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBibGFja0hvbGVUeXBlID09IDEgdGhlbgogICAgICAgICAgICAgICAgaWYgYmxhY2tIb2xlUG9zLnggPiB2ZWhpY2xlUG9zLnggdGhlbgogICAgICAgICAgICAgICAgICAgIHB1c2hUb1ggPSBwdXNoU3RyZW5ndGgKICAgICAgICAgICAgICAgIGVsc2VpZiBibGFja0hvbGVQb3MueCA8IHZlaGljbGVQb3MueCB0aGVuCiAgICAgICAgICAgICAgICAgICAgcHVzaFRvWCA9IC1wdXNoU3RyZW5ndGgKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgYmxhY2tIb2xlUG9zLnkgPiB2ZWhpY2xlUG9zLnkgdGhlbgogICAgICAgICAgICAgICAgICAgIHB1c2hUb1kgPSBwdXNoU3RyZW5ndGgKICAgICAgICAgICAgICAgIGVsc2VpZiBibGFja0hvbGVQb3MueSA8IHZlaGljbGVQb3MueSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcHVzaFRvWSA9IC1wdXNoU3RyZW5ndGgKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgaWYgYmxhY2tIb2xlUG9zLnogPiB2ZWhpY2xlUG9zLnogdGhlbgogICAgICAgICAgICAgICAgICAgIHB1c2hUb1ogPSBwdXNoU3RyZW5ndGgKICAgICAgICAgICAgICAgIGVsc2VpZiBibGFja0hvbGVQb3MueiA8IHZlaGljbGVQb3MueiB0aGVuCiAgICAgICAgICAgICAgICAgICAgcHVzaFRvWiA9IC1wdXNoU3RyZW5ndGgKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgRU5USVRZLkFQUExZX0ZPUkNFX1RPX0VOVElUWSh2YWx1ZSwgMSwgcHVzaFRvWCwgcHVzaFRvWSwgcHVzaFRvWiwgMCwgMCwgMCwgMCwgZmFsc2UsIHRydWUsIHRydWUsIGZhbHNlKQogICAgICAgICAgICBlbHNlaWYgYmxhY2tIb2xlVHlwZSA9PSAyIHRoZW4KICAgICAgICAgICAgICAgIGlmIGJsYWNrSG9sZVBvcy54ID4gdmVoaWNsZVBvcy54IHRoZW4KICAgICAgICAgICAgICAgICAgICBwdXNoVG9YID0gLXB1c2hTdHJlbmd0aAogICAgICAgICAgICAgICAgZWxzZWlmIGJsYWNrSG9sZVBvcy54IDwgdmVoaWNsZVBvcy54IHRoZW4KICAgICAgICAgICAgICAgICAgICBwdXNoVG9YID0gcHVzaFN0cmVuZ3RoCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGlmIGJsYWNrSG9sZVBvcy55ID4gdmVoaWNsZVBvcy55IHRoZW4KICAgICAgICAgICAgICAgICAgICBwdXNoVG9ZID0gLXB1c2hTdHJlbmd0aAogICAgICAgICAgICAgICAgZWxzZWlmIGJsYWNrSG9sZVBvcy55IDwgdmVoaWNsZVBvcy55IHRoZW4KICAgICAgICAgICAgICAgICAgICBwdXNoVG9ZID0gcHVzaFN0cmVuZ3RoCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGlmIGJsYWNrSG9sZVBvcy56ID4gdmVoaWNsZVBvcy56IHRoZW4KICAgICAgICAgICAgICAgICAgICBwdXNoVG9aID0gLXB1c2hTdHJlbmd0aAogICAgICAgICAgICAgICAgZWxzZWlmIGJsYWNrSG9sZVBvcy56IDwgdmVoaWNsZVBvcy56IHRoZW4KICAgICAgICAgICAgICAgICAgICBwdXNoVG9aID0gcHVzaFN0cmVuZ3RoCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIEVOVElUWS5BUFBMWV9GT1JDRV9UT19FTlRJVFkodmFsdWUsIDEsIHB1c2hUb1gsIHB1c2hUb1ksIHB1c2hUb1osIDAsIDAsIDAsIDAsIGZhbHNlLCB0cnVlLCB0cnVlLCBmYWxzZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgotLS0t6LaF6IO96ICFCi0t6Zeq55S15L6gCmZ1bmN0aW9uIGZsYXNoX21hbigpCiAgICBFTlRJVFkuU0VUX0VOVElUWV9NQVhfU1BFRUQoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMTAwKQogICAgbG9jYWwgZGlyID0gRU5USVRZLkdFVF9FTlRJVFlfRk9SV0FSRF9WRUNUT1IoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgIGRpciA9IHYzKGRpci54ICogMTAwLCBkaXIueSAqIDEwMCwgZGlyLnogKiAxMDApCiAgICBpZiBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsIDIxKSBhbmQgUEFELklTX0NPTlRST0xfUFJFU1NFRCgwLCAzMikgdGhlbgogICAgICAgIGlmIG5vdCBFTlRJVFkuSVNfRU5USVRZX0lOX0FJUihQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSB0aGVuCiAgICAgICAgICAgIHJlcXVlc3RfcHRmeF9hc3NldCgiY29yZSIpCiAgICAgICAgICAgIEdSQVBISUNTLlNUQVJUX05FVFdPUktFRF9QQVJUSUNMRV9GWF9OT05fTE9PUEVEX09OX0VOVElUWSgnZW50X2RzdF9lbGVjX2ZpcmVfc3AnLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwLCAwLCAwLCAwLCAwLCAwLCAxKQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9WRUxPQ0lUWShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBkaXIueCAqIDgwICwgZGlyLnkgKiA4MCAsIGRpci56ICogODAgKQogICAgICAgIGVuZAogICAgZW5kCmVuZAotLeWkluaYn+S6ugpmdW5jdGlvbiBhbGllbl9tYW4oKQogICAgRU5USVRZLlNFVF9FTlRJVFlfTUFYX1NQRUVEKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDEwMCkKICAgIGxvY2FsIGRpciA9IEVOVElUWS5HRVRfRU5USVRZX0ZPUldBUkRfVkVDVE9SKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICBkaXIgPSB2MyhkaXIueCAqIDEwMCwgZGlyLnkgKiAxMDAsIGRpci56ICogMTAwKQogICAgaWYgUEFELklTX0NPTlRST0xfUFJFU1NFRCgwLCAyMSkgYW5kIFBBRC5JU19DT05UUk9MX1BSRVNTRUQoMCwgMzIpIHRoZW4KICAgICAgICBpZiBub3QgRU5USVRZLklTX0VOVElUWV9JTl9BSVIoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgdGhlbgogICAgICAgICAgICByZXF1ZXN0X3B0ZnhfYXNzZXQoInNjcl9yY2JhcnJ5MSIpCiAgICAgICAgICAgIEdSQVBISUNTLlNUQVJUX05FVFdPUktFRF9QQVJUSUNMRV9GWF9OT05fTE9PUEVEX09OX0VOVElUWSgnc2NyX2FsaWVuX3RlbGVwb3J0JywgUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMCwgMCwgMCwgMCwgMCwgMCwgMSkKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfVkVMT0NJVFkoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZGlyLnggKiA4MCAsIGRpci55ICogODAgLCBkaXIueiAqIDgwICkKICAgICAgICBlbmQKICAgIGVuZAplbmQKLS3nmb3mnIjlhYkKZnVuY3Rpb24gbW9vbmxpZ2h0X21hbigpCiAgICBFTlRJVFkuU0VUX0VOVElUWV9NQVhfU1BFRUQoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMTAwKQogICAgbG9jYWwgZGlyID0gRU5USVRZLkdFVF9FTlRJVFlfRk9SV0FSRF9WRUNUT1IoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgIGRpciA9IHYzKGRpci54ICogMTAwLCBkaXIueSAqIDEwMCwgZGlyLnogKiAxMDApCiAgICBpZiBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsIDIxKSBhbmQgUEFELklTX0NPTlRST0xfUFJFU1NFRCgwLCAzMikgdGhlbgogICAgICAgIGlmIG5vdCBFTlRJVFkuSVNfRU5USVRZX0lOX0FJUihQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSB0aGVuCiAgICAgICAgICAgIHJlcXVlc3RfcHRmeF9hc3NldCgic2NyX3JjYmFycnkyIikKICAgICAgICAgICAgR1JBUEhJQ1MuU1RBUlRfTkVUV09SS0VEX1BBUlRJQ0xFX0ZYX05PTl9MT09QRURfT05fRU5USVRZKCdzY3JfY2xvd25fZGVhdGgnLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwLCAwLCAwLCAwLCAwLCAwLCAxKQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9WRUxPQ0lUWShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBkaXIueCAqIDgwICwgZGlyLnkgKiA4MCAsIGRpci56ICogODAgKQogICAgICAgIGVuZAogICAgZW5kCmVuZAotLeWkqumYs+iKsQpmdW5jdGlvbiBzdW5mbG93ZXJfbWFuKCkKICAgIEVOVElUWS5TRVRfRU5USVRZX01BWF9TUEVFRChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAxMDApCiAgICBsb2NhbCBkaXIgPSBFTlRJVFkuR0VUX0VOVElUWV9GT1JXQVJEX1ZFQ1RPUihQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgZGlyID0gdjMoZGlyLnggKiAxMDAsIGRpci55ICogMTAwLCBkaXIueiAqIDEwMCkKICAgIGlmIFBBRC5JU19DT05UUk9MX1BSRVNTRUQoMCwgMjEpIGFuZCBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsIDMyKSB0aGVuCiAgICAgICAgaWYgbm90IEVOVElUWS5JU19FTlRJVFlfSU5fQUlSKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpIHRoZW4KICAgICAgICAgICAgcmVxdWVzdF9wdGZ4X2Fzc2V0KCJzY3JfcmNiYXJyeTIiKQogICAgICAgICAgICBHUkFQSElDUy5TVEFSVF9ORVRXT1JLRURfUEFSVElDTEVfRlhfTk9OX0xPT1BFRF9PTl9FTlRJVFkoJ3Njcl9jbG93bl9idWwnLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwLCAwLCAwLCAwLCAwLCAwLCAxKQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9WRUxPQ0lUWShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBkaXIueCAqIDgwICwgZGlyLnkgKiA4MCAsIGRpci56ICogODAgKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKCgoKLS0tLea0m+Wlh+aWr+aAquWFvW1rMgpmdW5jdGlvbiBsb2NobmVzc19tazIoKQogICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICBsb2NhbCBtb25zdGVyID0gTUlTQy5HRVRfSEFTSF9LRVkoImg0X3Byb3BfaDRfbG9jaF9tb25zdGVyIiktLeaAquWFvQogICAgbG9jYWwgb3BwcmVzc29yID0gTUlTQy5HRVRfSEFTSF9LRVkoIm9wcHJlc3NvcjIiKS0tbWsyCiAgICBsb2NhbCBvYmogPSBjcmVhdGVfb2JqZWN0KG1vbnN0ZXIsIHBvcy54LCBwb3MueSwgcG9zLnopCiAgICBsb2NhbCB2ZWggPSBjcmVhdGVfdmVoaWNsZShvcHByZXNzb3IsIHBvcy54LCBwb3MueSwgcG9zLnosIDApCiAgICBFTlRJVFkuU0VUX0VOVElUWV9IRUFESU5HKHZlaCwgRU5USVRZLkdFVF9FTlRJVFlfSEVBRElORyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSkKICAgIFBFRC5TRVRfUEVEX0lOVE9fVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB2ZWgsIC0xKQogICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKG9iaiwgdmVoLCAwLCAtMC4yNSwgLTEuMCwgMS4wLCAwLjAsIDAuMCwgLTkwLjAsIHRydWUsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDAsIHRydWUsIDApCmVuZAoKLS0tLeWcsOmbtwpmdW5jdGlvbiBzcGF3bl9taW5lKCkKICAgIGxvY2FsIGhhc2ggPSAxMjQ2MTU4OTkwCiAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoUExBWUVSLkdFVF9QTEFZRVJfUEVEKFBMQVlFUi5QTEFZRVJfSUQoKSksIDAsIDQsIDApLS3lgY/np7vph4/lnZDmoIcs5YmN5ZCOLOW3puWPsyzkuIrkuIsKICAgIGxvY2FsIGxhbmRtaW5lcyA9IGNyZWF0ZV9vYmplY3QoaGFzaCwgcG9zLngsIHBvcy55LCBwb3Muei0xKQogICAgRU5USVRZLlNFVF9FTlRJVFlfSEVBRElORyhsYW5kbWluZXMsIEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSktOTApCmVuZAoKLS0tLU5QQ+WcqOeOqeWutumdouWJjeiHquadgApmdW5jdGlvbiBkb19wZWRfc3VpY2lkZShwZWQpCiAgICByZXF1ZXN0X2NvbnRyb2wocGVkKQogICAgVEFTSy5DTEVBUl9QRURfVEFTS1NfSU1NRURJQVRFTFkocGVkKQogICAgUEVELlNFVF9CTE9DS0lOR19PRl9OT05fVEVNUE9SQVJZX0VWRU5UUyhwZWQsIHRydWUpCiAgICBXRUFQT04uR0lWRV9XRUFQT05fVE9fUEVEKHBlZCwgdXRpbC5qb2FhdCgid2VhcG9uX3Bpc3RvbCIpLCAxLCBmYWxzZSwgdHJ1ZSkKICAgIFdFQVBPTi5TRVRfQ1VSUkVOVF9QRURfV0VBUE9OKHBlZCwgdXRpbC5qb2FhdCgid2VhcG9uX3Bpc3RvbCIpLCB0cnVlKQogICAgcmVxdWVzdF9hbmltX2RpY3QoIm1wX3N1aWNpZGUiKQogICAgdXRpbC55aWVsZCgxMDAwKQogICAgbG9jYWwgc3RhcnRfdGltZSA9IG9zLnRpbWUoKQogICAgLS0gZWl0aGVyIHdhaXQgdGlsbCB0aGUgcGVkIGlzIHN0YW5kaW5nIHN0aWxsLCBvciAzIHNlY29uZHMsIHdoaWNoZXZlciBpcyBmaXJzdAogICAgd2hpbGUgRU5USVRZLkdFVF9FTlRJVFlfU1BFRUQocGVkKSA+IDEgYW5kIG9zLnRpbWUoKSAtIHN0YXJ0X3RpbWUgPCAzIGRvIAogICAgICAgIHV0aWwueWllbGQoKQogICAgZW5kCiAgICBUQVNLLlRBU0tfUExBWV9BTklNKHBlZCwgIm1wX3N1aWNpZGUiLCAicGlzdG9sIiwgOC4wLCA4LjAsIC0xLCAyLCAwLjAsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCiAgICB1dGlsLnlpZWxkKDgwMCkKICAgIEVOVElUWS5TRVRfRU5USVRZX0hFQUxUSChwZWQsIDAuMCwgMCkKICAgIHV0aWwueWllbGQoMTAwMDApCiAgICBkZWxldGVfZW50aXR5KHBlZCkKZW5kCmZ1bmN0aW9uIG5wY19zdWljaWRlKGluZGV4LHBpZCkKICAgIAogICAgbG9jYWwgcGx5ciA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICBsb2NhbCBjID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKHBseXIsIDAuMCwgMS4wLCAwLjApCiAgICBsb2NhbCBwZWQgPSAwCiAgICBpZiBpbmRleCA9PSAxIHRoZW4KICAgICAgICBwZWQgPSBQRUQuQ0xPTkVfUEVEKHBseXIsIHRydWUsIGZhbHNlLCB0cnVlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEUyhwZWQsIGMueCwgYy55LCBjLnopCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSEVBRElORyhwZWQsIEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcocGx5cikgKyAxODApCiAgICBlbHNlCiAgICAgICAgbG9jYWwgaGFzaCA9IHRyYXVtYXRpemUudmFsdWVbaW5kZXhdCiAgICAgICAgcmVxdWVzdF9tb2RlbChoYXNoKQogICAgICAgIHBlZCA9IGVudGl0aWVzLmNyZWF0ZV9wZWQoMywgaGFzaCwgYywgRU5USVRZLkdFVF9FTlRJVFlfSEVBRElORyhwbHlyKSArIDE4MCkKICAgIGVuZAogICAgZG9fcGVkX3N1aWNpZGUocGVkKQplbmQKCgotLS0t6ZmE5Yqg5a6e5L2T5p6qCmxvY2FsIHNlbGV0ZWRfYXR0YWNoX2VudCA9ICd2aWdpbGFudGUnCmZ1bmN0aW9uIGNyZWF0ZV9hdHRhY2hfZW50KGhhc2gsIHgsIHksIHosIHRhcmdldF9lbnQpCiAgICBpZiBTVFJFQU1JTkcuSVNfTU9ERUxfQV9QRUQoaGFzaCkgdGhlbgogICAgICAgIGxvY2FsIGVudCA9IGNyZWF0ZV9wZWQoMSwgaGFzaCwgeCwgeSwgeisyMCwgRU5USVRZLkdFVF9FTlRJVFlfSEVBRElORyh0YXJnZXRfZW50KSkKICAgICAgICBjYWxtX3BlZChlbnQsIHRydWUpCiAgICAgICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKGVudCwgdGFyZ2V0X2VudC0tW1sg5Li75a6e5L2TIF1dLCAwLS1bWyBib25laW5kZXggXV0sIDAsIDAsIDAsIDAsIDAsIDAsIHRydWUsIGZhbHNlLCBmYWxzZSwgdHJ1ZSwgMCwgdHJ1ZSwgMCkKICAgIGVsc2VpZiBTVFJFQU1JTkcuSVNfTU9ERUxfQV9WRUhJQ0xFKGhhc2gpIHRoZW4KICAgICAgICBsb2NhbCBlbnQgPSBjcmVhdGVfdmVoaWNsZShoYXNoLCB4LCB5LCB6KzIwLCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKHRhcmdldF9lbnQpKQogICAgICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWShlbnQsIHRhcmdldF9lbnQtLVtbIOS4u+WunuS9kyBdXSwgMC0tW1sgYm9uZWluZGV4IF1dLCAwLCAwLCAwLCAwLCAwLCAwLCB0cnVlLCBmYWxzZSwgZmFsc2UsIHRydWUsIDAsIHRydWUsIDApCiAgICBlbHNlaWYgU1RSRUFNSU5HLklTX01PREVMX1ZBTElEKGhhc2gpIHRoZW4KICAgICAgICBsb2NhbCBlbnQgPSBjcmVhdGVfb2JqZWN0KGhhc2gsIHgsIHksIHorMjApCiAgICAgICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKGVudCwgdGFyZ2V0X2VudC0tW1sg5Li75a6e5L2TIF1dLCAwLS1bWyBib25laW5kZXggXV0sIDAsIDAsIDAsIDAsIDAsIDAsIHRydWUsIGZhbHNlLCBmYWxzZSwgdHJ1ZSwgMCwgdHJ1ZSwgMCkKICAgIGVuZAplbmQKZnVuY3Rpb24gc2VsZXRlX2F0dGFjaF9lbnRpdHlfZ3VuKHZhbHVlKQogICAgc2VsZXRlZF9hdHRhY2hfZW50ID0gT2Jqbi52YWx1ZVt2YWx1ZV0KZW5kCmZ1bmN0aW9uIGF0dGFjaF9lbnRpdHlfZ3VuKCkKICAgIGxvY2FsIHBvcyA9IHYzLm5ldygpCiAgICBsb2NhbCB0YXJnZXQgPSBtZW1vcnkuYWxsb2MoOCkKICAgIGlmIFdFQVBPTi5HRVRfUEVEX0xBU1RfV0VBUE9OX0lNUEFDVF9DT09SRChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBwb3MpIHRoZW4KICAgICAgICBpZiBQTEFZRVIuR0VUX0VOVElUWV9QTEFZRVJfSVNfRlJFRV9BSU1JTkdfQVQoUExBWUVSLlBMQVlFUl9JRCgpLCB0YXJnZXQpIHRoZW4KICAgICAgICAgICAgbG9jYWwgdGFyZ2V0X2VudCA9IG1lbW9yeS5yZWFkX2ludCh0YXJnZXQpCiAgICAgICAgICAgIGlmIFNUUkVBTUlORy5JU19NT0RFTF9BX1BFRChFTlRJVFkuR0VUX0VOVElUWV9NT0RFTCh0YXJnZXRfZW50KSkgYW5kIFBFRC5JU19QRURfSU5fQU5ZX1ZFSElDTEUodGFyZ2V0X2VudCkgdGhlbgogICAgICAgICAgICAgICAgdGFyZ2V0X2VudCA9IFBFRC5HRVRfVkVISUNMRV9QRURfSVNfSU4odGFyZ2V0X2VudCwgZmFsc2UpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBsb2NhbCBoYXNoID0gTUlTQy5HRVRfSEFTSF9LRVkoc2VsZXRlZF9hdHRhY2hfZW50KQogICAgICAgICAgICBjcmVhdGVfYXR0YWNoX2VudChoYXNoLCBwb3MueCwgcG9zLnksIHBvcy56LCB0YXJnZXRfZW50KQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKLS0tLeWumueCueaJk+WHuwpmdW5jdGlvbiB0YXJnZXRlZF9zdHJpa2UoKQogICAgaWYgSFVELklTX1dBWVBPSU5UX0FDVElWRSgpIHRoZW4KICAgICAgICBsb2NhbCB3cG9zID0gSFVELkdFVF9CTElQX0lORk9fSURfQ09PUkQoSFVELkdFVF9GSVJTVF9CTElQX0lORk9fSUQoSFVELkdFVF9XQVlQT0lOVF9CTElQX0VOVU1fSUQoKSkpCiAgICAgICAgZm9yIGkgPSAxLCAzMCBkbwogICAgICAgICAgICBTRV9hZGRfb3duZWRfZXhwbG9zaW9uKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHdwb3MueCwgd3Bvcy55LCB3cG9zLnogKyAzMCAtIGksIDI5LCAxMCwgdHJ1ZSwgZmFsc2UsIDEpCiAgICAgICAgICAgIEZJUkUuQUREX0VYUExPU0lPTih3cG9zLngsIHdwb3MueSwgd3Bvcy56ICsgMzAgLSBpLCAyOSwgMTAsIHRydWUsIGZhbHNlLCAwLCBmYWxzZSkKICAgICAgICAgICAgRklSRS5BRERfRVhQTE9TSU9OKHdwb3MueCwgd3Bvcy55LCB3cG9zLnogKyAzMCAtIGksIDU5LCAxMCwgdHJ1ZSwgZmFsc2UsIDAsIGZhbHNlKQogICAgICAgICAgIHV0aWwueWllbGQoMzApCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCi0tLS3lrprngrnlvqrnjq/ovbDngrgKZnVuY3Rpb24gZXhlY3V0ZU51a2UocG9zKQogICAgZm9yIGEgPSAwLCAxMDAsIDQgZG8KICAgICAgICBGSVJFLkFERF9FWFBMT1NJT04ocG9zLngsIHBvcy55LCBwb3MueiArIGEsIDgsIDEwLjAsIHRydWUsIGZhbHNlLCAxLjAsIGZhbHNlKQogICAgICAgIHV0aWwueWllbGQoNTApCiAgICBlbmQKICAgIEZJUkUuQUREX0VYUExPU0lPTihwb3MueCwgcG9zLnksIHBvcy56LCA4MiwgMTAuMCwgdHJ1ZSwgZmFsc2UsIDEuMCwgZmFsc2UpCiAgICBGSVJFLkFERF9FWFBMT1NJT04ocG9zLngsIHBvcy55LCBwb3MueiAsIDgyLCAxMC4wLCB0cnVlLCBmYWxzZSwgMS4wLCBmYWxzZSkKICAgIEZJUkUuQUREX0VYUExPU0lPTihwb3MueCwgcG9zLnksIHBvcy56LCA4MiwgMTAuMCwgdHJ1ZSwgZmFsc2UsIDEuMCwgZmFsc2UpCiAgICBGSVJFLkFERF9FWFBMT1NJT04ocG9zLngsIHBvcy55LCBwb3MueiwgODIsIDEwLjAsIHRydWUsIGZhbHNlLCAxLjAsIGZhbHNlKQplbmQKZnVuY3Rpb24gdGFyZ2V0ZWRfbG9vcF9zdHJpa2UoKQogICAgbG9jYWwgd2F5cG9pbnRQb3MgPSBIVUQuR0VUX0JMSVBfSU5GT19JRF9DT09SRChIVUQuR0VUX0ZJUlNUX0JMSVBfSU5GT19JRChIVUQuR0VUX1dBWVBPSU5UX0JMSVBfRU5VTV9JRCgpKSkKICAgIGlmIHdheXBvaW50UG9zIHRoZW4KICAgICAgICBsb2NhbCBoYXNoID0gdXRpbC5qb2FhdCgnd19hcmVuYV9haXJtaXNzaWxlXzAxYScpCiAgICAgICAgcmVxdWVzdF9tb2RlbChoYXNoKQogICAgICAgIHdheXBvaW50UG9zLnogPSB3YXlwb2ludFBvcy56ICsgMzAKICAgICAgICBsb2NhbCBib21iID0gZW50aXRpZXMuY3JlYXRlX29iamVjdChoYXNoLCB3YXlwb2ludFBvcykKICAgICAgICB3YXlwb2ludFBvcy56ID0gd2F5cG9pbnRQb3MueiAtIDMwCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04oYm9tYiwgLTkwLCAwLCAwLCAgMiwgdHJ1ZSkKICAgICAgICBFTlRJVFkuQVBQTFlfRk9SQ0VfVE9fRU5USVRZKGJvbWIsIDAsIDAsIDAsIDAsIDAuMCwgMC4wLCAwLjAsIDAsIHRydWUsIGZhbHNlLCB0cnVlLCBmYWxzZSwgdHJ1ZSkKICAgICAgICBTVFJFQU1JTkcuU0VUX01PREVMX0FTX05PX0xPTkdFUl9ORUVERUQoaGFzaCkKICAgICAgICB3aGlsZSBub3QgRU5USVRZLkhBU19FTlRJVFlfQ09MTElERURfV0lUSF9BTllUSElORyhib21iKSBkbwogICAgICAgICAgICB1dGlsLnlpZWxkX29uY2UoKQogICAgICAgIGVuZAogICAgICAgIGRlbGV0ZV9lbnRpdHkoYm9tYikKICAgICAgICBleGVjdXRlTnVrZSh3YXlwb2ludFBvcykKICAgIGVuZAplbmQKCi0tLS3mjIfnpLrnga8KZnVuY3Rpb24gcGlsb3RfbGFtcCgpCiAgICBpZiBQRUQuSVNfUEVEX0lOX0FOWV9WRUhJQ0xFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKSB0aGVuCiAgICAgICAgZGlzcGxheV9idXR0b25zKHt7MCwgMzUsICflj7Povaznga8nfSx7MSwgMTMwLCAn5Y+M6Zeq54GvJ30sezIsIDM0LCAn5bem6L2s54GvJ319KQogICAgICAgIGxvY2FsIHZlaGljbGUgPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0lOKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKQogICAgICAgIGxvY2FsIGxlZnQgPSBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsIDM0KS0tMTc0W0FdCiAgICAgICAgbG9jYWwgcmlnaHQgPSBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsIDM1KS0tMTc1W0RdCiAgICAgICAgbG9jYWwgcmVhciA9IFBBRC5JU19DT05UUk9MX1BSRVNTRUQoMCwgMTMwKS0tMTczW1NdCiAgICAgICAgaWYgbGVmdCBhbmQgbm90IHJpZ2h0IGFuZCBub3QgcmVhciB0aGVuCiAgICAgICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfSU5ESUNBVE9SX0xJR0hUUyh2ZWhpY2xlLCAxLCB0cnVlKQogICAgICAgIGVsc2VpZiByaWdodCBhbmQgbm90IGxlZnQgYW5kIG5vdCByZWFyIHRoZW4KICAgICAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9JTkRJQ0FUT1JfTElHSFRTKHZlaGljbGUsIDAsIHRydWUpCiAgICAgICAgZWxzZWlmIHJlYXIgYW5kIG5vdCBsZWZ0IGFuZCBub3QgcmlnaHQgdGhlbgogICAgICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0lORElDQVRPUl9MSUdIVFModmVoaWNsZSwgMSwgdHJ1ZSkKICAgICAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9JTkRJQ0FUT1JfTElHSFRTKHZlaGljbGUsIDAsIHRydWUpCiAgICAgICAgZWxzZQogICAgICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0lORElDQVRPUl9MSUdIVFModmVoaWNsZSwgMCwgZmFsc2UpCiAgICAgICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfSU5ESUNBVE9SX0xJR0hUUyh2ZWhpY2xlLCAxLCBmYWxzZSkKICAgICAgICBlbmQKICAgIGVuZAplbmQKCgotLS0t6L295YW36ZmE5YqgCmZ1bmN0aW9uIHZlaGljbGVfYXR0YWNoKGluZGV4LHBpZCkKICAgIAogICAgbG9jYWwgY2FyID0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19JTihQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSwgdHJ1ZSkKICAgIGxvY2FsIHBsYXllcl9jdXJfY2FyID0gZW50aXRpZXMuZ2V0X3VzZXJfdmVoaWNsZV9hc19oYW5kbGUoKQogICAgaWYgY2FyIH49IDAgdGhlbgogICAgICAgIHJlcXVlc3RfY29udHJvbChjYXIsIDMpCiAgICAgICAgaWYgaW5kZXggPT0gMSB0aGVuCiAgICAgICAgICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBjYXIsIDAsIDAuMCwgLTAuMjAsIDIuMDAsIDEuMCwgMS4wLDEsIHRydWUsIHRydWUsIHRydWUsIGZhbHNlLCAwLCB0cnVlLCAwKQogICAgICAgIGVsc2VpZiBpbmRleCA9PSAyIHRoZW4KICAgICAgICAgICAgaWYgcGxheWVyX2N1cl9jYXIgfj0gMCBhbmQgY2FyIH49IHBsYXllcl9jdXJfY2FyIHRoZW4KICAgICAgICAgICAgICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWShjYXIsIHBsYXllcl9jdXJfY2FyLCAwLCAwLjAsIC01LjAwLCAwLjAwLCAxLjAsIDEuMCwgMSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgZmFsc2UsIDAsIHRydWUsIDApCiAgICAgICAgICAgIGVuZAogICAgICAgIGVsc2VpZiBpbmRleCA9PSAzIHRoZW4KICAgICAgICAgICAgaWYgcGxheWVyX2N1cl9jYXIgfj0gMCBhbmQgY2FyIH49IHBsYXllcl9jdXJfY2FyIHRoZW4KICAgICAgICAgICAgICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWShwbGF5ZXJfY3VyX2NhciwgY2FyLCAwLCAwLjAsIC01LjAwLCAwLjAwLCAxLjAsIDEuMCwgMSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgZmFsc2UsIDAsIHRydWUsIDApCiAgICAgICAgICAgIGVuZAogICAgICAgIGVsc2VpZiBpbmRleCA9PSA0IHRoZW4KICAgICAgICAgICAgRU5USVRZLkRFVEFDSF9FTlRJVFkoY2FyLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgICAgIGlmIHBsYXllcl9jdXJfY2FyIH49IDAgdGhlbgogICAgICAgICAgICAgICAgRU5USVRZLkRFVEFDSF9FTlRJVFkocGxheWVyX2N1cl9jYXIsIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIEVOVElUWS5ERVRBQ0hfRU5USVRZKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlLCBmYWxzZSkKICAgICAgICBlbmQKICAgIGVuZAplbmQKCi0tLS3ojrflj5bmoIforrDngrnlnZDmoIcKZnVuY3Rpb24gZ2V0X3dheXBvaW50X2Nvb3JkcygpCiAgICBsb2NhbCBjb29yZHMgPSBIVUQuR0VUX0JMSVBfSU5GT19JRF9DT09SRChIVUQuR0VUX0ZJUlNUX0JMSVBfSU5GT19JRChIVUQuR0VUX1dBWVBPSU5UX0JMSVBfRU5VTV9JRCgpKSkKICAgIGNvb3JkcyA9IHdheXBvaW50X2Nvb3JkKGNvb3Jkcy54LGNvb3Jkcy55LGNvb3Jkcy56KQogICAgcmV0dXJuIGNvb3JkcwplbmQKLS0tLeS8oOmAgeWIsOagh+iusOeCuQpmdW5jdGlvbiB0cF93YXlwb2ludCgpCiAgICBpZiBIVUQuSVNfV0FZUE9JTlRfQUNUSVZFKCkgdGhlbgogICAgICAgIGxvY2FsIHBvcyA9IGdldF93YXlwb2ludF9jb29yZHMoKQogICAgICAgIHRlbGVwb3J0KHBvcy54LCBwb3MueSwgcG9zLnosIHRydWUpCiAgICBlbmQKZW5kCgotLeiHquWKqOS8oOmAgeWIsOS7u+WKoeeCuQpmdW5jdGlvbiBhdXRvX3RwX3Rhc2tfcG9pbnRzKCkKICAgIGlmIEhVRC5ET0VTX0JMSVBfRVhJU1QoSFVELkdFVF9GSVJTVF9CTElQX0lORk9fSUQoMSkpIHRoZW4KICAgICAgICBsb2NhbCBteXBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgICAgICBsb2NhbCB3YXlwb2ludCA9IEhVRC5HRVRfQkxJUF9DT09SRFMoSFVELkdFVF9GSVJTVF9CTElQX0lORk9fSUQoMSkpCiAgICAgICAgbG9jYWwgZGlzdGFuY2UgPSBtYXRoLmNlaWwoR2V0X2Rpc3RhbmNlKHdheXBvaW50LCBteXBvcywgdHJ1ZSkpCiAgICAgICAgaWYgZGlzdGFuY2UgPiAzIHRoZW4KICAgICAgICAgICAgdGVsZXBvcnQod2F5cG9pbnQueCx3YXlwb2ludC55LHdheXBvaW50LnosIHRydWUpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgotLS0t6aqR5LmY5Yqo54mpCmZ1bmN0aW9uIHJpZGluZ19hbmltYWxzKGluZGV4KQogICAgbG9jYWwgcmFuaW1hbHMgPSB7CiAgICAgICAgWzFdID0ge2hhc2ggPSB1dGlsLmpvYWF0KCJhX2NfZGVlciIpLCBvZmYgPSB7LTAuMywgMC4wLCAwLjI1LCAwLjAsIDAuMCwgOTAuMH19LCAKICAgICAgICBbMl0gPSB7aGFzaCA9IHV0aWwuam9hYXQoImFfY19ib2FyIiksIG9mZiA9IHstMC4zLCAwLjAsIDAuMzUsIDAuMCwgMC4wLCA5MC4wfX0sIAogICAgICAgIFszXSA9IHtoYXNoID0gdXRpbC5qb2FhdCgiYV9jX2NvdyIpLCBvZmYgPSB7LTAuMywgMC4wLCAwLjE1LCAwLjAsIDAuMCwgOTAuMH19LAogICAgICAgIFs0XSA9IHtoYXNoID0gdXRpbC5qb2FhdCgiYV9jX3JhYmJpdF8wMiIpLCBvZmYgPSB7MC4xLCAtMC4zLCAwLjAsIDAsIDI3MCwgOTAuMH19CiAgICB9CiAgICBsb2NhbCBoYXNoID0gcmFuaW1hbHNbaW5kZXhdLmhhc2gKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgIGxvY2FsIGFuaW1hbCA9IGNyZWF0ZV9wZWQoOCwgaGFzaCwgcG9zLngsIHBvcy55LCBwb3MueiwgRU5USVRZLkdFVF9FTlRJVFlfSEVBRElORyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSkKICAgIEVOVElUWS5TRVRfRU5USVRZX0lOVklOQ0lCTEUoYW5pbWFsLCB0cnVlKQogICAgVEFTSy5DTEVBUl9QRURfVEFTS1NfSU1NRURJQVRFTFkoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKCiAgICBsb2NhbCBvZmYgPSByYW5pbWFsc1tpbmRleF0ub2ZmCiAgICBFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgYW5pbWFsLCBQRUQuR0VUX1BFRF9CT05FX0lOREVYKGFuaW1hbCwgMjQ4MTYpLCBvZmZbMV0sIG9mZlsyXSwgb2ZmWzNdLCBvZmZbNF0sIG9mZls1XSwgb2ZmWzZdLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCB0cnVlLCAyLCB0cnVlKQogICAgcGxheV9hbmltYXRpb24oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgInJjbWpvc2gyIiwgImpvc2hfc2l0dGluZ19sb29wIiwgOC4wLCAxLCAtMSwgMiwgMS4wKQoKICAgIHdoaWxlIEVOVElUWS5ET0VTX0VOVElUWV9FWElTVChhbmltYWwpIGRvCiAgICAgICAgLS0g56a75byACiAgICAgICAgaWYgUEFELklTX0NPTlRST0xfSlVTVF9QUkVTU0VEKDIzLCAyMykgdGhlbiAtLUYKICAgICAgICAgICAgRU5USVRZLkRFVEFDSF9FTlRJVFkoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgICAgICAgICAgZGVsZXRlX2VudGl0eShhbmltYWwpCiAgICAgICAgICAgIFRBU0suQ0xFQVJfUEVEX1RBU0tTX0lNTUVESUFURUxZKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICAgICAgZW5kCiAgICAgICAgLS0g56e75YqoCiAgICAgICAgaWYgUEFELklTX0NPTlRST0xfUFJFU1NFRCgwLCAzMikgdGhlbiAKICAgICAgICAgICAgbG9jYWwgc2lkZV9tb3ZlID0gUEFELkdFVF9DT05UUk9MX05PUk1BTCgxNDYsIDE0NikKICAgICAgICAgICAgbG9jYWwgZndkID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKGFuaW1hbCwgc2lkZV9tb3ZlKjEwLjAsIDguMCwgMC4wKQogICAgICAgICAgICBUQVNLLlRBU0tfTE9PS19BVF9DT09SRChhbmltYWwsIGZ3ZC54LCBmd2QueSwgZndkLnosIDAsIDAsIDIpCiAgICAgICAgICAgIFRBU0suVEFTS19HT19TVFJBSUdIVF9UT19DT09SRChhbmltYWwsIGZ3ZC54LCBmd2QueSwgZndkLnosIDIwLjAsIC0xLCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKGFuaW1hbCksIDAuNSkKICAgICAgICBlbmQKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAplbmQKCi0tLS3op4LnnIvnjqnlrrYKZnVuY3Rpb24gc3BlY3RhdG9yX21vZGUocGlkLCB0b2dnbGVkKQogICAgc3BlY3RhdG9yX3BsYXllciA9IHRvZ2dsZWQKICAgIHdoaWxlIHNwZWN0YXRvcl9wbGF5ZXIgYW5kIFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpIH49IDAgZG8KICAgICAgICBORVRXT1JLLk5FVFdPUktfU0VUX0lOX1NQRUNUQVRPUl9NT0RFKHRydWUsIFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpKQogICAgICAgIEhVRC5TRVRfTUlOSU1BUF9JTl9TUEVDVEFUT1JfTU9ERSh0cnVlLCBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSkKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAogICAgTkVUV09SSy5ORVRXT1JLX1NFVF9JTl9TUEVDVEFUT1JfTU9ERSh0cnVlLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgSFVELlNFVF9NSU5JTUFQX0lOX1NQRUNUQVRPUl9NT0RFKHRydWUsIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCmVuZAoKLS0tLeS4iuW4neinhuinkgpmdW5jdGlvbiBnb2RfY2FtKHRvZ2dsZWQsIHBpZCkKICAgIGdvZGNhbSA9IHRvZ2dsZWQKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSwgZmFsc2UpCiAgICBsb2NhbCBjYW1fcm90ID0gQ0FNLkdFVF9HQU1FUExBWV9DQU1fUk9UKCkKICAgIGxvY2FsIGNhbSA9IENBTS5DUkVBVEVfQ0FNX1dJVEhfUEFSQU1TKCJERUZBVUxUX1NDUklQVEVEX0NBTUVSQSIsIHBvcy54LCBwb3MueSwgcG9zLnosIGNhbV9yb3QueSAtIDkwLCBjYW1fcm90LnksIGNhbV9yb3QueiwgMjAwLCB0cnVlLCB0cnVlKQogICAgQ0FNLlNFVF9DQU1fQUNUSVZFKGNhbSwgdHJ1ZSkKICAgIENBTS5SRU5ERVJfU0NSSVBUX0NBTVModHJ1ZSwgdHJ1ZSwgMTAwMCwgdHJ1ZSwgdHJ1ZSwgMCkKICAgIE5FVFdPUksuTkVUV09SS19TRVRfSU5fU1BFQ1RBVE9SX01PREUodHJ1ZSxQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSktLeingueci+eOqeWutgogICAgd2hpbGUgZ29kY2FtIGRvCiAgICAgICAgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCBmYWxzZSkKICAgICAgICBpZiBQRUQuSVNfUEVEX0lOX0FOWV9WRUhJQ0xFKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLHRydWUpIHRoZW4KICAgICAgICAgICAgQ0FNLlNFVF9DQU1fQ09PUkQoY2FtLCBwb3MueCwgcG9zLnksIHBvcy56ICsgNzApCiAgICAgICAgZWxzZQogICAgICAgICAgICBDQU0uU0VUX0NBTV9DT09SRChjYW0sIHBvcy54LCBwb3MueSwgcG9zLnogKyAxMCkKICAgICAgICBlbmQKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAogICAgQ0FNLlNFVF9DQU1fQUNUSVZFKGNhbSwgZmFsc2UpCiAgICBDQU0uREVTVFJPWV9DQU0oY2FtLCB0cnVlKQogICAgQ0FNLlJFTkRFUl9TQ1JJUFRfQ0FNUyhmYWxzZSwgdHJ1ZSwgMTAwMCwgdHJ1ZSwgdHJ1ZSwgMCkKICAgIE5FVFdPUksuTkVUV09SS19TRVRfSU5fU1BFQ1RBVE9SX01PREUoZmFsc2UsUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkpCmVuZAoKLS0tLeWOn+WKmwpmdW5jdGlvbiBhdG9tX2ZvcmNlKHRvZ2dsZWQpCiAgICBhdG9tX2ZvcmNlX3RvZ2dsZSA9IHRvZ2dsZWQKICAgIGlmIGF0b21fZm9yY2VfdG9nZ2xlIHRoZW4KICAgICAgICBsb2NhbCBub3RpZl9mb3JtYXQgPSBzdHJpbmcuZm9ybWF0KCLmjIkgfiVzfiDlkowgfiVzfiDmnaXkvb/nlKjljp/lipsiLCAiSU5QVVRfQVRUQUNLIiwgIklOUFVUX0FJTSIpCiAgICAgICAgdXRpbC5zaG93X2Nvcm5lcl9oZWxwKG5vdGlmX2Zvcm1hdCkKICAgICAgICBsb2NhbCBlZmZlY3QgPSBFZmZlY3QubmV3KCJzY3JfaWVfdHciLCAic2NyX2ltcGV4cF90d190YWtlX3pvbmUiKQogICAgICAgIGxvY2FsIGNvbG91ciA9IHtyID0gMC41LCBnID0gMC4wLCBiID0gMC41LCBhID0gMS4wfQogICAgICAgIHJlcXVlc3RfcHRmeF9hc3NldChlZmZlY3QuYXNzZXQpCiAgICAgICAgR1JBUEhJQ1MuVVNFX1BBUlRJQ0xFX0ZYX0FTU0VUKGVmZmVjdC5hc3NldCkKICAgICAgICBHUkFQSElDUy5TRVRfUEFSVElDTEVfRlhfTk9OX0xPT1BFRF9DT0xPVVIoY29sb3VyLnIsIGNvbG91ci5nLCBjb2xvdXIuYikKICAgICAgICBHUkFQSElDUy5TVEFSVF9ORVRXT1JLRURfUEFSVElDTEVfRlhfTk9OX0xPT1BFRF9PTl9FTlRJVFkoZWZmZWN0Lm5hbWUsIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDAuMCwgMC4wLCAtMC45LDEuMCwgMS4wLDEsIDEuMCwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgIGVuZAogICAgd2hpbGUgYXRvbV9mb3JjZV90b2dnbGUgZG8KICAgICAgICBQTEFZRVIuRElTQUJMRV9QTEFZRVJfRklSSU5HKFBMQVlFUi5QTEFZRVJfSUQoKSwgdHJ1ZSkKICAgICAgICBkaXNhYmxlX2NvbnRyb2xfYWN0aW9uKDI0LCAyNSwgNjgsIDkxKQogICAgICAgIGxvY2FsIGVudGl0aWVzID0gZ2V0X3BlZF9uZWFyYnlfdmVoaWNsZXMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgICAgICBmb3IgXywgdmVoaWNsZSBpbiBpcGFpcnMoZW50aXRpZXMpIGRvCiAgICAgICAgICAgIGlmIG5vdCAoUEVELklTX1BFRF9JTl9BTllfVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkgYW5kIFBFRC5HRVRfVkVISUNMRV9QRURfSVNfSU4oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpID09IHZlaGljbGUpIHRoZW4KICAgICAgICAgICAgICAgIGlmIFBBRC5JU19ESVNBQkxFRF9DT05UUk9MX1BSRVNTRUQoMCwgMjQpIHRoZW4KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0X2NvbnRyb2wodmVoaWNsZSwgMCktLemYsuatoumVv+aXtumXtOivt+axggogICAgICAgICAgICAgICAgICAgIEVOVElUWS5BUFBMWV9GT1JDRV9UT19FTlRJVFkodmVoaWNsZSwgMSwgMC4wLCAwLjAsIDAuNSwgMS4wLCAxLjAsMSwgMCwgZmFsc2UsIGZhbHNlLCB0cnVlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgICAgICAgICBlbHNlaWYgUEFELklTX0RJU0FCTEVEX0NPTlRST0xfUFJFU1NFRCgwLCAyNSkgdGhlbgogICAgICAgICAgICAgICAgICAgIHJlcXVlc3RfY29udHJvbCh2ZWhpY2xlLCAwKS0t6Ziy5q2i6ZW/5pe26Ze06K+35rGCCiAgICAgICAgICAgICAgICAgICAgRU5USVRZLkFQUExZX0ZPUkNFX1RPX0VOVElUWSh2ZWhpY2xlLCAxLCAwLjAsIDAuMCwgLTcwLjAsMS4wLCAxLjAsMSwgMCwgZmFsc2UsIGZhbHNlLCB0cnVlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICAgICAgdXRpbC55aWVsZCgpCiAgICBlbmQKZW5kCgotLS0t5Lin5bC45qih5byPCmZ1bmN0aW9uIFpvbWJpZV9Nb2RlKHRvZ2dsZSkKICAgIHpvbWJpZV9tb2RlX3RvZ2dsZWQgPSB0b2dnbGUKICAgIC0t5b+D6LezCiAgICB1dGlsLmNyZWF0ZV90aWNrX2hhbmRsZXIoZnVuY3Rpb24oKQogICAgICAgIGlmIG5vdCB6b21iaWVfbW9kZV90b2dnbGVkIHRoZW4gcmV0dXJuIGZhbHNlIGVuZAogICAgICAgIGlmIG5vdCBQRUQuSVNfUEVEX0RFQURfT1JfRFlJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgdGhlbgogICAgICAgICAgICBsb2NhbCBoZWFsdGggPSBFTlRJVFkuR0VUX0VOVElUWV9IRUFMVEgoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgICAgICAgICAgaWYgaGVhbHRoIDwgMTgwIHRoZW4KICAgICAgICAgICAgICAgIHV0aWwueWllbGQoNDAwKQogICAgICAgICAgICAgICAgRklSRS5BRERfRVhQTE9TSU9OKDAsLTE1MDAsMTAwLCA1OCwgMC4wLCB0cnVlLCBmYWxzZSwgMC4wLCB0cnVlKQogICAgICAgICAgICAgICAgdXRpbC55aWVsZCgyMDApCiAgICAgICAgICAgICAgICBGSVJFLkFERF9FWFBMT1NJT04oMCwtMTUwMCwxMDAsIDU4LCAwLjAsIHRydWUsIGZhbHNlLCAwLjAsIHRydWUpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kKQoKICAgIHdoaWxlIHpvbWJpZV9tb2RlX3RvZ2dsZWQgZG8KICAgICAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpCiAgICAgICAgZm9yIGksIHBlZCBpbiBpcGFpcnMoZW50aXRpZXMuZ2V0X2FsbF9wZWRzX2FzX2hhbmRsZXMoKSkgZG8KICAgICAgICAgICAgaWYgcGVkIH49IFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkgYW5kIG5vdCBQRUQuSVNfUEVEX0FfUExBWUVSKHBlZCkgdGhlbgoKICAgICAgICAgICAgICAgIGNhbG1fcGVkKHBlZCwgdHJ1ZSkKICAgICAgICAgICAgICAgIFRBU0suVEFTS19DT01CQVRfUEVEKHBlZCwgUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMCwgMTYpCiAgICAgICAgICAgICAgICBUQVNLLlRBU0tfR09fVE9fQ09PUkRfQU5ZX01FQU5TKHBlZCwgcG9zLngsIHBvcy55LCBwb3MueiwgMSwgMCwgZmFsc2UsIDE1LCAwLjApCiAgICAgICAgICAgICAgICBsb2NhbCBzdHlsZSA9ICJNT1ZFX01ARFJVTktAVkVSWURSVU5LIgogICAgICAgICAgICAgICAgcmVxdWVzdF9hbmltX3NldChzdHlsZSkKICAgICAgICAgICAgICAgIFBFRC5TRVRfUEVEX01PVkVNRU5UX0NMSVBTRVQocGVkLCBzdHlsZSwgMS4wKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgdXRpbC55aWVsZCgxMCkKICAgICAgICBlbmQKICAgIAogICAgICAgIC0t5omj6KGACiAgICAgICAgZm9yIF8sIHBlZDEgaW4gaXBhaXJzKGVudGl0aWVzLmdldF9hbGxfcGVkc19hc19oYW5kbGVzKCkpIGRvCiAgICAgICAgICAgIGxvY2FsIGhlYWx0aCA9IEVOVElUWS5HRVRfRU5USVRZX0hFQUxUSChQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgICAgICBsb2NhbCBteXBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgICAgICAgICAgbG9jYWwgcGVkX3BvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhwZWQxLCBmYWxzZSkKICAgICAgICAgICAgbG9jYWwgZGlzdCA9ICBHZXRfZGlzdGFuY2UobXlwb3MsIHBlZF9wb3MsIGZhbHNlKQogICAgICAgICAgICBpZiAwIDwgZGlzdCBhbmQgZGlzdCA8IDEgYW5kIG5vdCBFTlRJVFkuSVNfRU5USVRZX0RFQUQocGVkMSwgZmFsc2UpIHRoZW4KICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0hFQUxUSChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBoZWFsdGggLSAyMCwgMCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgoKLS0tLeWFgeiuuOS4i+i5sgpmdW5jdGlvbiBhbGxvd19kdWNraW5nKHRvZ2dsZSkKICAgIGR1Y2tfdG9nZ2xlID0gdG9nZ2xlCiAgICBsb2NhbCBhbGxvd0R1Y2tpbmdBZGRyID0gbWVtb3J5LnJlYWRfbG9uZyhtZW1vcnkucmVhZF9sb25nKG1lbW9yeS5yaXAobWVtb3J5LnNjYW4oIjAxIDQ4IDhCIDA1ID8gPyA/ID8gNDggOEIgNDggMTgiKSArIDQpKSArIDB4MTgpCiAgICB3aGlsZSBkdWNrX3RvZ2dsZSBkbwogICAgICAgIG1lbW9yeS53cml0ZV9pbnQoYWxsb3dEdWNraW5nQWRkciArIDB4NERDLCAxKQogICAgICAgIGlmIFBFRC5HRVRfUEVEX1NURUFMVEhfTU9WRU1FTlQoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgdGhlbgogICAgICAgICAgICBUQVNLLlRBU0tfVE9HR0xFX0RVQ0soUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgUEVELklTX1BFRF9EVUNLSU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpIGFuZCAwIG9yIDEpCiAgICAgICAgICAgIFBFRC5TRVRfUEVEX1NURUFMVEhfTU9WRU1FTlQoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UsIDApCiAgICAgICAgZW5kCiAgICAgICAgdXRpbC55aWVsZCgpCiAgICBlbmQKICAgIFRBU0suVEFTS19UT0dHTEVfRFVDSyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwKQogICAgbWVtb3J5LndyaXRlX2ludChhbGxvd0R1Y2tpbmdBZGRyICsgMHg0REMsIDApCmVuZAoKCi0tLS3miYvlip7og4zljIUKZnVuY3Rpb24gYWRkX3Byb3BzKHRvZ2dsZWQsIHYpCiAgICBpZiB0b2dnbGVkIHRoZW4KICAgICAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgICAgICBsb2NhbCBtb2RlbCA9IE1JU0MuR0VUX0hBU0hfS0VZKHYuUHJvcCkKICAgICAgICByZXF1ZXN0X21vZGVsKG1vZGVsKQogICAgICAgIHYub2JqID0gY3JlYXRlX29iamVjdChtb2RlbCwgcG9zLngsIHBvcy55LCBwb3MueikKICAgICAgICBFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkodi5vYmosIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIFBFRC5HRVRfUEVEX0JPTkVfSU5ERVgoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMjQ4MTcpLCB2LlByb3BQbGFjZW1lbnRbMV0sIHYuUHJvcFBsYWNlbWVudFsyXSwgdi5Qcm9wUGxhY2VtZW50WzNdLCB2LlByb3BQbGFjZW1lbnRbNF0sIHYuUHJvcFBsYWNlbWVudFs1XSwgdi5Qcm9wUGxhY2VtZW50WzZdLCB0cnVlLCB0cnVlLCBmYWxzZSwgdHJ1ZSwgMSwgdHJ1ZSkKICAgIGVsc2UgCiAgICAgICAgZGVsZXRlX2VudGl0eSh2Lm9iaikKICAgIGVuZAplbmQKCgotLS0t5q275Lqh5pel5b+XCmxvY2FsIERlYXRoX0xvZyA9IGZpbGVzeXN0ZW0uc3RvcmVfZGlyKCkgLi4gJ1Nha3VyYVNjcmlwdFxcU2FrdXJhTG9nXFxEZWF0aCBMb2dcXERlYXRoX0xvZy50eHQnCmZ1bmN0aW9uIGFkZF9kZWF0aGxvZyh0aW1lLCBuYW1lLCB3ZWFwb24pCiAgICBsb2NhbCBmaWxlLCBlcnJtc2cgPSBpby5vcGVuKERlYXRoX0xvZywgImErIikKICAgIGZpbGU6d3JpdGUodGltZS4uJyAnLi5uYW1lLi4nIOexu+WeizogJy4ud2VhcG9uLi4nXG4nKQogICAgZmlsZTpjbG9zZSgpCiAgICByZXR1cm4gaW5wdXQsIHRydWUKZW5kCmZ1bmN0aW9uIGRlYXRoX2xvZygpCiAgICBpZiBFTlRJVFkuR0VUX0VOVElUWV9IRUFMVEgoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgPCAxMDAgdGhlbgogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0hFQUxUSChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBQRUQuR0VUX1BFRF9NQVhfSEVBTFRIKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpKQogICAgICAgIGxvY2FsIGtpbGxlciA9IFBFRC5HRVRfUEVEX1NPVVJDRV9PRl9ERUFUSChQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgIGxvY2FsIHRpbWUgPSBvcy5kYXRlKCclWS0lbS0lZCAlSDolTTolUycsIG9zLnRpbWUoKSkKICAgICAgICBpZiBraWxsZXIgPT0gUExBWUVSLlBMQVlFUl9QRURfSUQoKSB0aGVuCiAgICAgICAgICAgIGxvY2FsIHBuYW1lID0gUExBWUVSLkdFVF9QTEFZRVJfTkFNRShQTEFZRVIuUExBWUVSX0lEKCkpCiAgICAgICAgICAgIGFkZF9kZWF0aGxvZygiWyIuLnRpbWUuLiJdIiwgIuadpeiHqjogIi4ucG5hbWUsICfoh6rmnYAnKQogICAgICAgIGVsc2VpZiBTVFJFQU1JTkcuSVNfTU9ERUxfQV9QRUQoRU5USVRZLkdFVF9FTlRJVFlfTU9ERUwoa2lsbGVyKSkgdGhlbgogICAgICAgICAgICBpZiBQRUQuSVNfUEVEX0FfUExBWUVSKGtpbGxlcikgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgcGlkID0gTkVUV09SSy5ORVRXT1JLX0dFVF9QTEFZRVJfSU5ERVhfRlJPTV9QRUQoa2lsbGVyKQogICAgICAgICAgICAgICAgbG9jYWwgcG5hbWUgPSBQTEFZRVIuR0VUX1BMQVlFUl9OQU1FKHBpZCkKICAgICAgICAgICAgICAgIGFkZF9kZWF0aGxvZygiWyIuLnRpbWUuLiJdIiwgIuadpeiHqjogIi4ucG5hbWUsICfooqvmrablmajlh7vmnYAnKQogICAgICAgICAgICAgICAgdXRpbC50b2FzdCgn6KKrJy4ucG5hbWUuLifkvb/nlKjmrablmajlh7vmnYAnKQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBhZGRfZGVhdGhsb2coIlsiLi50aW1lLi4iXSIsICLmnaXoh6o6IE5QQyIsICfooqvmrablmajlh7vmnYAnKQogICAgICAgICAgICAgICAgdXRpbC50b2FzdCgn6KKrTlBD5Ye75p2AJykKICAgICAgICAgICAgZW5kCiAgICAgICAgZWxzZWlmIFNUUkVBTUlORy5JU19NT0RFTF9BX1ZFSElDTEUoRU5USVRZLkdFVF9FTlRJVFlfTU9ERUwoa2lsbGVyKSkgdGhlbgogICAgICAgICAgICBsb2NhbCB2ZWhvd25lciA9IGVudGl0aWVzLmdldF9vd25lcihlbnRpdGllcy5oYW5kbGVfdG9fcG9pbnRlcihraWxsZXIpKQogICAgICAgICAgICBpZiBQRUQuSVNfUEVEX0FfUExBWUVSKHZlaG93bmVyKSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBwbmFtZSA9IFBMQVlFUi5HRVRfUExBWUVSX05BTUUodmVob3duZXIpCiAgICAgICAgICAgICAgICBhZGRfZGVhdGhsb2coIlsiLi50aW1lLi4iXSIsICLmnaXoh6o6ICIuLnBuYW1lLCAn6KKr6L295YW35Ye75p2AJykKICAgICAgICAgICAgICAgIHV0aWwudG9hc3QoJ+iiqycuLnBuYW1lLi4n5L2/55So6L295YW35Ye75p2AJykKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgYWRkX2RlYXRobG9nKCJbIi4udGltZS4uIl0iLCAi5p2l6IeqOiBOUEMiLCAn6KKr6L295YW35Ye75p2AJykKICAgICAgICAgICAgICAgIHV0aWwudG9hc3QoJ+iiq05QQ+S9v+eUqOi9veWFt+WHu+adgCcpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZApmdW5jdGlvbiBvcGVuX2RlYV9sb2coKQogICAgbG9jYWwgRGVhdGhsb2dEaXIgPSBmaWxlc3lzdGVtLnN0b3JlX2RpcigpIC4uICdTYWt1cmFTY3JpcHRcXFNha3VyYUxvZ1xcRGVhdGggTG9nJwogICAgdXRpbC5vcGVuX2ZvbGRlcihEZWF0aGxvZ0RpcikKZW5kCmZ1bmN0aW9uIGNsZWFyX2RlYV9sb2coKQogICAgaW8ucmVtb3ZlKERlYXRoX0xvZykKICAgIG5vdGlmaWNhdGlvbigifnl+fmJvbGR+5riF6Zmk5a6M5oiQIiwgbWF0aC5yYW5kb20oMCwgMjAwKSkKZW5kCgoKCi0tUEVE56y85a2QCmxvY2FsIHBlZHNldF9kZWYgPSAndV9tX21famVzdXNfMDEnCmZ1bmN0aW9uIERlbGNhcih2aWMsIHNwZWMsIHBpZCkKICAgIGlmIFBFRC5JU19QRURfSU5fQU5ZX1ZFSElDTEUodmljKSA9PXRydWUgdGhlbgogICAgICAgIGxvY2FsIHRhcmNhciA9IFBFRC5HRVRfVkVISUNMRV9QRURfSVNfSU4odmljLCB0cnVlKQogICAgICAgIEdldENvbnRyb2wodGFyY2FyLCBzcGVjLCBwaWQpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQVNfTUlTU0lPTl9FTlRJVFkodGFyY2FyKQogICAgICAgIGRlbGV0ZV9lbnRpdHkodGFyY2FyKQogICAgZW5kCmVuZApmdW5jdGlvbiBTZXRQZWRDb29yKHBlZFMsIHRhcngsIHRhcnksIHRhcnopCiAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFMocGVkUywgdGFyeCwgdGFyeSwgdGFyeiwgZmFsc2UsIHRydWUsIHRydWUsIGZhbHNlKQplbmQKZnVuY3Rpb24gVGVhYmFndGltZShwMSwgcDIsIHAzLCBwNCwgcDUsIHA2LCBwNywgcDgpCiAgICB1dGlsLmNyZWF0ZV90aWNrX2hhbmRsZXIgKGZ1bmN0aW9uICgpCiAgICAgICAgQVVESU8uUExBWV9QRURfQU1CSUVOVF9TUEVFQ0hfV0lUSF9WT0lDRV9OQVRJVkUocDEsICdMRVMxQV9ESEFDJywgJ0xFU1RFUicsICdTUEVFQ0hfUEFSQU1TX0ZPUkNFX1NIT1VURUQnLCAxKQogICAgICAgIEFVRElPLlBMQVlfUEVEX0FNQklFTlRfU1BFRUNIX1dJVEhfVk9JQ0VfTkFUSVZFKHAyLCAnVFVTQ09fQUhBRCcsICdMRVNURVInLCAnU1BFRUNIX1BBUkFNU19GT1JDRV9TSE9VVEVEJywgMSkKICAgICAgICBBVURJTy5QTEFZX1BFRF9BTUJJRU5UX1NQRUVDSF9XSVRIX1ZPSUNFX05BVElWRShwMywgJ0xFUzFBX0RIQUMnLCAnTEVTVEVSJywgJ1NQRUVDSF9QQVJBTVNfRk9SQ0VfU0hPVVRFRCcsIDEpCiAgICAgICAgQVVESU8uUExBWV9QRURfQU1CSUVOVF9TUEVFQ0hfV0lUSF9WT0lDRV9OQVRJVkUocDQsICdUVVNDT19BSEFEJywgJ0xFU1RFUicsICdTUEVFQ0hfUEFSQU1TX0ZPUkNFX1NIT1VURUQnLCAxKQogICAgICAgIEFVRElPLlBMQVlfUEVEX0FNQklFTlRfU1BFRUNIX1dJVEhfVk9JQ0VfTkFUSVZFKHA1LCAnTEVTMUFfREhBQycsICdMRVNURVInLCAnU1BFRUNIX1BBUkFNU19GT1JDRV9TSE9VVEVEJywgMSkKICAgICAgICBBVURJTy5QTEFZX1BFRF9BTUJJRU5UX1NQRUVDSF9XSVRIX1ZPSUNFX05BVElWRShwNiwgJ1RVU0NPX0FIQUQnLCAnTEVTVEVSJywgJ1NQRUVDSF9QQVJBTVNfRk9SQ0VfU0hPVVRFRCcsIDEpCiAgICAgICAgQVVESU8uUExBWV9QRURfQU1CSUVOVF9TUEVFQ0hfV0lUSF9WT0lDRV9OQVRJVkUocDcsICdMRVMxQV9ESEFDJywgJ0xFU1RFUicsICdTUEVFQ0hfUEFSQU1TX0ZPUkNFX1NIT1VURUQnLCAxKQogICAgICAgIEFVRElPLlBMQVlfUEVEX0FNQklFTlRfU1BFRUNIX1dJVEhfVk9JQ0VfTkFUSVZFKHA4LCAnVFVTQ09fQUhBRCcsICdMRVNURVInLCAnU1BFRUNIX1BBUkFNU19GT1JDRV9TSE9VVEVEJywgMSkKICAgICAgICB1dGlsLnlpZWxkKDEwMCkKICAgIGVuZCkKZW5kCmZ1bmN0aW9uIEplc3VzbG92ZXN5b3UocGVkX3RhYikKICAgIHV0aWwuY3JlYXRlX3RpY2tfaGFuZGxlciAoZnVuY3Rpb24gKCkKICAgICAgICBmb3IgXywgcGkgaW4gaXBhaXJzKHBlZF90YWIpIGRvCiAgICAgICAgICAgIEFVRElPLlBMQVlfUEVEX0FNQklFTlRfU1BFRUNIX1dJVEhfVk9JQ0VfTkFUSVZFKHBpLCAnQlVNUCcsICdKRVNTRScsICdTUEVFQ0hfUEFSQU1TX0ZPUkNFJywgMSkKICAgICAgICAgICAgdXRpbC55aWVsZCgyNTApCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZApmdW5jdGlvbiBUcmV2b3J0aW1lKHBlZF90YWIpCiAgICB1dGlsLmNyZWF0ZV90aWNrX2hhbmRsZXIgKGZ1bmN0aW9uICgpCiAgICAgICAgZm9yIF8sIHBpIGluIGlwYWlycyhwZWRfdGFiKSBkbwogICAgICAgICAgICBBVURJTy5QTEFZX1BFRF9BTUJJRU5UX1NQRUVDSF9XSVRIX1ZPSUNFX05BVElWRShwaSwgJ1RSMl9BQkFKJywgJ1RSRVZPUicsICdTUEVFQ0hfUEFSQU1TX0ZPUkNFJywgMSkKICAgICAgICAgICAgdXRpbC55aWVsZCgxMDApCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZApmdW5jdGlvbiBGdWNreW91KHBlZF90YWIpCiAgICB1dGlsLmNyZWF0ZV90aWNrX2hhbmRsZXIgKGZ1bmN0aW9uICgpCiAgICAgICAgZm9yIF8sIHBpIGluIGlwYWlycyhwZWRfdGFiKSBkbwogICAgICAgICAgICBBVURJTy5QTEFZX1BFRF9BTUJJRU5UX1NQRUVDSF9OQVRJVkUocGksICdHRU5FUklDX0ZVQ0tfWU9VJywgJ1NQRUVDSF9QQVJBTVNfRk9SQ0UnLCAxKQogICAgICAgICAgICB1dGlsLnlpZWxkKDEwMCkKICAgICAgICBlbmQKICAgIGVuZCkKZW5kCmZ1bmN0aW9uIFByb3Zva2UocGVkX3RhYikKICAgIHV0aWwuY3JlYXRlX3RpY2tfaGFuZGxlciAoZnVuY3Rpb24gKCkKICAgICAgICBmb3IgXywgcGkgaW4gaXBhaXJzKHBlZF90YWIpIGRvCiAgICAgICAgICAgIEFVRElPLlBMQVlfUEVEX0FNQklFTlRfU1BFRUNIX05BVElWRShwaSwgJ1Byb3Zva2VfVHJlc3Bhc3MnLCAnU3BlZWNoX1BhcmFtc19Gb3JjZV9TaG91dGVkX0NyaXRpY2FsJywgMSkKICAgICAgICAgICAgdXRpbC55aWVsZCgxMDApCiAgICAgICAgZW5kCgogICAgZW5kKQplbmQKZnVuY3Rpb24gSW5zdWx0aGlnaChwZWRfdGFiKQogICAgdXRpbC5jcmVhdGVfdGlja19oYW5kbGVyIChmdW5jdGlvbiAoKQogICAgICAgIGZvciBfLCBwaSBpbiBpcGFpcnMocGVkX3RhYikgZG8KICAgICAgICAgICAgQVVESU8uUExBWV9QRURfQU1CSUVOVF9TUEVFQ0hfTkFUSVZFKHBpLCAnR2VuZXJpY19JbnN1bHRfSGlnaCcsICdTUEVFQ0hfUEFSQU1TX0ZPUkNFJywgMSkKICAgICAgICAgICAgdXRpbC55aWVsZCgxMDApCiAgICAgICAgZW5kCiAgICBlbmQpCmVuZApmdW5jdGlvbiBXYXJjcnkocGVkX3RhYikKICAgIHV0aWwuY3JlYXRlX3RpY2tfaGFuZGxlciAoZnVuY3Rpb24gKCkKICAgICAgICBmb3IgXywgcGkgaW4gaXBhaXJzKHBlZF90YWIpIGRvCiAgICAgICAgICAgIEFVRElPLlBMQVlfUEVEX0FNQklFTlRfU1BFRUNIX05BVElWRShwaSwgJ0dFTkVSSUNfV0FSX0NSWScsICdTUEVFQ0hfUEFSQU1TX0ZPUkNFJywgMSkKICAgICAgICAgICAgdXRpbC55aWVsZCgxMDApCiAgICAgICAgZW5kCgogICAgZW5kKQplbmQKZnVuY3Rpb24gUGVkc3Bhd24ocGVkaGFzaCwgdGFyMSkKICAgIHJlcXVlc3RfbW9kZWwocGVkaGFzaCkKICAgIGxvY2FsIHBlZFMgPSBlbnRpdGllcy5jcmVhdGVfcGVkKDEsIHBlZGhhc2gsIHRhcjEsIDApCiAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKHBlZFMsIHRydWUpCiAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihwZWRTLCB0cnVlKQogICAgUEVELlNFVF9CTE9DS0lOR19PRl9OT05fVEVNUE9SQVJZX0VWRU5UUyhwZWRTLCB0cnVlKQogICAgUEVELlNFVF9QRURfQ0FOX0xPU0VfUFJPUFNfT05fREFNQUdFKHBlZFMsIGZhbHNlKQogICAgaWYgcGVkaGFzaCA9PSB1dGlsLmpvYWF0KCdpZ19sZXN0ZXJjcmVzdCcpIHRoZW4KICAgICAgICBQRUQuU0VUX1BFRF9QUk9QX0lOREVYKHBlZFMsIDEpCiAgICBlbmQKICAgIHJldHVybiBwZWRTCmVuZApmdW5jdGlvbiBSdW5hbmltKGVudCwgYW5pbWRpY3QsIGFuaW0pCiAgICBUQVNLLlRBU0tfUExBWV9BTklNKGVudCwgYW5pbWRpY3QsIGFuaW0sIDEuMCwgMS4wLCAtMSwgMywgMC41LCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgd2hpbGUgRU5USVRZLklTX0VOVElUWV9QTEFZSU5HX0FOSU0oZW50LCBhbmltZGljdCwgYW5pbSwgMykgPT1mYWxzZSBkbwogICAgICAgIFRBU0suVEFTS19QTEFZX0FOSU0oZW50LCBhbmltZGljdCwgYW5pbSwgMS4wLCAxLjAsIC0xLCAzLCAwLjUsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgdXRpbC55aWVsZCgpCiAgICBlbmQKZW5kCmZ1bmN0aW9uIFBGUChwZWRtLCBwbGF5ZXJtKS0tUGVkIEZhY2luZyBQbGF5ZXIgYWRhcHRlZCBmcm9tIFBob2VuaXhTY3JpcHQKICAgIGxvY2FsIHBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMocGxheWVybSkKICAgIGxvY2FsIHBtcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHBlZG0pCiAgICBsb2NhbCBoeCA9IHBwb3MueCAtIHBtcG9zLngKICAgIGxvY2FsIGh5ID0gcHBvcy55IC0gcG1wb3MueQogICAgbG9jYWwgaGVhZCA9IE1JU0MuR0VUX0hFQURJTkdfRlJPTV9WRUNUT1JfMkQoaHgsIGh5KQogICAgcmV0dXJuIEVOVElUWS5TRVRfRU5USVRZX0hFQURJTkcocGVkbSwgaGVhZCkKZW5kCmZ1bmN0aW9uIERlbEVudChwZWRfdGFiKQogICAgZm9yIF8sIFBlZG0gaW4gaXBhaXJzKHBlZF90YWIpIGRvCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQVNfTUlTU0lPTl9FTlRJVFkoUGVkbSkKICAgICAgICBkZWxldGVfZW50aXR5KFBlZG0pCiAgICBlbmQKZW5kCmZ1bmN0aW9uIFN0b3Bzb3VuZCgpCiAgICBmb3IgaSA9IDAsIDk5IGRvCiAgICAgICAgQVVESU8uU1RPUF9TT1VORChpKQogICAgZW5kCmVuZApmdW5jdGlvbiBJUE0odGFyZ2V0cywgdGFyMSwgcG5hbWUsIGNhZ2VfdGFibGUsIHBpZCkKICAgIGxvY2FsIHRhcjIgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFModGFyZ2V0cykKICAgIGxvY2FsIGRpc2JldCA9IFNZU1RFTS5WRElTVDIodGFyMi54LCB0YXIyLnksIHRhcjIueiwgdGFyMS54LCB0YXIxLnksIHRhcjEueikKICAgIGlmIGRpc2JldCA8IDAuNSAgdGhlbgogICAgICAgIHV0aWwueWllbGQoODAwKQogICAgZWxzZWlmIGRpc2JldCA+PSAwLjUgIHRoZW4KICAgICAgICBEZWxFbnQoY2FnZV90YWJsZVtwaWRdKQogICAgICAgIGNhZ2VfdGFibGVbcGlkXSA9IGZhbHNlCiAgICAgICAgU3RvcHNvdW5kKCkKICAgIGVuZAplbmQKZnVuY3Rpb24gc2VsZWN0X3BlZF9jYWdlKGluZGV4KQogICAgcGVkc2V0X2RlZiA9IHBlZHNldF9jYWdlLnZhbHVlW2luZGV4XQplbmQKZnVuY3Rpb24gYXV0b19wZWRfY2FnZShwaWQpCiAgICAKICAgIGxvY2FsIHRhcmdldHMgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKQogICAgbG9jYWwgdGFyMSA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyh0YXJnZXRzLCB0cnVlKQogICAgbG9jYWwgcG5hbWUgPSBQTEFZRVIuR0VUX1BMQVlFUl9OQU1FKHBpZCkKICAgIGlmIG5vdCBwZWRfY2FnZV90YWJsZVtwaWRdIHRoZW4KICAgICAgICBsb2NhbCBwZWRzID0ge30KICAgICAgICBsb2NhbCBwZWRoYXNoID0gdXRpbC5qb2FhdChwZWRzZXRfZGVmKQogICAgICAgIGxvY2FsIHBlZF90YWIgPSB7J3AxJywgJ3AyJywgJ3AzJywgJ3A0JywgJ3A1JywgJ3A2JywgJ3A3JywgJ3A4J30KICAgICAgICBmb3IgXywgc3Bhd25lZF9wZWQgaW4gaXBhaXJzKHBlZF90YWIpIGRvCiAgICAgICAgICAgIHNwYXduZWRfcGVkID0gUGVkc3Bhd24ocGVkaGFzaCwgdGFyMSkKICAgICAgICAgICAgdGFibGUuaW5zZXJ0KHBlZHMsICBzcGF3bmVkX3BlZCkKICAgICAgICBlbmQKICAgICAgICBTZXRQZWRDb29yKHBlZHNbMV0sIHRhcjEueCwgdGFyMS55IC0gMC41LCB0YXIxLnogLSAxLjApCiAgICAgICAgU2V0UGVkQ29vcihwZWRzWzJdLCB0YXIxLnggLSAwLjUsIHRhcjEueSAtIDAuNSwgdGFyMS56IC0gMS4wKQogICAgICAgIFNldFBlZENvb3IocGVkc1szXSwgdGFyMS54IC0gMC41LCB0YXIxLnksIHRhcjEueiAtIDEuMCkKICAgICAgICBTZXRQZWRDb29yKHBlZHNbNF0sIHRhcjEueCAtIDAuNSwgdGFyMS55ICsgMC41LCB0YXIxLnogLSAxLjApCiAgICAgICAgU2V0UGVkQ29vcihwZWRzWzVdLCB0YXIxLngsIHRhcjEueSArIDAuNSwgdGFyMS56IC0gMS4wKQogICAgICAgIFNldFBlZENvb3IocGVkc1s2XSwgdGFyMS54ICsgMC41LCB0YXIxLnkgKyAwLjUsIHRhcjEueiAtIDEuMCkKICAgICAgICBTZXRQZWRDb29yKHBlZHNbN10sIHRhcjEueCArIDAuNSwgdGFyMS55LCB0YXIxLnogLSAxLjApCiAgICAgICAgU2V0UGVkQ29vcihwZWRzWzhdLCB0YXIxLnggKyAwLjUsIHRhcjEueSAtIDAuNSwgdGFyMS56IC0gMS4wKQogICAgICAgIGlmIHBlZGhhc2ggPT0gdXRpbC5qb2FhdCgnSUdfTGVzdGVyQ3Jlc3QnKSAgdGhlbgogICAgICAgICAgICBUZWFiYWd0aW1lKHBlZHNbMV0sIHBlZHNbMl0sIHBlZHNbM10sIHBlZHNbNF0sIHBlZHNbNV0sIHBlZHNbNl0sIHBlZHNbN10sIHBlZHNbOF0pCiAgICAgICAgZWxzZWlmIHBlZGhhc2ggPT0gdXRpbC5qb2FhdCgncGxheWVyX3R3bycpIHRoZW4KICAgICAgICAgICAgVHJldm9ydGltZShwZWRzKQogICAgICAgIGVsc2VpZiBwZWRoYXNoID09IHV0aWwuam9hYXQoJ3VfbV9tX2plc3VzXzAxJykgdGhlbgogICAgICAgICAgICBKZXN1c2xvdmVzeW91KHBlZHMpICAKICAgICAgICBlbHNlaWYgcGVkaGFzaCB+PSB1dGlsLmpvYWF0KCdJR19MZXN0ZXJDcmVzdCcpIG9yIHV0aWwuam9hYXQoJ3BsYXllcl90d28nKSB0aGVuCiAgICAgICAgICAgIGlmIEdFTkVSSUNfQVVESU8uRE9FU19DT05URVhUX0VYSVNUX0ZPUl9USElTX1BFRChwZWRzWzFdLCAnR0VORVJJQ19GVUNLX1lPVScpID09dHJ1ZSB0aGVuIAogICAgICAgICAgICAgICAgRnVja3lvdShwZWRzKQogICAgICAgICAgICBlbHNlaWYgR0VORVJJQ19BVURJTy5ET0VTX0NPTlRFWFRfRVhJU1RfRk9SX1RISVNfUEVEKHBlZHNbMV0sICdQcm92b2tlX1RyZXNwYXNzJykgdGhlbiAKICAgICAgICAgICAgICAgIFByb3Zva2UocGVkcykKICAgICAgICAgICAgZWxzZWlmIEdFTkVSSUNfQVVESU8uRE9FU19DT05URVhUX0VYSVNUX0ZPUl9USElTX1BFRChwZWRzWzFdLCAnR2VuZXJpY19JbnN1bHRfSGlnaCcpIHRoZW4gCiAgICAgICAgICAgICAgICBJbnN1bHRoaWdoKHBlZHMpCiAgICAgICAgICAgIGVsc2VpZiBHRU5FUklDX0FVRElPLkRPRVNfQ09OVEVYVF9FWElTVF9GT1JfVEhJU19QRUQocGVkc1sxXSwgJ0dFTkVSSUNfV0FSX0NSWScpIHRoZW4gCiAgICAgICAgICAgICAgICBXYXJjcnkocGVkcykKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICAgICAgcmVxdWVzdF9hbmltX2RpY3QoJ3JjbXBhcGFyYXp6b18yJykKICAgICAgICByZXF1ZXN0X2FuaW1fZGljdCgnbXBfcGxheWVyX2ludF91cHBlcmZpbmdlcicpCiAgICAgICAgcmVxdWVzdF9hbmltX2RpY3QoJ21pc3NjYXJzdGVhbDJwZWVpbmcnKQogICAgICAgIHJlcXVlc3RfYW5pbV9kaWN0KCdtcF9wbGF5ZXJfaW50X3VwcGVycGVhY2Vfc2lnbicpCiAgICAgICAgbG9jYWwgcGVkX2FuaW0gPSB7cGVkc1syXSwgcGVkc1szXSwgcGVkc1s0XSwgcGVkc1s1XSwgcGVkc1s2XSwgcGVkc1s3XSwgcGVkc1s4XX0KICAgICAgICBmb3IgXywgUGVkYW5pbSBpbiBpcGFpcnMocGVkX2FuaW0pIGRvCiAgICAgICAgICAgIGlmIHBlZGhhc2ggPT0gdXRpbC5qb2FhdCgncGxheWVyX3R3bycpIHRoZW4KICAgICAgICAgICAgICAgIFJ1bmFuaW0oUGVkYW5pbSwgJ21pc3NjYXJzdGVhbDJwZWVpbmcnLCdwZWVpbmdfbG9vcCcpCiAgICAgICAgICAgICAgICBsb2NhbCB0cmUgPSBQRUQuR0VUX1BFRF9CT05FX0lOREVYKFBlZGFuaW0sIDB4MmUyOCkKICAgICAgICAgICAgICAgIHJlcXVlc3RfcHRmeF9hc3NldCgnY29yZScpCiAgICAgICAgICAgICAgICBHUkFQSElDUy5VU0VfUEFSVElDTEVfRlhfQVNTRVQoJ2NvcmUnKQogICAgICAgICAgICAgICAgR1JBUEhJQ1MuU1RBUlRfTkVUV09SS0VEX1BBUlRJQ0xFX0ZYX0xPT1BFRF9PTl9FTlRJVFlfQk9ORSgiZW50X2FtYl9wZWVpbmciLCBQZWRhbmltLCAwLCAwLCAwLCAtOTAsIDAsIDAsIHRyZSwgMiwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgMCwgMCwgMCwgMCkKICAgICAgICAgICAgZWxzZWlmIHBlZGhhc2ggPT0gdXRpbC5qb2FhdCgndV9tX21famVzdXNfMDEnKSB0aGVuCiAgICAgICAgICAgICAgICBSdW5hbmltKHBlZHNbMV0sICdtcF9wbGF5ZXJfaW50X3VwcGVycGVhY2Vfc2lnbicsICdtcF9wbGF5ZXJfaW50X3BlYWNlX3NpZ24nKQogICAgICAgICAgICAgICAgUnVuYW5pbShQZWRhbmltLCAnbXBfcGxheWVyX2ludF91cHBlcnBlYWNlX3NpZ24nLCAnbXBfcGxheWVyX2ludF9wZWFjZV9zaWduJykKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgUnVuYW5pbShQZWRhbmltLCAnbXBfcGxheWVyX2ludF91cHBlcmZpbmdlcicsICdtcF9wbGF5ZXJfaW50X2Zpbmdlcl8wMl9mcCcpCiAgICAgICAgICAgICAgICBSdW5hbmltKHBlZHNbMV0sICdyY21wYXBhcmF6em9fMicsICdzaGFnX2xvb3BfYScpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIGZvciBfLCBQZWRtIGluIGlwYWlycyhwZWRzKSBkbwogICAgICAgICAgICBQRlAoUGVkbSwgdGFyZ2V0cykKICAgICAgICBlbmQKICAgICAgICBwZWRfY2FnZV90YWJsZVtwaWRdID0gcGVkcwogICAgZW5kCiAgICB3aGlsZSBwZWRfY2FnZV90YWJsZVtwaWRdIGRvCiAgICAgICAgaWYgcGxheWVycy5leGlzdHMocGlkKSB0aGVuCiAgICAgICAgICAgIElQTSh0YXJnZXRzLCB0YXIxLCBwbmFtZSwgcGVkX2NhZ2VfdGFibGUsIHBpZCkKICAgICAgICBlbmQKICAgIGVuZAplbmQKCgotLS0t54mp5L2T56y85a2QCmxvY2FsIG9iamNhZ2VzZXQgPSAncHJvcF9taW5lc2hhZnRfZG9vcicgICAKZnVuY3Rpb24gc2VsZWN0X29ial9jYWdlKGluZGV4KQogICAgb2JqY2FnZXNldCA9IG9ianNldGNhZ2UudmFsdWVbaW5kZXhdCmVuZApmdW5jdGlvbiBPYmpGcmV6U3Bhd24oaHNlbCwgdGFyMSkKICAgIGxvY2FsIG9iakhhc2ggPSBoc2VsCiAgbG9jYWwgb2JqZlMgPSAgT0JKRUNULkNSRUFURV9PQkpFQ1Qob2JqSGFzaCwgdGFyMS54LCB0YXIxLnksIHRhcjEueiwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkKICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihvYmpmUywgdHJ1ZSkKICByZXR1cm4gb2JqZlMKZW5kCmZ1bmN0aW9uIFNldE9iakNvKG9ialMsIHRhcngsIHRhcnksIHRhcnopCiAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFMob2JqUywgdGFyeCwgdGFyeSwgdGFyeiwgZmFsc2UsIHRydWUsIHRydWUsIGZhbHNlKQplbmQKZnVuY3Rpb24gYXV0b19vYmpfY2FnZShwaWQpCiAgICAKICAgIGxvY2FsIHRhcmdldHMgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKQogICAgbG9jYWwgdGFyMSA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyh0YXJnZXRzLCB0cnVlKQogICAgbG9jYWwgcG5hbWUgPSBQTEFZRVIuR0VUX1BMQVlFUl9OQU1FKHBpZCkKICAgIGlmIG5vdCBvYmpfdGFibGVbcGlkXSB0aGVuCiAgICAgICAgbG9jYWwgb2JqcyA9IHt9CiAgICAgICAgbG9jYWwgc3BlYyA9IG1lbnUuZ2V0X3ZhbHVlKG1lbnUucmVmX2J5X3JlbF9wYXRoKG1lbnUucGxheWVyX3Jvb3QocGlkKSwgIlNwZWN0YXRlPk51dHMgTWV0aG9kIikpCiAgICAgICAgRGVsY2FyKHRhcmdldHMsIHNwZWMsIHBpZCkKICAgICAgICBsb2NhbCBoc2VsID0gdXRpbC5qb2FhdChvYmpjYWdlc2V0KQogICAgICAgIHJlcXVlc3RfbW9kZWwoaHNlbCkKICAgICAgICBsb2NhbCBvYmpfdGFiID0geydvMScsICdvMicsICdvMycsICdvNCcsICdvNScsICdvNicsICdvNycsICdvOCd9CiAgICAgICAgZm9yIF8sIHNwYXduZWRfb2JqIGluIGlwYWlycyhvYmpfdGFiKSBkbwogICAgICAgICAgICBzcGF3bmVkX29iaiA9ICBPYmpGcmV6U3Bhd24oaHNlbCwgdGFyMSkKICAgICAgICAgICAgdGFibGUuaW5zZXJ0KG9ianMsICBzcGF3bmVkX29iaikKICAgICAgICBlbmQKICAgICAgICBvYmpfdGFibGVbcGlkXSA9IG9ianMKICAgICAgICBTZXRPYmpDbyhvYmpzWzFdLCB0YXIxLngsIHRhcjEueSAtIDAuNSwgdGFyMS56IC0gMS4wKQogICAgICAgIFNldE9iakNvKG9ianNbMl0sIHRhcjEueCAtIDAuNSwgdGFyMS55IC0gMC41LCB0YXIxLnogLSAxLjApCiAgICAgICAgU2V0T2JqQ28ob2Jqc1szXSwgdGFyMS54IC0gMC41LCB0YXIxLnksIHRhcjEueiAtIDEuMCkKICAgICAgICBTZXRPYmpDbyhvYmpzWzRdLCB0YXIxLnggLSAwLjUsIHRhcjEueSArIDAuNSwgdGFyMS56IC0gMS4wKQogICAgICAgIFNldE9iakNvKG9ianNbNV0sIHRhcjEueCwgdGFyMS55ICsgMC41LCB0YXIxLnogLSAxLjApCiAgICAgICAgU2V0T2JqQ28ob2Jqc1s2XSwgdGFyMS54ICsgMC41LCB0YXIxLnkgKyAwLjUsIHRhcjEueiAtIDEuMCkKICAgICAgICBTZXRPYmpDbyhvYmpzWzddLCB0YXIxLnggKyAwLjUsIHRhcjEueSwgdGFyMS56IC0gMS4wKQogICAgICAgIFNldE9iakNvKG9ianNbOF0sIHRhcjEueCArIDAuNSwgdGFyMS55IC0gMC41LCB0YXIxLnogLSAxLjApCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04ob2Jqc1sxXSwgMCwgMCwgMTgwLCAxLCB0cnVlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKG9ianNbMl0sIDAsIDAsIDEzNSwgMSwgdHJ1ZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9ST1RBVElPTihvYmpzWzNdLCAwLCAwLCA5MCwgMSwgdHJ1ZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9ST1RBVElPTihvYmpzWzRdLCAwLCAwLCA0NSwgMSwgdHJ1ZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9ST1RBVElPTihvYmpzWzZdLCAwLCAwLCAzMTUsIDEsIHRydWUpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04ob2Jqc1s3XSwgMCwgMCwgMjcwLCAxLCB0cnVlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKG9ianNbOF0sIDAsIDAsIDIyNSwgMSwgdHJ1ZSkKICAgICAgICBmb3IgXywgaG9ybiBpbiBpcGFpcnMob2JqcykgZG8KICAgICAgICAgICAgQVVESU8uUExBWV9TT1VORF9GUk9NX0VOVElUWSgtMSwgJ0FsYXJtX0ludGVyaW9yJywgaG9ybiwgJ0RMQ19IM19GTV9GSUJfUmFpZF9Tb3VuZHMnLCAwLCAwKQogICAgICAgIGVuZAogICAgZW5kCiAgICB3aGlsZSBvYmpfdGFibGVbcGlkXSBkbwogICAgICAgIGlmIHBsYXllcnMuZXhpc3RzKHBpZCkgdGhlbgogICAgICAgICAgICBJUE0odGFyZ2V0cywgdGFyMSwgcG5hbWUsIG9ial90YWJsZSwgcGlkKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKCi0tLS3mm7TmlLnlrZDlvLnnsbvlnosKZnVuY3Rpb24gY2hhbmdlX2J1bGxldF90eXBlKCkKCWZvciBpZCwgZGF0YSBpbiBwYWlycyh3ZWFwb25fc3R1ZmYpIGRvCiAgICAgICAgbG9jYWwgbmFtZSA9IGRhdGFbMV0KICAgICAgICBtZW51LnRvZ2dsZV9sb29wKHdlYXBvbl9idWxsZXQsIG5hbWUsIHt9LCAiIiwgZnVuY3Rpb24oKQogICAgICAgICAgICBsb2NhbCB3ZWFwb25fbmFtZSA9IGRhdGFbMl0KICAgICAgICAgICAgbG9jYWwgd2VhcG9uID0gdXRpbC5qb2FhdCh3ZWFwb25fbmFtZSkKICAgICAgICAgICAgcmVxdWVzdF93ZWFwb25fYXNzZXQod2VhcG9uKQogICAgICAgICAgICBsb2NhbCBpbnN0ID0gdjMubmV3KCkKICAgICAgICAgICAgaWYgUEVELklTX1BFRF9TSE9PVElORyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSB0aGVuCiAgICAgICAgICAgICAgICBpZiBub3QgV0VBUE9OLkdFVF9QRURfTEFTVF9XRUFQT05fSU1QQUNUX0NPT1JEKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGluc3QpIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBmaW5hbF9yb3QgPSBDQU0uR0VUX0ZJTkFMX1JFTkRFUkVEX0NBTV9ST1QoMikKICAgICAgICAgICAgICAgICAgICB2My5zZXQoaW5zdCwgZmluYWxfcm90LngsZmluYWxfcm90LnksZmluYWxfcm90LnopCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgdG1wID0gdjMudG9EaXIoaW5zdCkKICAgICAgICAgICAgICAgICAgICB2My5zZXQoaW5zdCwgdjMuZ2V0KHRtcCkpCiAgICAgICAgICAgICAgICAgICAgdjMubXVsKGluc3QsIDEwMDApCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgZmluYWxfY29vcmQgPSBDQU0uR0VUX0ZJTkFMX1JFTkRFUkVEX0NBTV9DT09SRCgpCiAgICAgICAgICAgICAgICAgICAgdjMuc2V0KHRtcCwgZmluYWxfY29vcmQueCxmaW5hbF9jb29yZC55LGZpbmFsX2Nvb3JkLnopCiAgICAgICAgICAgICAgICAgICAgdjMuYWRkKGluc3QsIHRtcCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgbG9jYWwgeCwgeSwgeiA9IHYzLmdldChpbnN0KQogICAgICAgICAgICAgICAgbG9jYWwgd3BFbnQgPSBXRUFQT04uR0VUX0NVUlJFTlRfUEVEX1dFQVBPTl9FTlRJVFlfSU5ERVgoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMCkKICAgICAgICAgICAgICAgIGxvY2FsIHdwQ29vcmRzID0gRU5USVRZMS5fR0VUX0VOVElUWV9CT05FX1BPU0lUSU9OXzIod3BFbnQsIEVOVElUWS5HRVRfRU5USVRZX0JPTkVfSU5ERVhfQllfTkFNRSh3cEVudCwgImd1bl9tdXp6bGUiKSkKICAgICAgICAgICAgICAgIE1JU0MuU0hPT1RfU0lOR0xFX0JVTExFVF9CRVRXRUVOX0NPT1JEUyh3cENvb3Jkcy54LCB3cENvb3Jkcy55LCB3cENvb3Jkcy56LCB4LCB5LCB6LCAxLCB0cnVlLCB3ZWFwb24sIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUsIGZhbHNlLCAxMDAwKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKZW5kCgotLS0t5pu05pS55a2Q5by55pWI5p6cCmxvY2FsIGJ1bGxldF9zdHlsZV90YmwgPSB7fQpmdW5jdGlvbiBjaGFuZ2VfYnVsbGV0X3N0eWxlKGluZGV4KQogICAgYnVsbGV0X3N0eWxlX3ZhbHVlID0gaW5kZXgKICAgIHdoaWxlIGJ1bGxldF9zdHlsZV92YWx1ZSB+PSAxIGRvCiAgICAgICAgbG9jYWwgcENQZWQgPSBlbnRpdGllcy5oYW5kbGVfdG9fcG9pbnRlcihQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgIGxvY2FsIHBDUGVkV2VhcG9uTWFuYWdlciA9IG1lbW9yeS5yZWFkX2xvbmcocENQZWQgKyAweDEwQjgpCiAgICAgICAgbG9jYWwgcENXZWFwb25JbmZvID0gbWVtb3J5LnJlYWRfbG9uZyhwQ1BlZFdlYXBvbk1hbmFnZXIgKyAweDIwKQoKICAgICAgICAtLeWQr+eUqOWtkOW8ueexu+Wei++8iOWtl+iKgu+8ie+8jDB4MDI6RmlzdHPvvIwweDAzOkJ1bGxldO+8jDB4MDU6RXhwbG9zaW9uCiAgICAgICAgbWVtb3J5LndyaXRlX2J5dGUocENXZWFwb25JbmZvICsgMHgyMCwgNSkKCiAgICAgICAgLS3orr7nva4KICAgICAgICBpZiBwQ1dlYXBvbkluZm8gPj0gMHgxMDAwMCBvciBwQ1dlYXBvbkluZm8gPCAweDAwMEYwMDAwMDAwMDAwMDAgdGhlbiAtLeWIpOaWreWcsOWdgOaYr+WQpuaXoOaViAogICAgICAgICAgICBtZW1vcnkud3JpdGVfaW50KHBDV2VhcG9uSW5mbyArIDB4MjQsIGluZGV4IC0gMikKICAgICAgICBlbmQKCiAgICAgICAgdGFibGUuaW5zZXJ0KGJ1bGxldF9zdHlsZV90YmwsIHBDV2VhcG9uSW5mbykKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAogICAgaWYgYnVsbGV0X3N0eWxlX3ZhbHVlID09IDEgdGhlbgogICAgICAgIGZvciBrLCB2IGluIHBhaXJzKGJ1bGxldF9zdHlsZV90YmwpIGRvCiAgICAgICAgICAgIG1lbW9yeS53cml0ZV9ieXRlKHYgKyAweDIwLCAzKQogICAgICAgICAgICBpZiB2ID49IDB4MTAwMDAgb3IgdiA8IDB4MDAwRjAwMDAwMDAwMDAwMCB0aGVuCiAgICAgICAgICAgICAgICBtZW1vcnkud3JpdGVfaW50KHYgKyAweDI0LCAtMSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCi0tLS3mm7TmlLnlvLnoja/mlYjmnpwKZnVuY3Rpb24gY2hhbmdlX2FtbW9fZWZmZWN0KGluZGV4KQogICAgZXhwbG9zaW9uX2lkID0gaW5kZXggLSAyCiAgICBsb2NhbCBwb3MgPSB2My5uZXcoKQogICAgd2hpbGUgZXhwbG9zaW9uX2lkIH49IC0xIGRvCiAgICAgICAgaWYgV0VBUE9OLkdFVF9QRURfTEFTVF9XRUFQT05fSU1QQUNUX0NPT1JEKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHBvcykgdGhlbgogICAgICAgICAgICBGSVJFLkFERF9FWFBMT1NJT04ocG9zLngsIHBvcy55LCBwb3MueiwgZXhwbG9zaW9uX2lkLCAxLjAsIHRydWUsIGZhbHNlLCAxLCBmYWxzZSkKICAgICAgICBlbmQKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAplbmQKCgoKLS0tLeepuuS4reair+mYnwpmdW5jdGlvbiBlc2NvcnQoKQogICAgbG9jYWwgaGVhZGluZyA9IEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgIGxvY2FsIGhhc2hKZXQgPSB1dGlsLmpvYWF0KCJMYXplciIpCiAgICBsb2NhbCBoYXNoVGFyZ2V0ID0gMTA4Mjc5Nzg4OCAtLToxMDgyNzk3ODg4CiAgICByZXF1ZXN0X21vZGVsKGhhc2hKZXQpCiAgICByZXF1ZXN0X21vZGVsKGhhc2hUYXJnZXQpCgogICAgLS1DUkVBVEVfUEVEX0lOU0lERV9WRUhJQ0xFCiAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMCwgMCwgMjAwKQogICAgbG9jYWwgYUpldHBvcyA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAtNTAsIC01MCwgMjAwKSAtLTIwMAogICAgbG9jYWwgYkpldHBvcyA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCA1MCwgLTUwLCAyMDApCiAgICBsb2NhbCBjSmV0cG9zID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIC01MCwgLTEwMCwgMjAwKQogICAgbG9jYWwgZEpldHBvcyA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCA1MCwgLTEwMCwgMjAwKQogICAgbG9jYWwgYUpldEFpbXBvcyA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAtMjAsIDAsIDApCiAgICBsb2NhbCBiSmV0QWltcG9zID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDIwLCAwLCAwKQogICAgbG9jYWwgY0pldEFpbXBvcyA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAtNDAsIC00MCwgMCkgLS0yMDAKICAgIGxvY2FsIGRKZXRBaW1wb3MgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgNDAsIC00MCwgMCkgLS0yMDAKCiAgICBpZiBub3QgUEVELklTX1BFRF9JTl9BTllfVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSB0aGVuCiAgICAgICAgUGxheWVySmV0ID0gZW50aXRpZXMuY3JlYXRlX3ZlaGljbGUoaGFzaEpldCwgcG9zLCBoZWFkaW5nKQogICAgICAgIAogICAgICAgIGFUYXJnZXQgPSBlbnRpdGllcy5jcmVhdGVfb2JqZWN0KGhhc2hUYXJnZXQsIGFKZXRBaW1wb3MpLS1vYmoKICAgICAgICBiVGFyZ2V0ID0gZW50aXRpZXMuY3JlYXRlX29iamVjdChoYXNoVGFyZ2V0LCBiSmV0QWltcG9zKQogICAgICAgIGNUYXJnZXQgPSBlbnRpdGllcy5jcmVhdGVfb2JqZWN0KGhhc2hUYXJnZXQsIGNKZXRBaW1wb3MpCiAgICAgICAgZFRhcmdldCA9IGVudGl0aWVzLmNyZWF0ZV9vYmplY3QoaGFzaFRhcmdldCwgZEpldEFpbXBvcykKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT0xMSVNJT04oYVRhcmdldCwgZmFsc2UsIGZhbHNlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1ZJU0lCTEUoYVRhcmdldCwgZmFsc2UsIGZhbHNlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPTExJU0lPTihiVGFyZ2V0LCBmYWxzZSwgZmFsc2UpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfVklTSUJMRShiVGFyZ2V0LCBmYWxzZSwgZmFsc2UpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09MTElTSU9OKGNUYXJnZXQsIGZhbHNlLCBmYWxzZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9WSVNJQkxFKGNUYXJnZXQsIGZhbHNlLCBmYWxzZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT0xMSVNJT04oZFRhcmdldCwgZmFsc2UsIGZhbHNlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1ZJU0lCTEUoZFRhcmdldCwgZmFsc2UsIGZhbHNlKQoKICAgICAgICBQRUQuU0VUX1BFRF9JTlRPX1ZFSElDTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgUGxheWVySmV0LCAtMSkKICAgICAgICBWRUhJQ0xFLkNPTlRST0xfTEFORElOR19HRUFSKFBsYXllckpldCwgMyktLeaOp+WItui1t+iQveaetgogICAgICAgIEVOVElUWS5BUFBMWV9GT1JDRV9UT19FTlRJVFlfQ0VOVEVSX09GX01BU1MoUGxheWVySmV0LCAxLCAwLCAxMDAsIDAsIHRydWUsIHRydWUsIHRydWUsIHRydWUpCgogICAgICAgIEpldEEgPSBlbnRpdGllcy5jcmVhdGVfdmVoaWNsZShoYXNoSmV0LCBhSmV0cG9zLCBoZWFkaW5nKS0t5Yib5bu66aOe5py6CiAgICAgICAgSmV0QiA9IGVudGl0aWVzLmNyZWF0ZV92ZWhpY2xlKGhhc2hKZXQsIGJKZXRwb3MsIGhlYWRpbmcpCiAgICAgICAgSmV0QyA9IGVudGl0aWVzLmNyZWF0ZV92ZWhpY2xlKGhhc2hKZXQsIGNKZXRwb3MsIGhlYWRpbmcpCiAgICAgICAgSmV0RCA9IGVudGl0aWVzLmNyZWF0ZV92ZWhpY2xlKGhhc2hKZXQsIGRKZXRwb3MsIGhlYWRpbmcpCgogICAgICAgIFBpbG90QSA9IFBFRC5DUkVBVEVfUkFORE9NX1BFRF9BU19EUklWRVIoSmV0QSwgMSktLeWIm+W7uumpvumptumjnuacuueahFBFRAogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRU5HSU5FX09OKEpldEEsIHRydWUsIHRydWUsIDApCiAgICAgICAgCiAgICAgICAgUGlsb3RCID0gUEVELkNSRUFURV9SQU5ET01fUEVEX0FTX0RSSVZFUihKZXRCLCAxKQogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRU5HSU5FX09OKEpldEIsIHRydWUsIHRydWUsIDApCiAgICAgICAgCiAgICAgICAgUGlsb3RDID0gUEVELkNSRUFURV9SQU5ET01fUEVEX0FTX0RSSVZFUihKZXRDLCAxKQogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRU5HSU5FX09OKEpldEMsIHRydWUsIHRydWUsIDApCiAgICAgICAgCiAgICAgICAgUGlsb3REID0gUEVELkNSRUFURV9SQU5ET01fUEVEX0FTX0RSSVZFUihKZXRELCAxKQogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRU5HSU5FX09OKEpldEQsIHRydWUsIHRydWUsIDApCgogICAgICAgIC0t6Ziy5q2ibnBj5pS75Ye76Ieq5bexCiAgICAgICAgY2FsbV9wZWQoUGlsb3RBLCB0cnVlKTtjYWxtX3BlZChQaWxvdEIsIHRydWUpO2NhbG1fcGVkKFBpbG90QywgdHJ1ZSk7Y2FsbV9wZWQoUGlsb3RELCB0cnVlKQoKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKFBsYXllckpldCwgdHJ1ZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKEpldEEsIHRydWUpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRShKZXRCLCB0cnVlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0lOVklOQ0lCTEUoSmV0QywgdHJ1ZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKEpldEQsIHRydWUpCiAgICBlbmQKICAgIHdoaWxlIFBFRC5JU19QRURfSU5fVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBQbGF5ZXJKZXQsIGZhbHNlKSBkbyAKICAgICAgICBzZXRfZW50aXR5X2ZhY2VfZW50aXR5KEpldEEsIGFUYXJnZXQsIHRydWUpCiAgICAgICAgc2V0X2VudGl0eV9mYWNlX2VudGl0eShKZXRCLCBiVGFyZ2V0LCB0cnVlKQogICAgICAgIHNldF9lbnRpdHlfZmFjZV9lbnRpdHkoSmV0QywgY1RhcmdldCwgdHJ1ZSkKICAgICAgICBzZXRfZW50aXR5X2ZhY2VfZW50aXR5KEpldEQsIGRUYXJnZXQsIHRydWUpCgogICAgICAgIGxvY2FsIGFKZXRBaW1wb3MgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgLTIwLCAwLCAwKQogICAgICAgIGxvY2FsIGJKZXRBaW1wb3MgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMjAsIDAsIDApCiAgICAgICAgbG9jYWwgY0pldEFpbXBvcyA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAtNDAsIC00MCwgMCkgLS0yMDAKICAgICAgICBsb2NhbCBkSmV0QWltcG9zID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDQwLCAtNDAsIDApIC0tMjAwCiAgICAgICAgbG9jYWwgYUpldFJlYWxMb2MgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoSmV0QSwgMCwgMCwgMCkKICAgICAgICBsb2NhbCBiSmV0UmVhbExvYyA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhKZXRCLCAwLCAwLCAwKQogICAgICAgIGxvY2FsIGNKZXRSZWFsTG9jID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKEpldEMsIDAsIDAsIDApCiAgICAgICAgbG9jYWwgZEpldFJlYWxMb2MgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoSmV0RCwgMCwgMCwgMCkKCiAgICAgICAgbG9jYWwgYURpc3RhbmNlID0gR2V0X2Rpc3RhbmNlKGFKZXRSZWFsTG9jLCBhSmV0QWltcG9zLCB0cnVlKQogICAgICAgIGxvY2FsIGJEaXN0YW5jZSA9IEdldF9kaXN0YW5jZShiSmV0UmVhbExvYywgYkpldEFpbXBvcywgdHJ1ZSkKICAgICAgICBsb2NhbCBjRGlzdGFuY2UgPSBHZXRfZGlzdGFuY2UoY0pldFJlYWxMb2MsIGNKZXRBaW1wb3MsIHRydWUpCiAgICAgICAgbG9jYWwgZERpc3RhbmNlID0gR2V0X2Rpc3RhbmNlKGRKZXRSZWFsTG9jLCBkSmV0QWltcG9zLCB0cnVlKQogICAgICAgIGlmIGFEaXN0YW5jZSA8IDQwIHRoZW4KICAgICAgICAgICAgYUpldFNwZWVkID0gLTAuOAogICAgICAgIGVsc2UKICAgICAgICAgICAgYUpldFNwZWVkID0gMC41CiAgICAgICAgZW5kCiAgICAgICAgaWYgYkRpc3RhbmNlIDwgNDAgdGhlbgogICAgICAgICAgICBiSmV0U3BlZWQgPSAtMC44CiAgICAgICAgZWxzZQogICAgICAgICAgICBiSmV0U3BlZWQgPSAwLjUKICAgICAgICBlbmQKICAgICAgICBpZiBjRGlzdGFuY2UgPCA0MCB0aGVuCiAgICAgICAgICAgIGNKZXRTcGVlZCA9IC0wLjgKICAgICAgICBlbHNlCiAgICAgICAgICAgIGNKZXRTcGVlZCA9IDAuNQogICAgICAgIGVuZAogICAgICAgIGlmIGREaXN0YW5jZSA8IDQwIHRoZW4KICAgICAgICAgICAgZEpldFNwZWVkID0gLTAuOAogICAgICAgIGVsc2UKICAgICAgICAgICAgZEpldFNwZWVkID0gMC41CiAgICAgICAgZW5kCgogICAgICAgIGlmIG5vdCBQRUQuSVNfUEVEX09OX0ZPT1QoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgdGhlbgogICAgICAgICAgICBFTlRJVFkuQVBQTFlfRk9SQ0VfVE9fRU5USVRZX0NFTlRFUl9PRl9NQVNTKEpldEEsIDEsIDAsIGFKZXRTcGVlZCwgMCwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTX05PX09GRlNFVChhVGFyZ2V0LCBhSmV0QWltcG9zLngsIGFKZXRBaW1wb3MueSwgYUpldEFpbXBvcy56LCBmYWxzZSwgZmFsc2UsIGZhbHNlKQoKICAgICAgICAgICAgRU5USVRZLkFQUExZX0ZPUkNFX1RPX0VOVElUWV9DRU5URVJfT0ZfTUFTUyhKZXRCLCAxLCAwLCBiSmV0U3BlZWQsIDAsIHRydWUsIHRydWUsIHRydWUsIHRydWUpCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQoYlRhcmdldCwgYkpldEFpbXBvcy54LCBiSmV0QWltcG9zLnksIGJKZXRBaW1wb3MueiwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKCiAgICAgICAgICAgIEVOVElUWS5BUFBMWV9GT1JDRV9UT19FTlRJVFlfQ0VOVEVSX09GX01BU1MoSmV0QywgMSwgMCwgY0pldFNwZWVkLCAwLCB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlKQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFNfTk9fT0ZGU0VUKGNUYXJnZXQsIGNKZXRBaW1wb3MueCwgY0pldEFpbXBvcy55LCBjSmV0QWltcG9zLnosIGZhbHNlLCBmYWxzZSwgZmFsc2UpCgogICAgICAgICAgICBFTlRJVFkuQVBQTFlfRk9SQ0VfVE9fRU5USVRZX0NFTlRFUl9PRl9NQVNTKEpldEQsIDEsIDAsIGRKZXRTcGVlZCwgMCwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTX05PX09GRlNFVChkVGFyZ2V0LCBkSmV0QWltcG9zLngsIGRKZXRBaW1wb3MueSwgZEpldEFpbXBvcy56LCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgICAgIGVuZAoKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAplbmQKCgoKLS0tLeiHquWKqOWHuuenn+i9pgpsb2NhbCB0YXhpX3dheSA9IDEKZnVuY3Rpb24gY2hlY2tfdGF4aV93YXkoaW5kZXgpCiAgICB0YXhpX3dheSA9IGluZGV4CiAgICB1dGlsLnRvYXN0KCLliIfmjaLmiJDlip/vvIzkuIvkuIDova7nlJ/mlYgiKQplbmQKZnVuY3Rpb24gYXV0b190YXhpKHRvZ2dsZWQpCiAgICBhdXRvX3RheGlfdG9nZ2xlZCA9IHRvZ2dsZWQKICAgIHdoaWxlIGF1dG9fdGF4aV90b2dnbGVkIGRvCiAgICAgICAgbG9jYWwgcGxheV9jYXIgPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX1VTSU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICAgICAgbG9jYWwgdmhhc2ggPSBFTlRJVFkuR0VUX0VOVElUWV9NT0RFTChwbGF5X2NhcikKICAgICAgICBpZiBwbGF5X2NhciA9PSAwIG9yIHV0aWwucmV2ZXJzZV9qb2FhdCh2aGFzaCkgfj0gJ3RheGknIHRoZW4KICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDg5NS4xNzM5LCAtMTc5LjI3MDgsIDc0LjcwMDQ5LCBmYWxzZSwgdHJ1ZSwgdHJ1ZSwgZmFsc2UpCiAgICAgICAgICAgIHV0aWwueWllbGQoMjUwMCkKICAgICAgICAgICAgUEFELlNFVF9DT05UUk9MX1ZBTFVFX05FWFRfRlJBTUUoMCwgNTEsIDEpCiAgICAgICAgICAgIHV0aWwueWllbGQoMTAwMDApCiAgICAgICAgZW5kCgogICAgICAgIGlmIEhVRC5ET0VTX0JMSVBfRVhJU1QoSFVELkdFVF9DTE9TRVNUX0JMSVBfSU5GT19JRCgyODApKSB0aGVuCiAgICAgICAgICAgIGxvY2FsIHRheGlfYmxpcCA9IEhVRC5HRVRfQ0xPU0VTVF9CTElQX0lORk9fSUQoMjgwKSAtLeS5mOWuogogICAgICAgICAgICBsb2NhbCB0YXhpX2VudCA9IEhVRC5HRVRfQkxJUF9JTkZPX0lEX0VOVElUWV9JTkRFWCh0YXhpX2JsaXApCiAgICAgICAgICAgIGxvY2FsIHRheGkgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFModGF4aV9lbnQsIDAsIDYsIDApCiAgICAgICAgICAgIHV0aWwueWllbGQoNTAwKQoKICAgICAgICAgICAgLS3liY3lvoDkuZjlrqLkvY3nva4KICAgICAgICAgICAgaWYgdGF4aV93YXkgPT0gMSB0aGVuCiAgICAgICAgICAgICAgICBhdXRvX2RyaXZpbmdfdG9fY29vcmQoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdGF4aS54LCB0YXhpLnksIHRheGkueiwgNjAuMCwgMjg4MzYyMSwgMC4wKQogICAgICAgICAgICAgICAgd2hpbGUgdHJ1ZSBkbwogICAgICAgICAgICAgICAgICAgIGxvY2FsIHBvcyA9IEhVRC5HRVRfQkxJUF9DT09SRFMoSFVELkdFVF9GSVJTVF9CTElQX0lORk9fSUQoMjgwKSkKICAgICAgICAgICAgICAgICAgICBsb2NhbCB2ZWggPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX1VTSU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgdnBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyh2ZWgsIGZhbHNlKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGRpcyA9IEdldF9kaXN0YW5jZSh2cG9zLCBwb3MsIHRydWUpCiAgICAgICAgICAgICAgICAgICAgZHJhd19zdHJpbmcoZGlzLCAwLjAzLCAwLjE1LCAwLjYsIDQpCiAgICAgICAgICAgICAgICAgICAgaWYgZGlzIDwgNiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKHZlaCwgdHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICB1dGlsLnlpZWxkKCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgdXRpbC50b2FzdCgi5Yiw6L6+55uu55qE5ZywIikKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgUEVELlNFVF9QRURfSU5UT19WRUhJQ0xFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIFBFRC5HRVRfVkVISUNMRV9QRURfSVNfVVNJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSksIC0xKQogICAgICAgICAgICAgICAgUEVELlNFVF9QRURfQ09PUkRTX0tFRVBfVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0YXhpLngsIHRheGkueSwgdGF4aS56LCBmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHV0aWwueWllbGQoMTUwMCkKCiAgICAgICAgICAgIC0t5oyJ5LiL5LqS5Yqo6ZSuCiAgICAgICAgICAgIFBBRC5TRVRfQ09OVFJPTF9WQUxVRV9ORVhUX0ZSQU1FKDAsIDg2LCAxKQogICAgICAgICAgICB3aGlsZSBIVUQuRE9FU19CTElQX0VYSVNUKEhVRC5HRVRfQ0xPU0VTVF9CTElQX0lORk9fSUQoMjgwKSkgZG8KICAgICAgICAgICAgICAgIHV0aWwueWllbGQoKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgbG9jYWwgdmVoID0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19VU0lORyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgICAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTih2ZWgsIGZhbHNlKQogICAgICAgICAgICB1dGlsLnlpZWxkKDUwMCkKCiAgICAgICAgICAgIC0t5YmN5b6A5LmY5a6i55uu55qE5Zyw5L2N572uCiAgICAgICAgICAgIGlmIEhVRC5ET0VTX0JMSVBfRVhJU1QoSFVELkdFVF9DTE9TRVNUX0JMSVBfSU5GT19JRCgxKSkgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgd2F5cG9pbnQgPSBIVUQuR0VUX0JMSVBfQ09PUkRTKEhVRC5HRVRfRklSU1RfQkxJUF9JTkZPX0lEKDEpKQogICAgICAgICAgICAgICAgbG9jYWwgdmVoaWNsZSA9IFBFRC5HRVRfVkVISUNMRV9QRURfSVNfVVNJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKCiAgICAgICAgICAgICAgICBpZiB0YXhpX3dheSA9PSAxIHRoZW4KICAgICAgICAgICAgICAgICAgICBhdXRvX2RyaXZpbmdfdG9fY29vcmQoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgd2F5cG9pbnQueCwgd2F5cG9pbnQueSwgd2F5cG9pbnQueiwgNjAuMCwgMjg4MzYyMSwgMC4wKQogICAgICAgICAgICAgICAgICAgIHdoaWxlIEhVRC5ET0VTX0JMSVBfRVhJU1QoSFVELkdFVF9DTE9TRVNUX0JMSVBfSU5GT19JRCgxKSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgdXRpbC55aWVsZCgpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgUEVELlNFVF9QRURfSU5UT19WRUhJQ0xFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIFBFRC5HRVRfVkVISUNMRV9QRURfSVNfVVNJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSksIC0xKQogICAgICAgICAgICAgICAgICAgIG1lbnUudHJpZ2dlcl9jb21tYW5kcygndHBvYmplY3RpdmUnKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAoKICAgICAgICBlbmQKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAogICAgVEFTSy5DTEVBUl9QRURfVEFTS1NfSU1NRURJQVRFTFkoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgIHV0aWwudG9hc3QoJ+W3sue7k+adn+WHuuenn+i9puW3peS9nCcpCmVuZAoKCi0tLS3mtojpmLLmoJPlpKfllrfmsLQKZnVuY3Rpb24gZmlyZWZpZ2h0aW5nKHBpZCkKICAgIAogICAgbG9jYWwgb2JqZWN0cyA9IHt9CiAgICBmb3IgaSA9IDEsIDExIGRvCiAgICAgICAgbG9jYWwgY29vcmRzID0gcGxheWVycy5nZXRfcG9zaXRpb24ocGlkKQogICAgICAgIG9iamVjdHNbI29iamVjdHMgKyAxXSA9IGVudGl0aWVzLmNyZWF0ZV9vYmplY3QoMjAwODQ2NjQxLCB2My5uZXcoY29vcmRzLnggKyBtYXRoLnJhbmRvbSgtNSwgNSksIGNvb3Jkcy55ICsgbWF0aC5yYW5kb20oLTUsIDUpLCBjb29yZHMueikpCiAgICAgICAgdXRpbC55aWVsZCgpCiAgICBlbmQKICAgIHV0aWwueWllbGQoNTAwKQogICAgZm9yIGksIG9iaiBpbiBpcGFpcnMob2JqZWN0cykgZG8KICAgICAgICBsb2NhbCBvYmpjb29yZHMgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMob2JqKQogICAgICAgIEZJUkUuQUREX0VYUExPU0lPTihvYmpjb29yZHMueCwgb2JqY29vcmRzLnksIG9iamNvb3Jkcy56LCA2NCwgMTAwLCB0cnVlLCB0cnVlLCAwLjUsIHRydWUpCiAgICBlbmQKICAgIHV0aWwueWllbGQoMTMwMDApCiAgICBmb3IgaSA9IDEsICNvYmplY3RzIGRvCiAgICAgICAgZGVsZXRlX2VudGl0eShvYmplY3RzW2ldKQogICAgZW5kCmVuZAoKCi0taW50VG9JcApmdW5jdGlvbiBpbnRUb0lwKG51bSkKICAgIGlwID0gIiIKICAgIGxvY2FsIGludDE2ID0gc3RyaW5nLmZvcm1hdCgiJXgiLCBudW0pCiAgICBmb3IgaSA9IDEsICNpbnQxNiBkbwogICAgICBpZiAwID09IG1hdGguZm1vZChpLCAyKSB0aGVuCiAgICAgICAgaWYgaXAgfj0gIiIgdGhlbgogICAgICAgICAgaXAgPSBpcCAuLiAiLiIgLi4gdmFyX2ludAogICAgICAgIGVsc2UKICAgICAgICAgIGlwID0gdmFyX2ludAogICAgICAgIGVuZAogICAgICBlbHNlCiAgICAgICAgdmFyX2ludCA9IHRvc3RyaW5nKHRvbnVtYmVyKHN0cmluZy5zdWIoaW50MTYsIGksIGkgKyAxKSwgMTYpKQogICAgICBlbmQKICAgIGVuZAogICAgcmV0dXJuIGlwCmVuZAoKLS0tLea2gum4puaeqgpsb2NhbCBncmFmZml0aV9yYWRpdXMgPSA1LS3ljYrlvoQKbG9jYWwgZ3JhZmZpdGlfYnJpZ2h0bmVzcyA9IDEwMC0t5Lqu5bqmCmxvY2FsIGdyYWZmaXRpX2NvbG9ycyA9IHtyID0gMCwgZyA9IDAsIGIgPSAxLCBhID0gMH0tLeminOiJsgpmdW5jdGlvbiBncmFmZml0aV9icmlnaHQodmFsdWUpCiAgICBncmFmZml0aV9icmlnaHRuZXNzID0gdmFsdWUKZW5kCmZ1bmN0aW9uIGdyYWZmaXRpX3JhZGl1KHZhbHVlKQogICAgZ3JhZmZpdGlfcmFkaXVzID0gdmFsdWUKZW5kCmZ1bmN0aW9uIGdyYWZmaXRpX2NvbG9yKHZhbHVlKQogICAgZ3JhZmZpdGlfY29sb3JzID0gdmFsdWUgCmVuZApmdW5jdGlvbiBHcmFmZml0aV93ZWFwb24odG9nZ2xlZCkKICAgIEdyYWZmaXRpID0gdG9nZ2xlZAogICAgbG9jYWwgbGlnaHRfbnVtID0ge30KICAgIHdoaWxlIEdyYWZmaXRpIGRvCiAgICAgICAgbG9jYWwgcG9zID0gdjMubmV3KCkKICAgICAgICBpZiBXRUFQT04uR0VUX1BFRF9MQVNUX1dFQVBPTl9JTVBBQ1RfQ09PUkQoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgcG9zKSBhbmQgbm90IFBFRC5JU19QRURfSU5fQU5ZX1ZFSElDTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgdGhlbgogICAgICAgICAgICBsaWdodF9udW1bI2xpZ2h0X251bSArIDFdID0gcG9zCiAgICAgICAgZW5kCiAgICAgICAgZm9yIGkgPSAxLCAjbGlnaHRfbnVtIGRvCiAgICAgICAgICAgIEdSQVBISUNTLkRSQVdfTElHSFRfV0lUSF9SQU5HRShsaWdodF9udW1baV0ueCwgbGlnaHRfbnVtW2ldLnksIGxpZ2h0X251bVtpXS56LCBncmFmZml0aV9jb2xvcnMuciAqIDI1NSwgZ3JhZmZpdGlfY29sb3JzLmcgKiAyNTUsIGdyYWZmaXRpX2NvbG9ycy5iICogMjU1LCBncmFmZml0aV9yYWRpdXMgLyAxMCwgZ3JhZmZpdGlfYnJpZ2h0bmVzcykKICAgICAgICBlbmQKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAplbmQKCi0tLS3psqjpsbzmnqoKZnVuY3Rpb24gU2hhcmtfZ3VuKCkKICAgIGxvY2FsIHBvcyA9IHYzLm5ldygpCglpZiBXRUFQT04uR0VUX1BFRF9MQVNUX1dFQVBPTl9JTVBBQ1RfQ09PUkQoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgcG9zKSB0aGVuCiAgICAgICAgbG9jYWwgaGFzaCA9IDB4MDZDM0YwNzIKICAgICAgICBsb2NhbCBOUEMgPSBjcmVhdGVfcGVkKDI2LCBoYXNoLCBwb3MueCwgcG9zLnksIHBvcy56LCAwKQogICAgICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKE5QQywgdHJ1ZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9ST1RBVElPTihOUEMsIDkwLCAwLCAwLCAxLCB0cnVlKQogICAgICAgIEZJUkUuQUREX0VYUExPU0lPTihwb3MueCwgcG9zLnksIHBvcy56LCA0LCAxMDAsIHRydWUsIGZhbHNlLCAxLCBmYWxzZSkKICAgICAgICBGSVJFLkFERF9FWFBMT1NJT04ocG9zLngsIHBvcy55LCBwb3MueiwgMTMsIDEsIHRydWUsIGZhbHNlLCAwLCBmYWxzZSkKICAgIGVuZAplbmQKLS3psqjpsbzlkIPmjonnjqnlrrYKZnVuY3Rpb24gU2hhcmtfZWF0aW5nKHBpZCkKICAgIAogICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpKQogICAgbG9jYWwgaGFzaCA9IDB4MDZDM0YwNzIKICAgIGxvY2FsIE5QQyA9IGNyZWF0ZV9wZWQoMjYsIGhhc2gsIHBvcy54LCBwb3MueSwgcG9zLnosIDApCiAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihOUEMsIHRydWUpCiAgICBFTlRJVFkuU0VUX0VOVElUWV9ST1RBVElPTihOUEMsIDkwLCAwLCAwLCAxLCB0cnVlKQogICAgRklSRS5BRERfRVhQTE9TSU9OKHBvcy54LCBwb3MueSwgcG9zLnosIDQsIDEwMCwgdHJ1ZSwgZmFsc2UsIDEsIGZhbHNlKQogICAgRklSRS5BRERfRVhQTE9TSU9OKHBvcy54LCBwb3MueSwgcG9zLnosIDEzLCAxLCB0cnVlLCBmYWxzZSwgMCwgZmFsc2UpCmVuZAoKLS0tLeebtOWNh+acuuiHquWKqOeehOWHhuWZqApmdW5jdGlvbiBoZWxpY29wdGVyX2F1dG9tYXRpY19zaWdodCgpCiAgICBpZiBQRUQuSVNfUEVEX0lOX0FOWV9WRUhJQ0xFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUpIHRoZW4KICAgICAgICBsb2NhbCB2ZWggPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX1VTSU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICAgICAgaWYgVkVISUNMRS5HRVRfVkVISUNMRV9DTEFTUyh2ZWgpID09IDE1IG9yIFZFSElDTEUuR0VUX1ZFSElDTEVfQ0xBU1ModmVoKSA9PSAxNiB0aGVuIAogICAgICAgICAgICBsb2NhbCBwZWQgPSBnZXRfY2xvc2VzdF9wbGF5ZXIoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMjAwKQogICAgICAgICAgICBsb2NhbCBwaWQgPSBORVRXT1JLLk5FVFdPUktfR0VUX1BMQVlFUl9JTkRFWF9GUk9NX1BFRChwZWQpCiAgICAgICAgICAgIGlmIFBFRC5JU19QRURfQV9QTEFZRVIocGVkKSBhbmQgbm90IHBsYXllcnMuaXNfaW5faW50ZXJpb3IocGlkKSBhbmQgbm90IFBFRC5JU19QRURfREVBRF9PUl9EWUlORyhwZWQsIHRydWUpIHRoZW4KICAgICAgICAgICAgICAgIGRyYXdfc3RyaW5nKCLlvZPliY3nnoTlh4bnjqnlrrY6ICIgLi4gUExBWUVSLkdFVF9QTEFZRVJfTkFNRShwaWQpLCAwLjAzLCAwLjEsIDAuNCwgMSkKICAgICAgICAgICAgICAgIGlmIFBBRC5JU19DT05UUk9MX1BSRVNTRUQoMCwyMikgb3IgUEFELklTX0NPTlRST0xfUFJFU1NFRCgwLDI1KSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgcGNvb3JkcyA9IFBFRC5HRVRfUEVEX0JPTkVfQ09PUkRTKHBlZCwgMjQ4MTcsIDAsIDAsIDApCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgbXljb29yZHMgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgIAogICAgICAgICAgICAgICAgICAgIGxvY2FsIGxvb2sgPSB2My5sb29rQXQobXljb29yZHMsIHBjb29yZHMpCiAgICAgICAgICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04odmVoLCBsb29rLngsIGxvb2sueSwgbG9vay56LCAxLCB0cnVlKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZAoKLS0tLei9veWFt+WvvOW8ueiHqueehApmdW5jdGlvbiB2ZWhfbWlzc2lsZV9haW1iaXQoKQogICAgaWYgUEVELklTX1BFRF9JTl9BTllfVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlKSB0aGVuCiAgICAgICAgbG9jYWwgcGVkID0gZ2V0X2Nsb3Nlc3RfcGxheWVyKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDIwMCkKICAgICAgICBsb2NhbCBwaWQgPSBORVRXT1JLLk5FVFdPUktfR0VUX1BMQVlFUl9JTkRFWF9GUk9NX1BFRChwZWQpCgogICAgICAgIGxvY2FsIG15Y29vcmRzID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksZmFsc2UpCiAgICAgICAgbG9jYWwgcGNvb3JkcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhwZWQsZmFsc2UpCiAgICAgICAgbG9jYWwgZGlzdCA9IEdldF9kaXN0YW5jZShteWNvb3JkcywgcGNvb3JkcywgdHJ1ZSkKCiAgICAgICAgaWYgUEVELklTX1BFRF9BX1BMQVlFUihwZWQpIGFuZCBub3QgcGxheWVycy5pc19pbl9pbnRlcmlvcihwaWQpIGFuZCBub3QgUEVELklTX1BFRF9ERUFEX09SX0RZSU5HKHBlZCwgdHJ1ZSkgYW5kIGRpc3QgPCAyMDAuMCB0aGVuCiAgICAgICAgICAgIGRyYXdfc3RyaW5nKCLlvZPliY3nnoTlh4bnjqnlrrY6ICIgLi4gUExBWUVSLkdFVF9QTEFZRVJfTkFNRShwaWQpLCAwLjAzLCAwLjEsIDAuNSwgMSkKICAgICAgICAgICAgaWYgUEVELklTX1BFRF9JTl9BTllfUExBTkUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgdGhlbgogICAgICAgICAgICAgICAgLS3lnKjpo57mnLrlhoXlj6/kvb/nlKjnqbrmoLzlkozpvKDmoIflj7PplK7lj5HlsITlr7zlvLkKICAgICAgICAgICAgICAgIGlmIG5vdCBQRUQuSVNfUEVEX0RFQURfT1JfRFlJTkcocGVkKSBhbmQgKFBBRC5JU19DT05UUk9MX1BSRVNTRUQoMCwgNzApIG9yIFBBRC5JU19DT05UUk9MX1BSRVNTRUQoMCwgMjIpKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCBmYWxzZSkKICAgICAgICAgICAgICAgICAgICBWRUhJQ0xFMS5TRVRfVkVISUNMRV9TSE9PVF9BVF9UQVJHRVQoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgcGVkLCBwb3MueCwgcG9zLnksIHBvcy56KQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGlmIG5vdCBQRUQuSVNfUEVEX0RFQURfT1JfRFlJTkcocGVkKSBhbmQgUEFELklTX0NPTlRST0xfUFJFU1NFRCgwLCAyNSkgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSwgZmFsc2UpCiAgICAgICAgICAgICAgICAgICAgVkVISUNMRTEuU0VUX1ZFSElDTEVfU0hPT1RfQVRfVEFSR0VUKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHBlZCwgcG9zLngsIHBvcy55LCBwb3MueikKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICBlbmQKCmVuZAoKCi0tLS1OUEPmnYAKZnVuY3Rpb24gTlBDX2tpbGwocGlkKQogICAgCiAgICBsb2NhbCBoYXNoID0gdXRpbC5qb2FhdCgibXBfbV93ZWFwZXhwXzAxIikKICAgIHJlcXVlc3RfbW9kZWwoaGFzaCkKICAgIGZvciBpID0gMSwgMTAgZG8KICAgICAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkpCiAgICAgICAgbG9jYWwgUGVkcyA9IFBFRC5DUkVBVEVfUEVEKDQsIGhhc2gsIHBvcy54ICsgbWF0aC5yYW5kb20oLTIwLCAyMCksIHBvcy55ICsgbWF0aC5yYW5kb20oLTIwLCAyMCksIHBvcy56LCAxLjAsIHRydWUsIGZhbHNlKQogICAgICAgIFdFQVBPTi5HSVZFX0RFTEFZRURfV0VBUE9OX1RPX1BFRChQZWRzLCAweDQ3NkJGMTU1LCAwLCB0cnVlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0hFQUxUSChQZWRzLCA0MTAsIDApCiAgICAgICAgUEVELlNFVF9QRURfQ09NQkFUX0FCSUxJVFkoUGVkcywgMikKICAgICAgICBQRUQuU0VUX1BFRF9DT01CQVRfQVRUUklCVVRFUyhQZWRzLCA1LCB0cnVlKQogICAgICAgIFRBU0suVEFTS19DT01CQVRfUEVEKFBlZHMsIFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCAxLCAxNikKICAgICAgICBQRUQuU0VUX1BFRF9SRUxBVElPTlNISVBfR1JPVVBfSEFTSChQZWRzLCAweDg0RENGQUFEKQogICAgZW5kCmVuZAoKLS3nvKnlsI9OUEMKZnVuY3Rpb24gc2hyaW5rX3BlZHMob24pCiAgICBpZiBvbiB0aGVuCQogICAgICAgIGxvY2FsIHBlZHMgPSBlbnRpdGllcy5nZXRfYWxsX3BlZHNfYXNfaGFuZGxlcygpCiAgICAgICAgZm9yIGkgPSAxLCAjcGVkcyBkbwogICAgICAgICAgICBpZiBub3QgUEVELklTX1BFRF9BX1BMQVlFUihwZWRzW2ldKSB0aGVuCiAgICAgICAgICAgICAgICBORVRXT1JLLk5FVFdPUktfUkVRVUVTVF9DT05UUk9MX09GX0VOVElUWShwZWRzW2ldKQogICAgICAgICAgICAgICAgUEVELlNFVF9QRURfQ09ORklHX0ZMQUcocGVkc1tpXSwgMjIzLCB0cnVlKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICBsb2NhbCBwZWRzID0gZW50aXRpZXMuZ2V0X2FsbF9wZWRzX2FzX2hhbmRsZXMoKQogICAgICAgIGZvciBpID0gMSwgI3BlZHMgZG8KICAgICAgICAgICAgaWYgbm90IFBFRC5JU19QRURfQV9QTEFZRVIocGVkc1tpXSkgdGhlbgogICAgICAgICAgICAgICAgTkVUV09SSy5ORVRXT1JLX1JFUVVFU1RfQ09OVFJPTF9PRl9FTlRJVFkocGVkc1tpXSkKICAgICAgICAgICAgICAgIFBFRC5TRVRfUEVEX0NPTkZJR19GTEFHKHBlZHNbaV0sIDIyMywgZmFsc2UpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZAoKLS0tLeenu+mZpOWwuOS9kwpmdW5jdGlvbiBSZW1vdmVfZGVhZF9ib2R5KCkKICAgIGZvciBfLCBwZWQgaW4gaXBhaXJzKGVudGl0aWVzLmdldF9hbGxfcGVkc19hc19oYW5kbGVzKCkpIGRvCiAgICAgICAgaWYgRU5USVRZLklTX0VOVElUWV9ERUFEKHBlZCwgdHJ1ZSkgdGhlbgogICAgICAgICAgICByZXF1ZXN0X2NvbnRyb2wocGVkKQogICAgICAgICAgICBkZWxldGVfZW50aXR5KHBlZCkKICAgICAgICBlbmQKICAgIGVuZAplbmQKLS0tLeenu+mZpOS4p+WwuApmdW5jdGlvbiBSZW1vdmVfem9tYmllcygpCiAgICBmb3IgXywgcGVkIGluIGlwYWlycyhlbnRpdGllcy5nZXRfYWxsX3BlZHNfYXNfaGFuZGxlcygpKSBkbwogICAgICAgIGlmIEVOVElUWS5HRVRfRU5USVRZX01PREVMKHBlZCkgPT0gLTE0MDQzNTMyNzQgdGhlbgogICAgICAgICAgICByZXF1ZXN0X2NvbnRyb2wocGVkKQogICAgICAgICAgICBkZWxldGVfZW50aXR5KHBlZCkKICAgICAgICBlbmQKICAgIGVuZAplbmQKLS0tLee7meS6iE5QQ+aJgOacieatpuWZqApmdW5jdGlvbiBnaXZlX0FsbE5QQ193ZWFwb24oKQogICAgZm9yIF8sIHBlZCBpbiBpcGFpcnMoZW50aXRpZXMuZ2V0X2FsbF9wZWRzX2FzX2hhbmRsZXMoKSkgZG8KICAgICAgICBpZiBub3QgUEVELklTX1BFRF9BX1BMQVlFUihwZWQpIHRoZW4KICAgICAgICAgICAgZ2l2ZV9hbGxfd2VhcG9uKHBlZCkKICAgICAgICBlbmQKICAgIGVuZAplbmQKLS0tLeenu+mZpE5QQ+aJgOacieatpuWZqApmdW5jdGlvbiByZW1vdmVfQWxsTlBDX3dhZXBvbigpCiAgICBmb3IgXywgcGVkIGluIGlwYWlycyhlbnRpdGllcy5nZXRfYWxsX3BlZHNfYXNfaGFuZGxlcygpKSBkbwogICAgICAgIGlmIG5vdCBQRUQuSVNfUEVEX0FfUExBWUVSKHBlZCkgdGhlbgogICAgICAgICAgICByZW1vdmVfYWxsX3dlYXBvbihwZWQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCi0tLS1OUEPml6Dop4bnjqnlrrYKZnVuY3Rpb24gTlBDX0lnbm9yZV9wbGF5ZXIoKQogICAgUExBWUVSLlNFVF9QT0xJQ0VfSUdOT1JFX1BMQVlFUihQTEFZRVIuUExBWUVSX0lEKCksIHRydWUpCiAgICBQTEFZRVIuU0VUX0VWRVJZT05FX0lHTk9SRV9QTEFZRVIoUExBWUVSLlBMQVlFUl9JRCgpLCB0cnVlKQogICAgUExBWUVSLlNFVF9QTEFZRVJfQ0FOX0JFX0hBU1NMRURfQllfR0FOR1MoUExBWUVSLlBMQVlFUl9JRCgpLCBmYWxzZSkKICAgIFBMQVlFUi5TRVRfSUdOT1JFX0xPV19QUklPUklUWV9TSE9DS0lOR19FVkVOVFMoUExBWUVSLlBMQVlFUl9JRCgpLCB0cnVlKQplbmQKLS3lhrfpnZlOUEMKZnVuY3Rpb24gY2FsbV9hbGxfbnBjKCkKICAgIGZvciBfLCBwZWQgaW4gaXBhaXJzKGVudGl0aWVzLmdldF9hbGxfcGVkc19hc19oYW5kbGVzKCkpIGRvCiAgICAgICAgY2FsbV9wZWQocGVkLCB0cnVlKQogICAgZW5kCmVuZAoKLS0tLeaVjOaEj05QQwpmdW5jdGlvbiBlbm1pdHlfbnBjKCkKICAgIGZvciBpLCBwZWQgaW4gcGFpcnMoZW50aXRpZXMuZ2V0X2FsbF9wZWRzX2FzX2hhbmRsZXMoKSkgZG8KICAgICAgICBpZiBub3QgUEVELklTX1BFRF9BX1BMQVlFUihwZWQpIGFuZCBFTlRJVFkuRE9FU19FTlRJVFlfRVhJU1QocGVkKSB0aGVuCiAgICAgICAgICAgIFRBU0suVEFTS19DT01CQVRfUEVEKHBlZCwgUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMCwgMTYpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgoKCi0tLS3kvKroo4UKbG9jYWwgZGlzZ3Vpc2Vfb2JqZWN0ID0gMQpmdW5jdGlvbiBwbGF5ZXJfZGlzZ3Vpc2Vfc2VsZWN0KGluZGV4KQogICAgZGlzZ3Vpc2Vfb2JqZWN0ID0gaW5kZXgKZW5kCmxvY2FsIGNhbW91b2JqZWN0ID0gMApmdW5jdGlvbiBwbGF5ZXJfZGlzZ3Vpc2Uoc3RhdGUpCiAgICBkaXNndWlzZV9zdGF0ZSA9IHN0YXRlIAogICAgd2hpbGUgZGlzZ3Vpc2Vfc3RhdGUgZG8KICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9BTFBIQShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwLCBmYWxzZSkKICAgICAgICBpZiBkaXNndWlzZV9vYmplY3R0IH49IGRpc2d1aXNlX29iamVjdCBhbmQgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKGNhbW91b2JqZWN0KSB0aGVuCiAgICAgICAgICAgIGRlbGV0ZV9lbnRpdHkoY2Ftb3VvYmplY3QpCiAgICAgICAgZW5kCiAgICAgICAgZGlzZ3Vpc2Vfb2JqZWN0dCA9IGRpc2d1aXNlX29iamVjdAogICAgICAgIGxvY2FsIG9iamVjdF9oYXNoID0gTUlTQy5HRVRfSEFTSF9LRVkoZGlzZ3Vpc2Vfb2JqZWN0c1tkaXNndWlzZV9vYmplY3R0XSkKICAgICAgICBsb2NhbCBwbGF5ZXJfcG9zID0gcGxheWVycy5nZXRfcG9zaXRpb24oUExBWUVSLlBMQVlFUl9JRCgpKQogICAgICAgIGlmIGNhbW91b2JqZWN0ID09IG5pbCBvciBub3QgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKGNhbW91b2JqZWN0KSB0aGVuCiAgICAgICAgICAgIGNhbW91b2JqZWN0ID0gZW50aXRpZXMuY3JlYXRlX29iamVjdChvYmplY3RfaGFzaCwgcGxheWVyX3BvcykKICAgICAgICBlbmQKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT0xMSVNJT04oY2Ftb3VvYmplY3QsIGZhbHNlLCBmYWxzZSkKICAgICAgICBwbGF5ZXJfcm90ID0gRU5USVRZLkdFVF9FTlRJVFlfUk9UQVRJT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgNSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFMoY2Ftb3VvYmplY3QsIHBsYXllcl9wb3MueCwgcGxheWVyX3Bvcy55LCBwbGF5ZXJfcG9zLnogLSAxLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9ST1RBVElPTihjYW1vdW9iamVjdCwgMCwgMCwgcGxheWVyX3JvdC56LCAxLCB0cnVlKQogICAgICAgIHV0aWwueWllbGQoKQogICAgZW5kCiAgICBkZWxldGVfZW50aXR5KGNhbW91b2JqZWN0KQogICAgRU5USVRZLlNFVF9FTlRJVFlfQUxQSEEoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMjU1LCBmYWxzZSkKZW5kCgoKCgotLS0t5YiX6L2m6YCJ6aG5CmZ1bmN0aW9uIGdldF9jbG9zZXN0X3RyYWluKCkKICAgIGxvY2FsIHZlaGljbGVzID0gZW50aXRpZXMuZ2V0X2FsbF92ZWhpY2xlc19hc19oYW5kbGVzKCkKICAgIGZvciBrLCB2ZWggaW4gcGFpcnModmVoaWNsZXMpIGRvCiAgICAgICAgaWYgRU5USVRZLkdFVF9FTlRJVFlfTU9ERUwodmVoKSA9PSAxMDMwNDAwNjY3IHRoZW4KICAgICAgICAgICAgcmVxdWVzdF9jb250cm9sKHZlaCkKICAgICAgICAgICAgcmV0dXJuIHZlaAogICAgICAgIGVuZAogICAgZW5kCiAgICB1dGlsLnRvYXN0KCLmib7kuI3liLDpmYTov5HnmoTngavovaYiKQogICAgcmV0dXJuIDAKZW5kCmZ1bmN0aW9uIHNwYXduX3RyYWluKHZhcmlhdGlvbiwgcG9zKQogICAgbG9jYWwgdHJhaW5tb2RlbHMgPSB7dXRpbC5qb2FhdCgibWV0cm90cmFpbiIpLCB1dGlsLmpvYWF0KCJmcmVpZ2h0IiksIHV0aWwuam9hYXQoImZyZWlnaHRjYXIiKSwgdXRpbC5qb2FhdCgiZnJlaWdodGNvbnQxIiksIHV0aWwuam9hYXQoImZyZWlnaHRjb250MiIpLCB1dGlsLmpvYWF0KCJmcmVpZ2h0Z3JhaW4iKSwgdXRpbC5qb2FhdCgidGFua2VyY2FyIil9CiAgICBmb3IgXywgbW9kZWwgaW4gaXBhaXJzKHRyYWlubW9kZWxzKSBkbwogICAgICAgIHJlcXVlc3RfbW9kZWwobW9kZWwpCiAgICBlbmQKICAgIGxvY2FsIHRyYWluID0gVkVISUNMRS5DUkVBVEVfTUlTU0lPTl9UUkFJTih2YXJpYXRpb24sIHBvcy54LCBwb3MueSwgcG9zLnosIDApCiAgICBsb2NhbCBwb3NUcmFpbiA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyh0cmFpbikKICAgIGxvY2FsIG5ldGlkID0gTkVUV09SSy5ORVRXT1JLX0dFVF9ORVRXT1JLX0lEX0ZST01fRU5USVRZKHZlaCkKICAgIE5FVFdPUksuTkVUV09SS19SRVFVRVNUX0NPTlRST0xfT0ZfTkVUV09SS19JRChuZXRpZCkKICAgIE5FVFdPUksuU0VUX05FVFdPUktfSURfQ0FOX01JR1JBVEUobmV0aWQsIGZhbHNlKQogICAgdGVsZXBvcnQocG9zVHJhaW4ueCwgcG9zVHJhaW4ueSwgcG9zVHJhaW4ueiwgZmFsc2UpCiAgICB1dGlsLnRvYXN0KHN0cmluZy5mb3JtYXQoIueBq+i9pueUn+aIkOS6jiAoJS4xZiwgJS4xZiwgJS4xZikiLCBwb3NUcmFpbi54LCBwb3NUcmFpbi55LCBwb3NUcmFpbi56KSkKZW5kCgoKCgoKCi0tLS3pmLvmraLnjqnlrrbop4LnnIsKZnVuY3Rpb24gYmxvY2tfc3BlY3RhdGUoKQogICAgZm9yIF8sIHBpZCBpbiBwbGF5ZXJzLmxpc3QoZmFsc2UsIHRydWUsIHRydWUpIGRvCiAgICAgICAgbG9jYWwgcGVkX2Rpc3QgPSB2My5kaXN0YW5jZShwbGF5ZXJzLmdldF9wb3NpdGlvbihQTEFZRVIuUExBWUVSX0lEKCkpLCBwbGF5ZXJzLmdldF9wb3NpdGlvbihwaWQpKQogICAgICAgIGlmIHYzLmRpc3RhbmNlKHBsYXllcnMuZ2V0X3Bvc2l0aW9uKFBMQVlFUi5QTEFZRVJfSUQoKSksIHBsYXllcnMuZ2V0X2NhbV9wb3MocGlkKSkgPCAyNS4wIGFuZCBwZWRfZGlzdCA+IDMwLjAgb3IgcGxheWVycy5nZXRfc3BlY3RhdGVfdGFyZ2V0KHBpZCkgPT0gUExBWUVSLlBMQVlFUl9JRCgpIHRoZW4KICAgICAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJ0aW1lb3V0ICIgLi4gcGxheWVycy5nZXRfbmFtZShwaWQpIC4uICIgb24iKQogICAgICAgICAgICBsb2NhbCBwb3MgPSBwbGF5ZXJzLmdldF9wb3NpdGlvbihQTEFZRVIuUExBWUVSX0lEKCkpCiAgICAgICAgICAgIGlmIHYzLmRpc3RhbmNlKHBvcywgcGxheWVycy5nZXRfY2FtX3BvcyhwaWQpKSA8IDI1LjAgdGhlbgogICAgICAgICAgICAgICAgcmVwZWF0IAogICAgICAgICAgICAgICAgICAgIHV0aWwueWllbGQoKQogICAgICAgICAgICAgICAgdW50aWwgdjMuZGlzdGFuY2UocG9zLCBwbGF5ZXJzLmdldF9jYW1fcG9zKHBpZCkpID4gNTAuMCAKICAgICAgICAgICAgICAgIG1lbnUudHJpZ2dlcl9jb21tYW5kcygidGltZW91dCAiIC4uIHBsYXllcnMuZ2V0X25hbWUocGlkKSAuLiAiIG9mZiIpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZAoKCi0tLS3lhrvnu5PpgInpobkKbG9jYWwgZnJvemVuX3ZlaGljbGVzID0ge30KZnVuY3Rpb24gdXBkYXRlX2Zyb3plbl92ZWhpY2xlcygpCiAgICBmb3IgXywgZnJvemVuX3ZlaGljbGUgaW4gcGFpcnMoZnJvemVuX3ZlaGljbGVzKSBkbwogICAgICAgIGlmIEVOVElUWS5ET0VTX0VOVElUWV9FWElTVChmcm96ZW5fdmVoaWNsZS52ZWhpY2xlKSB0aGVuCiAgICAgICAgICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKGZyb3plbl92ZWhpY2xlLnZlaGljbGUsIHRydWUpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCmZ1bmN0aW9uIHJlZnJlc2hfZnJvemVuX3ZlaGljbGVzX21lbnVfbGlzdCgpCiAgICBtZW51LmRlbGV0ZShmcm96ZW5fdmVoaWNsZXNfbWVudV9saXN0KQogICAgZnJvemVuX3ZlaGljbGVzX21lbnVfbGlzdCA9IG1lbnUubGlzdCh2ZiwgIuW3suWGu+e7k+eahOi9veWFtyIpCiAgICBmb3IgaW5kZXgsIGZyb3plbl92ZWhpY2xlIGluIHBhaXJzKGZyb3plbl92ZWhpY2xlcykgZG8KICAgICAgICBtZW51LmFjdGlvbihmcm96ZW5fdmVoaWNsZXNfbWVudV9saXN0LCBmcm96ZW5fdmVoaWNsZS5uYW1lLCB7InVuZnJlZXplIi4uaW5kZXh9LCAi54K55Ye76Kej5Ya76L295YW3IiwgZnVuY3Rpb24oKQogICAgICAgICAgICB0YWJsZS5yZW1vdmUoZnJvemVuX3ZlaGljbGVzLCBpbmRleCkKICAgICAgICAgICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04oZnJvemVuX3ZlaGljbGUudmVoaWNsZSwgZmFsc2UpCiAgICAgICAgICAgIHJlZnJlc2hfZnJvemVuX3ZlaGljbGVzX21lbnVfbGlzdCgpCiAgICAgICAgZW5kKQogICAgZW5kCmVuZApmdW5jdGlvbiBhZGRfZnJvemVuX3ZlaGljbGUodmVoaWNsZSkKICAgIGZvciBpbmRleCwgZnJvemVuX3ZlaGljbGUgaW4gcGFpcnMoZnJvemVuX3ZlaGljbGVzKSBkbwogICAgICAgIGlmIGZyb3plbl92ZWhpY2xlLnZlaGljbGUgPT0gdmVoaWNsZSB0aGVuCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAogICAgZW5kCiAgICBsb2NhbCBtb2RlbCA9IEVOVElUWS5HRVRfRU5USVRZX01PREVMKHZlaGljbGUpCiAgICBsb2NhbCBuYW1lID0gVkVISUNMRS5HRVRfRElTUExBWV9OQU1FX0ZST01fVkVISUNMRV9NT0RFTChtb2RlbCkKICAgIHRhYmxlLmluc2VydChmcm96ZW5fdmVoaWNsZXMsIHtuYW1lPW5hbWUsdmVoaWNsZT12ZWhpY2xlfSkKICAgIHJlZnJlc2hfZnJvemVuX3ZlaGljbGVzX21lbnVfbGlzdCgpCiAgICB1cGRhdGVfZnJvemVuX3ZlaGljbGVzKCkKZW5kCgoKCgotLeWKoOi9vemFjee9ruWSjOS/neWtmOmFjee9rgpsb2NhbCBsdWFDb25maWdfcGF0aCA9IGZpbGVzeXN0ZW0uc3RhbmRfZGlyKCkgLi4gJ1Nha3VyYUNvbmZpZy5qc29uJwppZiBmaWxlc3lzdGVtLmV4aXN0cyhsdWFDb25maWdfcGF0aCkgdGhlbgogICAgbHVhQ29uZmlnID0gZ2V0X2luZm9fZnJvbV9qc29uZmlsZShsdWFDb25maWdfcGF0aCkKZWxzZQogICAgbHVhQ29uZmlnID0ge30KZW5kCmZ1bmN0aW9uIHNhdmVfY29uZmlnKCkKICAgIGxvY2FsIGFjdGl2ZSA9IHt9CiAgICBmb3IgaywgdiBpbiBwYWlycyhMdWFDb25maWdOYW1lKSBkbwogICAgICAgIGFjdGl2ZVt2XSA9IG1lbnUuZ2V0X3ZhbHVlKF9HW3ZdKQogICAgZW5kCiAgICBsb2NhbCBjb25maWdfdHh0ID0gVGFibGVUb0pzb24oYWN0aXZlKQogICAgLS1UYWJsZVRvSnNvbihhY3RpdmUpCiAgICBsb2NhbCBmaWxlID0gaW8ub3BlbihsdWFDb25maWdfcGF0aCwgJ3cnKQogICAgZmlsZTp3cml0ZShjb25maWdfdHh0KQogICAgZmlsZTpjbG9zZSgpCiAgICBub3RpZmljYXRpb24oIn55fn5ib2xkfumFjee9ruW3suS/neWtmCIsIEh1ZENvbG91ci5ibHVlKQplbmQKZnVuY3Rpb24gc2V0X21lbnVfdmFsdWUobWVudV9uYW1lLCB2YWx1ZSwgZGVmYXV0KQogICAgaWYgdmFsdWUgfj0gbmlsIHRoZW4KICAgICAgICBtZW51LnNldF92YWx1ZShtZW51X25hbWUsIHZhbHVlKQogICAgZWxzZQogICAgICAgIG1lbnUuc2V0X3ZhbHVlKG1lbnVfbmFtZSwgZGVmYXV0KQogICAgZW5kCmVuZAoKCi0tLS3lvqrnjq/muIXnkIblrp7kvZMKZnVuY3Rpb24gbG9vcF9jbGVhcl9lbnRpdHkoKQogICAgZm9yIGksIGVudGl0eSBpbiBwYWlycyhlbnRpdGllcy5nZXRfYWxsX3ZlaGljbGVzX2FzX2hhbmRsZXMoKSkgZG8KICAgICAgICByZXF1ZXN0X2NvbnRyb2woZW50aXR5KQogICAgICAgIGRlbGV0ZV9lbnRpdHkoZW50aXR5KSAKICAgIGVuZAogICAgZm9yIGksIGVudGl0eSBpbiBwYWlycyhlbnRpdGllcy5nZXRfYWxsX3BlZHNfYXNfaGFuZGxlcygpKSBkbwogICAgICAgIHJlcXVlc3RfY29udHJvbChlbnRpdHkpCiAgICAgICAgZGVsZXRlX2VudGl0eShlbnRpdHkpIAogICAgZW5kCiAgICBmb3IgaSwgZW50aXR5IGluIHBhaXJzKGVudGl0aWVzLmdldF9hbGxfb2JqZWN0c19hc19oYW5kbGVzKCkpIGRvCiAgICAgICAgcmVxdWVzdF9jb250cm9sKGVudGl0eSkKICAgICAgICBkZWxldGVfZW50aXR5KGVudGl0eSkgCiAgICBlbmQKZW5kCgoKLS0tLeS4lueVjOmHjeWKmwpmdW5jdGlvbiByZXF1ZXN0X2NvbnRyb2xfb2ZfdGFibGVfb25jZSh0YmwpCiAgICBmb3IgaW5kZXgsIGVudGl0eSBpbiBpcGFpcnModGJsKSBkbwogICAgICAgIE5FVFdPUksuTkVUV09SS19SRVFVRVNUX0NPTlRST0xfT0ZfRU5USVRZKGVudGl0eSkKICAgIGVuZAplbmQKZnVuY3Rpb24gV29ybGRfZ3Jhdml0eShvcHRpb25faW5kZXgpCiAgICBncmF2aXR5X2N1cnJlbnRfaW5kZXggPSBvcHRpb25faW5kZXgKICAgIGlmIG9wdGlvbl9pbmRleCB+PSAxIHRoZW4KICAgICAgICB3aGlsZSBncmF2aXR5X2N1cnJlbnRfaW5kZXggPT0gb3B0aW9uX2luZGV4IGRvCiAgICAgICAgICAgIHJlcXVlc3RfY29udHJvbF9vZl90YWJsZV9vbmNlKGVudGl0aWVzLmdldF9hbGxfdmVoaWNsZXNfYXNfaGFuZGxlcygpKQogICAgICAgICAgICByZXF1ZXN0X2NvbnRyb2xfb2ZfdGFibGVfb25jZShlbnRpdGllcy5nZXRfYWxsX29iamVjdHNfYXNfaGFuZGxlcygpKQogICAgICAgICAgICByZXF1ZXN0X2NvbnRyb2xfb2ZfdGFibGVfb25jZShlbnRpdGllcy5nZXRfYWxsX3BlZHNfYXNfaGFuZGxlcygpKQogICAgICAgICAgICByZXF1ZXN0X2NvbnRyb2xfb2ZfdGFibGVfb25jZShlbnRpdGllcy5nZXRfYWxsX3BpY2t1cHNfYXNfaGFuZGxlcygpKQogICAgICAgICAgICBNSVNDLlNFVF9HUkFWSVRZX0xFVkVMKG9wdGlvbl9pbmRleCAtIDEpCiAgICAgICAgICAgIHV0aWwueWllbGQoKQogICAgICAgIGVuZAogICAgZWxzZQogICAgICAgIE1JU0MuU0VUX0dSQVZJVFlfTEVWRUwob3B0aW9uX2luZGV4IC0gMSkKICAgIGVuZAplbmQKCi0tLS3kuIfosaHlpKnlvoEKZnVuY3Rpb24gdmllbnRpYW5lX2V4cGxvc2lvbigpCiAgICBpZiBQQUQuSVNfRElTQUJMRURfQ09OVFJPTF9KVVNUX1BSRVNTRUQoMCwgNDYpIHRoZW4KICAgICAgICBsb2NhbCByYW5nZSA9IDUKICAgICAgICB1dGlsLmNyZWF0ZV90aWNrX2hhbmRsZXIoZnVuY3Rpb24oKQogICAgICAgICAgICBpZiByYW5nZSA8IDQwIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgICAgICAgICAgICAgIEdSQVBISUNTLkRSQVdfTUFSS0VSX1NQSEVSRShwb3MueCwgcG9zLnksIHBvcy56LCByYW5nZSwgMjIzLCAyNTUsIDI0NSwgMC41KQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQoKICAgICAgICB3aGlsZSByYW5nZSA8PSA0MCBkbwogICAgICAgICAgICByYW5nZSA9IHJhbmdlICsgMC41CgogICAgICAgICAgICBsb2NhbCBwbGF5ZXJfcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKQogICAgICAgICAgICBmb3IgXywgdmVoaWNsZSBpbiBwYWlycyhlbnRpdGllcy5nZXRfYWxsX3ZlaGljbGVzX2FzX2hhbmRsZXMoKSkgZG8KICAgICAgICAgICAgICAgIGxvY2FsIHZwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFModmVoaWNsZSwgZmFsc2UpCiAgICAgICAgICAgICAgICBpZiB2My5kaXN0YW5jZShwbGF5ZXJfcG9zLCB2cG9zKSA8PSByYW5nZSBhbmQgRU5USVRZLkdFVF9FTlRJVFlfSEVBTFRIKHZlaGljbGUpID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgRklSRS5BRERfRVhQTE9TSU9OKHZwb3MueCwgdnBvcy55LCB2cG9zLnosIDAsIDEwMCwgdHJ1ZSwgZmFsc2UsIDEsIGZhbHNlKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBmb3IgXywgcGVkIGluIHBhaXJzKGVudGl0aWVzLmdldF9hbGxfcGVkc19hc19oYW5kbGVzKCkpIGRvCiAgICAgICAgICAgICAgICBsb2NhbCBwcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHBlZCwgZmFsc2UpCiAgICAgICAgICAgICAgICBpZiAodjMuZGlzdGFuY2UocGxheWVyX3BvcywgcHBvcykgPD0gcmFuZ2UpIGFuZCBub3QgUEVELklTX1BFRF9BX1BMQVlFUihwZWQpIGFuZCBFTlRJVFkuR0VUX0VOVElUWV9IRUFMVEgocGVkKSA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgIEZJUkUuQUREX0VYUExPU0lPTihwcG9zLngsIHBwb3MueSwgcHBvcy56LCAwLCAxMDAsIHRydWUsIGZhbHNlLCAxLCBmYWxzZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHV0aWwueWllbGQoKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKLS0tLeiHquWKqOe/u+i9rApmdW5jdGlvbiB2ZWhpY2xlX2F1dG9tYXRpY2FsbHkoKQogICAgbG9jYWwgcGxheWVyX3ZlaGljbGUgPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0lOKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKQogICAgbG9jYWwgcm90YXRpb24gPSBDQU0uR0VUX0dBTUVQTEFZX0NBTV9ST1QoMikKICAgIGxvY2FsIGhlYWRpbmcgPSB2My5nZXRIZWFkaW5nKHYzLm5ldyhyb3RhdGlvbikpCiAgICBsb2NhbCB2ZWhpY2xlX2Rpc3RhbmNlX3RvX2dyb3VuZCA9IEVOVElUWS5HRVRfRU5USVRZX0hFSUdIVF9BQk9WRV9HUk9VTkQocGxheWVyX3ZlaGljbGUpCiAgICBsb2NhbCBhbV9pX29uX2dyb3VuZCA9IHZlaGljbGVfZGlzdGFuY2VfdG9fZ3JvdW5kIDwgMiAtLWFuZCB0cnVlIG9yIGZhbHNlCiAgICBsb2NhbCBzcGVlZCA9IEVOVElUWS5HRVRfRU5USVRZX1NQRUVEKHBsYXllcl92ZWhpY2xlKQogICAgaWYgbm90IFZFSElDTEUuSVNfVkVISUNMRV9PTl9BTExfV0hFRUxTKHBsYXllcl92ZWhpY2xlKSBhbmQgRU5USVRZLklTX0VOVElUWV9VUFNJREVET1dOKHBsYXllcl92ZWhpY2xlKSBhbmQgYW1faV9vbl9ncm91bmQgdGhlbgogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfT05fR1JPVU5EX1BST1BFUkxZKHBsYXllcl92ZWhpY2xlLCA1LjApCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSEVBRElORyhwbGF5ZXJfdmVoaWNsZSwgaGVhZGluZykKICAgICAgICB1dGlsLnlpZWxkKCkKICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0ZPUldBUkRfU1BFRUQocGxheWVyX3ZlaGljbGUsIHNwZWVkKQogICAgZW5kCmVuZAoKCgotLS0t5L+d5oqk55CDCmxvY2FsIGJhbGx0YmwgPSB7fQpmdW5jdGlvbiBQcm90ZWN0X2JhbGwob24pCiAgICBpZiBvbiB0aGVuCiAgICAgICAgbG9jYWwgYmlnYXNzY2lyY2xlID0gdXRpbC5qb2FhdCgiYXJfcHJvcF9hcl9uZW9uX2dhdGU0eF8wNGEiKQogICAgICAgIGxvY2FsIHJvcmF0aW9uID0gMTAKICAgICAgICByZXF1ZXN0X21vZGVsKGJpZ2Fzc2NpcmNsZSkKCiAgICAgICAgZm9yIGkgPSAxLCAxOSBkbwogICAgICAgICAgICBiYWxsdGJsW2ldID0gY3JlYXRlX29iamVjdChiaWdhc3NjaXJjbGUsIC03NS4xNDYzNywgLTgxOC42NzIzNiwgMzI2LjE3NTEpCiAgICAgICAgICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKGJhbGx0YmxbaV0sIHRydWUpCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKGJhbGx0YmxbaV0sIDAuMCwgMC4wLCByb3JhdGlvbiwgMSwgdHJ1ZSkKICAgICAgICAgICAgcm9yYXRpb24gPSByb3JhdGlvbiArICAxMAogICAgICAgIGVuZAogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAtNzUuMTQ2MzcsIC04MTguNjcyMzYsIDMyNi4xNzUxKQogICAgZWxzZQogICAgICAgIGZvciBfLCBvYmogaW4gcGFpcnMoYmFsbHRibCkgZG8KICAgICAgICAgICAgZGVsZXRlX2VudGl0eShvYmopCiAgICAgICAgZW5kICAgCiAgICBlbmQKZW5kCgoKCi0t5bCE5Ye75pWI5p6cClNob290RWZmZWN0ID17c2NhbGUgPSAwLHJvdGF0aW9uID0gbmlsfQpTaG9vdEVmZmVjdC5fX2luZGV4ID0gU2hvb3RFZmZlY3QKc2V0bWV0YXRhYmxlKFNob290RWZmZWN0LCBFZmZlY3QpCmZ1bmN0aW9uIFNob290RWZmZWN0X25ldyhhc3NldCwgbmFtZSwgc2NhbGUsIHJvdGF0aW9uKQoJdGJsID0gc2V0bWV0YXRhYmxlKHt9LCBTaG9vdEVmZmVjdCkKCXRibC5uYW1lID0gbmFtZQoJdGJsLmFzc2V0ID0gYXNzZXQKCXRibC5zY2FsZSA9IHNjYWxlIG9yIDEuMAoJdGJsLnJvdGF0aW9uID0gcm90YXRpb24gb3IgdjMubmV3KCkKCXJldHVybiB0YmwKZW5kCnNob290aW5nRWZmZWN0cyA9IHsKCVNob290RWZmZWN0X25ldygic2NyX3JjYmFycnkyIiwgIm11el9jbG93biIsIDAuOCwgdjMubmV3KDkwLCAwLjAsIDAuMCkpLAoJU2hvb3RFZmZlY3RfbmV3KCJzY3JfcmNiYXJyeTIiLCAic2NyX2Nsb3duX2J1bCIsIDAuMywgdjMubmV3KDE4MC4wLCAwLjAsIDAuMCkpCn0KbG9jYWwgc2VsZWN0ZWRzaG9vdE9wdCA9IDEKZnVuY3Rpb24gU2hvb3RfZWZmZWN0X29wdGlvbihpbmRleCkKICAgIHNlbGVjdGVkc2hvb3RPcHQgPSBpbmRleAplbmQKZnVuY3Rpb24gU2hvb3RfZWZmZWN0KCkKICAgIGxvY2FsIGVmZmVjdCA9IHNob290aW5nRWZmZWN0c1tzZWxlY3RlZHNob290T3B0XQoJaWYgbm90IFNUUkVBTUlORy5IQVNfTkFNRURfUFRGWF9BU1NFVF9MT0FERUQoZWZmZWN0LmFzc2V0KSB0aGVuCgkJR1JBUEhJQ1MxLlJFUVVFU1RfTkFNRURfUFRGWF9BU1NFVChlZmZlY3QuYXNzZXQpCgoJZWxzZWlmIFBFRC5JU19QRURfU0hPT1RJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgdGhlbgoJCWxvY2FsIHdlYXBvbiA9IFdFQVBPTi5HRVRfQ1VSUkVOVF9QRURfV0VBUE9OX0VOVElUWV9JTkRFWChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwKQoJCWxvY2FsIGJvbmVJZCA9IEVOVElUWS5HRVRfRU5USVRZX0JPTkVfSU5ERVhfQllfTkFNRSh3ZWFwb24sICJndW5fbXV6emxlIikKCQlHUkFQSElDUy5VU0VfUEFSVElDTEVfRlhfQVNTRVQoZWZmZWN0LmFzc2V0KQoJCUdSQVBISUNTLlNUQVJUX1BBUlRJQ0xFX0ZYX05PTl9MT09QRURfT05fRU5USVRZX0JPTkUoCgkJCWVmZmVjdC5uYW1lLAoJCQl3ZWFwb24sCgkJCTAuMCwgMC4wLCAwLjAsCgkJCWVmZmVjdC5yb3RhdGlvbi54LCBlZmZlY3Qucm90YXRpb24ueSwgZWZmZWN0LnJvdGF0aW9uLnosCgkJCWJvbmVJZCwKCQkJZWZmZWN0LnNjYWxlLAoJCQlmYWxzZSwgZmFsc2UsIGZhbHNlCgkJKQoJZW5kCmVuZAoKCgotLeWRveS4reaViOaenApsb2NhbCBIaXRFZmZlY3QgPSB7Y29sb3JDYW5DaGFuZ2UgPSBmYWxzZX0KSGl0RWZmZWN0Ll9faW5kZXggPSBIaXRFZmZlY3QKc2V0bWV0YXRhYmxlKEhpdEVmZmVjdCwgRWZmZWN0KQpmdW5jdGlvbiBIaXRFZmZlY3QubmV3KGFzc2V0LCBuYW1lLCBjb2xvckNhbkNoYW5nZSkKCWxvY2FsIGluc3QgPSBzZXRtZXRhdGFibGUoe30sIEhpdEVmZmVjdCkKCWluc3QubmFtZSA9IG5hbWUKCWluc3QuYXNzZXQgPSBhc3NldAoJaW5zdC5jb2xvckNhbkNoYW5nZSA9IGNvbG9yQ2FuQ2hhbmdlIG9yIGZhbHNlCglyZXR1cm4gaW5zdAplbmQKaGl0RWZmZWN0cyA9IHsKCUhpdEVmZmVjdC5uZXcoInNjcl9yY2JhcnJ5MiIsICJzY3JfZXhwX2Nsb3duIiksCglIaXRFZmZlY3QubmV3KCJzY3JfcmNiYXJyeTIiLCAic2NyX2Nsb3duX2FwcGVhcnMiKSwKCUhpdEVmZmVjdC5uZXcoInNjcl9yY3BhcGFyYXp6bzEiLCAic2NyX21pY2g0X2ZpcmV3b3JrX3RyYWlsYnVyc3Rfc3Bhd24iLCB0cnVlKSwKCUhpdEVmZmVjdC5uZXcoInNjcl9pbmRlcF9maXJld29ya3MiLCAic2NyX2luZGVwX2ZpcmV3b3JrX3N0YXJidXJzdCIsIHRydWUpLAoJSGl0RWZmZWN0Lm5ldygic2NyX2luZGVwX2ZpcmV3b3JrcyIsICJzY3JfaW5kZXBfZmlyZXdvcmtfZm91bnRhaW4iLCB0cnVlKSwKCUhpdEVmZmVjdC5uZXcoInNjcl9yY2JhcnJ5MSIsICJzY3JfYWxpZW5fZGlzaW50ZWdyYXRlIiksCglIaXRFZmZlY3QubmV3KCJzY3JfcmNiYXJyeTIiLCAic2NyX2Nsb3duX2J1bCIpLAoJSGl0RWZmZWN0Lm5ldygicHJval9pbmRlcF9maXJld29yayIsICJzY3JfaW5kZXBfZmlyZXdvcmtfZ3JkX2J1cnN0IiksCglIaXRFZmZlY3QubmV3KCJzY3JfcmNiYXJyeTIiLCAibXV6X2Nsb3duIiksCn0KbG9jYWwgc2VsZWN0ZWRoaXRPcHQgPSAxCmZ1bmN0aW9uIHNldF9lZmZlY3RDb2xvdXIoY29sb3VyKQogICAgaGl0ZWZmZWN0Q29sb3VyID0gY29sb3VyCmVuZApmdW5jdGlvbiBoaXRfZWZmZWN0X29wdGlvbihvcHQpCiAgICBzZWxlY3RlZGhpdE9wdCA9IG9wdAplbmQKZnVuY3Rpb24gSGl0X2VmZmVjdCgpCiAgICBsb2NhbCBlZmZlY3QgPSBoaXRFZmZlY3RzW3NlbGVjdGVkaGl0T3B0XQogICAgaWYgbm90IFNUUkVBTUlORy5IQVNfTkFNRURfUFRGWF9BU1NFVF9MT0FERUQoZWZmZWN0LmFzc2V0KSB0aGVuCiAgICAgICAgcmV0dXJuIFNUUkVBTUlORy5SRVFVRVNUX05BTUVEX1BURlhfQVNTRVQoZWZmZWN0LmFzc2V0KQogICAgZW5kCiAgICBsb2NhbCBoaXRDb29yZHMgPSB2My5uZXcoKQogICAgaWYgV0VBUE9OLkdFVF9QRURfTEFTVF9XRUFQT05fSU1QQUNUX0NPT1JEKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGhpdENvb3JkcykgdGhlbgogICAgICAgIGxvY2FsIHJheWNhc3RSZXN1bHQgPSBnZXRfcmF5Y2FzdF9yZXN1bHQoMTAwMC4wKQogICAgICAgIGxvY2FsIHJvdCA9IHJheWNhc3RSZXN1bHQuc3VyZmFjZU5vcm1hbDp0b1JvdCgpCiAgICAgICAgR1JBUEhJQ1MuVVNFX1BBUlRJQ0xFX0ZYX0FTU0VUKGVmZmVjdC5hc3NldCkKICAgICAgICBpZiBlZmZlY3QuY29sb3JDYW5DaGFuZ2UgdGhlbgogICAgICAgICAgICBHUkFQSElDUy5TRVRfUEFSVElDTEVfRlhfTk9OX0xPT1BFRF9DT0xPVVIoaGl0ZWZmZWN0Q29sb3VyLnIsIGhpdGVmZmVjdENvbG91ci5nLCBoaXRlZmZlY3RDb2xvdXIuYikKICAgICAgICBlbmQKICAgICAgICBHUkFQSElDUy5TVEFSVF9ORVRXT1JLRURfUEFSVElDTEVfRlhfTk9OX0xPT1BFRF9BVF9DT09SRCgKICAgICAgICAgICAgZWZmZWN0Lm5hbWUsCiAgICAgICAgICAgIGhpdENvb3Jkcy54LCBoaXRDb29yZHMueSwgaGl0Q29vcmRzLnosCiAgICAgICAgICAgIHJvdC54IC0gOTAuMCwgcm90LnksIHJvdC56LAogICAgICAgICAgICAxLjAsIAogICAgICAgICAgICBmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZQogICAgICAgICkKICAgIGVuZAplbmQKCgoKCi0tLS0tLemYsuesvOWtkApmdW5jdGlvbiBDYWdlX3Byb29mKCkKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgIGZvciBfLCBoYXNoIGluIGlwYWlycyhjYWdlTW9kZWxzKSBkbwogICAgICAgIGxvY2FsIG9iaiA9IE9CSkVDVC5HRVRfQ0xPU0VTVF9PQkpFQ1RfT0ZfVFlQRShwb3MueCwgcG9zLnksIHBvcy56LCA4LjAsIGhhc2gsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgaWYgb2JqIH49IDAgYW5kIEVOVElUWS5ET0VTX0VOVElUWV9FWElTVChvYmopIHRoZW4KICAgICAgICAgICAgcmVxdWVzdF9jb250cm9sKG9iaikKICAgICAgICAgICAgZGVsZXRlX2VudGl0eShvYmopCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgoKCi0tLS0tLS0t5bSp5rqD6YOo5YiGCi0tLS3mlrDngavovabltKnmuoMKZnVuY3Rpb24gbmV3X3RyYWluX2NyYXNoKHBpZCkKICAgIAogICAgbG9jYWwgcGVkID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgIGlmIEVOVElUWS5ET0VTX0VOVElUWV9FWElTVChwZWQpIHRoZW4KICAgICAgICBmb3IgaSA9IDAsIDcgZG8KICAgICAgICAgICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHBlZCwgdHJ1ZSkJCiAgICAgICAgICAgIHBvcy55ID0gcG9zLnkgLSA1MAogICAgICAgICAgICBsb2NhbCB2ZWgxID0gY3JlYXRlX3ZlaGljbGUoMzU2NDA2MjUxOSwgcG9zLngsIHBvcy55LCBwb3MueiwgMCkJCiAgICAgICAgICAgIGxvY2FsIG9iajEgPSBjcmVhdGVfb2JqZWN0KDE4OTA2NDA0NzQsIHBvcy54LCBwb3MueSwgcG9zLnopCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0FTX01JU1NJT05fRU5USVRZKHZlaDEsIHRydWUsIHRydWUpCQkKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQVNfTUlTU0lPTl9FTlRJVFkob2JqMSwgdHJ1ZSwgdHJ1ZSkJCQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9WSVNJQkxFKHZlaDEsIHRydWUsIDApCQkKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfVklTSUJMRShvYmoxLCB0cnVlLCAwKQkJCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1ZFTE9DSVRZKHZlaDEsIDUsIDMsIDMpCQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9WRUxPQ0lUWShvYmoxLCAzLCA0LCA1KQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9ST1RBVElPTihvYmoxLCBtYXRoLnJhbmRvbSgzNjApLCBtYXRoLnJhbmRvbSgzNjApLCBtYXRoLnJhbmRvbSgzNjApLCAwLCB0cnVlKQogICAgICAgICAgICBmb3IgaSA9IDAsIDggZG8JCQkKICAgICAgICAgICAgICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWSh2ZWgxLCBvYmoxLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCB0cnVlLCB0cnVlLCBmYWxzZSwgMCwgdHJ1ZSwgZmFsc2UsIGZhbHNlKQkKICAgICAgICAgICAgICAgIGxvY2FsIHZlaDIgPSBjcmVhdGVfdmVoaWNsZSg4Njg4Njg0NDAsIHBvcy54LCBwb3MueSwgcG9zLnosIDApCiAgICAgICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9BU19NSVNTSU9OX0VOVElUWSh2ZWgyLCB0cnVlLCB0cnVlKQkJCiAgICAgICAgICAgICAgICBsb2NhbCBvYmpwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMob2JqMSwgdHJ1ZSkJCiAgICAgICAgICAgICAgICBGSVJFLkFERF9FWFBMT1NJT04ob2JqcG9zLngsIG9ianBvcy55LCBvYmpwb3MueiwgMCwgMS4wLCBmYWxzZSwgdHJ1ZSwgMC4wLCBmYWxzZSkJCQogICAgICAgICAgICAgICAgRU5USVRZLkFQUExZX0ZPUkNFX1RPX0VOVElUWV9DRU5URVJfT0ZfTUFTUyh2ZWgyLCAxLCAwLCAtMTAwLCAwLCB0cnVlLCBmYWxzZSwgdHJ1ZSwgZmFsc2UpOwkJCiAgICAgICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9WSVNJQkxFKHZlaDIsIHRydWUsIDApCiAgICAgICAgICAgICAgICB1dGlsLnlpZWxkKDEwMCkJCQkJCiAgICAgICAgICAgICAgICBFTlRJVFkuREVUQUNIX0VOVElUWSh2ZWgxLCB0cnVlLCB0cnVlKQkJCiAgICAgICAgICAgICAgICBFTlRJVFkuREVUQUNIX0VOVElUWShvYmoxLCB0cnVlLCB0cnVlKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQKLS3ml6DmlYjnm7TljYfmnLrltKnmuoMKZnVuY3Rpb24gSW52YWxpZF9oZWxpX3Byb3RlY3QocGlkKQogICAgCiAgICBsb2NhbCBtZGwgPSB1dGlsLmpvYWF0KCJhX21feV9zdGxhdF8wMSIpCiAgICBsb2NhbCB2ZWhfbWRsID0gdXRpbC5qb2FhdCAoImRpbGV0dGFudGUiKQogICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCBmYWxzZSkKICAgIGxvY2FsIHBsYXllcnBlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRF9TQ1JJUFRfSU5ERVgocGlkKQoKICAgIGxvY2FsIHZlaCA9IGNyZWF0ZV92ZWhpY2xlKHZlaF9tZGwsIHBvcy54LCBwb3MueSwgcG9zLnosIDApCiAgICBsb2NhbCBwZWQgPSBjcmVhdGVfcGVkKDIsIG1kbCwgcG9zLngsIHBvcy55LCBwb3MueiwgMCkKICAgIFBFRC5TRVRfUEVEX0lOVE9fVkVISUNMRShwZWQsIHZlaCwgLTEpCiAgICB1dGlsLnlpZWxkICgxMDAwKQogICAgVEFTSy5UQVNLX1ZFSElDTEVfSEVMSV9QUk9URUNUKHBlZCwgdmVoLCBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSwgSU5UX01BWCwgMCwgSU5UX01BWCwgMCwgMCkKZW5kCi0tLS3ngavovabltKnmuoMKZnVuY3Rpb24gdHJhaW5fY3Jhc2gocGlkKQogICAgCiAgICBsb2NhbCBteV9wb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpCiAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCksIGZhbHNlKQogICAgbG9jYWwgbW9kZWxfYXJyYXkgPSB7MTg0MzYxNjM4LDMxODYzNzYwODksNDEwODgyOTU3LDEwNzc0MjAyNjQsMjQwMjAxMzM3fQogICAgbG9jYWwgc3Bhd25fdmVoID0ge30KICAgIGZvciBfLCBoYXNoIGluIHBhaXJzKG1vZGVsX2FycmF5KSBkbwogICAgICAgIGZvciBpID0gMSwgMTUgZG8KICAgICAgICAgICAgbG9jYWwgdmVoID0gY3JlYXRlX3ZlaGljbGUoaGFzaCwgcG9zLngsIHBvcy55LCBwb3MueiwgMCkKICAgICAgICAgICAgc3Bhd25fdmVoWyNzcGF3bl92ZWgrMV0gPSB2ZWgKICAgICAgICAgICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04odmVoLCB0cnVlKQogICAgICAgIGVuZAogICAgZW5kCiAgICB1dGlsLnlpZWxkKDUwMDApCiAgICBmb3IgXywgZW50IGluIHBhaXJzKHNwYXduX3ZlaCkgZG8KICAgICAgICBkZWxldGVfZW50aXR5KGVudCkKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAogICAgU1RSRUFNSU5HLkNMRUFSX0ZPQ1VTKCkKZW5kCi0tLS3liqjnlLvltKnmuoMKZnVuY3Rpb24gYW5pbV9kaWN0X2NyYXNoKHBpZCkKICAgIAogICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLGZhbHNlKQogICAgbG9jYWwgbXlfcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksZmFsc2UpCiAgICBsb2NhbCBhbmltX2RpY3QgPSAoImFuaW1AbXBfZmVycmlzX3doZWVsIikKICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgcG9zLngsIHBvcy55LCBwb3MueiwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgIHJlcXVlc3RfYW5pbV9kaWN0KGFuaW1fZGljdCkKICAgIFRBU0suVEFTS19TV0VFUF9BSU1fRU5USVRZKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGFuaW1fZGljdCwgImdldCIsICJmdWNrZWQiLCAicmV0YXJkIiwgLTEsIFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCAzMC4wLCAzMC4wKQplbmQKLS0tLeWKqOeUu+W0qea6gzIKZnVuY3Rpb24gYW5pbV9kaWN0X2NyYXNoMihwaWQpCiAgICAKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSxmYWxzZSkKICAgIGxvY2FsIG15X3BvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLGZhbHNlKQogICAgbG9jYWwgYW5pbV9kaWN0ID0gKCJhbmltQG1wX3BsYXllcl9pbnR1cHBlcnN0aW5rZXIiKQogICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTX05PX09GRlNFVChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBwb3MueCwgcG9zLnksIHBvcy56LCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgcmVxdWVzdF9hbmltX2RpY3QoYW5pbV9kaWN0KQogICAgVEFTSy5UQVNLX1NXRUVQX0FJTV9QT1NJVElPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBhbmltX2RpY3QsICJnZXQiLCAiZnVja2VkIiwgInJldGFyZCIsIC0xLCAwLjAsIDAuMCwgMC4wLCAwLjAsIDAuMCkKICAgIHV0aWwueWllbGQoNzUwKQogICAgVEFTSy5DTEVBUl9QRURfVEFTS1NfSU1NRURJQVRFTFkoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKZW5kCgotLS0t5peg5pWI54iG54K4CmZ1bmN0aW9uIEludmFsaWRfZXhwbG9zaW9uKHBpZCkKICAgIAogICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCBmYWxzZSkKICAgIGxvY2FsIGNob3AgPSB1dGlsLmpvYWF0KCdjc190YW9zdHJhbnNsYXRvcicpCiAgICBsb2NhbCBjaHVwID0gdXRpbC5qb2FhdCgnQV9DX1JhYmJpdF8wMicpCgogICAgbG9jYWwgYWNob3AgPSBjcmVhdGVfcGVkKDI2LCBjaG9wLCBwb3MueCwgcG9zLnksIHBvcy56LCAwKQogICAgRU5USVRZLlNFVF9FTlRJVFlfVklTSUJMRShhY2hvcCxmYWxzZSkKICAgIFdFQVBPTi5HSVZFX1dFQVBPTl9UT19QRUQoYWNob3AsIHV0aWwuam9hYXQoJ3dlYXBvbl9tZycpLCA5OTk5LCBmYWxzZSwgZmFsc2UpCiAgICBUQVNLLlRBU0tfQ09NQkFUX1BFRChhY2hvcCwgUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCksIDAsIDE2KQogICAgUEVELlNFVF9QRURfQ09NQkFUX0FUVFJJQlVURVMoYWNob3AsIDQ2LCB0cnVlKQogICAgUEVELlNFVF9QRURfQ09NQkFUX1JBTkdFKGFjaG9wLCA0KQogICAgUEVELlNFVF9QRURfQ09NQkFUX0FCSUxJVFkoYWNob3AsIDMpCiAgICBsb2NhbCBjY2hvcCA9IGNyZWF0ZV9wZWQoMjYsIGNodXAsIHBvcy54LCBwb3MueSwgcG9zLnosIDApCiAgICBXRUFQT04uR0lWRV9XRUFQT05fVE9fUEVEKGNjaG9wLCB1dGlsLmpvYWF0KCd3ZWFwb25fbWcnKSwgOTk5OSwgZmFsc2UsIGZhbHNlKQogICAgVEFTSy5UQVNLX0NPTUJBVF9QRUQoY2Nob3AsIFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCAwLCAxNikKICAgIFBFRC5TRVRfUEVEX0NPTUJBVF9BVFRSSUJVVEVTKGNjaG9wLCA0NiwgdHJ1ZSkKICAgIFBFRC5TRVRfUEVEX0NPTUJBVF9SQU5HRShjY2hvcCwgNCkKICAgIFBFRC5TRVRfUEVEX0NPTUJBVF9BQklMSVRZKGNjaG9wLCAzKQoKICAgIHV0aWwueWllbGQoMTcwMCkKICAgIEZJUkUuQUREX0VYUExPU0lPTihwb3MueCwgcG9zLnksIHBvcy56LCAwLCAxLCB0cnVlLCBmYWxzZSwgMCwgZmFsc2UpCmVuZAoKCi0tLS3ku7vliqHovb3lhbfltKnmuoMKZnVuY3Rpb24gdGFza192ZWhfY3Jhc2gocGlkKQogICAgCiAgICBsb2NhbCBwZWQgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKTsKICAgIGlmIFBFRC5JU19QRURfSU5fQU5ZX1ZFSElDTEUocGVkLCB0cnVlKSB0aGVuCiAgICAgICAgbG9jYWwgdmVoaWNsZSA9IFBFRC5HRVRfVkVISUNMRV9QRURfSVNfSU4ocGVkLCBmYWxzZSkKICAgICAgICBUQVNLLlRBU0tfVkVISUNMRV9URU1QX0FDVElPTihwZWQsIHZlaGljbGUsIDE2LCAxMDApCiAgICAgICAgVEFTSy5UQVNLX1ZFSElDTEVfVEVNUF9BQ1RJT04ocGVkLCB2ZWhpY2xlLCAxNywgMTAwKQogICAgICAgIFRBU0suVEFTS19WRUhJQ0xFX1RFTVBfQUNUSU9OKHBlZCwgdmVoaWNsZSwgMTgsIDEwMCkKICAgIGVsc2UKICAgICAgICB1dGlsLnRvYXN0KCLnjqnlrrbkuI3lnKjovb3lhbciKQogICAgZW5kCmVuZAoKLS0tLeaXoOaViOWunuS9k+W0qea6gwpmdW5jdGlvbiBJbnZhbGlkX2VudGNyYXNoKHBpZCkKICAgIAogICAgbG9jYWwgZW50ID0ge30KICAgIGZvciBpID0gMSwgNSBkbwogICAgICAgIGxvY2FsIGhhc2ggPSAweDlDRjIxRTBGCiAgICAgICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCBmYWxzZSkKICAgICAgICBlbnRbI2VudCArIDFdID0gY3JlYXRlX29iamVjdChoYXNoLCBwb3MueCwgcG9zLnksIHBvcy56KQogICAgICAgIHV0aWwueWllbGQoMjAwKQogICAgZW5kCiAgICB1dGlsLnlpZWxkKDIwMDApCiAgICBmb3IgaywgdiBpbiBwYWlycyhlbnQpIGRvCiAgICAgICAgZGVsZXRlX2VudGl0eSh2KQogICAgZW5kCiAgICB1dGlsLnRvYXN0KCLltKnmuoPnu5PmnZ8iKQplbmQKCi0tLS3pgZPlhbfojYnltKnmuoMKZnVuY3Rpb24gcHJvcF9ncmFzcyhwaWQpCiAgICAKICAgIGZvciBpID0gMSwgMzAgZG8KICAgICAgICBsb2NhbCBwZWQgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKQogICAgICAgIGlmIHBlZCB+PSAwIHRoZW4KICAgICAgICAgICAgbG9jYWwgaGFzaCA9IHV0aWwuam9hYXQoInByb3BfdGFsbF9ncmFzc19iYSIpCiAgICAgICAgICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhwZWQsIGZhbHNlKQogICAgICAgICAgICBsb2NhbCBvYmogPSBjcmVhdGVfb2JqZWN0KGhhc2gsIHBvcy54LCBwb3MueSwgcG9zLnopCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQob2JqLCBwb3MueCwgcG9zLnksIHBvcy56LCBmYWxzZSwgdHJ1ZSwgdHJ1ZSkKICAgICAgICAgICAgdXRpbC55aWVsZCg1MDApCiAgICAgICAgICAgIGRlbGV0ZV9lbnRpdHkob2JqKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKLS0tLVBFROW0qea6gwpmdW5jdGlvbiBQRURfY3Jhc2gocGlkKQogICAgCiAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCksIDAsIDMsIDApCiAgICBsb2NhbCBwZWQgPSBjcmVhdGVfcGVkKDI2LHV0aWwuam9hYXQoImFfY19yYXQiKSxwb3MueCwgcG9zLnksIHBvcy56LCAwKQogICAgbG9jYWwgcGxhbmUgPSBjcmVhdGVfdmVoaWNsZSgweDljNWU1NjQ0LCBwb3MueCwgcG9zLnksIHBvcy56LCAwKQogICAgUEVELlNFVF9QRURfSU5UT19WRUhJQ0xFKHBlZCwgcGxhbmUsIC0xKQogICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04ocGxhbmUsdHJ1ZSkKICAgIFRBU0suVEFTS19PUEVOX1ZFSElDTEVfRE9PUihwZWQsIHBsYW5lLCA5OTk5LCAtMSwgMikKICAgIFRBU0suVEFTS19MRUFWRV9WRUhJQ0xFKHBlZCwgcGxhbmUsIDApCiAgICB1dGlsLnlpZWxkKDUwKQogICAgRklSRS5BRERfRVhQTE9TSU9OKHBvcy54LCBwb3MueSwgcG9zLnosIDAsIDEsIHRydWUsIGZhbHNlLCAwLCBmYWxzZSkKICAgIGRlbGV0ZV9lbnRpdHkocGVkKQplbmQKCi0tLS3ml6DmlYjnu7PntKLltKnmuoMKZnVuY3Rpb24gSW52YWxpZF9yb3BlKHBpZCkKICAgIAogICAgbG9jYWwgVGFyZ2V0UGxheWVyUGVkID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgIGxvY2FsIFBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhUYXJnZXRQbGF5ZXJQZWQsIHRydWUpCiAgICBsb2NhbCBjYXJnb2JvYiA9IGNyZWF0ZV92ZWhpY2xlKDBYRkNGQ0I2OEIsIFBvcy54LCBQb3MueSwgUG9zLnosIEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkpCiAgICBsb2NhbCBjYXJnb2JvYlBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhjYXJnb2JvYiwgdHJ1ZSkKICAgIGxvY2FsIHZlaGljbGUgPSBjcmVhdGVfdmVoaWNsZSgwWDE4N0Q5MzhELCBQb3MueCwgUG9zLnksIFBvcy56LCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpKQogICAgbG9jYWwgdmVoaWNsZVBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyh2ZWhpY2xlLCB0cnVlKQogICAgbG9jYWwgbmV3Um9wZSA9IFBIWVNJQ1MuQUREX1JPUEUoUG9zLngsIFBvcy55LCBQb3MueiwgMCwgMCwgMTAsIDEsIDEsIDAuMDAzMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDEsIDEsIDEsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDEuMCwgZmFsc2UsIDApCiAgICBQSFlTSUNTLkFUVEFDSF9FTlRJVElFU19UT19ST1BFKG5ld1JvcGUsIGNhcmdvYm9iLCB2ZWhpY2xlLCBjYXJnb2JvYlBvcy54LCBjYXJnb2JvYlBvcy55LCBjYXJnb2JvYlBvcy56LCB2ZWhpY2xlUG9zLngsIHZlaGljbGVQb3MueSwgdmVoaWNsZVBvcy56LCAyLCBmYWxzZSwgZmFsc2UsIDAsIDAsICJDZW50ZXIiLCAiQ2VudGVyIikKZW5kCgotLS0t5paw6ay85bSpCmZ1bmN0aW9uIG5ld19ndWliZW5nKHBpZCkKICAgIAogICAgbG9jYWwgbW9kZWxfYXJyYXkgPSB7dXRpbC5qb2FhdCgiYm9hdHRyYWlsZXIiKSx1dGlsLmpvYWF0KCJ0cmFpbGVyc21hbGwiKSx1dGlsLmpvYWF0KCJyYWtldHJhaWxlciIpLH0KICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSkKICAgIGxvY2FsIGZ1Y2tfcGVkID0gY3JlYXRlX3BlZCgyNiAsIHV0aWwuam9hYXQoImlnX2theWxlZSIpLCBwb3MueCwgcG9zLnksIHBvcy56LCAwKQogICAgRU5USVRZLlNFVF9FTlRJVFlfVklTSUJMRShmdWNrX3BlZCwgZmFsc2UpCiAgICBmb3IgaSA9IDEsIDMsIDEgZG8KICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFNfTk9fT0ZGU0VUKGZ1Y2tfcGVkLCBwb3MueCwgcG9zLnksIHBvcy56KQogICAgICAgIGZvciBzcGF3biwgdmFsdWUgaW4gcGFpcnMobW9kZWxfYXJyYXkpIGRvCiAgICAgICAgICAgIGxvY2FsIHZlbHMgPSB7fQogICAgICAgICAgICB2ZWxzW3NwYXduXSA9IGNyZWF0ZV92ZWhpY2xlKHZhbHVlLCBwb3MueCwgcG9zLnksIHBvcy56LCAwKQogICAgICAgICAgICBmb3IgYXR0YWNoLCB2IGluIHBhaXJzKHZlbHMpIGRvCiAgICAgICAgICAgICAgICBFTlRJVFkuQVRUQUNIX0VOVElUWV9CT05FX1RPX0VOVElUWV9CT05FX1lfRk9SV0FSRCh2LCBmdWNrX3BlZCwgMCwgMCwgdHJ1ZSwgdHJ1ZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICAgICAgdXRpbC55aWVsZCgxMDApCiAgICAgICAgRklSRS5BRERfRVhQTE9TSU9OKHBvcy54LCBwb3MueSwgcG9zLnosIDQsIDEwMCwgdHJ1ZSwgZmFsc2UsIDEsIGZhbHNlKQogICAgZW5kCmVuZAoKLS0tLeWkp+iHqueEtuWFqOWxgOW0qea6gwpmdW5jdGlvbiBuYXR1cmUoKQogICAgbG9jYWwgdXNlciA9IFBMQVlFUi5QTEFZRVJfSUQoKQogICAgbG9jYWwgdXNlcl9wZWQgPSBQTEFZRVIuUExBWUVSX1BFRF9JRCgpCiAgICBsb2NhbCBtb2RlbCA9IHV0aWwuam9hYXQoImg0X3Byb3BfYnVzaF9tYW5nX2FkIikgLS0gc3BlY2lhbCBvcCBvYmplY3Qgc28geW91IGRvbnQgaGF2ZSB0byBiZSBuZWFyIHRoZW0gOkQKICAgICAgICB1dGlsLnlpZWxkKDEwMCkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9WSVNJQkxFKHVzZXJfcGVkLCBmYWxzZSkKICAgICAgICBmb3IgaSA9IDAsIDExMCBkbwogICAgICAgICAgICBQTEFZRVIuU0VUX1BMQVlFUl9QQVJBQ0hVVEVfUEFDS19NT0RFTF9PVkVSUklERSh1c2VyLCBtb2RlbCkKICAgICAgICAgICAgUEVELlNFVF9QRURfQ09NUE9ORU5UX1ZBUklBVElPTih1c2VyX3BlZCwgNSwgaSwgMCwgMCkKICAgICAgICAgICAgdXRpbC55aWVsZCgyNSkKICAgICAgICAgICAgUExBWUVSLkNMRUFSX1BMQVlFUl9QQVJBQ0hVVEVfUEFDS19NT0RFTF9PVkVSUklERSh1c2VyKQogICAgICAgIGVuZAogICAgICAgIGZvciBpID0gMSwgNSBkbwogICAgICAgICAgICB1dGlsLnNwb29mX3NjcmlwdCgiZnJlZW1vZGUiLCBTWVNURU0uV0FJVCkgLS0gcHJldmVudGluZyB3YXN0ZWQgc2NyZWVuCiAgICAgICAgZW5kCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSEVBTFRIKHVzZXJfcGVkLCAwLCAwKSAtLSBraWxsaW5nIHBlZCBiZWNhdXNlIGl0IHdpbGwgc3RpbGwgY3Jhc2ggb3RoZXJzIHVudGlsIHlvdSBkaWUgKGNsZWFyaW5nIHRhc2tzIGRvZXNudCBzZWVtIHRvIGRvIG11Y2gpCiAgICAgICAgbG9jYWwgcG9zID0gcGxheWVycy5nZXRfcG9zaXRpb24odXNlcikKICAgICAgICBORVRXT1JLLk5FVFdPUktfUkVTVVJSRUNUX0xPQ0FMX1BMQVlFUihwb3MueCwgcG9zLnksIHBvcy56LCAwLCBmYWxzZSwgZmFsc2UsIDApCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfVklTSUJMRSh1c2VyX3BlZCwgdHJ1ZSkKZW5kCgoKCgotLS0t54Gr5Lq6CmxvY2FsIGxvb3BlZF9wdGZ4cyA9IHt9CmZ1bmN0aW9uIGZpcmVzZWxmKG9uKQogICAgaWYgb24gdGhlbgogICAgICAgIHJlcXVlc3RfcHRmeF9hc3NldCgiY29yZSIpCiAgICAgICAgbG9jYWwgdHJhaWxfYm9uZXMgPSB7MHhmZmEsIDB4ZmExMSwgMHg4M2MsIDB4NTEyZCwgMHg3OTZlLCAweGIzZmUsIDB4M2ZjZiwgMHg1OGI3LCAweGJiMH0KICAgICAgICBmb3IgXywgYm9uZSBpbiBwYWlycyh0cmFpbF9ib25lcykgZG8KICAgICAgICAgICAgR1JBUEhJQ1MuVVNFX1BBUlRJQ0xFX0ZYX0FTU0VUKCJjb3JlIikKICAgICAgICAgICAgbG9jYWwgYm9uZV9pZCA9IFBFRC5HRVRfUEVEX0JPTkVfSU5ERVgoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgYm9uZSkKICAgICAgICAgICAgbG9jYWwgZnggPSBHUkFQSElDUy5TVEFSVF9ORVRXT1JLRURfUEFSVElDTEVfRlhfTE9PUEVEX09OX0VOVElUWV9CT05FKCJmaXJlX3dyZWNrZWRfcGxhbmVfY29ja3BpdCIsIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDAuMCwgMC4wLCAwLjAsIDAuMCwgMC4wLCA5MC4wLCBib25lX2lkLCAwLjUsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDAsIDAsIDAsIDApCiAgICAgICAgICAgIGxvb3BlZF9wdGZ4c1sjbG9vcGVkX3B0ZnhzKzFdID0gZngKICAgICAgICAgICAgR1JBUEhJQ1MuU0VUX1BBUlRJQ0xFX0ZYX0xPT1BFRF9DT0xPVVIoZngsIDEwMCwgMTAwLCAxMDAsIDApCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgZm9yIF8sIHAgaW4gcGFpcnMobG9vcGVkX3B0ZnhzKSBkbwogICAgICAgICAgICBHUkFQSElDUy5SRU1PVkVfUEFSVElDTEVfRlgocCwgZmFsc2UpCiAgICAgICAgICAgIEdSQVBISUNTLlNUT1BfUEFSVElDTEVfRlhfTE9PUEVEKHAsIGZhbHNlKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKLS0tLeiHquWKqOi4ouWHuuW5v+WRiuacugpjaGF0Lm9uX21lc3NhZ2UoZnVuY3Rpb24oc2VuZGVyLCByZXNlcnZlZCwgdGV4dCwgdGVhbV9jaGF0LCBuZXR3b3JrZWQsIGlzX2F1dG8pCiAgICBpZiBraWNrX2FkQm90IGFuZCBzZW5kZXIgfj0gUExBWUVSLlBMQVlFUl9JRCgpIGFuZCBwbGF5ZXJzLmdldF9ob3N0KCkgPT0gUExBWUVSLlBMQVlFUl9JRCgpIHRoZW4KCiAgICAgICAgbG9jYWwgbmV3dGV4dCA9IHN0cmluZy5sb3dlcih0ZXh0KS0t6L2s5bCP5YaZCiAgICAgICAgbG9jYWwgbmFtZSA9IFBMQVlFUi5HRVRfUExBWUVSX05BTUUoc2VuZGVyKQoKICAgICAgICBsb2NhbCBkaXIgPSBmaWxlc3lzdGVtLnNjcmlwdHNfZGlyKCkgLi4gJ2RhaWRhaVNjcmlwdC9hZHdvcmRzLmpzb24nCiAgICAgICAgbG9jYWwgZGF0YSA9IGZpbGVyZWFkKGRpciwgJ3InLCAnKmFsbCcpCiAgICAgICAgbG9jYWwgYWR3b3JkcyA9IEpzb25Ub1RhYmxlKGRhdGEpCiAgICAgICAgCiAgICAgICAgZm9yIF8sIHdvcmQgaW4gcGFpcnMoYWR3b3JkcykgZG8gCiAgICAgICAgICAgIGlmIHN0cmluZy5jb250YWlucyhuZXd0ZXh0LCB3b3JkKSB0aGVuCiAgICAgICAgICAgICAgICB1dGlsLnRvYXN0KCLmo4DmtYvliLDlub/lkYrmnLogIi4ubmFtZSkKICAgICAgICAgICAgICAgIHV0aWwubG9nKCLmo4DmtYvliLDlub/lkYrmnLogIi4ubmFtZSkKICAgICAgICAgICAgICAgIG1lbnUudHJpZ2dlcl9jb21tYW5kcygia2ljayAiIC4uIG5hbWUpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZCkKCgotLS1NSy0y5oum5oiqCmxvY2FsIHNlbGVjdGVkS2FybWFNSzIgPSAiW1JlbW92ZV0iCmxvY2FsIG9wcHJlc3NvckZyaWVuZEthcm1hID0gZmFsc2UKbG9jYWwgb3BwcmVzc29yWW91cnNlbGZLYXJtYSA9IGZhbHNlCmZ1bmN0aW9uIHNldF9tazJfZnJpZW5kKG9uKQogICAgb3BwcmVzc29yRnJpZW5kS2FybWEgPSBvbgplbmQKZnVuY3Rpb24gc2V0X21rMl9zZWxmKG9uKQogICAgb3BwcmVzc29yWW91cnNlbGZLYXJtYSA9IG9uCmVuZApmdW5jdGlvbiBzZXRfbWsyX3NlbGVjdCh2YWx1ZSkKICAgIHNlbGVjdGVkS2FybWFNSzIgPSBnbVt2YWx1ZV0KZW5kCmZ1bmN0aW9uIGlzX3BsYXllcl9mcmllbmQocElkKQogICAgbG9jYWwgcEhhbmRsZSA9IG1lbW9yeS5hbGxvYygxMDQpCiAgICBORVRXT1JLLk5FVFdPUktfSEFORExFX0ZST01fUExBWUVSKHBJZCwgcEhhbmRsZSwgMTMpCiAgICBsb2NhbCBpc0ZyaWVuZCA9IE5FVFdPUksuTkVUV09SS19JU19IQU5ETEVfVkFMSUQocEhhbmRsZSwgMTMpIGFuZCBORVRXT1JLLk5FVFdPUktfSVNfRlJJRU5EKHBIYW5kbGUpCiAgICByZXR1cm4gaXNGcmllbmQKZW5kCmZ1bmN0aW9uIG9wcEthcm1hKCkKICAgIGZvciBpLCBwaWQgaW4gcGFpcnMocGxheWVycy5saXN0KHRydWUsIHRydWUsIHRydWUpKSBkbwogICAgICAgIGlmIG5vdCBvcHByZXNzb3JGcmllbmRLYXJtYSBhbmQgaXNfcGxheWVyX2ZyaWVuZChwaWQpIHRoZW4KICAgICAgICAgICAgcGlkID0gcGlkKzEKICAgICAgICBlbHNlaWYgbm90IG9wcHJlc3NvcllvdXJzZWxmS2FybWEgYW5kIHBpZCA9PSBQTEFZRVIuUExBWUVSX0lEKCkgdGhlbgogICAgICAgICAgICBwaWQgPSBwaWQrMQogICAgICAgIGVuZAogICAgICAgIGxvY2FsIHZlaGljbGUgPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0lOKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCBmYWxzZSkKICAgICAgICBpZiBFTlRJVFkuR0VUX0VOVElUWV9NT0RFTCh2ZWhpY2xlKSA9PSAyMDY5MTQ2MDY3IGFuZCBQRUQuSVNfUEVEX0lOX0FOWV9WRUhJQ0xFKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLHRydWUpIHRoZW4KICAgICAgICAgICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpKQogICAgICAgICAgICBpZiBzZWxlY3RlZEthcm1hTUsyID09ICJbUmVtb3ZlXSIgdGhlbgogICAgICAgICAgICAgICAgcmVxdWVzdF9jb250cm9sKHZlaGljbGUpCiAgICAgICAgICAgICAgICBkZWxldGVfZW50aXR5KHZlaGljbGUpCiAgICAgICAgICAgICAgICB1dGlsLnlpZWxkKDEwMCkKICAgICAgICAgICAgZWxzZWlmIHNlbGVjdGVkS2FybWFNSzIgPT0gIltLaWxsXSIgdGhlbgogICAgICAgICAgICAgICAgRklSRS5BRERfRVhQTE9TSU9OKHBvcy54LCBwb3MueSwgcG9zLnosIDAsIDEwMCwgdHJ1ZSwgZmFsc2UsIDEsIGZhbHNlKQogICAgICAgICAgICBlbHNlaWYgc2VsZWN0ZWRLYXJtYU1LMiA9PSAiW1JlbW92ZSArIEtpbGxdIiB0aGVuCiAgICAgICAgICAgICAgICByZXF1ZXN0X2NvbnRyb2wodmVoaWNsZSkKICAgICAgICAgICAgICAgIGRlbGV0ZV9lbnRpdHkodmVoaWNsZSkKICAgICAgICAgICAgICAgIEZJUkUuQUREX0VYUExPU0lPTihwb3MueCwgcG9zLnksIHBvcy56LCAwLCAxMDAsIHRydWUsIGZhbHNlLCAxLCBmYWxzZSkKICAgICAgICAgICAgICAgIHV0aWwueWllbGQoMTAwKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgbm90aWZ5KCLmo4DmtYvliLDpqazlhYvlhZQgIi4ucGxheWVycy5nZXRfbmFtZShwaWQpLi4iIOaKpeW6lOWQr+eUqCIpCiAgICAgICAgZW5kCiAgICAgICAgdXRpbC55aWVsZCgxMCkKICAgIGVuZAplbmQKCgotLS0t6Ieq5Yqo5p2A5q276ZmE6L+RTlBDCmZ1bmN0aW9uIGF1dG9fa2lsbF9OUEMoKQogICAgZm9yIGksIHBlZCBpbiBwYWlycyhlbnRpdGllcy5nZXRfYWxsX3BlZHNfYXNfaGFuZGxlcygpKSBkbwogICAgICAgIGlmIG5vdCBQRUQuSVNfUEVEX0FfUExBWUVSKHBlZCkgYW5kIEVOVElUWS5ET0VTX0VOVElUWV9FWElTVChwZWQpIHRoZW4KICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSEVBTFRIKHBlZCwgMC4wKQogICAgICAgIGVuZAogICAgZW5kCmVuZAotLS0t6Ieq5Yqo5p2A5q275pWM5Lq6CmZ1bmN0aW9uIGF1dG9fa2lsbF9lbmVteSgpCiAgICBmb3IgaSwgcGVkIGluIHBhaXJzKGVudGl0aWVzLmdldF9hbGxfcGVkc19hc19oYW5kbGVzKCkpIGRvCiAgICAgICAgaWYgbm90IFBFRC5JU19QRURfQV9QTEFZRVIocGVkKSBhbmQgUEVELklTX1BFRF9JTl9DT01CQVQocGVkLCBQTEFZRVIuUExBWUVSX0lEKCkpIHRoZW4KICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSEVBTFRIKHBlZCwgMC4wKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKLS0tLei/h+a4oeS8oOmAgQpmdW5jdGlvbiB0cmFuc2l0X3RwKCkKICAgIGxvY2FsIHdheXBvaW50ID0gZ2V0X3dheXBvaW50X2Nvb3JkcygpCiAgICBsb2NhbCB2ZWhpY2xlID0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19VU0lORyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgaWYgdmVoaWNsZSB+PSAwIHRoZW4KICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9WSVNJQkxFKHZlaGljbGUsIGZhbHNlKQogICAgZW5kCiAgICBTVFJFQU1JTkcuU1dJVENIX1RPX01VTFRJX0ZJUlNUUEFSVChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCA4LCAxKQogICAgSFVELkJFR0lOX1RFWFRfQ09NTUFORF9CVVNZU1BJTk5FUl9PTigiUE1fV0FJVCIpCiAgICBIVUQuRU5EX1RFWFRfQ09NTUFORF9CVVNZU1BJTk5FUl9PTig0KQogICAgcmVwZWF0CiAgICAgICAgdXRpbC55aWVsZCgpCiAgICB1bnRpbCBTVFJFQU1JTkcuSVNfU1dJVENIX1RPX01VTFRJX0ZJUlNUUEFSVF9GSU5JU0hFRCgpCiAgICBpZiB2ZWhpY2xlID09IDAgdGhlbgogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgd2F5cG9pbnQueCwgd2F5cG9pbnQueSwgd2F5cG9pbnQueiwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgIGVsc2UKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9WSVNJQkxFKHZlaGljbGUsIGZhbHNlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQodmVoaWNsZSwgd2F5cG9pbnQueCwgd2F5cG9pbnQueSwgd2F5cG9pbnQueiwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgIGVuZAogICAgU1RSRUFNSU5HLlNXSVRDSF9UT19NVUxUSV9TRUNPTkRQQVJUKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICBTVFJFQU1JTkcuQUxMT1dfUExBWUVSX1NXSVRDSF9PVVRSTygpIAogICAgcmVwZWF0CiAgICAgICAgdXRpbC55aWVsZCgpCiAgICB1bnRpbCBub3QgU1RSRUFNSU5HLklTX1BMQVlFUl9TV0lUQ0hfSU5fUFJPR1JFU1MoKQogICAgaWYgdmVoaWNsZSA9PSAwIHRoZW4KICAgICAgICBORVRXT1JLLk5FVFdPUktfRkFERV9JTl9FTlRJVFkoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSwgdHJ1ZSkKICAgIGVsc2UKICAgICAgICBORVRXT1JLLk5FVFdPUktfRkFERV9JTl9FTlRJVFkodmVoaWNsZSwgdHJ1ZSwgdHJ1ZSkKICAgICAgICBORVRXT1JLLk5FVFdPUktfRkFERV9JTl9FTlRJVFkoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSwgdHJ1ZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9WSVNJQkxFKHZlaGljbGUsIHRydWUpCiAgICBlbmQKICAgIEhVRC5CVVNZU1BJTk5FUl9PRkYoKQplbmQKCgotLS0t6ZqP5py65L2N572uCmZ1bmN0aW9uIHJhbmRvbV9wb3NpdGlvbigpCiAgICBsb2NhbCB3YXlwb2ludCA9IHt4ID0gbWF0aC5yYW5kb20oLTE3OTQsMjk0MCksIHkgPSBtYXRoLnJhbmRvbSgtMzAyNiw2Mjk4KSwgeiA9IG1hdGgucmFuZG9tKDAsODAwKX0KICAgIGxvY2FsIHBvcz0gd2F5cG9pbnRfY29vcmQod2F5cG9pbnQueCx3YXlwb2ludC55LHdheXBvaW50LnopCiAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgcG9zLngsIHBvcy55LCBwb3MueiwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCmVuZAoKLS0tLS3ot7Pov4fkuIvmsLTpgZPliIflibIKZnVuY3Rpb24gSVNfSEVMUF9NU0dfRElTUExBWUVEKGxhYmVsKSAtLSBDcmVkaXQgZ29lcyB0byBqZXJyeTEyMyM0NTA4CiAgICBIVUQuQkVHSU5fVEVYVF9DT01NQU5EX0lTX1RISVNfSEVMUF9NRVNTQUdFX0JFSU5HX0RJU1BMQVlFRChsYWJlbCkKICAgIHJldHVybiBIVUQuRU5EX1RFWFRfQ09NTUFORF9JU19USElTX0hFTFBfTUVTU0FHRV9CRUlOR19ESVNQTEFZRUQoMCkKZW5kCi0tLS0t5Yig6Zmk5o6S5rC0566hCmZ1bmN0aW9uIERFTEVURV9PQkpFQ1RfQllfSEFTSChoYXNoKQogICAgZm9yIF8sIGVudCBpbiBwYWlycyhlbnRpdGllcy5nZXRfYWxsX29iamVjdHNfYXNfaGFuZGxlcygpKSBkbwogICAgICAgIGlmIEVOVElUWS5HRVRfRU5USVRZX01PREVMKGVudCkgPT0gaGFzaCB0aGVuCiAgICAgICAgICAgIGRlbGV0ZV9lbnRpdHkoZW50KQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKLS0tLeW8uuWItuWPr+ingQpmdW5jdGlvbiBmb3JjZV92aXNpYmxlKCkKICAgIGZvciBfLCBwaWQgaW4gcGxheWVycy5saXN0KGZhbHNlLCB0cnVlLCB0cnVlKSBkbwogICAgICAgIGxvY2FsIHBlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICAgICAgaWYgbm90IEVOVElUWS5JU19FTlRJVFlfVklTSUJMRShwZWQpIHRoZW4KICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfVklTSUJMRShwZWQsIHRydWUpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgotLS0t6LWi5b6X5YiR5LqL5q+B5Z2PCmZ1bmN0aW9uIFdpbl9jcmltaW5hbF9kYW1hZ2UoKQogICAgbG9jYWwgY2FyID0gdXRpbC5qb2FhdCgiVGV6ZXJhY3QiKQogICAgZm9yIGkgPSAxLCAyMiBkbwogICAgICAgIGxvY2FsIGVudCA9IGNyZWF0ZV92ZWhpY2xlKGNhciwgMCwgMCwgMCwgMCkKICAgICAgICBGSVJFLkFERF9PV05FRF9FWFBMT1NJT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMCwgMCwgMCwgIkVYUF9UQUdfUkNUQU5LX1JPQ0tFVCIsIDEwMC4wLCBmYWxzZSwgZmFsc2UsIDAuMCkKICAgICAgICB1dGlsLnlpZWxkKDUwKQogICAgICAgIGRlbGV0ZV9lbnRpdHkoZW50KQogICAgZW5kCmVuZAotLS0t6LWi5b6X5qOA5p+l54K5CmZ1bmN0aW9uIFdpbl9jaGVja3BvaW50cygpCiAgICBsb2NhbCBkYmxpcCA9IEhVRC5HRVRfTkVYVF9CTElQX0lORk9fSUQoNDMxKQogICAgbG9jYWwgY2RibGlwID0gSFVELkdFVF9CTElQX0NPT1JEUyhkYmxpcCkKICAgIHRlbGVwb3J0KGNkYmxpcC54LCBjZGJsaXAueSwgY2RibGlwLnosIGZhbHNlKQogICAgdXRpbC55aWVsZCgxNTAwKQplbmQKCi0tYWlv5bSp5rqDCmxvY2FsIGdldEVudGl0eUNvb3JkcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUwpsb2NhbCBnZXRQbGF5ZXJQZWQgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQKZnVuY3Rpb24gYWFhaW8ocGlkKQogICAgCiAgICBpZiBwbGF5ZXJzLmV4aXN0cyhwaWQpIHRoZW4KICAgICAgICBsb2NhbCB1c2VyID0gUExBWUVSLlBMQVlFUl9JRCgpCiAgICAgICAgbG9jYWwgdXNlcl9wZWQgPSBQTEFZRVIuUExBWUVSX1BFRF9JRCgpCiAgICAgICAgbG9jYWwgcG9zID0gcGxheWVycy5nZXRfcG9zaXRpb24odXNlcikKCiAgICAgICAgICAgICAgICB1dGlsLnlpZWxkKDEwMCkKICAgICAgICAgICAgICAgIFBMQVlFUi5TRVRfUExBWUVSX1BBUkFDSFVURV9QQUNLX01PREVMX09WRVJSSURFKFBMQVlFUi5QTEFZRVJfSUQoKSwgMHhGQkY3RDIxRikKICAgICAgICAgICAgICAgIFdFQVBPTi5HSVZFX0RFTEFZRURfV0VBUE9OX1RPX1BFRCh1c2VyX3BlZCwgMHhGQkFCNTc3NiwgMTAwLCBmYWxzZSkKICAgICAgICAgICAgICAgIFRBU0suVEFTS19QQVJBQ0hVVEVfVE9fVEFSR0VUKHVzZXJfcGVkLCBwb3MueCwgcG9zLnksIHBvcy56KQogICAgICAgICAgICAgICAgdXRpbC55aWVsZCgpCiAgICAgICAgICAgICAgICBUQVNLLkNMRUFSX1BFRF9UQVNLU19JTU1FRElBVEVMWSh1c2VyX3BlZCkKICAgICAgICAgICAgICAgIHV0aWwueWllbGQoMjUwKQogICAgICAgICAgICAgICAgV0VBUE9OLkdJVkVfREVMQVlFRF9XRUFQT05fVE9fUEVEKHVzZXJfcGVkLCAweEZCQUI1Nzc2LCAxMDAsIGZhbHNlKQogICAgICAgICAgICAgICAgUExBWUVSLkNMRUFSX1BMQVlFUl9QQVJBQ0hVVEVfUEFDS19NT0RFTF9PVkVSUklERSh1c2VyKQogICAgICAgICAgICAgICAgdXRpbC55aWVsZCgxMDAwKQogICAgICAgICAgICAgICAgZm9yIGkgPSAxLCA1IGRvCiAgICAgICAgICAgICAgICAgICAgdXRpbC5zcG9vZl9zY3JpcHQoImZyZWVtb2RlIiwgU1lTVEVNLldBSVQpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0hFQUxUSCh1c2VyX3BlZCwgMCwgMCkKICAgICAgICAgICAgICAgIE5FVFdPUksuTkVUV09SS19SRVNVUlJFQ1RfTE9DQUxfUExBWUVSKHBvcy54LHBvcy55LHBvcy56LCAwLCBmYWxzZSwgZmFsc2UsIDApCgogICAgZW5kCiAgICBpZiBwbGF5ZXJzLmV4aXN0cyhwaWQpIHRoZW4KICAgICAgICBsb2NhbCB0aW1lID0gdXRpbC5jdXJyZW50X3RpbWVfbWlsbGlzKCkgKyAyMDAwCiAgICAgICAgICAgIHdoaWxlIHRpbWUgPiB1dGlsLmN1cnJlbnRfdGltZV9taWxsaXMoKSBkbwogICAgICAgICAgICAgICAgbG9jYWwgcG9zPUVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSwgdHJ1ZSkKICAgICAgICAgICAgICAgIGZvciBpID0gMSwgMTAgZG8KICAgICAgICAgICAgICAgICAgICBBVURJTy5QTEFZX1NPVU5EX0ZST01fQ09PUkQoLTEsIjEwcyIscG9zLngscG9zLnkscG9zLnosIk1QX01JU1NJT05fQ09VTlRET1dOX1NPVU5EU0VUIix0cnVlLCA3MCwgZmFsc2UpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIHV0aWwueWllbGQoMCkKICAgICAgICAgICAgZW5kCiAgICBlbmQgCiAgICBpZiBwbGF5ZXJzLmV4aXN0cyhwaWQpIHRoZW4KICAgICAgICBsb2NhbCB0aW1lID0gdXRpbC5jdXJyZW50X3RpbWVfbWlsbGlzKCkgKyAyMDAwCiAgICAgICAgICAgIHdoaWxlIHRpbWUgPiB1dGlsLmN1cnJlbnRfdGltZV9taWxsaXMoKSBkbwogICAgICAgICAgICAgICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCB0cnVlKQogICAgICAgICAgICAgICAgZm9yIGkgPSAxLCAyMCBkbwogICAgICAgICAgICAgICAgICAgIEFVRElPLlBMQVlfU09VTkRfRlJPTV9DT09SRCgtMSwgJ0V2ZW50X01lc3NhZ2VfUHVycGxlJywgcG9zLngsIHBvcy55LCBwb3MueiwgJ0dUQU9fRk1fRXZlbnRzX1NvdW5kc2V0JywgdHJ1ZSwgMTAwMCwgZmFsc2UpCiAgICAgICAgICAgICAgICAgICAgQVVESU8uUExBWV9TT1VORF9GUk9NX0NPT1JEKC0xLCAnNXMnLCBwb3MueCwgcG9zLnksIHBvcy56LCAnR1RBT19GTV9FdmVudHNfU291bmRzZXQnLCB0cnVlLCAxMDAwLCBmYWxzZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgdXRpbC55aWVsZCgpCiAgICAgICAgICAgIGVuZAkKICAgIGVuZAogICAgaWYgcGxheWVycy5leGlzdHMocGlkKSB0aGVuCiAgICAgICAgbG9jYWwgVFBQID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgICAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoVFBQLCB0cnVlKQogICAgICAgIHBvcy56ID0gcG9zLnogKyAxMAogICAgICAgIHZlaCA9IGVudGl0aWVzLmdldF9hbGxfdmVoaWNsZXNfYXNfaGFuZGxlcygpCiAgICAgICAgCiAgICAgICAgZm9yIGkgPSAxLCAjdmVoIGRvCiAgICAgICAgICAgIE5FVFdPUksuTkVUV09SS19SRVFVRVNUX0NPTlRST0xfT0ZfRU5USVRZKHZlaFtpXSkKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTX05PX09GRlNFVCh2ZWhbaV0sIHBvcy54LHBvcy55LHBvcy56LCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKFRQUCksIDEwKQogICAgICAgICAgICBUQVNLLlRBU0tfVkVISUNMRV9URU1QX0FDVElPTihUUFAsIHZlaFtpXSwgMTgsIDk5OSkKICAgICAgICAgICAgVEFTSy5UQVNLX1ZFSElDTEVfVEVNUF9BQ1RJT04oVFBQLCB2ZWhbaV0sIDE2LCA5OTkpCiAgICAgICAgZW5kCiAgICBlbmQKICAgIGlmIHBsYXllcnMuZXhpc3RzKHBpZCkgdGhlbgogICAgICAgIGxvY2FsIGhhc2hlcyA9IHsxNDkyNjEyNDM1LCAzNTE3Nzk0NjE1LCAzODg5MzQwNzgyLCAzMjUzMjc0ODM0fQogICAgICAgIGxvY2FsIHZlaGljbGVzID0ge30KICAgICAgICBmb3IgaSA9IDEsIDQgZG8KICAgICAgICAgICAgdXRpbC5jcmVhdGVfdGhyZWFkKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIHJlcXVlc3RfbW9kZWwoaGFzaGVzW2ldKQogICAgICAgICAgICAgICAgbG9jYWwgcGNvb3JkcyA9IGdldEVudGl0eUNvb3JkcyhnZXRQbGF5ZXJQZWQocGlkKSkKICAgICAgICAgICAgICAgIGxvY2FsIHZlaCA9ICBWRUhJQ0xFLkNSRUFURV9WRUhJQ0xFKGhhc2hlc1tpXSwgcGNvb3Jkcy54LCBwY29vcmRzLnksIHBjb29yZHMueiwgbWF0aC5yYW5kb20oMCwgMzYwKSwgdHJ1ZSwgdHJ1ZSwgZmFsc2UpCiAgICAgICAgICAgICAgICBmb3IgYSA9IDEsIDIwIGRvIE5FVFdPUksuTkVUV09SS19SRVFVRVNUX0NPTlRST0xfT0ZfRU5USVRZKHZlaCkgZW5kCiAgICAgICAgICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX01PRF9LSVQodmVoLCAwKQogICAgICAgICAgICAgICAgZm9yIGogPSAwLCA0OSBkbwogICAgICAgICAgICAgICAgICAgIGxvY2FsIG1vZCA9IFZFSElDTEUuR0VUX05VTV9WRUhJQ0xFX01PRFModmVoLCBqKSAtIDEKICAgICAgICAgICAgICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX01PRCh2ZWgsIGosIG1vZCwgdHJ1ZSkKICAgICAgICAgICAgICAgICAgICBWRUhJQ0xFLlRPR0dMRV9WRUhJQ0xFX01PRCh2ZWgsIG1vZCwgdHJ1ZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZm9yIGogPSAwLCAyMCBkbwogICAgICAgICAgICAgICAgICAgIGlmIFZFSElDTEUuRE9FU19FWFRSQV9FWElTVCh2ZWgsIGopIHRoZW4gVkVISUNMRS5TRVRfVkVISUNMRV9FWFRSQSh2ZWgsIGosIHRydWUpIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX1RZUkVTX0NBTl9CVVJTVCh2ZWgsIGZhbHNlKQogICAgICAgICAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9XSU5ET1dfVElOVCh2ZWgsIDEpCiAgICAgICAgICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX05VTUJFUl9QTEFURV9URVhUX0lOREVYKHZlaCwgMSkKICAgICAgICAgICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfTlVNQkVSX1BMQVRFX1RFWFQodmVoLCAiICIpCiAgICAgICAgICAgICAgICBmb3IgYWkgPSAxLCA1MCBkbwogICAgICAgICAgICAgICAgICAgIE5FVFdPUksuTkVUV09SS19SRVFVRVNUX0NPTlRST0xfT0ZfRU5USVRZKHZlaCkKICAgICAgICAgICAgICAgICAgICBwY29vcmRzID0gZ2V0RW50aXR5Q29vcmRzKGdldFBsYXllclBlZChwaWQpKQogICAgICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQodmVoLCBwY29vcmRzLngsIHBjb29yZHMueSwgcGNvb3Jkcy56LCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICAgICAgICAgIHV0aWwueWllbGQoKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICB2ZWhpY2xlc1sjdmVoaWNsZXMrMV0gPSB2ZWgKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgZW5kCiAgICBpZiBwbGF5ZXJzLmV4aXN0cyhwaWQpIHRoZW4JCiAgICAgICAgICAgIGZvciBwZWRwX2NyYXNoID0gMiAsIDYgZG8KICAgICAgICBwZWRwID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgICAgICBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoVGFyZ2V0UGxheWVyUGVkLCB0cnVlKQogICAgICAgIGR1bmUgPSBjcmVhdGVfdmVoaWNsZSg0MTA4ODI5NTcscG9zLngsIHBvcy55LCBwb3MueixFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKFRhcmdldFBsYXllclBlZCkpCiAgICAgICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04oZHVuZSwgdHJ1ZSkKICAgICAgICBkdW5lMSA9IGNyZWF0ZV92ZWhpY2xlKDI5NzE4NjYzMzYscG9zLngsIHBvcy55LCBwb3MueiwgRU5USVRZLkdFVF9FTlRJVFlfSEVBRElORyhUYXJnZXRQbGF5ZXJQZWQpKQogICAgICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKGR1bmUxLCB0cnVlKQogICAgICAgIGJhcnJhY2tzID0gY3JlYXRlX3ZlaGljbGUoMzYwMjY3NDk3OSxwb3MueCwgcG9zLnksIHBvcy56LCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKFRhcmdldFBsYXllclBlZCkpCiAgICAgICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04oYmFycmFja3MsIHRydWUpCiAgICAgICAgYmFycmFja3MxID0gY3JlYXRlX3ZlaGljbGUoNDQ0NTgzNjc0LHBvcy54LCBwb3MueSwgcG9zLnosIEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcoVGFyZ2V0UGxheWVyUGVkKSkKICAgICAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihiYXJyYWNrczEsIHRydWUpCiAgICAgICAgZHVuZWNhciA9IGNyZWF0ZV92ZWhpY2xlKDI5NzE4NjYzMzYscG9zLngsIHBvcy55LCBwb3MueiwgRU5USVRZLkdFVF9FTlRJVFlfSEVBRElORyhUYXJnZXRQbGF5ZXJQZWQpKQogICAgICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKGR1bmVjYXIsIHRydWUpCiAgICAgICAgZHVuZWNhcjEgPSBjcmVhdGVfdmVoaWNsZSgzNjAyNjc0OTc5LHBvcy54LCBwb3MueSwgcG9zLnosIEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcoVGFyZ2V0UGxheWVyUGVkKSkKICAgICAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihkdW5lY2FyMSwgdHJ1ZSkKICAgICAgICBkdW5lY2FyMiA9IGNyZWF0ZV92ZWhpY2xlKDQ0NDU4MzY3NCxwb3MueCwgcG9zLnksIHBvcy56LCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKFRhcmdldFBsYXllclBlZCkpCiAgICAgICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04oZHVuZWNhcjIsIHRydWUpCiAgICAgICAgYmFycmFja3MzID0gY3JlYXRlX3ZlaGljbGUoNDI0NDQyMDIzNSxwb3MueCwgcG9zLnksIHBvcy56LCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKFRhcmdldFBsYXllclBlZCkpCiAgICAgICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04oYmFycmFja3MzLCB0cnVlKQogICAgICAgIGJhcnJhY2tzMzEgPSBjcmVhdGVfdmVoaWNsZSgzNjAyNjc0OTc5LHBvcy54LCBwb3MueSwgcG9zLnosIEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcoVGFyZ2V0UGxheWVyUGVkKSkKICAgICAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihiYXJyYWNrczMxLCB0cnVlKQogICAgICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWShiYXJyYWNrczMsIGR1bmVjYXIsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIHRydWUsIHRydWUsIHRydWUsIGZhbHNlLCAwLCB0cnVlLCAwKQogICAgICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWShiYXJyYWNrczMxLCBkdW5lY2FyLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCB0cnVlLCB0cnVlLCB0cnVlLCBmYWxzZSwgMCwgdHJ1ZSwgMCkKICAgICAgICBFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkoYmFycmFja3MsIGR1bmVjYXIsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIHRydWUsIHRydWUsIHRydWUsIGZhbHNlLCAwLCB0cnVlLCAwKQogICAgICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWShiYXJyYWNrczEsIGR1bmVjYXIsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIHRydWUsIHRydWUsIHRydWUsIGZhbHNlLCAwLCB0cnVlLCAwKQogICAgICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWShkdW5lLCBkdW5lY2FyLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCB0cnVlLCB0cnVlLCB0cnVlLCBmYWxzZSwgMCwgdHJ1ZSwgMCkKICAgICAgICBFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkoZHVuZTEsIGR1bmVjYXIsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIHRydWUsIHRydWUsIHRydWUsIGZhbHNlLCAwLCB0cnVlLCAwKQogICAgICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWShkdW5lY2FyMSwgZHVuZWNhciwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgZmFsc2UsIDAsIHRydWUsIDApCiAgICAgICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKGR1bmVjYXIyLCBkdW5lY2FyLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCB0cnVlLCB0cnVlLCB0cnVlLCBmYWxzZSwgMCwgdHJ1ZSwgMCkKICAgICAgICBFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkoZHVuZWNhciwgcGVkcCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgZmFsc2UsIDAsIHRydWUsIDApCiAgICAgICAgdXRpbC55aWVsZCg1MDAwKQogICAgICAgIGZvciBpID0gMCwgMTAwICBkbwogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFNfTk9fT0ZGU0VUKGR1bmVjYXIsIHBvcy54LCBwb3MueSwgcG9zLnosIGZhbHNlLCB0cnVlLCB0cnVlKQogICAgICAgICAgICAgICAgdXRpbC55aWVsZCgxMCkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHV0aWwueWllbGQoMjAwMCkKICAgICAgICAgICAgZGVsZXRlX2VudGl0eShkdW5lKQogICAgICAgICAgICBkZWxldGVfZW50aXR5KGR1bmUxKQogICAgICAgICAgICBkZWxldGVfZW50aXR5KGJhcnJhY2tzKQogICAgICAgICAgICBkZWxldGVfZW50aXR5KGJhcnJhY2tzMSkKICAgICAgICAgICAgZGVsZXRlX2VudGl0eShkdW5lY2FyKQogICAgICAgICAgICBkZWxldGVfZW50aXR5KGR1bmVjYXIxKQogICAgICAgICAgICBkZWxldGVfZW50aXR5KGR1bmVjYXIyKQogICAgICAgICAgICBkZWxldGVfZW50aXR5KGJhcnJhY2tzMykKICAgICAgICAgICAgZGVsZXRlX2VudGl0eShiYXJyYWNrczMxKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKLS3lpKfoh6rnhLbltKnmuoMKZnVuY3Rpb24gbmF0dXJlY3Jhc2h2MShwaWQpCiAgICAKICAgIGxvY2FsIHVzZXIgPSBQTEFZRVIuUExBWUVSX0lEKCkKICAgIGxvY2FsIHVzZXJfcGVkID0gUExBWUVSLlBMQVlFUl9QRURfSUQoKQogICAgbG9jYWwgcG9zID0gcGxheWVycy5nZXRfcG9zaXRpb24odXNlcikKCiAgICAgICAgdXRpbC55aWVsZCgxMDApCiAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJpbnZpc2liaWxpdHkgb24iKQogICAgICAgICAgICBmb3IgaSA9IDAsIDExMCBkbwogICAgICAgICAgICAgICAgUExBWUVSLlNFVF9QTEFZRVJfUEFSQUNIVVRFX1BBQ0tfTU9ERUxfT1ZFUlJJREUodXNlciwgMHhGQkY3RDIxRikKICAgICAgICAgICAgICAgIFBFRC5TRVRfUEVEX0NPTVBPTkVOVF9WQVJJQVRJT04odXNlcl9wZWQsIDUsIGksIDAsIDApCiAgICAgICAgICAgICAgICB1dGlsLnlpZWxkKDUwKQogICAgICAgICAgICAgICAgUExBWUVSLkNMRUFSX1BMQVlFUl9QQVJBQ0hVVEVfUEFDS19NT0RFTF9PVkVSUklERSh1c2VyKQogICAgICAgICAgICBlbmQKICAgICAgICB1dGlsLnlpZWxkKDI1MCkKICAgICAgICAgICAgZm9yIGkgPSAxLCA1IGRvCiAgICAgICAgICAgICAgICB1dGlsLnNwb29mX3NjcmlwdCgiZnJlZW1vZGUiLCBTWVNURU0uV0FJVCkKICAgICAgICAgICAgZW5kCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSEVBTFRIKHVzZXJfcGVkLCAwLCAwKQogICAgICAgIE5FVFdPUksuTkVUV09SS19SRVNVUlJFQ1RfTE9DQUxfUExBWUVSKHBvcy54LCBwb3MueSwgcG9zLnosIDAsIGZhbHNlLCBmYWxzZSwgMCkKICAgICAgICBQTEFZRVIuQ0xFQVJfUExBWUVSX1BBUkFDSFVURV9QQUNLX01PREVMX09WRVJSSURFKHVzZXIpCiAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJpbnZpc2liaWxpdHkgb2ZmIikKCmVuZAotLU9Y5bSp5rqDCmZ1bmN0aW9uIE9YY3Jhc2hnZyhwaWQpCiAgICAKICAgIGxvY2FsIFRhcmdldFBsYXllclBlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICBsb2NhbCBUYXJnZXRQbGF5ZXJQb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoVGFyZ2V0UGxheWVyUGVkLCB0cnVlKQogICAgbG9jYWwgUEVEMSA9IGNyZWF0ZV9wZWQoMjYsdXRpbC5qb2FhdCgiY3NfYmV2ZXJseSIpLFRhcmdldFBsYXllclBvcy54LCBUYXJnZXRQbGF5ZXJQb3MueSwgVGFyZ2V0UGxheWVyUG9zLnosIDApCiAgICBFTlRJVFkuU0VUX0VOVElUWV9WSVNJQkxFKFBFRDEsIGZhbHNlLCAwKQogICAgdXRpbC55aWVsZCgxMDApCiAgICAgICAgV0VBUE9OLkdJVkVfV0VBUE9OX1RPX1BFRChQRUQxLC0yNzAwMTU3NzcsODAsdHJ1ZSx0cnVlKQogICAgdXRpbC55aWVsZCgxMDAwKQogICAgICAgIEZJUkUuQUREX09XTkVEX0VYUExPU0lPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBUYXJnZXRQbGF5ZXJQb3MueCwgVGFyZ2V0UGxheWVyUG9zLnksIFRhcmdldFBsYXllclBvcy56LCAyLCA1MCwgdHJ1ZSwgZmFsc2UsIDAuMCkgCiAgICB1dGlsLnlpZWxkKDEwMDAwKQogICAgICAgIGRlbGV0ZV9lbnRpdHkoUEVEMSkKICAgICAgICBpZiBwbGF5ZXJzLmV4aXN0cyhwaWQpIHRoZW4KICAgICAgICAgICAgdXRpbC50b2FzdCgi5pyq6IO956e76Zmk546p5a62LOato+WcqOS9v+eUqGNzX2ZhYmllbuaooeWeiyIpCiAgICAgICAgICAgIGxvY2FsIFBFRDIgPSBjcmVhdGVfcGVkKDI2LHV0aWwuam9hYXQoImNzX2ZhYmllbiIpLFRhcmdldFBsYXllclBvcy54LCBUYXJnZXRQbGF5ZXJQb3MueSwgVGFyZ2V0UGxheWVyUG9zLnosIDApCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1ZJU0lCTEUoUEVEMiwgZmFsc2UsIDApCiAgICAgICAgICAgICAgICB1dGlsLnlpZWxkKDEwMCkKICAgICAgICAgICAgV0VBUE9OLkdJVkVfV0VBUE9OX1RPX1BFRChQRUQyLC0yNzAwMTU3NzcsODAsdHJ1ZSx0cnVlKQogICAgICAgICAgICAgICAgdXRpbC55aWVsZCgxMDAwKQogICAgICAgICAgICBGSVJFLkFERF9PV05FRF9FWFBMT1NJT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgVGFyZ2V0UGxheWVyUG9zLngsIFRhcmdldFBsYXllclBvcy55LCBUYXJnZXRQbGF5ZXJQb3MueiwgMiwgNTAsIHRydWUsIGZhbHNlLCAwLjApCiAgICAgICAgICAgICAgICB1dGlsLnlpZWxkKDUwMDApCiAgICAgICAgICAgIGRlbGV0ZV9lbnRpdHkoUEVEMikKICAgICAgICBlbmQKICAgIGlmIHBsYXllcnMuZXhpc3RzKHBpZCkgdGhlbgogICAgICAgIHV0aWwudG9hc3QoIuacquiDveenu+mZpOeOqeWutizmraPlnKjkvb/nlKhjc19tYW51ZWzmqKHlnosiKQogICAgICAgIGxvY2FsIFBFRDMgPSBjcmVhdGVfcGVkKDI2LHV0aWwuam9hYXQoImNzX21hbnVlbCIpLFRhcmdldFBsYXllclBvcy54LCBUYXJnZXRQbGF5ZXJQb3MueSwgVGFyZ2V0UGxheWVyUG9zLnosIDApCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfVklTSUJMRShQRUQzLCBmYWxzZSwgMCkKICAgICAgICAgICAgdXRpbC55aWVsZCgxMDApCiAgICAgICAgV0VBUE9OLkdJVkVfV0VBUE9OX1RPX1BFRChQRUQzLC0yNzAwMTU3NzcsODAsdHJ1ZSx0cnVlKQogICAgICAgICAgICB1dGlsLnlpZWxkKDEwMDApCiAgICAgICAgRklSRS5BRERfT1dORURfRVhQTE9TSU9OKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIFRhcmdldFBsYXllclBvcy54LCBUYXJnZXRQbGF5ZXJQb3MueSwgVGFyZ2V0UGxheWVyUG9zLnosIDIsIDUwLCB0cnVlLCBmYWxzZSwgMC4wKQogICAgICAgICAgICB1dGlsLnlpZWxkKDUwMDApCiAgICAgICAgZGVsZXRlX2VudGl0eShQRUQzKQogICAgZW5kCiAgICBpZiBwbGF5ZXJzLmV4aXN0cyhwaWQpIHRoZW4KICAgICAgICB1dGlsLnRvYXN0KCLmnKrog73np7vpmaTnjqnlrrYs5q2j5Zyo5L2/55SoY3NfdGFvc3RyYW5zbGF0b3LmqKHlnosiKQogICAgICAgIGxvY2FsIFBFRDQgPSBjcmVhdGVfcGVkKDI2LHV0aWwuam9hYXQoImNzX3Rhb3N0cmFuc2xhdG9yIiksVGFyZ2V0UGxheWVyUG9zLngsIFRhcmdldFBsYXllclBvcy55LCBUYXJnZXRQbGF5ZXJQb3MueiwgMCkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9WSVNJQkxFKFBFRDQsIGZhbHNlLCAwKQogICAgICAgICAgICB1dGlsLnlpZWxkKDEwMCkKICAgICAgICBXRUFQT04uR0lWRV9XRUFQT05fVE9fUEVEKFBFRDQsLTI3MDAxNTc3Nyw4MCx0cnVlLHRydWUpCiAgICAgICAgICAgIHV0aWwueWllbGQoMTAwMCkKICAgICAgICBGSVJFLkFERF9PV05FRF9FWFBMT1NJT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgVGFyZ2V0UGxheWVyUG9zLngsIFRhcmdldFBsYXllclBvcy55LCBUYXJnZXRQbGF5ZXJQb3MueiwgMiwgNTAsIHRydWUsIGZhbHNlLCAwLjApCiAgICAgICAgICAgIHV0aWwueWllbGQoNTAwMCkKICAgICAgICBkZWxldGVfZW50aXR5KFBFRDQpCiAgICBlbmQKICAgIGlmIHBsYXllcnMuZXhpc3RzKHBpZCkgdGhlbgogICAgICAgIHV0aWwudG9hc3QoIuacquiDveenu+mZpOeOqeWutizmraPlnKjkvb/nlKhjc190YW9zdHJhbnNsYXRvcjLmqKHlnosiKQogICAgICAgIGxvY2FsIFBFRDUgPSBjcmVhdGVfcGVkKDI2LHV0aWwuam9hYXQoImNzX3Rhb3N0cmFuc2xhdG9yMiIpLFRhcmdldFBsYXllclBvcy54LCBUYXJnZXRQbGF5ZXJQb3MueSwgVGFyZ2V0UGxheWVyUG9zLnosIDApCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfVklTSUJMRShQRUQ1LCBmYWxzZSwgMCkKICAgICAgICAgICAgdXRpbC55aWVsZCgxMDApCiAgICAgICAgV0VBUE9OLkdJVkVfV0VBUE9OX1RPX1BFRChQRUQ1LC0yNzAwMTU3NzcsODAsdHJ1ZSx0cnVlKQogICAgICAgICAgICB1dGlsLnlpZWxkKDEwMDApCiAgICAgICAgRklSRS5BRERfT1dORURfRVhQTE9TSU9OKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIFRhcmdldFBsYXllclBvcy54LCBUYXJnZXRQbGF5ZXJQb3MueSwgVGFyZ2V0UGxheWVyUG9zLnosIDIsIDUwLCB0cnVlLCBmYWxzZSwgMC4wKQogICAgICAgICAgICB1dGlsLnlpZWxkKDUwMDApCiAgICAgICAgZGVsZXRlX2VudGl0eShQRUQ1KQogICAgZW5kCiAgICBpZiBwbGF5ZXJzLmV4aXN0cyhwaWQpIHRoZW4KICAgICAgICB1dGlsLnRvYXN0KCLmnKrog73np7vpmaTnjqnlrrYs5q2j5Zyo5L2/55SoY3NfdGVubmlzY29hY2jmqKHlnosiKQogICAgICAgIGxvY2FsIFBFRDYgPSBjcmVhdGVfcGVkKDI2LHV0aWwuam9hYXQoImNzX3Rlbm5pc2NvYWNoIiksVGFyZ2V0UGxheWVyUG9zLngsIFRhcmdldFBsYXllclBvcy55LCBUYXJnZXRQbGF5ZXJQb3MueiwgMCkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9WSVNJQkxFKFBFRDYsIGZhbHNlLCAwKQogICAgICAgICAgICB1dGlsLnlpZWxkKDEwMCkKICAgICAgICBXRUFQT04uR0lWRV9XRUFQT05fVE9fUEVEKFBFRDYsLTI3MDAxNTc3Nyw4MCx0cnVlLHRydWUpCiAgICAgICAgICAgIHV0aWwueWllbGQoMTAwMCkKICAgICAgICBGSVJFLkFERF9PV05FRF9FWFBMT1NJT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgVGFyZ2V0UGxheWVyUG9zLngsIFRhcmdldFBsYXllclBvcy55LCBUYXJnZXRQbGF5ZXJQb3MueiwgMiwgNTAsIHRydWUsIGZhbHNlLCAwLjApCiAgICAgICAgICAgIHV0aWwueWllbGQoNTAwMCkKICAgICAgICBkZWxldGVfZW50aXR5KFBFRDYpCiAgICBlbmQKICAgIGlmIHBsYXllcnMuZXhpc3RzKHBpZCkgdGhlbgogICAgICAgIHV0aWwudG9hc3QoIuacquiDveenu+mZpOeOqeWutizmraPlnKjkvb/nlKhjc193YWRl5qih5Z6LIikKICAgICAgICBsb2NhbCBQRUQ3ID0gY3JlYXRlX3BlZCgyNix1dGlsLmpvYWF0KCJjc193YWRlIiksVGFyZ2V0UGxheWVyUG9zLngsIFRhcmdldFBsYXllclBvcy55LCBUYXJnZXRQbGF5ZXJQb3MueiwgMCkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9WSVNJQkxFKFBFRDcsIGZhbHNlLCAwKQogICAgICAgICAgICB1dGlsLnlpZWxkKDEwMCkKICAgICAgICBXRUFQT04uR0lWRV9XRUFQT05fVE9fUEVEKFBFRDcsLTI3MDAxNTc3Nyw4MCx0cnVlLHRydWUpCiAgICAgICAgICAgIHV0aWwueWllbGQoMTAwMCkKICAgICAgICBGSVJFLkFERF9PV05FRF9FWFBMT1NJT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgVGFyZ2V0UGxheWVyUG9zLngsIFRhcmdldFBsYXllclBvcy55LCBUYXJnZXRQbGF5ZXJQb3MueiwgMiwgNTAsIHRydWUsIGZhbHNlLCAwLjApCiAgICAgICAgICAgIHV0aWwueWllbGQoNTAwMCkKICAgICAgICBkZWxldGVfZW50aXR5KFBFRDcpCiAgICBlbmQKICAgIHV0aWwueWllbGQoMjAwMCkKICAgIGlmIG5vdCBwbGF5ZXJzLmV4aXN0cyhwaWQpIHRoZW4KICAgICAgICB1dGlsLnRvYXN0KCLmiJDlip/np7vpmaTnjqnlrrYiKQogICAgZW5kCmVuZAotLS0t5YyX5Z+f5bSp5rqDCmZ1bmN0aW9uIE5vcnRoZXJuX2NyYXNoKHBpZCkKICAgIAogICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpKQogICAgbG9jYWwgbWljaGFlbCA9IHV0aWwuam9hYXQoInBsYXllcl96ZXJvIikKICAgIHJlcXVlc3RfbW9kZWwobWljaGFlbCkKICAgIGxvY2FsIHBlZCA9IGVudGl0aWVzLmNyZWF0ZV9wZWQoMCwgbWljaGFlbCwgcG9zLCAwKQogICAgUEVELlNFVF9QRURfQ09NUE9ORU5UX1ZBUklBVElPTihwZWQsIDAsIDAsIDYsIDApCiAgICBQRUQuU0VUX1BFRF9DT01QT05FTlRfVkFSSUFUSU9OKHBlZCwgMCwgMCwgNSwgMCkKICAgIHV0aWwueWllbGQoKQogICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTKHBlZCwgcG9zLngsIHBvcy55LCBwb3MueiwgdHJ1ZSwgZmFsc2UsIGZhbHNlLCB0cnVlKQogICAgdXRpbC55aWVsZCg1MDApCiAgICBkZWxldGVfZW50aXR5KHBlZCkKZW5kCi0tLS3lm57lvLnltKnmuoMKZnVuY3Rpb24gUmVib3VuZF9jcmFzaChwaWQpCiAgICAKICAgIGxvY2FsIHBlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICBsb2NhbCBwb3MgPSBwbGF5ZXJzLmdldF9wb3NpdGlvbihwaWQpCiAgICBsb2NhbCBtZGwgPSB1dGlsLmpvYWF0KCJtcF9tX2ZyZWVtb2RlXzAxIikKICAgIGxvY2FsIHZlaF9tZGwgPSB1dGlsLmpvYWF0KCJ0YXhpIikKICAgIHJlcXVlc3RfbW9kZWwodmVoX21kbCkKICAgIHJlcXVlc3RfbW9kZWwobWRsKQogICAgICAgIGZvciBpID0gMSwgMTAgZG8KICAgICAgICAgICAgbG9jYWwgdmVoID0gZW50aXRpZXMuY3JlYXRlX3ZlaGljbGUodmVoX21kbCwgcG9zLCAwKQogICAgICAgICAgICBsb2NhbCBqZXN1cyA9IGVudGl0aWVzLmNyZWF0ZV9wZWQoMiwgbWRsLCBwb3MsIDApCiAgICAgICAgICAgIFBFRC5TRVRfUEVEX0lOVE9fVkVISUNMRShqZXN1cywgdmVoLCAtMSkKICAgICAgICAgICAgdXRpbC55aWVsZCgxMDApCiAgICAgICAgICAgIFRBU0suVEFTS19WRUhJQ0xFX0hFTElfUFJPVEVDVChqZXN1cywgdmVoLCBwZWQsIDEwLjAsIDAsIDEwLCAwLCAwKQogICAgICAgICAgICB1dGlsLnlpZWxkKDEwMDApCiAgICAgICAgICAgIGRlbGV0ZV9lbnRpdHkoamVzdXMpCiAgICAgICAgICAgIGRlbGV0ZV9lbnRpdHkodmVoKQogICAgICAgIGVuZCAgCiAgICBTVFJFQU1JTkcuU0VUX01PREVMX0FTX05PX0xPTkdFUl9ORUVERUQobWRsKQogICAgU1RSRUFNSU5HLlNFVF9NT0RFTF9BU19OT19MT05HRVJfTkVFREVEKHZlaF9tZGwpCmVuZAotLS0t6buE5piP5bSp5rqDCmZ1bmN0aW9uIG5pZ2h0ZnVsbF9jcmFzaChwaWQpCiAgICAKICAgIGxvY2FsIHBsYXllciA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICBsb2NhbCBtZGwgPSB1dGlsLmpvYWF0KCJjc190YW9zdHJhbnNsYXRvcjIiKQogICAgcmVxdWVzdF9tb2RlbChtZGwpCiAgICBsb2NhbCBwZWQgPSB7fQogICAgZm9yIGkgPSAxLCAxMCBkbyAKICAgICAgICBsb2NhbCBjb29yZCA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhwbGF5ZXIsIHRydWUpCiAgICAgICAgbG9jYWwgcGVkY29vcmQgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMocGVkW2ldLCBmYWxzZSkKICAgICAgICBwZWRbaV0gPSBlbnRpdGllcy5jcmVhdGVfcGVkKDAsIG1kbCwgY29vcmQsIDApCiAgICAgICAgV0VBUE9OLkdJVkVfREVMQVlFRF9XRUFQT05fVE9fUEVEKHBlZFtpXSwgMHhCMUNBNzdCMSwgMCwgdHJ1ZSkKICAgICAgICBXRUFQT04uU0VUX1BFRF9HQURHRVQocGVkW2ldLCAweEIxQ0E3N0IxLCB0cnVlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1ZJU0lCTEUocGVkW2ldLCB0cnVlKQogICAgICAgIHV0aWwueWllbGQoMjUpCiAgICBlbmQKICAgIHV0aWwueWllbGQoMjUwMCkKICAgIGZvciBpID0gMSwgMTAgZG8KICAgICAgICBkZWxldGVfZW50aXR5KHBlZFtpXSkKICAgICAgICB1dGlsLnlpZWxkKDI1KQogICAgZW5kCmVuZAotLS0tSW5zaGFsbGFoIGNyYXNoCmZ1bmN0aW9uIEluc2hhbGxhaF9jcmFzaChwaWQpCiAgICAKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSkKICAgIGxvY2FsIFBFRDEgID0gY3JlYXRlX3BlZCgyOCwtMTAxMTUzNzU2Mixwb3MueCxwb3MueSxwb3MueiwwKQogICAgbG9jYWwgUEVEMiAgPSBjcmVhdGVfcGVkKDI4LC01NDE3NjI0MzEscG9zLngscG9zLnkscG9zLnosMCkKICAgIFdFQVBPTi5HSVZFX1dFQVBPTl9UT19QRUQoUEVEMSwtMTgxMzg5NzAyNywxLHRydWUsdHJ1ZSkKICAgIFdFQVBPTi5HSVZFX1dFQVBPTl9UT19QRUQoUEVEMiwtMTgxMzg5NzAyNywxLHRydWUsdHJ1ZSkKICAgIHV0aWwueWllbGQoMTAwMCkKICAgIFRBU0suVEFTS19USFJPV19QUk9KRUNUSUxFKFBFRDEscG9zLngscG9zLnkscG9zLnosMCwwKQogICAgVEFTSy5UQVNLX1RIUk9XX1BST0pFQ1RJTEUoUEVEMixwb3MueCxwb3MueSxwb3MueiwwLDApCmVuZAotLeeijueJh+W0qea6gwpmdW5jdGlvbiB2MV9mcmFnKHBpZCkKICAgIAogICAgZm9yIGkgPSAxLCAxMCBkbwogICAgICAgIGxvY2FsIG9iamVjdCA9IGVudGl0aWVzLmNyZWF0ZV9vYmplY3QodXRpbC5qb2FhdCgicHJvcF9mcmFndGVzdF9jbnN0XzA0IiksIEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSkpCiAgICAgICAgT0JKRUNULkJSRUFLX09CSkVDVF9GUkFHTUVOVF9DSElMRChvYmplY3QsIDEsIGZhbHNlKQogICAgZW5kCmVuZAotLS0t5oKy5Lyk55qE6IC256ij5bSp5rqDCmZ1bmN0aW9uIEplc3VzX2NyYXNoKHBpZCkKICAgIAogICAgbG9jYWwgcGVkID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgIGxvY2FsIHBvcyA9IHBsYXllcnMuZ2V0X3Bvc2l0aW9uKHBpZCkKICAgIGxvY2FsIG1kbCA9IHV0aWwuam9hYXQoInVfbV9tX2plc3VzXzAxIikKICAgIGxvY2FsIHZlaF9tZGwgPSB1dGlsLmpvYWF0KCJvcHByZXNzb3IiKQogICAgcmVxdWVzdF9tb2RlbHModmVoX21kbCwgbWRsKQoKICAgIGZvciBpID0gMSwgMTAgZG8KICAgICAgICBsb2NhbCB2ZWggPSBlbnRpdGllcy5jcmVhdGVfdmVoaWNsZSh2ZWhfbWRsLCBwb3MsIDApCiAgICAgICAgbG9jYWwgamVzdXMgPSBlbnRpdGllcy5jcmVhdGVfcGVkKDIsIG1kbCwgcG9zLCAwKQogICAgICAgIFBFRC5TRVRfUEVEX0lOVE9fVkVISUNMRShqZXN1cywgdmVoLCAtMSkKICAgICAgICBUQVNLLlRBU0tfVkVISUNMRV9IRUxJX1BST1RFQ1QoamVzdXMsIHZlaCwgcGVkLCAxMC4wLCAwLCAxMCwgMCwgMCkKICAgICAgICB1dGlsLnlpZWxkKDEwMCkKICAgICAgICBkZWxldGVfZW50aXR5KGplc3VzLCB2ZWgpCiAgICBlbmQKZW5kCi0tTWVtb2ly6LaF57qn5bSp5rqDL3YzCmZ1bmN0aW9uIE1lbW9pcihwaWQpCiAgICAKICAgIFBMQVlFUi5TRVRfUExBWUVSX1BBUkFDSFVURV9QQUNLX01PREVMX09WRVJSSURFKFBMQVlFUi5QTEFZRVJfSUQoKSwweEU1MDIyRDAzKQogICAgVEFTSy5DTEVBUl9QRURfVEFTS1NfSU1NRURJQVRFTFkoUExBWUVSLkdFVF9QTEFZRVJfUEVEX1NDUklQVF9JTkRFWChQTEFZRVIuUExBWUVSX0lEKCkpKQogICAgICAgIHV0aWwueWllbGQoMjApCiAgICBsb2NhbCBwX3BvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSkKICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQoUExBWUVSLkdFVF9QTEFZRVJfUEVEX1NDUklQVF9JTkRFWChQTEFZRVIuUExBWUVSX0lEKCkpLHBfcG9zLngscF9wb3MueSxwX3Bvcy56LGZhbHNlLHRydWUsdHJ1ZSkKICAgIFdFQVBPTi5HSVZFX0RFTEFZRURfV0VBUE9OX1RPX1BFRChQTEFZRVIuR0VUX1BMQVlFUl9QRURfU0NSSVBUX0lOREVYKFBMQVlFUi5QTEFZRVJfSUQoKSksIDB4RkJBQjU3NzYsIDEwMDAsIGZhbHNlKQogICAgVEFTSy5UQVNLX1BBUkFDSFVURV9UT19UQVJHRVQoUExBWUVSLkdFVF9QTEFZRVJfUEVEX1NDUklQVF9JTkRFWChQTEFZRVIuUExBWUVSX0lEKCkpLC0xMDg3LC0zMDEyLDEzLjk0KQogICAgICAgIHV0aWwueWllbGQoNTAwKQogICAgVEFTSy5DTEVBUl9QRURfVEFTS1NfSU1NRURJQVRFTFkoUExBWUVSLkdFVF9QTEFZRVJfUEVEX1NDUklQVF9JTkRFWChQTEFZRVIuUExBWUVSX0lEKCkpKQogICAgICAgIHV0aWwueWllbGQoMTAwMCkKICAgIFBMQVlFUi5DTEVBUl9QTEFZRVJfUEFSQUNIVVRFX1BBQ0tfTU9ERUxfT1ZFUlJJREUoUExBWUVSLlBMQVlFUl9JRCgpKQogICAgVEFTSy5DTEVBUl9QRURfVEFTS1NfSU1NRURJQVRFTFkoUExBWUVSLkdFVF9QTEFZRVJfUEVEX1NDUklQVF9JTkRFWChQTEFZRVIuUExBWUVSX0lEKCkpKQplbmQKLS0t6ay85bSpCmZ1bmN0aW9uIGd1aWJlbmcocGlkKQogICAgCiAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSkKICAgIGxvY2FsIFNwYXduZWRfdHIzID0gY3JlYXRlX3ZlaGljbGUodXRpbC5qb2FhdCgidHIzIiksIHBvcy54LCBwb3MueSwgcG9zLnosIEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkpCiAgICBFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkoU3Bhd25lZF90cjMsIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDAsIDAsIDAsIDAsIDAsIDAsIDAsIHRydWUsIHRydWUsIHRydWUsIGZhbHNlLCAwLCB0cnVlLCAwKQogICAgRU5USVRZLlNFVF9FTlRJVFlfVklTSUJMRShTcGF3bmVkX3RyMywgZmFsc2UsIDApCiAgICBsb2NhbCBTcGF3bmVkX2NoZXJub2JvZyA9IGNyZWF0ZV92ZWhpY2xlKHV0aWwuam9hYXQoImNoZXJub2JvZyIpLCBwb3MueCwgcG9zLnksIHBvcy56LCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpKQogICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKFNwYXduZWRfY2hlcm5vYm9nLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCB0cnVlLCB0cnVlLCB0cnVlLCBmYWxzZSwgMCwgdHJ1ZSwgMCkKICAgIEVOVElUWS5TRVRfRU5USVRZX1ZJU0lCTEUoU3Bhd25lZF9jaGVybm9ib2csIGZhbHNlLCAwKQogICAgbG9jYWwgU3Bhd25lZF9hdmVuZ2VyID0gY3JlYXRlX3ZlaGljbGUodXRpbC5qb2FhdCgiYXZlbmdlciIpLCBwb3MueCwgcG9zLnksIHBvcy56LCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpKQogICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKFNwYXduZWRfYXZlbmdlciwgUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgZmFsc2UsIDAsIHRydWUsIDApCiAgICBFTlRJVFkuU0VUX0VOVElUWV9WSVNJQkxFKFNwYXduZWRfYXZlbmdlciwgZmFsc2UsIDApCiAgICBmb3IgaSA9IDAsIDEwMCBkbwogICAgICAgIGxvY2FsIFRhcmdldFBsYXllclBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSwgdHJ1ZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgVGFyZ2V0UGxheWVyUG9zLngsIFRhcmdldFBsYXllclBvcy55LCBUYXJnZXRQbGF5ZXJQb3MueiwgdHJ1ZSwgZmFsc2UsIGZhbHNlKQogICAgICAgIHV0aWwueWllbGQoMTAgKiBtYXRoLnJhbmRvbSgpKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBUYXJnZXRQbGF5ZXJQb3MueCwgVGFyZ2V0UGxheWVyUG9zLnksIFRhcmdldFBsYXllclBvcy56LCB0cnVlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgdXRpbC55aWVsZCgxMCAqIG1hdGgucmFuZG9tKCkpCiAgICBlbmQKZW5kCgoKCgotLS0t6Ium5Yqb5oCV5bCP5LiRKE1D6YeM55qE54is6KGM6ICFKQpmdW5jdGlvbiBnZXRfcmFuZG9tX29mZnNldF9mcm9tX2VudGl0eShlbnRpdHksIG1pbkRpc3RhbmNlLCBtYXhEaXN0YW5jZSkKCWxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhlbnRpdHksIGZhbHNlKQoJcmV0dXJuIGdldF9yYW5kb21fb2Zmc2V0X2luX3JhbmdlKHBvcywgbWluRGlzdGFuY2UsIG1heERpc3RhbmNlKQplbmQKZnVuY3Rpb24gZ2V0X3JhbmRvbV9vZmZzZXRfaW5fcmFuZ2UoY29vcmRzLCBtaW5EaXN0YW5jZSwgbWF4RGlzdGFuY2UpCglsb2NhbCByYWRpdXMgPSByYW5kb21fZmxvYXQobWluRGlzdGFuY2UsIG1heERpc3RhbmNlKQoJbG9jYWwgYW5nbGUgPSByYW5kb21fZmxvYXQoMCwgMiAqIG1hdGgucGkpCglsb2NhbCBkZWx0YSA9IHYzLm5ldyhtYXRoLmNvcyhhbmdsZSksIG1hdGguc2luKGFuZ2xlKSwgMC4wKQoJZGVsdGE6bXVsKHJhZGl1cykKCWNvb3JkczphZGQoZGVsdGEpCglyZXR1cm4gY29vcmRzCmVuZApmdW5jdGlvbiByYW5kb21fZmxvYXQobWluLCBtYXgpCglyZXR1cm4gbWluICsgbWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4pCmVuZApmdW5jdGlvbiBjcmVlcChwaWQpCiAgICAKICAgIGxvY2FsIGhhc2ggPGNvbnN0PiA9IHV0aWwuam9hYXQoInNfbV95X2Nsb3duXzAxIikKCQlsb2NhbCBleHBsb3Npb24gPGNvbnN0PiA9IEVmZmVjdC5uZXcoInNjcl9yY2JhcnJ5MiIsICJzY3JfZXhwX2Nsb3duIikKCQlsb2NhbCBhcHBlYXJzIDxjb25zdD4gPSBFZmZlY3QubmV3KCJzY3JfcmNiYXJyeTIiLCAgInNjcl9jbG93bl9hcHBlYXJzIikKCQlyZXF1ZXN0X21vZGVsKGhhc2gpCgkJbG9jYWwgcGxheWVyID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKCQlsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMocGxheWVyLCBmYWxzZSkKCQlsb2NhbCBjb29yZCA9IGdldF9yYW5kb21fb2Zmc2V0X2Zyb21fZW50aXR5KHBsYXllciwgNS4wLCA4LjApCgkJY29vcmQueiA9IGNvb3JkLnogLSAxLjAKCQlsb2NhbCBwZWQgPSBlbnRpdGllcy5jcmVhdGVfcGVkKDAsIGhhc2gsIGNvb3JkLCAwLjApCgkJcmVxdWVzdF9wdGZ4X2Fzc2V0KGFwcGVhcnMuYXNzZXQpCgkJR1JBUEhJQ1MuVVNFX1BBUlRJQ0xFX0ZYX0FTU0VUKGFwcGVhcnMuYXNzZXQpCgkJR1JBUEhJQ1MuU1RBUlRfTkVUV09SS0VEX1BBUlRJQ0xFX0ZYX05PTl9MT09QRURfT05fRU5USVRZKAoJCQlhcHBlYXJzLm5hbWUsCgkJCXBlZCwKCQkJMC4wLCAwLjAsIC0xLjAsCgkJCTAuMCwgMC4wLCAwLjAsCgkJCTAuNSwgZmFsc2UsIGZhbHNlLCBmYWxzZQoJCSkKCQlzZXRfZW50aXR5X2ZhY2VfZW50aXR5KHBlZCwgcGxheWVyLCBmYWxzZSkKCQlQRUQuU0VUX0JMT0NLSU5HX09GX05PTl9URU1QT1JBUllfRVZFTlRTKHBlZCwgdHJ1ZSkKCQlUQVNLLlRBU0tfR09fVE9fQ09PUkRfQU5ZX01FQU5TKHBlZCwgcG9zLngsIHBvcy55LCBwb3MueiwgNS4wLCAwLCBmYWxzZSwgMCwgMC4wKQoJCWxvY2FsIGRlc3QgPSBwb3MKCQlQRUQuU0VUX1BFRF9LRUVQX1RBU0socGVkLCB0cnVlKQoJCUFVRElPLlNUT1BfUEVEX1NQRUFLSU5HKHBlZCwgdHJ1ZSkKCQl1dGlsLmNyZWF0ZV90aWNrX2hhbmRsZXIoZnVuY3Rpb24oKQoJCQlwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMocGVkLCB0cnVlKQoJCQlsb2NhbCB0YXJnZXRQb3MgPSBwbGF5ZXJzLmdldF9wb3NpdGlvbihwaWQpCgkJCWlmIG5vdCBFTlRJVFkuRE9FU19FTlRJVFlfRVhJU1QocGVkKSBvciBQRUQuSVNfUEVEX0ZBVEFMTFlfSU5KVVJFRChwZWQpIHRoZW4KCQkJCXJldHVybiBmYWxzZQoJCQllbHNlaWYgcG9zOmRpc3RhbmNlKHRhcmdldFBvcykgPiAxNTAgYW5kCgkJCXJlcXVlc3RfY29udHJvbChwZWQpIHRoZW4KCQkJCWRlbGV0ZV9lbnRpdHkocGVkKQoJCQkJcmV0dXJuIGZhbHNlCgkJCWVsc2VpZiBwb3M6ZGlzdGFuY2UodGFyZ2V0UG9zKSA8IDMuMCBhbmQgcmVxdWVzdF9jb250cm9sKHBlZCkgdGhlbgoJCQkJcmVxdWVzdF9wdGZ4X2Fzc2V0KGV4cGxvc2lvbi5hc3NldCkKCQkJCUdSQVBISUNTLlVTRV9QQVJUSUNMRV9GWF9BU1NFVChleHBsb3Npb24uYXNzZXQpCgkJCQlHUkFQSElDUy5TVEFSVF9ORVRXT1JLRURfUEFSVElDTEVfRlhfTk9OX0xPT1BFRF9BVF9DT09SRCgKCQkJCQlleHBsb3Npb24ubmFtZSwKCQkJCQlwb3MueCwgcG9zLnksIHBvcy56LAoJCQkJCTAuMCwgMC4wLCAwLjAsCgkJCQkJMS4wLAoJCQkJCWZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlCgkJCQkpCgkJCQlGSVJFLkFERF9FWFBMT1NJT04ocG9zLngsIHBvcy55LCBwb3MueiwgMCwgMS4wLCB0cnVlLCB0cnVlLCAxLjAsIGZhbHNlKQoJCQkJRU5USVRZLlNFVF9FTlRJVFlfVklTSUJMRShwZWQsIGZhbHNlLCBmYWxzZSkKCQkJCWRlbGV0ZV9lbnRpdHkocGVkKQoJCQkJcmV0dXJuIGZhbHNlCgkJCWVsc2VpZiB0YXJnZXRQb3M6ZGlzdGFuY2UoZGVzdCkgPiAzLjAgYW5kIHJlcXVlc3RfY29udHJvbChwZWQpIHRoZW4KCQkJCWRlc3QgPSB0YXJnZXRQb3MKCQkJCVRBU0suVEFTS19HT19UT19DT09SRF9BTllfTUVBTlMocGVkLCB0YXJnZXRQb3MueCwgdGFyZ2V0UG9zLnksIHRhcmdldFBvcy56LCA1LjAsIDAsIGZhbHNlLCAwLCAwLjApCgkJCWVuZAoJCWVuZCkKZW5kCgoKLS0tLS0tLS0tLS0tLS0tLS0t6L295YW35p6qCmxvY2FsIHNldEludG9WZWhpY2xlID0gZmFsc2UKbG9jYWwgdmVoZ3VuX2hhbmRsZSA9IDAKbG9jYWwgdmVoZ3VuX0hhc2ggPSBNSVNDLkdFVF9IQVNIX0tFWShPYmp2ZWhpY2xlc1sxXSkKZnVuY3Rpb24gVmVoaWNsZV9ndW5fb3B0KG9wdCkKICAgIGxvY2FsIHZlaGljbGUgPSBPYmp2ZWhpY2xlc1tvcHRdCiAgICB2ZWhndW5fSGFzaCA9IHV0aWwuam9hYXQodmVoaWNsZSkKZW5kCmZ1bmN0aW9uIFZlaGljbGVfZ3VuX2ludG8odG9nZ2xlKQogICAgc2V0SW50b1ZlaGljbGUgPSB0b2dnbGUKZW5kCmZ1bmN0aW9uIFZlaGljbGVfZ3VuKCkKICAgIGxvY2FsIGNhbVJvdCA9IENBTS5HRVRfR0FNRVBMQVlfQ0FNX1JPVCgwKQogICAgbG9jYWwgY29vcmRzID0gZ2V0X29mZnNldF9mcm9tX2NhbWVyYSgxNi4wKQogICAgaWYgUExBWUVSLklTX1BMQVlFUl9GUkVFX0FJTUlORyhQTEFZRVIuUExBWUVSX0lEKCkpIHRoZW4KICAgICAgICBpZiBub3QgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKHZlaGd1bl9oYW5kbGUpIHRoZW4KICAgICAgICAgICAgdmVoZ3VuX2hhbmRsZSA9IGNyZWF0ZV92ZWhpY2xlKHZlaGd1bl9IYXNoLCBjb29yZHMueCwgY29vcmRzLnksIGNvb3Jkcy56LCBjYW1Sb3QueikKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQUxQSEEodmVoZ3VuX2hhbmRsZSwgMTUzLCB0cnVlKQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT0xMSVNJT04odmVoZ3VuX2hhbmRsZSwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICBFTlRJVFkuU0VUX0NBTl9DTElNQl9PTl9FTlRJVFkodmVoZ3VuX2hhbmRsZSwgZmFsc2UpCiAgICAgICAgZWxzZQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFNfTk9fT0ZGU0VUKHZlaGd1bl9oYW5kbGUsIGNvb3Jkcy54LCBjb29yZHMueSwgY29vcmRzLnosIGZhbHNlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKHZlaGd1bl9oYW5kbGUsIGNhbVJvdC54LCBjYW1Sb3QueSwgY2FtUm90LnosIDAsIHRydWUpCiAgICAgICAgZW5kCiAgICBlbHNlaWYgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKHZlaGd1bl9oYW5kbGUpIHRoZW4gCiAgICAgICAgZGVsZXRlX2VudGl0eSh2ZWhndW5faGFuZGxlKQogICAgZW5kCiAgICBpZiBQRUQuSVNfUEVEX1NIT09USU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpIHRoZW4KICAgICAgICBsb2NhbCB2ZWggPSBjcmVhdGVfdmVoaWNsZSh2ZWhndW5fSGFzaCwgY29vcmRzLngsIGNvb3Jkcy55LCBjb29yZHMueiwgY2FtUm90LnopCiAgICAgICAgTkVUV09SSy5TRVRfTkVUV09SS19JRF9FWElTVFNfT05fQUxMX01BQ0hJTkVTKE5FVFdPUksuVkVIX1RPX05FVCh2ZWgpLCB0cnVlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQodmVoLCBjb29yZHMueCwgY29vcmRzLnksIGNvb3Jkcy56LCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKHZlaCwgY2FtUm90LngsIGNhbVJvdC55LCBjYW1Sb3QueiwgMCwgdHJ1ZSkKICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0ZPUldBUkRfU1BFRUQodmVoLCAyMDAuMCkKICAgICAgICBpZiBub3Qgc2V0SW50b1ZlaGljbGUgdGhlbgogICAgICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0RPT1JTX0xPQ0tFRCh2ZWgsIDIpCiAgICAgICAgZWxzZQogICAgICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0VOR0lORV9PTih2ZWgsIHRydWUsIHRydWUsIHRydWUpCiAgICAgICAgICAgIFBFRC5TRVRfUEVEX0lOVE9fVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB2ZWgsIC0xKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKCi0tLS0g5a6a5LmJ5omp5bGV54mI5Yev5pKS5Yqg5a+G5pSv5oyB5omA5pyJ5Y+v5omT5Y2w5a2X56ymCmZ1bmN0aW9uIGNhZXNhckVuY3J5cHQodGV4dCwgc2hpZnQpCiAgICBsb2NhbCByZXN1bHQgPSAiIgogICAgZm9yIGkgPSAxLCAjdGV4dCBkbwogICAgICAgIGxvY2FsIGNoYXIgPSB0ZXh0OnN1YihpLCBpKQogICAgICAgIGxvY2FsIGJ5dGUgPSBzdHJpbmcuYnl0ZShjaGFyKQogICAgICAgIC0tIOWPquWKoOWvhuWPr+aJk+WNsOeahCBBU0NJSSDlrZfnrKYgKDMyLTEyNikKICAgICAgICBpZiBieXRlID49IDMyIGFuZCBieXRlIDw9IDEyNiB0aGVuCiAgICAgICAgICAgIC0tIOS9jeenu+W5tuW+queOrwogICAgICAgICAgICBsb2NhbCBzaGlmdGVkID0gKGJ5dGUgLSAzMiArIHNoaWZ0KSAlIDk1ICsgMzIKICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0IC4uIHN0cmluZy5jaGFyKHNoaWZ0ZWQpCiAgICAgICAgZWxzZQogICAgICAgICAgICAtLSDkuI3lj6/miZPljbDlrZfnrKbkv53mjIHkuI3lj5gKICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0IC4uIGNoYXIKICAgICAgICBlbmQKICAgIGVuZAogICAgcmV0dXJuIHJlc3VsdAplbmQKLS0g5a6a5LmJ5Yev5pKS6Kej5a+G5Ye95pWwCmZ1bmN0aW9uIGNhZXNhckRlY3J5cHQodGV4dCwgc2hpZnQpCiAgICBsb2NhbCByZXN1bHQgPSAiIgogICAgZm9yIGkgPSAxLCAjdGV4dCBkbwogICAgICAgIGxvY2FsIGNoYXIgPSB0ZXh0OnN1YihpLCBpKQogICAgICAgIGxvY2FsIGJ5dGUgPSBzdHJpbmcuYnl0ZShjaGFyKQogICAgICAgIC0tIOWPquino+WvhuWPr+aJk+WNsOeahCBBU0NJSSDlrZfnrKYgKDMyLTEyNikKICAgICAgICBpZiBieXRlID49IDMyIGFuZCBieXRlIDw9IDEyNiB0aGVuCiAgICAgICAgICAgIC0tIOWPjeWQkeS9jeenu+W5tuW+queOrwogICAgICAgICAgICBsb2NhbCBzaGlmdGVkID0gKGJ5dGUgLSAzMiAtIHNoaWZ0KSAlIDk1ICsgMzIKICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0IC4uIHN0cmluZy5jaGFyKHNoaWZ0ZWQpCiAgICAgICAgZWxzZQogICAgICAgICAgICAtLSDkuI3lj6/miZPljbDlrZfnrKbkv53mjIHkuI3lj5gKICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0IC4uIGNoYXIKICAgICAgICBlbmQKICAgIGVuZAogICAgcmV0dXJuIHJlc3VsdAplbmQKCgotLS0t5pS75Ye75Ziy6K69CmxvY2FsIFVfaGFja19saXN0ID0ge30KbG9jYWwgdGF1bnRfdGV4dCA9ICLkvaDmraPlnKjmlLvlh7vlsIrotLXnmoRHVEE15Zyo57q/5bCP5Yqp5omL55So5oi3ISDor7flgZzmraLkvaDnmoTmgbbmhI/ooYzkuLpcbi0tLS0tLS0twqZTYWt1cmEiCmZ1bmN0aW9uIGNoYW5nZV9yaWRpY3VsZSgpCiAgICBsb2NhbCBsYWJlbCA9IHV0aWwucmVnaXN0ZXJfbGFiZWwoIuWYsuiuveWGheWuuSIpCiAgICBsb2NhbCBpbnB1dCA9IGdldF9pbnB1dF9mcm9tX3NjcmVlbl9rZXlib2FyZChsYWJlbCwgNTAsIHRhdW50X3RleHQpCiAgICBpZiBpbnB1dCA9PSAiIiB0aGVuIHJldHVybiBlbmQKICAgIHRhdW50X3RleHQgPSBpbnB1dAplbmQKZnVuY3Rpb24gQXR0YWNrX3JpZGljdWxlKCkKICAgIC0tLS3liKTmlq3mlLvlh7sKICAgIGZvciBfLCBwaWQgaW4gaXBhaXJzKHBsYXllcnMubGlzdChmYWxzZSwgdHJ1ZSwgdHJ1ZSkpIGRvCiAgICAgICAgaWYgcGxheWVycy5pc19tYXJrZWRfYXNfYXR0YWNrZXIocGlkLFNZU1RFTS5TSElGVF9MRUZUKDB4MDMsIDEpKSBvciBwbGF5ZXJzLmlzX21hcmtlZF9hc19hdHRhY2tlcihwaWQsU1lTVEVNLlNISUZUX0xFRlQoMHgwNCwgMSkpIG9yIHBsYXllcnMuaXNfbWFya2VkX2FzX2F0dGFja2VyKHBpZCxTWVNURU0uU0hJRlRfTEVGVCgweDA1LCAxKSkgb3IgcGxheWVycy5pc19tYXJrZWRfYXNfYXR0YWNrZXIocGlkLFNZU1RFTS5TSElGVF9MRUZUKDB4MEMsIDEpKSBvciBwbGF5ZXJzLmlzX21hcmtlZF9hc19hdHRhY2tlcihwaWQsU1lTVEVNLlNISUZUX0xFRlQoMHgwRCwgMSkpIG9yIHBsYXllcnMuaXNfbWFya2VkX2FzX2F0dGFja2VyKHBpZCxTWVNURU0uU0hJRlRfTEVGVCgweDBFLCAxKSkgdGhlbgogICAgICAgICAgICBpZiBub3QgdGFibGVfZmluZChVX2hhY2tfbGlzdCwgcGlkKSB0aGVuCiAgICAgICAgICAgICAgICBjaGF0LnNlbmRfbWVzc2FnZShQTEFZRVIuR0VUX1BMQVlFUl9OQU1FKHBpZCkuLnRhdW50X3RleHQsZmFsc2UsdHJ1ZSx0cnVlKQogICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KFVfaGFja19saXN0LCBwaWQpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCiAgICAtLS0t6YeN572u6K6w5b2VCiAgICBmb3IgaSwgSUQgaW4gcGFpcnMoVV9oYWNrX2xpc3QpIGRvCiAgICAgICAgaWYgUExBWUVSLkdFVF9QTEFZRVJfUEVEKElEKSA9PSAwIHRoZW4KICAgICAgICAgICAgVV9oYWNrX2xpc3RbaV0gPSBuaWwKICAgICAgICBlbmQKICAgIGVuZAplbmQKCgotLSDlkK/nlKgv56aB55So5ZG85Ye655S16K+dCmZ1bmN0aW9uIGNlbGxwaG9uZV9zdGF0ZSh0b2dnbGUpCiAgICBsb2NhbCBjZWxscGhvbmVfc2NyaXB0ID0gImNlbGxwaG9uZV9jb250cm9sbGVyIgogICAgbG9jYWwgY2VsbHBob25lX2hhc2ggPSB1dGlsLmpvYWF0KGNlbGxwaG9uZV9zY3JpcHQpCiAgICBpZiB0b2dnbGUgdGhlbgogICAgICAgIC0tZW5hYmxlLCByZXN0YXJ0IHNjcmlwdAogICAgICAgIGlmIFNDUklQVC5HRVRfTlVNQkVSX09GX1RIUkVBRFNfUlVOTklOR19USEVfU0NSSVBUX1dJVEhfVEhJU19IQVNIKGNlbGxwaG9uZV9oYXNoKSA8PSAwIHRoZW4KICAgICAgICAgICAgU0NSSVBUMS5SRVFVRVNUX1NDUklQVChjZWxscGhvbmVfc2NyaXB0KQogICAgICAgICAgICBpZiBTQ1JJUFQxLkhBU19TQ1JJUFRfTE9BREVEKGNlbGxwaG9uZV9zY3JpcHQpIHRoZW4KICAgICAgICAgICAgICAgIFNZU1RFTS5TVEFSVF9ORVdfU0NSSVBUKGNlbGxwaG9uZV9zY3JpcHQsIDE0MjQpCiAgICAgICAgICAgICAgICBTQ1JJUFQxLlNFVF9TQ1JJUFRfQVNfTk9fTE9OR0VSX05FRURFRChjZWxscGhvbmVfc2NyaXB0KQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICAtLWRpc2FibGUKICAgICAgICBpZiBTQ1JJUFQuR0VUX05VTUJFUl9PRl9USFJFQURTX1JVTk5JTkdfVEhFX1NDUklQVF9XSVRIX1RISVNfSEFTSChjZWxscGhvbmVfaGFzaCkgPiAwIHRoZW4KICAgICAgICAgICAgTUlTQy5URVJNSU5BVEVfQUxMX1NDUklQVFNfV0lUSF9USElTX05BTUUoY2VsbHBob25lX3NjcmlwdCkKICAgICAgICBlbmQKICAgIGVuZAplbmQKCi0tLS3nu4jmnoHnlKjmiLfmo4DmtYsKbG9jYWwgY29tcGxldGVfbG9ja2VkID0gZmFsc2UKVWx0aW1hdGVVc2VyID0ge30KZnVuY3Rpb24gaXNfVWx0aW1hdGVVc2VyKHBpZCkKICAgIHJldHVybiB0cnVlCmVuZApmdW5jdGlvbiBsb2NrYXBwKCkKICAgIGZvciBrLCB2ZWwgaW4gcGFpcnMoYXBwbWVudS5VbHRpb24pIGRvCiAgICAgICAgaWYgKHZlbC52aXNpYmxlIH49IG5pbCkgYW5kICh2ZWwudmlzaWJsZSB+PSAiIikgdGhlbgogICAgICAgICAgICB2ZWwudmlzaWJsZSA9IGZhbHNlCiAgICAgICAgZW5kCiAgICBlbmQKICAgIGNvbXBsZXRlX2xvY2tlZCA9IHRydWUKZW5kCmZ1bmN0aW9uIHVzZXJmdW5jKCkKICAgIC0t5pmu6YCa55So5oi3CiAgICBpZiBub3QgaXNfVWx0aW1hdGVVc2VyKFBMQVlFUi5QTEFZRVJfSUQoKSkgdGhlbgogICAgICAgIC0t5bm/5ZGK5bGV56S6CiAgICAgICAgaWYgb3MudGltZSgpIDwgMTc1ODczOTk1MCB0aGVuCiAgICAgICAgICAgIG5vdGlmaWNhdGlvbihzdHJpbmcuZm9ybWF0KCJ+Ym9sZH4lcyIsICJodHRwczovL2Z1emh1emhpamlhLnZpcCIpLCBIdWRDb2xvdXIuYmx1ZSwgIn55fuaXp+aipuWNoee9kSIpCiAgICAgICAgZW5kCiAgICAgICAgaWYgb3MudGltZSgpIDwgMTc1ODczOTk1MCB0aGVuCiAgICAgICAgICAgIG5vdGlmaWNhdGlvbihzdHJpbmcuZm9ybWF0KCJ+Ym9sZH4lcyIsICLlrprliLblub/lkYrkvY3lpoLmnpzkvaDpnIDopoHlj6/nm7TmjqXogZTns7vlkYblkYYiKSwgSHVkQ29sb3VyLmJsdWUsICJ+eX7pgJrnn6UiKQogICAgICAgIGVuZAogICAgICAgIC0t5rWL6K+V54mILOW9k+mcgOimgea1i+ivleaXtuW8gOWQrwogICAgICAgIC0tdXRpbC5zdG9wX3NjcmlwdCgpCiAgICBlbmQKICAgIC0tVWx0aW1hdGVVc2VyCiAgICBpZiBpc19VbHRpbWF0ZVVzZXIoUExBWUVSLlBMQVlFUl9JRCgpKSB0aGVuCiAgICAgICAgLS3lip/og73lvIDlj5HkuI7plIHlrpoKICAgICAgICB1dGlsLmNyZWF0ZV90aWNrX2hhbmRsZXIoZnVuY3Rpb24oKQogICAgICAgICAgICAtLee7iOaegeW8gOaUvuaJqeWxlQogICAgICAgICAgICBmb3IgaywgdmVsIGluIHBhaXJzKGFwcG1lbnUuVWx0aW9uKSBkbwogICAgICAgICAgICAgICAgaWYgKHZlbC52aXNpYmxlIH49IG5pbCkgYW5kICh2ZWwudmlzaWJsZSB+PSAiIikgdGhlbgogICAgICAgICAgICAgICAgICAgIHZlbC52aXNpYmxlID0gdHJ1ZQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICAtLemUgeWumuaJqeWxlQogICAgICAgICAgICBmb3IgaywgdmVsIGluIHBhaXJzKGFwcG1lbnUuVWx0aW9mZikgZG8KICAgICAgICAgICAgICAgIGlmICh2ZWwudmlzaWJsZSB+PSBuaWwpIGFuZCAodmVsLnZpc2libGUgfj0gIiIpIHRoZW4KICAgICAgICAgICAgICAgICAgICB2ZWwudmlzaWJsZSA9IGZhbHNlCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIC0tLS3op6PplIHnu5PmnZ/lgZzmraLnur/nqIsKICAgICAgICAgICAgaWYgY29tcGxldGVfbG9ja2VkIHRoZW4gcmV0dXJuIGZhbHNlIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAplbmQKLS3or7fmsYLnlKjmiLcKdXRpbC5jcmVhdGVfdGhyZWFkKGZ1bmN0aW9uKCkKICAgIGxvY2FsIE15VXNlcgogICAgbm90aWZ5KCLor7fnqI3nrYkiKQogICAgYXN5bmNfaHR0cC5pbml0KCJodHRwOi8vZ3RhLmNuc2FrdXJhLnRvcCIsICIvYXBpLnBocCIsZnVuY3Rpb24oaW5mbyxoZWFkZXIscmVzcG9uc2UpCiAgICAgICAgaWYgcmVzcG9uc2UgPT0gMjAwIHRoZW4KICAgICAgICAgICAgTXlVc2VyID0gSnNvblRvVGFibGUoaW5mbykKICAgICAgICAgICAgaWYgTXlVc2VyID09IHt9IG9yIE15VXNlciA9PSBuaWwgb3IgTXlVc2VyID09ICIiIHRoZW4gCiAgICAgICAgICAgICAgICB1dGlsLnRvYXN0KCLouqvku73op6PmnpDlvILluLgiKQogICAgICAgICAgICAgICAgdXRpbC5zdG9wX3NjcmlwdCgpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBVbHRpbWF0ZVVzZXIgPSBNeVVzZXIKICAgICAgICAgICAgaWYgaXNfVWx0aW1hdGVVc2VyKFBMQVlFUi5QTEFZRVJfSUQoKSkgdGhlbgogICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uKCJ+eX5+Ym9sZH4g5bey5r+A5rS7VWx0aW1hdGXouqvku70iLCBIdWRDb2xvdXIuYmx1ZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHVzZXJmdW5jKCkKICAgICAgICAgICAgdXRpbC5jcmVhdGVfdGlja19oYW5kbGVyKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGlmIFVsdGltYXRlVXNlciB+PSBNeVVzZXIgdGhlbiAtLemYsuevoeaUuQogICAgICAgICAgICAgICAgICAgIFVsdGltYXRlVXNlciA9IE15VXNlcgogICAgICAgICAgICAgICAgICAgIHV0aWwueWllbGQoMTAwMCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQpCiAgICAgICAgZWxzZQogICAgICAgICAgICB1dGlsLnRvYXN0KCLml6Dms5Xpqozor4Houqvku70iKQogICAgICAgICAgICB1dGlsLnN0b3Bfc2NyaXB0KCkKICAgICAgICBlbmQKICAgIGVuZCwgZnVuY3Rpb24ocmVhc29uKQogICAgICAgIHV0aWwudG9hc3QoIuivt+axguWPkemAgeWksei0pSIpCiAgICAgICAgdXRpbC5zdG9wX3NjcmlwdCgpCiAgICBlbmQpO2FzeW5jX2h0dHAuZGlzcGF0Y2goKQplbmQpCgoKLS0tLeeJiOacrOajgOa1iwpmdW5jdGlvbiBjaGVja19nYW1lX3ZlcnNpb24oKQogICAgbG9jYWwgZ3ZlcnNpb24gPSAxLjY5CiAgICBsb2NhbCBvbmxpbmVfdiA9IHRvbnVtYmVyKE5FVFdPUksuR0VUX09OTElORV9WRVJTSU9OKCkpCiAgICBpZiBvbmxpbmVfdiA+IGd2ZXJzaW9uIHRoZW4KICAgICAgICBub3RpZmljYXRpb24oIn55fn5ib2xkfiDlvZPliY3niYjmnKzlt7LkuI3lho3lrozlhajpgILphY3muLjmiI/niYjmnKwiLCBIdWRDb2xvdXIuYmx1ZSkKICAgIGVuZAplbmQKLS0tLeeJiOacrOmqjOivgQphc3luY19odHRwLmluaXQoImh0dHA6Ly9jaGVjay5jbnNha3VyYS50b3AiLCAiL3N0YW5kL3ZlcnNpb25zLnR4dCIsZnVuY3Rpb24oYm9keSwgaGVhZGVyX2ZpZWxkcywgc3RhdHVzKQogICAgaWYgc3RhdHVzID09IDIwMCBhbmQgYm9keSB+PSBuaWwgdGhlbgogICAgICAgIGxvY2FsIHZlcnNpb24gPSB0b251bWJlcihib2R5Om1hdGNoKCIoLiopOi4qIikpIC0t5L2/55So5qih5byP5Yy56YWN5om+5Yiw5YaS5Y+35Y+K5YW25bem6L6555qE6YOo5YiGCiAgICAgICAgaWYgdmVyc2lvbiA+IFNDUklQVF9WRVJTSU9OIHRoZW4KICAgICAgICAgICAgbm90aWZpY2F0aW9uKCJ+eX5+Ym9sZH7mo4DmtYvliLDmm7TmlrA9Lj0iLCBIdWRDb2xvdXIuYmx1ZSkKICAgICAgICAgICAgdXRpbC5zdG9wX3NjcmlwdCgpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kKTthc3luY19odHRwLmRpc3BhdGNoKCkKCgotLS0t5Yab5ryU6L2w54K4CmZ1bmN0aW9uIE1pbGl0YXJ5X2V4ZXJjaXNlcygpCiAgICBsb2NhbCBwb3MgPSB2My5uZXcoKQogICAgaWYgV0VBUE9OLkdFVF9QRURfTEFTVF9XRUFQT05fSU1QQUNUX0NPT1JEKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHBvcykgdGhlbgoKICAgICAgICAtLemjnuacunBlZOWIm+W7ugogICAgICAgIGxvY2FsIHBlZHQgPSB7fQogICAgICAgIGxvY2FsIHBsYW5ldCA9IHt9CiAgICAgICAgbG9jYWwgZHJpdmVycyA9IHt9CiAgICAgICAgZm9yIGkgPSAxLCAxMiBkbwoKICAgICAgICAgICAgLS3nlJ/miJDnm67moIcKICAgICAgICAgICAgcGVkdFtpXSA9IGNyZWF0ZV9wZWQoMSwgLTkyNzI2MTEwMiwgcG9zLnggKyBtYXRoLnJhbmRvbSgtMTAsIDEwKSwgcG9zLnkgKyBtYXRoLnJhbmRvbSgtMTAsIDEwKSwgcG9zLnosIG1hdGgucmFuZG9tKDM2MCkpCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1ZJU0lCTEUocGVkdFtpXSwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKHBlZHRbaV0sdHJ1ZSkKICAgICAgICAgICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04ocGVkdFtpXSwgdHJ1ZSkKICAgICAgICAgICAgY2FsbV9wZWQocGVkdFtpXSwgdHJ1ZSkKCiAgICAgICAgICAgIC0t55Sf5oiQ6aOe5py6CiAgICAgICAgICAgIGxvY2FsIGVuZF9wb3MgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMocGVkdFsxXSwgMCwgNTAwLCAzMDApCiAgICAgICAgICAgIGxvY2FsIHN0YXJ0X3BvcyA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhwZWR0WzFdLCAwICsgbWF0aC5yYW5kb20oLTIwLCAyMCksIC0yMDAwICsgbWF0aC5yYW5kb20oLTIwLCAyMCksIDMwMCkKICAgICAgICAgICAgcGxhbmV0W2ldID0gY3JlYXRlX3ZlaGljbGUodXRpbC5qb2FhdCgiTGF6ZXIiKSwgc3RhcnRfcG9zLngsIHN0YXJ0X3Bvcy55LCBzdGFydF9wb3MueiwgMCkKICAgICAgICAgICAgc2V0X2VudGl0eV9mYWNlX2VudGl0eShwbGFuZXRbaV0sIHBlZHRbMV0pCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0lOVklOQ0lCTEUocGxhbmV0W2ldLHRydWUpCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPTExJU0lPTihwbGFuZXRbaV0sIGZhbHNlLCB0cnVlKQogICAgICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0VOR0lORV9PTihwbGFuZXRbaV0sIHRydWUsIHRydWUsIDApCgogICAgICAgICAgICAtLeWIm+W7uumjnuacuumpvumptuWRmOW5tumpvumptgogICAgICAgICAgICBkcml2ZXJzW2ldID0gUEVELkNSRUFURV9SQU5ET01fUEVEX0FTX0RSSVZFUihwbGFuZXRbaV0sIDEpCiAgICAgICAgICAgIFBFRC5TRVRfQkxPQ0tJTkdfT0ZfTk9OX1RFTVBPUkFSWV9FVkVOVFMoZHJpdmVyc1tpXSwgdHJ1ZSkKICAgICAgICAgICAgVEFTSy5UQVNLX1BMQU5FX01JU1NJT04oZHJpdmVyc1tpXSwgcGxhbmV0W2ldLCAwLCAwLCBlbmRfcG9zLngsIGVuZF9wb3MueSwgZW5kX3Bvcy56LCA0LCA4MC4wLCA1MC4wLCAtMS4wLCA0MDAuMCwgMzAwLjAsIHRydWUpCiAgICAgICAgICAgIFBFRC5TRVRfUEVEX0tFRVBfVEFTSyhkcml2ZXJzW2ldLCB0cnVlKQoKICAgICAgICAgICAgUEVELlNFVF9QRURfQ09NQkFUX0FCSUxJVFkoZHJpdmVyc1tpXSwgMykKICAgICAgICAgICAgUEVELlNFVF9QRURfQ09NQkFUX1JBTkdFKGRyaXZlcnNbaV0sIDQpCiAgICAgICAgICAgIFBFRC5TRVRfUEVEX1NFRUlOR19SQU5HRShkcml2ZXJzW2ldLCAxMDAwKQogICAgICAgICAgICBQRUQuU0VUX1BFRF9IRUFSSU5HX1JBTkdFKGRyaXZlcnNbaV0sIDEwMDApCiAgICAgICAgICAgIFRBU0suVEFTS19DT01CQVRfUEVEKGRyaXZlcnNbaV0sIHBlZHRbaV0sIDAsIDE2KQogICAgICAgIGVuZAoKICAgICAgICAtLemihuWktOmjnuacuuWFieaghwogICAgICAgIGxvY2FsIGJsaXAgPSBIVUQuQUREX0JMSVBfRk9SX0VOVElUWShwbGFuZXRbMV0pCiAgICAgICAgSFVELlNFVF9CTElQX0NPTE9VUihibGlwLCA1KQogICAgICAgIC0t5Yib5bu655u45py6CiAgICAgICAgbG9jYWwgQ2FtID0gQ0FNLkNSRUFURV9DQU1FUkEoMjYzNzk5NDUsIHRydWUpCiAgICAgICAgQ0FNLkhBUkRfQVRUQUNIX0NBTV9UT19FTlRJVFkoQ2FtLCBwbGFuZXRbNV0sIC0xMCwgMCwgMCwgMCwgLTEwLCA2LCB0cnVlKQogICAgICAgIHV0aWwuc2hvd19jb3JuZXJfaGVscChzdHJpbmcuZm9ybWF0KCLmjInkuIsgfiVzfiDliIfmjaLpo57mnLrop4bop5IiLCJJTlBVVF9WRUhfSE9STiIpKQogICAgICAgIHdoaWxlIHRydWUgZG8KCiAgICAgICAgICAgIC0t5o6n5Yi26aOe5py66Lev5b6E5ZKM6YCf5bqmCiAgICAgICAgICAgIGZvciBpID0gMSwgMTIgZG8KICAgICAgICAgICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRk9SV0FSRF9TUEVFRChwbGFuZXRbaV0sIDIwMCAvIDMuNikKICAgICAgICAgICAgICAgIHNldF9lbnRpdHlfZmFjZV9lbnRpdHkocGxhbmV0W2ldLCBwZWR0WzFdLCBmYWxzZSkKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAtLee7mOWItui3neemuwogICAgICAgICAgICBsb2NhbCBkaXNhID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHBsYW5ldFsxXSkKICAgICAgICAgICAgbG9jYWwgZGlzYiA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhwZWR0WzFdKQogICAgICAgICAgICBsb2NhbCBkaXN0YW5jZSA9IEdldF9kaXN0YW5jZShkaXNhLCBkaXNiLCBmYWxzZSkKICAgICAgICAgICAgZHJhd19zdHJpbmcoIn5ifuWWt+awlOacuui3neemuyB+d34iLi5tYXRoLmZsb29yKGRpc3RhbmNlKS4uIiDnsbMiLCAwLjAzLCAwLjIsIDAuNCwgMSkKCiAgICAgICAgICAgIC0t55u45py65o6n5Yi2CiAgICAgICAgICAgIGlmIFBBRC5JU19DT05UUk9MX1BSRVNTRUQoMCwgNDYpIHRoZW4KICAgICAgICAgICAgICAgIENBTS5SRU5ERVJfU0NSSVBUX0NBTVModHJ1ZSwgZmFsc2UsIDMwMDAsIDEsIDAsIDApCiAgICAgICAgICAgICAgICBDQU0uU0hBS0VfQ0FNKENhbSwgIkRSVU5LX1NIQUtFIiwgMSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIC0t5oGi5aSN55u45py6CiAgICAgICAgICAgIGlmIGRpc3RhbmNlIDwgMTAwMCB0aGVuCiAgICAgICAgICAgICAgICBDQU0uUkVOREVSX1NDUklQVF9DQU1TKGZhbHNlLCBmYWxzZSwgMzAwMCwgMSwgMCwgMCkKICAgICAgICAgICAgICAgIENBTS5ERVNUUk9ZX0NBTShDYW0sIHRydWUpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgZGlzdGFuY2UgPCAyMCB0aGVuCiAgICAgICAgICAgICAgICBmb3IgaSA9IDEsIDEyIGRvCiAgICAgICAgICAgICAgICAgICAgZGVsZXRlX2VudGl0eShkcml2ZXJzW2ldKQogICAgICAgICAgICAgICAgICAgIGRlbGV0ZV9lbnRpdHkocGxhbmV0W2ldKQogICAgICAgICAgICAgICAgICAgIGRlbGV0ZV9lbnRpdHkocGVkdFtpXSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIG5vdCBFTlRJVFkuRE9FU19FTlRJVFlfRVhJU1QocGxhbmV0WzFdKSB0aGVuCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBlbmQKICAgICAgICAgICAgdXRpbC55aWVsZCgpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgotLS0tSVDmn6Xor6IKZnVuY3Rpb24gUXVlcnlJUChJUCkKICAgIGxvY2FsIHRhYiA9IHN0cmluZy5zcGxpdChJUCwiLiIpCiAgICBpZiAjdGFiIH49IDQgb3IgdG9udW1iZXIoc3RyaW5nLmZvcm1hdCh0YWJbMV0pKSA+IDI1NSBvciB0b251bWJlcihzdHJpbmcuZm9ybWF0KHRhYlsxXSkpIDwgMSB0aGVuCiAgICAgICAgbm90aWZpY2F0aW9uKCJ+eX5+Ym9sZH7plK7lhaVJUOS4jeWQiOazlSEiLCBIdWRDb2xvdXIuYmx1ZSkKICAgICAgICByZXR1cm4KICAgIGVuZAogICAgYXN5bmNfaHR0cC5pbml0KCJodHRwOi8vaXAtYXBpLmNvbSIsIi9qc29uLyIuLklQIC4uICI/bGFuZz16aC1DTiIsZnVuY3Rpb24oaW5mbyxoZWFkZXIscmVzcG9uc2UpCiAgICAgICAgaWYgcmVzcG9uc2UgPT0gMjAwIGFuZCBpbmZvIH49ICIiIHRoZW4KICAgICAgICAgICAgbG9jYWwgSVB0YWJsZSA9IEpzb25Ub1RhYmxlKGluZm8pCiAgICAgICAgICAgIGlmIElQdGFibGUuc3RhdHVzID09ICJzdWNjZXNzIiB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBzdHIgPSAifnl+SVA6IH53fiIgLi4gSVB0YWJsZS5xdWVyeSAuLiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJcbn55fuWbveWutjogfnd+IiAuLiBJUHRhYmxlLmNvdW50cnkgLi4gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiXG5+eX7lm73lrrbku6PnoIE6IH53fiIgLi4gSVB0YWJsZS5jb3VudHJ5Q29kZSAuLiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJcbn55fuWMuuWfnzogfnd+IiAuLiBJUHRhYmxlLnJlZ2lvbiAuLiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJcbn55fuWMuuWfn+WQjeensDogfnd+IiAuLiBJUHRhYmxlLnJlZ2lvbk5hbWUgLi4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICJcbn55fuWfjuW4gjogfnd+IiAuLiBJUHRhYmxlLmNpdHkgLi4gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiXG5+eX7pgq7mlL/nvJbnoIE6IH53fiIgLi4gSVB0YWJsZS56aXAgLi4gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiXG5+eX7ml7bljLo6IH53fiIgLi4gSVB0YWJsZS50aW1lem9uZSAuLiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJcbn55fklTUDogfnd+IiAuLiBJUHRhYmxlLmlzcCAuLiAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJcbn55fuaXtuWMujogfnd+IiAuLiBJUHRhYmxlLnRpbWV6b25lCiAgICAgICAgICAgICAgICBub3RpZnkoc3RyKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCk7YXN5bmNfaHR0cC5kaXNwYXRjaCgpCmVuZAoKCi0tLS3ot53nprvmr5TkvovlsLoKZnVuY3Rpb24gb3ZlcnJpZGVfbG9kc2NhbGUodmFsKQogICAgd2hpbGUgdmFsIGRvCiAgICAgICAgaWYgdmFsIH49IDEgdGhlbgogICAgICAgICAgICBTVFJFQU1JTkcuT1ZFUlJJREVfTE9EU0NBTEVfVEhJU19GUkFNRSh2YWwpCiAgICAgICAgZWxzZQogICAgICAgICAgICBicmVhawogICAgICAgIGVuZAogICAgICAgIHV0aWwueWllbGQoKQogICAgZW5kCmVuZAoKLS0tLeatu+S6oeitpuWRigpmdW5jdGlvbiBkZWFkX3dhcm5pbmcoKQogICAgaWYgRU5USVRZLklTX0VOVElUWV9ERUFEKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpIHRoZW4KICAgICAgICBsb2NhbCBzdHJpbmdzID0gIn5vfuS4jeeOqeWOn+elnlxu5q275LqG5ZCnLX5vfiIuLlBMQVlFUi5HRVRfUExBWUVSX05BTUUoUExBWUVSLlBMQVlFUl9JRCgpKQogICAgICAgIGxvY2FsIHNjYWxlZm9ybV9tb3ZpZSA9IEdSQVBISUNTLlJFUVVFU1RfU0NBTEVGT1JNX01PVklFKCJNUF9CSUdfTUVTU0FHRV9GUkVFTU9ERSIpCiAgICAgICAgR1JBUEhJQ1MuQkVHSU5fU0NBTEVGT1JNX01PVklFX01FVEhPRChzY2FsZWZvcm1fbW92aWUsICJTSE9XX1NIQVJEX1dBU1RFRF9NUF9NRVNTQUdFIikKICAgICAgICBHUkFQSElDUy5EUkFXX1NDQUxFRk9STV9NT1ZJRShzY2FsZWZvcm1fbW92aWUsIDAuNSwgMC41LCAxLCAxLCAyNTUsIDIyNSwgMjU1LCAyNTUpCiAgICAgICAgR1JBUEhJQ1MuU0NBTEVGT1JNX01PVklFX01FVEhPRF9BRERfUEFSQU1fVEVYVFVSRV9OQU1FX1NUUklORyhzdHJpbmdzKQogICAgICAgIEdSQVBISUNTLkVORF9TQ0FMRUZPUk1fTU9WSUVfTUVUSE9EKHNjYWxlZm9ybV9tb3ZpZSkKICAgIGVuZAplbmQKCi0tLei9veWFt+i3s+i3gwpmdW5jdGlvbiBnZXRfdmVoaWNsZV9wbGF5ZXJfaXNfaW4ocGxheWVyKQoJbG9jYWwgdGFyZ2V0UGVkID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEX1NDUklQVF9JTkRFWChwbGF5ZXIpCglpZiBQRUQuSVNfUEVEX0lOX0FOWV9WRUhJQ0xFKHRhcmdldFBlZCwgZmFsc2UpIHRoZW4KCQlyZXR1cm4gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19JTih0YXJnZXRQZWQsIGZhbHNlKQoJZW5kCglyZXR1cm4gMAplbmQKCi0t5Y+R6YCB5bSU5L2bCmZ1bmN0aW9uIGFkZEJsaXBGb3JFbnRpdHkoZW50aXR5LCBibGlwU3ByaXRlLCBjb2xvdXIpCglsb2NhbCBibGlwID0gSFVELkFERF9CTElQX0ZPUl9FTlRJVFkoZW50aXR5KQoJSFVELlNFVF9CTElQX1NQUklURShibGlwLCBibGlwU3ByaXRlKQoJSFVELlNFVF9CTElQX0NPTE9VUihibGlwLCBjb2xvdXIpCglIVUQuU0hPV19IRUlHSFRfT05fQkxJUChibGlwLCBmYWxzZSkKCUhVRC5TRVRfQkxJUF9ST1RBVElPTihibGlwLCBTWVNURU0uQ0VJTChFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKGVudGl0eSkpKQoJTkVUV09SSy5TRVRfTkVUV09SS19JRF9DQU5fTUlHUkFURShlbnRpdHksIGZhbHNlKQoJdXRpbC5jcmVhdGVfdGhyZWFkKGZ1bmN0aW9uKCkKCQl3aGlsZSBub3QgRU5USVRZLklTX0VOVElUWV9ERUFEKGVudGl0eSkgZG8KCQkJbG9jYWwgaGVhZGluZyA9IEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcoZW50aXR5KQoJCQlIVUQuU0VUX0JMSVBfUk9UQVRJT04oYmxpcCwgU1lTVEVNLkNFSUwoaGVhZGluZykpCgkJCXV0aWwueWllbGQoKQoJCQlpZiBFTlRJVFkuSVNfRU5USVRZX0RFQUQoZW50aXR5KSBvciBFTlRJVFkuSVNfRU5USVRZX0RFQUQoZW50aXR5KSBvciBub3QgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKGVudGl0eSkgb3IgVkVISUNMRS5HRVRfVkVISUNMRV9FTkdJTkVfSEVBTFRIKGVudGl0eSkgPD0gMCB0aGVuCgkJCQl1dGlsLnJlbW92ZV9ibGlwKGJsaXApCgkJCQl1dGlsLnlpZWxkKCkKCQkJZW5kCgkJZW5kCgllbmQpCglyZXR1cm4gYmxpcAplbmQKZnVuY3Rpb24gZ2V0T2Zmc2V0RnJvbUVudGl0eUdpdmVuRGlzdGFuY2UoZW50aXR5LCBkaXN0YW5jZSkKCWxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhlbnRpdHksIDApCglsb2NhbCB0aGV0YSA9IChtYXRoLnJhbmRvbSgpICsgbWF0aC5yYW5kb20oMCwgMSkpICogbWF0aC5waSAtLXJldHVybnMgYSByYW5kb20gYW5nbGUgYmV0d2VlbiAwIGFuZCAycGkgKGV4Y2x1c2l2ZSkKCWxvY2FsIGNvb3JkcyA9IHZlY3RvcjMubmV3KHBvcy54ICsgZGlzdGFuY2UgKiBtYXRoLmNvcyh0aGV0YSkscG9zLnkgKyBkaXN0YW5jZSAqIG1hdGguc2luKHRoZXRhKSxwb3MueikKCXJldHVybiBjb29yZHMKZW5kCmZ1bmN0aW9uIHNlbmRfQW5ncnlfVHJldm9yKHBpZCkKICAgIAogICAgbG9jYWwgdmVoaWNsZUhhc2ggPSB1dGlsLmpvYWF0KCJib2RoaTIiKQogICAgbG9jYWwgcGVkSGFzaCA9IC0xNjg2MDQwNjcwCiAgICByZXF1ZXN0X21vZGVscyh2ZWhpY2xlSGFzaCwgcGVkSGFzaCkKICAgIGxvY2FsIHRhcmdldFBlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFModGFyZ2V0UGVkKQogICAgbG9jYWwgdmVoaWNsZSA9IGVudGl0aWVzLmNyZWF0ZV92ZWhpY2xlKHZlaGljbGVIYXNoLCBwb3MsIENBTS5HRVRfR0FNRVBMQVlfQ0FNX1JPVCgwKS56KQogICAgaWYgbm90IEVOVElUWS5ET0VTX0VOVElUWV9FWElTVCh2ZWhpY2xlKSB0aGVuCiAgICAgICAgcmV0dXJuCiAgICBlbmQKICAgIGxvY2FsIG9mZnNldCA9IGdldE9mZnNldEZyb21FbnRpdHlHaXZlbkRpc3RhbmNlKHZlaGljbGUsIDUwLjApCiAgICBsb2NhbCBvdXRDb29yZHMgPSB2My5uZXcoKQogICAgbG9jYWwgb3V0SGVhZGluZyA9IG1lbW9yeS5hbGxvYygpCiAgICBpZiBQQVRIRklORC5HRVRfQ0xPU0VTVF9WRUhJQ0xFX05PREVfV0lUSF9IRUFESU5HKG9mZnNldC54LCBvZmZzZXQueSwgb2Zmc2V0LnosIG91dENvb3Jkcywgb3V0SGVhZGluZywgMSwgMy4wLCAwKSB0aGVuCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTKHZlaGljbGUsIHYzLmdldFgob3V0Q29vcmRzKSwgdjMuZ2V0WShvdXRDb29yZHMpLCB2My5nZXRaKG91dENvb3JkcykpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSEVBRElORyh2ZWhpY2xlLCBtZW1vcnkucmVhZF9mbG9hdChvdXRIZWFkaW5nKSkKICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX1NJUkVOKHZlaGljbGUsIHRydWUpCiAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9FTkdJTkVfT04odmVoaWNsZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkKICAgICAgICBmb3Igc2VhdCA9IC0xLCAtMSBkbwogICAgICAgICAgICBsb2NhbCBjb3AgPSBlbnRpdGllcy5jcmVhdGVfcGVkKDIsIHBlZEhhc2gsIG91dENvb3JkcywgQ0FNLkdFVF9HQU1FUExBWV9DQU1fUk9UKDApLnopCiAgICAgICAgICAgIGFkZEJsaXBGb3JFbnRpdHkodmVoaWNsZSwgNzI0LCAxNykKICAgICAgICAgICAgUEVELlNFVF9QRURfSU5UT19WRUhJQ0xFKGNvcCwgdmVoaWNsZSwgc2VhdCkKICAgICAgICAgICAgVEFTSy5UQVNLX0NPTUJBVF9QRUQoY29wLCB0YXJnZXRQZWQsIDAsIDE2KQogICAgICAgICAgICBQRUQuU0VUX1BFRF9LRUVQX1RBU0soY29wLCB0cnVlKQogICAgICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0NPTE9VUlModmVoaWNsZSwgMzIsIDMyKQogICAgICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0RPT1JTX0xPQ0tFRF9GT1JfTk9OX1NDUklQVF9QTEFZRVJTKHZlaGljbGUsIHRydWUpCiAgICAgICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRE9PUlNfTE9DS0VEKHZlaGljbGUsLTEsIDMpCiAgICAgICAgICAgIFBFRC5TRVRfUEVEX0NPTUJBVF9BVFRSSUJVVEVTKGNvcCwgNDYsIHRydWUpCiAgICAgICAgICAgIFBFRC5TRVRfUEVEX0NPTUJBVF9BVFRSSUJVVEVTKGNvcCwgMywgZmFsc2UpCiAgICAgICAgICAgIFBFRC5TRVRfQkxPQ0tJTkdfT0ZfTk9OX1RFTVBPUkFSWV9FVkVOVFMoY29wLCB0cnVlKQogICAgICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX05VTUJFUl9QTEFURV9URVhUKHZlaGljbGUsICJCZXR0eSAzMiIpCiAgICAgICAgICAgIFZFSElDTEUuTU9ESUZZX1ZFSElDTEVfVE9QX1NQRUVEKHZlaGljbGUsIDUwKQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKGNvcCwgdHJ1ZSkKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRSh2ZWhpY2xlLCB0cnVlKQogICAgICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX05VTUJFUl9QTEFURV9URVhUX0lOREVYKHZlaGljbGUsIDApCiAgICAgICAgICAgIFBFRC5TRVRfUEVEX05FVkVSX0xFQVZFU19HUk9VUChjb3AsIHRydWUpCiAgICAgICAgICAgIFRBU0suVEFTS19WRUhJQ0xFX01JU1NJT05fUEVEX1RBUkdFVChjb3AsIHZlaGljbGUsIHRhcmdldFBlZCwgNiwgMTAwLCAwLCAwLCAwLCB0cnVlKQogICAgICAgIGVuZAogICAgICAgIGZvciBzZWF0MiA9IDAsIDAgZG8gLS0ybmQgaW52aXNpYmxlIHRyZXZvciB0byBpbnN1bHQgdGhlIHBsYXllciBkdWUgdG8gZ3RhIGJlaW5nIGd0YSAtIGFuZCB0aGUgZmFjdCB0aGF0IGFuIG5wYyBjYW50IGhhdmUgMiB0YXNrcyBBRkFJSwogICAgICAgICAgICBsb2NhbCB0cmV2ID0gZW50aXRpZXMuY3JlYXRlX3BlZCgyLCBwZWRIYXNoLCBvdXRDb29yZHMsIENBTS5HRVRfR0FNRVBMQVlfQ0FNX1JPVCgwKS56KQogICAgICAgICAgICBQRUQuU0VUX1BFRF9JTlRPX1ZFSElDTEUodHJldiwgdmVoaWNsZSwgc2VhdDIpCiAgICAgICAgICAgIFBFRC5TRVRfUEVEX0NPTUJBVF9BVFRSSUJVVEVTKHRyZXYsIDMsIGZhbHNlKQogICAgICAgICAgICBQRUQuU0VUX1BFRF9DT01CQVRfQVRUUklCVVRFUyh0cmV2LCA0NiwgdHJ1ZSkKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfVklTSUJMRSh0cmV2LCBmYWxzZSwgMCkKICAgICAgICAgICAgVEFTSy5UQVNLX0NPTUJBVF9QRUQodHJldiwgdGFyZ2V0UGVkLCAwLCAxNikKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRSh0cmV2LCB0cnVlKQogICAgICAgICAgICBQRUQuU0VUX0JMT0NLSU5HX09GX05PTl9URU1QT1JBUllfRVZFTlRTKHRyZXYsIHRydWUpCiAgICAgICAgZW5kCiAgICBlbmQKICAgIFNUUkVBTUlORy5TRVRfTU9ERUxfQVNfTk9fTE9OR0VSX05FRURFRChwZWRIYXNoKQogICAgU1RSRUFNSU5HLlNFVF9NT0RFTF9BU19OT19MT05HRVJfTkVFREVEKHZlaGljbGVIYXNoKQplbmQKCgoKCi0tLS3niZvovaYKZnVuY3Rpb24gcmlkZV9jb3coKQogICAgbG9jYWwgcGxheWVyX2hlYWRpbmcgPSBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICBsb2NhbCBwbGF5ZXJfY29vcmRzID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICBsb2NhbCB2ZWggPSBjcmVhdGVfdmVoaWNsZSgxNjQxNDYyNDEyLCBwbGF5ZXJfY29vcmRzLngsIHBsYXllcl9jb29yZHMueSwgcGxheWVyX2Nvb3Jkcy56LCBwbGF5ZXJfaGVhZGluZykKICAgIEVOVElUWS5TRVRfRU5USVRZX1ZJU0lCTEUodmVoLCBmYWxzZSwgMCkKICAgIEVOVElUWS5TRVRfRU5USVRZX0lOVklOQ0lCTEUodmVoLCB0cnVlKQogICAgbG9jYWwgcmlkZXIgPSBjcmVhdGVfcGVkKDI5LCA0MjQ0MjgyOTEwLCBwbGF5ZXJfY29vcmRzLngsIHBsYXllcl9jb29yZHMueSwgcGxheWVyX2Nvb3Jkcy56LCBwbGF5ZXJfaGVhZGluZykKICAgIFBFRC5TRVRfUEVEX0lOVE9fVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB2ZWgsIC0xKQogICAgbG9jYWwgYm9uZSA9IFBFRC5HRVRfUEVEX0JPTkVfSU5ERVgocmlkZXIsIDB4Nzk2ZSkKICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWShyaWRlciwgdmVoLCBib25lLCAwLCAtMSwgMC41LCAwLCAwLCAwLCB0cnVlLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCAxLCB0cnVlLCAwKQogICAgUEVELlNFVF9QRURfQ09ORklHX0ZMQUcocmlkZXIsIDIwOCwgdHJ1ZSkKICAgIFBFRC5TRVRfQkxPQ0tJTkdfT0ZfTk9OX1RFTVBPUkFSWV9FVkVOVFMocmlkZXIsIHRydWUpCiAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKHJpZGVyLCB0cnVlKQplbmQKCgotLS0t54+N54+g54Of6IqxCmZ1bmN0aW9uIFBlYXJsX2ZpcmV3b3JrcygpCiAgICBsb2NhbCBhbmltbGliID0gJ2FuaW1AbXBfZmlyZXdvcmtzJwogICAgbG9jYWwgYW5pbV9uYW1lID0gJ3BsYWNlX2ZpcmV3b3JrXzNfYm94JwogICAgcmVxdWVzdF9hbmltX2RpY3QoYW5pbWxpYikKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwLjAsIDAuNTIsIDAuMCkKICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUpCiAgICBUQVNLLlRBU0tfUExBWV9BTklNKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGFuaW1saWIsIGFuaW1fbmFtZSwgLTEsIC04LjAsIDMwMDAsIDAsIDAsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCiAgICB1dGlsLnlpZWxkKDE1MDApCiAgICBsb2NhbCBib3ggPSBjcmVhdGVfb2JqZWN0KC04NzkwNTIzNDUsIHBvcy54LCBwb3MueSwgcG9zLnopCiAgICBsb2NhbCBib3hfcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKGJveCkKICAgIE9CSkVDVC5QTEFDRV9PQkpFQ1RfT05fR1JPVU5EX1BST1BFUkxZKGJveCkKICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKQogICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04oYm94LCB0cnVlKQogICAgdXRpbC55aWVsZCg1MDAwKQoKICAgIGxvY2FsIGVmZmVjdCA9ICJzY3JfaW5kZXBfZmlyZXdvcmtzIgogICAgbG9jYWwgZWZmZWN0X25hbWUgPSAic2NyX2luZGVwX2ZpcmV3b3JrX2ZvdW50YWluIgogICAgcmVxdWVzdF9wdGZ4X2Fzc2V0KGVmZmVjdCkKICAgIC0t56ys5LiA6Zi25q61CiAgICBmb3IgaSA9IDEsIDIwIGRvCiAgICAgICAgbG9jYWwgYyA9IG1hdGguY2VpbChpIC8gNSkgLyAxMDAgLS0057qnKOmAkOatpeS/ruaUueeDn+iKseWwuuWvuCkKICAgICAgICBHUkFQSElDUy5VU0VfUEFSVElDTEVfRlhfQVNTRVQoZWZmZWN0KQogICAgICAgIEdSQVBISUNTLlNUQVJUX05FVFdPUktFRF9QQVJUSUNMRV9GWF9OT05fTE9PUEVEX09OX0VOVElUWShlZmZlY3RfbmFtZSwgYm94LCAwLCAwLCAwLjIsIDAsIDE4MCwgMCwgYywgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkKICAgICAgICBHUkFQSElDUy5TRVRfUEFSVElDTEVfRlhfTk9OX0xPT1BFRF9DT0xPVVIoMjI2IC8gMjU1LCAxNyAvIDI1NSwgMTIgLyAyNTUpCiAgICAgICAgdXRpbC55aWVsZCgxMDApCiAgICBlbmQKICAgIC0t56ys5LqM6Zi25q61CiAgICBsb2NhbCBlbmRfdGltZSA9IG9zLnRpbWUoKSArIDEwCiAgICB3aGlsZSBlbmRfdGltZSA+PSBvcy50aW1lKCkgZG8KICAgICAgICBHUkFQSElDUy5VU0VfUEFSVElDTEVfRlhfQVNTRVQoZWZmZWN0KQogICAgICAgIEdSQVBISUNTLlNUQVJUX05FVFdPUktFRF9QQVJUSUNMRV9GWF9OT05fTE9PUEVEX09OX0VOVElUWShlZmZlY3RfbmFtZSwgYm94LCAwLCAwLCAwLjIsIDAsIDE4MCwgMCwgMC4wOCwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkKICAgICAgICBHUkFQSElDUy5TVEFSVF9ORVRXT1JLRURfUEFSVElDTEVfRlhfTk9OX0xPT1BFRF9PTl9FTlRJVFkoZWZmZWN0X25hbWUsIGJveCwgMCwgMCwgMC4yLCAwLCAxODAsIDAsIDAuMDgsIHRydWUsIHRydWUsIHRydWUpCiAgICAgICAgR1JBUEhJQ1MuU0VUX1BBUlRJQ0xFX0ZYX05PTl9MT09QRURfQ09MT1VSKG1hdGgucmFuZG9tKDAsIDI1NSkgLyAyNTUsIG1hdGgucmFuZG9tKDAsIDI1NSkgLyAyNTUsIG1hdGgucmFuZG9tKDAsIDI1NSkgLyAyNTUpCiAgICAgICAgdXRpbC55aWVsZCgxMDApCiAgICBlbmQKICAgIHV0aWwueWllbGQoODAwMCkKICAgIGRlbGV0ZV9lbnRpdHkoYm94KQplbmQKCi0t54Of6Iqx5qG2CmxvY2FsIHBsYWNlZF9maXJld29ya19ib3hlcyA9IHt9CmZ1bmN0aW9uIGFuZmFuZ3lhbmh1YSgpCiAgICBsb2NhbCBhbmltbGliID0gJ2FuaW1AbXBfZmlyZXdvcmtzJwogICAgbG9jYWwgYW5pbV9uYW1lID0gJ3BsYWNlX2ZpcmV3b3JrXzNfYm94JwogICAgcmVxdWVzdF9hbmltX2RpY3QoYW5pbWxpYikKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwLjAsIDAuNTIsIDAuMCkKICAgIGxvY2FsIHBlZCA9IFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkKICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKHBlZCwgdHJ1ZSkKICAgIFRBU0suVEFTS19QTEFZX0FOSU0ocGVkLCBhbmltbGliLCBhbmltX25hbWUsIC0xLCAtOC4wLCAzMDAwLCAwLCAwLCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgdXRpbC55aWVsZCgxNTAwKQogICAgbG9jYWwgZmlyZXdvcmtfYm94ID0gZW50aXRpZXMuY3JlYXRlX29iamVjdCh1dGlsLmpvYWF0KCdpbmRfcHJvcF9maXJld29ya18wMycpLCBwb3MsIHRydWUsIGZhbHNlLCBmYWxzZSkKICAgIGxvY2FsIGZpcmV3b3JrX2JveF9wb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoZmlyZXdvcmtfYm94KQogICAgT0JKRUNULlBMQUNFX09CSkVDVF9PTl9HUk9VTkRfUFJPUEVSTFkoZmlyZXdvcmtfYm94KQogICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04ocGVkLCBmYWxzZSkKICAgIHV0aWwueWllbGQoMTAwMCkKICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKGZpcmV3b3JrX2JveCwgdHJ1ZSkKICAgIHBsYWNlZF9maXJld29ya19ib3hlc1sjcGxhY2VkX2ZpcmV3b3JrX2JveGVzICsgMV0gPSBmaXJld29ya19ib3gKZW5kCmZ1bmN0aW9uIHlhbmh1YWZhc2hlKCkKICAgIGlmICNwbGFjZWRfZmlyZXdvcmtfYm94ZXMgPT0gMCB0aGVuIAogICAgICAgIHV0aWwudG9hc3QoIuivt+WFiOWuieaUvueDn+iKsSEiKQogICAgICAgIHJldHVybiAKICAgIGVuZAogICAgbG9jYWwgcHRmeF9hc3NldCA9ICJzY3JfaW5kZXBfZmlyZXdvcmtzIgogICAgbG9jYWwgZWZmZWN0X25hbWUgPSAic2NyX2luZGVwX2ZpcmV3b3JrX3RyYWlsYnVyc3QiCiAgICByZXF1ZXN0X3B0ZnhfYXNzZXQocHRmeF9hc3NldCkKICAgIHV0aWwudG9hc3QoIueDn+iKseWPkeWwhHdvdyIpCiAgICBmb3IgaSA9IDEsIDUwIGRvCiAgICAgICAgZm9yIGssIGJveCBpbiBwYWlycyhwbGFjZWRfZmlyZXdvcmtfYm94ZXMpIGRvIAogICAgICAgICAgICBHUkFQSElDUy5VU0VfUEFSVElDTEVfRlhfQVNTRVQocHRmeF9hc3NldCkKICAgICAgICAgICAgR1JBUEhJQ1MuU1RBUlRfTkVUV09SS0VEX1BBUlRJQ0xFX0ZYX05PTl9MT09QRURfT05fRU5USVRZKGVmZmVjdF9uYW1lLCBib3gsIDAsIDAsIDAsIDAsIDE4MCwgMCwgMSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkKICAgICAgICAgICAgR1JBUEhJQ1MuU0VUX1BBUlRJQ0xFX0ZYX05PTl9MT09QRURfQ09MT1VSKG1hdGgucmFuZG9tKDAsIDI1NSkgLyAyNTUsIG1hdGgucmFuZG9tKDAsIDI1NSkgLyAyNTUsIG1hdGgucmFuZG9tKDAsIDI1NSkgLyAyNTUpCiAgICAgICAgICAgIHV0aWwueWllbGQoMTAwKQogICAgICAgIGVuZAogICAgZW5kCiAgICBmb3IgaywgYm94IGluIHBhaXJzKHBsYWNlZF9maXJld29ya19ib3hlcykgZG8gCiAgICAgICAgZGVsZXRlX2VudGl0eShib3gpCiAgICBlbmQKICAgIHBsYWNlZF9maXJld29ya19ib3hlcyA9IHt9CmVuZAoKCi0tLS0tLS0tLS3lpbPmrabnpZ7lr7zlvLkKZnVuY3Rpb24gbnZ3dXNoZW4odG9nZ2xlKQpnVXNpbmdWYWxrUm9ja2V0ID0gdG9nZ2xlCiAgICBpZiBnVXNpbmdWYWxrUm9ja2V0IHRoZW4KICAgICAgICBsb2NhbCByb2NrZXQgPSAwCiAgICAgICAgbG9jYWwgY2FtID0gMAogICAgICAgIGxvY2FsIGJsaXAgPSAwCiAgICAgICAgbG9jYWwgaW5pdCA9IGZhbHNlCiAgICAgICAgbG9jYWwgZHJhd19yZWN0ID0gZnVuY3Rpb24oeCwgeSwgeiwgdykKICAgICAgICAgICAgR1JBUEhJQ1MuRFJBV19SRUNUKHgsIHksIHosIHcsIDI1NSwgMjU1LCAyNTUsIDI1NSwgZmFsc2UpCiAgICAgICAgZW5kCiAgICAgICAgd2hpbGUgZ1VzaW5nVmFsa1JvY2tldCBkbwogICAgICAgICAgICB1dGlsLnlpZWxkX29uY2UoKQogICAgICAgICAgICBpZiBQRUQuSVNfUEVEX1NIT09USU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpIGFuZCBub3QgaW5pdCB0aGVuCiAgICAgICAgICAgICAgICBpbml0ID0gdHJ1ZQogICAgICAgICAgICAgICAgdGltZXIucmVzZXQoKQogICAgICAgICAgICBlbHNlaWYgaW5pdCB0aGVuCiAgICAgICAgICAgICAgICBpZiBub3QgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKHJvY2tldCkgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIG9mZnNldCA9IGdldF9vZmZzZXRfZnJvbV9jYW1lcmEoMTApCiAgICAgICAgICAgICAgICAgICAgcm9ja2V0ID0gZW50aXRpZXMuY3JlYXRlX29iamVjdCh1dGlsLmpvYWF0KCJ3X2xyX3JwZ19yb2NrZXQiKSwgb2Zmc2V0KQogICAgICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0lOVklOQ0lCTEUocm9ja2V0LCB0cnVlKQogICAgICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0xPQURfQ09MTElTSU9OX0ZMQUcocm9ja2V0LCB0cnVlLCAxKQogICAgICAgICAgICAgICAgICAgIE5FVFdPUksuU0VUX05FVFdPUktfSURfRVhJU1RTX09OX0FMTF9NQUNISU5FUyhORVRXT1JLLk9CSl9UT19ORVQocm9ja2V0KSwgdHJ1ZSkKICAgICAgICAgICAgICAgICAgICBORVRXT1JLLlNFVF9ORVRXT1JLX0lEX0NBTl9NSUdSQVRFKE5FVFdPUksuT0JKX1RPX05FVChyb2NrZXQpLCBmYWxzZSkKICAgICAgICAgICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9SRUNPUkRTX0NPTExJU0lPTlMocm9ja2V0LCB0cnVlKQogICAgICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0hBU19HUkFWSVRZKHJvY2tldCwgZmFsc2UpCiAgICAgICAgICAgICAgICAgICAgQ0FNLkRFU1RST1lfQUxMX0NBTVModHJ1ZSkKICAgICAgICAgICAgICAgICAgICBjYW0gPSBDQU0uQ1JFQVRFX0NBTSgiREVGQVVMVF9TQ1JJUFRFRF9DQU1FUkEiLCB0cnVlKQogICAgICAgICAgICAgICAgICAgIENBTS5TRVRfQ0FNX05FQVJfQ0xJUChjYW0sIDAuMDEpCiAgICAgICAgICAgICAgICAgICAgQ0FNLlNFVF9DQU1fTkVBUl9ET0YoY2FtLCAwLjAxKQogICAgICAgICAgICAgICAgICAgIEdSQVBISUNTLkNMRUFSX1RJTUVDWUNMRV9NT0RJRklFUigpCiAgICAgICAgICAgICAgICAgICAgR1JBUEhJQ1MuU0VUX1RJTUVDWUNMRV9NT0RJRklFUigiQ0FNRVJBX3NlY3Vpcml0eSIpCiAgICAgICAgICAgICAgICAgICAgQ0FNMS5IQVJEX0FUVEFDSF9DQU1fVE9fRU5USVRZKGNhbSwgcm9ja2V0LCAwLjAsIDAuMCwgMC4wLCAwLjAsIDAuMCwgMC4wLCB0cnVlKQogICAgICAgICAgICAgICAgICAgIENBTS5TRVRfQ0FNX0FDVElWRShjYW0sIHRydWUpCiAgICAgICAgICAgICAgICAgICAgQ0FNLlJFTkRFUl9TQ1JJUFRfQ0FNUyh0cnVlLCBmYWxzZSwgMCwgdHJ1ZSwgdHJ1ZSwgMCkKICAgICAgICAgICAgICAgICAgICBQTEFZRVIuRElTQUJMRV9QTEFZRVJfRklSSU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUpCiAgICAgICAgICAgICAgICAgICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBsb2NhbCByb3QgPSBDQU0uR0VUX0dBTUVQTEFZX0NBTV9ST1QoMCkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBjb29yZHMgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMocm9ja2V0LCBmYWxzZSkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBmb3JjZSA9IHJvdDp0b0RpcigpCiAgICAgICAgICAgICAgICAgICAgZm9yY2U6bXVsKDQwLjApCiAgICAgICAgICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04ocm9ja2V0LCByb3QueCwgcm90LnksIHJvdC56LCAwLCB0cnVlKQogICAgICAgICAgICAgICAgICAgIFNUUkVBTUlORy5TRVRfRk9DVVNfUE9TX0FORF9WRUwoY29vcmRzLngsIGNvb3Jkcy55LCBjb29yZHMueiwgcm90LngsIHJvdC55LCByb3QueikKICAgICAgICAgICAgICAgICAgICBFTlRJVFkuQVBQTFlfRk9SQ0VfVE9fRU5USVRZX0NFTlRFUl9PRl9NQVNTKHJvY2tldCwgMSwgZm9yY2UueCwgZm9yY2UueSwgZm9yY2UueiwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgICAgICAgICAgICAgSFVELkhJREVfSFVEX0FORF9SQURBUl9USElTX0ZSQU1FKCkKICAgICAgICAgICAgICAgICAgICBQTEFZRVIuRElTQUJMRV9QTEFZRVJfRklSSU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUpCiAgICAgICAgICAgICAgICAgICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSkKICAgICAgICAgICAgICAgICAgICBIVUQxLkhVRF9TVVBQUkVTU19XRUFQT05fV0hFRUxfUkVTVUxUU19USElTX0ZSQU1FKCkKICAgICAgICAgICAgICAgICAgICBkcmF3X3JlY3QoMC41LCAwLjUgLSAwLjAyNSwgMC4wNTAsIDAuMDAyKQogICAgICAgICAgICAgICAgICAgIGRyYXdfcmVjdCgwLjUsIDAuNSArIDAuMDI1LCAwLjA1MCwgMC4wMDIpCiAgICAgICAgICAgICAgICAgICAgZHJhd19yZWN0KDAuNSAtIDAuMDI1LCAwLjUsIDAuMDAyLCAwLjA1MikKICAgICAgICAgICAgICAgICAgICBkcmF3X3JlY3QoMC41ICsgMC4wMjUsIDAuNSwgMC4wMDIsIDAuMDUyKQogICAgICAgICAgICAgICAgICAgIGRyYXdfcmVjdCgwLjUgKyAwLjA1MCwgMC41LCAwLjA1MCwgMC4wMDIpCiAgICAgICAgICAgICAgICAgICAgZHJhd19yZWN0KDAuNSAtIDAuMDUwLCAwLjUsIDAuMDUwLCAwLjAwMikKICAgICAgICAgICAgICAgICAgICBkcmF3X3JlY3QoMC41LCAwLjUwMCArIDAuMDUsIDAuMDAyLCAwLjA1KQogICAgICAgICAgICAgICAgICAgIGRyYXdfcmVjdCgwLjUsIDAuNTAwIC0gMC4wNSwgMC4wMDIsIDAuMDUpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgbWF4VGltZSA9IDcwMDAgLS0gYG1zYAogICAgICAgICAgICAgICAgICAgIGxvY2FsIGxlbmd0aCA9IDAuNSAtIDAuNSAqICh0aW1lci5lbGFwc2VkKCkgLyBtYXhUaW1lKSAtLSB0aW1lciBsZW5ndGgKICAgICAgICAgICAgICAgICAgICBsb2NhbCBwZXJjID0gbGVuZ3RoIC8gMC41CiAgICAgICAgICAgICAgICAgICAgbG9jYWwgY29sb3IgPSBnZXRfYmxlbmRlZF9jb2xvdXIocGVyYykgLS0gdGltZXIgY29sb3IKICAgICAgICAgICAgICAgICAgICBHUkFQSElDUy5EUkFXX1JFQ1QoMC4yNSwgMC41LCAwLjAzLCAwLjUsIDI1NSwgMjU1LCAyNTUsIDEyMCwgZmFsc2UpCiAgICAgICAgICAgICAgICAgICAgR1JBUEhJQ1MuRFJBV19SRUNUKDAuMjUsIDAuNzUgLSBsZW5ndGggLyAyLCAwLjAzLCBsZW5ndGgsIGNvbG9yLnIsIGNvbG9yLmcsIGNvbG9yLmIsIGNvbG9yLmEsIGZhbHNlKQogICAgICAgICAgICAgICAgICAgIGlmIEVOVElUWS5IQVNfRU5USVRZX0NPTExJREVEX1dJVEhfQU5ZVEhJTkcocm9ja2V0KSBvciBsZW5ndGggPD0gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGltcGFjdENvb3JkID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHJvY2tldCwgZmFsc2UpCiAgICAgICAgICAgICAgICAgICAgICAgIEZJUkUuQUREX0VYUExPU0lPTihpbXBhY3RDb29yZC54LCBpbXBhY3RDb29yZC55LCBpbXBhY3RDb29yZC56LCAzMiwgMS4wLCB0cnVlLCBmYWxzZSwgMC40LCBmYWxzZSkKICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlX2VudGl0eShyb2NrZXQpCiAgICAgICAgICAgICAgICAgICAgICAgIENBTS5SRU5ERVJfU0NSSVBUX0NBTVMoZmFsc2UsIGZhbHNlLCAwLCB0cnVlLCBmYWxzZSwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgR1JBUEhJQ1MuU0VUX1RJTUVDWUNMRV9NT0RJRklFUigiREVGQVVMVCIpCiAgICAgICAgICAgICAgICAgICAgICAgIFNUUkVBTUlORy5DTEVBUl9GT0NVUygpCiAgICAgICAgICAgICAgICAgICAgICAgIENBTS5ERVNUUk9ZX0NBTShjYW0sIHRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgIFBMQVlFUi5ESVNBQkxFX1BMQVlFUl9GSVJJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpCiAgICAgICAgICAgICAgICAgICAgICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKQogICAgICAgICAgICAgICAgICAgICAgICByb2NrZXQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgIGluaXQgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIGlmIHJvY2tldCBhbmQgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKHJvY2tldCkgdGhlbgogICAgICAgICAgICBsb2NhbCBpbXBhY3RDb29yZCA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhyb2NrZXQsIGZhbHNlKQogICAgICAgICAgICBGSVJFLkFERF9FWFBMT1NJT04oaW1wYWN0Q29vcmQueCwgaW1wYWN0Q29vcmQueSwgaW1wYWN0Q29vcmQueiwgMzIsIDEuMCwgdHJ1ZSwgZmFsc2UsIDAuNCwgZmFsc2UpCiAgICAgICAgICAgIGRlbGV0ZV9lbnRpdHkocm9ja2V0KQogICAgICAgICAgICBTVFJFQU1JTkcuQ0xFQVJfRk9DVVMoKQogICAgICAgICAgICBDQU0uUkVOREVSX1NDUklQVF9DQU1TKGZhbHNlLCBmYWxzZSwgMCwgdHJ1ZSwgZmFsc2UsIDApCiAgICAgICAgICAgIENBTS5ERVNUUk9ZX0NBTShjYW0sIHRydWUpCiAgICAgICAgICAgIEdSQVBISUNTLlNFVF9USU1FQ1lDTEVfTU9ESUZJRVIoIkRFRkFVTFQiKQogICAgICAgICAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgICAgICAgICAgUExBWUVSLkRJU0FCTEVfUExBWUVSX0ZJUklORyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgICAgICAgICAgaWYgSFVELkRPRVNfQkxJUF9FWElTVChibGlwKSB0aGVuIHV0aWwucmVtb3ZlX2JsaXAoYmxpcCkgZW5kCiAgICAgICAgICAgIEhVRC5VTkxPQ0tfTUlOSU1BUF9BTkdMRSgpCiAgICAgICAgICAgIEhVRC5VTkxPQ0tfTUlOSU1BUF9QT1NJVElPTigpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgotLS0tLS0t6L295YW35Y+Y6ImyCmZ1bmN0aW9uIHJlcXVlc3R3ZWFwb24oLi4uKQoJbG9jYWwgYXJnID0gey4uLn0KCWZvciBfLCBtb2RlbCBpbiBpcGFpcnMoYXJnKSBkbwoJCXJlcXVlc3Rfd2VhcG9uX2Fzc2V0KG1vZGVsKQoJZW5kCmVuZApmdW5jdGlvbiBSR0JOZW9uS2l0KHBlZG0pCiAgICBsb2NhbCB2bW9kID0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19JTihwZWRtLCBmYWxzZSkKICAgIGZvciBpID0gMCwgMyBkbwogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfTkVPTl9FTkFCTEVEKHZtb2QsIGksIHRydWUpCiAgICBlbmQKZW5kCmxvY2FsIHJnYl9jdXMgPSAxMDAKZnVuY3Rpb24gY29sb3JzcGVlZChjKQogICAgcmdiX2N1cyA9IDEwMDAwL2MKZW5kCmZ1bmN0aW9uIHpqYnMoKQogICAgaWYgUEVELklTX1BFRF9JTl9BTllfVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlKSB+PSAwIHRoZW4KICAgICAgICBsb2NhbCB2bW9kID0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19JTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlKQogICAgICAgIFJHQk5lb25LaXQoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgICAgICBsb2NhbCByZWQgPSBtYXRoLnJhbmRvbSgwLCAyNTUpCiAgICAgICAgbG9jYWwgZ3JlZW4gPSBtYXRoLnJhbmRvbSgwLCAyNTUpCiAgICAgICAgbG9jYWwgYmx1ZSA9IG1hdGgucmFuZG9tKDAsIDI1NSkKICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX05FT05fQ09MT1VSKHZtb2QsIHJlZCwgZ3JlZW4sIGJsdWUpCiAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9DVVNUT01fUFJJTUFSWV9DT0xPVVIodm1vZCwgcmVkLCBncmVlbiwgYmx1ZSkKICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0NVU1RPTV9TRUNPTkRBUllfQ09MT1VSKHZtb2QsIHJlZCwgZ3JlZW4sIGJsdWUpCiAgICAgICAgdXRpbC55aWVsZChyZ2JfY3VzKQogICAgICAgZW5kCiAgICBlbmQKbG9jYWwgcXpkcmdiX2N1cyA9IDEwMApmdW5jdGlvbiBxemRjb2xvcnNwZWVkKGMpCiAgICBxemRyZ2JfY3VzID0gMTAwMDAvYwplbmQKZnVuY3Rpb24gcXpkKCkKICAgIGxvY2FsIGNvbG9yID0gewogICAgICAgICAgICB7NjQsIDF9LAogICAgICAgICAgICB7NzMsIDJ9LAogICAgICAgICAgICB7NTEsIDN9LCAKICAgICAgICAgICAgezkyLCA0fSwgCiAgICAgICAgICAgIHs4OSwgNX0sIAogICAgICAgICAgICB7ODgsIDZ9LCAKICAgICAgICAgICAgezM4LCA3fSwgCiAgICAgICAgICAgIHszOSAsIDh9LCAKICAgICAgICAgICAgezEzNywgOX0sIAogICAgICAgICAgICB7MTM1LCAxMH0sIAogICAgICAgICAgICB7MTQ1LCAxMX0sCiAgICAgICAgICAgIHsxNDIsIDEyfSAKICAgICAgICB9CiAgICBpZiBQRUQuSVNfUEVEX0lOX0FOWV9WRUhJQ0xFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpIH49IDAgdGhlbgogICAgICAgIGxvY2FsIHZtb2QgPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0lOKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUpCiAgICAgICAgUkdCTmVvbktpdChQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgIGxvY2FsIHJjb2xvciA9IG1hdGgucmFuZG9tKDEsIDEyKQogICAgICAgIFZFSElDTEUuVE9HR0xFX1ZFSElDTEVfTU9EKHZtb2QsIDIyLCB0cnVlKQogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfTkVPTl9JTkRFWF9DT0xPVVIodm1vZCwgY29sb3JbcmNvbG9yXVsxXSkKICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0NPTE9VUlModm1vZCwgY29sb3JbcmNvbG9yXVsxXSwgY29sb3JbcmNvbG9yXVsxXSkKICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0VYVFJBX0NPTE9VUlModm1vZCwgMCwgY29sb3JbcmNvbG9yXVsxXSkKICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0VYVFJBX0NPTE9VUl81KHZtb2QsIGNvbG9yW3Jjb2xvcl1bMV0pCiAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9YRU5PTl9MSUdIVF9DT0xPUl9JTkRFWCh2bW9kLCBjb2xvcltyY29sb3JdWzJdKQogICAgICAgIHV0aWwueWllbGQocXpkcmdiX2N1cykKICAgIGVuZAplbmQKCi0tLS1CLTEx5pS75Ye7CmxvY2FsIEIxMXBsYW5lID0ge30KZnVuY3Rpb24gQjExX2F0dGFjayhwaWQpCiAgICAKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSwgZmFsc2UpCiAgICBsb2NhbCBkcml2ZV9wZWQgPSB7fQogICAgaWYgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKEIxMXBsYW5lWzFdKSB0aGVuIHJldHVybiBlbmQKICAgIGZvciBpID0gMSwgMzAgZG8KICAgICAgICBCMTFwbGFuZVtpXSA9IGNyZWF0ZV92ZWhpY2xlKDE2OTIyNzI1NDUsIHBvcy54K21hdGgucmFuZG9tKC0xMDAsIDEwMCksIHBvcy55K21hdGgucmFuZG9tKC0xMDAsIDEwMCksIHBvcy56KzIwMCwgbWF0aC5yYW5kb20oMCwgMzYwKSkKCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRShCMTFwbGFuZVtpXSx0cnVlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPTExJU0lPTihCMTFwbGFuZVtpXSwgZmFsc2UsIHRydWUpCgogICAgICAgIGxvY2FsIGJsaXAgPSBIVUQuQUREX0JMSVBfRk9SX0VOVElUWShCMTFwbGFuZVtpXSkKICAgICAgICBIVUQuU0VUX0JMSVBfQ09MT1VSKGJsaXAsIDEpLS3orr7nva7popzoibIKCiAgICAgICAgZHJpdmVfcGVkW2ldID0gUEVELkNSRUFURV9SQU5ET01fUEVEX0FTX0RSSVZFUihCMTFwbGFuZVtpXSwgMSkKICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0VOR0lORV9PTihkcml2ZV9wZWRbaV0sIHRydWUsIHRydWUsIDApCiAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9GT1JXQVJEX1NQRUVEKEIxMXBsYW5lW2ldLCAxMDAgLyAzLjYpCgogICAgICAgIFRBU0suVEFTS19DT01CQVRfUEVEKGRyaXZlX3BlZFtpXSwgUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCksIDAsIDE2KQogICAgZW5kCmVuZAoKCi0tLS0tLei9sOeCuOWMugpmdW5jdGlvbiBib21iX2FyZWEoKQogICAgbG9jYWwgaGFzaCA9IHV0aWwuam9hYXQoImltcF9wcm9wX2JvbWJfYmFsbCIpCiAgICByZXF1ZXN0X21vZGVsKGhhc2gpCiAgICBsb2NhbCBjID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIG1hdGgucmFuZG9tKC0yMDAsIDIwMCksIG1hdGgucmFuZG9tKC0yMDAsIDIwMCksIG1hdGgucmFuZG9tKDEwMCwgMjAwKSkKICAgIGxvY2FsIGJhbGwgPSBlbnRpdGllcy5jcmVhdGVfb2JqZWN0KGhhc2gsIGMpCiAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihiYWxsLCBmYWxzZSkKICAgIEVOVElUWS5TRVRfRU5USVRZX0RZTkFNSUMoYmFsbCwgdHJ1ZSkKICAgIEVOVElUWS5BUFBMWV9GT1JDRV9UT19FTlRJVFkoYmFsbCwgMSwgbWF0aC5yYW5kb20oLTMwMCwgMzAwKSwgbWF0aC5yYW5kb20oLTMwMCwgMzAwKSwgLTMwMCwgMCwgMCwgMCwgMCwgdHJ1ZSwgZmFsc2UsIHRydWUsIHRydWUsIHRydWUpCiAgICAKICAgIHV0aWwuY3JlYXRlX3RpY2tfaGFuZGxlcihmdW5jdGlvbigpCiAgICAgICAgaWYgRU5USVRZLkhBU19FTlRJVFlfQ09MTElERURfV0lUSF9BTllUSElORyhiYWxsKSB0aGVuCiAgICAgICAgICAgIGlmIEVOVElUWS5ET0VTX0VOVElUWV9FWElTVChiYWxsKSB0aGVuIAogICAgICAgICAgICAgICAgbG9jYWwgYyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhiYWxsKQogICAgICAgICAgICAgICAgRklSRS5BRERfRVhQTE9TSU9OKGMueCwgYy55LCBjLnosIDE3LCAxMDAuMCwgdHJ1ZSwgZmFsc2UsIDAuMCkKICAgICAgICAgICAgICAgIGRlbGV0ZV9lbnRpdHkoYmFsbCkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgIGVuZAogICAgZW5kKQogICAgdXRpbC55aWVsZCgyMDApCmVuZAoKCgotLS0tLS0tLS0tLS1SR0IKY3VzdG9tX3JnYiA9IHRydWUKcmdiX3RocmVhZCA9IHV0aWwuY3JlYXRlX3RocmVhZChmdW5jdGlvbiAodGhyKQogICAgbG9jYWwgciA9IDI1NQogICAgbG9jYWwgZyA9IDAKICAgIGxvY2FsIGIgPSAwCiAgICByZ2IgPSB7MjU1LCAwLCAwfQogICAgd2hpbGUgdHJ1ZSBkbwogICAgICAgIGlmIG5vdCBjdXN0b21fcmdiIHRoZW4KICAgICAgICAgICAgaWYgciA+IDAgYW5kIGcgPCAyNTUgYW5kIGIgPT0gMCB0aGVuCiAgICAgICAgICAgICAgICByID0gciAtIDEKICAgICAgICAgICAgICAgIGcgPSBnICsgMQogICAgICAgICAgICBlbHNlaWYgciA9PSAwIGFuZCBnID4gMCBhbmQgYiA8IDI1NSB0aGVuCiAgICAgICAgICAgICAgICBnID0gZyAtIDEKICAgICAgICAgICAgICAgIGIgPSBiICsgMQogICAgICAgICAgICBlbHNlaWYgciA8IDI1NSBhbmQgYiA+IDAgdGhlbgogICAgICAgICAgICAgICAgciA9IHIgKyAxCiAgICAgICAgICAgICAgICBiID0gYiAtIDEKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICByZ2JbMV0gPSByCiAgICAgICAgICAgIHJnYlsyXSA9IGcKICAgICAgICAgICAgcmdiWzNdID0gYgogICAgICAgIGVsc2UKICAgICAgICAgICAgcmdiID0ge2N1c3RvbV9yLCBjdXN0b21fZywgY3VzdG9tX2J9CiAgICAgICAgZW5kCiAgICAgICAgdXRpbC55aWVsZCgpCiAgICBlbmQKZW5kKQogICAgCgoKLS0tLS3mgrLkvKTnmoTogLbnqKMKZnVuY3Rpb24gZGlzcGF0Y2hfZ3JpZWZlcl9qZXN1cyh0YXJnZXQpCiAgICBncmllZmVyX2plc3VzID0gdXRpbC5jcmVhdGVfdGhyZWFkKGZ1bmN0aW9uKHRocikKICAgICAgICB1dGlsLnRvYXN0KCLmgrLkvKTogLbnqKPmtL7mnaXkuoYhIikKICAgICAgICByZXF1ZXN0X21vZGVsKC04MzU5MzAyODcpCiAgICAgICAgbG9jYWwgdGFyZ2V0X3BlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRF9TQ1JJUFRfSU5ERVgodGFyZ2V0KQogICAgICAgIGNvb3JkcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyh0YXJnZXRfcGVkLCBmYWxzZSkKICAgICAgICBjb29yZHMueCA9IGNvb3Jkc1sneCddCiAgICAgICAgY29vcmRzLnkgPSBjb29yZHNbJ3knXQogICAgICAgIGNvb3Jkcy56ID0gY29vcmRzWyd6J10KICAgICAgICBsb2NhbCBqZXN1cyA9IGVudGl0aWVzLmNyZWF0ZV9wZWQoMSwgLTgzNTkzMDI4NywgY29vcmRzLCA5MC4wKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0lOVklOQ0lCTEUoamVzdXMsIHRydWUpCiAgICAgICAgUEVELlNFVF9QRURfSEVBUklOR19SQU5HRShqZXN1cywgOTk5OSkKCSAgICBQRUQuU0VUX1BFRF9DT05GSUdfRkxBRyhqZXN1cywgMjgxLCB0cnVlKQogICAgICAgIFBFRC5TRVRfUEVEX0NPTUJBVF9BVFRSSUJVVEVTKGplc3VzLCA1LCB0cnVlKQoJICAgIFBFRC5TRVRfUEVEX0NPTUJBVF9BVFRSSUJVVEVTKGplc3VzLCA0NiwgdHJ1ZSkKICAgICAgICBQRUQuU0VUX1BFRF9DQU5fUkFHRE9MTChqZXN1cywgZmFsc2UpCiAgICAgICAgV0VBUE9OLkdJVkVfV0VBUE9OX1RPX1BFRChqZXN1cywgdXRpbC5qb2FhdCgiV0VBUE9OX1JBSUxHVU4iKSwgOTk5OSwgdHJ1ZSwgdHJ1ZSkKICAgICAgICBUQVNLLlRBU0tfR09fVE9fRU5USVRZKGplc3VzLCB0YXJnZXRfcGVkLCAtMSwgLTEsIDEwMC4wLCAwLjAsIDApCiAgICAJVEFTSy5UQVNLX0NPTUJBVF9QRUQoamVzdXMsIHRhcmdldF9wZWQsIDAsIDE2KQogICAgICAgIFBFRC5TRVRfUEVEX0FDQ1VSQUNZKGplc3VzLCAxMDAuMCkKICAgICAgICBQRUQuU0VUX1BFRF9DT01CQVRfQUJJTElUWShqZXN1cywgMikKICAgICAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgICAgIGxvY2FsIHBsYXllcl9jb29yZHMgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFModGFyZ2V0X3BlZCwgZmFsc2UpCiAgICAgICAgICAgIGxvY2FsIGplc3VzX2Nvb3JkcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhqZXN1cywgZmFsc2UpCiAgICAgICAgICAgIGxvY2FsIGRpc3QgPSAgR2V0X2Rpc3RhbmNlKHBsYXllcl9jb29yZHMsIGplc3VzX2Nvb3JkcywgZmFsc2UpCiAgICAgICAgICAgIGlmIGRpc3QgPiAxMDAgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgYmVoaW5kID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKHRhcmdldF9wZWQsIC0zLjAsIDAuMCwgMC4wKQogICAgICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTKGplc3VzLCBiZWhpbmRbJ3gnXSwgYmVoaW5kWyd5J10sIGJlaGluZFsneiddLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIC0tIGlmIGplc3VzIGRpc2FwcGVhcnMgd2UgY2FuIGp1c3QgbWFrZSBhbm90aGVyIGxtYW8KICAgICAgICAgICAgaWYgbm90IEVOVElUWS5ET0VTX0VOVElUWV9FWElTVChqZXN1cykgdGhlbgogICAgICAgICAgICAgICAgdXRpbC50b2FzdCgi6IC256ij5pi+54S25LiN5YaN5a2Y5Zyo44CC5oiW6K645bey6KKr546p5a625riF6Zmk44CCIikKICAgICAgICAgICAgICAgIHV0aWwuc3RvcF90aHJlYWQoKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgdGFyZ2V0X3BlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRF9TQ1JJUFRfSU5ERVgodGFyZ2V0KQogICAgICAgICAgICBpZiBub3QgcGxheWVycy5leGlzdHModGFyZ2V0KSB0aGVuCiAgICAgICAgICAgICAgICB1dGlsLnRvYXN0KCLnjqnlrrbnm67moIflt7LkuKLlpLHjgILmgrLkvKTnmoTogLbnqKPnur/mraPlnKjlgZzmraIiKQogICAgICAgICAgICAgICAgdXRpbC5zdG9wX3RocmVhZCgpCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIFRBU0suVEFTS19DT01CQVRfUEVEKGplc3VzLCB0YXJnZXRfcGVkLCAwLCAxNikKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHV0aWwueWllbGQoKQogICAgICAgIGVuZAogICAgZW5kKQplbmQKCi0tLS0t5Y+R6YCB5pS75Ye76ICFCmZ1bmN0aW9uIHNlbmRfYXR0YWNrZXIoaGFzaCwgcGlkKQogICAgCiAgICBsb2NhbCB0YXJnZXRfcGVkID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyh0YXJnZXRfcGVkLCBmYWxzZSkKICAgIGxvY2FsIGF0dGFja2VyID0gY3JlYXRlX3BlZCgyOCwgaGFzaCwgcG9zLngsIHBvcy55LCBwb3MueiwgbWF0aC5yYW5kb20oMCwgMjcwKSkKICAgIEVOVElUWS5TRVRfRU5USVRZX0lOVklOQ0lCTEUoYXR0YWNrZXIsIHRydWUpCiAgICBUQVNLLlRBU0tfQ09NQkFUX1BFRChhdHRhY2tlciwgdGFyZ2V0X3BlZCwgMCwgMTYpCiAgICBQRUQuU0VUX1BFRF9BQ0NVUkFDWShhdHRhY2tlciwgMTAwLjApCiAgICBQRUQuU0VUX1BFRF9DT01CQVRfQUJJTElUWShhdHRhY2tlciwgMikKICAgIFBFRC5TRVRfUEVEX0FTX0VORU1ZKGF0dGFja2VyLCB0cnVlKQogICAgUEVELlNFVF9QRURfRkxFRV9BVFRSSUJVVEVTKGF0dGFja2VyLCAwLCBmYWxzZSkKICAgIFBFRC5TRVRfUEVEX0NPTUJBVF9BVFRSSUJVVEVTKGF0dGFja2VyLCA0NiwgdHJ1ZSkKZW5kCmZ1bmN0aW9uIHNlbmRfYWlyY3JhZnRfYXR0YWNrZXIodmhhc2gsIHBoYXNoLCBwaWQpCiAgICAKICAgIGxvY2FsIHRhcmdldF9wZWQgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKQogICAgbG9jYWwgY29vcmRzID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKHRhcmdldF9wZWQsIDEuMCwgMC4wLCA1MDAuMCkKICAgIHJlcXVlc3RfbW9kZWwodmhhc2gpCiAgICByZXF1ZXN0X21vZGVsKHBoYXNoKQogICAgY29vcmRzLnggPSBjb29yZHMueCArIDIKICAgIGNvb3Jkcy55ID0gY29vcmRzLnkgKyAyCiAgICBsb2NhbCBhaXJjcmFmdCA9IGVudGl0aWVzLmNyZWF0ZV92ZWhpY2xlKHZoYXNoLCBjb29yZHMsIDAuMCkKICAgIFZFSElDTEUuQ09OVFJPTF9MQU5ESU5HX0dFQVIoYWlyY3JhZnQsIDMpCiAgICBWRUhJQ0xFLlNFVF9IRUxJX0JMQURFU19GVUxMX1NQRUVEKGFpcmNyYWZ0KQogICAgVkVISUNMRS5TRVRfVkVISUNMRV9GT1JXQVJEX1NQRUVEKGFpcmNyYWZ0LCBWRUhJQ0xFLkdFVF9WRUhJQ0xFX0VTVElNQVRFRF9NQVhfU1BFRUQoYWlyY3JhZnQpKQogICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRShhaXJjcmFmdCwgdHJ1ZSkKICAgIGZvciBpPSAtMSwgVkVISUNMRS5HRVRfVkVISUNMRV9NT0RFTF9OVU1CRVJfT0ZfU0VBVFModmhhc2gpIC0gMiBkbwogICAgICAgIGxvY2FsIHBlZCA9IGVudGl0aWVzLmNyZWF0ZV9wZWQoMjgsIHBoYXNoLCBjb29yZHMsIDMwLjApCiAgICAgICAgVEFTSy5UQVNLX1BMQU5FX01JU1NJT04ocGVkLCBhaXJjcmFmdCwgMCwgdGFyZ2V0X3BlZCwgMCwgMCwgMCwgNiwgMC4wLCAwLCAwLjAsIDUwLjAsIDQwLjApCiAgICAgICAgUEVELlNFVF9QRURfQ09NQkFUX0FUVFJJQlVURVMocGVkLCA1LCB0cnVlKQogICAgICAgIFBFRC5TRVRfUEVEX0NPTUJBVF9BVFRSSUJVVEVTKHBlZCwgNDYsIHRydWUpCiAgICAgICAgUEVELlNFVF9QRURfSU5UT19WRUhJQ0xFKHBlZCwgYWlyY3JhZnQsIGkpCiAgICAgICAgVEFTSy5UQVNLX0NPTUJBVF9QRUQocGVkLCB0YXJnZXRfcGVkLCAwLCAxNikKICAgICAgICBQRUQuU0VUX1BFRF9BQ0NVUkFDWShwZWQsIDEwMC4wKQogICAgICAgIFBFRC5TRVRfUEVEX0NPTUJBVF9BQklMSVRZKHBlZCwgMikKICAgIGVuZAplbmQKCgoKLS0tLS3nlJ/miJDlrp7kvZPlnoPlnL4KZnVuY3Rpb24gc3BhbV9lbnRpdHlfb25fcGxheWVyKHBlZCwgaGFzaCkKICAgIHJlcXVlc3RfbW9kZWwoaGFzaCkKICAgIGZvciBpPTEsIDMwIGRvCiAgICAgICAgcmFuZF9jb29yZHMgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMocGVkLCBtYXRoLnJhbmRvbSgtMSwxKSwgbWF0aC5yYW5kb20oLTEsMSksIG1hdGgucmFuZG9tKC0xLDEpKQogICAgICAgIHJhbmRfY29vcmRzLnggPSByYW5kX2Nvb3Jkc1sneCddCiAgICAgICAgcmFuZF9jb29yZHMueSA9IHJhbmRfY29vcmRzWyd5J10KICAgICAgICByYW5kX2Nvb3Jkcy56ID0gcmFuZF9jb29yZHNbJ3onXQogICAgICAgIG9iaiA9IE9CSkVDVC5DUkVBVEVfT0JKRUNUX05PX09GRlNFVChoYXNoLCByYW5kX2Nvb3Jkc1sneCddLCByYW5kX2Nvb3Jkc1sneSddLCByYW5kX2Nvb3Jkc1sneiddLCB0cnVlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgZ3Jhdl9mYWN0b3IgPSAxLjAKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9IQVNfR1JBVklUWShvYmosIHRydWUpCiAgICAgICAgT0JKRUNULlNFVF9BQ1RJVkFURV9PQkpFQ1RfUEhZU0lDU19BU19TT09OX0FTX0lUX0lTX1VORlJPWkVOKG9iaiwgdHJ1ZSkKICAgIGVuZAplbmQKCgoKLS0tLemZqOiQveeahOmjnuacugpmdW5jdGlvbiBzdGFydF9hbmdyeXBsYW5lc190aHJlYWQoKQogICAgbG9jYWwgdl9oYXNoZXMgPSB7dXRpbC5qb2FhdCgnbGF6ZXInKSwgdXRpbC5qb2FhdCgnamV0JyksIHV0aWwuam9hYXQoJ2NhcmdvcGxhbmUnKSwgdXRpbC5qb2FhdCgndGl0YW4nKSwgdXRpbC5qb2FhdCgnbHV4b3InKSwgdXRpbC5qb2FhdCgnc2VhYnJlZXplJyksIHV0aWwuam9hYXQoJ3Zlc3RyYScpLCB1dGlsLmpvYWF0KCd2b2xhdG9sJyksIHV0aWwuam9hYXQoJ3R1bGEnKSwgdXRpbC5qb2FhdCgnYnV6emFyZCcpLCB1dGlsLmpvYWF0KCdhdmVuZ2VyJyl9CiAgICBsb2NhbCBhbmdyeV9wbGFuZXNfdGFyID0gUExBWUVSLlBMQVlFUl9QRURfSUQoKQogICAgbG9jYWwgcmFkaXVzID0gMjAwCiAgICBsb2NhbCBjID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKGFuZ3J5X3BsYW5lc190YXIsIG1hdGgucmFuZG9tKC1yYWRpdXMsIHJhZGl1cyksIG1hdGgucmFuZG9tKC1yYWRpdXMsIHJhZGl1cyksIG1hdGgucmFuZG9tKDYwMCwgODAwKSkKICAgIGxvY2FsIHBpY2sgPSB2X2hhc2hlc1ttYXRoLnJhbmRvbSgxLCAjdl9oYXNoZXMpXQogICAgcmVxdWVzdF9tb2RlbChwaWNrKQogICAgbG9jYWwgYWlyY3JhZnQgPSBlbnRpdGllcy5jcmVhdGVfdmVoaWNsZShwaWNrLCBjLCBtYXRoLnJhbmRvbSgwLCAyNzApKQogICAgc2V0X2VudGl0eV9mYWNlX2VudGl0eShhaXJjcmFmdCwgYW5ncnlfcGxhbmVzX3RhciwgdHJ1ZSkKICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRU5HSU5FX09OKGFpcmNyYWZ0LCB0cnVlLCB0cnVlLCBmYWxzZSkKICAgIFZFSElDTEUuU0VUX0hFTElfQkxBREVTX0ZVTExfU1BFRUQoYWlyY3JhZnQpCiAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0ZPUldBUkRfU1BFRUQoYWlyY3JhZnQsIFZFSElDTEUuR0VUX1ZFSElDTEVfRVNUSU1BVEVEX01BWF9TUEVFRChhaXJjcmFmdCkrMTAwMC4wKQogICAgVkVISUNMRS5TRVRfVkVISUNMRV9PVVRfT0ZfQ09OVFJPTChhaXJjcmFmdCwgdHJ1ZSwgdHJ1ZSkKICAgIHV0aWwueWllbGQoNTAwMCkKZW5kCgotLS0t5aKo6KW/5ZOl5LmQ6ZifCmZ1bmN0aW9uIGRpc3BhdGNoX21hcmlhY2hpKHRhcmdldCkKICAgIGlmIGlzX1VsdGltYXRlVXNlcih0YXJnZXQpIHRoZW4gdXRpbC50b2FzdChCbG9ja0F0dGFja1VsdGltYXRlVXNlcikgcmV0dXJuIGVuZAogICAgbWFyaWFjaGlfdGhyID0gdXRpbC5jcmVhdGVfdGhyZWFkKGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCBtZW4gPSB7fQogICAgICAgIGxvY2FsIHBsYXllcl9wZWQKICAgICAgICBsb2NhbCBwb3Nfb2Zmc2V0cyA9IHstMS4wLCAwLjAsIDEuMH0KICAgICAgICBsb2NhbCBwX2hhc2ggPSAtOTI3MjYxMTAyCiAgICAgICAgbG9jYWwgcG9zCiAgICAgICAgcmVxdWVzdF9tb2RlbChwX2hhc2gpCiAgICAgICAgcGxheWVyX3BlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRF9TQ1JJUFRfSU5ERVgodGFyZ2V0KQogICAgICAgIGZvciBpPTEsIDMgZG8KICAgICAgICAgICAgbG9jYWwgc3Bhd25fcG9zID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKHBsYXllcl9wZWQsIHBvc19vZmZzZXRzW2ldLCAxLjAsIDAuMCkKICAgICAgICAgICAgbG9jYWwgcGVkID0gZW50aXRpZXMuY3JlYXRlX3BlZCgxLCBwX2hhc2gsIHNwYXduX3BvcywgMC4wKQogICAgICAgICAgICBsb2NhbCBmbGFnID0gZW50aXRpZXMuY3JlYXRlX29iamVjdCh1dGlsLmpvYWF0KCJwcm9wX2ZsYWdfbWV4aWNvIiksIHNwYXduX3BvcywgMCkKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSEVBRElORyhwZWQsIEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcocGxheWVyX3BlZCkrMTgwKQogICAgICAgICAgICBFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkoZmxhZywgcGVkLCAwLCAwLjAsIDAuMCwgMC4wLCAwLjAsIDAuMCwgMC4wLCB0cnVlLCB0cnVlLCBmYWxzZSwgdHJ1ZSwgMSwgdHJ1ZSwgMCkKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09NUExFVEVMWV9ESVNBQkxFX0NPTExJU0lPTihwZWQsIHRydWUsIGZhbHNlKQogICAgICAgICAgICBUQVNLLlRBU0tfU1RBUlRfU0NFTkFSSU9fSU5fUExBQ0UocGVkLCAiV09STERfSFVNQU5fTVVTSUNJQU4iLCAwLCBmYWxzZSkKICAgICAgICAgICAgUEVELlNFVF9CTE9DS0lOR19PRl9OT05fVEVNUE9SQVJZX0VWRU5UUyhwZWQsIHRydWUpCiAgICAgICAgICAgIFBFRC5TRVRfUEVEX0ZMRUVfQVRUUklCVVRFUyhwZWQsIDAsIGZhbHNlKQogICAgICAgICAgICBQRUQuU0VUX1BFRF9DQU5fUkFHRE9MTChwZWQsIGZhbHNlKQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKHBlZCwgdHJ1ZSkKICAgICAgICAgICAgbWVuWyNtZW4gKyAxXSA9IHBlZAogICAgICAgIGVuZAogICAgZW5kKQplbmQKCi0tLS0tLeeUn+aIkOWunuS9kwpmdW5jdGlvbiBzcGF3bl9vYmplY3RfaW5fZnJvbnRfb2ZfcGVkKHBlZCwgaGFzaCwgYW5nLCByb29tLCB6b2ZmLCBzZXRvbmdyb3VuZCkKICAgIGNvb3JkcyA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhwZWQsIDAuMCwgcm9vbSwgem9mZikKICAgIHJlcXVlc3RfbW9kZWwoaGFzaCkKICAgIGhkbmcgPSBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKHBlZCkKICAgIGxvY2FsIG9iaiA9IE9CSkVDVC5DUkVBVEVfT0JKRUNUX05PX09GRlNFVChoYXNoLCBjb29yZHNbJ3gnXSwgY29vcmRzWyd5J10sIGNvb3Jkc1sneiddLCB0cnVlLCBmYWxzZSwgZmFsc2UpCiAgICBFTlRJVFkuU0VUX0VOVElUWV9IRUFESU5HKG9iaiwgaGRuZythbmcpCiAgICBpZiBzZXRvbmdyb3VuZCB0aGVuCiAgICAgICAgT0JKRUNULlBMQUNFX09CSkVDVF9PTl9HUk9VTkRfUFJPUEVSTFkob2JqKQogICAgZW5kCiAgICByZXR1cm4gb2JqCmVuZAoKLS0tLeemgeeUqOmbvgpmdW5jdGlvbiBkaXNhYmxlX2ZvZyh0b2dnbGVkKQogICAgZGlzYWJsZWZvZyA9IHRvZ2dsZWQKICAgIHdoaWxlIGRpc2FibGVmb2cgZG8KICAgICAgICBHUkFQSElDUy5TRVRfVElNRUNZQ0xFX01PRElGSUVSKCJpbnRfbm9fZm9nYWxwaGEiKQogICAgICAgIHV0aWwueWllbGQoKQogICAgZW5kCiAgICBHUkFQSElDUy5TRVRfVElNRUNZQ0xFX01PRElGSUVSKCJqZXdlbHJ5X2VudHJhbmNlX0lOVF9mb2ciKQplbmQKCi0tLS0t5pKS5bC/CmZ1bmN0aW9uIHBlZWxvb3BfcGxheWVyKHBpZCxvbikKICAgIGlmIG9uIHRoZW4KICAgICAgICAKICAgICAgICBsb2NhbCBwbGF5ZXJfcGVkID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgICAgICBsb2NhbCBib25lX2luZGV4ID0gUEVELkdFVF9QRURfQk9ORV9JTkRFWChwbGF5ZXJfcGVkLCAweDJlMjgpCiAgICAgICAgcmVxdWVzdF9wdGZ4X2Fzc2V0KCJjb3JlIikKICAgICAgICBHUkFQSElDUy5VU0VfUEFSVElDTEVfRlhfQVNTRVQoImNvcmUiKQogICAgICAgIHB0ZnhfaWQgPSBHUkFQSElDUy5TVEFSVF9ORVRXT1JLRURfUEFSVElDTEVfRlhfTE9PUEVEX09OX0VOVElUWV9CT05FKCJlbnRfYW1iX3BlZWluZyIsIHBsYXllcl9wZWQsIDAsIDAsIDAsIC05MCwgMCwgMCwgYm9uZV9pbmRleCwgMiwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgMCwgMCwgMCwgMCkKICAgIGVsc2UKICAgICAgICBHUkFQSElDUy5SRU1PVkVfUEFSVElDTEVfRlgocHRmeF9pZCwgdHJ1ZSkKICAgIGVuZAplbmQKCgotLS0tLeiHqumXreaooeW8jwpmdW5jdGlvbiBjaGlja2VubW9kZShvbl90b2dnbGUpCiAgICBsb2NhbCBCbG9ja05ldEV2ZW50cyA9IG1lbnUucmVmX2J5X3BhdGgoIk9ubGluZT5Qcm90ZWN0aW9ucz5FdmVudHM+UmF3IE5ldHdvcmsgRXZlbnRzPkFueSBFdmVudD5CbG9jaz5FbmFibGVkIikKICAgIGxvY2FsIFVuYmxvY2tOZXRFdmVudHMgPSBtZW51LnJlZl9ieV9wYXRoKCJPbmxpbmU+UHJvdGVjdGlvbnM+RXZlbnRzPlJhdyBOZXR3b3JrIEV2ZW50cz5BbnkgRXZlbnQ+QmxvY2s+RGlzYWJsZWQiKQogICAgbG9jYWwgQmxvY2tJbmNTeW5jcyA9IG1lbnUucmVmX2J5X3BhdGgoIk9ubGluZT5Qcm90ZWN0aW9ucz5TeW5jcz5JbmNvbWluZz5BbnkgSW5jb21pbmcgU3luYz5CbG9jaz5FbmFibGVkIikKICAgIGxvY2FsIFVuYmxvY2tJbmNTeW5jcyA9IG1lbnUucmVmX2J5X3BhdGgoIk9ubGluZT5Qcm90ZWN0aW9ucz5TeW5jcz5JbmNvbWluZz5BbnkgSW5jb21pbmcgU3luYz5CbG9jaz5EaXNhYmxlZCIpCiAgICBpZiBvbl90b2dnbGUgdGhlbgogICAgICAgIHV0aWwudG9hc3QoIuW8gOWQr+iHqumXreaooeW8jyIpCiAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJkZXN5bmNhbGwgb24iKQogICAgICAgIG1lbnUudHJpZ2dlcl9jb21tYW5kKEJsb2NrSW5jU3luY3MpCiAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmQoQmxvY2tOZXRFdmVudHMpCiAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJhbnRpY3Jhc2hjYW1lcmEgb24iKQogICAgZWxzZQogICAgICAgIHV0aWwudG9hc3QoIuWFs+mXreiHqumXreaooeW8jyIpCiAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJkZXN5bmNhbGwgb2ZmIikKICAgICAgICBtZW51LnRyaWdnZXJfY29tbWFuZChVbmJsb2NrSW5jU3luY3MpCiAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmQoVW5ibG9ja05ldEV2ZW50cykKICAgICAgICBtZW51LnRyaWdnZXJfY29tbWFuZHMoImFudGljcmFzaGNhbWVyYSBvZmYiKQogICAgZW5kCmVuZAoKLS0tLeaLpuaIquaViOaenApmdW5jdGlvbiBibG9ja2NyYXNoZWZmZWN0KCkKICAgIGxvY2FsIGNvb3JkcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpICwgZmFsc2UpCiAgICBHUkFQSElDUy5SRU1PVkVfUEFSVElDTEVfRlhfSU5fUkFOR0UoY29vcmRzLngsIGNvb3Jkcy55LCBjb29yZHMueiwgNDAwKQogICAgR1JBUEhJQ1MuUkVNT1ZFX1BBUlRJQ0xFX0ZYX0ZST01fRU5USVRZKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCmVuZApmdW5jdGlvbiBibG9ja2ZpcmVlZmZlY3QoKQogICAgbG9jYWwgY29vcmRzID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkgLCBmYWxzZSkKICAgIEZJUkUuU1RPUF9GSVJFX0lOX1JBTkdFKGNvb3Jkcy54LCBjb29yZHMueSwgY29vcmRzLnosIDEwMCkKICAgIEZJUkUuU1RPUF9FTlRJVFlfRklSRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQplbmQKCi0tLS3mtL7pgaPliqvljKoKZnVuY3Rpb24gc2VuZG11Z2dlcl9ucGMocGlkKS0tZ3BiZF9mbV8xKOWFqOWxgOWQjSkgIEdhbmdDYWxsKE1yUm9ib3QpCiAgICAKICAgIGlmIE5FVFdPUksuTkVUV09SS19JU19TQ1JJUFRfQUNUSVZFKCJhbV9nYW5nX2NhbGwiLCAwLCB0cnVlLCAwKSB0aGVuCiAgICAgICAgdXRpbC50b2FzdCgi5b2T5YmN5Yqr5Yyq5rS75Yqo6L+Y5pyq57uT5p2f5ZOmIikKICAgIGVsc2UKICAgICAgICBsb2NhbCBiaXRzX2FkZHIgPSBtZW1vcnkuc2NyaXB0X2dsb2JhbChHbG9iYWxfQmFzZS5ncGJkX2ZtXzEgKyAoUExBWUVSLlBMQVlFUl9JRCgpICogODgzICsgMSkgKyAxNDApIC0tKGh0dHBzOi8vZ2l0aHViLmNvbS9yb290LWNhdXNlL3YtZGVjb21waWxlZC1zY3JpcHRzL2Jsb2IvY2JjZTI3OTc5ZWRlZjY3ZTBiZmIxYzIwNzUwNzJhNGY2NDQ0NjljZi9hbV9qb3lyaWRlci5jI0w5MDIpCiAgICAgICAgbWVtb3J5LndyaXRlX2ludChiaXRzX2FkZHIsIFNFVF9CSVQobWVtb3J5LnJlYWRfaW50KGJpdHNfYWRkciksIDApKQogICAgICAgIAogICAgICAgIHdyaXRlX2dsb2JhbC5pbnQoR2xvYmFsX0Jhc2UuZ3BiZF9mbV8xICsgKFBMQVlFUi5QTEFZRVJfSUQoKSAqIDg4MyArIDEpICsgMTQxLCBwaWQpCiAgICAgICAgdXRpbC50b2FzdCgi5Yqr5Yyq5bey5Ye65YqoIikKICAgIGVuZAplbmQKLS0tLeaLpuaIquWKq+WMqgpmdW5jdGlvbiBibG9ja19tdWdnZXIoKQogICAgaWYgTkVUV09SSy5ORVRXT1JLX0lTX1NFU1NJT05fQUNUSVZFKCkgYW5kIFNDUklQVC5HRVRfTlVNQkVSX09GX1RIUkVBRFNfUlVOTklOR19USEVfU0NSSVBUX1dJVEhfVEhJU19IQVNIKHV0aWwuam9hYXQoImFtX2dhbmdfY2FsbCIpKSA+IDAgdGhlbgogICAgICAgIGxvY2FsIHNlbmRlciA9IG1lbW9yeS5yZWFkX2ludChtZW1vcnkuc2NyaXB0X2xvY2FsKCJhbV9nYW5nX2NhbGwiLCAyODYpKQogICAgICAgIGxvY2FsIHRhcmdldCA9IG1lbW9yeS5yZWFkX2ludChtZW1vcnkuc2NyaXB0X2xvY2FsKCJhbV9nYW5nX2NhbGwiLCAyODcpKSAtLei/lOWbnuebruagh+eOqeWutlBJRAoKICAgICAgICAtLVtbIGxvY2FsIG5ldElkID0gbWVtb3J5LnJlYWRfaW50KG1lbW9yeS5zY3JpcHRfbG9jYWwoImFtX2dhbmdfY2FsbCIsIDYyICsgMTAgKyAxKSkKICAgICAgICB1dGlsLnRvYXN0KG5ldElkKQogICAgICAgIGlmIE5FVFdPUksuTkVUV09SS19ET0VTX05FVFdPUktfSURfRVhJU1QobmV0SWQpIGFuZCB0YXJnZXQgPT0gUExBWUVSLlBMQVlFUl9JRCgpIHRoZW4KICAgICAgICAgICAgbG9jYWwgbXVnZ2VyID0gTkVUV09SSy5ORVRfVE9fUEVEKG5ldElkKQogICAgICAgICAgICBkZWxldGVfZW50aXR5KG11Z2dlcikKICAgICAgICAgICAgdXRpbC50b2FzdCgi5Yqr5Yyq5p2l6IeqOiAiIC4uIFBMQVlFUi5HRVRfUExBWUVSX05BTUUoc2VuZGVyKSkKICAgICAgICBlbmQgXV0KCiAgICAgICAgaWYgdGFyZ2V0ID09IFBMQVlFUi5QTEFZRVJfSUQoKSB0aGVuCiAgICAgICAgICAgIE1JU0MuVEVSTUlOQVRFX0FMTF9TQ1JJUFRTX1dJVEhfVEhJU19OQU1FKCJhbV9nYW5nX2NhbGwiKQogICAgICAgICAgICB1dGlsLnRvYXN0KCLlt7LpmLvmraLliqvljKrkuovku7YiKQogICAgICAgIGVuZAoKICAgIGVuZAplbmQKLS0tLS3liqvljKrmo4DmtYsKZnVuY3Rpb24gc2hvd19tdWdnZXIoKQoJaWYgTkVUV09SSy5ORVRXT1JLX0lTX1NFU1NJT05fQUNUSVZFKCkgYW5kIFNDUklQVC5HRVRfTlVNQkVSX09GX1RIUkVBRFNfUlVOTklOR19USEVfU0NSSVBUX1dJVEhfVEhJU19IQVNIKHV0aWwuam9hYXQoImFtX2dhbmdfY2FsbCIpKSA+IDAgdGhlbgogICAgICAgIGxvY2FsIG5ldElkCT0gbWVtb3J5LnJlYWRfaW50KG1lbW9yeS5zY3JpcHRfbG9jYWwoImFtX2dhbmdfY2FsbCIsIDYyICsgMTAgKyAxKSkKICAgICAgICBpZiBORVRXT1JLLk5FVFdPUktfRE9FU19ORVRXT1JLX0lEX0VYSVNUKG5ldElkKSBhbmQgbm90IEVOVElUWS5JU19FTlRJVFlfREVBRChORVRXT1JLLk5FVF9UT19QRUQobmV0SWQpLCBmYWxzZSkgdGhlbgogICAgICAgICAgICBsb2NhbCBtdWdnZXIgPSBORVRXT1JLLk5FVF9UT19QRUQobmV0SWQpCiAgICAgICAgICAgIGRyYXdfYm91bmRpbmdfYm94KG11Z2dlciwgdHJ1ZSwge3IgPSAyNTUsIGcgPSAwLCBiID0gMCwgYSA9IDgwfSkKICAgICAgICBlbmQKCWVuZAplbmQKCgoKCi0tLS0t5LiA5ouz6LaF5Lq6CmZ1bmN0aW9uIHN1cGVybWFucGVyc29ubCgpCglsb2NhbCBwV2VhcG9uID0gbWVtb3J5LmFsbG9jX2ludCgpCglXRUFQT04uR0VUX0NVUlJFTlRfUEVEX1dFQVBPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBwV2VhcG9uLCAxKQoJbG9jYWwgd2VhcG9uSGFzaCA9IG1lbW9yeS5yZWFkX2ludChwV2VhcG9uKQoJaWYgV0VBUE9OLklTX1BFRF9BUk1FRChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAxKSBvciB3ZWFwb25IYXNoID09IHV0aWwuam9hYXQoIndlYXBvbl91bmFybWVkIikgdGhlbgoJCWxvY2FsIHBJbXBhY3RDb29yZHMgPSB2My5uZXcoKQoJCWxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKCQlpZiBXRUFQT04uR0VUX1BFRF9MQVNUX1dFQVBPTl9JTVBBQ1RfQ09PUkQoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgcEltcGFjdENvb3JkcykgdGhlbgoJCQlzZXRfZXhwbG9zaW9uX3Byb29mKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUpCgkJCXV0aWwueWllbGRfb25jZSgpCgkJCUZJUkUuQUREX0VYUExPU0lPTihwb3MueCwgcG9zLnksIHBvcy56IC0gMS4wLCAyOSwgNS4wLCBmYWxzZSwgdHJ1ZSwgMC4zLCB0cnVlKQoJCWVsc2VpZiBub3QgRklSRS5JU19FWFBMT1NJT05fSU5fU1BIRVJFKDI5LCBwb3MueCwgcG9zLnksIHBvcy56LCAyLjApIHRoZW4KCQkJc2V0X2V4cGxvc2lvbl9wcm9vZihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKCQllbmQKCWVuZAplbmQKCgotLS0t5bCP54uX5p6qCmZ1bmN0aW9uIHBvb2RsZV9ndW4odG9nZ2xlKQogICAgZG9nZ3VuX3RvZ2dsZWQgPSB0b2dnbGUKICAgIGlmIGRvZ2d1bl90b2dnbGVkIHRoZW4KICAgICAgICBQRUQuU0VUX1BFRF9DQU5fU1dJVENIX1dFQVBPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSktLeemgeatouWIh+aNouatpuWZqAogICAgICAgIFdFQVBPTi5HSVZFX1dFQVBPTl9UT19QRUQoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgLTE3NjgxNDU1NjEsIDEsIHRydWUsIHRydWUpCiAgICAgICAgV0VBUE9OLlNFVF9QRURfQ1VSUkVOVF9XRUFQT05fVklTSUJMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBub3QgZG9nZ3VuX3RvZ2dsZWQsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCgogICAgICAgIGxvY2FsIGhhc2ggPSAxMTI1OTk0NTI0CiAgICAgICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKQogICAgICAgIGRvZ19ndW4gPSBjcmVhdGVfcGVkKDAsIGhhc2gsIHBvcy54LCBwb3MueSwgcG9zLnosIDApCiAgICAgICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKGRvZ19ndW4sIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIFBFRC5HRVRfUEVEX0JPTkVfSU5ERVgoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMTg5MDUpLCAwLjAzLCAtMC4wMSwgMC4xNSwgLTUwLCAwLCAzMjAsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIHRydWUsIDAsIHRydWUsIDApCgogICAgICAgIHdoaWxlIGRvZ2d1bl90b2dnbGVkIGRvCiAgICAgICAgICAgIFRBU0suQ0xFQVJfUEVEX1RBU0tTX0lNTUVESUFURUxZKGRvZ19ndW4pCiAgICAgICAgICAgIHV0aWwueWllbGQoKQogICAgICAgIGVuZAoKICAgIGVsc2UKICAgICAgICBXRUFQT04uU0VUX1BFRF9DVVJSRU5UX1dFQVBPTl9WSVNJQkxFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIG5vdCBkb2dndW5fdG9nZ2xlZCwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgICAgICBQRUQuU0VUX1BFRF9DQU5fU1dJVENIX1dFQVBPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlKQogICAgICAgIGRlbGV0ZV9lbnRpdHkoZG9nX2d1bikKICAgIGVuZAplbmQKCgotLS0tLS0t5qC45by55p6qCm11dHVhbGx5X2V4Y2x1c2l2ZV93ZWFwb25zICA9IHt9CmZ1bmN0aW9uIHRvRGlyZWN0aW9uKHJvdGF0aW9uKSAKCWxvY2FsIGFkanVzdGVkX3JvdGF0aW9uID0geyAKCQl4ID0gKG1hdGgucGkgLyAxODApICogcm90YXRpb24ueCwgCgkJeSA9IChtYXRoLnBpIC8gMTgwKSAqIHJvdGF0aW9uLnksIAoJCXogPSAobWF0aC5waSAvIDE4MCkgKiByb3RhdGlvbi56IAoJfQoJbG9jYWwgZGlyZWN0aW9uID0gewoJCXggPSAtIG1hdGguc2luKGFkanVzdGVkX3JvdGF0aW9uLnopICogbWF0aC5hYnMobWF0aC5jb3MoYWRqdXN0ZWRfcm90YXRpb24ueCkpLCAKCQl5ID0gICBtYXRoLmNvcyhhZGp1c3RlZF9yb3RhdGlvbi56KSAqIG1hdGguYWJzKG1hdGguY29zKGFkanVzdGVkX3JvdGF0aW9uLngpKSwgCgkJeiA9ICAgbWF0aC5zaW4oYWRqdXN0ZWRfcm90YXRpb24ueCkKCX0KCXJldHVybiBkaXJlY3Rpb24KZW5kCmZ1bmN0aW9uIGRpcmVjdGlvbigpCiAgICBsb2NhbCBjMSA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwLCA1LCAwKQogICAgbG9jYWwgcmVzID0gcmF5Y2FzdF9nYW1lcGxheV9jYW0oLTEsIDEwMDApCiAgICBsb2NhbCBjMgogICAgaWYgcmVzWzFdIH49IDAgdGhlbgogICAgICAgIGMyID0gcmVzWzJdCiAgICBlbHNlCiAgICAgICAgYzIgPSBnZXRfb2Zmc2V0X2Zyb21fY2FtZXJhKDEwMDApCiAgICBlbmQKICAgIGMyLnggPSAoYzIueCAtIGMxLngpICogMTAwMAogICAgYzIueSA9IChjMi55IC0gYzEueSkgKiAxMDAwCiAgICBjMi56ID0gKGMyLnogLSBjMS56KSAqIDEwMDAKICAgIHJldHVybiBjMiwgYzEKZW5kCmZ1bmN0aW9uIG51a2VndW5tb2RlKCkKICAgIGlmIFBFRC5JU19QRURfU0hPT1RJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgdGhlbgogICAgICAgIFdFQVBPTi5SRU1PVkVfQUxMX1BST0pFQ1RJTEVTX09GX1RZUEUoLTEzMTIxMzExNTEsIGZhbHNlKQogICAgICAgIHV0aWwuY3JlYXRlX3RocmVhZChmdW5jdGlvbigpCiAgICAgICAgICAgIGxvY2FsIGhhc2ggPSB1dGlsLmpvYWF0KCd3X2FyZW5hX2Fpcm1pc3NpbGVfMDFhJykKICAgICAgICAgICAgcmVxdWVzdF9tb2RlbChoYXNoKQogICAgICAgICAgICBsb2NhbCBjYW1fcm90ID0gQ0FNLkdFVF9GSU5BTF9SRU5ERVJFRF9DQU1fUk9UKDIpCiAgICAgICAgICAgIGxvY2FsIGRpciwgcG9zID0gZGlyZWN0aW9uKCkKICAgICAgICAgICAgbG9jYWwgYm9tYiA9IGVudGl0aWVzLmNyZWF0ZV9vYmplY3QoaGFzaCwgcG9zKQogICAgICAgICAgICBFTlRJVFkuQVBQTFlfRk9SQ0VfVE9fRU5USVRZKGJvbWIsIDAsIGRpci54LCBkaXIueSwgZGlyLnosIDAuMCwgMC4wLCAwLjAsIDAsIHRydWUsIGZhbHNlLCB0cnVlLCBmYWxzZSwgdHJ1ZSkKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04oYm9tYiwgY2FtX3JvdC54LCBjYW1fcm90LnksIGNhbV9yb3QueiwgMSwgdHJ1ZSkKICAgICAgICAgICAgd2hpbGUgbm90IEVOVElUWS5IQVNfRU5USVRZX0NPTExJREVEX1dJVEhfQU5ZVEhJTkcoYm9tYikgZG8KICAgICAgICAgICAgICAgIHV0aWwueWllbGQoKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgbG9jYWwgbnVrZVBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhib21iLCB0cnVlKQogICAgICAgICAgICBkZWxldGVfZW50aXR5KGJvbWIpCiAgICAgICAgICAgIGV4ZWN1dGVOdWtlKG51a2VQb3MpCiAgICAgICAgZW5kKQogICAgZW5kCmVuZAoKCi0tLS0tLeadgOatu+aVjOS6ugpmdW5jdGlvbiBnZXRfcGVkc19pbl9wbGF5ZXJfcmFuZ2UocGxheWVyLCByYWRpdXMpCglsb2NhbCBwZWRzID0ge30KCWxvY2FsIHBsYXllclBlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRF9TQ1JJUFRfSU5ERVgocGxheWVyKQoJbG9jYWwgcG9zID0gcGxheWVycy5nZXRfcG9zaXRpb24ocGxheWVyKQoJZm9yIF8sIHBlZCBpbiBpcGFpcnMoZW50aXRpZXMuZ2V0X2FsbF9wZWRzX2FzX2hhbmRsZXMoKSkgZG8KCQlpZiBwZWQgfj0gcGxheWVyUGVkIGFuZCBub3QgUEVELklTX1BFRF9GQVRBTExZX0lOSlVSRUQocGVkKSB0aGVuCgkJCWxvY2FsIHBlZFBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhwZWQsIHRydWUpCgkJCWlmIHBvczpkaXN0YW5jZShwZWRQb3MpIDw9IHJhZGl1cyB0aGVuIHRhYmxlLmluc2VydChwZWRzLCBwZWQpIGVuZAoJCWVuZAoJZW5kCglyZXR1cm4gcGVkcwplbmQKCgotLS0t5oqV5o6354mp5Y+R5bCE5ZmoCmxvY2FsIGxhdW5jaGVyVGhyb3dhYmxlID0gdXRpbC5qb2FhdCgnd2VhcG9uX2dyZW5hZGUnKQpmdW5jdGlvbiBidWxsZXRzZXQodmFsdWUpCiAgICBsYXVuY2hlclRocm93YWJsZSA9IHRocm93YWJsZXNUYWJsZS5oYXNoW3ZhbHVlXQplbmQKZnVuY3Rpb24gdGhyb3dhYmxlYnVsbGV0KCkKICAgIGlmIFdFQVBPTi5HRVRfU0VMRUNURURfUEVEX1dFQVBPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSA9PSAtMTU2ODM4NjgwNSBhbmQgUEVELklTX1BFRF9TSE9PVElORyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSB0aGVuCiAgICAgICAgLS3np7vpmaTmnKzouqvlvLnoja8KICAgICAgICBXRUFQT04uUkVNT1ZFX0FMTF9QUk9KRUNUSUxFU19PRl9UWVBFKC0xNTY4Mzg2ODA1LCBmYWxzZSkKICAgIAogICAgICAgIGxvY2FsIGN1cnJlbnRXZWFwb24gPSBXRUFQT04uR0VUX0NVUlJFTlRfUEVEX1dFQVBPTl9FTlRJVFlfSU5ERVgoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpCiAgICAgICAgbG9jYWwgcG9zMSA9IEVOVElUWS5HRVRfRU5USVRZX0JPTkVfUE9TVElPTihjdXJyZW50V2VhcG9uLCBFTlRJVFkuR0VUX0VOVElUWV9CT05FX0lOREVYX0JZX05BTUUoY3VycmVudFdlYXBvbiwgJ2d1bl9tdXp6bGUnKSkKICAgICAgICBsb2NhbCBwb3MyID0gZ2V0X29mZnNldF9mcm9tX2NhbWVyYSgzMCkKICAgICAgICBpZiBub3QgV0VBUE9OLkhBU19QRURfR09UX1dFQVBPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBsYXVuY2hlclRocm93YWJsZSwgZmFsc2UpIHRoZW4KICAgICAgICAgICAgV0VBUE9OLkdJVkVfV0VBUE9OX1RPX1BFRChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBsYXVuY2hlclRocm93YWJsZSwgOTk5OSwgZmFsc2UsIGZhbHNlKQogICAgICAgIGVuZAogICAgICAgIE1JU0MuU0hPT1RfU0lOR0xFX0JVTExFVF9CRVRXRUVOX0NPT1JEUyhwb3MxLngsIHBvczEueSwgcG9zMS56LCBwb3MyLngsIHBvczIueSwgcG9zMi56LCAyMDAsIHRydWUsIGxhdW5jaGVyVGhyb3dhYmxlLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlLCBmYWxzZSwgMjAwMC4wKQogICAgZW5kCmVuZAoKCi0tLS3kuL7miYsKZnVuY3Rpb24gcmFpc2VfaGFuZCgpCiAgICBpZiBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDEsIDMyMykgdGhlbgogICAgICAgIHJlcXVlc3RfYW5pbV9kaWN0KCJyYW5kb21AbXVnZ2luZzMiKQogICAgICAgIGlmIG5vdCBFTlRJVFkuSVNfRU5USVRZX1BMQVlJTkdfQU5JTShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAicmFuZG9tQG11Z2dpbmczIiwgImhhbmRzdXBfc3RhbmRpbmdfYmFzZSIsIDMpIHRoZW4KICAgICAgICAgICAgV0VBUE9OLlNFVF9DVVJSRU5UX1BFRF9XRUFQT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgTUlTQy5HRVRfSEFTSF9LRVkoIldFQVBPTl9VTkFSTUVEIiksIHRydWUpCiAgICAgICAgICAgIFRBU0suVEFTS19QTEFZX0FOSU0oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgInJhbmRvbUBtdWdnaW5nMyIsICJoYW5kc3VwX3N0YW5kaW5nX2Jhc2UiLCAzLCAzLCAtMSwgNTEsIDAsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgICAgIFNUUkVBTUlORy5SRU1PVkVfQU5JTV9ESUNUKCJyYW5kb21AbXVnZ2luZzMiKQogICAgICAgICAgICBQRUQuU0VUX0VOQUJMRV9IQU5EQ1VGRlMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSkKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICBpZiBFTlRJVFkuSVNfRU5USVRZX1BMQVlJTkdfQU5JTShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAicmFuZG9tQG11Z2dpbmczIiwgImhhbmRzdXBfc3RhbmRpbmdfYmFzZSIsIDMpIHRoZW4KICAgICAgICAgICAgVEFTSy5DTEVBUl9QRURfU0VDT05EQVJZX1RBU0soUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgICAgICAgICAgUEVELlNFVF9FTkFCTEVfSEFORENVRkZTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKLS0tLeWkquepuuatpQpmdW5jdGlvbiBTcGFjZV93YWxrKCkKICAgIGlmIFBBRC5JU19DT05UUk9MX1BSRVNTRUQoMCwgMzIpICBvciBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsIDM0KSBvciBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsIDM1KSB0aGVuCiAgICAgICAgbG9jYWwgZiA9IEVOVElUWS5HRVRfRU5USVRZX0ZPUldBUkRfVkVDVE9SKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICAgICAgZlsneCddID0gLWZbJ3gnXQogICAgICAgIGZbJ3knXSA9IC1mWyd5J10KICAgICAgICBmWyd6J10gPSAtZlsneiddCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfVkVMT0NJVFkoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZlsneCddLCBmWyd5J10qMywgMC4wKQogICAgZW5kCmVuZAotLS0t6KGo5ryUCmZ1bmN0aW9uIFBlcmZvcm1pbmdfYWN0aW9ucyhpbmRleCkKICAgIGxvY2FsIGFuaW1EaWN0aW9uYXJ5ID0geyJhbmltQGFyZW5hQGNlbGViQGZsYXRAc29sb0Bub19wcm9wc0AiLCJhbmltQGFyZW5hQGNlbGViQGZsYXRAc29sb0Bub19wcm9wc0AiLCJhbmltQG1wX3BsYXllcl9pbnRjZWxlYnJhdGlvbmZlbWFsZUBrYXJhdGVfY2hvcHMifQogICAgbG9jYWwgYW5pbWF0aW9uTmFtZSA9IHsiY2FwX2FfcGxheWVyX2EiLCJmbGlwX2FfcGxheWVyX2EiLCJrYXJhdGVfY2hvcHMifQogICAgcmVxdWVzdF9hbmltX2RpY3QoYW5pbURpY3Rpb25hcnlbaW5kZXhdKQogICAgVEFTSy5UQVNLX1BMQVlfQU5JTShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBhbmltRGljdGlvbmFyeVtpbmRleF0sIGFuaW1hdGlvbk5hbWVbaW5kZXhdLCA4LjAsIDguMCwgNTAwMCwgMSwgMCwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkKZW5kCi0tLS3lv43ogIXot5EKZnVuY3Rpb24gcmVuemhlcGFvKG9uKQogICAgaWYgb24gdGhlbgogICAgICAgIGxvY2FsIHJlbnpoZSA9ICJtaXNzZmJpMSIKICAgICAgICBsb2NhbCBwYW8gPSAibGVkZ2VfbG9vcCIKICAgICAgICByZXF1ZXN0X2FuaW1fZGljdChyZW56aGUpCiAgICAgICAgVEFTSy5UQVNLX1BMQVlfQU5JTShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCByZW56aGUsIHBhbywgMywgMywgLTEsIDUxLCAwLCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgICAgIFBFRC5TRVRfRU5BQkxFX0hBTkRDVUZGUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlKQogICAgZWxzZQogICAgICAgIFRBU0suQ0xFQVJfUEVEX1RBU0tTX0lNTUVESUFURUxZKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICAgICAgUEVELlNFVF9FTkFCTEVfSEFORENVRkZTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKQogICAgZW5kCmVuZAotLS0t5YmN56m657+7CmZ1bmN0aW9uIGZvcndhcmRfc29tZXJzYXVsdCgpCiAgICBsb2NhbCBoZGcgPSBDQU0uR0VUX0dBTUVQTEFZX0NBTV9ST1QoMCkuegogICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMCwgMCwgaGRnLCAxLCB0cnVlKQogICAgZm9yIGkgPSAwLCAtMzYwLCAtOCBkbwogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGksIDAsIGhkZywgMSwgdHJ1ZSkKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAplbmQKCgotLS0tLS0tLeWMv+WQjeadgOatu+aJgOacieS6ugpmdW5jdGlvbiBraWxsX3BsYXllcihwaWQpCiAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCksIGZhbHNlKQogICAgRklSRS5BRERfRVhQTE9TSU9OKHBvcy54LCBwb3MueSwgcG9zLnosIDEsIDEwMCwgdHJ1ZSwgZmFsc2UsIDEsIGZhbHNlKQplbmQKZnVuY3Rpb24gbmltaW5nc2hhcmVuKCkKICAgIGZvciBrLHYgaW4gcGFpcnMocGxheWVycy5saXN0KGZhbHNlLCB0cnVlLCB0cnVlKSkgZG8KICAgICAgICBraWxsX3BsYXllcih2KQogICAgZW5kCmVuZAoKCi0t5pmu6YCa56y85a2QCmZ1bmN0aW9uIHB0bHoocGlkKQogICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpKQogICAgbG9jYWwgaGFzaCA9IHV0aWwuam9hYXQoInByb3BfZ29sZF9jb250XzAxIikKICAgIHJlcXVlc3RfbW9kZWwoaGFzaCkKCXBvcy56ID0gcG9zLnotMC45Cglsb2NhbCBvYmplY3QxID0gT0JKRUNULkNSRUFURV9PQkpFQ1QoaGFzaCwgcG9zLngsIHBvcy55LCBwb3MueiwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkJCQkJCQkJCQkJCQkJCQkJCQoJRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04ob2JqZWN0MSwgdHJ1ZSkKZW5kCi0t5LiD5bqm56m66Ze0CmZ1bmN0aW9uIHFka2oocGlkKQoJbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpKQoJbG9jYWwgaGFzaCA9IDEwODk4MDcyMDkKICAgIHJlcXVlc3RfbW9kZWwoaGFzaCkKCWxvY2FsIGNhZ2Vfb2JqZWN0ID0gT0JKRUNULkNSRUFURV9PQkpFQ1QoaGFzaCwgcG9zLnggLSAxLCBwb3MueSwgcG9zLnogLSAuNSwgdHJ1ZSwgdHJ1ZSwgZmFsc2UpIC0tIGZyb250Cglsb2NhbCBjYWdlX29iamVjdDIgPSBPQkpFQ1QuQ1JFQVRFX09CSkVDVChoYXNoLCBwb3MueCArIDEsIHBvcy55LCBwb3MueiAtIC41LCB0cnVlLCB0cnVlLCBmYWxzZSkgLS0gYmFjawoJbG9jYWwgY2FnZV9vYmplY3QzID0gT0JKRUNULkNSRUFURV9PQkpFQ1QoaGFzaCwgcG9zLngsIHBvcy55ICsgMSwgcG9zLnogLSAuNSwgdHJ1ZSwgdHJ1ZSwgZmFsc2UpIC0tIGxlZnQKCWxvY2FsIGNhZ2Vfb2JqZWN0NCA9IE9CSkVDVC5DUkVBVEVfT0JKRUNUKGhhc2gsIHBvcy54LCBwb3MueSAtIDEsIHBvcy56IC0gLjUsIHRydWUsIHRydWUsIGZhbHNlKSAtLSByaWdodAoJbG9jYWwgY2FnZV9vYmplY3Q1ID0gT0JKRUNULkNSRUFURV9PQkpFQ1QoaGFzaCwgcG9zLngsIHBvcy55LCBwb3MueiArIC43NSwgdHJ1ZSwgdHJ1ZSwgZmFsc2UpIC0tIGFib3ZlCglFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihjYWdlX29iamVjdCwgdHJ1ZSkKCUVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKGNhZ2Vfb2JqZWN0MiwgdHJ1ZSkKCUVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKGNhZ2Vfb2JqZWN0MywgdHJ1ZSkKCUVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKGNhZ2Vfb2JqZWN0NCwgdHJ1ZSkKCUVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKGNhZ2Vfb2JqZWN0NSwgdHJ1ZSkKCXV0aWwueWllbGQoMTUpCglTVFJFQU1JTkcuU0VUX01PREVMX0FTX05PX0xPTkdFUl9ORUVERUQoY2FnZV9vYmplY3QpCmVuZAotLemSseesvOWtkApmdW5jdGlvbiB6ZGx6KHBpZCkKCWxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSkKCWxvY2FsIGhhc2ggPSB1dGlsLmpvYWF0KCJia3JfcHJvcF9tb25leXBhY2tfMDNhIikKICAgIHJlcXVlc3RfbW9kZWwoaGFzaCkKCWxvY2FsIGNhZ2Vfb2JqZWN0ID0gT0JKRUNULkNSRUFURV9PQkpFQ1QoaGFzaCwgcG9zLnggLSAuNzAsIHBvcy55LCBwb3MueiArIC4yNSwgdHJ1ZSwgdHJ1ZSwgZmFsc2UpIC0tIGZyb250Cglsb2NhbCBjYWdlX29iamVjdDIgPSBPQkpFQ1QuQ1JFQVRFX09CSkVDVChoYXNoLCBwb3MueCArIC43MCwgcG9zLnksIHBvcy56ICsgLjI1LCB0cnVlLCB0cnVlLCBmYWxzZSkgLS0gYmFjawoJbG9jYWwgY2FnZV9vYmplY3QzID0gT0JKRUNULkNSRUFURV9PQkpFQ1QoaGFzaCwgcG9zLngsIHBvcy55ICsgLjcwLCBwb3MueiArIC4yNSwgdHJ1ZSwgdHJ1ZSwgZmFsc2UpIC0tIGxlZnQKCWxvY2FsIGNhZ2Vfb2JqZWN0NCA9IE9CSkVDVC5DUkVBVEVfT0JKRUNUKGhhc2gsIHBvcy54LCBwb3MueSAtIC43MCwgcG9zLnogKyAuMjUsIHRydWUsIHRydWUsIGZhbHNlKSAtLSByaWdodAoJbG9jYWwgY2FnZV9vYmplY3Q1ID0gT0JKRUNULkNSRUFURV9PQkpFQ1QoaGFzaCwgcG9zLngsIHBvcy55LCBwb3MueiArIC43NSwgdHJ1ZSwgdHJ1ZSwgZmFsc2UpIC0tIGFib3ZlCgl1dGlsLnlpZWxkKDE1KQoJbG9jYWwgcm90ICA9IEVOVElUWS5HRVRfRU5USVRZX1JPVEFUSU9OKGNhZ2Vfb2JqZWN0LCAwKQoJcm90LnkgPSA5MAoJRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04oY2FnZV9vYmplY3QsIHJvdC54LHJvdC55LHJvdC56LCAxLHRydWUpCglTVFJFQU1JTkcuU0VUX01PREVMX0FTX05PX0xPTkdFUl9ORUVERUQoY2FnZV9vYmplY3QpCmVuZAotLeWeg+WcvueusQpmdW5jdGlvbiB5eWx6KHBpZCkKCWxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSkKCWxvY2FsIGhhc2ggPSA2ODQ1ODY4MjgKCXJlcXVlc3RfbW9kZWwoaGFzaCkKCWxvY2FsIGNhZ2Vfb2JqZWN0ID0gT0JKRUNULkNSRUFURV9PQkpFQ1QoaGFzaCwgcG9zLngsIHBvcy55LCBwb3MueiwgdHJ1ZSwgdHJ1ZSwgZmFsc2UpCglsb2NhbCBjYWdlX29iamVjdDEgPSBPQkpFQ1QuQ1JFQVRFX09CSkVDVChoYXNoLCBwb3MueCwgcG9zLnksIHBvcy56ICsgMSwgdHJ1ZSwgdHJ1ZSwgZmFsc2UpCgl1dGlsLnlpZWxkKDE1KQoJbG9jYWwgcm90ICA9IEVOVElUWS5HRVRfRU5USVRZX1JPVEFUSU9OKGNhZ2Vfb2JqZWN0LCAwKQoJcm90LnkgPSA5MAoJRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04oY2FnZV9vYmplY3QsIHJvdC54LHJvdC55LHJvdC56LCAxLHRydWUpCglTVFJFQU1JTkcuU0VUX01PREVMX0FTX05PX0xPTkdFUl9ORUVERUQoY2FnZV9vYmplY3QpCmVuZAotLeWwj+i9pui9pgpmdW5jdGlvbiBjY2x6KHBpZCkKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSkKICAgIGxvY2FsIGhhc2ggPSA0MDIyNjA1NDAyCiAgICByZXF1ZXN0X21vZGVsKGhhc2gpCiAgICBsb2NhbCBjYWdlX29iamVjdCA9IE9CSkVDVC5DUkVBVEVfT0JKRUNUKGhhc2gsIHBvcy54LCBwb3MueSwgcG9zLnogLSAxLCB0cnVlLCB0cnVlLCBmYWxzZSkKICAgIHV0aWwueWllbGQoMTUpCiAgICBTVFJFQU1JTkcuU0VUX01PREVMX0FTX05PX0xPTkdFUl9ORUVERUQoY2FnZV9vYmplY3QpCmVuZAotLeWco+ivnuW/q+S5kApmdW5jdGlvbiBzZGtsMShwaWQpCglsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkpCglsb2NhbCBoYXNoID0gMjM4Nzg5NzEyCiAgICByZXF1ZXN0X21vZGVsKGhhc2gpCglsb2NhbCBjYWdlX29iamVjdCA9IE9CSkVDVC5DUkVBVEVfT0JKRUNUKGhhc2gsIHBvcy54LCBwb3MueSwgcG9zLnogLSAxLCB0cnVlLCB0cnVlLCBmYWxzZSkKCXV0aWwueWllbGQoMTUpCglTVFJFQU1JTkcuU0VUX01PREVMX0FTX05PX0xPTkdFUl9ORUVERUQoY2FnZV9vYmplY3QpCmVuZAotLeWco+ivnuW/q+S5kHBybwpmdW5jdGlvbiBzZGtsMihwaWQpCglsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkpCglsb2NhbCBoYXNoID0gdXRpbC5qb2FhdCgiY2hfcHJvcF90cmVlXzAyYSIpCiAgICByZXF1ZXN0X21vZGVsKGhhc2gpCglsb2NhbCBjYWdlX29iamVjdCA9IE9CSkVDVC5DUkVBVEVfT0JKRUNUKGhhc2gsIHBvcy54IC0gLjc1LCBwb3MueSwgcG9zLnogLSAuNSwgdHJ1ZSwgdHJ1ZSwgZmFsc2UpIC0tIGZyb250Cglsb2NhbCBjYWdlX29iamVjdDIgPSBPQkpFQ1QuQ1JFQVRFX09CSkVDVChoYXNoLCBwb3MueCArIC43NSwgcG9zLnksIHBvcy56IC0gLjUsIHRydWUsIHRydWUsIGZhbHNlKSAtLSBiYWNrCglsb2NhbCBjYWdlX29iamVjdDMgPSBPQkpFQ1QuQ1JFQVRFX09CSkVDVChoYXNoLCBwb3MueCwgcG9zLnkgKyAuNzUsIHBvcy56IC0gLjUsIHRydWUsIHRydWUsIGZhbHNlKSAtLSBsZWZ0Cglsb2NhbCBjYWdlX29iamVjdDQgPSBPQkpFQ1QuQ1JFQVRFX09CSkVDVChoYXNoLCBwb3MueCwgcG9zLnkgLSAuNzUsIHBvcy56IC0gLjUsIHRydWUsIHRydWUsIGZhbHNlKSAtLSByaWdodAoJbG9jYWwgY2FnZV9vYmplY3Q1ID0gT0JKRUNULkNSRUFURV9PQkpFQ1QoaGFzaCwgcG9zLngsIHBvcy55LCBwb3MueiArIC41LCB0cnVlLCB0cnVlLCBmYWxzZSkgLS0gYWJvdmUKCXV0aWwueWllbGQoMTUpCglTVFJFQU1JTkcuU0VUX01PREVMX0FTX05PX0xPTkdFUl9ORUVERUQoY2FnZV9vYmplY3QpCmVuZAotLeWco+ivnuW/q+S5kHByb21heApmdW5jdGlvbiBzZGtsMyhwaWQpCglsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkpCglsb2NhbCBoYXNoID0gdXRpbC5qb2FhdCgiY2hfcHJvcF90cmVlXzAzYSIpCiAgICByZXF1ZXN0X21vZGVsKGhhc2gpCglsb2NhbCBjYWdlX29iamVjdCA9IE9CSkVDVC5DUkVBVEVfT0JKRUNUKGhhc2gsIHBvcy54IC0gLjc1LCBwb3MueSwgcG9zLnogLSAuNSwgdHJ1ZSwgdHJ1ZSwgZmFsc2UpIC0tIGZyb250Cglsb2NhbCBjYWdlX29iamVjdDIgPSBPQkpFQ1QuQ1JFQVRFX09CSkVDVChoYXNoLCBwb3MueCArIC43NSwgcG9zLnksIHBvcy56IC0gLjUsIHRydWUsIHRydWUsIGZhbHNlKSAtLSBiYWNrCglsb2NhbCBjYWdlX29iamVjdDMgPSBPQkpFQ1QuQ1JFQVRFX09CSkVDVChoYXNoLCBwb3MueCwgcG9zLnkgKyAuNzUsIHBvcy56IC0gLjUsIHRydWUsIHRydWUsIGZhbHNlKSAtLSBsZWZ0Cglsb2NhbCBjYWdlX29iamVjdDQgPSBPQkpFQ1QuQ1JFQVRFX09CSkVDVChoYXNoLCBwb3MueCwgcG9zLnkgLSAuNzUsIHBvcy56IC0gLjUsIHRydWUsIHRydWUsIGZhbHNlKSAtLSByaWdodAoJbG9jYWwgY2FnZV9vYmplY3Q1ID0gT0JKRUNULkNSRUFURV9PQkpFQ1QoaGFzaCwgcG9zLngsIHBvcy55LCBwb3MueiArIC41LCB0cnVlLCB0cnVlLCBmYWxzZSkgLS0gYWJvdmUKCXV0aWwueWllbGQoKQoJbG9jYWwgcm90ICA9IEVOVElUWS5HRVRfRU5USVRZX1JPVEFUSU9OKGNhZ2Vfb2JqZWN0LCAwKQoJcm90LnkgPSA5MAoJRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04oY2FnZV9vYmplY3QsIHJvdC54LHJvdC55LHJvdC56LCAxLCB0cnVlKQoJU1RSRUFNSU5HLlNFVF9NT0RFTF9BU19OT19MT05HRVJfTkVFREVEKGNhZ2Vfb2JqZWN0KQplbmQKLS3nlLXlh7vnrLwKZnVuY3Rpb24gcG93ZXJjYWdlKHBpZCkKICAgIGxvY2FsIG51bWJlcl9vZl9jYWdlcyA9IDYKICAgIGxvY2FsIGVsZWNfYm94ID0gdXRpbC5qb2FhdCgicHJvcF9lbGVjYm94XzEyIikKICAgIGxvY2FsIHBlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMocGVkKQogICAgcG9zLnogPSBwb3MueiAtIDAuNQogICAgcmVxdWVzdF9tb2RlbChlbGVjX2JveCkKICAgIGxvY2FsIHRlbXBfdjMgPSB2My5uZXcoMCwgMCwgMCkKICAgIGZvciBpID0gMSwgbnVtYmVyX29mX2NhZ2VzIGRvCiAgICAgICAgbG9jYWwgYW5nbGUgPSAoaSAvIG51bWJlcl9vZl9jYWdlcykgKiAzNjAKICAgICAgICB0ZW1wX3YzLnogPSBhbmdsZQogICAgICAgIGxvY2FsIG9ial9wb3MgPSB0ZW1wX3YzOnRvRGlyKCkKICAgICAgICBvYmpfcG9zOm11bCgyLjUpCiAgICAgICAgb2JqX3BvczphZGQocG9zKQogICAgICAgIGZvciBvZmZzX3ogPSAxLCA1IGRvCiAgICAgICAgICAgIGxvY2FsIGVsZWN0cmljX2NhZ2UgPSBlbnRpdGllcy5jcmVhdGVfb2JqZWN0KGVsZWNfYm94LCBvYmpfcG9zKQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9ST1RBVElPTihlbGVjdHJpY19jYWdlLCA5MC4wLCAwLjAsIGFuZ2xlLCAxLCB0cnVlKQogICAgICAgICAgICBvYmpfcG9zLnogPSBvYmpfcG9zLnogKyAwLjc1CiAgICAgICAgICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKGVsZWN0cmljX2NhZ2UsIHRydWUpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCi0t56ue5oqA566hCmZ1bmN0aW9uIGpqZ2x6KHBpZCkKICAgbG9jYWwgaGFzaCA9IHV0aWwuam9hYXQoInN0dF9wcm9wX3N0dW50X3R1YmVfcyIpCglyZXF1ZXN0X21vZGVsKGhhc2gpCglsb2NhbCBwb3MgPSBwbGF5ZXJzLmdldF9wb3NpdGlvbihwaWQpCglsb2NhbCBvYmogPSBlbnRpdGllcy5jcmVhdGVfb2JqZWN0KGhhc2gsIHBvcykKCWxvY2FsIHJvdCA9IEVOVElUWS5HRVRfRU5USVRZX1JPVEFUSU9OKG9iaiwgMikKCUVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKG9iaiwgcm90LngsIDkwLjAsIHJvdC56LCAxLCB0cnVlKQoJU1RSRUFNSU5HLlNFVF9NT0RFTF9BU19OT19MT05HRVJfTkVFREVEKGhhc2gpCmVuZAoKLS3oi7Hlm73lpbPnjovnrLzlrZAKZnVuY3Rpb24gZ3VlZW5jYWdlKHBpZCkKICAgIGxvY2FsIG51bWJlcl9vZl9jYWdlcyA9IDYKICAgIGxvY2FsIGNvZmZpbl9oYXNoID0gdXRpbC5qb2FhdCgicHJvcF9jb2ZmaW5fMDJiIikKICAgIGxvY2FsIHBlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMocGVkKQogICAgcmVxdWVzdF9tb2RlbChjb2ZmaW5faGFzaCkKICAgIGxvY2FsIHRlbXBfdjMgPSB2My5uZXcoMCwgMCwgMCkKICAgIGZvciBpID0gMSwgbnVtYmVyX29mX2NhZ2VzIGRvCiAgICAgICAgbG9jYWwgYW5nbGUgPSAoaSAvIG51bWJlcl9vZl9jYWdlcykgKiAzNjAKICAgICAgICB0ZW1wX3YzLnogPSBhbmdsZQogICAgICAgIGxvY2FsIG9ial9wb3MgPSB0ZW1wX3YzOnRvRGlyKCkKICAgICAgICBvYmpfcG9zOm11bCgwLjgpCiAgICAgICAgb2JqX3BvczphZGQocG9zKQogICAgICAgIG9ial9wb3MueiA9IG9ial9wb3MueiArIDAuMQogICAgICAgbG9jYWwgY29mZmluID0gZW50aXRpZXMuY3JlYXRlX29iamVjdChjb2ZmaW5faGFzaCwgb2JqX3BvcykKICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKGNvZmZpbiwgOTAuMCwgMC4wLCBhbmdsZSwgMSwgdHJ1ZSkKICAgICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKGNvZmZpbiwgdHJ1ZSkKICAgIGVuZAplbmQKLS3ov5DovpPpm4boo4XnrrEKZnVuY3Rpb24gY2hlc3RjYWdlKHBpZCkKICAgIGxvY2FsIGNvbnRhaW5lcl9oYXNoID0gdXRpbC5qb2FhdCgicHJvcF9jb250YWluZXJfbGRfcHUiKQogICAgbG9jYWwgcGVkID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhwZWQpCiAgICByZXF1ZXN0X21vZGVsKGNvbnRhaW5lcl9oYXNoKQogICAgcG9zLnogPSBwb3MueiAtIDEKICAgIGxvY2FsIGNvbnRhaW5lciA9IGVudGl0aWVzLmNyZWF0ZV9vYmplY3QoY29udGFpbmVyX2hhc2gsIHBvcywgMCkKICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKGNvbnRhaW5lciwgdHJ1ZSkKZW5kCi0t6L295YW356y85a2QCmZ1bmN0aW9uIHZlaGNhZ2Vsb2wocGlkKQogICAgbG9jYWwgY29udGFpbmVyX2hhc2ggPSB1dGlsLmpvYWF0KCJib3h2aWxsZTMiKQogICAgbG9jYWwgcGVkID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhwZWQpCiAgICByZXF1ZXN0X21vZGVsKGNvbnRhaW5lcl9oYXNoKQogICAgbG9jYWwgY29udGFpbmVyID0gZW50aXRpZXMuY3JlYXRlX3ZlaGljbGUoY29udGFpbmVyX2hhc2gsIEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhwZWQsIDAuMCwgMi4wLCAwLjApLCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKHBlZCkpCiAgICBFTlRJVFkuU0VUX0VOVElUWV9WSVNJQkxFKGNvbnRhaW5lciwgZmFsc2UpCiAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihjb250YWluZXIsIHRydWUpCmVuZAotLeeHg+awlOesvApmdW5jdGlvbiBnYXNjYWdlKHBpZCkKICAgIGxvY2FsIGdhc19jYWdlX2hhc2ggPSB1dGlsLmpvYWF0KCJwcm9wX2dhc2NhZ2UwMSIpCiAgICBsb2NhbCBwZWQgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKQogICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHBlZCkKICAgIHJlcXVlc3RfbW9kZWwoZ2FzX2NhZ2VfaGFzaCkKICAgIHBvcy56ID0gcG9zLnogLSAxCiAgICBsb2NhbCBnYXNfY2FnZSA9IGVudGl0aWVzLmNyZWF0ZV9vYmplY3QoZ2FzX2NhZ2VfaGFzaCwgcG9zLCAwKQogICAgcG9zLnogPSBwb3MueiArIDEKICAgIGxvY2FsIGdhc19jYWdlMiA9IGVudGl0aWVzLmNyZWF0ZV9vYmplY3QoZ2FzX2NhZ2VfaGFzaCwgcG9zLCAwKQogICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04oZ2FzX2NhZ2UsIHRydWUpCiAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihnYXNfY2FnZTIsIHRydWUpCmVuZAoKLS0tLS0tLS0t5Y+R6YCB5Z6D5Zy+CmZ1bmN0aW9uIHRwVGFibGVUb1BsYXllcih0YmwsIHBpZCkKICAgIAogICAgaWYgTkVUV09SSy5ORVRXT1JLX0lTX1BMQVlFUl9DT05ORUNURUQocGlkKSB0aGVuCiAgICAgICAgbG9jYWwgYyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSkKICAgICAgICBmb3IgXywgdiBpbiBwYWlycyh0YmwpIGRvCiAgICAgICAgICAgIGlmIChub3QgUEVELklTX1BFRF9BX1BMQVlFUih2KSkgdGhlbgogICAgICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTX05PX09GRlNFVCh2LCBjLngsIGMueSwgYy56LCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQKZnVuY3Rpb24gVHBBbGxQZWRzKHBsYXllcikKICAgIGxvY2FsIHBlZEhhbmRsZXMgPSBlbnRpdGllcy5nZXRfYWxsX3BlZHNfYXNfaGFuZGxlcygpCiAgICB0cFRhYmxlVG9QbGF5ZXIocGVkSGFuZGxlcywgcGxheWVyKQplbmQKZnVuY3Rpb24gVHBBbGxWZWhzKHBsYXllcikKICAgIGxvY2FsIHZlaEhhbmRsZXMgPSBlbnRpdGllcy5nZXRfYWxsX3ZlaGljbGVzX2FzX2hhbmRsZXMoKQogICAgdHBUYWJsZVRvUGxheWVyKHZlaEhhbmRsZXMsIHBsYXllcikKZW5kCmZ1bmN0aW9uIFRwQWxsT2JqZWN0cyhwbGF5ZXIpCiAgICBsb2NhbCBvYmpIYW5kbGVzID0gZW50aXRpZXMuZ2V0X2FsbF9vYmplY3RzX2FzX2hhbmRsZXMoKQogICAgdHBUYWJsZVRvUGxheWVyKG9iakhhbmRsZXMsIHBsYXllcikKZW5kCmZ1bmN0aW9uIFRwQWxsUGlja3VwcyhwbGF5ZXIpCiAgICBsb2NhbCBwaWNrdXBIYW5kbGVzID0gZW50aXRpZXMuZ2V0X2FsbF9waWNrdXBzX2FzX2hhbmRsZXMoKQogICAgdHBUYWJsZVRvUGxheWVyKHBpY2t1cEhhbmRsZXMsIHBsYXllcikKZW5kCgotLS0tLS0tLS3nu5nkuojniIbngrjlrZDlvLkKZnVuY3Rpb24gR2V0VGFibGVGcm9tVjNJbnN0YW5jZSh2M2ludCkKICAgIGxvY2FsIHRibCA9IHt4ID0gdjMuZ2V0WCh2M2ludCksIHkgPSB2My5nZXRZKHYzaW50KSwgeiA9IHYzLmdldFoodjNpbnQpfQogICAgcmV0dXJuIHRibAplbmQKZnVuY3Rpb24gU0VfYWRkX293bmVkX2V4cGxvc2lvbihwZWQsIHgsIHksIHosIGV4cHR5cGUsIGRtZ3NjYWxlLCBpc2hlYXJkLCBpc2ludmlzLCBjYW1zaGFrZSkKICAgIEZJUkUuQUREX09XTkVEX0VYUExPU0lPTihwZWQsIHgsIHksIHosIGV4cHR5cGUsIGRtZ3NjYWxlLCBpc2hlYXJkLCBpc2ludmlzLCBjYW1zaGFrZSkKZW5kCgoKLS0tLemHjuWFveaooeW8jwpmdW5jdGlvbiBiZWFzdF9tb2RlKCkKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwLjA1LCAwLjUsIC0xLjExKQogICAgbG9jYWwgc2NlbmUgPSBORVRXT1JLLk5FVFdPUktfQ1JFQVRFX1NZTkNIUk9OSVNFRF9TQ0VORShwb3MueCwgcG9zLnksIHBvcy56LCAwLjAsIDAuMCwgRU5USVRZLkdFVF9FTlRJVFlfSEVBRElORyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSArIDkwLjAsIDIsIGZhbHNlLCBmYWxzZSwgMS4wLCAwLjAsIDEuMCkKICAgIHJlcXVlc3RfYW5pbV9kaWN0KCdBTklNQE1QX0ZNX0VWRU5UQElOVFJPJykKICAgIE5FVFdPUksuTkVUV09SS19BRERfU1lOQ0hST05JU0VEX1NDRU5FX0NBTUVSQShzY2VuZSwgJ0FOSU1ATVBfRk1fRVZFTlRASU5UUk8nLCAnQkVBU1RfVFJBTlNGT1JNX0NBTScpCgogICAgVEFTSy5UQVNLX1BMQVlfQU5JTShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAnQU5JTUBNUF9GTV9FVkVOVEBJTlRSTycsICdCRUFTVF9UUkFOU0ZPUk0nLCAxMDAwLjAsIC0yLjAsIC0xLCAwLCAwLjAsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCiAgICBQRUQuRk9SQ0VfUEVEX0FJX0FORF9BTklNQVRJT05fVVBEQVRFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlLCBmYWxzZSkKICAgIE5FVFdPUksuTkVUV09SS19GT1JDRV9MT0NBTF9VU0VfT0ZfU1lOQ0VEX1NDRU5FX0NBTUVSQShzY2VuZSkKICAgIE5FVFdPUksuTkVUV09SS19TVEFSVF9TWU5DSFJPTklTRURfU0NFTkUoc2NlbmUpCgogICAgaWYgbm90IEdSQVBISUNTLkFOSU1QT1NURlhfSVNfUlVOTklORygnQmVhc3RJbnRyb1NjZW5lJykgdGhlbgogICAgICAgIEdSQVBISUNTLkFOSU1QT1NURlhfUExBWSgnQmVhc3RJbnRyb1NjZW5lJywgMCwgZmFsc2UpCiAgICBlbmQKICAgIEFVRElPLlNUQVJUX0FVRElPX1NDRU5FKCdGTV9FdmVudF9CZWFzdF9UcmFuc2Zvcm1fU2VxdWVuY2VfU2NlbmUnKQogICAgQVVESU8uUExBWV9TT1VORF9GUk9OVEVORCgtMSwgJ0Zyb250ZW5kX0JlYXN0X1RyYW5zZm9ybV9CYWNrJywgJ0ZNX0V2ZW50c19TYXNxdWF0Y2hfU291bmRzJywgZmFsc2UpCmVuZAoKLS0tLeWOn+WtkOW8uei9sOeCuApmdW5jdGlvbiBvcmJpdGFsKHBpZCkgCiAgICAKICAgIGZvciBpID0gMCwgMzAgZG8gCiAgICAgICAgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpKQogICAgICAgIGZvciBqID0gLTIsIDIgZG8gCiAgICAgICAgICAgIGZvciBrID0gLTIsIDIgZG8gCiAgICAgICAgICAgICAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkpCiAgICAgICAgICAgICAgICBGSVJFLkFERF9PV05FRF9FWFBMT1NJT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgcG9zLnggKyBqLCBwb3MueSArIGosIHBvcy56ICsgKDMwIC0gaSksIDI5LCA5OTk5OTkuOTksIHRydWUsIGZhbHNlLCA4KQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICB1dGlsLnlpZWxkKDIwKQogICAgZW5kCmVuZAoKLS0tLeeBq+eurembqHYxCmZ1bmN0aW9uIHJhaW5fcm9ja2V0cyhwaWQpCiAgICAKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSkKICAgIGxvY2FsIGhhc2ggPSB1dGlsLmpvYWF0KCJ3ZWFwb25fYWlyc3RyaWtlX3JvY2tldCIpCiAgICByZXF1ZXN0X3dlYXBvbl9hc3NldChoYXNoKQogICAgcG9zLnggPSBwb3MueCArIG1hdGgucmFuZG9tKC0xMCwxMCkKICAgIHBvcy55ID0gcG9zLnkgKyBtYXRoLnJhbmRvbSgtMTAsMTApCiAgICBsb2NhbCBncm91bmRfcHRyID0gbWVtb3J5LmFsbG9jKDMyKQogICAgTUlTQy5HRVRfR1JPVU5EX1pfRk9SXzNEX0NPT1JEKHBvcy54LCBwb3MueSwgcG9zLnosIGdyb3VuZF9wdHIsIGZhbHNlLCBmYWxzZSkKICAgIHBvcy56ID0gbWVtb3J5LnJlYWRfZmxvYXQoZ3JvdW5kX3B0cikKICAgIE1JU0MuU0hPT1RfU0lOR0xFX0JVTExFVF9CRVRXRUVOX0NPT1JEUyhwb3MueCwgcG9zLnksIHBvcy56KzUwLCBwb3MueCwgcG9zLnksIHBvcy56LCAyMDAsIHRydWUsIGhhc2gsIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUsIGZhbHNlLCAyNTAwLjApCiAgICB1dGlsLnlpZWxkKDIwMCkKZW5kCi0tLS3lrZDlvLnpm6gKZnVuY3Rpb24gcmFpbl9idWxsZXQocGlkKQogICAgCiAgICBsb2NhbCBoYXNoID0gTUlTQy5HRVRfSEFTSF9LRVkoIndlYXBvbl9tYWNoaW5lcGlzdG9sIikKICAgIHJlcXVlc3Rfd2VhcG9uX2Fzc2V0KGhhc2gpCiAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkpCiAgICBwb3MueiA9IHBvcy56ICsgMTAuMAogICAgTUlTQy5TSE9PVF9TSU5HTEVfQlVMTEVUX0JFVFdFRU5fQ09PUkRTKHBvcy54LCBwb3MueSwgcG9zLnosIHBvcy54LCBwb3MueSwgcG9zLnotMTAsIDEwMDAwLjAwLCB0cnVlLCBoYXNoLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlLCBmYWxzZSwgMTAwMDAuMCkKICAgIHBvcy55ID0gcG9zLnkgKyAxMC4wCiAgICBNSVNDLlNIT09UX1NJTkdMRV9CVUxMRVRfQkVUV0VFTl9DT09SRFMocG9zLngsIHBvcy55LCBwb3MueiwgcG9zLngsIHBvcy55LTEwLCBwb3Muei0xMCwgMTAwMDAuMDAsIHRydWUsIGhhc2gsIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUsIGZhbHNlLCAxMDAwMC4wKQogICAgcG9zLnggPSBwb3MueCArIDEwLjAKICAgIE1JU0MuU0hPT1RfU0lOR0xFX0JVTExFVF9CRVRXRUVOX0NPT1JEUyhwb3MueCwgcG9zLnksIHBvcy56LCBwb3MueC0xMCwgcG9zLnktMTAsIHBvcy56LTEwLCAxMDAwMC4wMCwgdHJ1ZSwgaGFzaCwgUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSwgZmFsc2UsIDEwMDAwLjApCmVuZAoKCi0tLS0tLS0tLS0tLS0t6Ieq5a6a5LmJ5YGHUirorablkYoKZnVuY3Rpb24gY3VzdG9tX2FsZXJ0KHN0cmluZ3MpCiAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgSFVELlNFVF9XQVJOSU5HX01FU1NBR0VfV0lUSF9IRUFERVJfQU5EX1NVQlNUUklOR19GTEFHUygiQUxFUlQiLCAiSkxfSU5WSVRFX05EIiwgMiwgIiIsIHRydWUsIC0xLCAtMSwgc3RyaW5ncywgIiIsIHRydWUsIDApCiAgICAgICAgaWYgUEFELklTX0NPTlRST0xfSlVTVF9SRUxFQVNFRCgxOCwgMTgpIHRoZW4gLS1lbnRlciBvciBzcGFjZQogICAgICAgICAgICBicmVhawogICAgICAgIGVuZAogICAgICAgIHV0aWwueWllbGQoKQogICAgZW5kCmVuZAoKLS0tLeiHquWKqOWKoOWFpea4uOaIjwpmdW5jdGlvbiBhdXRvYWNjZXB0KCkKICAgIGxvY2FsIG1lc3NhZ2VfaGFzaCA9IEhVRC5HRVRfV0FSTklOR19TQ1JFRU5fTUVTU0FHRV9IQVNIKCkKICAgIGxvY2FsIHBhdXNlZCA9IEhVRC5JU19QQVVTRV9NRU5VX0FDVElWRSgpCiAgICBmb3IgXywgaGFzaCBpbiBpcGFpcnMoaW52aXRlX3N0cmluZykgZG8KICAgICAgICBpZiBtZXNzYWdlX2hhc2ggPT0gTUlTQy5HRVRfSEFTSF9LRVkoaGFzaCkgYW5kIG5vdCBwYXVzZWQgdGhlbgogICAgICAgICAgICBQQUQuU0VUX0NPTlRST0xfVkFMVUVfTkVYVF9GUkFNRSgyLCAyMDEsIDEuMCkKICAgICAgICAgICAgdXRpbC55aWVsZCgyNSkKICAgICAgICBlbmQKICAgIGVuZAplbmQKLS0tLeiHquWKqOiOt+WPluS4u+acugpmdW5jdGlvbiBhdXRvZ2V0aG9zdCgpCiAgICBpZiBub3QgKHBsYXllcnMuZ2V0X2hvc3QoKSA9PSBQTEFZRVIuUExBWUVSX0lEKCkpIGFuZCBub3QgdXRpbC5pc19zZXNzaW9uX3RyYW5zaXRpb25fYWN0aXZlKCkgdGhlbgogICAgICAgIGlmIG5vdCAoUExBWUVSLkdFVF9QTEFZRVJfTkFNRShwbGF5ZXJzLmdldF9ob3N0KCkpID09ICIqKkludmFsaWQqKiIpIHRoZW4KICAgICAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJraWNrICIuLlBMQVlFUi5HRVRfUExBWUVSX05BTUUocGxheWVycy5nZXRfaG9zdCgpKSkKICAgICAgICAgICAgdXRpbC55aWVsZCgyMDApCiAgICAgICAgZW5kCiAgICBlbmQKICAgIGlmIHBsYXllcnMuZ2V0X25hbWUoUExBWUVSLlBMQVlFUl9JRCgpKSA9PSBwbGF5ZXJzLmdldF9uYW1lKHBsYXllcnMuZ2V0X2hvc3QoKSkgdGhlbgogICAgICAgIHV0aWwudG9hc3QoIuiOt+W+l+S4u+acuizlt7LnpoHnlKjoh6rliqjojrflj5bkuLvmnLoiKQogICAgICAgIG1lbnUuc2V0X3ZhbHVlKGF1dG9faG9zdCwgZmFsc2UpCiAgICBlbmQKZW5kCgotLS0t5by65Yi25oiQ5Li66ISa5pys5Li75py6CmZ1bmN0aW9uIGZvcmNlX3NjcmlwdF9ob3N0KHNjcmlwdG5hbWUpCiAgICByZXF1ZXN0X3NjcmlwdChzY3JpcHRuYW1lKQogICAgdXRpbC5yZXF1ZXN0X3NjcmlwdF9ob3N0KHNjcmlwdG5hbWUpCglORVRXT1JLLk5FVFdPUktfUkVRVUVTVF9UT19CRV9IT1NUX09GX1RISVNfU0NSSVBUKCkKZW5kCgoKLS0tLeS9nOW8iuiAheajgOa1iwpsb2NhbCBtb2RkZXJfbGlzdCA9IHt9Ci0t546p5a626K+t6Z+z5qOA5rWLCmZ1bmN0aW9uIHRhbGtpbmdfZGV0ZWN0aW9uKCkKICAgIGlmIE5FVFdPUksuTkVUV09SS19JU19TRVNTSU9OX1NUQVJURUQoKSB0aGVuCiAgICAgICAgZm9yIF8sIHBpZCBpbiBwbGF5ZXJzLmxpc3QoZmFsc2UsIHRydWUsIHRydWUpIGRvCiAgICAgICAgICAgIGlmIE5FVFdPUksuTkVUV09SS19JU19QTEFZRVJfVEFMS0lORyhwaWQpIHRoZW4KICAgICAgICAgICAgICAgIHV0aWwudG9hc3QoUExBWUVSLkdFVF9QTEFZRVJfTkFNRShwaWQpLi4iIOWcqOivtOivnSIpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCAKICAgIGVuZAplbmQKLS3njqnlrrbml6DmlYzmo4DmtYsKZnVuY3Rpb24gZ29kX2RldGVjdGlvbigpCiAgICBpZiBORVRXT1JLLk5FVFdPUktfSVNfU0VTU0lPTl9TVEFSVEVEKCkgdGhlbgogICAgICAgIGZvciBfLCBwaWQgaW4gcGxheWVycy5saXN0KGZhbHNlLCB0cnVlLCB0cnVlKSBkbwogICAgICAgICAgICBpZiBub3QgdGFibGVfZmluZChtb2RkZXJfbGlzdCwgcGlkKSBhbmQgcGxheWVycy5pc19nb2Rtb2RlKHBpZCkgYW5kIG5vdCBwbGF5ZXJzLmlzX2luX2ludGVyaW9yKHBpZCkgYW5kIG5vdCBORVRXT1JLLk5FVFdPUktfSVNfUExBWUVSX0ZBRElORyhwaWQpIGFuZCBFTlRJVFkuSVNfRU5USVRZX1ZJU0lCTEUoUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkpIHRoZW4KICAgICAgICAgICAgICAgIG1vZGRlcl9saXN0WyNtb2RkZXJfbGlzdF0gPSBwaWQKICAgICAgICAgICAgICAgIHV0aWwudG9hc3QocGxheWVycy5nZXRfbmFtZShwaWQpIC4uICIg5piv5peg5pWM5qih5byPIikKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZAotLei9veWFt+aXoOaVjOajgOa1iwpmdW5jdGlvbiBjYXJfZ29kX2RldGVjdGlvbigpCiAgICBpZiBORVRXT1JLLk5FVFdPUktfSVNfU0VTU0lPTl9TVEFSVEVEKCkgdGhlbgogICAgICAgIGZvciBfLCBwaWQgaW4gaXBhaXJzKHBsYXllcnMubGlzdChmYWxzZSwgdHJ1ZSwgdHJ1ZSkpIGRvCiAgICAgICAgICAgIGxvY2FsIHBsYXllcl92ZWggPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX1VTSU5HKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpKQogICAgICAgICAgICBpZiBQRUQuSVNfUEVEX0lOX0FOWV9WRUhJQ0xFKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCBmYWxzZSkgdGhlbgogICAgICAgICAgICAgICAgaWYgbm90IHRhYmxlX2ZpbmQobW9kZGVyX2xpc3QsIHBpZCkgYW5kIG5vdCBFTlRJVFkuR0VUX0VOVElUWV9DQU5fQkVfREFNQUdFRChwbGF5ZXJfdmVoKSBhbmQgbm90IE5FVFdPUksuTkVUV09SS19JU19QTEFZRVJfRkFESU5HKHBpZCkgYW5kIEVOVElUWS5JU19FTlRJVFlfVklTSUJMRShwbGF5ZXJfdmVoKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbW9kZGVyX2xpc3RbI21vZGRlcl9saXN0XSA9IHBpZAogICAgICAgICAgICAgICAgICAgIHV0aWwudG9hc3QocGxheWVycy5nZXRfbmFtZShwaWQpIC4uICLovb3lhbflpITkuo7ml6DmlYzmqKHlvI8iKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kICAKICAgIGVuZAplbmQKLS3lrqTlhoXkvb/nlKjmrablmajmo4DmtYsKZnVuY3Rpb24gdXNpbmd3ZWFwb25fZGV0ZWN0aW9uKCkKICAgIGlmIE5FVFdPUksuTkVUV09SS19JU19TRVNTSU9OX1NUQVJURUQoKSB0aGVuCiAgICAgICAgZm9yIF8sIHBpZCBpbiBpcGFpcnMocGxheWVycy5saXN0KGZhbHNlLCB0cnVlLCB0cnVlKSkgZG8KICAgICAgICAgICAgaWYgbm90IHRhYmxlX2ZpbmQobW9kZGVyX2xpc3QsIHBpZCkgYW5kIHBsYXllcnMuaXNfaW5faW50ZXJpb3IocGlkKSBhbmQgV0VBUE9OLklTX1BFRF9BUk1FRChQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSwgNykgdGhlbgogICAgICAgICAgICAgICAgbW9kZGVyX2xpc3RbI21vZGRlcl9saXN0XSA9IHBpZAogICAgICAgICAgICAgICAgdXRpbC50b2FzdChwbGF5ZXJzLmdldF9uYW1lKHBpZCkgLi4gIiDmraPlnKjlrqTlhoXkvb/nlKjmrablmags5p6B5aSn5Y+v6IO95piv5L2c5byK6ICFIikKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZAotLeingueci+ajgOa1iwpmdW5jdGlvbiBsb29raW5neW91X2RldGVjdGlvbigpCiAgICBpZiBORVRXT1JLLk5FVFdPUktfSVNfU0VTU0lPTl9TVEFSVEVEKCkgdGhlbgogICAgICAgIGZvciBfLCBwaWQgaW4gaXBhaXJzKHBsYXllcnMubGlzdChmYWxzZSwgdHJ1ZSwgdHJ1ZSkpIGRvCiAgICAgICAgICAgIGxvY2FsIGNhbV9kaXN0ID0gdjMuZGlzdGFuY2UocGxheWVycy5nZXRfcG9zaXRpb24oUExBWUVSLlBMQVlFUl9JRCgpKSwgcGxheWVycy5nZXRfY2FtX3BvcyhwaWQpKQogICAgICAgICAgICBsb2NhbCBwZWRfZGlzdCA9IHYzLmRpc3RhbmNlKHBsYXllcnMuZ2V0X3Bvc2l0aW9uKFBMQVlFUi5QTEFZRVJfSUQoKSksIHBsYXllcnMuZ2V0X3Bvc2l0aW9uKHBpZCkpCiAgICAgICAgICAgIGlmIG5vdCB0YWJsZV9maW5kKG1vZGRlcl9saXN0LCBwaWQpIGFuZCBjYW1fZGlzdCA8IDIwLjAgYW5kIG5vdCBQRUQuSVNfUEVEX0RFQURfT1JfRFlJTkcoUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkpIGFuZCBub3QgTkVUV09SSy5ORVRXT1JLX0lTX1BMQVlFUl9GQURJTkcocGlkKSB0aGVuCiAgICAgICAgICAgICAgICBtb2RkZXJfbGlzdFsjbW9kZGVyX2xpc3RdID0gcGlkCiAgICAgICAgICAgICAgICB1dGlsLnlpZWxkKDUwMCkKICAgICAgICAgICAgICAgIGlmIHBlZF9kaXN0ID4gMzUuMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgdXRpbC50b2FzdChwbGF5ZXJzLmdldF9uYW1lKHBpZCkgLi4gIiDmraPlnKjop4LnnIvkvaAiKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZAotLeS8oOmAgeajgOa1iwpmdW5jdGlvbiB0cF9kZXRlY3Rpb24oKQogICAgaWYgTkVUV09SSy5ORVRXT1JLX0lTX1NFU1NJT05fU1RBUlRFRCgpIHRoZW4KICAgICAgICBmb3IgXywgcGlkIGluIGlwYWlycyhwbGF5ZXJzLmxpc3QoZmFsc2UsIHRydWUsIHRydWUpKSBkbwogICAgICAgICAgICBsb2NhbCBwZWQgPSAgUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgICAgICAgICAgaWYgbm90IE5FVFdPUksuTkVUV09SS19JU19QTEFZRVJfRkFESU5HKHBpZCkgYW5kIEVOVElUWS5JU19FTlRJVFlfVklTSUJMRShwZWQpIGFuZCBub3QgUEVELklTX1BFRF9ERUFEX09SX0RZSU5HKHBlZCkgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgb2xkcG9zID0gcGxheWVycy5nZXRfcG9zaXRpb24ocGlkKQogICAgICAgICAgICAgICAgdXRpbC55aWVsZCg1MDApCiAgICAgICAgICAgICAgICBsb2NhbCBjdXJyZW50cG9zID0gcGxheWVycy5nZXRfcG9zaXRpb24ocGlkKQogICAgICAgICAgICAgICAgaWYgdjMuZGlzdGFuY2Uob2xkcG9zLCBjdXJyZW50cG9zKSA+IDUwMCBhbmQgb2xkcG9zLnggfj0gY3VycmVudHBvcy54IGFuZCBvbGRwb3MueSB+PSBjdXJyZW50cG9zLnkgYW5kIG9sZHBvcy56IH49IGN1cnJlbnRwb3MueiB0aGVuCiAgICAgICAgICAgICAgICAgICAgdXRpbC50b2FzdChwbGF5ZXJzLmdldF9uYW1lKHBpZCkgLi4gIiDliJrliJrov5vooYzkuobkvKDpgIEiKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZAotLeWIh+aNouaooeWei+ajgOa1iwpmdW5jdGlvbiBjaGFuZ2VkTU9EX2RldGVjdGlvbigpCiAgICBpZiBORVRXT1JLLk5FVFdPUktfSVNfU0VTU0lPTl9TVEFSVEVEKCkgdGhlbgogICAgICAgIGZvciBfLCBwaWQgaW4gaXBhaXJzKHBsYXllcnMubGlzdCh0cnVlLCB0cnVlLCB0cnVlKSkgZG8KICAgICAgICAgICAgbG9jYWwgcGVkID0gIFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICAgICAgICAgIGxvY2FsIG5hbWUgPSBQTEFZRVIuR0VUX1BMQVlFUl9OQU1FKHBpZCkKICAgICAgICAgICAgbG9jYWwgbW9kdWxlID0gRU5USVRZLkdFVF9FTlRJVFlfTU9ERUwocGVkKQoKICAgICAgICAgICAgaWYgbm90IHRhYmxlX2ZpbmQobW9kZGVyX2xpc3QsIHBpZCkgYW5kIG1vZHVsZSB+PSAtMTY2NzMwMTQxNiBhbmQgbW9kdWxlIH49IDE4ODUyMzM2NTAgdGhlbgogICAgICAgICAgICAgICAgbW9kZGVyX2xpc3RbI21vZGRlcl9saXN0XSA9IHBpZAogICAgICAgICAgICAgICAgdXRpbC50b2FzdChuYW1lIC4uICIg5pS55Y+Y5LqG5Lq654mp5qih5Z6LIikKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgoKCgotLS0t6YOo5YiG6L295YW35Yqf6IO9Ci0t5byV5pOO5o6n5Yi2CmZ1bmN0aW9uIHRvZ2dsZV92ZWhpY2xlX2VuZ2luZShwaWQpCiAgICAKICAgIGxvY2FsIHBsYXllcl9wZWQgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKQogICAgbG9jYWwgcGxheWVyX3ZlaGljbGUgPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0lOKHBsYXllcl9wZWQsIGZhbHNlKQogICAgaWYgcGxheWVyX3ZlaGljbGUgfj0gMCB0aGVuCiAgICAgICAgbG9jYWwgaXNfcnVubmluZyA9IFZFSElDTEUuR0VUX0lTX1ZFSElDTEVfRU5HSU5FX1JVTk5JTkcocGxheWVyX3ZlaGljbGUpCiAgICAgICAgaWYgcmVxdWVzdF9jb250cm9sKHBsYXllcl92ZWhpY2xlLCAzKSB0aGVuCiAgICAgICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRU5HSU5FX09OKHBsYXllcl92ZWhpY2xlLCBub3QgaXNfcnVubmluZywgdHJ1ZSwgdHJ1ZSkKICAgICAgICBlbHNlCiAgICAgICAgICAgIHV0aWwudG9hc3QoIuaXoOazleaOp+WItui9pui+hi4iKQogICAgICAgIGVuZAogICAgZW5kCmVuZAotLeaRp+avgeW8leaTjgpmdW5jdGlvbiBicmVha19wbGF5ZXJfdmVoaWNsZV9lbmdpbmUocGlkKQogICAgCiAgICBsb2NhbCBwbGF5ZXJfcGVkID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgIGxvY2FsIHBsYXllcl92ZWhpY2xlID0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19JTihwbGF5ZXJfcGVkLCBmYWxzZSkKICAgIGlmIHBsYXllcl92ZWhpY2xlID09IDAgdGhlbgogICAgICAgIHV0aWwudG9hc3QocGxheWVycy5nZXRfbmFtZShwaWQpIC4uICLkuI3lnKjovabph4w6RCIpCiAgICBlbHNlCiAgICAgICAgaWYgcmVxdWVzdF9jb250cm9sKHBsYXllcl92ZWhpY2xlLCAzKSB0aGVuCiAgICAgICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRU5HSU5FX0hFQUxUSChwbGF5ZXJfdmVoaWNsZSwgLTEwLjApCiAgICAgICAgICAgIHV0aWwudG9hc3QocGxheWVycy5nZXRfbmFtZShwaWQpIC4uICLku5bnmoTlvJXmk47lnY/kuoYiKQogICAgICAgIGVsc2UKICAgICAgICAgICAgdXRpbC50b2FzdCgi5peg5rOV5o6n5Yi25LuW5Lus55qE6L2m6L6GIikKICAgICAgICBlbmQKICAgIGVuZAplbmQKLS3lkJHliY3mjqjov5sKZnVuY3Rpb24gYm9vc3RfcGxheWVyX3ZlaGljbGVfZm9yd2FyZChwaWQpCiAgICAKICAgIGxvY2FsIHBsYXllcl9wZWQgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKQogICAgbG9jYWwgcGxheWVyX3ZlaGljbGUgPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0lOKHBsYXllcl9wZWQsIGZhbHNlKQogICAgaWYgcGxheWVyX3ZlaGljbGUgPT0gMCB0aGVuCiAgICAgICAgdXRpbC50b2FzdChwbGF5ZXJzLmdldF9uYW1lKHBpZCkgLi4gIuS4jeWcqOi9pumHjDpEIikKICAgIGVsc2UKICAgICAgICByZXF1ZXN0X2NvbnRyb2wocGxheWVyX3ZlaGljbGUsIDMpCiAgICAgICAgRU5USVRZLkFQUExZX0ZPUkNFX1RPX0VOVElUWV9DRU5URVJfT0ZfTUFTUyhwbGF5ZXJfdmVoaWNsZSwgMSwgMC4wLCAxMDAwLjAsIDAuMCwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkKICAgICAgICB1dGlsLnRvYXN0KHBsYXllcnMuZ2V0X25hbWUocGlkKSAuLiAi6L2m6L6G54yb5YayIikKICAgIGVuZAplbmQKLS3lgZzmraLovabovoYKZnVuY3Rpb24gc3RvcF9wbGF5ZXJfdmVoaWNsZShwaWQpCiAgICAKICAgIGxvY2FsIHBsYXllcl9wZWQgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKQogICAgbG9jYWwgcGxheWVyX3ZlaGljbGUgPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0lOKHBsYXllcl9wZWQsIGZhbHNlKQogICAgaWYgcGxheWVyX3ZlaGljbGUgPT0gMCB0aGVuCiAgICAgICAgdXRpbC50b2FzdChwbGF5ZXJzLmdldF9uYW1lKHBpZCkgLi4gIuS4jeWcqOi9pumHjDpEIikKICAgIGVsc2UKICAgICAgICByZXF1ZXN0X2NvbnRyb2wocGxheWVyX3ZlaGljbGUsIDMpCiAgICAgICAgVkVISUNMRS5CUklOR19WRUhJQ0xFX1RPX0hBTFQocGxheWVyX3ZlaGljbGUsIDAuMCwgMSwgZmFsc2UpCiAgICAgICAgdXRpbC50b2FzdChwbGF5ZXJzLmdldF9uYW1lKHBpZCkgLi4gIui9pui+huWBnOatoiIpCiAgICBlbmQKZW5kCi0t5YCS572u6L2m6L6GCmZ1bmN0aW9uIGZsaXBfcGxheWVyX3ZlaGljbGUocGlkKQogICAgCiAgICBsb2NhbCBwbGF5ZXJfcGVkID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgIGxvY2FsIHBsYXllcl92ZWhpY2xlID0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19JTihwbGF5ZXJfcGVkLCBmYWxzZSkKICAgIGlmIHBsYXllcl92ZWhpY2xlID09IDAgdGhlbgogICAgICAgIHV0aWwudG9hc3QocGxheWVycy5nZXRfbmFtZShwaWQpIC4uICLkuI3lnKjovabph4w6RCIpCiAgICBlbHNlCiAgICAgICAgcmVxdWVzdF9jb250cm9sKHBsYXllcl92ZWhpY2xlLCAzKQogICAgICAgIGxvY2FsIGhlYWRpbmcgPSBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKHBsYXllcl92ZWhpY2xlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKHBsYXllcl92ZWhpY2xlLCAwLCAxODAsIC1oZWFkaW5nLCAxLCB0cnVlKQogICAgICAgIHV0aWwudG9hc3QocGxheWVycy5nZXRfbmFtZShwaWQpIC4uICLovabovobnv7vovawiKQogICAgZW5kCmVuZAotLei9pui+hue/u+i9rDE4MOW6pgpmdW5jdGlvbiB0dXJuX3BsYXllcl92ZWhpY2xlKHBpZCkKICAgIAogICAgbG9jYWwgcGxheWVyX3BlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICBsb2NhbCBwbGF5ZXJfdmVoaWNsZSA9IFBFRC5HRVRfVkVISUNMRV9QRURfSVNfSU4ocGxheWVyX3BlZCwgZmFsc2UpCiAgICBpZiBwbGF5ZXJfdmVoaWNsZSA9PSAwIHRoZW4KICAgICAgICB1dGlsLnRvYXN0KHBsYXllcnMuZ2V0X25hbWUocGlkKSAuLiAi5LiN5Zyo6L2m6YeMOkQiKQogICAgZWxzZQogICAgICAgIHJlcXVlc3RfY29udHJvbChwbGF5ZXJfdmVoaWNsZSwgMykKICAgICAgICBsb2NhbCBoZWFkaW5nID0gRU5USVRZLkdFVF9FTlRJVFlfSEVBRElORyhwbGF5ZXJfdmVoaWNsZSkKICAgICAgICBsb2NhbCBhbHRlcl9oZWFkaW5nID0gaGVhZGluZyA+PSAxODAgYW5kIGhlYWRpbmctMTgwIG9yIGhlYWRpbmcrMTgwCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04ocGxheWVyX3ZlaGljbGUsIDAsIDAsIGFsdGVyX2hlYWRpbmcsIDIsIHRydWUpCiAgICAgICAgdXRpbC50b2FzdChwbGF5ZXJzLmdldF9uYW1lKHBpZCkgLi4gIui9pui+hui9rOW8ryIpCiAgICBlbmQKZW5kCi0t5L+u5aSN6L295YW3CmZ1bmN0aW9uIHJlcGFpcl92ZWhpY2xlKHBpZCkKICAgIAogICAgbG9jYWwgdmVoaWNsZSA9IFBFRC5HRVRfVkVISUNMRV9QRURfSVNfSU4oUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCksIGZhbHNlKQogICAgcmVxdWVzdF9jb250cm9sKHZlaGljbGUsIDMpCiAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0ZJWEVEKHZlaGljbGUpCiAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0RFRk9STUFUSU9OX0ZJWEVEKHZlaGljbGUpCiAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0VOR0lORV9IRUFMVEgodmVoaWNsZSwgMTAwMC4wKQogICAgLS1HUkFQSElDUy5SRU1PVkVfUEFSVElDTEVfRlhfRlJPTV9FTlRJVFkodmVoaWNsZSkKZW5kCi0t6L295YW35peg5pWMCmZ1bmN0aW9uIHZlaF9nb2Rtb2RlKHRvZ2dsZWQpCiAgICB2ZWhfZ29kbW9kZV90b2dnbGVkID0gdG9nZ2xlZAogICAgd2hpbGUgdmVoX2dvZG1vZGVfdG9nZ2xlZCBkbwogICAgICAgIGxvY2FsIHZlaGljbGUgPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0lOKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0lOVklOQ0lCTEUodmVoaWNsZSwgdHJ1ZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9QUk9PRlModmVoaWNsZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAogICAgbG9jYWwgdmVoaWNsZSA9IFBFRC5HRVRfVkVISUNMRV9QRURfSVNfSU4oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpCiAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKHZlaGljbGUsIGZhbHNlKQogICAgRU5USVRZLlNFVF9FTlRJVFlfUFJPT0ZTKHZlaGljbGUsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKZW5kCi0tLS0t5by56aOe6L295YW3CmZ1bmN0aW9uIGxhdW5jaF91cF9wbGF5ZXJfdmVoaWNsZShwaWQpCiAgICBsb2NhbCBwbGF5ZXJfcGVkID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgIGxvY2FsIHBsYXllcl92ZWhpY2xlID0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19JTihwbGF5ZXJfcGVkLCBmYWxzZSkKICAgIGlmIHBsYXllcl92ZWhpY2xlID09IDAgdGhlbgogICAgICAgIHV0aWwudG9hc3QocGxheWVycy5nZXRfbmFtZShwaWQpIC4uICIg5LiN5Zyo6L2m5LitOkQiKQogICAgZWxzZQogICAgICAgIGlmIHJlcXVlc3RfY29udHJvbChwbGF5ZXJfdmVoaWNsZSwgMykgdGhlbgogICAgICAgICAgICBFTlRJVFkuQVBQTFlfRk9SQ0VfVE9fRU5USVRZX0NFTlRFUl9PRl9NQVNTKHBsYXllcl92ZWhpY2xlLCAxLCAwLjAsIDAuMCwgMTAwMC4wLCB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlKQogICAgICAgICAgICB1dGlsLnRvYXN0KHBsYXllcnMuZ2V0X25hbWUocGlkKSAuLiAiJ+W3suWPkeWwhC4iKQogICAgICAgIGVsc2UKICAgICAgICAgICAgdXRpbC50b2FzdCgi5peg5rOV5o6n5Yi26L2m6L6GIikKICAgICAgICBlbmQKICAgIGVuZAplbmQKCi0tLS3prLznlZzovb3lhbcKZnVuY3Rpb24gRGVtb25fdmVoKHBpZCwgdG9nZ2xlKQogICAgZ2xpdGNoVmVoID0gdG9nZ2xlCiAgICBsb2NhbCBwZWQgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKQogICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHBlZCwgZmFsc2UpCiAgICBsb2NhbCBwbGF5ZXJfdmVoID0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19VU0lORyhwZWQpCiAgICBsb2NhbCB2ZWhfbW9kZWwgPSBwbGF5ZXJzLmdldF92ZWhpY2xlX21vZGVsKHBpZCkKICAgIGxvY2FsIHBlZF9oYXNoID0gdXRpbC5qb2FhdCgiYV9tX21fYWN1bHRfMDEiKQogICAgbG9jYWwgb2JqZWN0X2hhc2ggPSB1dGlsLmpvYWF0KCJwcm9wX2xkX2ZlcnJpc193aGVlbCIpCiAgICByZXF1ZXN0X21vZGVsKHBlZF9oYXNoKQogICAgcmVxdWVzdF9tb2RlbChvYmplY3RfaGFzaCkKICAgIAogICAgd2hpbGUgZ2xpdGNoVmVoIGRvCiAgICAgICAgCiAgICAgICAgaWYgdjMuZGlzdGFuY2UoRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKSwgcGxheWVycy5nZXRfcG9zaXRpb24ocGlkKSkgPiAxMDAwLjAgYW5kIHYzLmRpc3RhbmNlKHBvcywgcGxheWVycy5nZXRfY2FtX3BvcyhQTEFZRVIuUExBWUVSX0lEKCkpKSA+IDEwMDAuMCB0aGVuCiAgICAgICAgICAgIHV0aWwudG9hc3QoIui3neemu+eOqeWutuWkqui/nOS6hjovIikKICAgICAgICAgICAgbWVudS5zZXRfdmFsdWUoZ2xpdGNoVmVoQ21kLCBmYWxzZSk7CiAgICAgICAgICAgIGJyZWFrIAogICAgICAgIGVuZAogICAgICAgIGlmIG5vdCBQRUQuSVNfUEVEX0lOX1ZFSElDTEUocGVkLCBwbGF5ZXJfdmVoLCBmYWxzZSkgdGhlbiAKICAgICAgICAgICAgdXRpbC50b2FzdCgi546p5a625LiN5Zyo6L2m6YeMIikKICAgICAgICAgICAgbWVudS5zZXRfdmFsdWUoZ2xpdGNoVmVoQ21kLCBmYWxzZSk7CiAgICAgICAgICAgIGJyZWFrIAogICAgICAgIGVuZAogICAgICAgIGlmIG5vdCBWRUhJQ0xFLkFSRV9BTllfVkVISUNMRV9TRUFUU19GUkVFKHBsYXllcl92ZWgpIHRoZW4KICAgICAgICAgICAgdXRpbC50b2FzdCgi6L2m5LiK5rKh56m65L2N5LqGIikKICAgICAgICAgICAgbWVudS5zZXRfdmFsdWUoZ2xpdGNoVmVoQ21kLCBmYWxzZSk7CiAgICAgICAgICAgIGJyZWFrIAogICAgICAgIGVuZAogICAgICAgIGxvY2FsIHNlYXRfY291bnQgPSBWRUhJQ0xFLkdFVF9WRUhJQ0xFX01PREVMX05VTUJFUl9PRl9TRUFUUyh2ZWhfbW9kZWwpCiAgICAgICAgbG9jYWwgZ2xpdGNoX29iaiA9IGVudGl0aWVzLmNyZWF0ZV9vYmplY3Qob2JqZWN0X2hhc2gsIHBvcykKICAgICAgICBsb2NhbCBnbGl0Y2hlZF9wZWQgPSBlbnRpdGllcy5jcmVhdGVfcGVkKDI2LCBwZWRfaGFzaCwgcG9zLCAwKQogICAgICAgIGxvY2FsIHRoaW5ncyA9IHtnbGl0Y2hlZF9wZWQsIGdsaXRjaF9vYmp9CiAgICAgICAgTkVUV09SSy5ORVRXT1JLX1JFUVVFU1RfQ09OVFJPTF9PRl9FTlRJVFkoZ2xpdGNoX29iaikKICAgICAgICBORVRXT1JLLk5FVFdPUktfUkVRVUVTVF9DT05UUk9MX09GX0VOVElUWShnbGl0Y2hlZF9wZWQpCiAgICAgICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKGdsaXRjaF9vYmosIGdsaXRjaGVkX3BlZCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgdHJ1ZSwgdHJ1ZSwgZmFsc2UsIDAsIHRydWUsIDApCiAgICAgICAgZm9yIGksIHNwYXduZWRfb2JqZWN0cyBpbiBpcGFpcnModGhpbmdzKSBkbwogICAgICAgICAgICBORVRXT1JLLk5FVFdPUktfUkVRVUVTVF9DT05UUk9MX09GX0VOVElUWShzcGF3bmVkX29iamVjdHMpCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1ZJU0lCTEUoc3Bhd25lZF9vYmplY3RzLCBmYWxzZSkKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRShzcGF3bmVkX29iamVjdHMsIHRydWUpCiAgICAgICAgZW5kCiAgICAgICAgZm9yIGkgPSAwLCBzZWF0X2NvdW50IC0xIGRvCiAgICAgICAgICAgIGlmIFZFSElDTEUuQVJFX0FOWV9WRUhJQ0xFX1NFQVRTX0ZSRUUocGxheWVyX3ZlaCkgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgZW1wdHlzZWF0ID0gaQogICAgICAgICAgICAgICAgZm9yIGwgPSAxLCAyNSBkbwogICAgICAgICAgICAgICAgICAgIFBFRC5TRVRfUEVEX0lOVE9fVkVISUNMRShnbGl0Y2hlZF9wZWQsIHBsYXllcl92ZWgsIGVtcHR5c2VhdCkKICAgICAgICAgICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT0xMSVNJT04oZ2xpdGNoX29iaiwgdHJ1ZSwgdHJ1ZSkKICAgICAgICAgICAgICAgICAgICB1dGlsLnlpZWxkKCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICBpZiBnbGl0Y2hlZF9wZWQgfj0gbmlsIHRoZW4KICAgICAgICAgICAgZGVsZXRlX2VudGl0eShnbGl0Y2hlZF9wZWQpIAogICAgICAgIGVuZAogICAgICAgIGlmIGdsaXRjaF9vYmogfj0gbmlsIHRoZW4gCiAgICAgICAgICAgIGRlbGV0ZV9lbnRpdHkoZ2xpdGNoX29iaikKICAgICAgICBlbmQKICAgIGVuZAplbmQKCgoKCi0t5ZaH5Y+t5Yqg6YCfCmZ1bmN0aW9uIGhvcm5fYm9vc3QocGlkKQogICAgbG9jYWwgcGVkID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgIGxvY2FsIHZlaCA9IFBFRC5HRVRfVkVISUNMRV9QRURfSVNfSU4ocGVkLCBmYWxzZSkKICAgIHJlcXVlc3RfY29udHJvbCh2ZWgsIDMpCiAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX01PRCh2ZWgsIDE0LCAtIDEsIGZhbHNlKQogICAgaWYgQVVESU8uSVNfSE9STl9BQ1RJVkUodmVoKSB0aGVuCiAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9BTEFSTSh2ZWgsIGZhbHNlKQogICAgICAgIEVOVElUWS5BUFBMWV9GT1JDRV9UT19FTlRJVFlfQ0VOVEVSX09GX01BU1ModmVoLCAxLCAwLjAsIDEuMCwgMC4wLCB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlKQogICAgZW5kCmVuZAotLS3lloflj63ot7Pot7PovaYKZnVuY3Rpb24gY2FyX2p1bXAocGlkKQogICAgbG9jYWwgcGVkID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgIGxvY2FsIHZlaCA9IFBFRC5HRVRfVkVISUNMRV9QRURfSVNfSU4ocGVkLCBmYWxzZSkKICAgIHJlcXVlc3RfY29udHJvbCh2ZWgsIDMpCiAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX01PRCh2ZWgsIDE0LCAtIDEsIGZhbHNlKQogICAgaWYgQVVESU8uSVNfSE9STl9BQ1RJVkUodmVoKSB0aGVuCiAgICAgICAgRU5USVRZLkFQUExZX0ZPUkNFX1RPX0VOVElUWV9DRU5URVJfT0ZfTUFTUyh2ZWgsIDEsIDAuMCwgMC4wLCAwLjcsIHRydWUsIHRydWUsIHRydWUsIHRydWUpIC0tIGFsdGVybmF0aXZlbHksIFZFSElDTEUuU0VUX1ZFSElDTEVfRk9SV0FSRF9TUEVFRCguLi4pIC0tIG5vdCB0ZXN0ZWQKICAgIGVuZAplbmQKCgoKCi0tLS3pqb7pqbbmnIDov5HnmoTovb3lhbcKZnVuY3Rpb24gZHJpdmVfY2xvc2VzdF92ZWhpY2xlKCkKICAgIGxvY2FsIGNsb3Nlc3R2ZWggPSBnZXRfY2xvc2VzdF92ZWhpY2xlKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDEwMDAwMDApCiAgICBsb2NhbCBkcml2ZXIgPSBWRUhJQ0xFLkdFVF9QRURfSU5fVkVISUNMRV9TRUFUKGNsb3Nlc3R2ZWgsIC0xKQogICAgaWYgVkVISUNMRS5JU19WRUhJQ0xFX1NFQVRfRlJFRShjbG9zZXN0dmVoLCAtMSkgdGhlbgogICAgICAgIFBFRC5TRVRfUEVEX0lOVE9fVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBjbG9zZXN0dmVoLCAtMSkKICAgIGVsc2UKICAgICAgICBpZiBub3QgUEVELklTX1BFRF9BX1BMQVlFUihkcml2ZXIpIHRoZW4KICAgICAgICAgICAgZGVsZXRlX2VudGl0eShkcml2ZXIpCiAgICAgICAgICAgIFBFRC5TRVRfUEVEX0lOVE9fVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBjbG9zZXN0dmVoLCAtMSkKICAgICAgICBlbHNlaWYgVkVISUNMRS5BUkVfQU5ZX1ZFSElDTEVfU0VBVFNfRlJFRShjbG9zZXN0dmVoKSB0aGVuCiAgICAgICAgICAgIGZvciBpID0gMCwgMTAgZG8KICAgICAgICAgICAgICAgIGlmIFZFSElDTEUuSVNfVkVISUNMRV9TRUFUX0ZSRUUoY2xvc2VzdHZlaCwgaSkgdGhlbgogICAgICAgICAgICAgICAgICAgIFBFRC5TRVRfUEVEX0lOVE9fVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBjbG9zZXN0dmVoLCBpKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZWxzZQogICAgICAgICAgICB1dGlsLnRvYXN0KCLkvKDpgIHliLDmnIDov5HovabovobplJnor68iKQogICAgICAgIGVuZAogICAgZW5kCmVuZAotLS3lloflj63kvKDpgIEKZnVuY3Rpb24gaG9ybl90cCh0b2dnbGVkKQogICAgaG9ybl9ib29zdF90cGQgPSB0b2dnbGVkCiAgICBpZiBob3JuX2Jvb3N0X3RwZCB0aGVuCiAgICAgICAgbG9jYWwgbXNnID0gIuaMiSB+JXN+IOS9v+eUqOS8oOmAgSIKICAgICAgICB1dGlsLnNob3dfY29ybmVyX2hlbHAobXNnOmZvcm1hdCgiSU5QVVRfVkVIX0hPUk4iKSkKICAgICAgICB3aGlsZSBob3JuX2Jvb3N0X3RwZCBkbwogICAgICAgICAgICAtLee7mOWItui/nue6vwogICAgICAgICAgICBsb2NhbCBjbG9zZXN0dmVoID0gZ2V0X2Nsb3Nlc3RfdmVoaWNsZShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAxMDAwMDAwKQogICAgICAgICAgICBkcmF3X2xpbmVfZW50aXR5X3RvX2VudGl0eShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBjbG9zZXN0dmVoLCB7ciA9IDAsIGcgPSAwICwgYiA9IDI1NSwgYSA9IDI1NX0pCgogICAgICAgICAgICBpZiBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsIDQ2KSB0aGVuCiAgICAgICAgICAgICAgICBkcml2ZV9jbG9zZXN0X3ZlaGljbGUoKQogICAgICAgICAgICAgICAgdXRpbC55aWVsZCgyMDApCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICB1dGlsLnlpZWxkKCkKICAgICAgICBlbmQKICAgIGVuZAplbmQKCi0tLS3lhpvmvJTpmIXlhbUKZnVuY3Rpb24gcGFyYWRlKCkKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgLS3po57mnLrliJvlu7rlnZDmoIcKICAgIGxvY2FsIHBsYW5lcCA9IHt9CiAgICBwbGFuZXBbMV0gPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMCwgLTUwMCwgMTAwKQogICAgcGxhbmVwWzJdID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIC0xMCwgLTUyMCwgMTAwKQogICAgcGxhbmVwWzNdID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDEwLCAtNTIwLCAxMDApCiAgICBwbGFuZXBbNF0gPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgLTIwLCAtNTQwLCAxMDApCiAgICBwbGFuZXBbNV0gPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMCwgLTU0MCwgMTAwKQogICAgcGxhbmVwWzZdID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDIwLCAtNTQwLCAxMDApCgogICAgLS3po57mnLrnm67moIfkvY3nva4KICAgIGxvY2FsIGVuZF9wb3MgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMCwgNTAwMCwgMTAwKQogICAgbG9jYWwgTWlsaXRhcnlfVGFyZ2V0ID0gY3JlYXRlX29iamVjdCgxMDgyNzk3ODg4LCBlbmRfcG9zLngsIGVuZF9wb3MueSwgZW5kX3Bvcy56KS0t55uu5qCH54mp5L2TCiAgICBFTlRJVFkuU0VUX0VOVElUWV9DT0xMSVNJT04oTWlsaXRhcnlfVGFyZ2V0LCBmYWxzZSwgZmFsc2UpCiAgICAtLeWIm+W7uumjnuacumFuZOmpvumptuWRmAogICAgbG9jYWwgcGxhbmV0ID0ge30KICAgIGxvY2FsIGRyaXZldCA9IHt9CiAgICBmb3IgaSA9IDEsIDYgZG8KICAgICAgICBwbGFuZXRbaV0gPSBjcmVhdGVfdmVoaWNsZSh1dGlsLmpvYWF0KCJMYXplciIpLCBwbGFuZXBbaV0ueCwgcGxhbmVwW2ldLnksIHBsYW5lcFtpXS56LCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0lOVklOQ0lCTEUocGxhbmV0W2ldLHRydWUpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09MTElTSU9OKHBsYW5ldFtpXSwgZmFsc2UsIHRydWUpCiAgICAgICAgZHJpdmV0W2ldID0gUEVELkNSRUFURV9SQU5ET01fUEVEX0FTX0RSSVZFUihwbGFuZXRbaV0sIDEpCiAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9FTkdJTkVfT04ocGxhbmV0W2ldLCB0cnVlLCB0cnVlLCAwKQogICAgZW5kCgogICAgLS3pooblpLTpo57mnLrlhYnmoIcKICAgIGxvY2FsIGJsaXAgPSBIVUQuQUREX0JMSVBfRk9SX0VOVElUWShwbGFuZXRbMV0pCiAgICBIVUQuU0VUX0JMSVBfQ09MT1VSKGJsaXAsIDUpCgogICAgLS3liJvlu7o256eN6aKc6ImyCiAgICBsb2NhbCBjb2xvcnMgPSB7fQogICAgZm9yIGkgPSAxLCA2IGRvCiAgICAgICAgY29sb3JzW2ldID0ge3I9bWF0aC5yYW5kb20oMCwgMjU1KSAvIDI1NSwgZz1tYXRoLnJhbmRvbSgwLCAyNTUpIC8gMjU1LCBiPW1hdGgucmFuZG9tKDAsIDI1NSkgLyAyNTV9CiAgICBlbmQKICAgIC0t5Yib5bu65a6a5pe25ZmoCiAgICBsb2NhbCBwYXJhZGVfdGltZXIgPSBuZXdUaW1lcigpCiAgICB3aGlsZSB0cnVlIGRvCgogICAgICAgIC0t5o6n5Yi26aOe5py66Lev5b6E5ZKM6YCf5bqmCiAgICAgICAgZm9yIGkgPSAxLCA2IGRvCiAgICAgICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRk9SV0FSRF9TUEVFRChwbGFuZXRbaV0sIDIwMCAvIDMuNikKICAgICAgICAgICAgc2V0X2VudGl0eV9mYWNlX2VudGl0eShwbGFuZXRbaV0sIE1pbGl0YXJ5X1RhcmdldCwgdHJ1ZSkKCiAgICAgICAgICAgIHJlcXVlc3RfcHRmeF9hc3NldCgic2NyX3JjcGFwYXJhenpvMSIpCiAgICAgICAgICAgIEdSQVBISUNTLlNUQVJUX05FVFdPUktFRF9QQVJUSUNMRV9GWF9OT05fTE9PUEVEX09OX0VOVElUWSgic2NyX21pY2g0X2ZpcmV3b3JrX3NwYXJrbGVfc3Bhd24iLCBwbGFuZXRbaV0sIDAuMCwgLTkuMCwgMC4wLCAwLjAsIDAuMCwgMC4wLCAyMC4wLCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICBHUkFQSElDUy5TRVRfUEFSVElDTEVfRlhfTk9OX0xPT1BFRF9DT0xPVVIoY29sb3JzW2ldLnIsIGNvbG9yc1tpXS5nLCBjb2xvcnNbaV0uYikKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgZGlzYSA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhwbGFuZXRbMV0pCiAgICAgICAgbG9jYWwgZGlzYiA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhNaWxpdGFyeV9UYXJnZXQpCiAgICAgICAgbG9jYWwgZGlzdGFuY2UgPSBHZXRfZGlzdGFuY2UoZGlzYSwgZGlzYiwgZmFsc2UpCiAgICAgICAgaWYgZGlzdGFuY2UgPCA0NTAwIHRoZW4KICAgICAgICAgICAgZm9yIGkgPSAxLCA2IGRvCiAgICAgICAgICAgICAgICBkZWxldGVfZW50aXR5KHBsYW5ldFtpXSkKICAgICAgICAgICAgICAgIGRlbGV0ZV9lbnRpdHkoZHJpdmV0W2ldKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgZGVsZXRlX2VudGl0eShNaWxpdGFyeV9UYXJnZXQpCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZW5kCiAgICAgICAgdXRpbC55aWVsZCgpCiAgICBlbmQKZW5kCgoKLS0tLeaXoOaVjApmdW5jdGlvbiBpbnZpbmNpYmxlX3NlbGYodG9nZ2xlZCkKICAgIGludmluX3RvZ2dsZSA9IHRvZ2dsZWQKICAgIHdoaWxlIGludmluX3RvZ2dsZSBkbwogICAgICAgIFBMQVlFUi5TRVRfUExBWUVSX0lOVklOQ0lCTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSkKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAogICAgUExBWUVSLlNFVF9QTEFZRVJfSU5WSU5DSUJMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKZW5kCi0tLS3npoHnlKjmkZTlgJIKZnVuY3Rpb24gZGlzYWJsZV9yYWdkb2xsKHRvZ2dsZWQpCiAgICByYWdkb2xsX3RvZ2dsZSA9IHRvZ2dsZWQKICAgIHdoaWxlIHJhZ2RvbGxfdG9nZ2xlIGRvCiAgICAgICAgUEVELlNFVF9QRURfQ0FOX1JBR0RPTEwoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpCiAgICAgICAgdXRpbC55aWVsZCgpCiAgICBlbmQKICAgIFBFRC5TRVRfUEVEX0NBTl9SQUdET0xMKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUpCmVuZAoKLS0tLeWuieWFqOW4pgpmdW5jdGlvbiBzZWF0X2JlbHQodG9nZ2xlZCkKICAgIHNlYXRiZWx0ID0gdG9nZ2xlZAogICAgd2hpbGUgc2VhdGJlbHQgZG8KICAgICAgICBQRUQuU0VUX1BFRF9DT05GSUdfRkxBRyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAzMiwgZmFsc2UpCiAgICAgICAgUEVELlNFVF9QRURfQ0FOX0JFX0tOT0NLRURfT0ZGX1ZFSElDTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMSkKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAogICAgUEVELlNFVF9QRURfQ09ORklHX0ZMQUcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMzIsIHRydWUpCiAgICBQRUQuU0VUX1BFRF9DQU5fQkVfS05PQ0tFRF9PRkZfVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwKQplbmQKCi0tLS3mjqjkvJ4KZnVuY3Rpb24gcHVzaF9wYXJhY2h1dGUodG9nZ2xlZCkKICAgIHB1c2hfcGFyYWNodXRlX3RvZ2dsZWQgPSB0b2dnbGVkCiAgICB3aGlsZSBwdXNoX3BhcmFjaHV0ZV90b2dnbGVkIGRvCiAgICAgICAgaWYgUEFELklTX0NPTlRST0xfUFJFU1NFRCgwLCAyMikgdGhlbgogICAgICAgICAgICBUQVNLLlNFVF9QQVJBQ0hVVEVfVEFTS19USFJVU1QoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMSkKICAgICAgICBlbHNlCiAgICAgICAgICAgIFRBU0suU0VUX1BBUkFDSFVURV9UQVNLX1RIUlVTVChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwKQogICAgICAgIGVuZAogICAgICAgIHV0aWwueWllbGQoKQogICAgZW5kCiAgICBUQVNLLlNFVF9QQVJBQ0hVVEVfVEFTS19USFJVU1QoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMCkKZW5kCgotLS0t546p5a626Ieq5qOACmZ1bmN0aW9uIGlzX3BsYXllcl9tb2RkZXIocGlkKQogICAgbG9jYWwgc3VmZml4ID0gcGxheWVycy5pc19tYXJrZWRfYXNfbW9kZGVyKHBpZCkgYW5kICLlt7Lop6blj5HkvZzlvIrogIXmo4DmtYsiIG9yICIg5bCa5pyq6Kem5Y+R5L2c5byK6ICF5qOA5rWLIgogICAgY2hhdC5zZW5kX21lc3NhZ2UocGxheWVycy5nZXRfbmFtZShwaWQpIC4uIHN1ZmZpeCwgdHJ1ZSwgdHJ1ZSwgZmFsc2UpCmVuZAoKCi0tLS3lkIzmraXml7bpl7QKZnVuY3Rpb24gUmVhbF93b3JsZF90aW1lKCkKICAgIGxvY2FsIHNldENsb2NrQ29tbWFuZCA9IG1lbnUucmVmX2J5X3BhdGgoJ1dvcmxkPkF0bW9zcGhlcmU+Q2xvY2s+VGltZScsIDM3KQogICAgbWVudS50cmlnZ2VyX2NvbW1hbmQoc2V0Q2xvY2tDb21tYW5kLCBvcy5kYXRlKCclSDolTTolUycpKQogICAgbG9jYWwgc21vb3RoVHJhbnNpdGlvbkNvbW1hbmQgPSBtZW51LnJlZl9ieV9wYXRoKCdXb3JsZD5BdG1vc3BoZXJlPkNsb2NrPlNtb290aCBUcmFuc2l0aW9uJywgMzcpCiAgICBpZiBtZW51LmdldF92YWx1ZShzbW9vdGhUcmFuc2l0aW9uQ29tbWFuZCkgdGhlbiAKCQltZW51LnRyaWdnZXJfY29tbWFuZChzbW9vdGhUcmFuc2l0aW9uQ29tbWFuZCkgCiAgICBlbmQKZW5kCgoKLS0tLeWFqOWxgOeUteejgeiEieWGsgpmdW5jdGlvbiB2ZWhfRU1QKCkKICAgIGZvciBrLCBwaWQgaW4gcGFpcnMocGxheWVycy5saXN0KHRydWUsIHRydWUsIHRydWUpKSBkbwogICAgICAgIGxvY2FsIHBlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICAgICAgbG9jYWwgY29vcmRzID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHBlZCwgdHJ1ZSkKICAgICAgICBGSVJFLkFERF9FWFBMT1NJT04oY29vcmRzWyd4J10sIGNvb3Jkc1sneSddLCBjb29yZHNbJ3onXSwgNjUsIDk5OSwgZmFsc2UsIHRydWUsIDApCiAgICBlbmQKZW5kIAoKCi0tLS3liqDpgJ/lnqsKZnVuY3Rpb24gamlhc3VkaWFuKHBpZCkKICAgIAogICAgbG9jYWwgY29vcmRzID0gcGxheWVycy5nZXRfcG9zaXRpb24ocGlkKQogICAgY29vcmRzLnogPSBjb29yZHMueiAtIDAuMwogICAgbG9jYWwgcGxheWVyID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgIGxvY2FsIGhlYWRpbmcgPSBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKHBsYXllcikKICAgIGhlYWRpbmcgPSBoZWFkaW5nICsgODAKICAgIGxvY2FsIGJvb3N0cGFkID0gZW50aXRpZXMuY3JlYXRlX29iamVjdCgzMjg3OTg4OTc0LCBjb29yZHMpCiAgICBFTlRJVFkuU0VUX0VOVElUWV9IRUFESU5HKGJvb3N0cGFkLCBoZWFkaW5nKQplbmQKZnVuY3Rpb24gc2lnZWppYXN1ZGlhbihwaWQpCiAgICAKICAgIGxvY2FsIGNvb3JkcyA9IHBsYXllcnMuZ2V0X3Bvc2l0aW9uKHBpZCkKICAgIGNvb3Jkcy56ID0gY29vcmRzLnogLSAwLjMKICAgIGxvY2FsIHBsYXllciA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICBsb2NhbCBoZWFkaW5nID0gRU5USVRZLkdFVF9FTlRJVFlfSEVBRElORyhwbGF5ZXIpCiAgICBsb2NhbCBib29zdHBhZCA9IGVudGl0aWVzLmNyZWF0ZV9vYmplY3QoLTM4ODU5MzQ5NiwgY29vcmRzKQogICAgRU5USVRZLlNFVF9FTlRJVFlfSEVBRElORyhib29zdHBhZCwgaGVhZGluZykKZW5kCmZ1bmN0aW9uIGppYW5zdWRhaShwaWQpCiAgICAKICAgIGxvY2FsIGNvb3JkcyA9IHBsYXllcnMuZ2V0X3Bvc2l0aW9uKHBpZCkKICAgIGNvb3Jkcy56ID0gY29vcmRzLnogLSAwLjYKICAgIGxvY2FsIHBsYXllciA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICBsb2NhbCBoZWFkaW5nID0gRU5USVRZLkdFVF9FTlRJVFlfSEVBRElORyhwbGF5ZXIpCiAgICBoZWFkaW5nID0gaGVhZGluZyArIDgwCiAgICBsb2NhbCBib29zdHBhZCA9IGVudGl0aWVzLmNyZWF0ZV9vYmplY3QoLTIyNzI3NTUwOCwgY29vcmRzKQogICAgRU5USVRZLlNFVF9FTlRJVFlfSEVBRElORyhib29zdHBhZCwgaGVhZGluZykKZW5kCgoKLS0tLei9veWFt+S8nuW0qeWFqOWxgApmdW5jdGlvbiB2ZWhfdWJsX2NhcnNoKCkKICAgIGxvY2FsIFBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlKQogICAgZm9yIHBpZCA9IDAsIDMxIGRvCiAgICAgICAgbG9jYWwgbXlwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSkKICAgICAgICBsb2NhbCBUYXJnZXRQbGF5ZXJQZWQgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKQogICAgICAgIGxvY2FsIFJ1aW5lcjIgPSBjcmVhdGVfdmVoaWNsZSh1dGlsLmpvYWF0KCJSdWluZXIyIiksIG15cG9zLngsIG15cG9zLnksIG15cG9zLnosIEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcoVGFyZ2V0UGxheWVyUGVkKSkKICAgICAgICBQRUQuU0VUX1BFRF9JTlRPX1ZFSElDTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgUnVpbmVyMiwgLTEpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTX05PX09GRlNFVChSdWluZXIyLCBteXBvcy54LCBteXBvcy55LCAxMDAwLCBmYWxzZSwgdHJ1ZSwgdHJ1ZSkKICAgICAgICB1dGlsLnlpZWxkKDIwMCkKICAgICAgICBWRUhJQ0xFMS5fU0VUX1ZFSElDTEVfUEFSQUNIVVRFX01PREVMKFJ1aW5lcjIsIHV0aWwuam9hYXQoInByb3BfYmVhY2hfcGFyYXNvbF8wNSIpKQogICAgICAgIFZFSElDTEUxLl9TRVRfVkVISUNMRV9QQVJBQ0hVVEVfQUNUSVZFKFJ1aW5lcjIsIHRydWUpCiAgICAgICAgdXRpbC55aWVsZCgyMDApCiAgICAgICAgZGVsZXRlX2VudGl0eShSdWluZXIyKQogICAgZW5kCiAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFNfTk9fT0ZGU0VUKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIFBvcy54LCBQb3MueSwgUG9zLnosIGZhbHNlLCB0cnVlLCB0cnVlKQplbmQKCi0tLeS4u+acuuW0qQpmdW5jdGlvbiBob3N0Y3Jhc2gocGlkKQogICAgbG9jYWwgc2VsZl9wZWQgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRURfU0NSSVBUX0lOREVYKFBMQVlFUi5QTEFZRVJfSUQoKSkKICAgIG1lbnUudHJpZ2dlcl9jb21tYW5kcygidHBtYXplaGVsaXBhZCIpCiAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFMoc2VsZl9wZWQsIC02MTcwLCAxMDgzNywgNDAsIHRydWUsIGZhbHNlLCBmYWxzZSkKICAgIHV0aWwueWllbGQoMTAwMCkKICAgIG1lbnUudHJpZ2dlcl9jb21tYW5kcygidHBtYXplaGVsaXBhZCIpCmVuZAotLS0t5Lq654mp5Lye5bSpVjEKZnVuY3Rpb24gcGVkX3VibF9jcmFzaHYxKCkKICAgIGxvY2FsIFNlbGZQbGF5ZXJQZWQgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRURfU0NSSVBUX0lOREVYKFBMQVlFUi5QTEFZRVJfSUQoKSkKICAgIGxvY2FsIFByZXZpb3VzUGxheWVyUG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFNlbGZQbGF5ZXJQZWQsIHRydWUpCiAgICBmb3IgbiA9IDAgLCAzIGRvCiAgICAgICAgbG9jYWwgb2JqZWN0X2hhc2ggPSB1dGlsLmpvYWF0KCJwcm9wX2xvZ3BpbGVfMDZiIikKICAgICAgICByZXF1ZXN0X21vZGVsKG9iamVjdF9oYXNoKQogICAgICAgIFBMQVlFUi5TRVRfUExBWUVSX1BBUkFDSFVURV9NT0RFTF9PVkVSUklERShQTEFZRVIuUExBWUVSX0lEKCksb2JqZWN0X2hhc2gpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTX05PX09GRlNFVChTZWxmUGxheWVyUGVkLCAwLDAsNTAwLCBmYWxzZSwgdHJ1ZSwgdHJ1ZSkKICAgICAgICBXRUFQT04uR0lWRV9ERUxBWUVEX1dFQVBPTl9UT19QRUQoU2VsZlBsYXllclBlZCwgMHhGQkFCNTc3NiwgMTAwMCwgZmFsc2UpCiAgICAgICAgdXRpbC55aWVsZCgxMDAwKQogICAgICAgIGZvciBpID0gMCAsIDIwIGRvCiAgICAgICAgICAgIFBFRC5GT1JDRV9QRURfVE9fT1BFTl9QQVJBQ0hVVEUoU2VsZlBsYXllclBlZCkKICAgICAgICBlbmQKICAgICAgICB1dGlsLnlpZWxkKDEwMDApCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTX05PX09GRlNFVChTZWxmUGxheWVyUGVkLCBQcmV2aW91c1BsYXllclBvcy54LCBQcmV2aW91c1BsYXllclBvcy55LCBQcmV2aW91c1BsYXllclBvcy56LCBmYWxzZSwgdHJ1ZSwgdHJ1ZSkKCiAgICAgICAgbG9jYWwgb2JqZWN0X2hhc2gyID0gdXRpbC5qb2FhdCgicHJvcF9iZWFjaF9wYXJhc29sXzAzIikKICAgICAgICByZXF1ZXN0X21vZGVsKG9iamVjdF9oYXNoMikKICAgICAgICBQTEFZRVIuU0VUX1BMQVlFUl9QQVJBQ0hVVEVfTU9ERUxfT1ZFUlJJREUoUExBWUVSLlBMQVlFUl9JRCgpLG9iamVjdF9oYXNoMikKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFNfTk9fT0ZGU0VUKFNlbGZQbGF5ZXJQZWQsIDAsMCw1MDAsIDAsIDAsIDEpCiAgICAgICAgV0VBUE9OLkdJVkVfREVMQVlFRF9XRUFQT05fVE9fUEVEKFNlbGZQbGF5ZXJQZWQsIDB4RkJBQjU3NzYsIDEwMDAsIGZhbHNlKQogICAgICAgIHV0aWwueWllbGQoMTAwMCkKICAgICAgICBmb3IgaSA9IDAgLCAyMCBkbwogICAgICAgICAgICBQRUQuRk9SQ0VfUEVEX1RPX09QRU5fUEFSQUNIVVRFKFNlbGZQbGF5ZXJQZWQpCiAgICAgICAgZW5kCiAgICAgICAgdXRpbC55aWVsZCgxMDAwKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQoU2VsZlBsYXllclBlZCwgUHJldmlvdXNQbGF5ZXJQb3MueCwgUHJldmlvdXNQbGF5ZXJQb3MueSwgUHJldmlvdXNQbGF5ZXJQb3MueiwgZmFsc2UsIHRydWUsIHRydWUpCiAgICBlbmQKICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQoU2VsZlBsYXllclBlZCwgUHJldmlvdXNQbGF5ZXJQb3MueCwgUHJldmlvdXNQbGF5ZXJQb3MueSwgUHJldmlvdXNQbGF5ZXJQb3MueiwgZmFsc2UsIHRydWUsIHRydWUpCmVuZAotLS0t5Lq654mp5Lye5bSpVjIKZnVuY3Rpb24gcGVkX3VibF9jcmFzaHYyKCkKICAgIGZvciBuID0gMCAsIDUgZG8KICAgICAgICBQRURQID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEX1NDUklQVF9JTkRFWChQTEFZRVIuUExBWUVSX0lEKCkpCiAgICAgICAgbG9jYWwgb2JqZWN0X2hhc2ggPSAxMzgxMTA1ODg5CiAgICAgICAgcmVxdWVzdF9tb2RlbChvYmplY3RfaGFzaCkKICAgICAgICBQTEFZRVIuU0VUX1BMQVlFUl9QQVJBQ0hVVEVfTU9ERUxfT1ZFUlJJREUoUExBWUVSLlBMQVlFUl9JRCgpLG9iamVjdF9oYXNoKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQoUEVEUCwgMCwwLDUwMCwgMCwgMCwgMSkKICAgICAgICBXRUFQT04uR0lWRV9ERUxBWUVEX1dFQVBPTl9UT19QRUQoUEVEUCwgMHhGQkFCNTc3NiwgMTAwMCwgZmFsc2UpCiAgICAgICAgdXRpbC55aWVsZCgxMDAwKQogICAgICAgIGZvciBpID0gMCAsIDIwIGRvCiAgICAgICAgICAgIFBFRC5GT1JDRV9QRURfVE9fT1BFTl9QQVJBQ0hVVEUoUEVEUCkKICAgICAgICBlbmQKICAgICAgICB1dGlsLnlpZWxkKDEwMDApCiAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJ0cGxzaWEiKQogICAgICAgIGxvY2FsIGJ1c2hfaGFzaCA9IDcyMDU4MTY5MwogICAgICAgIHJlcXVlc3RfbW9kZWwoYnVzaF9oYXNoKQogICAgICAgIFBMQVlFUi5TRVRfUExBWUVSX1BBUkFDSFVURV9NT0RFTF9PVkVSUklERShQTEFZRVIuUExBWUVSX0lEKCksYnVzaF9oYXNoKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQoUEVEUCwgMCwwLDUwMCwgMCwgMCwgMSkKICAgICAgICBXRUFQT04uR0lWRV9ERUxBWUVEX1dFQVBPTl9UT19QRUQoUEVEUCwgMHhGQkFCNTc3NiwgMTAwMCwgZmFsc2UpCiAgICAgICAgICAgdXRpbC55aWVsZCgxMDAwKQogICAgICAgIGZvciBpID0gMCAsIDIwIGRvCiAgICAgICAgICAgIFBFRC5GT1JDRV9QRURfVE9fT1BFTl9QQVJBQ0hVVEUoUEVEUCkKICAgICAgICBlbmQKICAgICAgICB1dGlsLnlpZWxkKDEwMDApCiAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJ0cGxzaWEiKQogICAgZW5kCmVuZAotLS0t5Lq654mp5Lye5bSpVjMKZnVuY3Rpb24gcGVkX3VibF9jcmFzaHYzKCkKICAgIGZvciBuID0gMCAsIDUgZG8KICAgICAgICBQRURQID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEX1NDUklQVF9JTkRFWChQTEFZRVIuUExBWUVSX0lEKCkpCiAgICAgICAgbG9jYWwgb2JqZWN0X2hhc2ggPSAxOTI4Mjk1MzgKICAgICAgICByZXF1ZXN0X21vZGVsKG9iamVjdF9oYXNoKQogICAgICAgIFBMQVlFUi5TRVRfUExBWUVSX1BBUkFDSFVURV9NT0RFTF9PVkVSUklERShQTEFZRVIuUExBWUVSX0lEKCksb2JqZWN0X2hhc2gpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTX05PX09GRlNFVChQRURQLCAwLDAsNTAwLCAwLCAwLCAxKQogICAgICAgIFdFQVBPTi5HSVZFX0RFTEFZRURfV0VBUE9OX1RPX1BFRChQRURQLCAweEZCQUI1Nzc2LCAxMDAwLCBmYWxzZSkKICAgICAgICB1dGlsLnlpZWxkKDEwMDApCiAgICAgICAgZm9yIGkgPSAwICwgMjAgZG8KICAgICAgICAgICAgUEVELkZPUkNFX1BFRF9UT19PUEVOX1BBUkFDSFVURShQRURQKQogICAgICAgIGVuZAogICAgICAgIHV0aWwueWllbGQoMTAwMCkKICAgICAgICBtZW51LnRyaWdnZXJfY29tbWFuZHMoInRwbHNpYSIpCiAgICAgICAgbG9jYWwgYnVzaF9oYXNoID0gMTkyODI5NTM4CiAgICAgICAgcmVxdWVzdF9tb2RlbChidXNoX2hhc2gpCiAgICAgICAgUExBWUVSLlNFVF9QTEFZRVJfUEFSQUNIVVRFX01PREVMX09WRVJSSURFKFBMQVlFUi5QTEFZRVJfSUQoKSxidXNoX2hhc2gpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTX05PX09GRlNFVChQRURQLCAwLDAsNTAwLCAwLCAwLCAxKQogICAgICAgIFdFQVBPTi5HSVZFX0RFTEFZRURfV0VBUE9OX1RPX1BFRChQRURQLCAweEZCQUI1Nzc2LCAxMDAwLCBmYWxzZSkKICAgICAgICAgICB1dGlsLnlpZWxkKDEwMDApCiAgICAgICAgZm9yIGkgPSAwICwgMjAgZG8KICAgICAgICAgICAgUEVELkZPUkNFX1BFRF9UT19PUEVOX1BBUkFDSFVURShQRURQKQogICAgICAgIGVuZAogICAgICAgIHV0aWwueWllbGQoMTAwMCkKICAgICAgICBtZW51LnRyaWdnZXJfY29tbWFuZHMoInRwbHNpYSIpCiAgICBlbmQKZW5kCi0tLS3kurrniankvJ7ltKlWNApmdW5jdGlvbiBwZWRfdWJsX2NyYXNodjQoKQogICAgZm9yIG4gPSAwICwgNSBkbwogICAgICAgIFBFRFAgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRURfU0NSSVBUX0lOREVYKFBMQVlFUi5QTEFZRVJfSUQoKSkKICAgICAgICBsb2NhbCBvYmplY3RfaGFzaCA9IDExMTc5MTcwNTkKICAgICAgICByZXF1ZXN0X21vZGVsKG9iamVjdF9oYXNoKQogICAgICAgIFBMQVlFUi5TRVRfUExBWUVSX1BBUkFDSFVURV9NT0RFTF9PVkVSUklERShQTEFZRVIuUExBWUVSX0lEKCksb2JqZWN0X2hhc2gpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTX05PX09GRlNFVChQRURQLCAwLDAsNTAwLCAwLCAwLCAxKQogICAgICAgIFdFQVBPTi5HSVZFX0RFTEFZRURfV0VBUE9OX1RPX1BFRChQRURQLCAweEZCQUI1Nzc2LCAxMDAwLCBmYWxzZSkKICAgICAgICB1dGlsLnlpZWxkKDEwMDApCiAgICAgICAgZm9yIGkgPSAwICwgMjAgZG8KICAgICAgICAgICAgUEVELkZPUkNFX1BFRF9UT19PUEVOX1BBUkFDSFVURShQRURQKQogICAgICAgIGVuZAogICAgICAgIHV0aWwueWllbGQoMTAwMCkKICAgICAgICBtZW51LnRyaWdnZXJfY29tbWFuZHMoInRwbHNpYSIpCiAgICAgICAgbG9jYWwgYnVzaF9oYXNoID0gMTExNzkxNzA1OQogICAgICAgIHJlcXVlc3RfbW9kZWwoYnVzaF9oYXNoKQogICAgICAgIFBMQVlFUi5TRVRfUExBWUVSX1BBUkFDSFVURV9NT0RFTF9PVkVSUklERShQTEFZRVIuUExBWUVSX0lEKCksYnVzaF9oYXNoKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQoUEVEUCwgMCwwLDUwMCwgMCwgMCwgMSkKICAgICAgICBXRUFQT04uR0lWRV9ERUxBWUVEX1dFQVBPTl9UT19QRUQoUEVEUCwgMHhGQkFCNTc3NiwgMTAwMCwgZmFsc2UpCiAgICAgICAgICAgdXRpbC55aWVsZCgxMDAwKQogICAgICAgIGZvciBpID0gMCAsIDIwIGRvCiAgICAgICAgICAgIFBFRC5GT1JDRV9QRURfVE9fT1BFTl9QQVJBQ0hVVEUoUEVEUCkKICAgICAgICBlbmQKICAgICAgICB1dGlsLnlpZWxkKDEwMDApCiAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJ0cGxzaWEiKQogICAgZW5kCmVuZAotLS0t5oeC5ZOl5bSp5rqDCmZ1bmN0aW9uIGRvbmdnZV9jcmFzaCgpCiAgICBmb3IgcGlkID0gMCwgMzEgZG8KICAgICAgICBQTEFZRVIuU0VUX1BMQVlFUl9QQVJBQ0hVVEVfUEFDS19NT0RFTF9PVkVSUklERShQTEFZRVIuUExBWUVSX0lEKCksMHhFNTAyMkQwMykKICAgICAgICBUQVNLLkNMRUFSX1BFRF9UQVNLU19JTU1FRElBVEVMWShQTEFZRVIuR0VUX1BMQVlFUl9QRURfU0NSSVBUX0lOREVYKFBMQVlFUi5QTEFZRVJfSUQoKSkpCiAgICAgICAgdXRpbC55aWVsZCgyMCkKICAgICAgICBsb2NhbCBwX3BvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFNfTk9fT0ZGU0VUKFBMQVlFUi5HRVRfUExBWUVSX1BFRF9TQ1JJUFRfSU5ERVgoUExBWUVSLlBMQVlFUl9JRCgpKSxwX3Bvcy54LHBfcG9zLnkscF9wb3MueixmYWxzZSx0cnVlLHRydWUpCiAgICAgICAgV0VBUE9OLkdJVkVfREVMQVlFRF9XRUFQT05fVE9fUEVEKFBMQVlFUi5HRVRfUExBWUVSX1BFRF9TQ1JJUFRfSU5ERVgoUExBWUVSLlBMQVlFUl9JRCgpKSwgMHhGQkFCNTc3NiwgMTAwMCwgZmFsc2UpCiAgICAgICAgVEFTSy5UQVNLX1BBUkFDSFVURV9UT19UQVJHRVQoUExBWUVSLkdFVF9QTEFZRVJfUEVEX1NDUklQVF9JTkRFWChQTEFZRVIuUExBWUVSX0lEKCkpLC0xMDg3LC0zMDEyLDEzLjk0KQogICAgICAgIHV0aWwueWllbGQoNTAwKQogICAgICAgIFRBU0suQ0xFQVJfUEVEX1RBU0tTX0lNTUVESUFURUxZKFBMQVlFUi5HRVRfUExBWUVSX1BFRF9TQ1JJUFRfSU5ERVgoUExBWUVSLlBMQVlFUl9JRCgpKSkKICAgICAgICB1dGlsLnlpZWxkKDEwMDApCiAgICAgICAgUExBWUVSLkNMRUFSX1BMQVlFUl9QQVJBQ0hVVEVfUEFDS19NT0RFTF9PVkVSUklERShQTEFZRVIuUExBWUVSX0lEKCkpCiAgICAgICAgVEFTSy5DTEVBUl9QRURfVEFTS1NfSU1NRURJQVRFTFkoUExBWUVSLkdFVF9QTEFZRVJfUEVEX1NDUklQVF9JTkRFWChQTEFZRVIuUExBWUVSX0lEKCkpKQogICAgZW5kCmVuZAotLS0tLeWFqOWxgOmhtuW0qQpmdW5jdGlvbiB1bmtub3duKCkKICAgIGZvciBwaWQgPSAwLCAzMiBkbwogICAgICAgIGxvY2FsIHNwcGVkID0gUExBWUVSLlBMQVlFUl9QRURfSUQoKQogICAgICAgIGxvY2FsIFNlbGZQbGF5ZXJQb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoc3BwZWQsIHRydWUpCiAgICAgICAgbG9jYWwgVFRQZWQgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKQogICAgICAgIGxvY2FsIFRUUG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFRUUGVkLCB0cnVlKQogICAgICAgIFNlbGZQbGF5ZXJQb3MueCA9IFNlbGZQbGF5ZXJQb3MueCArIDEwCiAgICAgICAgVFRQb3MueCA9IFRUUG9zLnggKyAxMAogICAgICAgIGxvY2FsIGNhcmMgPSBjcmVhdGVfb2JqZWN0KHV0aWwuam9hYXQoImFwYV9wcm9wX2ZsYWdfY2hpbmEiKSwgVFRQb3MueCwgVFRQb3MueSwgVFRQb3MueikKICAgICAgICBsb2NhbCBjYXJjUG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKGNhcmMsIHRydWUpCiAgICAgICAgbG9jYWwgcGVkYyA9IGNyZWF0ZV9wZWQoMjYsIHV0aWwuam9hYXQoIkFfQ19IRU4iKSwgVFRQb3MueCwgVFRQb3MueSwgVFRQb3MueiwgMCkKICAgICAgICBsb2NhbCBwZWRjUG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKGNhcmMsIHRydWUpCiAgICAgICAgbG9jYWwgcm9wZWMgPSBQSFlTSUNTLkFERF9ST1BFKFRUUG9zLngsIFRUUG9zLnksIFRUUG9zLnosIDAuMCwgMC4wLCAwLjAsIDEuMCwgMSwgMC4wMDMwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMSwgMSwgMSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgMS4wLCB0cnVlLCAwKQogICAgICAgIFBIWVNJQ1MuQVRUQUNIX0VOVElUSUVTX1RPX1JPUEUocm9wZWMsY2FyYyxwZWRjLGNhcmNQb3MueCwgY2FyY1Bvcy55LCBjYXJjUG9zLnogLHBlZGNQb3MueCwgcGVkY1Bvcy55LCBwZWRjUG9zLnosMiwgZmFsc2UsIGZhbHNlLCAwLCAwLCAiQ2VudGVyIiwiQ2VudGVyIikKICAgICAgICB1dGlsLnlpZWxkKDM1MDApCiAgICAgICAgUEhZU0lDUy5ERUxFVEVfQ0hJTERfUk9QRShyb3BlYykKICAgICAgICBkZWxldGVfZW50aXR5KHBlZGMpCiAgICBlbmQKZW5kCi0tLS01R+W0qea6gwpmdW5jdGlvbiBHNV9jcmFzaCgpCiAgICBmb3IgcGlkID0gMCwgMzEgZG8KICAgICAgICBsb2NhbCBUUFAgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKQogICAgICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhUUFAsIHRydWUpCiAgICAgICAgcG9zLnogPSBwb3MueiArIDEwCiAgICAgICAgbG9jYWwgdmVoID0gZW50aXRpZXMuZ2V0X2FsbF92ZWhpY2xlc19hc19oYW5kbGVzKCkKICAgICAgICBmb3IgaSA9IDEsICN2ZWggZG8KICAgICAgICAgICAgTkVUV09SSy5ORVRXT1JLX1JFUVVFU1RfQ09OVFJPTF9PRl9FTlRJVFkodmVoW2ldKQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFNfTk9fT0ZGU0VUKHZlaFtpXSwgcG9zLngscG9zLnkscG9zLnosIEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcoVFBQKSwgMTApCiAgICAgICAgICAgIFRBU0suVEFTS19WRUhJQ0xFX1RFTVBfQUNUSU9OKFRQUCwgdmVoW2ldLCAxOCwgOTk5KQogICAgICAgICAgICBUQVNLLlRBU0tfVkVISUNMRV9URU1QX0FDVElPTihUUFAsIHZlaFtpXSwgMTYsIDk5OSkKICAgICAgICBlbmQKICAgIGVuZAplbmQKLS0tLeWGt+aImOW0qea6gwpmdW5jdGlvbiBzaGl2ZXJfY3Jhc2goKQogICAgZm9yIG4gPSAwICwgNSBkbwogICAgICAgIFBFRFAgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRURfU0NSSVBUX0lOREVYKFBMQVlFUi5QTEFZRVJfSUQoKSkKICAgICAgICBsb2NhbCBvYmplY3RfaGFzaCA9IDExMTc5MTcwNTkKICAgICAgICByZXF1ZXN0X21vZGVsKG9iamVjdF9oYXNoKQogICAgICAgIFBMQVlFUi5TRVRfUExBWUVSX1BBUkFDSFVURV9NT0RFTF9PVkVSUklERShQTEFZRVIuUExBWUVSX0lEKCksb2JqZWN0X2hhc2gpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTX05PX09GRlNFVChQRURQLCAwLDAsNTAwLCAwLCAwLCAxKQogICAgICAgIFdFQVBPTi5HSVZFX0RFTEFZRURfV0VBUE9OX1RPX1BFRChQRURQLCAweEZCQUI1Nzc2LCAxMDAwLCBmYWxzZSkKICAgICAgICB1dGlsLnlpZWxkKDEwMDApCiAgICAgICAgZm9yIGkgPSAwICwgMjAgZG8KICAgICAgICAgICAgUEVELkZPUkNFX1BFRF9UT19PUEVOX1BBUkFDSFVURShQRURQKQogICAgICAgIGVuZAogICAgICAgIHV0aWwueWllbGQoMTAwMCkKICAgICAgICBtZW51LnRyaWdnZXJfY29tbWFuZHMoInRwbHNpYSIpCiAgICAgICAgbG9jYWwgYnVzaF9oYXNoID0gLTkwODEwNDk1MAogICAgICAgIHJlcXVlc3RfbW9kZWwoYnVzaF9oYXNoKQogICAgICAgIFBMQVlFUi5TRVRfUExBWUVSX1BBUkFDSFVURV9NT0RFTF9PVkVSUklERShQTEFZRVIuUExBWUVSX0lEKCksYnVzaF9oYXNoKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQoUEVEUCwgMCwwLDUwMCwgMCwgMCwgMSkKICAgICAgICBXRUFQT04uR0lWRV9ERUxBWUVEX1dFQVBPTl9UT19QRUQoUEVEUCwgMHhGQkFCNTc3NiwgMTAwMCwgZmFsc2UpCiAgICAgICAgICAgdXRpbC55aWVsZCgxMDAwKQogICAgICAgIGZvciBpID0gMCAsIDIwIGRvCiAgICAgICAgICAgIFBFRC5GT1JDRV9QRURfVE9fT1BFTl9QQVJBQ0hVVEUoUEVEUCkKICAgICAgICBlbmQKICAgICAgICB1dGlsLnlpZWxkKDEwMDApCiAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJ0cGxzaWEiKQogICAgZW5kCmVuZAotLS0t5aOw6Z+z5bSp5rqDCmZ1bmN0aW9uIHNvdW5kX2NyYXNoKCkKICAgIGZvciBwaWQgPSAwLCAzMSBkbwogICAgICAgIGxvY2FsIFRQUCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICAgICAgbG9jYWwgdGltZSA9IHV0aWwuY3VycmVudF90aW1lX21pbGxpcygpICsgMjAwMAogICAgICAgIHdoaWxlIHRpbWUgPiB1dGlsLmN1cnJlbnRfdGltZV9taWxsaXMoKSBkbwogICAgICAgIGxvY2FsIFRQUFMgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoVFBQLCB0cnVlKQogICAgICAgICAgICBmb3IgaSA9IDEsIDIwIGRvCiAgICAgICAgICAgICAgICBBVURJTy5QTEFZX1NPVU5EX0ZST01fQ09PUkQoLTEsICJFdmVudF9NZXNzYWdlX1B1cnBsZSIsIFRQUFMueCxUUFBTLnksVFBQUy56LCAiR1RBT19GTV9FdmVudHNfU291bmRzZXQiLCB0cnVlLCAxMDAwMDAsIGZhbHNlKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgdXRpbC55aWVsZCgpCiAgICAgICAgICAgIGZvciBpID0gMSwgMjAgZG8KICAgICAgICAgICAgQVVESU8uUExBWV9TT1VORF9GUk9NX0NPT1JEKC0xLCAiNXMiLCBUUFBTLngsVFBQUy55LFRQUFMueiwgIkdUQU9fRk1fRXZlbnRzX1NvdW5kc2V0IiwgdHJ1ZSwgMTAwMDAwLCBmYWxzZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHV0aWwueWllbGQoKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKCgotLS0tLS0t5bCE5Ye6bnBjCmxvY2FsIHJlcGxheUludGVyZmFjZTEgPSBtZW1vcnkucmVhZF9sb25nKG1lbW9yeS5yaXAobWVtb3J5LnNjYW4oIjQ4IDhEIDBEID8gPyA/ID8gNDggOEIgRDcgRTggPyA/ID8gPyA0OCA4RCAwRCA/ID8gPyA/IDhBIEQ4IEU4ID8gPyA/ID8gODQgREIgNzUgMTMgNDggOEQgMEQiKSArIDMpKQpsb2NhbCBwZWRJbnRlcmZhY2UxID0gbWVtb3J5LnJlYWRfbG9uZyhyZXBsYXlJbnRlcmZhY2UxICsgMHgwMDE4KQpmdW5jdGlvbiBzaGVjaHVOUEMoKQogICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCglsb2NhbCByb3QgPSBDQU0uR0VUX0dBTUVQTEFZX0NBTV9ST1QoMCkKCWlmIFBFRC5JU19QRURfU0hPT1RJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgdGhlbiAKCQlwZWRzcGF3biA9IFBFRC5DUkVBVEVfUkFORE9NX1BFRChwb3MueCwgcG9zLnksIHBvcy56KQoJCUVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKHBlZHNwYXduLCByb3QueCwgcm90LnksIHJvdC56LCAxLCBmYWxzZSkKCQlFTlRJVFkuQVBQTFlfRk9SQ0VfVE9fRU5USVRZX0NFTlRFUl9PRl9NQVNTKHBlZHNwYXduLCAxLCAwLCAxMDAwLCAwLCBmYWxzZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkKCWVuZAogICAgbG9jYWwgcGVkYW1vdW50ID0gbWVtb3J5LnJlYWRfaW50KHBlZEludGVyZmFjZTEgKyAweDAxMTApCiAgICBpZiBwZWRhbW91bnQgPiAyNDAgdGhlbgogICAgICAgIE5vcm1hbF9jbGVhcmFuY2UoKQogICAgZW5kCmVuZAoKCi0tLS0tLS0tLS0tLeS8oOmAgei9veWFtwotLS0t5Lyg6YCB6L295YW35Yiw5a+86Iiq54K5CmZ1bmN0aW9uIHRwX3BsYXllcl9jYXJfdG9fcG9pbnQocGlkKQogICAgCiAgICBsb2NhbCB3YXlwb2ludCA9IEhVRC5HRVRfQkxJUF9JTkZPX0lEX0NPT1JEKEhVRC5HRVRfRklSU1RfQkxJUF9JTkZPX0lEKEhVRC5HRVRfV0FZUE9JTlRfQkxJUF9FTlVNX0lEKCkpKQogICAgbG9jYWwgYyA9IHdheXBvaW50X2Nvb3JkKHdheXBvaW50Lngsd2F5cG9pbnQueSx3YXlwb2ludC56KQogICAgaWYgYy54IH49IDAgdGhlbgogICAgICAgIHRwX3BsYXllcl9jYXJfdG9fY29vcmRzKHBpZCwgYykKICAgIGVuZAplbmQKLS0tLeS8oOmAgei9veWFt+WIsOWcsOS4iwpmdW5jdGlvbiB0cF9wbGF5ZXJfY2FyX3RvX3VuZGVyZ3JvdW5kKHBpZCkKICAgIAogICAgbG9jYWwgcCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICBsb2NhbCBjID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHApCiAgICBsb2NhbCB2ZWggPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0lOKHAsIGZhbHNlKQogICAgaWYgUEVELklTX1BFRF9JTl9BTllfVkVISUNMRShwLCBmYWxzZSkgdGhlbgogICAgICAgIGMgPSB3YXlwb2ludF9jb29yZChjLngsIGMueSwgYy56KQogICAgICAgIHJlcXVlc3RfY29udHJvbCh2ZWgsIDMpCiAgICAgICAgYy56ID0gYy56IC0gNTAKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFModmVoLCBjLngsIGMueSwgYy56LCBmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSkgLS10cCB1bmRlcm1hcAogICAgZW5kCmVuZAotLS0t5Lyg6YCB6L295YW35Yiw5Z2Q5qCH54K5CmZ1bmN0aW9uIHRwX3BsYXllcl9jYXJfdG9fY29vcmRzKHBpZCwgY29vcmQpCiAgICAKICAgIE5FVFdPUksuTkVUV09SS19TRVRfSU5fU1BFQ1RBVE9SX01PREUodHJ1ZSxQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSkKICAgIHV0aWwueWllbGQoMTAwMCkKICAgIGxvY2FsIGNhciA9IFBFRC5HRVRfVkVISUNMRV9QRURfSVNfSU4oUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCksIHRydWUpCiAgICBpZiBjYXIgfj0gMCB0aGVuCiAgICAgICAgcmVxdWVzdF9jb250cm9sKGNhciwgMykKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFNfTk9fT0ZGU0VUKGNhciwgY29vcmRbJ3gnXSwgY29vcmRbJ3knXSwgY29vcmRbJ3onXSwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgIGVuZAogICAgTkVUV09SSy5ORVRXT1JLX1NFVF9JTl9TUEVDVEFUT1JfTU9ERShmYWxzZSxQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSkKZW5kCgoKCi0tLS0tLS0tLei9veWFt+maj+acuuWNh+e6pwpmdW5jdGlvbiByYW5kb211cGRhdGNhcihwaWQpCiAgICAKICAgIGxvY2FsIHZlaGljbGUgPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0lOKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCBmYWxzZSkKICAgIHJlcXVlc3RfY29udHJvbCh2ZWhpY2xlLCAzKQogICAgVkVISUNMRS5TRVRfVkVISUNMRV9NT0RfS0lUKHZlaGljbGUsIDApCiAgICBmb3IgeCA9IDAsIDQ5IGRvCiAgICAgICAgbG9jYWwgbWF4ID0gVkVISUNMRS5HRVRfTlVNX1ZFSElDTEVfTU9EUyh2ZWhpY2xlLCB4KQogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfTU9EKHZlaGljbGUsIHgsIG1hdGgucmFuZG9tKC0xLCBtYXgpKQogICAgZW5kCiAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX1dJTkRPV19USU5UKHZlaGljbGUsIG1hdGgucmFuZG9tKC0xLDUpKQogICAgZm9yIHggPSAxNywgMjIgZG8KICAgICAgICBWRUhJQ0xFLlRPR0dMRV9WRUhJQ0xFX01PRCh2ZWhpY2xlLCB4LCBtYXRoLnJhbmRvbSgpID4gMC41KQogICAgZW5kCiAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0NVU1RPTV9QUklNQVJZX0NPTE9VUih2ZWhpY2xlLCBtYXRoLnJhbmRvbSgwLCAyNTUpLCBtYXRoLnJhbmRvbSgwLCAyNTUpLCBtYXRoLnJhbmRvbSgwLCAyNTUpKQogICAgVkVISUNMRS5TRVRfVkVISUNMRV9DVVNUT01fU0VDT05EQVJZX0NPTE9VUih2ZWhpY2xlLCBtYXRoLnJhbmRvbSgwLCAyNTUpLCBtYXRoLnJhbmRvbSgwLCAyNTUpLCBtYXRoLnJhbmRvbSgwLCAyNTUpKQogICAgdXRpbC55aWVsZCg1MDApCmVuZAoKLS0tLS0tLS3ml4vovaznmoTpmYDonroKZnVuY3Rpb24gY2Fyc3BpbihwaWQpCiAgICAKICAgIGxvY2FsIGNhciA9IFBFRC5HRVRfVkVISUNMRV9QRURfSVNfSU4oUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCksIHRydWUpCiAgICBpZiBjYXIgfj0gMCB0aGVuCiAgICAgICAgcmVxdWVzdF9jb250cm9sKGNhciwgMykKICAgICAgICBFTlRJVFkuQVBQTFlfRk9SQ0VfVE9fRU5USVRZX0NFTlRFUl9PRl9NQVNTKGNhciwgNCwgMC4wLCAwLjAsIDMwMC4wLCAwLCB0cnVlLCB0cnVlLCBmYWxzZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkKICAgIGVuZAplbmQKCgotLS0tLS0t55S156OB6ISJ5YayCmZ1bmN0aW9uIGNhcmVtcChwaWQpCiAgICAKICAgIGxvY2FsIGNhciA9IFBFRC5HRVRfVkVISUNMRV9QRURfSVNfSU4oUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCksIHRydWUpCiAgICBpZiBjYXIgfj0gMCB0aGVuCiAgICAgICAgbG9jYWwgYyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhjYXIpCiAgICAgICAgRklSRS5BRERfRVhQTE9TSU9OKGMueCwgYy55LCBjLnosIDgzLCAxMDAuMCwgZmFsc2UsIHRydWUsIDAuMCkKICAgIGVuZAplbmQKCgoKCi0tLS3liKDpmaTnjqnlrrbovb3lhbcKZnVuY3Rpb24gZGVsZXBsYXllcmNhcihwaWQpCiAgICAKICAgIGxvY2FsIHBsYXllciA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICBsb2NhbCBwbGF5ZXJfdmVoID0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19VU0lORyhwbGF5ZXIpCiAgICByZXF1ZXN0X2NvbnRyb2wocGxheWVyX3ZlaCwgMykKICAgIGlmIE5FVFdPUksuTkVUV09SS19IQVNfQ09OVFJPTF9PRl9FTlRJVFkocGxheWVyX3ZlaCkgdGhlbgogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0FTX01JU1NJT05fRU5USVRZKHBsYXllcl92ZWgsIGZhbHNlLCBmYWxzZSkKICAgICAgICBkZWxldGVfZW50aXR5KHBsYXllcl92ZWgpCiAgICBlbmQKZW5kCi0tLS3npoHnlKjovb3lhbcKZnVuY3Rpb24gZGlzYWJsZV92ZWhpY2xlKHBpZCkKICAgIGlmIFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpIH49IDAgdGhlbgogICAgICAgIAogICAgICAgIGlmIFBFRC5JU19QRURfSU5fQU5ZX1ZFSElDTEUoUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkpIHRoZW4KICAgICAgICAgICAgbG9jYWwgdmVoID0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19JTihQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSwgZmFsc2UpCiAgICAgICAgICAgIFRBU0suQ0xFQVJfUEVEX1RBU0tTX0lNTUVESUFURUxZKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpKQogICAgICAgIGVsc2UKICAgICAgICAgICAgbG9jYWwgdmVoMiA9IFBFRC5HRVRfVkVISUNMRV9QRURfSVNfVFJZSU5HX1RPX0VOVEVSKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpKQogICAgICAgICAgICBkZWxldGVfZW50aXR5KHZlaDIpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCi0tLS3npoHnlKjpqb7pqbYKZnVuY3Rpb24gZGlzYWJsZV9kcml2ZSh0b2dnbGVkLCBwaWQpCiAgICAKICAgIGxvY2FsIHZlaGljbGUgPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0lOKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCBmYWxzZSkKICAgIHJlcXVlc3RfY29udHJvbCh2ZWhpY2xlLCAzKQogICAgVkVISUNMRS5TRVRfVkVISUNMRV9VTkRSSVZFQUJMRSh2ZWhpY2xlLCB0b2dnbGVkKQplbmQKCgotLeWjsOmfs+W0qea6g1YxCmZ1bmN0aW9uIHNvdW5kY3Jhc2h2MShwaWQpCiAgICAKICAgIGxvY2FsIHRpbWUgPSB1dGlsLmN1cnJlbnRfdGltZV9taWxsaXMoKSArIDIwMDAKICAgICAgICB3aGlsZSB0aW1lID4gdXRpbC5jdXJyZW50X3RpbWVfbWlsbGlzKCkgZG8KICAgICAgICAgICAgbG9jYWwgcG9zPUVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSwgdHJ1ZSkKICAgICAgICAgICAgZm9yIGkgPSAxLCAxMCBkbwogICAgICAgICAgICAgICAgQVVESU8uUExBWV9TT1VORF9GUk9NX0NPT1JEKC0xLCIxMHMiLHBvcy54LHBvcy55LHBvcy56LCJNUF9NSVNTSU9OX0NPVU5URE9XTl9TT1VORFNFVCIsdHJ1ZSwgNzAsIGZhbHNlKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgdXRpbC55aWVsZCgwKQogICAgICAgIGVuZAogICAgZW5kIAoKLS3lo7Dpn7PltKnmuoNWMgpmdW5jdGlvbiBzb3VuZGNyYXNodjIocGlkKQogICAgCiAgICBsb2NhbCB0aW1lID0gdXRpbC5jdXJyZW50X3RpbWVfbWlsbGlzKCkgKyAyMDAwCiAgICAgICAgd2hpbGUgdGltZSA+IHV0aWwuY3VycmVudF90aW1lX21pbGxpcygpIGRvCiAgICAgICAgICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSwgdHJ1ZSkKICAgICAgICAgICAgZm9yIGkgPSAxLCAyMCBkbwogICAgICAgICAgICAgICAgQVVESU8uUExBWV9TT1VORF9GUk9NX0NPT1JEKC0xLCAnRXZlbnRfTWVzc2FnZV9QdXJwbGUnLCBwb3MueCwgcG9zLnksIHBvcy56LCAnR1RBT19GTV9FdmVudHNfU291bmRzZXQnLCB0cnVlLCAxMDAwLCBmYWxzZSkKICAgICAgICAgICAgICAgIEFVRElPLlBMQVlfU09VTkRfRlJPTV9DT09SRCgtMSwgJzVzJywgcG9zLngsIHBvcy55LCBwb3MueiwgJ0dUQU9fRk1fRXZlbnRzX1NvdW5kc2V0JywgdHJ1ZSwgMTAwMCwgZmFsc2UpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICB1dGlsLnlpZWxkKCkKICAgICAgICBlbmQJCiAgICBlbmQKCgotLS0tLS3ouKLlh7rovb3lhbd2MQpmdW5jdGlvbiBraWNrY2FyKHBpZCkKICAgIAogICAgaWYgUEVELklTX1BFRF9JTl9BTllfVkVISUNMRShQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSwgZmFsc2UpIHRoZW4KICAgICAgICBsb2NhbCB2ZWhpY2xlID0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19JTihQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSwgZmFsc2UpCiAgICAgICAgcmVxdWVzdF9jb250cm9sKHZlaGljbGUsIDMpCiAgICAgICAgREVDT1JBVE9SLkRFQ09SX1JFR0lTVEVSKCJQbGF5ZXJfVmVoaWNsZSIsIDMpCiAgICAgICAgREVDT1JBVE9SLkRFQ09SX1NFVF9JTlQodmVoaWNsZSwiUGxheWVyX1ZlaGljbGUiLCAwKQogICAgZW5kCmVuZAoKLS0tLeW8uuWItuS4ouW8g+atpuWZqApmdW5jdGlvbiBmb3JjZV9kaXNjYXJkX3dlYXBvbigpCiAgICBpZiBXRUFQT04uR0VUX1NFTEVDVEVEX1BFRF9XRUFQT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgfj0gdXRpbC5qb2FhdCgiV0VBUE9OX1VOQVJNRUQiKSB0aGVuCiAgICAgICAgaWYgV0VBUE9OLkdFVF9TRUxFQ1RFRF9QRURfV0VBUE9OKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpID09IHV0aWwuam9hYXQoIldFQVBPTl9CWkdBUyIpIG9yIAogICAgICAgICAgICBXRUFQT04uR0VUX1NFTEVDVEVEX1BFRF9XRUFQT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgPT0gdXRpbC5qb2FhdCgiV0VBUE9OX0ZJUkVFWFRJTkdVSVNIRVIiKSBvciAKICAgICAgICAgICAgV0VBUE9OLkdFVF9TRUxFQ1RFRF9QRURfV0VBUE9OKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpID09IHV0aWwuam9hYXQoIldFQVBPTl9TTk9XQkFMTCIpIHRoZW4KICAgICAgICAgICAgV0VBUE9OLlJFTU9WRV9XRUFQT05fRlJPTV9QRUQoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgV0VBUE9OLkdFVF9TRUxFQ1RFRF9QRURfV0VBUE9OKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpKQogICAgICAgIGVsc2UKICAgICAgICAgICAgV0VBUE9OLlNFVF9QRURfRFJPUFNfSU5WRU5UT1JZX1dFQVBPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBXRUFQT04uR0VUX1NFTEVDVEVEX1BFRF9XRUFQT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSksIDAsIDEuMCwgMC4wLCAwKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKLS0tLS0t6Ieq5Yqo5Yqg6KGACmZ1bmN0aW9uIGF1dG9CbG9vZFJldHVyZSgpCiAgICBsb2NhbCBoZWFsdGggPSBFTlRJVFkuR0VUX0VOVElUWV9IRUFMVEgoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgIGlmIEVOVElUWS5HRVRfRU5USVRZX01BWF9IRUFMVEgoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgPT0gaGVhbHRoIHRoZW4gcmV0dXJuIGVuZAogICAgRU5USVRZLlNFVF9FTlRJVFlfSEVBTFRIKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGhlYWx0aCArIDUsIDApCiAgICB1dGlsLnlpZWxkKDI1NSkKZW5kCgotLS0tLS0t5Zyo5o6p5L2T5ZCO5pe26KGl5YWF55Sf5ZG95YC8CmZ1bmN0aW9uIGhlYWx0aGluY292ZXIodG9nZ2xlZCkKICAgIHJlc3RvcmVfaGVhbHRoID0gdG9nZ2xlZAogICAgd2hpbGUgcmVzdG9yZV9oZWFsdGggZG8KICAgICAgICBpZiBQRUQuSVNfUEVEX0lOX0NPVkVSKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKSB0aGVuCiAgICAgICAgICAgIFBMQVlFUjEuX1NFVF9QTEFZRVJfSEVBTFRIX1JFQ0hBUkdFX0xJTUlUKFBMQVlFUi5QTEFZRVJfSUQoKSwgMS4wKQogICAgICAgICAgICBQTEFZRVIuU0VUX1BMQVlFUl9IRUFMVEhfUkVDSEFSR0VfTVVMVElQTElFUihQTEFZRVIuUExBWUVSX0lEKCksIDE1LjApCiAgICAgICAgZWxzZQogICAgICAgICAgICBQTEFZRVIxLl9TRVRfUExBWUVSX0hFQUxUSF9SRUNIQVJHRV9MSU1JVChQTEFZRVIuUExBWUVSX0lEKCksIDAuNSkKICAgICAgICAgICAgUExBWUVSLlNFVF9QTEFZRVJfSEVBTFRIX1JFQ0hBUkdFX01VTFRJUExJRVIoUExBWUVSLlBMQVlFUl9JRCgpLCAxLjApCiAgICAgICAgZW5kCiAgICAgICAgdXRpbC55aWVsZCgpCiAgICBlbmQKICAgIFBMQVlFUjEuX1NFVF9QTEFZRVJfSEVBTFRIX1JFQ0hBUkdFX0xJTUlUKFBMQVlFUi5QTEFZRVJfSUQoKSwgMC4yNSkKICAgIFBMQVlFUi5TRVRfUExBWUVSX0hFQUxUSF9SRUNIQVJHRV9NVUxUSVBMSUVSKFBMQVlFUi5QTEFZRVJfSUQoKSwgMS4wKQplbmQKCi0tLS0tLS0tLeWlveWPi+WIl+ihqApsb2NhbCBvbmxpbmVfZnJpZW5kcyA9IHt9CmZ1bmN0aW9uIGdldF9mcmllbmRfbGlzdCgpCiAgICBmb3IgaSA9IDAgLCBORVRXT1JLLk5FVFdPUktfR0VUX0ZSSUVORF9DT1VOVCgpIGRvCiAgICAgICAgbG9jYWwgc3RzdCA9ICIiCiAgICAgICAgbG9jYWwgbmFtZSA9IE5FVFdPUksuTkVUV09SS19HRVRfRlJJRU5EX05BTUUoaSkKICAgICAgICAKICAgICAgICBpZiBuYW1lIH49ICIqKioqKiIgdGhlbgogICAgICAgICAgICBpZiBORVRXT1JLLk5FVFdPUktfSVNfRlJJRU5EX09OTElORShuYW1lKSB0aGVuCiAgICAgICAgICAgICAgICBzdHN0ID0gIiBb5Zyo57q/XSIKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIG9ubGluZV9mcmllbmRzW2ldIH49IG5pbCB0aGVuLS3liKTmlq3ph43lpI0KICAgICAgICAgICAgICAgIG1lbnUuc2V0X21lbnVfbmFtZShvbmxpbmVfZnJpZW5kc1tpXSwgbmFtZS4uc3RzdCkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgb25saW5lX2ZyaWVuZHNbaV0gPSBtZW51Lmxpc3QoZnJlbmRsaXN0LCBuYW1lLi5zdHN0LCB7fSwgIiIpCiAgICAgICAgICAgICAgICAgICAgaWYgb25saW5lX2ZyaWVuZHNbaV0gdGhlbi0t5LiL5ouJ5YiX6KGoCiAgICAgICAgICAgICAgICAgICAgICAgIG1lbnUuZGl2aWRlcihvbmxpbmVfZnJpZW5kc1tpXSAsIG5hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgIG1lbnUuYWN0aW9uKG9ubGluZV9mcmllbmRzW2ldLCLliqDlhaXmiJjlsYAiLCB7fSwgIiIsZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJqb2luICIuLm5hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgICAgICAgICAgbWVudS5hY3Rpb24ob25saW5lX2ZyaWVuZHNbaV0sIuingueci+eOqeWutiIsIHt9LCAiIixmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZW51LnRyaWdnZXJfY29tbWFuZHMoIm5hbWVzcGVjdGF0ZSAiLi5uYW1lKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICAgICAgICAgIG1lbnUuYWN0aW9uKG9ubGluZV9mcmllbmRzW2ldLCLpgoDor7fnjqnlrrYiLCB7fSwgIiIsZnVuY3Rpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJpbnZpdGUgIi4ubmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgICAgICAgICBtZW51LmFjdGlvbihvbmxpbmVfZnJpZW5kc1tpXSwi546p5a625qGj5qGIIiwge30sICIiLGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lbnUudHJpZ2dlcl9jb21tYW5kcygibmFtZXByb2ZpbGUgIi4ubmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kKQogICAgICAgICAgICAgICAgICAgICAgICBtZW51LnJlYWRvbmx5KG9ubGluZV9mcmllbmRzW2ldLCAi5aSN5Yi25pi156ewOiAiLCBuYW1lKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQgCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgoKLS0tLeaImOWxgOWIh+aNogpmdW5jdGlvbiBzd2l0Y2hfc2Vzc2lvbihTZXNzaW9uVHlwZSwgaWQpCiAgICAtLeato+W4uOWIh+aNouaImOWxgO+8jOS/ruaUueaImOWxgOexu+WeiwogICAgU0VUX0lOVF9HTE9CQUwoU2Vzc2lvblR5cGUsIGlkKQogICAgLS3liIfmjaLmiJjlsYDnirbmgIEKICAgIFNFVF9JTlRfR0xPQkFMKEdsb2JhbF9CYXNlLlNlc3Npb25Td2l0Y2hTdGF0ZSwgMSkKICAgIHV0aWwueWllbGQoMjAwKQogICAgU0VUX0lOVF9HTE9CQUwoR2xvYmFsX0Jhc2UuU2Vzc2lvblN3aXRjaFN0YXRlLCAwKQplbmQKCgotLS0t5Y+R6YCB5aaT5aWzCmZ1bmN0aW9uIHNlbmRfaG9va2VyKGluZGV4LCBwaWQpCiAgICAKICAgIGxvY2FsIGMgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCksIC01LjAsIDAuMCwgMC4wKQogICAgbG9jYWwgaG9va2VyID0gMAogICAgaWYgaW5kZXggPT0gMSB0aGVuCiAgICAgICAgaG9va2VyID0gUEVELkNMT05FX1BFRChQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSwgdHJ1ZSwgZmFsc2UsIHRydWUpCiAgICBlbHNlaWYgaW5kZXggPT0gMiB0aGVuCiAgICAgICAgcmVxdWVzdF9tb2RlbCh1dGlsLmpvYWF0KCdjc19sZXN0ZXJjcmVzdCcpKQogICAgICAgIGhvb2tlciA9IGVudGl0aWVzLmNyZWF0ZV9wZWQoMjgsIHV0aWwuam9hYXQoJ2NzX2xlc3RlcmNyZXN0JyksIGMsIG1hdGgucmFuZG9tKDI3MCkpCiAgICBlbHNlaWYgaW5kZXggPT0gMyB0aGVuCiAgICAgICAgcmVxdWVzdF9tb2RlbCh1dGlsLmpvYWF0KCdjc190cmFjeWRpc2FudG8nKSkKICAgICAgICBob29rZXIgPSBlbnRpdGllcy5jcmVhdGVfcGVkKDI4LCB1dGlsLmpvYWF0KCdjc190cmFjeWRpc2FudG8nKSwgYywgbWF0aC5yYW5kb20oMjcwKSkKICAgIGVsc2VpZiBpbmRleCA9PSA0IHRoZW4KICAgICAgICByZXF1ZXN0X21vZGVsKHV0aWwuam9hYXQoJ2NzYl9hZ2F0aGEnKSkKICAgICAgICBob29rZXIgPSBlbnRpdGllcy5jcmVhdGVfcGVkKDI4LCB1dGlsLmpvYWF0KCdjc2JfYWdhdGhhJyksIGMsIG1hdGgucmFuZG9tKDI3MCkpCiAgICBlbHNlaWYgaW5kZXggPT0gNSB0aGVuCiAgICAgICAgcmVxdWVzdF9tb2RlbCh1dGlsLmpvYWF0KCdhX2ZfeV90b3BsZXNzXzAxJykpCiAgICAgICAgaG9va2VyID0gZW50aXRpZXMuY3JlYXRlX3BlZCgyOCwgdXRpbC5qb2FhdCgnYV9mX3lfdG9wbGVzc18wMScpLCBjLCBtYXRoLnJhbmRvbSgyNzApKQogICAgICAgIFBFRC5TRVRfUEVEX0NPTVBPTkVOVF9WQVJJQVRJT04oaG9va2VyLCA4LCAxLCAxLCAxKQogICAgZW5kCgogICAgYyA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSwgLTUuMCwgMC4wLCAwLjApCiAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFMoaG9va2VyLCBjLngsIGMueSwgYy56KQogICAgVEFTSy5UQVNLX1NUQVJUX1NDRU5BUklPX0lOX1BMQUNFKGhvb2tlciwgIldPUkxEX0hVTUFOX1BST1NUSVRVVEVfSElHSF9DTEFTUyIsIDAsIGZhbHNlKQplbmQKCi0tLS0tLeiOt+WPluWvvOW8uQpmdW5jdGlvbiBkZDAyKHZhbHVlLCBtZW51X25hbWUsIGNsaWNrX3R5cGUpCiAgICBpZiB2YWx1ZSA9PSAxIHRoZW4KICAgICAgICBhdHRhY2hfdG9fcGxheWVyKCJwcm9wX2NzX2RpbGRvXzAxIiwgNTc1OTcsIC0wLjEsIDAuMTUsIDAsIDAsIDkwLCA5MCkKICAgIGVsc2VpZiB2YWx1ZSA9PSAyIHRoZW4KICAgICAgICBhdHRhY2hfdG9fcGxheWVyKCJwcm9wX2xkX2JvbWJfMDEiLCA1NzU5NywgLTAuMSwgMC42LCAwLCAwLCAxODAsIDE4MCkKICAgIGVsc2VpZiB2YWx1ZSA9PSAzIHRoZW4KICAgICAgICBhdHRhY2hfdG9fcGxheWVyKCJwcm9wX3NhbV8wMSIsIDU3NTk3LCAtMC4xLCAxLjcsIDAsIDAsIDE4MCwgMTgwKQogICAgZWxzZWlmIHZhbHVlID09IDQgdGhlbgogICAgICAgIGF0dGFjaF90b19wbGF5ZXIoImg0X3Byb3BfaDRfYWlybWlzc2lsZV8wMWEiLCA1NzU5NywgLTAuMSwgMCwgMCwgMCwgMTgwLCAxODApCiAgICBlbHNlaWYgdmFsdWUgPT0gNSB0aGVuCiAgICAgICAgZm9yIGssIG1vZGVsIGluIHBhaXJzKG9ial9wcC52YWx1ZSkgZG8gCiAgICAgICAgICAgIGRlbGV0ZV9vYmplY3QobW9kZWwpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgotLS0t6b6Z5oGvCmxvY2FsIERyYWdvblB0ZngKZnVuY3Rpb24gRHJhZ29uX0JyZWF0aCgpCiAgICByZXF1ZXN0X3B0ZnhfYXNzZXQoInZlaF94c192ZWhpY2xlX21vZHMiKQogICAgaWYgbm90IFBFRC5JU19QRURfSU5fQU5ZX1ZFSElDTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgdGhlbgogICAgICAgIGlmIFBBRC5JU19DT05UUk9MX1BSRVNTRUQoMCwgMjA2KSB0aGVuCiAgICAgICAgICAgIGlmIG5vdCBHUkFQSElDUy5ET0VTX1BBUlRJQ0xFX0ZYX0xPT1BFRF9FWElTVChEcmFnb25QdGZ4KSB0aGVuCiAgICAgICAgICAgICAgICBEcmFnb25QdGZ4ID0gR1JBUEhJQ1MuU1RBUlRfTkVUV09SS0VEX1BBUlRJQ0xFX0ZYX0xPT1BFRF9PTl9FTlRJVFlfQk9ORSgidmVoX25pdHJvdXMiLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAtMC4wMSwgMC4xNSwgMC4wLCAwLjAsIDAuMCwgMTgwLjAsIFBFRC5HRVRfUEVEX0JPTkVfSU5ERVgoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMzEwODYpLCAwLjUsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDAsIDAsIDAsIDI1NSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZWxzZQogICAgICAgICAgICBpZiBHUkFQSElDUy5ET0VTX1BBUlRJQ0xFX0ZYX0xPT1BFRF9FWElTVChEcmFnb25QdGZ4KSB0aGVuCiAgICAgICAgICAgICAgICBHUkFQSElDUy5SRU1PVkVfUEFSVElDTEVfRlgoRHJhZ29uUHRmeCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgotLS0tLS0t5Za354GrCmZ1bmN0aW9uIGZpcmV3aW5nc2NhbGUodmFsdWUpCiAgICBmaXJlV2luZ3MzU2V0dGluZ3Muc2NhbGUgPSB2YWx1ZSAvIDEwCmVuZApmdW5jdGlvbiBmaXJld2luZ2NvbG91cihjb2xvdXIpCiAgICBmaXJlV2luZ3MzU2V0dGluZ3MuY29sb3VyID0gY29sb3VyCmVuZApmaXJlQnJlYXRoU2V0dGluZ3MgPSB7CiAgICBzY2FsZSA9IDAuMywKICAgIGNvbG91ciA9IHtyID0gMSwgZyA9IDEyNyAvIDI1NSwgYiA9IDEyNyAvIDI1NSwgYSA9IDF9LAogICAgb24gPSBmYWxzZSwKICAgIHkgPSB7IHZhbHVlID0gMC4xMiwgc3RpbGwgPSAwLjEyLCB3YWxrID0gIDAuMjIsIHNwcmludCA9IDAuMzIsIHNuZWFrID0gMC4zNSB9LAogICAgeiA9IHsgdmFsdWUgPSAwLjU4LCBzdGlsbCA9IDAuNTgsIHdhbGsgPSAgMC40NSwgc3ByaW50ID0gMC4zOCwgc25lYWsgPSAwLjM1IH0sCn0KZnVuY3Rpb24gdHJhbnNpdGlvblZhbHVlKHZhbHVlLCB0YXJnZXQsIHN0ZXApCiAgICBpZiB2YWx1ZSA9PSB0YXJnZXQgdGhlbiByZXR1cm4gdmFsdWUgZW5kCiAgICByZXR1cm4gdmFsdWUgKyBzdGVwICogKCB2YWx1ZSA+IHRhcmdldCBhbmQgLTEgb3IgMSApCmVuZApmdW5jdGlvbiBmaXJlQnJlYXRoU2V0dGluZ3M6Y2hhbmdlUG9zKG1vdmVtZW50VHlwZSkKICAgIHNlbGYuei52YWx1ZSA9IHRyYW5zaXRpb25WYWx1ZShzZWxmLnoudmFsdWUsIHNlbGYuelttb3ZlbWVudFR5cGVdLCAwLjAxKQogICAgc2VsZi55LnZhbHVlID0gdHJhbnNpdGlvblZhbHVlKHNlbGYueS52YWx1ZSwgc2VsZi55W21vdmVtZW50VHlwZV0sIDAuMDEpCmVuZApmdW5jdGlvbiBmaXJlYnJlYXRoeHh4KHRvZ2dsZSkKICAgIGlmIHRvZ2dsZSB0aGVuCiAgICAgICAgcmVxdWVzdF9wdGZ4X2Fzc2V0KCd3ZWFwX3hzX3ZlaGljbGVfd2VhcG9ucycpCiAgICAgICAgR1JBUEhJQ1MuVVNFX1BBUlRJQ0xFX0ZYX0FTU0VUKCd3ZWFwX3hzX3ZlaGljbGVfd2VhcG9ucycpCiAgICAgICAgZmlyZUJyZWF0aFNldHRpbmdzLnB0ZnggPSBHUkFQSElDUy5TVEFSVF9ORVRXT1JLRURfUEFSVElDTEVfRlhfTE9PUEVEX09OX0VOVElUWV9CT05FKCdtdXpfeHNfdHVycmV0X2ZsYW1ldGhyb3dlcl9sb29waW5nJywgUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMCwgMC4xMiwgMC41OCwgMzAsIDAsIDAsIDB4OGI5MywgZmlyZUJyZWF0aFNldHRpbmdzLnNjYWxlLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCAwLCAwLCAwLCAwKQogICAgICAgIEdSQVBISUNTLlNFVF9QQVJUSUNMRV9GWF9MT09QRURfQ09MT1VSKGZpcmVCcmVhdGhTZXR0aW5ncy5wdGZ4LCBmaXJlQnJlYXRoU2V0dGluZ3MuY29sb3VyLnIsIGZpcmVCcmVhdGhTZXR0aW5ncy5jb2xvdXIuZywgZmlyZUJyZWF0aFNldHRpbmdzLmNvbG91ci5iLCBmYWxzZSkKICAgIGVsc2UKICAgICAgICBHUkFQSElDUy5TVE9QX1BBUlRJQ0xFX0ZYX0xPT1BFRChmaXJlQnJlYXRoU2V0dGluZ3MucHRmeCwgZmFsc2UpCiAgICAgICAgR1JBUEhJQ1MuUkVNT1ZFX1BBUlRJQ0xFX0ZYKGZpcmVCcmVhdGhTZXR0aW5ncy5wdGZ4LCB0cnVlKQogICAgICAgIFNUUkVBTUlORy5SRU1PVkVfTkFNRURfUFRGWF9BU1NFVCgnd2VhcF94c192ZWhpY2xlX3dlYXBvbnMnKQogICAgZW5kCmVuZApmdW5jdGlvbiBmaXJlYnJlYXRoc2NhbGUodmFsdWUpCiAgICBmaXJlQnJlYXRoU2V0dGluZ3Muc2NhbGUgPSB2YWx1ZSAvIDEwCiAgICBHUkFQSElDUy5TRVRfUEFSVElDTEVfRlhfTE9PUEVEX1NDQUxFKGZpcmVCcmVhdGhTZXR0aW5ncy5wdGZ4LCBmaXJlQnJlYXRoU2V0dGluZ3Muc2NhbGUpCmVuZApmdW5jdGlvbiBmaXJlYnJlYXRoY29sb3VyKGNvbG91cikKICAgIGZpcmVCcmVhdGhTZXR0aW5ncy5jb2xvdXIgPSBjb2xvdXIKICAgIEdSQVBISUNTLlNFVF9QQVJUSUNMRV9GWF9MT09QRURfQ09MT1VSKGZpcmVCcmVhdGhTZXR0aW5ncy5wdGZ4LCBmaXJlQnJlYXRoU2V0dGluZ3MuY29sb3VyLnIsIGZpcmVCcmVhdGhTZXR0aW5ncy5jb2xvdXIuZywgZmlyZUJyZWF0aFNldHRpbmdzLmNvbG91ci5iLCBmYWxzZSkKZW5kCgotLS0t5pi+56S65YeG5pifCmZ1bmN0aW9uIGZyb250X3NpZ2h0KHN0cikKICAgIC0t6buY6K6k5YeG5pifIEhVRC5ESVNQTEFZX1NOSVBFUl9TQ09QRV9USElTX0ZSQU1FKCkKICAgIC0t6Ieq5a6a5LmJ5YeG5pifCiAgICBIVUQuU0VUX1RFWFRfU0NBTEUoMS4wLDAuNSkKICAgIEhVRC5TRVRfVEVYVF9GT05UKDApCiAgICBIVUQuU0VUX1RFWFRfQ0VOVFJFKDEpCiAgICBIVUQuU0VUX1RFWFRfT1VUTElORSgwKQogICAgSFVELlNFVF9URVhUX0NPTE9VUigyNTUsIDI1NSwgMjU1LCAyNTUpCiAgICB1dGlsLkJFR0lOX1RFWFRfQ09NTUFORF9ESVNQTEFZX1RFWFQoc3RyKQogICAgSFVELkVORF9URVhUX0NPTU1BTkRfRElTUExBWV9URVhUKDAuNDk5OSwwLjQ3OCwwKQplbmQKCi0tLS3nnoTlh4bmg6nnvZoKbG9jYWwgd2hpdGVsaXN0R3JvdXBzID0ge3VzZXIgPSB0cnVlLCBmcmllbmRzID0gdHJ1ZSwgc3RyYW5nZXJzICA9IHRydWV9Cmthcm1hID0ge30KZnVuY3Rpb24gaXNBbnlQbGF5ZXJUYXJnZXRpbmdFbnRpdHkocGxheWVyUGVkKQogICAgZm9yIGssIHBsYXllclBpZCBpbiBwYWlycyhwbGF5ZXJzLmxpc3QoZmFsc2UsIHRydWUsIHRydWUpKSBkbwogICAgICAgIGlmIFBMQVlFUi5JU19QTEFZRVJfVEFSR0VUVElOR19FTlRJVFkocGxheWVyUGlkLCBwbGF5ZXJQZWQpIG9yIFBMQVlFUi5JU19QTEFZRVJfRlJFRV9BSU1JTkdfQVRfRU5USVRZKHBsYXllclBpZCwgcGxheWVyUGVkKSB0aGVuCiAgICAgICAgICAgIGthcm1hW3BsYXllclBlZF0gPSB7CiAgICAgICAgICAgICAgICBwaWQgPSBwbGF5ZXJQaWQsCiAgICAgICAgICAgICAgICBwZWQgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRURfU0NSSVBUX0lOREVYKHBsYXllclBpZCkKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgIGVuZAogICAgZW5kCiAgICBrYXJtYVtwbGF5ZXJQZWRdID0gbmlsCiAgICByZXR1cm4gZmFsc2UKZW5kCgoKLS0tLei9qOi/uQpsb2NhbCBsb2N1c19jb2xvdXIgPSB7ciA9IDEuMCwgZyA9IDAuMCwgYiA9IDEuMCwgYSA9IDEuMH0KZnVuY3Rpb24gbG9jdXNfY29sb3IobmV3Q29sb3VyKQogICAgbG9jdXNfY29sb3VyID0gbmV3Q29sb3VyCmVuZApmdW5jdGlvbiBDaGFyYWN0ZXJfbG9jdXMoKQogICAgcmVxdWVzdF9wdGZ4X2Fzc2V0KCJzY3JfcmNwYXBhcmF6em8xIikKICAgIGlmIFBFRC5JU19QRURfSU5fQU5ZX1ZFSElDTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSkgdGhlbgogICAgICAgIGxvY2FsIHZlaGljbGUgPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0lOKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKQogICAgICAgIGxvY2FsIG1pbmltdW0sIG1heGltdW0gPSB2My5uZXcoKSwgdjMubmV3KCkKICAgICAgICBNSVNDLkdFVF9NT0RFTF9ESU1FTlNJT05TKEVOVElUWS5HRVRfRU5USVRZX01PREVMKHZlaGljbGUpLCBtaW5pbXVtLCBtYXhpbXVtKQogICAgICAgIGxvY2FsIG9mZnNldHMgPSB7djMobWluaW11bS54LCBtaW5pbXVtLnksIDAuMCksIHYzKG1heGltdW0ueCwgbWluaW11bS55LCAwLjApfQogICAgICAgIGZvciBfLCBvZmZzZXQgaW4gaXBhaXJzKG9mZnNldHMpIGRvCiAgICAgICAgICAgIEdSQVBISUNTLlVTRV9QQVJUSUNMRV9GWF9BU1NFVCgic2NyX3JjcGFwYXJhenpvMSIpCiAgICAgICAgICAgIGxvY2FsIGZ4ID0gR1JBUEhJQ1MuU1RBUlRfTkVUV09SS0VEX1BBUlRJQ0xFX0ZYX05PTl9MT09QRURfT05fRU5USVRZKCJzY3JfbWljaDRfZmlyZXdvcmtfc3BhcmtsZV9zcGF3biIsIHZlaGljbGUsIG9mZnNldC54LCBvZmZzZXQueSwgMC4wLCAwLjAsIDAuMCwgMC4wLCAwLjcsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgICAgIEdSQVBISUNTLlNFVF9QQVJUSUNMRV9GWF9OT05fTE9PUEVEX0NPTE9VUihsb2N1c19jb2xvdXIuciwgbG9jdXNfY29sb3VyLmcsIGxvY3VzX2NvbG91ci5iKQogICAgICAgIGVuZAogICAgZWxzZWlmIEVOVElUWS5ET0VTX0VOVElUWV9FWElTVChQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSB0aGVuCiAgICAgICAgZm9yIF8sIGJvbmVJZCBpbiBpcGFpcnMoYm9uZXMpIGRvCiAgICAgICAgICAgIEdSQVBISUNTLlVTRV9QQVJUSUNMRV9GWF9BU1NFVCgic2NyX3JjcGFwYXJhenpvMSIpCiAgICAgICAgICAgIGxvY2FsIGZ4ID0gR1JBUEhJQ1MuU1RBUlRfUEFSVElDTEVfRlhfTk9OX0xPT1BFRF9PTl9FTlRJVFlfQk9ORSgic2NyX21pY2g0X2ZpcmV3b3JrX3NwYXJrbGVfc3Bhd24iLFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksMC4wLDAuMCwwLjAsMC4wLDAuMCwwLjAsUEVELkdFVF9QRURfQk9ORV9JTkRFWChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBib25lSWQpLDAuNyxmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICBHUkFQSElDUy5TRVRfUEFSVElDTEVfRlhfTk9OX0xPT1BFRF9DT0xPVVIobG9jdXNfY29sb3VyLnIsIGxvY3VzX2NvbG91ci5nLCBsb2N1c19jb2xvdXIuYikKICAgICAgICBlbmQKICAgIGVuZAplbmQKCi0tLS3nlJ/miJDlsI/lrp7kvZMKZnVuY3Rpb24gY3JlYXRlX3NtYWxsX2VudGl0aWVzKHBpZCwgaW5kZXgpCiAgICAKICAgIGxvY2FsIHRhcmdldF9wZWQgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKQogICAgaWYgaW5kZXggPT0gMSB0aGVuCiAgICAgICAgbG9jYWwgaGFzaCA9IDIyODI4MDcxMzQKICAgICAgICByZXF1ZXN0X21vZGVsKGhhc2gpCiAgICAgICAgbG9jYWwgcmFtcCA9IHNwYXduX29iamVjdF9pbl9mcm9udF9vZl9wZWQodGFyZ2V0X3BlZCwgaGFzaCwgOTAsIDUwLjAsIC0xLCB0cnVlKQogICAgICAgIGxvY2FsIGMgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMocmFtcCwgdHJ1ZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFNfTk9fT0ZGU0VUKHJhbXAsIGNbJ3gnXSwgY1sneSddLCBjWyd6J10tMC4yLCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgZWxzZWlmIGluZGV4ID09IDIgdGhlbgogICAgICAgIGxvY2FsIGhhc2ggPSAzNzI5MTY5MzU5CiAgICAgICAgbG9jYWwgb2JqID0gc3Bhd25fb2JqZWN0X2luX2Zyb250X29mX3BlZCh0YXJnZXRfcGVkLCBoYXNoLCAwLCA1LjAsIC0wLjUsIGZhbHNlKQogICAgICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKG9iaiwgdHJ1ZSkKICAgIGVsc2VpZiBpbmRleCA9PSAzIHRoZW4KICAgICAgICBsb2NhbCBoYXNoID0gMTk1MjM5NjE2MwogICAgICAgIGxvY2FsIG9iaiA9IHNwYXduX29iamVjdF9pbl9mcm9udF9vZl9wZWQodGFyZ2V0X3BlZCwgaGFzaCwgMCwgNS4wLCAtMzAsIGZhbHNlKQogICAgICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKG9iaiwgdHJ1ZSkKICAgIGVsc2VpZiBpbmRleCA9PSA0IHRoZW4KICAgICAgICBsb2NhbCBoYXNoID0gMjMwNjA1ODM0NAogICAgICAgIGxvY2FsIG9iaiA9IHNwYXduX29iamVjdF9pbl9mcm9udF9vZl9wZWQodGFyZ2V0X3BlZCwgaGFzaCwgMCwgMC4wLCAtNS4wLCBmYWxzZSkKICAgICAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihvYmosIHRydWUpCiAgICBlbmQKZW5kCgotLS0tLS0tLea/gOWFieecvApmdW5jdGlvbiBsYXNlcl9leWVzKCkKICAgIGxvY2FsIHdlYXBvbkhhc2ggPSB1dGlsLmpvYWF0KCJ3ZWFwb25faGVhdnlzbmlwZXJfbWsyIikKICAgIGxvY2FsIGRpY3Rpb25hcnkgPSAid2VhcF94c193ZWFwb25zIgogICAgbG9jYWwgcHRmeF9uYW1lID0gImJ1bGxldF90cmFjZXJfeHNfc3IiCiAgICBsb2NhbCBjYW1Sb3QgPSBDQU0uR0VUX0ZJTkFMX1JFTkRFUkVEX0NBTV9ST1QoMikKICAgIGlmIFBBRC5JU19DT05UUk9MX1BSRVNTRUQoMCwgNTEpIHRoZW4tLUUKICAgICAgICBsb2NhbCBpbnN0ID0gdjMubmV3KCkKICAgICAgICBsb2NhbCBmaW5hbF9yb3QgPSBDQU0uR0VUX0ZJTkFMX1JFTkRFUkVEX0NBTV9ST1QoMikKICAgICAgICB2My5zZXQoaW5zdCwgZmluYWxfcm90LngsZmluYWxfcm90LnksZmluYWxfcm90LnopCiAgICAgICAgbG9jYWwgdG1wID0gdjMudG9EaXIoaW5zdCkKICAgICAgICB2My5zZXQoaW5zdCwgdjMuZ2V0KHRtcCkpCiAgICAgICAgdjMubXVsKGluc3QsIDEwMDApCiAgICAgICAgbG9jYWwgZmluYWxfY29vcmQgPSBDQU0uR0VUX0ZJTkFMX1JFTkRFUkVEX0NBTV9DT09SRCgpCiAgICAgICAgdjMuc2V0KHRtcCwgZmluYWxfY29vcmQueCxmaW5hbF9jb29yZC55LGZpbmFsX2Nvb3JkLnopCiAgICAgICAgdjMuYWRkKGluc3QsIHRtcCkKICAgICAgICBsb2NhbCBjYW1BaW1feCwgY2FtQWltX3ksIGNhbUFpbV96ID0gdjMuZ2V0KGluc3QpCiAgICAgICAgLS3liKTmlq3mqKHlnovnmoRCT05FX0lOREVY5piv5ZCm5Yy56YWNCiAgICAgICAgbG9jYWwgbGVmdF9leWVfaWQgPSAwCiAgICAgICAgbG9jYWwgcmlnaHRfZXllX2lkID0gMAogICAgICAgIGxvY2FsIHBlZF9tb2RlbCA9IEVOVElUWS5HRVRfRU5USVRZX01PREVMKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICAgICAgaWYgcGVkX21vZGVsID09IDE4ODUyMzM2NTAgb3IgcGVkX21vZGVsID09IC0xNjY3MzAxNDE2IHRoZW4KICAgICAgICAgICAgbGVmdF9leWVfaWQgPSAyNTI2MAogICAgICAgICAgICByaWdodF9leWVfaWQgPSAyNzQ3NAogICAgICAgIGVsc2UKICAgICAgICAgICAgbGVmdF9leWVfaWQgPSA1OTU2CiAgICAgICAgICAgIHJpZ2h0X2V5ZV9pZCA9IDY0NjgKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgYm9uZUNvb3JkX0wgPSBFTlRJVFkuR0VUX1dPUkxEX1BPU0lUSU9OX09GX0VOVElUWV9CT05FKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIFBFRC5HRVRfUEVEX0JPTkVfSU5ERVgoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgbGVmdF9leWVfaWQpKQogICAgICAgIGxvY2FsIGJvbmVDb29yZF9SID0gRU5USVRZLkdFVF9XT1JMRF9QT1NJVElPTl9PRl9FTlRJVFlfQk9ORShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBQRUQuR0VUX1BFRF9CT05FX0lOREVYKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHJpZ2h0X2V5ZV9pZCkpCiAgICAgICAgaWYgcGVkX21vZGVsID09IHV0aWwuam9hYXQoIm1wX2ZfZnJlZW1vZGVfMDEiKSB0aGVuIAogICAgICAgICAgICBib25lQ29vcmRfTC56ID0gYm9uZUNvb3JkX0wueiArIDAuMDIKICAgICAgICAgICAgYm9uZUNvb3JkX1IueiA9IGJvbmVDb29yZF9SLnogKyAwLjAyCiAgICAgICAgZW5kCgogICAgICAgIGNhbVJvdC54ID0gY2FtUm90LnggLSA5MAogICAgICAgIHJlcXVlc3RfcHRmeF9hc3NldChkaWN0aW9uYXJ5KQogICAgICAgIEdSQVBISUNTLlVTRV9QQVJUSUNMRV9GWF9BU1NFVChkaWN0aW9uYXJ5KQogICAgICAgIEdSQVBISUNTLlNUQVJUX05FVFdPUktFRF9QQVJUSUNMRV9GWF9OT05fTE9PUEVEX0FUX0NPT1JEKHB0ZnhfbmFtZSwgYm9uZUNvb3JkX0wueCwgYm9uZUNvb3JkX0wueSwgYm9uZUNvb3JkX0wueiwgY2FtUm90LngsIGNhbVJvdC55LCBjYW1Sb3QueiwgMiwgMCwgMCwgMCwgZmFsc2UpCiAgICAgICAgR1JBUEhJQ1MuVVNFX1BBUlRJQ0xFX0ZYX0FTU0VUKGRpY3Rpb25hcnkpCiAgICAgICAgR1JBUEhJQ1MuU1RBUlRfTkVUV09SS0VEX1BBUlRJQ0xFX0ZYX05PTl9MT09QRURfQVRfQ09PUkQocHRmeF9uYW1lLCBib25lQ29vcmRfUi54LCBib25lQ29vcmRfUi55LCBib25lQ29vcmRfUi56LCBjYW1Sb3QueCwgY2FtUm90LnksIGNhbVJvdC56LCAyLCAwLCAwLCAwLCBmYWxzZSkKICAgICAgICBNSVNDLlNIT09UX1NJTkdMRV9CVUxMRVRfQkVUV0VFTl9DT09SRFNfSUdOT1JFX0VOVElUWShib25lQ29vcmRfTC54LCBib25lQ29vcmRfTC55LCBib25lQ29vcmRfTC56LCBjYW1BaW1feCwgY2FtQWltX3ksIGNhbUFpbV96LCAxMDAsIHRydWUsIHdlYXBvbkhhc2gsIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlLCB0cnVlLCAxMDAsIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDApCiAgICAgICAgTUlTQy5TSE9PVF9TSU5HTEVfQlVMTEVUX0JFVFdFRU5fQ09PUkRTX0lHTk9SRV9FTlRJVFkoYm9uZUNvb3JkX1IueCwgYm9uZUNvb3JkX1IueSwgYm9uZUNvb3JkX1IueiwgY2FtQWltX3gsIGNhbUFpbV95LCBjYW1BaW1feiwgMTAwLCB0cnVlLCB3ZWFwb25IYXNoLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSwgdHJ1ZSwgMTAwLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwKQogICAgZW5kCmVuZAoKLS0tLS0tLS3ljp/lipsKZnVuY3Rpb24gZ2V0X3BlZF9uZWFyYnlfdmVoaWNsZXMocGVkLCBtYXhWZWhpY2xlcykKCW1heFZlaGljbGVzID0gbWF4VmVoaWNsZXMgb3IgMTYKCWxvY2FsIHBWZWhpY2xlTGlzdCA9IG1lbW9yeS5hbGxvYygobWF4VmVoaWNsZXMgKyAxKSAqIDgpCgltZW1vcnkud3JpdGVfaW50KHBWZWhpY2xlTGlzdCwgbWF4VmVoaWNsZXMpCglsb2NhbCB2ZWhpY2xlc0xpc3QgPSB7fQoJZm9yIGkgPSAxLCBQRUQuR0VUX1BFRF9ORUFSQllfVkVISUNMRVMocGVkLCBwVmVoaWNsZUxpc3QpIGRvCgkJdmVoaWNsZXNMaXN0W2ldID0gbWVtb3J5LnJlYWRfaW50KHBWZWhpY2xlTGlzdCArIGkqOCkKCWVuZAoJcmV0dXJuIHZlaGljbGVzTGlzdAplbmQKCgoKLS0tLS0tLeiDjOiXj+atpuWZqApmdW5jdGlvbiBhdHRhY2h3ZWFwb24oc3Bhd253ZWFwb24pCglpZiAoV0VBUE9OLkdFVF9XRUFQT05UWVBFX0dST1VQKEhVRDEuX0hVRF9XRUFQT05fV0hFRUxfR0VUX1NFTEVDVEVEX0hBU0gocGx5cGVkKCkpKSA9PSA0MTY2NzY1MDMpIG9yIChXRUFQT04uR0VUX1dFQVBPTlRZUEVfR1JPVVAoSFVEMS5fSFVEX1dFQVBPTl9XSEVFTF9HRVRfU0VMRUNURURfSEFTSChwbHlwZWQoKSkpID09IDY5MDM4OTYwMikgdGhlbgoJCUVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWShzcGF3bndlYXBvbiwgcGx5cGVkKCksIFBFRC5HRVRfUEVEX0JPTkVfSU5ERVgocGx5cGVkKCksIDB4MTkyQSksIDAuMTUsIDAsIDAuMTMsIDI3MCwgMCwgMCwgZmFsc2UsIHRydWUsIGZhbHNlLCBmYWxzZSwgMSwgdHJ1ZSwgMCkKCWVuZAoJaWYgKFdFQVBPTi5HRVRfV0VBUE9OVFlQRV9HUk9VUChIVUQxLl9IVURfV0VBUE9OX1dIRUVMX0dFVF9TRUxFQ1RFRF9IQVNIKHBseXBlZCgpKSkgPT0gLTcyODU1NTA1Mikgb3IgKFdFQVBPTi5HRVRfV0VBUE9OVFlQRV9HUk9VUChIVUQxLl9IVURfV0VBUE9OX1dIRUVMX0dFVF9TRUxFQ1RFRF9IQVNIKHBseXBlZCgpKSkgPT0gLTE2MDk1ODAwNjApIHRoZW4KCQlpZiAoSFVEMS5fSFVEX1dFQVBPTl9XSEVFTF9HRVRfU0VMRUNURURfSEFTSChwbHlwZWQoKSkgPT0gdXRpbC5qb2FhdCgid2VhcG9uX2JhdCIpKSB0aGVuCgkJCUVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWShzcGF3bndlYXBvbiwgcGx5cGVkKCksIFBFRC5HRVRfUEVEX0JPTkVfSU5ERVgocGx5cGVkKCksIDB4NjBGMiksIDAuMywgLTAuMTgsIC0wLjE1LCAwLCAzMDAsIDAsIGZhbHNlLCB0cnVlLCBmYWxzZSwgZmFsc2UsIDEsIHRydWUsIDApCgkJZW5kCgkJaWYgKEhVRDEuX0hVRF9XRUFQT05fV0hFRUxfR0VUX1NFTEVDVEVEX0hBU0gocGx5cGVkKCkpID09IHV0aWwuam9hYXQoIndlYXBvbl9jcm93YmFyIikpIHRoZW4KCQkJRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKHNwYXdud2VhcG9uLCBwbHlwZWQoKSwgUEVELkdFVF9QRURfQk9ORV9JTkRFWChwbHlwZWQoKSwgMHgxOTJBKSwgMC4yLCAwLCAwLjEzLCAwLCAyNzAsIDkwLCBmYWxzZSwgdHJ1ZSwgZmFsc2UsIGZhbHNlLCAxLCB0cnVlLCAwKQoJCWVuZAoJCWlmIChIVUQxLl9IVURfV0VBUE9OX1dIRUVMX0dFVF9TRUxFQ1RFRF9IQVNIKHBseXBlZCgpKSA9PSB1dGlsLmpvYWF0KCJ3ZWFwb25fYmF0dGxlYXhlIikpIHRoZW4KCQkJRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKHNwYXdud2VhcG9uLCBwbHlwZWQoKSwgUEVELkdFVF9QRURfQk9ORV9JTkRFWChwbHlwZWQoKSwgMHg2MEYyKSwgMC4yLCAtMC4xOCwgLTAuMSwgMCwgMzAwLCAwLCBmYWxzZSwgdHJ1ZSwgZmFsc2UsIGZhbHNlLCAxLCB0cnVlLCAwKQoJCWVuZAoJCWlmIChIVUQxLl9IVURfV0VBUE9OX1dIRUVMX0dFVF9TRUxFQ1RFRF9IQVNIKHBseXBlZCgpKSA9PSB1dGlsLmpvYWF0KCJ3ZWFwb25fZ29sZmNsdWIiKSkgdGhlbgoJCQlFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkoc3Bhd253ZWFwb24sIHBseXBlZCgpLCBQRUQuR0VUX1BFRF9CT05FX0lOREVYKHBseXBlZCgpLCAweDYwRjIpLCAwLjIsIC0wLjE4LCAtMC4xLCAwLCAzMDAsIDAsIGZhbHNlLCB0cnVlLCBmYWxzZSwgZmFsc2UsIDEsIHRydWUsIDApCgkJZW5kCgkJaWYgKEhVRDEuX0hVRF9XRUFQT05fV0hFRUxfR0VUX1NFTEVDVEVEX0hBU0gocGx5cGVkKCkpID09IHV0aWwuam9hYXQoIndlYXBvbl9oYXRjaGV0IikpIHRoZW4KCQkJRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKHNwYXdud2VhcG9uLCBwbHlwZWQoKSwgUEVELkdFVF9QRURfQk9ORV9JTkRFWChwbHlwZWQoKSwgMHg2MEYyKSwgMC4yLCAtMC4xOCwgLTAuMSwgMCwgMzAwLCAwLCBmYWxzZSwgdHJ1ZSwgZmFsc2UsIGZhbHNlLCAxLCB0cnVlLCAwKQoJCWVuZAoJCWlmIChIVUQxLl9IVURfV0VBUE9OX1dIRUVMX0dFVF9TRUxFQ1RFRF9IQVNIKHBseXBlZCgpKSA9PSB1dGlsLmpvYWF0KCJ3ZWFwb25fcG9vbGN1ZSIpKSB0aGVuCgkJCUVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWShzcGF3bndlYXBvbiwgcGx5cGVkKCksIFBFRC5HRVRfUEVEX0JPTkVfSU5ERVgocGx5cGVkKCksIDB4NjBGMiksIC0wLjIsIC0wLjE4LCAwLjEsIDAsIDEyMCwgMCwgZmFsc2UsIHRydWUsIGZhbHNlLCBmYWxzZSwgMSwgdHJ1ZSwgMCkKCQllbmQKCQlpZiAoSFVEMS5fSFVEX1dFQVBPTl9XSEVFTF9HRVRfU0VMRUNURURfSEFTSChwbHlwZWQoKSkgPT0gdXRpbC5qb2FhdCgid2VhcG9uX3N0b25lX2hhdGNoZXQiKSkgdGhlbgoJCQlFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkoc3Bhd253ZWFwb24sIHBseXBlZCgpLCBQRUQuR0VUX1BFRF9CT05FX0lOREVYKHBseXBlZCgpLCAweDYwRjIpLCAwLjIsIC0wLjE4LCAtMC4xLCAwLCAzMDAsIDAsIGZhbHNlLCB0cnVlLCBmYWxzZSwgZmFsc2UsIDEsIHRydWUsIDApCgkJZW5kCgkJaWYgKEhVRDEuX0hVRF9XRUFQT05fV0hFRUxfR0VUX1NFTEVDVEVEX0hBU0gocGx5cGVkKCkpID09IHV0aWwuam9hYXQoIndlYXBvbl9rbnVja2xlIikpIHRoZW4KCQkJRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKHNwYXdud2VhcG9uLCBwbHlwZWQoKSwgUEVELkdFVF9QRURfQk9ORV9JTkRFWChwbHlwZWQoKSwgMHgxOTJBKSwgMC4yLCAwLCAwLjEzLCAwLCAyNzAsIDkwLCBmYWxzZSwgdHJ1ZSwgZmFsc2UsIGZhbHNlLCAxLCB0cnVlLCAwKQoJCWVuZAoJCWlmIG5vdCAoSFVEMS5fSFVEX1dFQVBPTl9XSEVFTF9HRVRfU0VMRUNURURfSEFTSChwbHlwZWQoKSkgPT0gdXRpbC5qb2FhdCgid2VhcG9uX2JhdCIpKSAgYW5kIG5vdCAoSFVEMS5fSFVEX1dFQVBPTl9XSEVFTF9HRVRfU0VMRUNURURfSEFTSChwbHlwZWQoKSkgPT0gdXRpbC5qb2FhdCgid2VhcG9uX2Nyb3diYXIiKSkgYW5kIG5vdCAoSFVEMS5fSFVEX1dFQVBPTl9XSEVFTF9HRVRfU0VMRUNURURfSEFTSChwbHlwZWQoKSkgPT0gdXRpbC5qb2FhdCgid2VhcG9uX2JhdHRsZWF4ZSIpKWFuZCBub3QgKEhVRDEuX0hVRF9XRUFQT05fV0hFRUxfR0VUX1NFTEVDVEVEX0hBU0gocGx5cGVkKCkpID09IHV0aWwuam9hYXQoIndlYXBvbl9nb2xmY2x1YiIpKSBhbmQgbm90IChIVUQxLl9IVURfV0VBUE9OX1dIRUVMX0dFVF9TRUxFQ1RFRF9IQVNIKHBseXBlZCgpKSA9PSB1dGlsLmpvYWF0KCJ3ZWFwb25faGF0Y2hldCIpKSBhbmQgbm90IChIVUQxLl9IVURfV0VBUE9OX1dIRUVMX0dFVF9TRUxFQ1RFRF9IQVNIKHBseXBlZCgpKSA9PSB1dGlsLmpvYWF0KCJ3ZWFwb25fcG9vbGN1ZSIpKSBhbmQgbm90IChIVUQxLl9IVURfV0VBUE9OX1dIRUVMX0dFVF9TRUxFQ1RFRF9IQVNIKHBseXBlZCgpKSA9PSB1dGlsLmpvYWF0KCJ3ZWFwb25fc3RvbmVfaGF0Y2hldCIpKSBhbmQgbm90IChIVUQxLl9IVURfV0VBUE9OX1dIRUVMX0dFVF9TRUxFQ1RFRF9IQVNIKHBseXBlZCgpKSA9PSB1dGlsLmpvYWF0KCJ3ZWFwb25fa251Y2tsZSIpKSB0aGVuCgkJCUVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWShzcGF3bndlYXBvbiwgcGx5cGVkKCksIFBFRC5HRVRfUEVEX0JPTkVfSU5ERVgocGx5cGVkKCksIDB4MTkyQSksIDAsIDAsIDAuMTMsIDAsIDkwLCAyNzAsIGZhbHNlLCB0cnVlLCBmYWxzZSwgZmFsc2UsIDEsIHRydWUsIDApCgkJZW5kCgllbmQKCWlmIChXRUFQT04uR0VUX1dFQVBPTlRZUEVfR1JPVVAoSFVEMS5fSFVEX1dFQVBPTl9XSEVFTF9HRVRfU0VMRUNURURfSEFTSChwbHlwZWQoKSkpID09IDE1NDg1MDcyNjcpIG9yIChXRUFQT04uR0VUX1dFQVBPTlRZUEVfR1JPVVAoSFVEMS5fSFVEX1dFQVBPTl9XSEVFTF9HRVRfU0VMRUNURURfSEFTSChwbHlwZWQoKSkpID09IC0zNzc4ODMwOCkgb3IgKFdFQVBPTi5HRVRfV0VBUE9OVFlQRV9HUk9VUChIVUQxLl9IVURfV0VBUE9OX1dIRUVMX0dFVF9TRUxFQ1RFRF9IQVNIKHBseXBlZCgpKSkgPT0gMTU5NTY2MjQ2MCkgdGhlbgkKCQlpZiAoSFVEMS5fSFVEX1dFQVBPTl9XSEVFTF9HRVRfU0VMRUNURURfSEFTSChwbHlwZWQoKSkgPT0gdXRpbC5qb2FhdCgid2VhcG9uX3BldHJvbGNhbiIpKSBvciAoSFVEMS5fSFVEX1dFQVBPTl9XSEVFTF9HRVRfU0VMRUNURURfSEFTSChwbHlwZWQoKSkgPT0gdXRpbC5qb2FhdCgid2VhcG9uX2hhemFyZGNhbiIpKSBvciAoSFVEMS5fSFVEX1dFQVBPTl9XSEVFTF9HRVRfU0VMRUNURURfSEFTSChwbHlwZWQoKSkgPT0gdXRpbC5qb2FhdCgid2VhcG9uX2ZlcnRpbGl6ZXJjYW4iKSkgdGhlbgoJCQlFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkoc3Bhd253ZWFwb24sIHBseXBlZCgpLCBQRUQuR0VUX1BFRF9CT05FX0lOREVYKHBseXBlZCgpLCAweDYwRjIpLCAwLCAtMC4xOCwgLTAsIDAsIDkwLCAwLCBmYWxzZSwgdHJ1ZSwgZmFsc2UsIGZhbHNlLCAxLCB0cnVlLCAwKQoJCWVuZAoJCWlmIChIVUQxLl9IVURfV0VBUE9OX1dIRUVMX0dFVF9TRUxFQ1RFRF9IQVNIKHBseXBlZCgpKSA9PSB1dGlsLmpvYWF0KCJ3ZWFwb25fcHJveG1pbmUiKSkgb3IgKEhVRDEuX0hVRF9XRUFQT05fV0hFRUxfR0VUX1NFTEVDVEVEX0hBU0gocGx5cGVkKCkpID09IHV0aWwuam9hYXQoIndlYXBvbl9zdGlja3lib21iIikpIHRoZW4KCQkJRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKHNwYXdud2VhcG9uLCBwbHlwZWQoKSwgUEVELkdFVF9QRURfQk9ORV9JTkRFWChwbHlwZWQoKSwgMHgxOTJBKSwgMC4yLCAwLCAwLjEzLCAwLCAwLCAyNzAsIGZhbHNlLCB0cnVlLCBmYWxzZSwgZmFsc2UsIDEsIHRydWUsIDApCgkJZW5kCgkJaWYgKEhVRDEuX0hVRF9XRUFQT05fV0hFRUxfR0VUX1NFTEVDVEVEX0hBU0gocGx5cGVkKCkpID09IHV0aWwuam9hYXQoIndlYXBvbl9maXJlZXh0aW5ndWlzaGVyIikpIHRoZW4KCQkJRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKHNwYXdud2VhcG9uLCBwbHlwZWQoKSwgUEVELkdFVF9QRURfQk9ORV9JTkRFWChwbHlwZWQoKSwgMHgxOTJBKSwgMCwgLTAuMDUsIDAuMTMsIDAsIDI3MCwgOTAsIGZhbHNlLCB0cnVlLCBmYWxzZSwgZmFsc2UsIDEsIHRydWUsIDApCgkJZW5kCgkJaWYgbm90IChIVUQxLl9IVURfV0VBUE9OX1dIRUVMX0dFVF9TRUxFQ1RFRF9IQVNIKHBseXBlZCgpKSA9PSB1dGlsLmpvYWF0KCJ3ZWFwb25fcGV0cm9sY2FuIikpIGFuZCBub3QgKEhVRDEuX0hVRF9XRUFQT05fV0hFRUxfR0VUX1NFTEVDVEVEX0hBU0gocGx5cGVkKCkpID09IHV0aWwuam9hYXQoIndlYXBvbl9oYXphcmRjYW4iKSkgYW5kIG5vdCAoSFVEMS5fSFVEX1dFQVBPTl9XSEVFTF9HRVRfU0VMRUNURURfSEFTSChwbHlwZWQoKSkgPT0gdXRpbC5qb2FhdCgid2VhcG9uX2ZlcnRpbGl6ZXJjYW4iKSkgYW5kIG5vdCAoSFVEMS5fSFVEX1dFQVBPTl9XSEVFTF9HRVRfU0VMRUNURURfSEFTSChwbHlwZWQoKSkgPT0gdXRpbC5qb2FhdCgid2VhcG9uX3Byb3htaW5lIikpIGFuZCBub3QgKEhVRDEuX0hVRF9XRUFQT05fV0hFRUxfR0VUX1NFTEVDVEVEX0hBU0gocGx5cGVkKCkpID09IHV0aWwuam9hYXQoIndlYXBvbl9zdGlja3lib21iIikpIGFuZCBub3QgKEhVRDEuX0hVRF9XRUFQT05fV0hFRUxfR0VUX1NFTEVDVEVEX0hBU0gocGx5cGVkKCkpID09IHV0aWwuam9hYXQoIndlYXBvbl9maXJlZXh0aW5ndWlzaGVyIikpIHRoZW4KCQkJRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKHNwYXdud2VhcG9uLCBwbHlwZWQoKSwgUEVELkdFVF9QRURfQk9ORV9JTkRFWChwbHlwZWQoKSwgMHgxOTJBKSwgMC4yLCAwLCAwLjEzLCAwLCAyNzAsIDI3MCwgZmFsc2UsIHRydWUsIGZhbHNlLCBmYWxzZSwgMSwgdHJ1ZSwgMCkKCQllbmQKCWVuZAoJaWYgbm90IChXRUFQT04uR0VUX1dFQVBPTlRZUEVfR1JPVVAoSFVEMS5fSFVEX1dFQVBPTl9XSEVFTF9HRVRfU0VMRUNURURfSEFTSChwbHlwZWQoKSkpID09IDQxNjY3NjUwMykgYW5kIG5vdCAoV0VBUE9OLkdFVF9XRUFQT05UWVBFX0dST1VQKEhVRDEuX0hVRF9XRUFQT05fV0hFRUxfR0VUX1NFTEVDVEVEX0hBU0gocGx5cGVkKCkpKSA9PSA2OTAzODk2MDIpIGFuZCBub3QgKFdFQVBPTi5HRVRfV0VBUE9OVFlQRV9HUk9VUChIVUQxLl9IVURfV0VBUE9OX1dIRUVMX0dFVF9TRUxFQ1RFRF9IQVNIKHBseXBlZCgpKSkgPT0gLTcyODU1NTA1MikgYW5kIG5vdCAoV0VBUE9OLkdFVF9XRUFQT05UWVBFX0dST1VQKEhVRDEuX0hVRF9XRUFQT05fV0hFRUxfR0VUX1NFTEVDVEVEX0hBU0gocGx5cGVkKCkpKSA9PSAtMTYwOTU4MDA2MCkgYW5kIG5vdCAoV0VBUE9OLkdFVF9XRUFQT05UWVBFX0dST1VQKEhVRDEuX0hVRF9XRUFQT05fV0hFRUxfR0VUX1NFTEVDVEVEX0hBU0gocGx5cGVkKCkpKSA9PSAxNTQ4NTA3MjY3KSBhbmQgbm90IChXRUFQT04uR0VUX1dFQVBPTlRZUEVfR1JPVVAoSFVEMS5fSFVEX1dFQVBPTl9XSEVFTF9HRVRfU0VMRUNURURfSEFTSChwbHlwZWQoKSkpID09IC0zNzc4ODMwOCkgYW5kIG5vdCAoV0VBUE9OLkdFVF9XRUFQT05UWVBFX0dST1VQKEhVRDEuX0hVRF9XRUFQT05fV0hFRUxfR0VUX1NFTEVDVEVEX0hBU0gocGx5cGVkKCkpKSA9PSAxNTk1NjYyNDYwKSB0aGVuCgkJRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKHNwYXdud2VhcG9uLCBwbHlwZWQoKSwgUEVELkdFVF9QRURfQk9ORV9JTkRFWChwbHlwZWQoKSwgMHg2MEYyKSwgMCwgLTAuMTgsIDAsIDE4MCwgMjIwLCAwLCBmYWxzZSwgdHJ1ZSwgZmFsc2UsIGZhbHNlLCAxLCB0cnVlLCAwKQoJZW5kCmVuZApmdW5jdGlvbiBwbHlwZWQoKQoJcmV0dXJuIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkKZW5kCgoKLS0tLemZhOWKoOaBtuaQnuaooeWeiwpmdW5jdGlvbiBBdHRhY2hkX1NlbGYoaW5kZXgpCiAgICBsb2NhbCBoYXNoID0gc3Bvb2ZfYXR0YWNoZC52YWx1ZVtpbmRleF0KICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgIGxvY2FsIG9iaiA9IGNyZWF0ZV9vYmplY3QoaGFzaCwgcG9zLngsIHBvcy55LCBwb3MueikKICAgIEVOVElUWS5TRVRfRU5USVRZX0hFQURJTkcob2JqLEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkpCiAgICBFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkob2JqLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCB0cnVlLCBmYWxzZSwgZmFsc2UsIHRydWUsIDAsIHRydWUsIDApCmVuZAoKCi0tLS0tLeWcsOavr+mjnuihjApmdW5jdGlvbiBjYXJwZXRyaWRlKHRvZ2dsZWQpCiAgICBjYXJwZXRyaWRlX3RvZ2dsZWQgPSB0b2dnbGVkCiAgICBpZiBjYXJwZXRyaWRlX3RvZ2dsZWQgdGhlbgogICAgICAgIGxvY2FsIG9iakhhc2ggPSB1dGlsLmpvYWF0KCJwX2NzX2JlYWNodG93ZWxfMDFfcyIpCiAgICAgICAgcmVxdWVzdF9tb2RlbChvYmpIYXNoKQogICAgICAgIHJlcXVlc3RfYW5pbV9kaWN0KCJyY21jb2xsZWN0X3BhcGVybGVhZGlub3V0QCIpCiAgICAgICAgbG9jYWwgbG9jYWxQZWQgPSBQTEFZRVIuUExBWUVSX1BFRF9JRCgpCiAgICAgICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKGxvY2FsUGVkLCBmYWxzZSkKICAgICAgICBUQVNLLkNMRUFSX1BFRF9UQVNLU19JTU1FRElBVEVMWShsb2NhbFBlZCkKICAgICAgICBjYXJwZXRfb2JqZWN0ID0gZW50aXRpZXMuY3JlYXRlX29iamVjdChvYmpIYXNoLCBwb3MpCiAgICAgICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKGxvY2FsUGVkLCBjYXJwZXRfb2JqZWN0LCAwLCAwLCAtMC4yLCAxLjAsIDEuMCwgMS4wLDEsIGZhbHNlLCB0cnVlLCBmYWxzZSwgZmFsc2UsIDAsIHRydWUsIDApCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09NUExFVEVMWV9ESVNBQkxFX0NPTExJU0lPTihjYXJwZXRfb2JqZWN0LCBmYWxzZSwgZmFsc2UpCiAgICAgICAgVEFTSy5UQVNLX1BMQVlfQU5JTShsb2NhbFBlZCwgInJjbWNvbGxlY3RfcGFwZXJsZWFkaW5vdXRAIiwgIm1lZGl0aWF0ZV9pZGxlIiwgOC4wLCAtOC4wLCAtMSwgMSwgMC4wLCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgZW5kCiAgICB3aGlsZSBjYXJwZXRyaWRlX3RvZ2dsZWQgZG8KICAgICAgICBsb2NhbCBvYmpQb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoY2FycGV0X29iamVjdCwgZmFsc2UpCiAgICAgICAgbG9jYWwgY2Ftcm90ID0gQ0FNLkdFVF9HQU1FUExBWV9DQU1fUk9UKDApCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04oY2FycGV0X29iamVjdCwgMCwgMCwgY2Ftcm90LnosIDAsIHRydWUpCiAgICAgICAgbG9jYWwgZm9yd2FyZFYgPSBFTlRJVFkuR0VUX0VOVElUWV9GT1JXQVJEX1ZFQ1RPUihQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgIGZvcndhcmRWLnogPSAwLjAKICAgICAgICBsb2NhbCBkZWx0YSA9IHYzLm5ldygwLCAwLCAwKQogICAgICAgIGxvY2FsIHNwZWVkID0gMC4yCiAgICAgICAgaWYgUEFELklTX0NPTlRST0xfUFJFU1NFRCgwLCA2MSkgdGhlbgogICAgICAgICAgICBzcGVlZCA9IDEuNQogICAgICAgIGVuZAogICAgICAgIGlmIFBBRC5JU19DT05UUk9MX1BSRVNTRUQoMCwgMzIpIHRoZW4KICAgICAgICAgICAgZGVsdGEgPSB2My5uZXcoZm9yd2FyZFYpCiAgICAgICAgICAgIGRlbHRhOm11bChzcGVlZCkKICAgICAgICBlbmQKICAgICAgICBpZiBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsIDEzMCkgIHRoZW4KICAgICAgICAgICAgZGVsdGEgPSB2My5uZXcoZm9yd2FyZFYpCiAgICAgICAgICAgIGRlbHRhOm11bCgtc3BlZWQpCiAgICAgICAgZW5kCiAgICAgICAgaWYgUEFELklTX0RJU0FCTEVEX0NPTlRST0xfUFJFU1NFRCgwLCAyMikgdGhlbgogICAgICAgICAgICBkZWx0YS56ID0gc3BlZWQKICAgICAgICBlbmQKICAgICAgICBpZiBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsIDM2KSB0aGVuCiAgICAgICAgICAgIGRlbHRhLnogPSAtc3BlZWQKICAgICAgICBlbmQKICAgICAgICBsb2NhbCBuZXdQb3MgPSB2My5uZXcob2JqUG9zKQogICAgICAgIG5ld1BvczphZGQoZGVsdGEpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTKGNhcnBldF9vYmplY3QsIG5ld1Bvcy54LG5ld1Bvcy55LG5ld1Bvcy56LCBmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAogICAgVEFTSy5DTEVBUl9QRURfVEFTS1NfSU1NRURJQVRFTFkoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgIEVOVElUWS5ERVRBQ0hfRU5USVRZKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUsIGZhbHNlKQogICAgZGVsZXRlX2VudGl0eShjYXJwZXRfb2JqZWN0KQplbmQKCgoKCgotLS0tLUNBUkdP5bSp5rqDCmZ1bmN0aW9uIENBUkdPKCkKICAgIGZvciBwaWQgPSAwLCAzMSBkbwogICAgICAgIGxvY2FsIGNzcHBlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICAgICAgbG9jYWwgVFBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoY3NwcGVkLCB0cnVlKQogICAgICAgIGxvY2FsIGNhcmdvYm9iID0gY3JlYXRlX3ZlaGljbGUoMFhGQ0ZDQjY4QiwgVFBwb3MueCwgVFBwb3MueSwgVFBwb3MueiwgRU5USVRZLkdFVF9FTlRJVFlfSEVBRElORyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKGNhcmdvYm9iLCB0cnVlKQogICAgICAgIGxvY2FsIGNhcmdvYm9iUG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKGNhcmdvYm9iLCB0cnVlKQogICAgICAgIGxvY2FsIHZlaCA9IGNyZWF0ZV92ZWhpY2xlKDBYMTg3RDkzOEQsIFRQcG9zLngsIFRQcG9zLnksIFRQcG9zLnosIEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRSh2ZWgsIHRydWUpCiAgICAgICAgbG9jYWwgdmVoUG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHZlaCwgdHJ1ZSkKICAgICAgICBsb2NhbCBuZXdSb3BlID0gUEhZU0lDUy5BRERfUk9QRShUUHBvcy54LCBUUHBvcy55LCBUUHBvcy56LCAwLCAwLCAxMCwgMSwgMSwgMC4wMDMwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMSwgMSwgMSwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgMS4wLCBmYWxzZSwgMCkKICAgICAgICBQSFlTSUNTLkFUVEFDSF9FTlRJVElFU19UT19ST1BFKG5ld1JvcGUsIGNhcmdvYm9iLCB2ZWgsIGNhcmdvYm9iUG9zLngsIGNhcmdvYm9iUG9zLnksIGNhcmdvYm9iUG9zLnosIHZlaFBvcy54LCB2ZWhQb3MueSwgdmVoUG9zLnosIDIsIGZhbHNlLCBmYWxzZSwgMCwgMCwgIkNlbnRlciIsICJDZW50ZXIiKQogICAgICAgIHV0aWwueWllbGQoMjUwMCkKICAgICAgICBkZWxldGVfZW50aXR5KGNhcmdvYm9iKQogICAgICAgIGRlbGV0ZV9lbnRpdHkodmVoKQogICAgICAgIFBIWVNJQ1MuREVMRVRFX0NISUxEX1JPUEUobmV3Um9wZSkKICAgIGVuZAplbmQKCgotLS0tLS0tLeejgeWKm+aeqgpmdW5jdGlvbiBkcmF3X21hcmtlcih0eXBlLCBwb3MsIHNjYWxlLCBjb2xvdXJkLCB0ZXh0dXJlRGljdCwgdGV4dHVyZU5hbWUpCgl0ZXh0dXJlRGljdCA9IHRleHR1cmVEaWN0Cgl0ZXh0dXJlTmFtZSA9IHRleHR1cmVOYW1lIG9yIDAKCUdSQVBISUNTLkRSQVdfTUFSS0VSKAoJCXR5cGUsCgkJcG9zLngsIHBvcy55LCBwb3MueiwKCQkwLjAsIDAuMCwgMC4wLAoJCTAuMCwgMC4wLCAwLjAsCgkJc2NhbGUsIHNjYWxlLCBzY2FsZSwKCQljb2xvdXJkLnIsIGNvbG91cmQuZywgY29sb3VyZC5iLCBjb2xvdXJkLmEsCgkJZmFsc2UsIGZhbHNlLCAwLCB0cnVlLCB0ZXh0dXJlRGljdCwgdGV4dHVyZU5hbWUsIGZhbHNlCgkpCmVuZApmdW5jdGlvbiByYWluYm93X2NvbG91cjEoY29sb3VyZCkKCWlmIGNvbG91cmQuciA+IDAgYW5kIGNvbG91cmQuYiA9PSAwIHRoZW4KCQljb2xvdXJkLnIgPSBjb2xvdXJkLnIgLSAxCgkJY29sb3VyZC5nID0gY29sb3VyZC5nICsgMQoJZW5kCgoJaWYgY29sb3VyZC5nID4gMCBhbmQgY29sb3VyZC5yID09IDAgdGhlbgoJCWNvbG91cmQuZyA9IGNvbG91cmQuZyAtIDEKCQljb2xvdXJkLmIgPSBjb2xvdXJkLmIgKyAxCgllbmQKCglpZiBjb2xvdXJkLmIgPiAwIGFuZCBjb2xvdXJkLmcgPT0gMCB0aGVuCgkJY29sb3VyZC5yID0gY29sb3VyZC5yICsgMQoJCWNvbG91cmQuYiA9IGNvbG91cmQuYiAtIDEKCWVuZAplbmQKbG9jYWwgbWFnc2VsZWN0ZWRPcHQgPSAxCmxvY2FsIG1hZ25jb2xvdXIgPSB7ciA9IDAsIGcgPSAyNTUsIGIgPSAyNTUsIGEgPSAyNTV9CmZ1bmN0aW9uIGNpbGlxaWFuZygpCiAgICBpZiBQTEFZRVIuSVNfUExBWUVSX0ZSRUVfQUlNSU5HKFBMQVlFUi5QTEFZRVJfSUQoKSkgdGhlbgogICAgICAgIGxvY2FsIG9mZnNldCA9IGdldF9vZmZzZXRfZnJvbV9jYW1lcmEoMzAuMCkKICAgICAgICByYWluYm93X2NvbG91cjEobWFnbmNvbG91cikKICAgICAgICBkcmF3X21hcmtlcigyOCwgb2Zmc2V0LCAwLjQsIG1hZ25jb2xvdXIpCgogICAgICAgIGZvciBfLCB2ZWhpY2xlIGluIGlwYWlycyhlbnRpdGllcy5nZXRfYWxsX3ZlaGljbGVzX2FzX2hhbmRsZXMoKSkgZG8KICAgICAgICAgICAgaWYgUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19VU0lORyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSB+PSB2ZWhpY2xlIHRoZW4KICAgICAgICAgICAgICAgIHJlcXVlc3RfY29udHJvbCh2ZWhpY2xlLCAwKS0t6Ziy5q2i6ZW/5pe26Ze06K+35rGCCiAgICAgICAgICAgICAgICBsb2NhbCB2ZWhpY2xlUG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHZlaGljbGUsIGZhbHNlKQogICAgICAgICAgICAgICAgbG9jYWwgdmVjdCA9IHYzLm5ldyhvZmZzZXQpCiAgICAgICAgICAgICAgICB2ZWN0OnN1Yih2ZWhpY2xlUG9zKQogICAgICAgICAgICAgICAgaWYgbWFnc2VsZWN0ZWRPcHQgPT0gMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfVkVMT0NJVFkodmVoaWNsZSwgdmVjdC54LHZlY3QueSx2ZWN0LnopCgogICAgICAgICAgICAgICAgZWxzZWlmIG1hZ3NlbGVjdGVkT3B0ID09IDIgdGhlbgogICAgICAgICAgICAgICAgICAgIHZlY3Q6bXVsKDAuNSkKICAgICAgICAgICAgICAgICAgICBFTlRJVFkuQVBQTFlfRk9SQ0VfVE9fRU5USVRZKHZlaGljbGUsIDEsIHZlY3QueCx2ZWN0LnksdmVjdC56LCAwLjAsIDAuMCwgMC41LCAwLCBmYWxzZSwgZmFsc2UsIHRydWUsIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQKZnVuY3Rpb24gc3pjbHEoaW5kZXgsIG1lbnVfbmFtZSwgcHJldl92YWx1ZSwgY2xpY2tfdHlwZSkKICAgIG1hZ3NlbGVjdGVkT3B0ID0gaW5kZXgKZW5kCgoKCgoKCi0tLS0tLeepuuiireaeqgpmdW5jdGlvbiBreHEoKQogICAgbG9jYWwgaGFzaCA9IHV0aWwuam9hYXQoIndlYXBvbl9haXJzdHJpa2Vfcm9ja2V0IikKCXJlcXVlc3Rfd2VhcG9uX2Fzc2V0KGhhc2gpCglsb2NhbCByYXljYXN0UmVzdWx0ID0gZ2V0X3JheWNhc3RfcmVzdWx0KDEwMDAuMCkKCWlmIHJheWNhc3RSZXN1bHQuZGlkSGl0IGFuZCBQRUQuSVNfUEVEX1NIT09USU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpIHRoZW4KCQlsb2NhbCBwb3MgPSByYXljYXN0UmVzdWx0LmVuZENvb3JkcwoJCU1JU0MuU0hPT1RfU0lOR0xFX0JVTExFVF9CRVRXRUVOX0NPT1JEUygKCQkJcG9zLngsIHBvcy55LCBwb3MueiArIDM1LjAsCgkJCXBvcy54LCBwb3MueSwgcG9zLnosCgkJCTIwMCwKCQkJdHJ1ZSwKCQkJaGFzaCwKCQkJUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSwgZmFsc2UsIDI1MDAuMAoJCSkKCWVuZAplbmQKCgotLS0tLeS8oOmAgeaeqgpsb2NhbCBmdW5jdGlvbiB3cml0ZV92ZWN0b3IzKGFkZHJlc3MsIHZlY3RvcikKCW1lbW9yeS53cml0ZV9mbG9hdChhZGRyZXNzICsgMHgwLCB2ZWN0b3IueCkKCW1lbW9yeS53cml0ZV9mbG9hdChhZGRyZXNzICsgMHg0LCB2ZWN0b3IueSkKCW1lbW9yeS53cml0ZV9mbG9hdChhZGRyZXNzICsgMHg4LCB2ZWN0b3IueikKZW5kCmxvY2FsIGZ1bmN0aW9uIHNldF9lbnRpdHlfY29vcmRzKGVudGl0eSwgY29vcmRzKQoJbG9jYWwgZndFbnRpdHkgPSBlbnRpdGllcy5oYW5kbGVfdG9fcG9pbnRlcihlbnRpdHkpCglsb2NhbCBDTmF2aWdhdGlvbiA9IG1lbW9yeS5yZWFkX2xvbmcoZndFbnRpdHkgKyAweDMwKQoJaWYgQ05hdmlnYXRpb24gfj0gMCB0aGVuCgkJd3JpdGVfdmVjdG9yMyhDTmF2aWdhdGlvbiArIDB4NTAsIGNvb3JkcykKCQl3cml0ZV92ZWN0b3IzKGZ3RW50aXR5ICsgMHg5MCwgY29vcmRzKQoJZW5kCmVuZApmdW5jdGlvbiBjc3EoKQogICAgbG9jYWwgcmF5Y2FzdFJlc3VsdCA9IGdldF9yYXljYXN0X3Jlc3VsdCgxMDAwLjApCglpZiAgcmF5Y2FzdFJlc3VsdC5kaWRIaXQgYW5kIFBFRC5JU19QRURfU0hPT1RJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgdGhlbgoJCWxvY2FsIGNvb3JkcyA9IHJheWNhc3RSZXN1bHQuZW5kQ29vcmRzCgkJaWYgbm90IFBFRC5JU19QRURfSU5fQU5ZX1ZFSElDTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpIHRoZW4KCQkJY29vcmRzLnogPSBjb29yZHMueiArIDEuMAoJCQlzZXRfZW50aXR5X2Nvb3JkcyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBjb29yZHMpCgkJZWxzZQoJCQlsb2NhbCB2ZWhpY2xlID0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19JTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKCQkJbG9jYWwgc3BlZWQgPSBFTlRJVFkuR0VUX0VOVElUWV9TUEVFRCh2ZWhpY2xlKQoJCQlFTlRJVFkuU0VUX0VOVElUWV9DT09SRFModmVoaWNsZSwgY29vcmRzLngsIGNvb3Jkcy55LCBjb29yZHMueiwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCgkJCUVOVElUWS5TRVRfRU5USVRZX0hFQURJTkcodmVoaWNsZSwgQ0FNLkdFVF9HQU1FUExBWV9DQU1fUk9UKDApLnopCgkJCVZFSElDTEUuU0VUX1ZFSElDTEVfRk9SV0FSRF9TUEVFRCh2ZWhpY2xlLCBzcGVlZCArIDMuMCkKCQllbmQKCWVuZAplbmQKCi0tLS3lgbfovabmnqoKZnVuY3Rpb24gc3RlYWxfY2FyX2d1bigpCiAgICBpZiBQRUQuSVNfUEVEX1NIT09USU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpIHRoZW4KICAgICAgICBsb2NhbCBlbnQgPSBnZXRfZW50aXR5X3BsYXllcl9pc19haW1pbmdfYXQoUExBWUVSLlBMQVlFUl9JRCgpKQogICAgICAgIGlmIEVOVElUWS5JU19FTlRJVFlfQV9WRUhJQ0xFKGVudCkgdGhlbgogICAgICAgICAgICBsb2NhbCBkcml2ZXIgPSBWRUhJQ0xFLkdFVF9QRURfSU5fVkVISUNMRV9TRUFUKGVudCwgLTEpCiAgICAgICAgICAgIGlmIFBFRC5JU19QRURfQV9QTEFZRVIoZHJpdmVyKSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBwaWQgPSBORVRXT1JLLk5FVFdPUktfR0VUX1BMQVlFUl9JTkRFWF9GUk9NX1BFRChkcml2ZXIpCiAgICAgICAgICAgICAgICBtZW51LnRyaWdnZXJfY29tbWFuZHMoInZlaGtpY2siLi4gcGxheWVycy5nZXRfbmFtZShwaWQpKQogICAgICAgICAgICBlbHNlaWYgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKGRyaXZlcikgYW5kIG5vdCBQRUQuSVNfUEVEX0FfUExBWUVSKGRyaXZlcikgdGhlbgogICAgICAgICAgICAgICAgcmVxdWVzdF9jb250cm9sKGRyaXZlcikKICAgICAgICAgICAgICAgIGRlbGV0ZV9lbnRpdHkoZHJpdmVyKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgUEVELlNFVF9QRURfSU5UT19WRUhJQ0xFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGVudCwgLTEpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgoKLS0tLS0t57+75rua5o2i5by5CmZ1bmN0aW9uIGZnaGQoKQogICAgaWYgVEFTSy5HRVRfSVNfVEFTS19BQ1RJVkUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgNCkgYW5kIFBBRC5JU19DT05UUk9MX1BSRVNTRUQoMiwgMjIpIGFuZCBub3QgUEVELklTX1BFRF9TSE9PVElORyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSB0aGVuCiAgICAgICAgdXRpbC55aWVsZCg5MDApCiAgICAgICAgV0VBUE9OLlJFRklMTF9BTU1PX0lOU1RBTlRMWShQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgZW5kCmVuZAoKCi0tLS3miYvmjIfmnqoKZnVuY3Rpb24gc2hvdXpoaXFpYW5nKCkKICAgIGZvciBpZCwgZGF0YSBpbiBwYWlycyh3ZWFwb25fc3R1ZmYpIGRvCiAgICAgICAgbWVudS50b2dnbGVfbG9vcChmaW5nZXJfdGhpbmcsIGRhdGFbMV0sIHt9LCAiIiwgZnVuY3Rpb24oKQogICAgICAgICAgICBsb2NhbCBoYXNoID0gdXRpbC5qb2FhdChkYXRhWzJdKQogICAgICAgICAgICByZXF1ZXN0X3dlYXBvbl9hc3NldChoYXNoKQogICAgICAgICAgICBpZiBpc19wbGF5ZXJfcG9pbnRpbmcoKSB0aGVuCiAgICAgICAgICAgICAgICBtZW1vcnkud3JpdGVfaW50KG1lbW9yeS5zY3JpcHRfZ2xvYmFsKDQ1MjE4MDEgKyA5MzcpLCBORVRXT1JLLkdFVF9ORVRXT1JLX1RJTUUoKSkgLS3npoHmraLliqjkvZznu5PmnZ8KICAgICAgICAgICAgICAgIGxvY2FsIGluc3QgPSB2My5uZXcoKQogICAgICAgICAgICAgICAgbG9jYWwgZmluYWxfcm90ID0gQ0FNLkdFVF9GSU5BTF9SRU5ERVJFRF9DQU1fUk9UKDIpCiAgICAgICAgICAgICAgICB2My5zZXQoaW5zdCwgZmluYWxfcm90LngsZmluYWxfcm90LnksZmluYWxfcm90LnopCiAgICAgICAgICAgICAgICBsb2NhbCB0bXAgPSB2My50b0RpcihpbnN0KQogICAgICAgICAgICAgICAgdjMuc2V0KGluc3QsIHYzLmdldCh0bXApKQogICAgICAgICAgICAgICAgdjMubXVsKGluc3QsIDEwMDApCiAgICAgICAgICAgICAgICBsb2NhbCBmaW5hbF9jb29yZCA9IENBTS5HRVRfRklOQUxfUkVOREVSRURfQ0FNX0NPT1JEKCkKICAgICAgICAgICAgICAgIHYzLnNldCh0bXAsIGZpbmFsX2Nvb3JkLngsZmluYWxfY29vcmQueSxmaW5hbF9jb29yZC56KQogICAgICAgICAgICAgICAgdjMuYWRkKGluc3QsIHRtcCkKICAgICAgICAgICAgICAgIGxvY2FsIHgsIHksIHogPSB2My5nZXQoaW5zdCkKICAgICAgICAgICAgICAgIGxvY2FsIGZpbmdlclBvcyA9IFBFRC5HRVRfUEVEX0JPTkVfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDB4ZmY5LCAxLjAsIDAsIDApCiAgICAgICAgICAgICAgICBNSVNDLlNIT09UX1NJTkdMRV9CVUxMRVRfQkVUV0VFTl9DT09SRFNfSUdOT1JFX0VOVElUWShmaW5nZXJQb3MueCwgZmluZ2VyUG9zLnksIGZpbmdlclBvcy56LCB4LCB5LCB6LCAxLCB0cnVlLCBoYXNoLCAwLCB0cnVlLCBmYWxzZSwgNTAwLjAsIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDApCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICB1dGlsLnlpZWxkKDEwMCkKICAgICAgICBlbmQpCiAgICBlbmQKZW5kCgoKLS0tLee7mOWItuWHveaVsAotLeWFiee6v+aKleW9sQpmdW5jdGlvbiBnZXRfcmF5Y2FzdF9yZXN1bHQoZGlzdCwgZmxhZykKCWxvY2FsIHJlc3VsdCA9IHt9CglmbGFnID0gZmxhZyBvciBUcmFjZUZsYWcuZXZlcnl0aGluZwoJbG9jYWwgZGlkSGl0ID0gbWVtb3J5LmFsbG9jKDEpCglsb2NhbCBlbmRDb29yZHMgPSB2My5uZXcoKQoJbG9jYWwgbm9ybWFsID0gdjMubmV3KCkKCWxvY2FsIGhpdEVudGl0eSA9IG1lbW9yeS5hbGxvY19pbnQoKQoJbG9jYWwgY2FtUG9zID0gQ0FNLkdFVF9GSU5BTF9SRU5ERVJFRF9DQU1fQ09PUkQoKQoJbG9jYWwgb2Zmc2V0ID0gZ2V0X29mZnNldF9mcm9tX2NhbWVyYShkaXN0KQoJbG9jYWwgaGFuZGxlID0gU0hBUEVURVNULlNUQVJUX0VYUEVOU0lWRV9TWU5DSFJPTk9VU19TSEFQRV9URVNUX0xPU19QUk9CRSgKCQljYW1Qb3MueCwgY2FtUG9zLnksIGNhbVBvcy56LAoJCW9mZnNldC54LCBvZmZzZXQueSwgb2Zmc2V0LnosCgkJZmxhZywKCQlQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCA3CgkpCglTSEFQRVRFU1QuR0VUX1NIQVBFX1RFU1RfUkVTVUxUKGhhbmRsZSwgZGlkSGl0LCBlbmRDb29yZHMsIG5vcm1hbCwgaGl0RW50aXR5KQoJcmVzdWx0LmRpZEhpdCA9IG1lbW9yeS5yZWFkX2J5dGUoZGlkSGl0KSB+PSAwCglyZXN1bHQuZW5kQ29vcmRzID0gZW5kQ29vcmRzCglyZXN1bHQuc3VyZmFjZU5vcm1hbCA9IG5vcm1hbAoJcmVzdWx0LmhpdEVudGl0eSA9IG1lbW9yeS5yZWFkX2ludChoaXRFbnRpdHkpCglyZXR1cm4gcmVzdWx0CmVuZApmdW5jdGlvbiBkcmF3X2xpbmUoc3RhcnQsIHRvLCBjb2xvdXJkKQoJR1JBUEhJQ1MuRFJBV19MSU5FKHN0YXJ0Lngsc3RhcnQueSxzdGFydC56LCB0by54LHRvLnksdG8ueiwgY29sb3VyZC5yLCBjb2xvdXJkLmcsIGNvbG91cmQuYiwgY29sb3VyZC5hKQplbmQKZnVuY3Rpb24gZHJhd19yZWN0KHBvczAsIHBvczEsIHBvczIsIHBvczMsIGNvbG91cmQpCglHUkFQSElDUy5EUkFXX1BPTFkocG9zMC54LCBwb3MwLnksIHBvczAueiwgcG9zMS54LCBwb3MxLnksIHBvczEueiwgcG9zMy54LCBwb3MzLnksIHBvczMueiwgY29sb3VyZC5yLCBjb2xvdXJkLmcsIGNvbG91cmQuYiwgY29sb3VyZC5hKQoJR1JBUEhJQ1MuRFJBV19QT0xZKHBvczMueCwgcG9zMy55LCBwb3MzLnosIHBvczIueCwgcG9zMi55LCBwb3MyLnosIHBvczAueCwgcG9zMC55LCBwb3MwLnosIGNvbG91cmQuciwgY29sb3VyZC5nLCBjb2xvdXJkLmIsIGNvbG91cmQuYSkKZW5kCmZ1bmN0aW9uIGRyYXdfYm91bmRpbmdfYm94KGVudGl0eSwgc2hvd1BvbHksIGNvbG91cmQpCglpZiBub3QgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKGVudGl0eSkgdGhlbgoJCXJldHVybgoJZW5kCgljb2xvdXJkID0gY29sb3VyZCBvciB7ciA9IDI1NSwgZyA9IDAsIGIgPSAwLCBhID0gMjU1fQoJbG9jYWwgbWluID0gdjMubmV3KCkKCWxvY2FsIG1heCA9IHYzLm5ldygpCglNSVNDLkdFVF9NT0RFTF9ESU1FTlNJT05TKEVOVElUWS5HRVRfRU5USVRZX01PREVMKGVudGl0eSksIG1pbiwgbWF4KQoJbWluOmFicygpOyBtYXg6YWJzKCkKCWxvY2FsIHVwcGVyTGVmdFJlYXIgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoZW50aXR5LCAtbWF4LngsIC1tYXgueSwgbWF4LnopCglsb2NhbCB1cHBlclJpZ2h0UmVhciA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhlbnRpdHksIG1pbi54LCAtbWF4LnksIG1heC56KQoJbG9jYWwgbG93ZXJMZWZ0UmVhciA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhlbnRpdHksIC1tYXgueCwgLW1heC55LCAtbWluLnopCglsb2NhbCBsb3dlclJpZ2h0UmVhciA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhlbnRpdHksIG1pbi54LCAtbWF4LnksIC1taW4ueikKCWRyYXdfbGluZSh1cHBlckxlZnRSZWFyLCB1cHBlclJpZ2h0UmVhciwgY29sb3VyZCkKCWRyYXdfbGluZShsb3dlckxlZnRSZWFyLCBsb3dlclJpZ2h0UmVhciwgY29sb3VyZCkKCWRyYXdfbGluZSh1cHBlckxlZnRSZWFyLCBsb3dlckxlZnRSZWFyLCBjb2xvdXJkKQoJZHJhd19saW5lKHVwcGVyUmlnaHRSZWFyLCBsb3dlclJpZ2h0UmVhciwgY29sb3VyZCkKCWxvY2FsIHVwcGVyTGVmdEZyb250ID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKGVudGl0eSwgLW1heC54LCBtaW4ueSwgbWF4LnopCglsb2NhbCB1cHBlclJpZ2h0RnJvbnQgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoZW50aXR5LCBtaW4ueCwgbWluLnksIG1heC56KQoJbG9jYWwgbG93ZXJMZWZ0RnJvbnQgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoZW50aXR5LCAtbWF4LngsIG1pbi55LCAtbWluLnopCglsb2NhbCBsb3dlclJpZ2h0RnJvbnQgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoZW50aXR5LCBtaW4ueCwgbWluLnksIC1taW4ueikKCWRyYXdfbGluZSh1cHBlckxlZnRGcm9udCwgdXBwZXJSaWdodEZyb250LCBjb2xvdXJkKQoJZHJhd19saW5lKGxvd2VyTGVmdEZyb250LCBsb3dlclJpZ2h0RnJvbnQsIGNvbG91cmQpCglkcmF3X2xpbmUodXBwZXJMZWZ0RnJvbnQsIGxvd2VyTGVmdEZyb250LCBjb2xvdXJkKQoJZHJhd19saW5lKHVwcGVyUmlnaHRGcm9udCwgbG93ZXJSaWdodEZyb250LCBjb2xvdXJkKQoJZHJhd19saW5lKHVwcGVyTGVmdFJlYXIsIHVwcGVyTGVmdEZyb250LCBjb2xvdXJkKQoJZHJhd19saW5lKHVwcGVyUmlnaHRSZWFyLCB1cHBlclJpZ2h0RnJvbnQsIGNvbG91cmQpCglkcmF3X2xpbmUobG93ZXJMZWZ0UmVhciwgbG93ZXJMZWZ0RnJvbnQsIGNvbG91cmQpCglkcmF3X2xpbmUobG93ZXJSaWdodFJlYXIsIGxvd2VyUmlnaHRGcm9udCwgY29sb3VyZCkKCWlmIHR5cGUoc2hvd1BvbHkpIH49ICJib29sZWFuIiBvciBzaG93UG9seSB0aGVuCgkJZHJhd19yZWN0KGxvd2VyTGVmdFJlYXIsIHVwcGVyTGVmdFJlYXIsIGxvd2VyTGVmdEZyb250LCB1cHBlckxlZnRGcm9udCwgY29sb3VyZCkKCQlkcmF3X3JlY3QodXBwZXJSaWdodFJlYXIsIGxvd2VyUmlnaHRSZWFyLCB1cHBlclJpZ2h0RnJvbnQsIGxvd2VyUmlnaHRGcm9udCwgY29sb3VyZCkKCQlkcmF3X3JlY3QobG93ZXJMZWZ0RnJvbnQsIHVwcGVyTGVmdEZyb250LCBsb3dlclJpZ2h0RnJvbnQsIHVwcGVyUmlnaHRGcm9udCwgY29sb3VyZCkKCQlkcmF3X3JlY3QodXBwZXJMZWZ0UmVhciwgbG93ZXJMZWZ0UmVhciwgdXBwZXJSaWdodFJlYXIsIGxvd2VyUmlnaHRSZWFyLCBjb2xvdXJkKQoJCWRyYXdfcmVjdCh1cHBlclJpZ2h0UmVhciwgdXBwZXJSaWdodEZyb250LCB1cHBlckxlZnRSZWFyLCB1cHBlckxlZnRGcm9udCwgY29sb3VyZCkKCQlkcmF3X3JlY3QobG93ZXJSaWdodEZyb250LCBsb3dlclJpZ2h0UmVhciwgbG93ZXJMZWZ0RnJvbnQsIGxvd2VyTGVmdFJlYXIsIGNvbG91cmQpCgllbmQKZW5kCgoKLS3liKTmlq3mmK/lkKbmjIflkJEKZnVuY3Rpb24gaXNfcGxheWVyX3BvaW50aW5nKCkgLS0tLVVwZGF0ZSB0YWcoMS42OSkKICAgIC0tZnJlZW1vZGUuYyBbLy9TVFJFQU1JTkc6OlJFUVVFU1RfQU5JTV9ESUNUKCJhbmltQG1wX3BvaW50IildCiAgICByZXR1cm4gbWVtb3J5LnJlYWRfaW50KG1lbW9yeS5zY3JpcHRfZ2xvYmFsKDQ1MjE4MDEgKyA5MzItLVtbICsyIF1dKSkgPT0gMwplbmQKCgotLS0t56We5oyHCmxvY2FsIHRhcmdldEVudGl0eSA9IE5VTEwKbG9jYWwgZXhwbG9zaW9uUHJvb2YgPSBmYWxzZQpmdW5jdGlvbiBnb2RmaW5nZXIoKQogICAgLS3lh4bmmJ8KICAgIEhVRC5ESVNQTEFZX1NOSVBFUl9TQ09QRV9USElTX0ZSQU1FKCkKICAgIGlmIGlzX3BsYXllcl9wb2ludGluZygpIHRoZW4KICAgICAgICBtZW1vcnkud3JpdGVfaW50KG1lbW9yeS5zY3JpcHRfZ2xvYmFsKDQ1MjE4MDEgKyA5MzctLVtbICsyIF1dKSwgTkVUV09SSy5HRVRfTkVUV09SS19USU1FKCkpIC0t56aB5q2i5Yqo5L2c57uT5p2fCgkJaWYgbm90IEVOVElUWS5ET0VTX0VOVElUWV9FWElTVCh0YXJnZXRFbnRpdHkpIHRoZW4KCQkJbG9jYWwgZmxhZyA9IFRyYWNlRmxhZy5wZWRzIHwgVHJhY2VGbGFnLnZlaGljbGVzIHwgVHJhY2VGbGFnLnBlZHNTaW1wbGVDb2xsaXNpb24gfCBUcmFjZUZsYWcub2JqZWN0cwoJCQlsb2NhbCByYXljYXN0UmVzdWx0ID0gZ2V0X3JheWNhc3RfcmVzdWx0KDUwMC4wLCBmbGFnKQoJCQlpZiByYXljYXN0UmVzdWx0LmRpZEhpdCBhbmQgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKHJheWNhc3RSZXN1bHQuaGl0RW50aXR5KSB0aGVuCgkJCQl0YXJnZXRFbnRpdHkgPSByYXljYXN0UmVzdWx0LmhpdEVudGl0eQoJCQllbmQKCQllbHNlCgoJCQlsb2NhbCBteVBvcyA9IHBsYXllcnMuZ2V0X3Bvc2l0aW9uKFBMQVlFUi5QTEFZRVJfSUQoKSkKCQkJbG9jYWwgZW50aXR5UG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHRhcmdldEVudGl0eSwgdHJ1ZSkKCQkJbG9jYWwgY2FtRGlyID0gQ0FNLkdFVF9HQU1FUExBWV9DQU1fUk9UKDApOnRvRGlyKCkKCQkJbG9jYWwgZGlzdGFuY2UgPSBteVBvczpkaXN0YW5jZShlbnRpdHlQb3MpCgkJCWlmIGRpc3RhbmNlID4gMzAuMCB0aGVuIGRpc3RhbmNlID0gMzAuMAoJCQllbHNlaWYgZGlzdGFuY2UgPCAxMC4wIHRoZW4gZGlzdGFuY2UgPSAxMC4wIGVuZAoJCQlsb2NhbCB0YXJnZXRQb3MgPSB2My5uZXcoY2FtRGlyKQoJCQl0YXJnZXRQb3M6bXVsKGRpc3RhbmNlKQoJCQl0YXJnZXRQb3M6YWRkKG15UG9zKQoJCQlsb2NhbCBkaXJlY3Rpb24gPSB2My5uZXcodGFyZ2V0UG9zKQoJCQlkaXJlY3Rpb246c3ViKGVudGl0eVBvcykKCQkJZGlyZWN0aW9uOm5vcm1hbGlzZSgpCgkJCWlmIEVOVElUWS5JU19FTlRJVFlfQV9QRUQodGFyZ2V0RW50aXR5KSB0aGVuCgkJCQlkaXJlY3Rpb246bXVsKDUuMCkKCQkJCWxvY2FsIGV4cGxvc2lvblBvcyA9IHYzLm5ldyhlbnRpdHlQb3MpCgkJCQlleHBsb3Npb25Qb3M6c3ViKGRpcmVjdGlvbikKCQkJCWRyYXdfYm91bmRpbmdfYm94KHRhcmdldEVudGl0eSwgZmFsc2UsIHtyID0gMjU1LCBnID0gMjU1LCBiID0gMjU1LCBhID0gMjU1fSkKCQkJCXNldF9leHBsb3Npb25fcHJvb2YoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSkKCQkJCWV4cGxvc2lvblByb29mID0gdHJ1ZQoJCQkJRklSRS5BRERfRVhQTE9TSU9OKGV4cGxvc2lvblBvcy54LCBleHBsb3Npb25Qb3MueSwgZXhwbG9zaW9uUG9zLnosIDI5LCAyNS4wLCBmYWxzZSwgdHJ1ZSwgMC4wLCB0cnVlKQoJCQllbHNlCgkJCQlsb2NhbCB2ZWwgPSB2My5uZXcoZGlyZWN0aW9uKQoJCQkJbG9jYWwgbWFnbml0dWRlID0gZW50aXR5UG9zOmRpc3RhbmNlKHRhcmdldFBvcykKCQkJCXZlbDptdWwobWFnbml0dWRlKQoJCQkJZHJhd19ib3VuZGluZ19ib3godGFyZ2V0RW50aXR5LCB0cnVlLCB7ciA9IDI1NSwgZyA9IDI1NSwgYiA9IDI1NSwgYSA9IDgwfSkKCQkJCXJlcXVlc3RfY29udHJvbCh0YXJnZXRFbnRpdHkpCgkJCQlFTlRJVFkuU0VUX0VOVElUWV9WRUxPQ0lUWSh0YXJnZXRFbnRpdHksIHZlbC54LCB2ZWwueSwgdmVsLnopCgkJCWVuZAoJCWVuZAoJZWxzZWlmIHRhcmdldEVudGl0eSB+PSBOVUxMIHRoZW4KCQl0aW1lci5yZXNldCgpCgkJdGFyZ2V0RW50aXR5ID0gTlVMTAoJZWxzZWlmIGV4cGxvc2lvblByb29mIGFuZCB0aW1lci5lbGFwc2VkKCkgPiA1MDAgdGhlbgoJCWV4cGxvc2lvblByb29mID0gZmFsc2UKCQlzZXRfZXhwbG9zaW9uX3Byb29mKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKQogICAgZW5kCmVuZAoKCgotLS0t5YiH56KOCmZ1bmN0aW9uIEZpbmVseV9jaG9wcGVkKHBpZCkKICAgIAogICAgbG9jYWwgdGFyZ2V0X3BlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICBsb2NhbCBjb29yZHMgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFModGFyZ2V0X3BlZCwgZmFsc2UpCiAgICBjb29yZHMueiA9IGNvb3Jkc1sneiddKzIuNQogICAgbG9jYWwgaGFzaCA9IHV0aWwuam9hYXQoImJ1enphcmQiKQogICAgcmVxdWVzdF9tb2RlbChoYXNoKQogICAgbG9jYWwgaGVsaSA9IGVudGl0aWVzLmNyZWF0ZV92ZWhpY2xlKGhhc2gsIGNvb3JkcywgRU5USVRZLkdFVF9FTlRJVFlfSEVBRElORyh0YXJnZXRfcGVkKSkKICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRU5HSU5FX09OKGhlbGksIHRydWUsIHRydWUsIGZhbHNlKQogICAgVkVISUNMRS5TRVRfSEVMSV9CTEFERVNfRlVMTF9TUEVFRChoZWxpKQogICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRShoZWxpLCB0cnVlKQogICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04oaGVsaSwgdHJ1ZSkKICAgIEVOVElUWS5TRVRfRU5USVRZX0NPTVBMRVRFTFlfRElTQUJMRV9DT0xMSVNJT04oaGVsaSwgdHJ1ZSwgdHJ1ZSkKICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKGhlbGksIDE4MCwgMC4wLCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKHRhcmdldF9wZWQpLCAxLCB0cnVlKQogICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTX05PX09GRlNFVChoZWxpLCBjb29yZHMueCwgY29vcmRzLnksIGNvb3Jkcy56LCB0cnVlLCBmYWxzZSwgZmFsc2UpCiAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0VOR0lORV9PTihoZWxpLCB0cnVlLCB0cnVlLCB0cnVlKQogICAgdXRpbC55aWVsZCgzMDAwKQogICAgZGVsZXRlX2VudGl0eShoZWxpKQplbmQKCgotLS0t5YS/56ul6ZSBCmZ1bmN0aW9uIENoaWxkX0xvY2sob24scGlkKQogICAgdXNpbmdDaGlsZExvY2sgPSBvbgogICAgaWYgbm90IHVzaW5nQ2hpbGRMb2NrIHRoZW4gcmV0dXJuIGVuZAogICAgCiAgICB3aGlsZSB1c2luZ0NoaWxkTG9jayBhbmQgTkVUV09SSy5ORVRXT1JLX0lTX1BMQVlFUl9BQ1RJVkUocGlkKSBhbmQgbm90IHV0aWwuaXNfc2Vzc2lvbl90cmFuc2l0aW9uX2FjdGl2ZSgpIGRvCiAgICAgICAgbG9jYWwgdmVoaWNsZSA9IGdldF92ZWhpY2xlX3BsYXllcl9pc19pbihwaWQpCiAgICAgICAgaWYgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKHZlaGljbGUpIGFuZCByZXF1ZXN0X2NvbnRyb2wodmVoaWNsZSwgMykgdGhlbgogICAgICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0RPT1JTX0xPQ0tFRCh2ZWhpY2xlLCA0KQogICAgICAgIGVuZAogICAgICAgIHV0aWwueWllbGRfb25jZSgpCiAgICBlbmQKICAgIGxvY2FsIHZlaGljbGUgPSBnZXRfdmVoaWNsZV9wbGF5ZXJfaXNfaW4ocGlkKQogICAgaWYgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKHZlaGljbGUpIGFuZCByZXF1ZXN0X2NvbnRyb2wodmVoaWNsZSwgMykgdGhlbgogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRE9PUlNfTE9DS0VEKHZlaGljbGUsIDEpCiAgICBlbmQKZW5kCgotLS0t6Lmm5bqKCmZ1bmN0aW9uIHRyYW1wb2xpbmUoKQogICAgaWYgUEVELklTX1BFRF9JTl9BTllfVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkgdGhlbgogICAgICAgIGlmIEVOVElUWS5JU19FTlRJVFlfSU5fV0FURVIoZW50aXRpZXMuZ2V0X3VzZXJfdmVoaWNsZV9hc19oYW5kbGUoZmFsc2UpKSB0aGVuCiAgICAgICAgICAgIGxvY2FsIHZlbCA9IHYzLm5ldyhFTlRJVFkuR0VUX0VOVElUWV9WRUxPQ0lUWShlbnRpdGllcy5nZXRfdXNlcl92ZWhpY2xlX2FzX2hhbmRsZShmYWxzZSkpKQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9WRUxPQ0lUWShlbnRpdGllcy5nZXRfdXNlcl92ZWhpY2xlX2FzX2hhbmRsZShmYWxzZSksIHZlbC54LCB2ZWwueSwgMTUpCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgaWYgRU5USVRZLklTX0VOVElUWV9JTl9XQVRFUihQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSB0aGVuCiAgICAgICAgICAgIGxvY2FsIHZlbCA9IHYzLm5ldyhFTlRJVFkuR0VUX0VOVElUWV9WRUxPQ0lUWShlbnRpdGllcy5nZXRfdXNlcl92ZWhpY2xlX2FzX2hhbmRsZShmYWxzZSkpKQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9WRUxPQ0lUWShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB2ZWwueCwgdmVsLnksIDE1KQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKLS0tLeeBq+eureS6ugpmdW5jdGlvbiBSb2NrZXRfTWFuKCkKICAgIFBFRC5TRVRfUEVEX1RPX1JBR0RPTEwoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMjUwMCwgMCwgMCwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgIGxvY2FsIGZvcmNlcyA9IHsxMCwgMTUsIDIwLCAyMCwgMjAsIDEwLCAxMCwgMTAsIDEwLCAxMCwgMTB9CiAgICBsb2NhbCBkZWxheXMgPSB7MTAwMCwgOTAwLCA4MDAsIDcwMCwgNjAwLCA1MDAsIDQwMCwgMzAwLCAyMDAsIDE3NSwgMTI1fQogICAgZm9yIGkgPSAxLCAjZm9yY2VzIGRvCiAgICAgICAgRU5USVRZLkFQUExZX0ZPUkNFX1RPX0VOVElUWShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAzLCAwLjAsIDAuMCwgZm9yY2VzW2ldLCAwLjAsIDAuMCwgMC4wLCAwLCBmYWxzZSwgZmFsc2UsIHRydWUsIGZhbHNlLCBmYWxzZSkKICAgICAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgICAgICByZXF1ZXN0X3B0ZnhfYXNzZXQoImN1dF94bTMiKQogICAgICAgIEdSQVBISUNTLlVTRV9QQVJUSUNMRV9GWF9BU1NFVCgiY3V0X3htMyIpCiAgICAgICAgR1JBUEhJQ1MuU1RBUlRfTkVUV09SS0VEX1BBUlRJQ0xFX0ZYX05PTl9MT09QRURfQVRfQ09PUkQoImN1dF94bTNfcnBnX2V4cGxvc2lvbiIsIHBvcy54LCBwb3MueSwgcG9zLnotMC41LCAwLCAwLCAwLCAxLjAsIHRydWUsIHRydWUsIHRydWUpCiAgICAgICAgQVVESU8uUExBWV9TT1VORF9GUk9NX0VOVElUWSgtMSwgIkJvbWJfQ291bnRkb3duX0JlZXAiLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAiRExDX01QU1VNMl9VTFAyX1JvZ3VlX0Ryb25lcyIsIHRydWUsIDApCiAgICAgICAgdXRpbC55aWVsZChkZWxheXNbaV0pCiAgICBlbmQKICAgIGZvciBpID0gMSwgMiBkbwogICAgICAgIGxvY2FsIGRlbGF5ID0gdXRpbC5jdXJyZW50X3RpbWVfbWlsbGlzKCkgKyA1MDAKICAgICAgICByZXBlYXQKICAgICAgICAgICAgRU5USVRZLkFQUExZX0ZPUkNFX1RPX0VOVElUWShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAzLCAwLjAsIDAuMCwgMTAsIDAuMCwgMC4wLCAwLjAsIDAsIGZhbHNlLCBmYWxzZSwgdHJ1ZSwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgICAgICAgICAgcmVxdWVzdF9wdGZ4X2Fzc2V0KCJjdXRfeG0zIikKICAgICAgICAgICAgR1JBUEhJQ1MuVVNFX1BBUlRJQ0xFX0ZYX0FTU0VUKCJjdXRfeG0zIikKICAgICAgICAgICAgR1JBUEhJQ1MuU1RBUlRfTkVUV09SS0VEX1BBUlRJQ0xFX0ZYX05PTl9MT09QRURfQVRfQ09PUkQoImN1dF94bTNfcnBnX2V4cGxvc2lvbiIsIHBvcy54LCBwb3MueSwgcG9zLnotMC41LCAwLCAwLCAwLCAxLjAsIHRydWUsIHRydWUsIHRydWUpCiAgICAgICAgICAgIEFVRElPLlBMQVlfU09VTkRfRlJPTV9FTlRJVFkoLTEsICJCb21iX0NvdW50ZG93bl9CZWVwIiwgUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgIkRMQ19NUFNVTTJfVUxQMl9Sb2d1ZV9Ecm9uZXMiLCB0cnVlLCAwKQogICAgICAgICAgICB1dGlsLnlpZWxkKGkgPT0gMSBhbmQgMTAwIG9yIDEwKQogICAgICAgIHVudGlsIGRlbGF5IDw9IHV0aWwuY3VycmVudF90aW1lX21pbGxpcygpCiAgICBlbmQKICAgIEFVRElPLlBMQVlfU09VTkRfRlJPTV9FTlRJVFkoLTEsICJCb21iX0RldG9uYXRlIiwgUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgIkRMQ19NUFNVTTJfVUxQMl9Sb2d1ZV9Ecm9uZXMiLCB0cnVlLCAwKQogICAgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICByZXF1ZXN0X3B0ZnhfYXNzZXQoInNjcl94bV9vcmJpdGFsIikKICAgIEdSQVBISUNTLlVTRV9QQVJUSUNMRV9GWF9BU1NFVCgic2NyX3htX29yYml0YWwiKQogICAgR1JBUEhJQ1MuU1RBUlRfTkVUV09SS0VEX1BBUlRJQ0xFX0ZYX05PTl9MT09QRURfQVRfQ09PUkQoInNjcl94bV9vcmJpdGFsX2JsYXN0IiwgcG9zLngsIHBvcy55LCBwb3MueiwgMCwgMTgwLCAwLCAxLjAsIHRydWUsIHRydWUsIHRydWUpCiAgICBTVFJFQU1JTkcuUkVNT1ZFX05BTUVEX1BURlhfQVNTRVQoImN1dF94bTMiKQogICAgU1RSRUFNSU5HLlJFTU9WRV9OQU1FRF9QVEZYX0FTU0VUKCJzY3JfeG1fb3JiaXRhbCIpCmVuZAoKCgotLS0t56ys5LqM6YOo5YiGCgotLS0t5aSN5Yi25pyN6aWwCmZ1bmN0aW9uIGdldF9vdXRmaXQocGVkKQogICAgbG9jYWwgb3V0Zml0ID0ge2NvbXBvbmVudHMgPSB7fSwgcHJvcHMgPSB7fX0KICAgIGZvciBpID0gMCwgMTEgZG8KICAgICAgICBvdXRmaXQuY29tcG9uZW50c1tpXSA9IHsKICAgICAgICAgICAgUEVELkdFVF9QRURfRFJBV0FCTEVfVkFSSUFUSU9OKHBlZCwgaSksIAogICAgICAgICAgICBQRUQuR0VUX1BFRF9URVhUVVJFX1ZBUklBVElPTihwZWQsIGkpCiAgICAgICAgfQogICAgZW5kCiAgICBmb3IgaSA9IDAsIDkgZG8KICAgICAgICBvdXRmaXQucHJvcHNbaV0gPSB7CiAgICAgICAgICAgIFBFRC5HRVRfUEVEX1BST1BfSU5ERVgocGVkLCBpKSwKICAgICAgICAgICAgUEVELkdFVF9QRURfUFJPUF9URVhUVVJFX0lOREVYKHBlZCwgaSkKICAgICAgICB9CiAgICBlbmQKICAgIHJldHVybiBvdXRmaXQKZW5kCmZ1bmN0aW9uIGFwcGx5X291dGZpdChjb21wb25lbnRzLCBwcm9wcykKICAgIGZvciBrLCB2IGluIHBhaXJzKGNvbXBvbmVudHMpIGRvCiAgICAgICAgUEVELlNFVF9QRURfQ09NUE9ORU5UX1ZBUklBVElPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0b251bWJlcihrKSwgdlsxXSwgdlsyXSwgMCkKICAgIGVuZAogICAgZm9yIGssIHYgaW4gcGFpcnMocHJvcHMpIGRvCiAgICAgICAgaWYgdlsxXSA9PSAtMSB0aGVuCiAgICAgICAgICAgIFBFRC5DTEVBUl9QRURfUFJPUChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0b251bWJlcihrKSkKICAgICAgICBlbHNlCiAgICAgICAgICAgIFBFRC5TRVRfUEVEX1BST1BfSU5ERVgoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdG9udW1iZXIoayksIHZbMV0sIHZbMl0sIHRydWUpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCmZ1bmN0aW9uIGNvcHlfb3V0Zml0KHBpZCkKICAgIGlmIE5FVFdPUksuTkVUV09SS19JU19QTEFZRVJfQ09OTkVDVEVEKHBpZCkgPT0gMCB0aGVuIHJldHVybiBlbmQKICAgIGxvY2FsIHBlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICBsb2NhbCBtb2RlbCA9IEVOVElUWS5HRVRfRU5USVRZX01PREVMKHBlZCkKICAgIGxvY2FsIG91dGZpdCA9IGdldF9vdXRmaXQocGVkKQogICAgaWYgbW9kZWwgfj0gRU5USVRZLkdFVF9FTlRJVFlfTU9ERUwoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgdGhlbgogICAgICAgIGNoYW5nZV9tb2RlbChQTEFZRVIuUExBWUVSX0lEKCksIG1vZGVsKQogICAgICAgIFBFRDEuX1NFVF9QRURfRVlFX0NPTE9SKFBMQVlFUi5QTEFZRVJfSUQoKSwgUEVEMS5fR0VUX1BFRF9FWUVfQ09MT1IocGVkKSkKICAgICAgICBmb3IgaSA9IDAsIDEyIGRvCiAgICAgICAgICAgIFBFRC5TRVRfUEVEX0hFQURfT1ZFUkxBWShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBpLCBQRUQxLl9HRVRfUEVEX0hFQURfT1ZFUkxBWV9WQUxVRShwZWQsIGkpLCAwKQogICAgICAgIGVuZAogICAgICAgIGFwcGx5X291dGZpdChvdXRmaXQuY29tcG9uZW50cywgb3V0Zml0LnByb3BzKQogICAgZWxzZQogICAgICAgIGFwcGx5X291dGZpdChvdXRmaXQuY29tcG9uZW50cywgb3V0Zml0LnByb3BzKQogICAgZW5kCmVuZAoKLS0tLeWkjeWItui9veWFtwpmdW5jdGlvbiBnZXRfdmVoaWNsZV9pbmZvKHZlaGljbGUpCiAgICBsb2NhbCBvdXRUYWJsZSA9IHt9CiAgICBvdXRUYWJsZVsnaGFzaCddID0gRU5USVRZLkdFVF9FTlRJVFlfTU9ERUwodmVoaWNsZSkKICAgIG91dFRhYmxlWyd3aGVlbFR5cGUnXSA9IFZFSElDTEUuR0VUX1ZFSElDTEVfV0hFRUxfVFlQRSh2ZWhpY2xlKQogICAgb3V0VGFibGVbJ21vZHMnXSA9IHt9CiAgICBmb3IgaSA9IDAsIDQ5IGRvCiAgICAgICAgb3V0VGFibGVbJ21vZHMnXVtpXSA9IFZFSElDTEUuR0VUX1ZFSElDTEVfTU9EKHZlaGljbGUsIGkpCiAgICBlbmQKICAgIG91dFRhYmxlWyd0eXJlc0NhbkJ1cnN0J10gPSBWRUhJQ0xFLkdFVF9WRUhJQ0xFX1RZUkVTX0NBTl9CVVJTVCh2ZWhpY2xlKSA9PSAxCiAgICBsb2NhbCBwUiwgcEcsIHBCID0gbWVtb3J5LmFsbG9jKDQpLCBtZW1vcnkuYWxsb2MoNCksIG1lbW9yeS5hbGxvYyg0KQogICAgVkVISUNMRS5HRVRfVkVISUNMRV9DVVNUT01fUFJJTUFSWV9DT0xPVVIodmVoaWNsZSwgcFIsIHBHLCBwQikKICAgIG91dFRhYmxlWydjb2xvcnMnXSA9IHt9CiAgICBvdXRUYWJsZVsnY29sb3JzJ11bJ3ByaW0nXSA9IHsKICAgICAgICBbJ3InXSA9IG1lbW9yeS5yZWFkX2ludChwUiksCiAgICAgICAgWydnJ10gPSBtZW1vcnkucmVhZF9pbnQocEcpLAogICAgICAgIFsnYiddID0gbWVtb3J5LnJlYWRfaW50KHBCKQogICAgfQogICAgVkVISUNMRS5HRVRfVkVISUNMRV9DVVNUT01fU0VDT05EQVJZX0NPTE9VUih2ZWhpY2xlLCBwUiwgcEcsIHBCKQogICAgb3V0VGFibGVbJ2NvbG9ycyddWydzZWMnXSA9IHsKICAgICAgICBbJ3InXSA9IG1lbW9yeS5yZWFkX2ludChwUiksCiAgICAgICAgWydnJ10gPSBtZW1vcnkucmVhZF9pbnQocEcpLAogICAgICAgIFsnYiddID0gbWVtb3J5LnJlYWRfaW50KHBCKQogICAgfQogICAgVkVISUNMRS5HRVRfVkVISUNMRV9FWFRSQV9DT0xPVVJTKHZlaGljbGUsIHBSLCBwRykKICAgIG91dFRhYmxlWydleHRyYUNvbG9ycyddID0gewogICAgICAgIFsncGVhcmwnXSA9IG1lbW9yeS5yZWFkX2ludChwUiksCiAgICAgICAgWyd3aGVlbHMnXSA9IG1lbW9yeS5yZWFkX2ludChwRykKICAgIH0KICAgIG91dFRhYmxlWydsaXZlcnknXSA9IFZFSElDTEUuR0VUX1ZFSElDTEVfTElWRVJZKHZlaGljbGUpCiAgICBvdXRUYWJsZVsncGxhdGVUZXh0J10gPSBWRUhJQ0xFLkdFVF9WRUhJQ0xFX05VTUJFUl9QTEFURV9URVhUKHZlaGljbGUpCiAgICBvdXRUYWJsZVsncGxhdGVUeXBlJ10gPSBWRUhJQ0xFLkdFVF9WRUhJQ0xFX1BMQVRFX1RZUEUodmVoaWNsZSkKICAgIG91dFRhYmxlWydyb29mU3RhdGUnXSA9IFZFSElDTEUuR0VUX0NPTlZFUlRJQkxFX1JPT0ZfU1RBVEUodmVoaWNsZSkKICAgIG91dFRhYmxlWyduZW9uQ29sb3JzJ10gPSB7fQogICAgb3V0VGFibGVbJ25lb25Db2xvcnMnXVsncmVkJ10sIG91dFRhYmxlWyduZW9uQ29sb3JzJ11bJ2dyZWVuJ10sIG91dFRhYmxlWyduZW9uQ29sb3JzJ11bJ2JsdWUnXSA9IG1lbW9yeS5yZWFkX2ludChwUiksIG1lbW9yeS5yZWFkX2ludChwRyksIG1lbW9yeS5yZWFkX2ludChwQikKICAgIFZFSElDTEUuR0VUX1ZFSElDTEVfVFlSRV9TTU9LRV9DT0xPUih2ZWhpY2xlLCBwUiwgcEcsIHBCKQogICAgb3V0VGFibGVbJ3R5cmVTbW9rZSddID0ge30KICAgIG91dFRhYmxlWyd0eXJlU21va2UnXVsncmVkJ10sIG91dFRhYmxlWyd0eXJlU21va2UnXVsnZ3JlZW4nXSwgb3V0VGFibGVbJ3R5cmVTbW9rZSddWydibHVlJ10gPSBtZW1vcnkucmVhZF9pbnQocFIpLCBtZW1vcnkucmVhZF9pbnQocEcpLCBtZW1vcnkucmVhZF9pbnQocEIpCiAgICBvdXRUYWJsZVsnd2luZG93VGludCddID0gVkVISUNMRS5HRVRfVkVISUNMRV9XSU5ET1dfVElOVCh2ZWhpY2xlKQogICAgb3V0VGFibGVbJ2V4dHJhcyddID0ge30KICAgIGZvciBpID0gMSwgOSBkbwogICAgICAgIGlmIFZFSElDTEUuRE9FU19FWFRSQV9FWElTVCh2ZWhpY2xlLCBpKT09IDEgdGhlbgogICAgICAgICAgICB0YWJsZS5pbnNlcnQob3V0VGFibGVbJ2V4dHJhcyddLCBpKQogICAgICAgIGVuZAogICAgZW5kCiAgICByZXR1cm4gb3V0VGFibGUKZW5kCmZ1bmN0aW9uIGNvcHlfdmVoaWNsZShwaWQpCiAgICBpZiBQRUQuSVNfUEVEX0lOX0FOWV9WRUhJQ0xFKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpKSB0aGVuCiAgICAgICAgbG9jYWwgdmVoaWNsZSA9IFBFRC5HRVRfVkVISUNMRV9QRURfSVNfSU4oUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCksIGZhbHNlKQogICAgICAgIGxvY2FsIHZlaGljbGVJbmZvID0gZ2V0X3ZlaGljbGVfaW5mbyh2ZWhpY2xlKQoKICAgICAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSkKICAgICAgICBsb2NhbCB2ZWhpY2xlQ2xvbmUgPSBjcmVhdGVfdmVoaWNsZSh2ZWhpY2xlSW5mb1snaGFzaCddLCBwb3MueCwgcG9zLnksIHBvcy56LCAwKQogICAgICAgIFBFRC5TRVRfUEVEX0lOVE9fVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB2ZWhpY2xlQ2xvbmUsIC0xKQoKICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX01PRF9LSVQodmVoaWNsZUNsb25lLCAwKQogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfV0hFRUxfVFlQRSh2ZWhpY2xlQ2xvbmUsdmVoaWNsZUluZm9bJ3doZWVsVHlwZSddKQogICAgICAgIGZvciBtb2RUeXBlLCBtb2RJRCBpbiBwYWlycyh2ZWhpY2xlSW5mb1snbW9kcyddKSBkbwogICAgICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX01PRCh2ZWhpY2xlQ2xvbmUsIHRvbnVtYmVyKG1vZFR5cGUpLCB0b251bWJlcihtb2RJRCksIGZhbHNlKQogICAgICAgIGVuZAogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfVFlSRVNfQ0FOX0JVUlNUKHZlaGljbGVDbG9uZSwgdmVoaWNsZUluZm9bJ3R5cmVzQ2FuQnVyc3QnXSkKICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0NVU1RPTV9QUklNQVJZX0NPTE9VUih2ZWhpY2xlQ2xvbmUsIHZlaGljbGVJbmZvWydjb2xvcnMnXVsncHJpbSddWydyJ10sIHZlaGljbGVJbmZvWydjb2xvcnMnXVsncHJpbSddWydnJ10sIHZlaGljbGVJbmZvWydjb2xvcnMnXVsncHJpbSddWydiJ10pCiAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9DVVNUT01fU0VDT05EQVJZX0NPTE9VUih2ZWhpY2xlQ2xvbmUsIHZlaGljbGVJbmZvWydjb2xvcnMnXVsnc2VjJ11bJ3InXSwgdmVoaWNsZUluZm9bJ2NvbG9ycyddWydzZWMnXVsnZyddLCB2ZWhpY2xlSW5mb1snY29sb3JzJ11bJ3NlYyddWydiJ10pCiAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9FWFRSQV9DT0xPVVJTKHZlaGljbGVDbG9uZSwgdmVoaWNsZUluZm9bJ2V4dHJhQ29sb3JzJ11bJ3BlYXJsJ10sIHZlaGljbGVJbmZvWydleHRyYUNvbG9ycyddWyd3aGVlbHMnXSkKICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0xJVkVSWSh2ZWhpY2xlQ2xvbmUsIHZlaGljbGVJbmZvWydsaXZlcnknXSkKICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX05VTUJFUl9QTEFURV9URVhUKHZlaGljbGVDbG9uZSwgdmVoaWNsZUluZm9bJ3BsYXRlVGV4dCddKQogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfTlVNQkVSX1BMQVRFX1RFWFRfSU5ERVgodmVoaWNsZUNsb25lLCB2ZWhpY2xlSW5mb1sncGxhdGVUeXBlJ10pCiAgICAgICAgVkVISUNMRS5TRVRfQ09OVkVSVElCTEVfUk9PRl9MQVRDSF9TVEFURSh2ZWhpY2xlQ2xvbmUsIHZlaGljbGVJbmZvWydyb29mU3RhdGUnXSkKICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX1RZUkVfU01PS0VfQ09MT1IodmVoaWNsZUNsb25lLCB2ZWhpY2xlSW5mb1sndHlyZVNtb2tlJ11bJ3JlZCddLCB2ZWhpY2xlSW5mb1sndHlyZVNtb2tlJ11bJ2dyZWVuJ10sIHZlaGljbGVJbmZvWyd0eXJlU21va2UnXVsnYmx1ZSddKQogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfV0lORE9XX1RJTlQodmVoaWNsZUNsb25lLCB2ZWhpY2xlSW5mb1snd2luZG93VGludCddKQogICAgICAgIGZvciBfLCBleHRyYUlEIGluIGlwYWlycyh2ZWhpY2xlSW5mb1snZXh0cmFzJ10pIGRvCiAgICAgICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRVhUUkEodmVoaWNsZUNsb25lLCBleHRyYUlELCBmYWxzZSkKICAgICAgICBlbmQKICAgIGVuZAplbmQKCi0tLS3nu5nkuojovb3lhbcKZnVuY3Rpb24gZ2l2ZV92ZWhpY2xlKHBpZCkKICAgIGxvY2FsIGxhYmVsID0gdXRpbC5yZWdpc3Rlcl9sYWJlbCgi6L6T5YWl6L295YW35qih5Z6L5ZCN56ewIikKICAgIGxvY2FsIGlucHV0ID0gZ2V0X2lucHV0X2Zyb21fc2NyZWVuX2tleWJvYXJkKGxhYmVsLCAyNTQsICIiKQogICAgaWYgaW5wdXQgPT0gIiIgdGhlbiByZXR1cm4gZW5kCiAgICBsb2NhbCBoYXNoID0gTUlTQy5HRVRfSEFTSF9LRVkoaW5wdXQpCiAgICBpZiBTVFJFQU1JTkcuSVNfTU9ERUxfQV9WRUhJQ0xFKGhhc2gpIHRoZW4KICAgICAgICBsb2NhbCBzaXplID0gZ2V0X21vZGVsX3NpemUoaGFzaCkKICAgICAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCksIDAsIHNpemUueSwgMCkKICAgICAgICBsb2NhbCBoZWFkaW5nID0gRU5USVRZLkdFVF9FTlRJVFlfSEVBRElORyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSkKICAgICAgICBsb2NhbCB2ZWhpY2xlID0gY3JlYXRlX3ZlaGljbGUoaGFzaCwgcG9zLngsIHBvcy55LCBwb3MueiwgaGVhZGluZykKICAgICAgICByZXF1ZXN0X2NvbnRyb2wodmVoaWNsZSkKICAgICAgICB1cGdyYWRlX3ZlaGljbGUodmVoaWNsZSkKICAgIGVsc2UKICAgICAgICBub3RpZnkoIuaXoOaViOi9veWFt+aooeWeiyIpICAgIAogICAgZW5kCmVuZAoKLS0tLeatpuWZqOiuvue9rgpmdW5jdGlvbiBhZGRyZXNzX2Zyb21fcG9pbnRlcl9jaGFpbihhZGRyZXNzLCBvZmZzZXRzKQogICAgbG9jYWwgYWRkciA9IGFkZHJlc3MKICAgIGZvciBrID0gMSwgKCNvZmZzZXRzIC0gMSkgZG8KICAgICAgICBhZGRyID0gbWVtb3J5LnJlYWRfbG9uZyhhZGRyICsgb2Zmc2V0c1trXSkKICAgICAgICBpZiBhZGRyID09IDAgdGhlbgogICAgICAgICAgICByZXR1cm4gMAogICAgICAgIGVuZAogICAgZW5kCiAgICBhZGRyID0gYWRkciArIG9mZnNldHNbI29mZnNldHNdCiAgICByZXR1cm4gYWRkcgplbmQKZnVuY3Rpb24gcmVhZFdlYXBvbkFkZHJlc3Moc3RvcmVUYWJsZSwgb2Zmc2V0LCBzdG9wSWZNb2RpZmllZCkKICAgIGlmIHV0aWwuaXNfc2Vzc2lvbl90cmFuc2l0aW9uX2FjdGl2ZSgpIHRoZW4gcmV0dXJuIDAgZW5kCiAgICBsb2NhbCB1c2VyUGVkID0gUExBWUVSLlBMQVlFUl9QRURfSUQoKQogICAgbG9jYWwgd2VhcG9uSGFzaCwgdmVoaWNsZVdlYXBvbiA9IGdldF93ZWFwb25faGFzaCh1c2VyUGVkKQogICAgaWYgc3RvcElmTW9kaWZpZWQgYW5kIHN0b3JlVGFibGVbd2VhcG9uSGFzaF0gdGhlbiByZXR1cm4gMCBlbmQKICAgIGxvY2FsIHBvaW50ZXIgPSAodmVoaWNsZVdlYXBvbiBhbmQgMHg3MCBvciAweDIwKQogICAgbG9jYWwgYWRkcmVzcyA9IGFkZHJlc3NfZnJvbV9wb2ludGVyX2NoYWluKGVudGl0aWVzLmhhbmRsZV90b19wb2ludGVyKHVzZXJQZWQpLCB7MHgxMEI4LCBwb2ludGVyLCBvZmZzZXR9KQogICAgaWYgYWRkcmVzcyA9PSAwIHRoZW4gdXRpbC50b2FzdCgnRmFpbGVkIHRvIGZpbmQgbWVtb3J5IGFkZHJlc3MuJykgcmV0dXJuIDAgZW5kCiAgICBpZiBzdG9yZVRhYmxlW3dlYXBvbkhhc2hdID09IG5pbCB0aGVuCiAgICAgICAgc3RvcmVUYWJsZVt3ZWFwb25IYXNoXSA9IHsKICAgICAgICAgICAgYWRkcmVzcyA9IGFkZHJlc3MsCiAgICAgICAgICAgIG9yaWdpbmFsID0gbWVtb3J5LnJlYWRfZmxvYXQoYWRkcmVzcykKICAgICAgICB9CiAgICBlbmQKICAgIHJldHVybiB3ZWFwb25IYXNoCmVuZAotLemHjeiuvuatpuWZqApmdW5jdGlvbiByZXNldFdlYXBvbnMobW9kaWZpZWRXZWFwb25zKQogICAgZm9yIGhhc2gsIF8gaW4gcGFpcnMobW9kaWZpZWRXZWFwb25zKSBkbwogICAgICAgIG1lbW9yeS53cml0ZV9mbG9hdChtb2RpZmllZFdlYXBvbnNbaGFzaF0uYWRkcmVzcywgbW9kaWZpZWRXZWFwb25zW2hhc2hdLm9yaWdpbmFsKQogICAgICAgIG1vZGlmaWVkV2VhcG9uc1toYXNoXSA9IG5pbAogICAgZW5kCmVuZAoKLS3ml6DlkI7luqcKbG9jYWwgbW9kaWZpZWRSZWNvaWwgPSB7fQpmdW5jdGlvbiBOb19SZWNvaWwodG9nZ2xlZCkKICAgIG5vX3JlY29pbF90b2dnZWxkID0gdG9nZ2xlZAogICAgd2hpbGUgbm9fcmVjb2lsX3RvZ2dlbGQgZG8KICAgICAgICBsb2NhbCB3ZWFwb25IYXNoID0gcmVhZFdlYXBvbkFkZHJlc3MobW9kaWZpZWRSZWNvaWwsIDB4MkY0LCB0cnVlKQogICAgICAgIGlmIHdlYXBvbkhhc2ggPT0gMCB0aGVuIHJldHVybiBlbmQKICAgICAgICBtZW1vcnkud3JpdGVfZmxvYXQobW9kaWZpZWRSZWNvaWxbd2VhcG9uSGFzaF0uYWRkcmVzcywgMCkKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAogICAgcmVzZXRXZWFwb25zKG1vZGlmaWVkUmVjb2lsKQplbmQKLS3ml6DpmZDojIPlm7QKbG9jYWwgbW9kaWZpZWRSYW5nZSA9IHt9CmZ1bmN0aW9uIG1heF9yYW5nZSh0b2dnbGVkKQogICAgbWF4X3JhbmdlX3RvZ2dsZWQgPSB0b2dnbGVkCiAgICB3aGlsZSBtYXhfcmFuZ2VfdG9nZ2xlZCBkbwogICAgICAgIGlmIHV0aWwuaXNfc2Vzc2lvbl90cmFuc2l0aW9uX2FjdGl2ZSgpIHRoZW4gcmV0dXJuIGVuZAogICAgICAgIGxvY2FsIHVzZXJQZWQgPSBQTEFZRVIuUExBWUVSX1BFRF9JRCgpCiAgICAgICAgbG9jYWwgd2VhcG9uSGFzaCwgdmVoaWNsZVdlYXBvbiA9IGdldF93ZWFwb25faGFzaCh1c2VyUGVkKQogICAgICAgIGlmIG1vZGlmaWVkUmFuZ2Vbd2VhcG9uSGFzaF0gdGhlbiByZXR1cm4gZW5kCiAgICAgICAgbG9jYWwgcG9pbnRlciA9ICh2ZWhpY2xlV2VhcG9uIGFuZCAweDcwIG9yIDB4MjApCiAgICAgICAgbG9jYWwgdXNlclBlZFBvaW50ZXIgPSBlbnRpdGllcy5oYW5kbGVfdG9fcG9pbnRlcih1c2VyUGVkKQogICAgICAgIG1vZGlmaWVkUmFuZ2Vbd2VhcG9uSGFzaF0gPSB7CiAgICAgICAgICAgIG1pbkFkZHJlc3MgICA9IGFkZHJlc3NfZnJvbV9wb2ludGVyX2NoYWluKHVzZXJQZWRQb2ludGVyLCB7MHgxMEI4LCBwb2ludGVyLCAweDI5OH0pLAogICAgICAgICAgICBtYXhBZGRyZXNzICAgPSBhZGRyZXNzX2Zyb21fcG9pbnRlcl9jaGFpbih1c2VyUGVkUG9pbnRlciwgezB4MTBCOCwgcG9pbnRlciwgMHgyOUN9KSwKICAgICAgICAgICAgcmFuZ2VBZGRyZXNzID0gYWRkcmVzc19mcm9tX3BvaW50ZXJfY2hhaW4odXNlclBlZFBvaW50ZXIsIHsweDEwQjgsIHBvaW50ZXIsIDB4MjhDfSksCiAgICAgICAgfQogICAgICAgIGlmIG1vZGlmaWVkUmFuZ2Vbd2VhcG9uSGFzaF0ubWluQWRkcmVzcyA9PSAwIG9yIG1vZGlmaWVkUmFuZ2Vbd2VhcG9uSGFzaF0ubWF4QWRkcmVzcyA9PSAwIG9yIG1vZGlmaWVkUmFuZ2Vbd2VhcG9uSGFzaF0ucmFuZ2VBZGRyZXNzID09IDAgdGhlbiAKICAgICAgICAgICAgdXRpbC50b2FzdCgn5om+5LiN5Yiw5YaF5a2Y5Zyw5Z2AJykgCiAgICAgICAgICAgIHJldHVybiAKICAgICAgICBlbmQKICAgICAgICBtb2RpZmllZFJhbmdlW3dlYXBvbkhhc2hdLm9yaWdpbmFsTWluICAgPSBtZW1vcnkucmVhZF9mbG9hdChtb2RpZmllZFJhbmdlW3dlYXBvbkhhc2hdLm1pbkFkZHJlc3MpCiAgICAgICAgbW9kaWZpZWRSYW5nZVt3ZWFwb25IYXNoXS5vcmlnaW5hbE1heCAgID0gbWVtb3J5LnJlYWRfZmxvYXQobW9kaWZpZWRSYW5nZVt3ZWFwb25IYXNoXS5tYXhBZGRyZXNzKQogICAgICAgIG1vZGlmaWVkUmFuZ2Vbd2VhcG9uSGFzaF0ub3JpZ2luYWxSYW5nZSA9IG1lbW9yeS5yZWFkX2Zsb2F0KG1vZGlmaWVkUmFuZ2Vbd2VhcG9uSGFzaF0ucmFuZ2VBZGRyZXNzKQogICAgICAgIG1lbW9yeS53cml0ZV9mbG9hdChtb2RpZmllZFJhbmdlW3dlYXBvbkhhc2hdLm1pbkFkZHJlc3MsICAgMTUwMDAwKSAgLS1iZWNhdXNlIHRoZSBtYXAgaXMgYWJvdXQgMTVrbSB0YWxsCiAgICAgICAgbWVtb3J5LndyaXRlX2Zsb2F0KG1vZGlmaWVkUmFuZ2Vbd2VhcG9uSGFzaF0ubWF4QWRkcmVzcywgICAxNTAwMDApCiAgICAgICAgbWVtb3J5LndyaXRlX2Zsb2F0KG1vZGlmaWVkUmFuZ2Vbd2VhcG9uSGFzaF0ucmFuZ2VBZGRyZXNzLCAxNTAwMDApCiAgICAgICAgdXRpbC55aWVsZCgpCiAgICBlbmQKICAgIC0t5oGi5aSNCiAgICBmb3IgaGFzaCwgXyBpbiBwYWlycyhtb2RpZmllZFJhbmdlKSBkbwogICAgICAgIG1lbW9yeS53cml0ZV9mbG9hdChtb2RpZmllZFJhbmdlW2hhc2hdLm1pbkFkZHJlc3MsIG1vZGlmaWVkUmFuZ2VbaGFzaF0ub3JpZ2luYWxNaW4pCiAgICAgICAgbWVtb3J5LndyaXRlX2Zsb2F0KG1vZGlmaWVkUmFuZ2VbaGFzaF0ubWF4QWRkcmVzcywgbW9kaWZpZWRSYW5nZVtoYXNoXS5vcmlnaW5hbE1heCkKICAgICAgICBtZW1vcnkud3JpdGVfZmxvYXQobW9kaWZpZWRSYW5nZVtoYXNoXS5yYW5nZUFkZHJlc3MsIG1vZGlmaWVkUmFuZ2VbaGFzaF0ub3JpZ2luYWxSYW5nZSkKICAgICAgICBtb2RpZmllZFJhbmdlW2hhc2hdID0gbmlsCiAgICBlbmQKZW5kCi0t5peg5omp5pWjCmxvY2FsIG1vZGlmaWVkU3ByZWFkID0ge30KZnVuY3Rpb24gbm9fc3ByZWFkKHRvZ2dsZWQpCiAgICBub19zcHJlYWRfdG9nZ2xlZCA9IHRvZ2dsZWQKICAgIHdoaWxlIG5vX3NwcmVhZF90b2dnbGVkIGRvCiAgICAgICAgbG9jYWwgd2VhcG9uSGFzaCA9IHJlYWRXZWFwb25BZGRyZXNzKG1vZGlmaWVkU3ByZWFkLCAweDc0LCB0cnVlKQogICAgICAgIGlmIHdlYXBvbkhhc2ggPT0gMCB0aGVuIHJldHVybiBlbmQKICAgICAgICBtZW1vcnkud3JpdGVfZmxvYXQobW9kaWZpZWRTcHJlYWRbd2VhcG9uSGFzaF0uYWRkcmVzcywgMCkKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAogICAgcmVzZXRXZWFwb25zKG1vZGlmaWVkU3ByZWFkKQplbmQKLS3np7vpmaTliY3mkYcKbG9jYWwgbW9kaWZpZWRTcGludXAgPSB7e2hhc2ggPSB1dGlsLmpvYWF0KCd3ZWFwb25fbWluaWd1bicpfSx7aGFzaCA9IHV0aWwuam9hYXQoJ3dlYXBvbl9yYXltaW5pZ3VuJyl9LH0KZnVuY3Rpb24gbm9fc3BpbnVwKHRvZ2dsZWQpCiAgICBub19zcGludXBfdG9nZ2xlZCA9IHRvZ2dsZWQKICAgIHdoaWxlIG5vX3NwaW51cF90b2dnbGVkIGRvCiAgICAgICAgbG9jYWwgd2VhcG9uSGFzaCA9IFdFQVBPTi5HRVRfU0VMRUNURURfUEVEX1dFQVBPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgIGZvciBpLCB2IGluIHBhaXJzKG1vZGlmaWVkU3BpbnVwKSBkbwogICAgICAgICAgICBpZiB3ZWFwb25IYXNoID09IHYuaGFzaCB0aGVuCiAgICAgICAgICAgICAgICBtb2RpZmllZFNwaW51cFtpXS5hZGRyZXNzID0gYWRkcmVzc19mcm9tX3BvaW50ZXJfY2hhaW4oZW50aXRpZXMuaGFuZGxlX3RvX3BvaW50ZXIoUExBWUVSLlBMQVlFUl9QRURfSUQoKSksIHsweDEwQjgsIDB4MjAsIDB4MTQ0fSkKICAgICAgICAgICAgICAgIGlmIG1vZGlmaWVkU3BpbnVwW2ldLmFkZHJlc3MgPT0gMCB0aGVuIHJldHVybiBlbmQKICAgICAgICAgICAgICAgIG1lbW9yeS53cml0ZV9mbG9hdChtb2RpZmllZFNwaW51cFtpXS5hZGRyZXNzLCAwKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAogICAgLS3mgaLlpI0KICAgIGZvciBpID0gMSwgI21vZGlmaWVkU3BpbnVwIGRvCiAgICAgICAgaWYgbW9kaWZpZWRTcGludXBbaV0uYWRkcmVzcyB0aGVuCiAgICAgICAgICAgIG1lbW9yeS53cml0ZV9mbG9hdChtb2RpZmllZFNwaW51cFtpXS5hZGRyZXNzLCAwLjUpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCi0t5a2Q5by55Lyk5a6z5L+u5pS5CmxvY2FsIG1vZGlmaWVkQ2FyRm9yY2UgPSB7fQpsb2NhbCBtb2RpZmllZEhlbGlGb3JjZSA9IHt9CmxvY2FsIG1vZGlmaWVkUGVkRm9yY2UgPSB7fQpmdW5jdGlvbiBkYW1hZ2Vtb2RlZCh0b2dnbGVkKQogICAgZGFtYWdlbW9kZWRfdG9nZ2xlZCA9IHRvZ2dsZWQKICAgIHdoaWxlIGRhbWFnZW1vZGVkX3RvZ2dsZWQgZG8KICAgICAgICBsb2NhbCBjYXJ3ZWFwb25IYXNoID0gcmVhZFdlYXBvbkFkZHJlc3MobW9kaWZpZWRDYXJGb3JjZSwgMHgwRTAsIGZhbHNlKQogICAgICAgIGlmIGNhcndlYXBvbkhhc2ggPT0gMCB0aGVuIHJldHVybiBlbmQKICAgICAgICBtZW1vcnkud3JpdGVfZmxvYXQobW9kaWZpZWRDYXJGb3JjZVtjYXJ3ZWFwb25IYXNoXS5hZGRyZXNzLCBtb2RpZmllZENhckZvcmNlW2NhcndlYXBvbkhhc2hdLm9yaWdpbmFsICogMTAwKQoKICAgICAgICBsb2NhbCBIZWxpd2VhcG9uSGFzaCA9IHJlYWRXZWFwb25BZGRyZXNzKG1vZGlmaWVkSGVsaUZvcmNlLCAweDBFNCwgZmFsc2UpCiAgICAgICAgaWYgSGVsaXdlYXBvbkhhc2ggPT0gMCB0aGVuIHJldHVybiBlbmQKICAgICAgICBtZW1vcnkud3JpdGVfZmxvYXQobW9kaWZpZWRIZWxpRm9yY2VbSGVsaXdlYXBvbkhhc2hdLmFkZHJlc3MsIG1vZGlmaWVkSGVsaUZvcmNlW0hlbGl3ZWFwb25IYXNoXS5vcmlnaW5hbCAqIDEwMCkKCiAgICAgICAgbG9jYWwgcGVkd2VhcG9uSGFzaCA9IHJlYWRXZWFwb25BZGRyZXNzKG1vZGlmaWVkUGVkRm9yY2UsIDB4MERDLCBmYWxzZSkKICAgICAgICBpZiBwZWR3ZWFwb25IYXNoID09IDAgdGhlbiByZXR1cm4gZW5kCiAgICAgICAgbWVtb3J5LndyaXRlX2Zsb2F0KG1vZGlmaWVkUGVkRm9yY2VbcGVkd2VhcG9uSGFzaF0uYWRkcmVzcywgbW9kaWZpZWRQZWRGb3JjZVtwZWR3ZWFwb25IYXNoXS5vcmlnaW5hbCAqIDEwMCkKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAogICAgLS3ph43orr4KICAgIHJlc2V0V2VhcG9ucyhtb2RpZmllZENhckZvcmNlKTtyZXNldFdlYXBvbnMobW9kaWZpZWRIZWxpRm9yY2UpO3Jlc2V0V2VhcG9ucyhtb2RpZmllZFBlZEZvcmNlKQplbmQKCi0t5b+r6YCf5bCE5Ye7CmZ1bmN0aW9uIHJhcGlkZmlyZSgpCiAgICAtLVtbIGxvY2FsIHdlYXBvbiA9IFdFQVBPTi5HRVRfQ1VSUkVOVF9QRURfV0VBUE9OX0VOVElUWV9JTkRFWChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwKQogICAgbG9jYWwgYm9uZUlkID0gRU5USVRZLkdFVF9FTlRJVFlfQk9ORV9JTkRFWF9CWV9OQU1FKHdlYXBvbiwgImd1bl9tdXp6bGUiKQogICAgbG9jYWwgYm9uZUNvb3JkcyA9IEVOVElUWS5HRVRfRU5USVRZX0JPTkVfUE9TVElPTih3ZWFwb24sIGJvbmVJZCkgXV0KICAgIGlmIFBBRC5JU19DT05UUk9MX1BSRVNTRUQoMCwgMjQpIGFuZCBub3QgUEVELklTX1BFRF9JTl9BTllfVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlKSB0aGVuCiAgICAgICAgbG9jYWwgd2VhcG9uaGFzaCA9IFdFQVBPTi5HRVRfU0VMRUNURURfUEVEX1dFQVBPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgIGxvY2FsIGRhbWFnZSA9IFdFQVBPTi5HRVRfV0VBUE9OX0RBTUFHRSh3ZWFwb25oYXNoLCAwKQoKICAgICAgICBsb2NhbCBnYW1lcGxheUNhbSA9IENBTS5HRVRfRklOQUxfUkVOREVSRURfQ0FNX0NPT1JEKCkKICAgICAgICBsb2NhbCBnYW1lcGxheUNhbVJvdCA9IENBTS5HRVRfR0FNRVBMQVlfQ0FNX1JPVCgwKQogICAgICAgIGxvY2FsIGdhbWVwbGF5Q2FtRGlyZWN0aW9uID0gdmVjdG9yMy50b0RpcihnYW1lcGxheUNhbVJvdCkKICAgICAgICBsb2NhbCBzdGFydENvb3JkcyA9IHZlY3RvcjMuYWRkKGdhbWVwbGF5Q2FtLCBnYW1lcGxheUNhbURpcmVjdGlvbikKICAgICAgICBsb2NhbCBlbmRDb29yZHMgPSB2ZWN0b3IzLmFkZChzdGFydENvb3JkcywgdmVjdG9yMy5tdWxTY2FsYXIoZ2FtZXBsYXlDYW1EaXJlY3Rpb24sIDUwMC4wKSkgIC0tZ2V0X29mZnNldF9mcm9tX2NhbWVyYSgzMCkKCiAgICAgICAgTUlTQy5TSE9PVF9TSU5HTEVfQlVMTEVUX0JFVFdFRU5fQ09PUkRTKHN0YXJ0Q29vcmRzLngsIHN0YXJ0Q29vcmRzLnksIHN0YXJ0Q29vcmRzLnosIGVuZENvb3Jkcy54LCBlbmRDb29yZHMueSwgZW5kQ29vcmRzLnosIGRhbWFnZSwgdHJ1ZSwgd2VhcG9uaGFzaCwgUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSwgZmFsc2UsIDI1MDAuMCkKICAgIGVuZAplbmQKCgotLeeehOWHhuinhumHjue8qeaUvgpsb2NhbCBleHRyYVpvb20gPSAwCmxvY2FsIG1vZGlmaWVkWm9vbUZvdiA9IHt9CmZ1bmN0aW9uIHpvb21haW1mb3YodmFsdWUpCiAgICBleHRyYVpvb20gPSAodmFsdWUgLSAxMDApIC8gMTAwCmVuZApmdW5jdGlvbiBlbmFibGV6b29tZm92KHRvZ2dsZWQpCiAgICBlbmFibGV6b29tZm92X3RvZ2dsZWQgPSB0b2dnbGVkCiAgICB3aGlsZSBlbmFibGV6b29tZm92X3RvZ2dsZWQgZG8KICAgICAgICBsb2NhbCB3ZWFwb25IYXNoID0gcmVhZFdlYXBvbkFkZHJlc3MobW9kaWZpZWRab29tRm92LCAweDQxMCwgZmFsc2UpCiAgICAgICAgaWYgd2VhcG9uSGFzaCA9PSAwIHRoZW4gcmV0dXJuIGVuZAogICAgICAgIG1lbW9yeS53cml0ZV9mbG9hdChtb2RpZmllZFpvb21Gb3Zbd2VhcG9uSGFzaF0uYWRkcmVzcywgIG1vZGlmaWVkWm9vbUZvdlt3ZWFwb25IYXNoXS5vcmlnaW5hbCArIGV4dHJhWm9vbSkKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAogICAgcmVzZXRXZWFwb25zKG1vZGlmaWVkWm9vbUZvdikKZW5kCgoKCgoKCgoKCi0tLS3oh6rlrprkuYnlpI3mtLvkvY3nva4KbG9jYWwgd2FzRGVhZCA9IGZhbHNlCmZ1bmN0aW9uIGN1c3RvbV9yZXNwYXduKCkKICAgIGlmIHJlc3Bhd25Qb3MgPT0gbmlsIHRoZW4gCiAgICAgICAgcmV0dXJuIAogICAgZW5kCiAgICBsb2NhbCBpc0RlYWQgPSBQTEFZRVIuSVNfUExBWUVSX0RFQUQoUExBWUVSLlBMQVlFUl9JRCgpKQogICAgaWYgd2FzRGVhZCBhbmQgbm90IGlzRGVhZCB0aGVuCiAgICAgICAgd2hpbGUgUExBWUVSLklTX1BMQVlFUl9ERUFEKFBMQVlFUi5QTEFZRVJfSUQoKSkgZG8KICAgICAgICAgICAgdXRpbC55aWVsZCgpCiAgICAgICAgZW5kCiAgICAgICAgZm9yIGkgPSAwLCAzMCBkbwogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFNfTk9fT0ZGU0VUKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHJlc3Bhd25Qb3MueCwgcmVzcGF3blBvcy55LCByZXNwYXduUG9zLnosIGZhbHNlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHJlc3Bhd25Sb3QueCwgcmVzcGF3blJvdC55LCByZXNwYXduUm90LnosIDIsIHRydWUpCiAgICAgICAgICAgIHV0aWwueWllbGQoKQogICAgICAgIGVuZAogICAgZW5kCiAgICB3YXNEZWFkID0gaXNEZWFkCmVuZApmdW5jdGlvbiBzYXZlX2N1c3RvbV9yZXNwYXduKCkKICAgIHJlc3Bhd25Qb3MgPSBwbGF5ZXJzLmdldF9wb3NpdGlvbihQTEFZRVIuUExBWUVSX0lEKCkpCiAgICByZXNwYXduUm90ID0gRU5USVRZLkdFVF9FTlRJVFlfUk9UQVRJT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMikKICAgIGxvY2FsIHBvcyA9ICdYOiAnLi4gcmVzcGF3blBvcy54IC4uJ1xuWTogJy4uIHJlc3Bhd25Qb3MueSAuLidcblo6ICcuLiByZXNwYXduUG9zLnoKICAgIGxvY2FsIHBsYWNlbmFtZSA9IHV0aWwuZ2V0X2xhYmVsX3RleHQoWk9ORS5HRVRfTkFNRV9PRl9aT05FKHYzLmdldChyZXNwYXduUG9zKSkpCiAgICBtZW51LnNldF9tZW51X25hbWUoY3VzdG9tX3Jlc3Bhd25fbG9jYXRpb24sICfmm7TmlrDkvY3nva4oJyAuLiBwbGFjZW5hbWUuLiIpIikKICAgIG1lbnUuc2V0X2hlbHBfdGV4dChjdXN0b21fcmVzcGF3bl9sb2NhdGlvbiwgICflvZPliY3lnZDmoIc6XG4nIC4uIHBvcykKICAgIG5vdGlmaWNhdGlvbigifmJvbGR+fnl+5L2N572u5bey5pu05pawIiwgSHVkQ29sb3VyLmJsdWUpCmVuZAoKCi0tLS3nrKjmi5kKZnVuY3Rpb24gY2x1bXN5KCkKICAgIGlmIFBFRC5JU19QRURfUkFHRE9MTChQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSB0aGVuIAogICAgICAgIHV0aWwueWllbGQoMzAwMCkgCiAgICAgICAgcmV0dXJuIAogICAgZW5kCiAgICBQRUQuU0VUX1BFRF9SQUdET0xMX09OX0NPTExJU0lPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlKQplbmQKLS0tLeaRlOWAkgpmdW5jdGlvbiBzdHVtYmxlKCkKICAgIGxvY2FsIHZlY3RvciA9IEVOVElUWS5HRVRfRU5USVRZX0ZPUldBUkRfVkVDVE9SKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICBQRUQuU0VUX1BFRF9UT19SQUdET0xMX1dJVEhfRkFMTChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAxNTAwLCAyMDAwLCAyLCB2ZWN0b3IueCwgLXZlY3Rvci55LCB2ZWN0b3IueiwgMSwgMCwgMCwgMCwgMCwgMCwgMCkKZW5kCgoKLS0tLeaOieiQvei2s+eQgwpmdW5jdGlvbiBiYWxsX2Ryb3AocG9zKQogICAgbG9jYWwgbW9kZWwgPSBzb2NjZXJiYWxsX21vZGVsc1ttYXRoLnJhbmRvbSgxLCAjc29jY2VyYmFsbF9tb2RlbHMpXQogICAgbG9jYWwgcGlja3VwX2hhc2ggPSB1dGlsLmpvYWF0KG1vZGVsKQogICAgcmVxdWVzdF9tb2RlbChwaWNrdXBfaGFzaCkKICAgIHBvcy54ID0gcG9zLnggKyBtYXRoLnJhbmRvbSgtMywgMykKICAgIHBvcy55ID0gcG9zLnkgKyBtYXRoLnJhbmRvbSgtMywgMykKICAgIHBvcy56ID0gcG9zLnogKyBtYXRoLnJhbmRvbSg1LCAzMCkKICAgIGxvY2FsIHBpY2t1cF9wb3MgPSB2My5uZXcocG9zLngsIHBvcy55LCBwb3MueikKICAgIGxvY2FsIHBpY2t1cCA9IGVudGl0aWVzLmNyZWF0ZV9vYmplY3QocGlja3VwX2hhc2gsIHBpY2t1cF9wb3MsIHRydWUpCiAgICBFTlRJVFkuU0VUX0VOVElUWV9DT0xMSVNJT04ocGlja3VwLCB0cnVlLCB0cnVlKQogICAgRU5USVRZLkFQUExZX0ZPUkNFX1RPX0VOVElUWV9DRU5URVJfT0ZfTUFTUyhwaWNrdXAsIDUsIDAsIDAsIDEsdHJ1ZSwgZmFsc2UsIHRydWUsIHRydWUpCmVuZApmdW5jdGlvbiBkZWxldGVfYWxsX3NvY2NlcigpCiAgICBsb2NhbCBiYWxsX2NvdW50ID0gMAogICAgbG9jYWwgYWxsX29iamVjdHMgPSBlbnRpdGllcy5nZXRfYWxsX29iamVjdHNfYXNfaGFuZGxlcygpCiAgICBmb3IgXywgYmFsbF9tb2RlbCBpbiBwYWlycyhzb2NjZXJiYWxsX21vZGVscykgZG8KICAgICAgICBsb2NhbCBiYWxsX2hhc2ggPSB1dGlsLmpvYWF0KGJhbGxfbW9kZWwpCiAgICAgICAgZm9yIGssIG9iamVjdCBpbiBwYWlycyhhbGxfb2JqZWN0cykgZG8KICAgICAgICAgICAgbG9jYWwgb2JqZWN0X2hhc2ggPSBFTlRJVFkuR0VUX0VOVElUWV9NT0RFTChvYmplY3QpCiAgICAgICAgICAgIGlmIG9iamVjdF9oYXNoID09IGJhbGxfaGFzaCB0aGVuCiAgICAgICAgICAgICAgICBkZWxldGVfZW50aXR5KG9iamVjdCkKICAgICAgICAgICAgICAgIGJhbGxfY291bnQgPSBiYWxsX2NvdW50ICsgMQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogICAgdXRpbC50b2FzdCgi5bey5riF55CGICIuLmJhbGxfY291bnQuLiIg5Liq55CDIikKZW5kCgotLS0t57KS5a2Q5ouW5bC+CmxvY2FsIHZlaHBhcnRpY2xlID0gInNjcl9taWNoNF9maXJld29ya190cmFpbF9zcGF3biIKZnVuY3Rpb24gZ2V0X21vZGVsX2RpbWVuc2lvbnMoaGFzaCkKICAgIGxvY2FsIG1pbmltdW0gPSBtZW1vcnkuYWxsb2MoMjQpCiAgICBsb2NhbCBtYXhpbXVtID0gbWVtb3J5LmFsbG9jKDI0KQogICAgbG9jYWwgbWluID0ge30KICAgIGxvY2FsIG1heCA9IHt9CiAgICBNSVNDLkdFVF9NT0RFTF9ESU1FTlNJT05TKGhhc2gsIG1pbmltdW0sIG1heGltdW0pCiAgICBtaW4ueCwgbWluLnksIG1pbi56ID0gdjMuZ2V0KG1pbmltdW0pCiAgICBtYXgueCwgbWF4LnksIG1heC56ID0gdjMuZ2V0KG1heGltdW0pCiAgICBsb2NhbCBzaXplID0ge30KICAgIHNpemUueCA9IG1heC54IC0gbWluLngKICAgIHNpemUueSA9IG1heC55IC0gbWluLnkKICAgIHNpemUueiA9IG1heC56IC0gbWluLnoKICAgIHJldHVybiBzaXplCmVuZApmdW5jdGlvbiBzZWxlY3RwYXJ0aWNsZShpbmRleCwgbWVudV9uYW1lLCBwcmV2X3ZhbHVlLCBjbGlja190eXBlKQogICAgdmVocGFydGljbGUgPSB2ZWhwYXJ0aWNsZV90YltpbmRleF0KZW5kCmZ1bmN0aW9uIHBhcnRpY2xlX3RhaWwoKQogICAgbG9jYWwgdmVoaWNsZSA9IGVudGl0aWVzLmdldF91c2VyX3ZlaGljbGVfYXNfaGFuZGxlKGZhbHNlKQogICAgbG9jYWwgaGVpZ2h0ID0gZ2V0X21vZGVsX2RpbWVuc2lvbnMoRU5USVRZLkdFVF9FTlRJVFlfTU9ERUwodmVoaWNsZSkpCiAgICBsb2NhbCBwb3NYMSA9IC1oZWlnaHQueC8zIC0tbGVmdC0tCiAgICBsb2NhbCBwb3NYMiA9IGhlaWdodC54LzMgLS1yaWdodC0tCiAgICBsb2NhbCBwb3NZID0gLWhlaWdodC55LzMKICAgIGZvciBpLCBwb3NYIGluIHtwb3NYMSwgcG9zWDJ9IGRvCiAgICAgICAgcmVxdWVzdF9wdGZ4X2Fzc2V0KCJzY3JfcmNwYXBhcmF6em8xIikKICAgICAgICBHUkFQSElDUy5VU0VfUEFSVElDTEVfRlhfQVNTRVQoInNjcl9yY3BhcGFyYXp6bzEiKQogICAgICAgIEdSQVBISUNTLlNUQVJUX05FVFdPUktFRF9QQVJUSUNMRV9GWF9OT05fTE9PUEVEX09OX0VOVElUWSh2ZWhwYXJ0aWNsZSwgdmVoaWNsZSwgcG9zWCwgcG9zWSwgMC4wLCAwLjAsIDAuMCwgMC4wLCAxLjAsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCiAgICBlbmQKZW5kCgotLS0t5b+r6YCf5YWz6ZetR1RBVgpmdW5jdGlvbiByZXN0YXJ0X2dhbWUoKQogICAgTUlTQzEuX1JFU1RBUlRfR0FNRSgpCmVuZApmdW5jdGlvbiBleGl0X2dhbWUoKQogICAgbG9jYWwgcGFzc19saXN0ID0ge3swfX0KICAgIHdoaWxlIHRydWUgZG8KICAgICAgICBmb3IgXywgcGFzcyBpbiBpcGFpcnMocGFzc19saXN0KSBkbwogICAgICAgICAgICBsb2NhbCByaWQgPSBwbGF5ZXJzLmdldF9yb2Nrc3Rhcl9pZChQTEFZRVIuUExBWUVSX0lEKCkpCiAgICAgICAgICAgIGlmIHBhc3MuaWQgPT0gcmlkIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiAKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgoKLS0tLeWKq+aMgei9veWFtwpmdW5jdGlvbiBoaWphY2tpbmdfdmVoaWNsZXMocGlkKQogICAgCiAgICBsb2NhbCB0aW1lID0gMAogICAgbG9jYWwgcGVkID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgIGxvY2FsIHBvcyA9IHBsYXllcnMuZ2V0X3Bvc2l0aW9uKHBpZCkKICAgIGxvY2FsIHZlaGljbGUgPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX1VTSU5HKHBlZCkKICAgIGxvY2FsIGRyaXZlciA9IE5FVFdPUksuTkVUV09SS19HRVRfUExBWUVSX0lOREVYX0ZST01fUEVEKFZFSElDTEUuR0VUX1BFRF9JTl9WRUhJQ0xFX1NFQVQodmVoaWNsZSwgLTEpKQogICAgbG9jYWwgcGFzc2VuZ2VyID0gTkVUV09SSy5ORVRXT1JLX0dFVF9QTEFZRVJfSU5ERVhfRlJPTV9QRUQoVkVISUNMRS5HRVRfUEVEX0lOX1ZFSElDTEVfU0VBVCh2ZWhpY2xlLCAtMikpCiAgICBwb3MueiA9IHBvcy56IC0gNTAKICAgIGlmIG5vdCBQRUQuSVNfUEVEX0lOX0FOWV9WRUhJQ0xFKHBlZCwgZmFsc2UpIHRoZW4KICAgICAgICB1dGlsLnRvYXN0KGxhbmcuZ2V0X2xvY2FsaXNlZCgxMDY3NTIzNzIxKTpnc3ViKCJ7fSIsIHBsYXllcnMuZ2V0X25hbWUocGlkKSkpCiAgICByZXR1cm4gZW5kCiAgICBpZiBub3QgUEVELklTX1BFRF9BX1BMQVlFUihWRUhJQ0xFLkdFVF9QRURfSU5fVkVISUNMRV9TRUFUKHZlaGljbGUsIC0xKSkgdGhlbgogICAgICAgIHV0aWwudG9hc3QoIui9pui+huW3suiiq+aIkOWKn+WKq+aMgTpEIikKICAgIHJldHVybiBlbmQKCiAgICBsb2NhbCBzcGF3bmVkX3BlZCA9IFBFRDEuQ1JFQVRFX1JBTkRPTV9QRUQocG9zKQogICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRShzcGF3bmVkX3BlZCwgdHJ1ZSkKICAgIEVOVElUWS5TRVRfRU5USVRZX1ZJU0lCTEUoc3Bhd25lZF9wZWQsIGZhbHNlKQogICAgUEVELlNFVF9CTE9DS0lOR19PRl9OT05fVEVNUE9SQVJZX0VWRU5UUyhzcGF3bmVkX3BlZCwgdHJ1ZSkKICAgIFRBU0sxLlRBU0tfRU5URVJfVkVISUNMRShzcGF3bmVkX3BlZCwgdmVoaWNsZSwgMTAwMCwgLTEsIDEuMCwgKDEgPDwgMSkgfCAoMSA8PCAzKSB8ICgxIDw8IDQpIHwgKDEgPDwgOSkpCiAgICBlbnRpdGllcy5naXZlX2NvbnRyb2xfYnlfaGFuZGxlKHNwYXduZWRfcGVkLCBwaWQpCiAgICByZXBlYXQKICAgICAgICB0aW1lID0gdGltZSArIDEgICAKICAgICAgICBpZiB0aW1lID4gMzAwIGFuZCBub3QgUEVELklTX1BFRF9JTl9BTllfVkVISUNMRShzcGF3bmVkX3BlZCwgZmFsc2UpIHRoZW4KICAgICAgICAgICAgaWYgcGxheWVycy5nZXRfbmFtZShkcml2ZXIpIH49ICJJbnZhbGlkUGxheWVyIiB0aGVuCiAgICAgICAgICAgICAgICB1dGlsLnRvYXN0KCLmnKrog73miJDlip/liqvmjIEgIiAuLiBwbGF5ZXJzLmdldF9uYW1lKGRyaXZlcikgLi4gIueahOi9veWFty4gOi8iKQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICB1dGlsLnRvYXN0KCLmnKrog73miJDlip/liqvmjIEgIiAuLiBwbGF5ZXJzLmdldF9uYW1lKHBpZCkgLi4gIueahOi9veWFty4gOi8iKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgZGVsZXRlX2VudGl0eShzcGF3bmVkX3BlZCkKICAgICAgICAgICAgdGltZSA9IDAKICAgICAgICAgICAgYnJlYWsgCiAgICAgICAgZW5kCiAgICAgICAgdXRpbC55aWVsZCgpCiAgICB1bnRpbCBUQVNLLkdFVF9JU19UQVNLX0FDVElWRShwZWQsIDIpCiAgICBpZiBUQVNLLkdFVF9JU19UQVNLX0FDVElWRShwZWQsIDIpIHRoZW4KICAgICAgICByZXBlYXQKICAgICAgICAgICAgdXRpbC55aWVsZCgpCiAgICAgICAgdW50aWwgbm90IFRBU0suR0VUX0lTX1RBU0tfQUNUSVZFKHBlZCwgMikgb3IgUEVELklTX1BFRF9JTl9BTllfVkVISUNMRShzcGF3bmVkX3BlZCwgZmFsc2UpCiAgICAgICAgVEFTSy5UQVNLX1ZFSElDTEVfRFJJVkVfV0FOREVSKHNwYXduZWRfcGVkLCB2ZWhpY2xlLCA5OTk5LjAsIDYpIAogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRE9PUlNfTE9DS0VEX0ZPUl9QTEFZRVIodmVoaWNsZSwgcGlkLCB0cnVlKQogICAgICAgIHV0aWwudG9hc3QoIuS7luS7rOeahOi9veWFt+eOsOWcqOaYr+S9oOeahOS6hiIpCiAgICAgICAgdXRpbC55aWVsZCgxMDAwKQogICAgZW5kCiAgICBpZiBub3QgVEFTSy5HRVRfSVNfVEFTS19BQ1RJVkUoc3Bhd25lZF9wZWQpIG9yIFRBU0suR0VUX0lTX1RBU0tfQUNUSVZFKHNwYXduZWRfcGVkLCAxNSkgdGhlbgogICAgICAgIHJlcGVhdAogICAgICAgICAgICBUQVNLLlRBU0tfVkVISUNMRV9EUklWRV9XQU5ERVIoc3Bhd25lZF9wZWQsIHZlaGljbGUsIDk5OTkuMCwgNikgLS0gZ2l2aW5nIHRhc2sgYWdhaW4gY3VzIGRvZXNudCB3b3JrIHNvbWV0aW1lcwogICAgICAgICAgICB1dGlsLnlpZWxkKCkKICAgICAgICB1bnRpbCBUQVNLLkdFVF9JU19UQVNLX0FDVElWRShzcGF3bmVkX3BlZCwgMTUxKQogICAgZW5kCiAgICB1dGlsLnlpZWxkKDUwMDApCiAgICBpZiBzcGF3bmVkX3BlZCB+PSBuaWwgYW5kIG5vdCBQRUQuSVNfUEVEX0lOX0FOWV9WRUhJQ0xFKHNwYXduZWRfcGVkLCBmYWxzZSkgdGhlbiAtLSAybmQgY2hlY2sgY3VzIHNvbWV0aW1lcyBkb2VzbnQgZGVsZXRlIHRoZSBmaXJzdCB0aW1lCiAgICAgICAgaWYgbm90IE5FVFdPUksuTkVUV09SS19IQVNfQ09OVFJPTF9PRl9FTlRJVFkoc3Bhd25lZF9wZWQpIHRoZW4KICAgICAgICAgICAgcmVwZWF0CiAgICAgICAgICAgICAgICBORVRXT1JLLk5FVFdPUktfUkVRVUVTVF9DT05UUk9MX09GX0VOVElUWShzcGF3bmVkX3BlZCkKICAgICAgICAgICAgICAgIHV0aWwueWllbGQoKQogICAgICAgICAgICB1bnRpbCBORVRXT1JLLk5FVFdPUktfSEFTX0NPTlRST0xfT0ZfRU5USVRZKHNwYXduZWRfcGVkKQogICAgICAgICAgICByZXBlYXQgCiAgICAgICAgICAgICAgICBkZWxldGVfZW50aXR5KHNwYXduZWRfcGVkKQogICAgICAgICAgICAgICAgdXRpbC55aWVsZCgpCiAgICAgICAgICAgIHVudGlsIG5vdCBFTlRJVFkuRE9FU19FTlRJVFlfRVhJU1Qoc3Bhd25lZF9wZWQpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgotLS0t5Yik5pat5pWw5a2X5bGe5LqO5Yy66Ze0CmZ1bmN0aW9uIGlzTnVtYmVySW5SYW5nZShudW1iZXIsIHJhbmdlU3RhcnQsIHJhbmdlRW5kKQogICAgLS0g5qOA5p+l6IyD5Zu055qE6LW35aeL5ZKM57uT5p2f5YC85piv5ZCm5q2j56GuCiAgICBpZiByYW5nZVN0YXJ0ID4gcmFuZ2VFbmQgdGhlbgogICAgICAgIHV0aWwudG9hc3QoIuaXoOaViOWMuumXtCIpCiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICBlbmQKICAgIC0tIOWIpOaWreaVsOWtl+aYr+WQpuWcqOWMuumXtOWGhQogICAgaWYgbnVtYmVyID49IHJhbmdlU3RhcnQgYW5kIG51bWJlciA8PSByYW5nZUVuZCB0aGVuCiAgICAgICAgcmV0dXJuIHRydWUKICAgIGVsc2UKICAgICAgICByZXR1cm4gZmFsc2UKICAgIGVuZAplbmQKCgotLS0t6Ieq5a6a5LmJ6YeR6ZKx5Yig6ZmkCmxvY2FsIHJlbXZhbHVlID0gMTAwMDAKZnVuY3Rpb24gc2V0X3JlbW92ZV9tb25leV9hY2ModmFsdWUpCiAgICByZW12YWx1ZSA9IHZhbHVlCmVuZApmdW5jdGlvbiByZW1vdmVfbW9uZXkoKQogICAgU0VUX0lOVF9UVU5BQkxFX0dMT0JBTCgtMTU2MDM2Mjk2LCByZW12YWx1ZSkgLS0gaHR0cHM6Ly93d3cudW5rbm93bmNoZWF0cy5tZS9mb3J1bS8zMjc2MDkyLXBvc3QzLmh0bWwKICAgIFNUQVRTLlNFVF9QQUNLRURfU1RBVF9CT09MX0NPREUoMTUzODIsIHRydWUpIC0tIE1ha2VzIGFibGUgdG8gYnV5IHRoZSBCYWxsaXN0aWMgQXJtb3IKICAgIFNUQVRTLlNFVF9QQUNLRURfU1RBVF9CT09MX0NPREUoOTQ2MSwgdHJ1ZSkgLS0gTWFrZXMgeW91IGhhdmUgdGhlIEJhbGxpc3RpYyBBcm1vcgogICAgbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJub3BpbWVudWdyZXkgb24iKQogICAgaWYgdXRpbC5pc19pbnRlcmFjdGlvbl9tZW51X29wZW4oKSB0aGVuIFBBRC5TRVRfQ09OVFJPTF9WQUxVRV9ORVhUX0ZSQU1FKDAsIDI0NCwgMSkgZW5kCiAgICBTRVRfSU5UX0dMT0JBTCgyNzEwNDI4LCA4NSkgLS0gUmVuZGVycyBCYWxsaXN0aWMgRXF1aXBtZW50IFNlcnZpY2VzIHNjcmVlbiBvZiB0aGUgSW50ZXJhY3Rpb24gTWVudQogICAgUEFELlNFVF9DT05UUk9MX1ZBTFVFX05FWFRfRlJBTUUoMCwgMjQ0LCAxKSAtLSBQcmVzc2VzIE0KICAgIHV0aWwueWllbGQoMTApCiAgICBQQUQuU0VUX0NPTlRST0xfVkFMVUVfTkVYVF9GUkFNRSgwLCAxNzYsIDEpIC0tIFByZXNzZXMgRW50ZXIKZW5kCgoKLS0tLeaLlui9pgpmdW5jdGlvbiB0b3djYXJwcm8ocGlkLCBpbmRleCwgdmFsdWUpCiAgICAKICAgIGxvY2FsIHBsYXllcl9wZWQgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKQogICAgbG9jYWwgbGFzdF92ZWggPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0lOKHBsYXllcl9wZWQsIHRydWUpCiAgICBsb2NhbCBjdXJfdmVoID0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19JTihwbGF5ZXJfcGVkLCBmYWxzZSkKICAgIGlmIGxhc3RfdmVoIH49IDAgdGhlbgogICAgICAgIHJlcXVlc3RfY29udHJvbChsYXN0X3ZlaCwgMykKICAgICAgICB0b3dfaGFzaCA9IC0xMzIzMTAwOTYwCiAgICAgICAgcmVxdWVzdF9tb2RlbCh0b3dfaGFzaCkKICAgICAgICB0b3dlcl9oYXNoID0gMHg5QzlFRkZEOAogICAgICAgIHJlcXVlc3RfbW9kZWwodG93ZXJfaGFzaCkKICAgICAgICBsb2NhbCByb3RzID0gRU5USVRZLkdFVF9FTlRJVFlfUk9UQVRJT04obGFzdF92ZWgsIDApCiAgICAgICAgbG9jYWwgZGlyID0gNS4wCiAgICAgICAgaGRnID0gRU5USVRZLkdFVF9FTlRJVFlfSEVBRElORyhsYXN0X3ZlaCkKICAgICAgICBpZiBpbmRleCA9PSAyIHRoZW4KICAgICAgICAgICAgZGlyID0gLTUuMAogICAgICAgICAgICBoZGcgPSBoZGcgKyAxODAKICAgICAgICBlbmQKICAgICAgICBsb2NhbCBjb29yZHMgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMobGFzdF92ZWgsIDAuMCwgZGlyLCAwLjApCiAgICAgICAgbG9jYWwgdG93ZXIgPSBlbnRpdGllcy5jcmVhdGVfcGVkKDI4LCB0b3dlcl9oYXNoLCBjb29yZHMsIDMwLjApCiAgICAgICAgbG9jYWwgdG93dHJ1Y2sgPSBlbnRpdGllcy5jcmVhdGVfdmVoaWNsZSh0b3dfaGFzaCwgY29vcmRzLCBoZGcpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSEVBRElORyh0b3d0cnVjaywgaGRnKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0lOVklOQ0lCTEUodG93dHJ1Y2ssdHJ1ZSkKICAgICAgICBQRUQuU0VUX1BFRF9JTlRPX1ZFSElDTEUodG93ZXIsIHRvd3RydWNrLCAtMSkKICAgICAgICByZXF1ZXN0X2NvbnRyb2wobGFzdF92ZWgsIDMpCiAgICAgICAgVkVISUNMRS5BVFRBQ0hfVkVISUNMRV9UT19UT1dfVFJVQ0sodG93dHJ1Y2ssIGxhc3RfdmVoLCBmYWxzZSwgMCwgMCwgMCkKICAgICAgICBUQVNLLlRBU0tfVkVISUNMRV9EUklWRV9UT19DT09SRCh0b3dlciwgdG93dHJ1Y2ssIG1hdGgucmFuZG9tKDEwMDApLCBtYXRoLnJhbmRvbSgxMDAwKSwgbWF0aC5yYW5kb20oMTAwKSwgMTAwLCAxLCBFTlRJVFkuR0VUX0VOVElUWV9NT0RFTChsYXN0X3ZlaCksIDQsIDUsIDApCiAgICBlbmQKZW5kCgoKCi0tLS3mlYzlr7nooYzkuroKZnVuY3Rpb24gRW5lbXlfTlBDUyhwaWQpCiAgICAKICAgIGlmIG5vdCBORVRXT1JLLk5FVFdPUktfSVNfUExBWUVSX0FDVElWRShwaWQpIHRoZW4KICAgICAgICByZXR1cm4gdXRpbC5zdG9wX3RocmVhZCgpCiAgICBlbmQKICAgIGxvY2FsIHRhcmdldCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICBsb2NhbCBwU2VxdWVuY2UgPSBtZW1vcnkuYWxsb2NfaW50KCkKICAgIFRBU0suT1BFTl9TRVFVRU5DRV9UQVNLKHBTZXF1ZW5jZSkKICAgIFRBU0suVEFTS19MRUFWRV9BTllfVkVISUNMRSgwLCAwLCAyNTYpCiAgICBUQVNLLlRBU0tfQ09NQkFUX1BFRCgwLCB0YXJnZXQsIDAsIDApCiAgICBUQVNLLlRBU0tfR09fVE9fRU5USVRZKDAsIHRhcmdldCwgLTEsIDgwLjAsIDMuMCwgMC4wLCAwKQogICAgVEFTSy5DTE9TRV9TRVFVRU5DRV9UQVNLKG1lbW9yeS5yZWFkX2ludChwU2VxdWVuY2UpKQogICAgZm9yIF8sIHBlZCBpbiBpcGFpcnMoZ2V0X3BlZHNfaW5fcGxheWVyX3JhbmdlKHBpZCwgNzAuMCkpIGRvCiAgICAgICAgaWYgbm90IFBFRC5JU19QRURfQV9QTEFZRVIocGVkKSBhbmQgVEFTSy5HRVRfU0VRVUVOQ0VfUFJPR1JFU1MocGVkKSA9PSAtMSB0aGVuCiAgICAgICAgICAgIHJlcXVlc3RfY29udHJvbChwZWQpCiAgICAgICAgICAgIGxvY2FsIHdlYXBvbiA9IHRhYmxlLnJhbmRvbShFbmVteV9XZWFwb25zKQogICAgICAgICAgICBQRUQuU0VUX1BFRF9DT01CQVRfQVRUUklCVVRFUyhwZWQsIDQ2LCB0cnVlKQogICAgICAgICAgICBQRUQuU0VUX1BFRF9NQVhfSEVBTFRIKHBlZCwgMzAwKQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9IRUFMVEgocGVkLCAzMDAsIDApCiAgICAgICAgICAgIFdFQVBPTi5HSVZFX1dFQVBPTl9UT19QRUQocGVkLCB1dGlsLmpvYWF0KHdlYXBvbiksIC0xLCBmYWxzZSwgdHJ1ZSkKICAgICAgICAgICAgV0VBUE9OLlNFVF9QRURfRFJPUFNfV0VBUE9OU19XSEVOX0RFQUQocGVkLCBmYWxzZSkKICAgICAgICAgICAgVEFTSy5DTEVBUl9QRURfVEFTS1MocGVkKQogICAgICAgICAgICBUQVNLLlRBU0tfUEVSRk9STV9TRVFVRU5DRShwZWQsIG1lbW9yeS5yZWFkX2ludChwU2VxdWVuY2UpKQogICAgICAgIGVuZAogICAgZW5kCiAgICBUQVNLLkNMRUFSX1NFUVVFTkNFX1RBU0socFNlcXVlbmNlKQplbmQKCgoKLS0tLeaVjOWvuei9veWFtwpsb2NhbCBzZXRHb2Rtb2RlID0gZmFsc2UKbG9jYWwgZ3VubmVyV2VhcG9uID0gdXRpbC5qb2FhdCgid2VhcG9uX21nIikKbG9jYWwgd2VhcG9uTW9kSWQgPSAtMQpsb2NhbCBlbmVteV9jb3VudCA9IDEKRGVjb3JGbGFnX2lzRW5lbXlWZWhpY2xlID0gMSA8PCAxCgpmdW5jdGlvbiBzZXRfZW5lbXlfR29kbW9kZSh0b2dnbGUpCiAgICBzZXRHb2Rtb2RlID0gdG9nZ2xlCmVuZApmdW5jdGlvbiBzZXRfZW5lbXlfY291bnQodmFsdWUpCiAgICBlbmVteV9jb3VudCA9IHZhbHVlCmVuZApmdW5jdGlvbiBzZW5kX2VuZW15X3ZlaChpbmRleCwgb3B0aW9uLCBwaWQpCiAgICBsb2NhbCBpID0gMAogICAgdmVoX3NlbGVjdCA9IGVuZW15X3ZlaFtpbmRleF0KICAgIHdoaWxlIGkgPCBlbmVteV9jb3VudCBhbmQgcGxheWVycy5leGlzdHMocGlkKSBkbwogICAgICAgIGlmIHZlaF9zZWxlY3QgPT0gIk1pbml0YW5rIiB0aGVuCiAgICAgICAgICAgIHNwYXduX21pbml0YW5rKHBpZCkKICAgICAgICBlbHNlaWYgdmVoX3NlbGVjdCA9PSAiTGF6ZXIiIHRoZW4KICAgICAgICAgICAgc3Bhd25fbGF6ZXIocGlkKQogICAgICAgIGVsc2VpZiB2ZWhfc2VsZWN0ID09ICJCdXp6YXJkIiB0aGVuIHNwYXduX2J1enphcmQocGlkKSBlbmQKICAgICAgICBpID0gaSArIDEKICAgICAgICB1dGlsLnlpZWxkKDE1MCkKICAgIGVuZAplbmQKZnVuY3Rpb24gbWluaV90YW5rX3dlYXBvbihpbmRleCkKICAgIGlmIGluZGV4ID09IDEgdGhlbgogICAgICAgIHdlYXBvbk1vZElkID0gbWluaXRhbmtNb2RJZHMuc3RvY2tXZWFwb24KICAgIGVsc2VpZiBpbmRleCA9PSAyIHRoZW4KICAgICAgICB3ZWFwb25Nb2RJZCA9IG1pbml0YW5rTW9kSWRzLnBsYXNtYUNhbm5vbgogICAgZWxzZWlmIGluZGV4ID09IDMgdGhlbgogICAgICAgIHdlYXBvbk1vZElkID0gbWluaXRhbmtNb2RJZHMucm9ja2V0CiAgICBlbmQKZW5kCmZ1bmN0aW9uIGVuZW15X2d1bm1hbl93ZWFwb24oaW5kZXgpCiAgICBndW5uZXJXZWFwb24gPSB1dGlsLmpvYWF0KGd1bm5lcldlYXBvbnNbaW5kZXhdKQplbmQKZnVuY3Rpb24gc3Bhd25fbWluaXRhbmsodGFyZ2V0SWQpCiAgICBpZiBpc19VbHRpbWF0ZVVzZXIodGFyZ2V0SWQpIHRoZW4gdXRpbC50b2FzdChCbG9ja0F0dGFja1VsdGltYXRlVXNlcikgcmV0dXJuIGVuZAogICAgbG9jYWwgdmVoaWNsZUhhc2ggPSB1dGlsLmpvYWF0KCJtaW5pdGFuayIpCiAgICBsb2NhbCBwZWRIYXNoID0gdXRpbC5qb2FhdCgic19tX3lfYmxhY2tvcHNfMDEiKQogICAgcmVxdWVzdF9tb2RlbCh2ZWhpY2xlSGFzaCkKICAgIHJlcXVlc3RfbW9kZWwocGVkSGFzaCkKICAgIGxvY2FsIHBvcyA9IHBsYXllcnMuZ2V0X3Bvc2l0aW9uKHRhcmdldElkKQogICAgbG9jYWwgdmVoaWNsZSA9IGVudGl0aWVzLmNyZWF0ZV92ZWhpY2xlKHZlaGljbGVIYXNoLCBwb3MsIDAuMCkKICAgIGlmIG5vdCBFTlRJVFkuRE9FU19FTlRJVFlfRVhJU1QodmVoaWNsZSkgdGhlbgogICAgICAgIHJldHVybgogICAgZW5kCiAgICBORVRXT1JLLlNFVF9ORVRXT1JLX0lEX0VYSVNUU19PTl9BTExfTUFDSElORVMoTkVUV09SSy5WRUhfVE9fTkVUKHZlaGljbGUpLCB0cnVlKQogICAgRU5USVRZLlNFVF9FTlRJVFlfQVNfTUlTU0lPTl9FTlRJVFkodmVoaWNsZSwgZmFsc2UsIHRydWUpCiAgICBORVRXT1JLLlNFVF9ORVRXT1JLX0lEX0FMV0FZU19FWElTVFNfRk9SX1BMQVlFUihORVRXT1JLLlZFSF9UT19ORVQodmVoaWNsZSksIFBMQVlFUi5QTEFZRVJfSUQoKSwgdHJ1ZSkKICAgIEVOVElUWS5TRVRfRU5USVRZX0xPQURfQ09MTElTSU9OX0ZMQUcodmVoaWNsZSwgdHJ1ZSwgMSkKICAgIHNldF9kZWNvcl9mbGFnKHZlaGljbGUsIERlY29yRmxhZ19pc0VuZW15VmVoaWNsZSkKICAgIGxvY2FsIG9mZnNldCA9IGdldF9yYW5kb21fb2Zmc2V0X2Zyb21fZW50aXR5KHZlaGljbGUsIDM1LjAsIDUwLjApCiAgICBsb2NhbCBvdXRIZWFkaW5nID0gbWVtb3J5LmFsbG9jKDQpCiAgICBsb2NhbCBvdXRDb29yZHMgPSB2My5uZXcoKQogICAgaWYgUEFUSEZJTkQuR0VUX0NMT1NFU1RfVkVISUNMRV9OT0RFX1dJVEhfSEVBRElORyhvZmZzZXQueCwgb2Zmc2V0LnksIG9mZnNldC56LCBvdXRDb29yZHMsIG91dEhlYWRpbmcsIDEsIDMuMCwgMCkgdGhlbgogICAgICAgIGxvY2FsIGRyaXZlciA9IGVudGl0aWVzLmNyZWF0ZV9wZWQoNSwgcGVkSGFzaCwgb2Zmc2V0LCAwLjApCiAgICAgICAgTkVUV09SSy5TRVRfTkVUV09SS19JRF9FWElTVFNfT05fQUxMX01BQ0hJTkVTKE5FVFdPUksuUEVEX1RPX05FVChkcml2ZXIpLCB0cnVlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0FTX01JU1NJT05fRU5USVRZKGRyaXZlciwgZmFsc2UsIHRydWUpCiAgICAgICAgTkVUV09SSy5TRVRfTkVUV09SS19JRF9BTFdBWVNfRVhJU1RTX0ZPUl9QTEFZRVIoTkVUV09SSy5QRURfVE9fTkVUKGRyaXZlciksIFBMQVlFUi5QTEFZRVJfSUQoKSwgdHJ1ZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9MT0FEX0NPTExJU0lPTl9GTEFHKGRyaXZlciwgdHJ1ZSwgMSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKGRyaXZlciwgdHJ1ZSkKICAgICAgICBQRUQuU0VUX1BFRF9JTlRPX1ZFSElDTEUoZHJpdmVyLCB2ZWhpY2xlLCAtMSkKICAgICAgICBBVURJTy5TVE9QX1BFRF9TUEVBS0lORyhkcml2ZXIsIHRydWUpCiAgICAgICAgUEVELlNFVF9QRURfQ09NQkFUX0FUVFJJQlVURVMoZHJpdmVyLCA0NiwgdHJ1ZSkKICAgICAgICBQRUQuU0VUX1BFRF9DT01CQVRfQVRUUklCVVRFUyhkcml2ZXIsIDEsIHRydWUpCiAgICAgICAgUEVELlNFVF9QRURfQ09NQkFUX0FUVFJJQlVURVMoZHJpdmVyLCAzLCBmYWxzZSkKICAgICAgICBQRUQuU0VUX1BFRF9DT01CQVRfUkFOR0UoZHJpdmVyLCAyKQogICAgICAgIFBFRC5TRVRfUEVEX1NFRUlOR19SQU5HRShkcml2ZXIsIDEwMDAuMCkKICAgICAgICBQRUQuU0VUX1BFRF9TSE9PVF9SQVRFKGRyaXZlciwgMTAwMCkKICAgICAgICBQRUQuU0VUX0JMT0NLSU5HX09GX05PTl9URU1QT1JBUllfRVZFTlRTKGRyaXZlciwgdHJ1ZSkKICAgICAgICBUQVNLLlNFVF9EUklWRV9UQVNLX0RSSVZJTkdfU1RZTEUoZHJpdmVyLCA3ODY0NjgpCgogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEUyh2ZWhpY2xlLCBvdXRDb29yZHMueCwgb3V0Q29vcmRzLnksIG91dENvb3Jkcy56LCBmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9IRUFESU5HKHZlaGljbGUsIG1lbW9yeS5yZWFkX2Zsb2F0KG91dEhlYWRpbmcpKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0lOVklOQ0lCTEUodmVoaWNsZSwgc2V0R29kbW9kZSkKICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX01PRF9LSVQodmVoaWNsZSwgMCkKICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX01PRCh2ZWhpY2xlLCAxMCwgd2VhcG9uTW9kSWQsIGZhbHNlKQogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRU5HSU5FX09OKHZlaGljbGUsIHRydWUsIHRydWUsIHRydWUpCiAgICAgICAgbG9jYWwgYmxpcCA9IGFkZF9ibGlwX2Zvcl9lbnRpdHkodmVoaWNsZSwgNzQyLCA0KQoKICAgICAgICB1dGlsLmNyZWF0ZV90aWNrX2hhbmRsZXIoZnVuY3Rpb24oKQogICAgICAgICAgICBsb2NhbCB0YXJnZXQgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRURfU0NSSVBUX0lOREVYKHRhcmdldElkKQogICAgICAgICAgICBsb2NhbCB2ZWhQb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFModmVoaWNsZSwgZmFsc2UpCiAgICAgICAgICAgIGlmIG5vdCBFTlRJVFkuRE9FU19FTlRJVFlfRVhJU1QodmVoaWNsZSkgb3IgRU5USVRZLklTX0VOVElUWV9ERUFEKHZlaGljbGUsIGZhbHNlKSBvciBub3QgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKGRyaXZlcikgb3IgUEVELklTX1BFRF9JTkpVUkVEKGRyaXZlcikgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgIGVsc2VpZiBub3QgUEVELklTX1BFRF9JTl9DT01CQVQoZHJpdmVyLCB0YXJnZXQpIGFuZCBub3QgUEVELklTX1BFRF9JTkpVUkVEKHRhcmdldCkgdGhlbgogICAgICAgICAgICAgICAgVEFTSy5DTEVBUl9QRURfVEFTS1MoZHJpdmVyKQogICAgICAgICAgICAgICAgVEFTSy5UQVNLX0NPTUJBVF9QRUQoZHJpdmVyLCB0YXJnZXQsIDAsIDE2KQogICAgICAgICAgICAgICAgUEVELlNFVF9QRURfS0VFUF9UQVNLKGRyaXZlciwgdHJ1ZSkKICAgICAgICAgICAgZWxzZWlmIG5vdCBORVRXT1JLLk5FVFdPUktfSVNfUExBWUVSX0FDVElWRSh0YXJnZXRJZCkgb3IgcGxheWVycy5nZXRfcG9zaXRpb24odGFyZ2V0SWQpOmRpc3RhbmNlKHZlaFBvcykgPiAxMDAwLjAgdGhlbgogICAgICAgICAgICAgICAgVEFTSy5DTEVBUl9QRURfVEFTS1MoZHJpdmVyKQogICAgICAgICAgICAgICAgUEVELlNFVF9QRURfQ09NQkFUX0FUVFJJQlVURVMoZHJpdmVyLCA0NiwgZmFsc2UpCiAgICAgICAgICAgICAgICBUQVNLLlRBU0tfVkVISUNMRV9EUklWRV9XQU5ERVIoZHJpdmVyLCB2ZWhpY2xlLCAxMC4wLCA3ODY2MDMpCiAgICAgICAgICAgICAgICBQRUQuU0VUX1BFRF9LRUVQX1RBU0soZHJpdmVyLCB0cnVlKQogICAgICAgICAgICAgICAgcmVtb3ZlX2RlY29yKHZlaGljbGUpCiAgICAgICAgICAgICAgICB1dGlsLnJlbW92ZV9ibGlwKGJsaXApCiAgICAgICAgICAgICAgICBsb2NhbCBwVmVoaWNsZSA9IG1lbW9yeS5hbGxvY19pbnQoKQogICAgICAgICAgICAgICAgbWVtb3J5LndyaXRlX2ludChwVmVoaWNsZSwgdmVoaWNsZSkKICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfVkVISUNMRV9BU19OT19MT05HRVJfTkVFREVEKHBWZWhpY2xlKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVuZAogICAgU1RSRUFNSU5HLlNFVF9NT0RFTF9BU19OT19MT05HRVJfTkVFREVEKHZlaGljbGVIYXNoKQogICAgU1RSRUFNSU5HLlNFVF9NT0RFTF9BU19OT19MT05HRVJfTkVFREVEKHBlZEhhc2gpCmVuZApmdW5jdGlvbiBzcGF3bl9idXp6YXJkKHRhcmdldElkKQogICAgbG9jYWwgdmVoaWNsZUhhc2ggPGNvbnN0PiA9IHV0aWwuam9hYXQoImJ1enphcmQiKQogICAgbG9jYWwgcGVkSGFzaCA8Y29uc3Q+ID0gdXRpbC5qb2FhdCgic19tX3lfYmxhY2tvcHNfMDEiKQogICAgcmVxdWVzdF9tb2RlbCh2ZWhpY2xlSGFzaCk7CXJlcXVlc3RfbW9kZWwocGVkSGFzaCkKICAgIGxvY2FsIHRhcmdldCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRF9TQ1JJUFRfSU5ERVgodGFyZ2V0SWQpCiAgICBsb2NhbCBwbGF5ZXJSZWxHcm91cCA9IFBFRC5HRVRfUEVEX1JFTEFUSU9OU0hJUF9HUk9VUF9IQVNIKHRhcmdldCkKICAgIFBFRC5TRVRfUkVMQVRJT05TSElQX0JFVFdFRU5fR1JPVVBTKDUsIHV0aWwuam9hYXQoIkFSTVkiKSwgcGxheWVyUmVsR3JvdXApCiAgICBQRUQuU0VUX1JFTEFUSU9OU0hJUF9CRVRXRUVOX0dST1VQUyg1LCBwbGF5ZXJSZWxHcm91cCwgdXRpbC5qb2FhdCgiQVJNWSIpKQogICAgUEVELlNFVF9SRUxBVElPTlNISVBfQkVUV0VFTl9HUk9VUFMoMCwgdXRpbC5qb2FhdCgiQVJNWSIpLCB1dGlsLmpvYWF0KCJBUk1ZIikpCgogICAgbG9jYWwgcG9zID0gcGxheWVycy5nZXRfcG9zaXRpb24odGFyZ2V0SWQpCiAgICBsb2NhbCBoZWxpID0gZW50aXRpZXMuY3JlYXRlX3ZlaGljbGUodmVoaWNsZUhhc2gsIHBvcywgQ0FNLkdFVF9HQU1FUExBWV9DQU1fUk9UKDApLnopCiAgICBpZiBFTlRJVFkuRE9FU19FTlRJVFlfRVhJU1QoaGVsaSkgdGhlbgogICAgICAgIE5FVFdPUksuU0VUX05FVFdPUktfSURfRVhJU1RTX09OX0FMTF9NQUNISU5FUyhORVRXT1JLLlZFSF9UT19ORVQoaGVsaSksIHRydWUpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQVNfTUlTU0lPTl9FTlRJVFkoaGVsaSwgZmFsc2UsIHRydWUpCiAgICAgICAgTkVUV09SSy5TRVRfTkVUV09SS19JRF9BTFdBWVNfRVhJU1RTX0ZPUl9QTEFZRVIoTkVUV09SSy5WRUhfVE9fTkVUKGhlbGkpLCBQTEFZRVIuUExBWUVSX0lEKCksIHRydWUpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfTE9BRF9DT0xMSVNJT05fRkxBRyhoZWxpLCB0cnVlLCAxKQogICAgICAgIHNldF9kZWNvcl9mbGFnKGhlbGksIERlY29yRmxhZ19pc0VuZW15VmVoaWNsZSkKICAgICAgICBsb2NhbCBwb3MxID0gZ2V0X3JhbmRvbV9vZmZzZXRfZnJvbV9lbnRpdHkodGFyZ2V0LCAyMC4wLCA0MC4wKQogICAgICAgIHBvczEueiA9IHBvczEueiArIDIwLjAKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFMoaGVsaSwgcG9zMS54LCBwb3MxLnksIHBvczEueiwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgTkVUV09SSy5TRVRfTkVUV09SS19JRF9DQU5fTUlHUkFURShORVRXT1JLLlZFSF9UT19ORVQoaGVsaSksIGZhbHNlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0lOVklOQ0lCTEUoaGVsaSwgc2V0R29kbW9kZSkKICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0VOR0lORV9PTihoZWxpLCB0cnVlLCB0cnVlLCB0cnVlKQogICAgICAgIFZFSElDTEUuU0VUX0hFTElfQkxBREVTX0ZVTExfU1BFRUQoaGVsaSkKICAgICAgICBsb2NhbCBibGlwID0gYWRkX2JsaXBfZm9yX2VudGl0eShoZWxpLCA0MjIsIDQpCiAgICAgICAgc2V0X2JsaXBfbmFtZShibGlwLCAiYnV6emFyZDIiLCB0cnVlKQoKICAgICAgICBsb2NhbCBwaWxvdCA9IGVudGl0aWVzLmNyZWF0ZV9wZWQoMjksIHBlZEhhc2gsIHBvczEsIENBTS5HRVRfR0FNRVBMQVlfQ0FNX1JPVCgwKS56KQogICAgICAgIFBFRC5TRVRfUEVEX0lOVE9fVkVISUNMRShwaWxvdCwgaGVsaSwgLTEpCiAgICAgICAgUEVELlNFVF9QRURfTUFYX0hFQUxUSChwaWxvdCwgNTAwKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0hFQUxUSChwaWxvdCwgNTAwLCAwKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0lOVklOQ0lCTEUocGlsb3QsIHNldEdvZG1vZGUpCiAgICAgICAgUEVELlNFVF9CTE9DS0lOR19PRl9OT05fVEVNUE9SQVJZX0VWRU5UUyhwaWxvdCwgdHJ1ZSkKICAgICAgICBQRUQuU0VUX1BFRF9LRUVQX1RBU0socGlsb3QsIHRydWUpCiAgICAgICAgVEFTSy5UQVNLX0hFTElfTUlTU0lPTihwaWxvdCwgaGVsaSwgMCwgdGFyZ2V0LCAwLjAsIDAuMCwgMC4wLCAyMywgNDAuMCwgNDAuMCwgLTEuMCwgMCwgMTAsIC0xLjAsIDApCgogICAgICAgIGZvciBzZWF0ID0gMSwgMiBkbwogICAgICAgICAgICBsb2NhbCBwZWQgPSBlbnRpdGllcy5jcmVhdGVfcGVkKDI5LCBwZWRIYXNoLCBwb3MxLCBDQU0uR0VUX0dBTUVQTEFZX0NBTV9ST1QoMCkueikKICAgICAgICAgICAgUEVELlNFVF9QRURfSU5UT19WRUhJQ0xFKHBlZCwgaGVsaSwgc2VhdCkKICAgICAgICAgICAgV0VBUE9OLkdJVkVfV0VBUE9OX1RPX1BFRChwZWQsIGd1bm5lcldlYXBvbiwgLTEsIGZhbHNlLCB0cnVlKQogICAgICAgICAgICBQRUQuU0VUX1BFRF9DT01CQVRfQVRUUklCVVRFUyhwZWQsIDIwLCB0cnVlKQogICAgICAgICAgICBQRUQuU0VUX1BFRF9NQVhfSEVBTFRIKHBlZCwgNTAwKQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9IRUFMVEgocGVkLCA1MDAsIDApCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0lOVklOQ0lCTEUocGVkLCBzZXRHb2Rtb2RlKQogICAgICAgICAgICBQRUQuU0VUX1BFRF9TSE9PVF9SQVRFKHBlZCwgMTAwMCkKICAgICAgICAgICAgUEVELlNFVF9QRURfUkVMQVRJT05TSElQX0dST1VQX0hBU0gocGVkLCB1dGlsLmpvYWF0KCJBUk1ZIikpCiAgICAgICAgICAgIFRBU0suVEFTS19DT01CQVRfSEFURURfVEFSR0VUU19BUk9VTkRfUEVEKHBlZCwgMjAwLjAsIDApCiAgICAgICAgZW5kCiAgICBlbmQKICAgIFNUUkVBTUlORy5TRVRfTU9ERUxfQVNfTk9fTE9OR0VSX05FRURFRChwZWRIYXNoKQogICAgU1RSRUFNSU5HLlNFVF9NT0RFTF9BU19OT19MT05HRVJfTkVFREVEKHZlaGljbGVIYXNoKQplbmQKZnVuY3Rpb24gc3Bhd25fbGF6ZXIodGFyZ2V0SWQpCiAgICBsb2NhbCBqZXRIYXNoID0gdXRpbC5qb2FhdCgibGF6ZXIiKQogICAgbG9jYWwgcGVkSGFzaCA9IHV0aWwuam9hYXQoInNfbV95X2JsYWNrb3BzXzAxIikKICAgIHJlcXVlc3RfbW9kZWwoamV0SGFzaCkKICAgIHJlcXVlc3RfbW9kZWwocGVkSGFzaCkKICAgIGxvY2FsIHRhcmdldCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRF9TQ1JJUFRfSU5ERVgodGFyZ2V0SWQpCiAgICBsb2NhbCBwb3MgPSBwbGF5ZXJzLmdldF9wb3NpdGlvbih0YXJnZXRJZCkKICAgIGxvY2FsIGpldCA9IGVudGl0aWVzLmNyZWF0ZV92ZWhpY2xlKGpldEhhc2gsIHBvcywgQ0FNLkdFVF9HQU1FUExBWV9DQU1fUk9UKDApLnopCiAgICBpZiBFTlRJVFkuRE9FU19FTlRJVFlfRVhJU1QoamV0KSB0aGVuCiAgICAgICAgTkVUV09SSy5TRVRfTkVUV09SS19JRF9FWElTVFNfT05fQUxMX01BQ0hJTkVTKE5FVFdPUksuVkVIX1RPX05FVChqZXQpLCB0cnVlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0FTX01JU1NJT05fRU5USVRZKGpldCwgZmFsc2UsIHRydWUpCiAgICAgICAgTkVUV09SSy5TRVRfTkVUV09SS19JRF9BTFdBWVNfRVhJU1RTX0ZPUl9QTEFZRVIoTkVUV09SSy5WRUhfVE9fTkVUKGpldCksIFBMQVlFUi5QTEFZRVJfSUQoKSwgdHJ1ZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9MT0FEX0NPTExJU0lPTl9GTEFHKGpldCwgdHJ1ZSwgMSkKICAgICAgICBzZXRfZGVjb3JfZmxhZyhqZXQsIERlY29yRmxhZ19pc0VuZW15VmVoaWNsZSkKICAgICAgICBsb2NhbCBwb3MxID0gZ2V0X3JhbmRvbV9vZmZzZXRfZnJvbV9lbnRpdHkoamV0LCAzMC4wLCA4MC4wKQogICAgICAgIHBvczEueiA9IHBvczEueiArIDUwMC4wCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTKGpldCwgcG9zMS54LCBwb3MxLnksIHBvczEueiwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgc2V0X2VudGl0eV9mYWNlX2VudGl0eShqZXQsIHRhcmdldCwgZmFsc2UpCiAgICAgICAgbG9jYWwgYmxpcCA9IGFkZF9ibGlwX2Zvcl9lbnRpdHkoamV0LCAxNiwgNCkKICAgICAgICBzZXRfYmxpcF9uYW1lKGJsaXAsICJibGlwXzR4ejY2bTAiLCB0cnVlKSAtLSByYW5kb20gY29sbGlzaW9uIGZvciAweDIyNTdDOTdGCiAgICAgICAgVkVISUNMRS5DT05UUk9MX0xBTkRJTkdfR0VBUihqZXQsIDMpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRShqZXQsIHNldEdvZG1vZGUpCiAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9GT1JDRV9BRlRFUkJVUk5FUihqZXQsIHRydWUpCgogICAgICAgIGxvY2FsIHBpbG90ID0gZW50aXRpZXMuY3JlYXRlX3BlZCg1LCBwZWRIYXNoLCBwb3MxLCBDQU0uR0VUX0dBTUVQTEFZX0NBTV9ST1QoMCkueikKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9BU19NSVNTSU9OX0VOVElUWShwaWxvdCwgZmFsc2UsIHRydWUpCiAgICAgICAgUEVELlNFVF9QRURfSU5UT19WRUhJQ0xFKHBpbG90LCBqZXQsIC0xKQogICAgICAgIFRBU0suVEFTS19QTEFORV9NSVNTSU9OKHBpbG90LCBqZXQsIDAsIHRhcmdldCwgMC4wLCAwLjAsIDAuMCwgNiwgMTAwLjAsIDAuMCwgMC4wLCA4MC4wLCA1MC4wLCBmYWxzZSkKICAgICAgICBQRUQuU0VUX1BFRF9DT01CQVRfQVRUUklCVVRFUyhwaWxvdCwgMSwgdHJ1ZSkKICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0ZPUldBUkRfU1BFRUQoamV0LCA2MC4wKQogICAgZW5kCiAgICBTVFJFQU1JTkcuU0VUX01PREVMX0FTX05PX0xPTkdFUl9ORUVERUQoamV0SGFzaCkKICAgIFNUUkVBTUlORy5TRVRfTU9ERUxfQVNfTk9fTE9OR0VSX05FRURFRChwZWRIYXNoKQplbmQKZnVuY3Rpb24gZGVsZXRlVmVoaWNsZVBhc3NlbmdlcnModmVoaWNsZSkKICAgIGZvciBzZWF0ID0gLTEsIFZFSElDTEUuR0VUX1ZFSElDTEVfTUFYX05VTUJFUl9PRl9QQVNTRU5HRVJTKHZlaGljbGUpIC0xIGRvCiAgICAgICAgaWYgbm90IFZFSElDTEUuSVNfVkVISUNMRV9TRUFUX0ZSRUUodmVoaWNsZSwgc2VhdCwgZmFsc2UpIHRoZW4KICAgICAgICAgICAgbG9jYWwgcGFzc2VuZ2VyID0gVkVISUNMRS5HRVRfUEVEX0lOX1ZFSElDTEVfU0VBVCh2ZWhpY2xlLCBzZWF0LCBmYWxzZSkKICAgICAgICAgICAgZGVsZXRlX2VudGl0eShwYXNzZW5nZXIpIAogICAgICAgIGVuZAogICAgZW5kCmVuZApmdW5jdGlvbiBkZWxldGVfZW5lbXlfdmVoKCkKICAgIGZvciBfLCB2ZWhpY2xlIGluIGlwYWlycyhlbnRpdGllcy5nZXRfYWxsX3ZlaGljbGVzX2FzX2hhbmRsZXMoKSkgZG8KICAgICAgICBpZiBpc19kZWNvcl9mbGFnX3NldCh2ZWhpY2xlLCBEZWNvckZsYWdfaXNFbmVteVZlaGljbGUpIGFuZCByZXF1ZXN0X2NvbnRyb2wodmVoaWNsZSwgMTAwMCkgdGhlbgogICAgICAgICAgICBkZWxldGVWZWhpY2xlUGFzc2VuZ2Vycyh2ZWhpY2xlKQogICAgICAgICAgICBkZWxldGVfZW50aXR5KHZlaGljbGUpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgoKCi0tLS3mgbbmkJ7ovb3lhbcKbG9jYWwgc2V0SW52aW5jaWJsZSA9IGZhbHNlCmxvY2FsIGV2Y291bnQgPSAxCmxvY2FsIEF0dGFja1R5cGUgPGNvbnN0PiA9IHtleHBsb2RlID0gMCwgZHJvcE1pbmUgPSAxfQpsb2NhbCBhdHRhY2t0eXBlID0gMApsb2NhbCBzZWxlY3RlZE1pbmUgPSAxCmxvY2FsIG1pbmVTbGlkZXIKZnVuY3Rpb24gc2VuZF92ZWhfYXR0YWNrX2dvZCh0b2dnbGUpCiAgICBzZXRJbnZpbmNpYmxlID0gdG9nZ2xlIAplbmQKZnVuY3Rpb24gc2VuZF92ZWhfYXR0YWNrZXJfbnVtYmVyKHZhbHVlKQogICAgZXZjb3VudCA9IHZhbHVlCmVuZApsb2NhbCBEZWNvckZsYWdfaXNUcm9sbHlWZWhpY2xlID0gMSA8PCAwCmZ1bmN0aW9uIGRlbGVfYWxsX3ZlaF9hdHRhY2tlcigpCiAgICBmb3IgXywgdmVoaWNsZSBpbiBpcGFpcnMoZW50aXRpZXMuZ2V0X2FsbF92ZWhpY2xlc19hc19oYW5kbGVzKCkpIGRvCiAgICAgICAgaWYgaXNfZGVjb3JfZmxhZ19zZXQodmVoaWNsZSwgRGVjb3JGbGFnX2lzVHJvbGx5VmVoaWNsZSkgdGhlbgogICAgICAgICAgICBsb2NhbCBkcml2ZXIgPSBWRUhJQ0xFLkdFVF9QRURfSU5fVkVISUNMRV9TRUFUKHZlaGljbGUsIC0xLCBmYWxzZSkKICAgICAgICAgICAgZGVsZXRlX2VudGl0eShkcml2ZXIpCiAgICAgICAgICAgIGRlbGV0ZV9lbnRpdHkodmVoaWNsZSkKICAgICAgICBlbmQKICAgIGVuZAplbmQKZnVuY3Rpb24gY3JlYXRlX3Ryb2xseV92ZWhpY2xlKHRhcmdldElkLCB2ZWhpY2xlSGFzaCwgcGVkSGFzaCkKICAgIGlmIGlzX1VsdGltYXRlVXNlcih0YXJnZXRJZCkgdGhlbiB1dGlsLnRvYXN0KEJsb2NrQXR0YWNrVWx0aW1hdGVVc2VyKSByZXR1cm4gZW5kCiAgICByZXF1ZXN0X21vZGVsKHZlaGljbGVIYXNoKTsgcmVxdWVzdF9tb2RlbChwZWRIYXNoKQogICAgbG9jYWwgdGFyZ2V0UGVkID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEX1NDUklQVF9JTkRFWCh0YXJnZXRJZCkKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyh0YXJnZXRQZWQsIGZhbHNlKQogICAgbG9jYWwgZHJpdmVyID0gMAogICAgbG9jYWwgdmVoaWNsZSA9IGVudGl0aWVzLmNyZWF0ZV92ZWhpY2xlKHZlaGljbGVIYXNoLCBwb3MsIDAuMCkKICAgIE5FVFdPUksuU0VUX05FVFdPUktfSURfRVhJU1RTX09OX0FMTF9NQUNISU5FUyhORVRXT1JLLlZFSF9UT19ORVQodmVoaWNsZSksIHRydWUpCiAgICBFTlRJVFkuU0VUX0VOVElUWV9BU19NSVNTSU9OX0VOVElUWSh2ZWhpY2xlLCBmYWxzZSwgdHJ1ZSkKICAgIE5FVFdPUksuU0VUX05FVFdPUktfSURfQUxXQVlTX0VYSVNUU19GT1JfUExBWUVSKE5FVFdPUksuVkVIX1RPX05FVCh2ZWhpY2xlKSwgUExBWUVSLlBMQVlFUl9JRCgpLCB0cnVlKQogICAgRU5USVRZLlNFVF9FTlRJVFlfTE9BRF9DT0xMSVNJT05fRkxBRyh2ZWhpY2xlLCB0cnVlLCAxKQogICAgc2V0X2RlY29yX2ZsYWcodmVoaWNsZSwgRGVjb3JGbGFnX2lzVHJvbGx5VmVoaWNsZSkKICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfTU9EX0tJVCh2ZWhpY2xlLCAwKQogICAgZm9yIGkgPSAwLCA1MCBkbwogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfTU9EKHZlaGljbGUsIGksIFZFSElDTEUuR0VUX05VTV9WRUhJQ0xFX01PRFModmVoaWNsZSwgaSkgLSAxLCBmYWxzZSkKICAgIGVuZAogICAgbG9jYWwgb2Zmc2V0ID0gZ2V0X3JhbmRvbV9vZmZzZXRfZnJvbV9lbnRpdHkodmVoaWNsZSwgMjUuMCwgMjUuMCkKICAgIGxvY2FsIG91dENvb3JkcyA9IHYzLm5ldygpCiAgICBpZiBQQVRIRklORC5HRVRfQ0xPU0VTVF9WRUhJQ0xFX05PREUob2Zmc2V0LngsIG9mZnNldC55LCBvZmZzZXQueiwgb3V0Q29vcmRzLCAxLCAzLjAsIDAuMCkgdGhlbgogICAgICAgIGRyaXZlciA9IGVudGl0aWVzLmNyZWF0ZV9wZWQoNSwgcGVkSGFzaCwgcG9zLCAwLjApCiAgICAgICAgTkVUV09SSy5TRVRfTkVUV09SS19JRF9FWElTVFNfT05fQUxMX01BQ0hJTkVTKE5FVFdPUksuUEVEX1RPX05FVChkcml2ZXIpLCB0cnVlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0FTX01JU1NJT05fRU5USVRZKGRyaXZlciwgdHJ1ZSwgdHJ1ZSkKICAgICAgICBORVRXT1JLLlNFVF9ORVRXT1JLX0lEX0FMV0FZU19FWElTVFNfRk9SX1BMQVlFUihORVRXT1JLLlBFRF9UT19ORVQoZHJpdmVyKSwgUExBWUVSLlBMQVlFUl9JRCgpLCB0cnVlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0xPQURfQ09MTElTSU9OX0ZMQUcoZHJpdmVyLCB0cnVlLCAxKQogICAgICAgIFBFRC5TRVRfUEVEX0lOVE9fVkVISUNMRShkcml2ZXIsIHZlaGljbGUsIC0xKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEUyh2ZWhpY2xlLCBvdXRDb29yZHMueCwgb3V0Q29vcmRzLnksIG91dENvb3Jkcy56LCBmYWxzZSwgZmFsc2UsIGZhbHNlLCB0cnVlKQogICAgICAgIHNldF9lbnRpdHlfZmFjZV9lbnRpdHkodmVoaWNsZSwgdGFyZ2V0UGVkLCBmYWxzZSkKICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0VOR0lORV9PTih2ZWhpY2xlLCB0cnVlLCB0cnVlLCB0cnVlKQogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRE9PUlNfTE9DS0VEX0ZPUl9BTExfUExBWUVSUyh2ZWhpY2xlLCB0cnVlKQogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfSVNfQ09OU0lERVJFRF9CWV9QTEFZRVIodmVoaWNsZSwgZmFsc2UpCiAgICAgICAgUEVELlNFVF9QRURfQ09NQkFUX0FUVFJJQlVURVMoZHJpdmVyLCAxLCB0cnVlKQogICAgICAgIFBFRC5TRVRfUEVEX0NPTUJBVF9BVFRSSUJVVEVTKGRyaXZlciwgMywgZmFsc2UpCiAgICAgICAgUEVELlNFVF9CTE9DS0lOR19PRl9OT05fVEVNUE9SQVJZX0VWRU5UUyhkcml2ZXIsIHRydWUpCiAgICAgICAgVEFTSy5UQVNLX1ZFSElDTEVfTUlTU0lPTl9QRURfVEFSR0VUKGRyaXZlciwgdmVoaWNsZSwgdGFyZ2V0UGVkLCA2LCA1MDAuMCwgNzg2OTg4LCAwLjAsIDAuMCwgdHJ1ZSkKICAgICAgICBQRUQuU0VUX1BFRF9DQU5fQkVfS05PQ0tFRF9PRkZfVkVISUNMRShkcml2ZXIsIDEpCiAgICAgICAgU1RSRUFNSU5HLlNFVF9NT0RFTF9BU19OT19MT05HRVJfTkVFREVEKHBlZEhhc2gpCiAgICAgICAgU1RSRUFNSU5HLlNFVF9NT0RFTF9BU19OT19MT05HRVJfTkVFREVEKHZlaGljbGVIYXNoKQogICAgZW5kCiAgICByZXR1cm4gdmVoaWNsZSwgZHJpdmVyCmVuZApmdW5jdGlvbiBzZW5kX3ZlaF9hdHRhY2sob3B0LCBpbmRleCwgcGlkKQogICAgbG9jYWwgcGVkSGFzaCA9IHV0aWwuam9hYXQoIm1wX21fZnJlZW1vZGVfMDEiKQoJCWxvY2FsIGkgPSAwCgkJcmVwZWF0CgkJCWlmIG9wdCA9PSAiQmFuZGl0byIgdGhlbgoJCQkJbG9jYWwgdmVoaWNsZUhhc2ggPSB1dGlsLmpvYWF0KCJyY2JhbmRpdG8iKQoJCQkJbG9jYWwgdmVoaWNsZSwgZHJpdmVyID0gY3JlYXRlX3Ryb2xseV92ZWhpY2xlKHBpZCwgdmVoaWNsZUhhc2gsIHBlZEhhc2gpCgkJCQlhZGRfYmxpcF9mb3JfZW50aXR5KHZlaGljbGUsIDY0NiwgNCkKCQkJCUVOVElUWS5TRVRfRU5USVRZX0lOVklOQ0lCTEUodmVoaWNsZSwgc2V0SW52aW5jaWJsZSkKCQkJCUVOVElUWS5TRVRfRU5USVRZX1ZJU0lCTEUoZHJpdmVyLCBmYWxzZSwgZmFsc2UpCgoJCQllbHNlaWYgb3B0ID09ICJHby1LYXJ0IiB0aGVuCgkJCQlsb2NhbCB2ZWhpY2xlSGFzaCA9IHV0aWwuam9hYXQoInZldG8yIikKCQkJCWxvY2FsIGdva2FydCwgZHJpdmVyID0gY3JlYXRlX3Ryb2xseV92ZWhpY2xlKHBpZCwgdmVoaWNsZUhhc2gsIHBlZEhhc2gpCgkJCQlFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKGdva2FydCwgc2V0SW52aW5jaWJsZSkKCQkJCVZFSElDTEUuU0VUX1ZFSElDTEVfQ09MT1VSUyhnb2thcnQsIDg5LCAwKQoJCQkJVkVISUNMRS5UT0dHTEVfVkVISUNMRV9NT0QoZ29rYXJ0LCAxOCwgdHJ1ZSkKCQkJCUVOVElUWS5TRVRfRU5USVRZX0lOVklOQ0lCTEUoZHJpdmVyLCBzZXRJbnZpbmNpYmxlKQoKCQkJCVBFRC5TRVRfUEVEX0NPTVBPTkVOVF9WQVJJQVRJT04oZHJpdmVyLCAzLCAxMTEsIDEzLCAyKQoJCQkJUEVELlNFVF9QRURfQ09NUE9ORU5UX1ZBUklBVElPTihkcml2ZXIsIDQsIDY3LCA1LCAyKQoJCQkJUEVELlNFVF9QRURfQ09NUE9ORU5UX1ZBUklBVElPTihkcml2ZXIsIDYsIDEwMSwgMSwgMikKCQkJCVBFRC5TRVRfUEVEX0NPTVBPTkVOVF9WQVJJQVRJT04oZHJpdmVyLCA4LCAtMSwgLTEsIDIpCgkJCQlQRUQuU0VUX1BFRF9DT01QT05FTlRfVkFSSUFUSU9OKGRyaXZlciwgMTEsIDE0OCwgNSwgMikKCQkJCVBFRC5TRVRfUEVEX1BST1BfSU5ERVgoZHJpdmVyLCAwLCA5MSwgMCwgdHJ1ZSkKCQkJCWFkZF9ibGlwX2Zvcl9lbnRpdHkoZ29rYXJ0LCA3NDgsIDUpCgkJCWVuZAoJCQlpID0gaSArIDEKCQkJdXRpbC55aWVsZCgxNTApCgkJdW50aWwgaSA9PSBldmNvdW50CiAgICBlbmQKLS3mraboo4XliqvljKoKZnVuY3Rpb24gR2V0TWluZUhhc2goKQogICAgaWYgc2VsZWN0ZWRNaW5lID09IDEgdGhlbgogICAgICAgIHJldHVybiB1dGlsLmpvYWF0KCJ2ZWhpY2xlX3dlYXBvbl9taW5lX2tpbmV0aWNfcmMiKQogICAgZWxzZWlmIHNlbGVjdGVkTWluZSA9PSAyIHRoZW4KICAgICAgICByZXR1cm4gdXRpbC5qb2FhdCgidmVoaWNsZV93ZWFwb25fbWluZV9lbXBfcmMiKQogICAgZW5kCmVuZApmdW5jdGlvbiBzZW5kX3ZlaF9hdHRhY2tlcihwaWQpCiAgICBsb2NhbCB2ZWhpY2xlSGFzaCA8Y29uc3Q+ID0gdXRpbC5qb2FhdCgicmNiYW5kaXRvIikKICAgIGxvY2FsIHBlZEhhc2ggPGNvbnN0PiA9IHV0aWwuam9hYXQoIm1wX21fZnJlZW1vZGVfMDEiKQogICAgbG9jYWwgbGFzdFNob290ID0gbmV3VGltZXIoKQoKICAgIGxvY2FsIGJhbmRpdG8sIGRyaXZlciA9IGNyZWF0ZV90cm9sbHlfdmVoaWNsZShwaWQsIHZlaGljbGVIYXNoLCBwZWRIYXNoKQogICAgVkVISUNMRS5TRVRfVkVISUNMRV9NT0QoYmFuZGl0bywgNSwgMywgZmFsc2UpCiAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX01PRChiYW5kaXRvLCA0OCwgNSwgZmFsc2UpCiAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX01PRChiYW5kaXRvLCA5LCAwLCBmYWxzZSkKICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfQ1VTVE9NX1BSSU1BUllfQ09MT1VSKGJhbmRpdG8sIDEyOCwgMCwgMTI4KQogICAgVkVISUNMRS5TRVRfVkVISUNMRV9DVVNUT01fU0VDT05EQVJZX0NPTE9VUihiYW5kaXRvLCAxMjgsIDAsIDEyOCkKICAgIEVOVElUWS5TRVRfRU5USVRZX1ZJU0lCTEUoZHJpdmVyLCBmYWxzZSwgZmFsc2UpCiAgICBsb2NhbCBibGlwID0gYWRkX2JsaXBfZm9yX2VudGl0eShiYW5kaXRvLCA2NDYsIDI3KQoKICAgIHV0aWwuY3JlYXRlX3RpY2tfaGFuZGxlcihmdW5jdGlvbigpCiAgICAgICAgaWYgbm90IEVOVElUWS5ET0VTX0VOVElUWV9FWElTVChiYW5kaXRvKSBvciBFTlRJVFkuSVNfRU5USVRZX0RFQUQoYmFuZGl0bywgZmFsc2UpIG9yIG5vdCBFTlRJVFkuRE9FU19FTlRJVFlfRVhJU1QoZHJpdmVyKSBvciBFTlRJVFkuSVNfRU5USVRZX0RFQUQoZHJpdmVyLCBmYWxzZSkgdGhlbgogICAgICAgICAgICBzZXRfZW50aXR5X2FzX25vX2xvbmdlcl9uZWVkZWQoYmFuZGl0bykKICAgICAgICAgICAgc2V0X2VudGl0eV9hc19ub19sb25nZXJfbmVlZGVkKGRyaXZlcikKICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgZWxzZWlmIE5FVFdPUksuTkVUV09SS19JU19QTEFZRVJfQUNUSVZFKHBpZCkgdGhlbgogICAgICAgICAgICBsb2NhbCBwbGF5ZXJQb3MgPSBwbGF5ZXJzLmdldF9wb3NpdGlvbihwaWQpCiAgICAgICAgICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhiYW5kaXRvLCB0cnVlKQoKICAgICAgICAgICAgaWYgcGxheWVyUG9zOmRpc3RhbmNlKHBvcykgPiAzLjAgb3Igbm90IHJlcXVlc3RfY29udHJvbChiYW5kaXRvKSBvciBub3QgcmVxdWVzdF9jb250cm9sKGRyaXZlcikgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgYXR0YWNrdHlwZSA9PSBBdHRhY2tUeXBlLmV4cGxvZGUgdGhlbgogICAgICAgICAgICAgICAgTkVUV09SSy5ORVRXT1JLX0VYUExPREVfVkVISUNMRShiYW5kaXRvLCB0cnVlLCBmYWxzZSwgTkVUV09SSy5QQVJUSUNJUEFOVF9JRF9UT19JTlQoKSkKICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0hFQUxUSChkcml2ZXIsIDAsIDApCgogICAgICAgICAgICBlbHNlaWYgYXR0YWNrdHlwZSA9PSBBdHRhY2tUeXBlLmRyb3BNaW5lIGFuZCAobm90IGxhc3RTaG9vdC5pc0VuYWJsZWQoKSBvciBsYXN0U2hvb3QuZWxhcHNlZCgpID4gMTAwMCkgYW5kIG5vdCBNSVNDLklTX1BST0pFQ1RJTEVfVFlQRV9XSVRISU5fRElTVEFOQ0UocG9zLngsIHBvcy55LCBwb3MueiwgR2V0TWluZUhhc2goKSwgMy4wLCB0cnVlKSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCB3ZWFwb24gPGNvbnN0PiA9IEdldE1pbmVIYXNoKCkKCiAgICAgICAgICAgICAgICBpZiBub3QgV0VBUE9OLkhBU19XRUFQT05fQVNTRVRfTE9BREVEKHdlYXBvbikgdGhlbgogICAgICAgICAgICAgICAgICAgIFdFQVBPTi5SRVFVRVNUX1dFQVBPTl9BU1NFVCh3ZWFwb24sIDMxLCAyNikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIGxvY2FsIG1pbiwgbWF4ID0gdjMubmV3KCksIHYzLm5ldygpCiAgICAgICAgICAgICAgICBsb2NhbCBtb2RlbEhhc2ggPSBFTlRJVFkuR0VUX0VOVElUWV9NT0RFTChiYW5kaXRvKQogICAgICAgICAgICAgICAgTUlTQy5HRVRfTU9ERUxfRElNRU5TSU9OUyhtb2RlbEhhc2gsIG1pbiwgbWF4KQoKICAgICAgICAgICAgICAgIGxvY2FsIGNvb3JkMCA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhiYW5kaXRvLCAwLjAsIG1pbi55LCAwLjIpCiAgICAgICAgICAgICAgICBsb2NhbCBjb29yZDEgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoYmFuZGl0bywgMC4wLCBtaW4ueSwgbWluLnopCgogICAgICAgICAgICAgICAgTUlTQy5TSE9PVF9TSU5HTEVfQlVMTEVUX0JFVFdFRU5fQ09PUkRTX0lHTk9SRV9FTlRJVFlfTkVXKGNvb3JkMC54LCBjb29yZDAueSwgY29vcmQwLnosIGNvb3JkMS54LCBjb29yZDEueSwgY29vcmQxLnosIDAsIHRydWUsIHdlYXBvbiwgUExBWUVSLlBMQVlFUl9JRCgpLCB0cnVlLCBmYWxzZSwgLTEuMCwgMCwgZmFsc2UsIGZhbHNlLCAwLCB0cnVlLCAxLCAwLCAwKQogICAgICAgICAgICAgICAgbGFzdFNob290LnJlc2V0KCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZWxzZWlmIHJlcXVlc3RfY29udHJvbChiYW5kaXRvKSBhbmQgcmVxdWVzdF9jb250cm9sKGRyaXZlcikgdGhlbgogICAgICAgICAgICBUQVNLLkNMRUFSX1BFRF9UQVNLUyhkcml2ZXIpCiAgICAgICAgICAgIFRBU0suVEFTS19WRUhJQ0xFX0RSSVZFX1dBTkRFUihkcml2ZXIsIGJhbmRpdG8sIDEwLjAsIDc4NjYwMykKICAgICAgICAgICAgUEVELlNFVF9CTE9DS0lOR19PRl9OT05fVEVNUE9SQVJZX0VWRU5UUyhkcml2ZXIsIHRydWUpCiAgICAgICAgICAgIHJlbW92ZV9kZWNvcihiYW5kaXRvKQogICAgICAgICAgICB1dGlsLnJlbW92ZV9ibGlwKGJsaXApCiAgICAgICAgICAgIHNldF9lbnRpdHlfYXNfbm9fbG9uZ2VyX25lZWRlZChiYW5kaXRvKQogICAgICAgICAgICBzZXRfZW50aXR5X2FzX25vX2xvbmdlcl9uZWVkZWQoZHJpdmVyKQogICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICBlbmQKICAgIGVuZCkKZW5kCmZ1bmN0aW9uIHNlbmRfdmVoX2F0dGFja2VyX3dlYXBvbihpbmRleCwgdmFsdWUpCiAgICBpZiBpbmRleCA9PSAxIHRoZW4KICAgICAgICBhdHRhY2t0eXBlID0gQXR0YWNrVHlwZS5leHBsb2RlCiAgICBlbHNlaWYgaW5kZXggPT0gMiB0aGVuCiAgICAgICAgYXR0YWNrdHlwZSA9IEF0dGFja1R5cGUuZHJvcE1pbmUKICAgIGVuZAplbmQKZnVuY3Rpb24gc2VuZF92ZWhfYXR0YWNrZXJfd2VhcG9uX21pbmUoaW5kZXgsIHZhbHVlKQogICAgc2VsZWN0ZWRNaW5lID0gaW5kZXgKZW5kCgoKLS0tLUdJRuW6t+WonApsb2NhbCBwaG90b3ZhbHVlID0gMQpsb2dvY29vcmQgPSB7eCA9IDAuODYseSA9IDAuNTcsIGZwcyA9IDEwMH0KZnVuY3Rpb24gR0lGX2thbmEob24pCiAgICBpZiBvbiB0aGVuCiAgICAgICAgc2hvd2xvZ28gPSAxCiAgICAgICAgdXRpbC5jcmVhdGVfdGhyZWFkKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgc2hvd2xvZ28gPT0gMSBkbwogICAgICAgICAgICAgICAgbG9jYWwgbG9nbyA9IGRpcmVjdHguY3JlYXRlX3RleHR1cmUoZmlsZXN5c3RlbS5yZXNvdXJjZXNfZGlyKCkgLi4gJy9TYWt1cmFTY3JpcHQvR0lGL2thbmEvJy4ucGhvdG92YWx1ZS4uJy5wbmcnKQogICAgICAgICAgICAgICAgZGlyZWN0eC5kcmF3X3RleHR1cmUobG9nbywgMC4wNiwgMC4xLCAwLjAsIDAuMCwgbG9nb2Nvb3JkLngsIGxvZ29jb29yZC55LCAwLCAxLCAxLCAxLCAxKQogICAgICAgICAgICAgICAgdXRpbC55aWVsZCgpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgICAgICB1dGlsLmNyZWF0ZV90aHJlYWQoZnVuY3Rpb24oKQogICAgICAgICAgICB3aGlsZSBzaG93bG9nbyA9PSAxIGRvCiAgICAgICAgICAgICAgICBpZiBwaG90b3ZhbHVlIDwgMTIgdGhlbgogICAgICAgICAgICAgICAgICAgIHBob3RvdmFsdWUgPSBwaG90b3ZhbHVlICsgMQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIHBob3RvdmFsdWUgPSAxCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIHV0aWwueWllbGQobG9nb2Nvb3JkLmZwcykKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZWxzZQogICAgICAgIHNob3dsb2dvID0gMAogICAgZW5kCmVuZAotLS0t5bCP6buE5Lq6CmxvY2FsIHBob3RvdmFsdWUxID0gMQpsb2dvY29vcmQxID0ge3ggPSAwLjg2LHkgPSAwLjU3LCBmcHMgPSAxNTB9CmZ1bmN0aW9uIEdJRl94aWFvaHVhbmdyZW4ob24pCiAgICBpZiBvbiB0aGVuCiAgICAgICAgc2hvd2xvZ28xID0gMQogICAgICAgIHV0aWwuY3JlYXRlX3RocmVhZChmdW5jdGlvbigpCiAgICAgICAgICAgIHdoaWxlIHNob3dsb2dvMSA9PSAxIGRvCiAgICAgICAgICAgICAgICBsb2NhbCBsb2dvID0gZGlyZWN0eC5jcmVhdGVfdGV4dHVyZShmaWxlc3lzdGVtLnJlc291cmNlc19kaXIoKSAuLiAnL1Nha3VyYVNjcmlwdC9HSUYveGlhb2h1YW5ncmVuLycuLnBob3RvdmFsdWUxLi4nLnBuZycpCiAgICAgICAgICAgICAgICBkaXJlY3R4LmRyYXdfdGV4dHVyZShsb2dvLCAwLjA2LCAwLjEsIDAuMCwgMC4wLCBsb2dvY29vcmQxLngsIGxvZ29jb29yZDEueSwgMCwgMSwgMSwgMSwgMSkKICAgICAgICAgICAgICAgIHV0aWwueWllbGQoKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICAgICAgdXRpbC5jcmVhdGVfdGhyZWFkKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2hpbGUgc2hvd2xvZ28xID09IDEgZG8KICAgICAgICAgICAgICAgIGlmIHBob3RvdmFsdWUxIDwgMjIgdGhlbgogICAgICAgICAgICAgICAgICAgIHBob3RvdmFsdWUxID0gcGhvdG92YWx1ZTEgKyAxCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgcGhvdG92YWx1ZTEgPSAxCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIHV0aWwueWllbGQobG9nb2Nvb3JkMS5mcHMpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKICAgIGVsc2UKICAgICAgICBzaG93bG9nbzEgPSAwCiAgICBlbmQKZW5kCgoKLS0tLem7keS6uuaKrOajugpmdW5jdGlvbiBibGFja3NfY29mZmlucygpCiAgICBsb2NhbCBwZWQgPSB7fQogICAgbG9jYWwgcG9zID0gcGxheWVycy5nZXRfcG9zaXRpb24oUExBWUVSLlBMQVlFUl9JRCgpKQogICAgcG9zLnogPSBwb3MueiArIDAuNgoKICAgIGxvY2FsIGNvZmZpbiA9IGNyZWF0ZV9vYmplY3QoMjE5MzI3ODM1MywgcG9zLngsIHBvcy55LCBwb3MueikKICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWShjb2ZmaW4sIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDAsIDAsIDAsIDAuOCwgMC4wLCAwLCAwLjAsIHRydWUsIHRydWUsIGZhbHNlLCB0cnVlLCAwLCB0cnVlLCAwKQoKICAgIHBlZFsxXSA9IGNyZWF0ZV9wZWQoMjYsMHg5QjIyREJBRiwgcG9zLngsIHBvcy55LCBwb3MueiwgMCkKICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWShwZWRbMV0sY29mZmluLCAwLCAwLjU1LDAsLTAuNiwwLjAsMCwwLjAsIHRydWUsIHRydWUsIGZhbHNlLCB0cnVlLCAwLCB0cnVlLCAwKQogICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04ocGVkWzFdLCB0cnVlKQogICAgcGVkWzJdID0gY3JlYXRlX3BlZCgyNiwweDlCMjJEQkFGLCBwb3MueCwgcG9zLnksIHBvcy56LCAwKQogICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKHBlZFsyXSxjb2ZmaW4sIDAsIC0wLjU1LDAsLTAuNiwwLjAsMCwwLjAsIHRydWUsIHRydWUsIGZhbHNlLCB0cnVlLCAwLCB0cnVlLCAwKQogICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04ocGVkWzJdLCB0cnVlKQogICAgcGVkWzNdID0gY3JlYXRlX3BlZCgyNiwweDlCMjJEQkFGLCBwb3MueCwgcG9zLnksIHBvcy56LCAwKQogICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKHBlZFszXSxjb2ZmaW4sIDAsIDAuNTUsMC41LC0wLjYsMC4wLDAsMC4wLCB0cnVlLCB0cnVlLCBmYWxzZSwgdHJ1ZSwgMCwgdHJ1ZSwgMCkKICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKHBlZFszXSwgdHJ1ZSkKICAgIHBlZFs0XSA9IGNyZWF0ZV9wZWQoMjYsMHg5QjIyREJBRiwgcG9zLngsIHBvcy55LCBwb3MueiwgMCkKICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWShwZWRbNF0sY29mZmluLCAwLCAtMC41NSwwLjUsLTAuNiwwLjAsMCwwLjAsIHRydWUsIHRydWUsIGZhbHNlLCB0cnVlLCAwLCB0cnVlLCAwKQogICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04ocGVkWzRdLCB0cnVlKQogICAgcGVkWzVdID0gY3JlYXRlX3BlZCgyNiwweDlCMjJEQkFGLCBwb3MueCwgcG9zLnksIHBvcy56LCAwKQogICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKHBlZFs1XSxjb2ZmaW4sIDAsIDAuNTUsLTAuNSwtMC42LDAuMCwwLDAuMCwgdHJ1ZSwgdHJ1ZSwgZmFsc2UsIHRydWUsIDAsIHRydWUsIDApCiAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihwZWRbNV0sIHRydWUpCiAgICBwZWRbNl0gPSBjcmVhdGVfcGVkKDI2LDB4OUIyMkRCQUYsIHBvcy54LCBwb3MueSwgcG9zLnosIDApCiAgICBFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkocGVkWzZdLGNvZmZpbiwgMCwgLTAuNTUsLTAuNSwtMC42LDAuMCwwLDAuMCwgdHJ1ZSwgdHJ1ZSwgZmFsc2UsIHRydWUsIDAsIHRydWUsIDApCiAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihwZWRbNl0sIHRydWUpCiAgICBmb3IgaywgdiBpbiBpcGFpcnMocGVkKSBkbwogICAgICAgIGNhbG1fcGVkKHYsIHRydWUpCiAgICBlbmQKZW5kCgoKCgotLS0t6IOM6JeP5q2m5ZmoCmZ1bmN0aW9uIEJhY2tfd2VhcG9ucyhvbikKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQoJd2VhcG9uYmFjayA9IG9uCglpZiB3ZWFwb25iYWNrIHRoZW4KCQlzcGF3bndlYXBvbiA9IDAKCWVuZAoJY3Vyd2VhcCA9IEhVRDEuX0hVRF9XRUFQT05fV0hFRUxfR0VUX1NFTEVDVEVEX0hBU0goUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKCWlmIG5vdCAoSFVEMS5fSFVEX1dFQVBPTl9XSEVFTF9HRVRfU0VMRUNURURfSEFTSChQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSA9PSAtMTU2OTYxNTI2MSkgYW5kIHdlYXBvbmJhY2sgdGhlbgoJCXNwYXdud2VhcG9uID0gV0VBUE9OLkNSRUFURV9XRUFQT05fT0JKRUNUKGN1cndlYXAsIDEsIHBvcy54LCBwb3MueSwgcG9zLnosIHRydWUsIDEsIDAsIDAsIDApCgkJYXR0YWNod2VhcG9uKHNwYXdud2VhcG9uKQoJZW5kCgl3aGlsZSB3ZWFwb25iYWNrIGRvCgkJaWYgV0VBUE9OLkdFVF9DVVJSRU5UX1BFRF9XRUFQT05fRU5USVRZX0lOREVYKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDApID09IDAgdGhlbgoJCQlpZiBub3QgKHNwYXdud2VhcG9uID09IDApIHRoZW4KCQkJCUVOVElUWS5TRVRfRU5USVRZX1ZJU0lCTEUoc3Bhd253ZWFwb24sIHRydWUsIGZhbHNlKQoJCQllbmQKCQllbHNlCgkJCUVOVElUWS5TRVRfRU5USVRZX1ZJU0lCTEUoc3Bhd253ZWFwb24sIGZhbHNlLCBmYWxzZSkKCQllbmQKCQlpZiBub3QgKEhVRDEuX0hVRF9XRUFQT05fV0hFRUxfR0VUX1NFTEVDVEVEX0hBU0goUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgPT0gY3Vyd2VhcCkgYW5kIG5vdCAoSFVEMS5fSFVEX1dFQVBPTl9XSEVFTF9HRVRfU0VMRUNURURfSEFTSChQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSA9PSAtMTU2OTYxNTI2MSkgdGhlbgoJCQlpZiBub3QgKHNwYXdud2VhcG9uID09IDApIHRoZW4KCQkJCWRlbGV0ZV9lbnRpdHkoc3Bhd253ZWFwb24pCgkJCWVuZAoJCQljdXJ3ZWFwID0gSFVEMS5fSFVEX1dFQVBPTl9XSEVFTF9HRVRfU0VMRUNURURfSEFTSChQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQoJCQlyZXF1ZXN0d2VhcG9uKGN1cndlYXApCgkJCXNwYXdud2VhcG9uID0gV0VBUE9OLkNSRUFURV9XRUFQT05fT0JKRUNUKGN1cndlYXAsIDEsIHBvcy54LCBwb3MueSwgcG9zLnosIHRydWUsIDEsIDAsIDAsIDApCgkJCWlmIChXRUFQT04uR0VUX0NVUlJFTlRfUEVEX1dFQVBPTl9FTlRJVFlfSU5ERVgoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMCkgPT0gMCkgdGhlbgoJCQkJRU5USVRZLlNFVF9FTlRJVFlfVklTSUJMRShzcGF3bndlYXBvbiwgdHJ1ZSwgZmFsc2UpCgkJCWVsc2UKCQkJCUVOVElUWS5TRVRfRU5USVRZX1ZJU0lCTEUoc3Bhd253ZWFwb24sIGZhbHNlLCBmYWxzZSkKCQkJZW5kCgkJCWF0dGFjaHdlYXBvbihzcGF3bndlYXBvbikKCQllbmQKCQl1dGlsLnlpZWxkKCkKCWVuZAoJZGVsZXRlX2VudGl0eShzcGF3bndlYXBvbikKZW5kCgoKLS0tLei9veWFt+mjnuihjOaooeW8jwpsb2NhbCB2ZWhmbHkgPSB7c3BlZWQgPSAxMDAsIGNvbGwgPSBmYWxzZSwgc3RvcCA9IHRydWV9CmZ1bmN0aW9uIHZlaF9mbHlfc3BlZWQocykKICAgIHZlaGZseS5zcGVlZCA9IHMKZW5kCmZ1bmN0aW9uIHZlaF9mbHlfY29sbChvbikKICAgIHZlaGZseS5jb2xsID0gb24KZW5kCmZ1bmN0aW9uIHZlaF9mbHlfc3RvcChvbikKICAgIHZlaGZseS5zdG9wID0gbm90IG9uCmVuZApmdW5jdGlvbiB2ZWhfZmx5KHRvZ2dsZWQpCiAgICB2ZWhfZmx5X3RvZ2dsZWQgPSB0b2dnbGVkCiAgICB3aGlsZSB2ZWhfZmx5X3RvZ2dsZWQgZG8KICAgICAgICBpZiBQRUQuSVNfUEVEX0lOX0FOWV9WRUhJQ0xFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpIHRoZW4KICAgICAgICAgICAgZGlzcGxheV9idXR0b25zKHt7MCwgMzIsICflkJHliY0nfSx7MSwgMzMsICflkJHlkI4nfSx7MiwgMjIsICfliqDpgJ/po57ooYwnfSx7MywgMzUsICflkJHlj7MnfSx7NCwgMzQsICflkJHlt6YnfSx7NSwgMjEsICflkJHkuIonfSx7NiwgMzYsICflkJHkuIsnfX0pCiAgICAgICAgICAgIGxvY2FsIGN1cmNhciA9IFBFRC5HRVRfVkVISUNMRV9QRURfSVNfVVNJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgICAgICAgICAgcmVxdWVzdF9jb250cm9sKGN1cmNhcikKCiAgICAgICAgICAgIC0t5peg56Kw5pKeCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPTVBMRVRFTFlfRElTQUJMRV9DT0xMSVNJT04oY3VyY2FyICwgbm90IHZlaGZseS5jb2xsLCB0cnVlKQogICAgICAgICAgICAtLeWGu+e7k+S9jee9rgogICAgICAgICAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihjdXJjYXIsIHZlaGZseS5zdG9wKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIGNhbXIgPSBDQU0uR0VUX0dBTUVQTEFZX0NBTV9ST1QoMCkKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04oY3VyY2FyLCBjYW1yLngsIGNhbXIueSwgY2Ftci56LCAxLCB0cnVlKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgUEFELklTX0NPTlRST0xfUFJFU1NFRCgwLCAzMikgdGhlbiAtLS0t5YmNdwogICAgICAgICAgICAgICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04oY3VyY2FyLCBmYWxzZSkKICAgICAgICAgICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRk9SV0FSRF9TUEVFRChjdXJjYXIsIHZlaGZseS5zcGVlZCkKICAgICAgICAgICAgICAgIGlmIFBBRC5JU19DT05UUk9MX1BSRVNTRUQoMCwgMjIpIHRoZW4gLS0tLeWKoOmAn3NwYWNlCiAgICAgICAgICAgICAgICAgICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04oY3VyY2FyLCBmYWxzZSkKICAgICAgICAgICAgICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0ZPUldBUkRfU1BFRUQoY3VyY2FyLCAyICogdmVoZmx5LnNwZWVkKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVsc2VpZiBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsIDMzKSB0aGVuIC0tLS3lkI5zCiAgICAgICAgICAgICAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihjdXJjYXIsIGZhbHNlKQogICAgICAgICAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9GT1JXQVJEX1NQRUVEKGN1cmNhciwgLSB2ZWhmbHkuc3BlZWQpCiAgICAgICAgICAgICAgICBpZiBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsIDIyKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04oY3VyY2FyLCBmYWxzZSkKICAgICAgICAgICAgICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0ZPUldBUkRfU1BFRUQoY3VyY2FyLCAtIDIgKiB2ZWhmbHkuc3BlZWQpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIFBBRC5JU19DT05UUk9MX1BSRVNTRUQoMCwgMjEpIHRoZW4gLS0tLeS4inNoaWZ0CiAgICAgICAgICAgICAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihjdXJjYXIsIGZhbHNlKQogICAgICAgICAgICAgICAgRU5USVRZLkFQUExZX0ZPUkNFX1RPX0VOVElUWV9DRU5URVJfT0ZfTUFTUyhjdXJjYXIsIDEsIDAsIDAsIHZlaGZseS5zcGVlZCwgMCwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkKICAgICAgICAgICAgZWxzZWlmIFBBRC5JU19DT05UUk9MX1BSRVNTRUQoMCwgMzYpIHRoZW4gLS0tLeS4i2N0cmwKICAgICAgICAgICAgICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKGN1cmNhciwgZmFsc2UpCiAgICAgICAgICAgICAgICBFTlRJVFkuQVBQTFlfRk9SQ0VfVE9fRU5USVRZX0NFTlRFUl9PRl9NQVNTKGN1cmNhciwgMSwgMCwgMCwgLSB2ZWhmbHkuc3BlZWQsIDAsIHRydWUsIHRydWUsIHRydWUsIHRydWUpCiAgICAgICAgICAgIGVsc2VpZiBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsIDM1KSB0aGVuIC0tLS3lj7NkCiAgICAgICAgICAgICAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihjdXJjYXIsIGZhbHNlKQogICAgICAgICAgICAgICAgRU5USVRZLkFQUExZX0ZPUkNFX1RPX0VOVElUWV9DRU5URVJfT0ZfTUFTUyhjdXJjYXIsIDEsIHZlaGZseS5zcGVlZCwgMCwgMCwgMCwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkKICAgICAgICAgICAgZWxzZWlmIFBBRC5JU19DT05UUk9MX1BSRVNTRUQoMCwgMzQpIHRoZW4gLS0tLeW3pmEKICAgICAgICAgICAgICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKGN1cmNhciwgZmFsc2UpCiAgICAgICAgICAgICAgICBFTlRJVFkuQVBQTFlfRk9SQ0VfVE9fRU5USVRZX0NFTlRFUl9PRl9NQVNTKGN1cmNhciwgMSwgLSB2ZWhmbHkuc3BlZWQsIDAsIDAsIDAsIHRydWUsIHRydWUsIHRydWUsIHRydWUpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIHV0aWwueWllbGQoKQogICAgZW5kCiAgICBsb2NhbCBjdXJjYXIgPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0lOKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihjdXJjYXIsIGZhbHNlKQogICAgRU5USVRZLlNFVF9FTlRJVFlfSEFTX0dSQVZJVFkoY3VyY2FyLCB0cnVlKQogICAgRU5USVRZLlNFVF9FTlRJVFlfQ09NUExFVEVMWV9ESVNBQkxFX0NPTExJU0lPTihjdXJjYXIgLCB0cnVlLCB0cnVlKQplbmQKCgoKCi0tLS3mlL7nva7lopnlo4EKZnVuY3Rpb24gZmFzdE5ldChlbnRpdHksIHBpZCkKICAgIGxvY2FsIG5ldElEID0gTkVUV09SSy5ORVRXT1JLX0dFVF9ORVRXT1JLX0lEX0ZST01fRU5USVRZKGVudGl0eSkKICAgIE5FVFdPUksuTkVUV09SS19SRVFVRVNUX0NPTlRST0xfT0ZfRU5USVRZKGVudGl0eSkKICAgICAgICBpZiBub3QgTkVUV09SSy5ORVRXT1JLX0hBU19DT05UUk9MX09GX0VOVElUWShlbnRpdHkpIHRoZW4KICAgICAgICAgICAgZm9yIGkgPSAxLCAzMCBkbwogICAgICAgICAgICAgICAgaWYgbm90IE5FVFdPUksuTkVUV09SS19IQVNfQ09OVFJPTF9PRl9FTlRJVFkoZW50aXR5KSB0aGVuCiAgICAgICAgICAgICAgICAgICAgTkVUV09SSy5ORVRXT1JLX1JFUVVFU1RfQ09OVFJPTF9PRl9FTlRJVFkoZW50aXR5KQogICAgICAgICAgICAgICAgICAgIHV0aWwueWllbGQoMTApCiAgICAgICAgICAgICAgICBlbmQgICAgCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgTkVUV09SSy5ORVRXT1JLX1JFUVVFU1RfQ09OVFJPTF9PRl9ORVRXT1JLX0lEKG5ldElEKQogICAgdXRpbC55aWVsZCgxMCkKICAgIE5FVFdPUksuU0VUX05FVFdPUktfSURfRVhJU1RTX09OX0FMTF9NQUNISU5FUyhuZXRJRCkKICAgIHV0aWwueWllbGQoMTApCiAgICBORVRXT1JLLlNFVF9ORVRXT1JLX0lEX0NBTl9NSUdSQVRFKG5ldElELCBmYWxzZSkKICAgIHV0aWwueWllbGQoMTApCiAgICBORVRXT1JLLlNFVF9ORVRXT1JLX0lEX0FMV0FZU19FWElTVFNfRk9SX1BMQVlFUihuZXRJRCwgcGlkLCB0cnVlKQogICAgdXRpbC55aWVsZCgxMCkKICAgIEVOVElUWS5TRVRfRU5USVRZX0FTX01JU1NJT05fRU5USVRZKGVudGl0eSwgdHJ1ZSwgZmFsc2UpCiAgICB1dGlsLnlpZWxkKDEwKQogICAgRU5USVRZMS5fU0VUX0VOVElUWV9DTEVBTlVQX0JZX0VOR0lORShlbnRpdHksIGZhbHNlKQogICAgdXRpbC55aWVsZCgxMCkKICAgIGlmIEVOVElUWS5JU19FTlRJVFlfQU5fT0JKRUNUKGVudGl0eSkgdGhlbgogICAgICAgIE5FVFdPUksuT0JKX1RPX05FVChlbnRpdHkpCiAgICBlbmQKICAgIHV0aWwueWllbGQoMTApCiAgICBFTlRJVFkuU0VUX0VOVElUWV9WSVNJQkxFKGVudGl0eSwgZmFsc2UsIDApCmVuZApmdW5jdGlvbiBQbGFjZV93YWxsKHBpZCkKICAgIAogICAgbG9jYWwgcGVkID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgIGxvY2FsIGZvcndhcmRPZmZzZXQgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMocGVkLCAwLCA0LCAwKQogICAgbG9jYWwgcGhlYWRpbmcgPSBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKHBlZCkKICAgIGxvY2FsIGhhc2ggPSAzMDk0MTYxMjAKICAgIHJlcXVlc3RfbW9kZWwoaGFzaCkKICAgIGxvY2FsIGExID0gT0JKRUNULkNSRUFURV9PQkpFQ1QoaGFzaCwgZm9yd2FyZE9mZnNldC54LCBmb3J3YXJkT2Zmc2V0LnksIGZvcndhcmRPZmZzZXQueiAtIDEsIHRydWUsIHRydWUsIHRydWUpCiAgICBFTlRJVFkuU0VUX0VOVElUWV9IRUFESU5HKGExLCBwaGVhZGluZyArIDkwKQogICAgZmFzdE5ldChhMSwgcGlkKQogICAgbG9jYWwgYjEgPSBPQkpFQ1QuQ1JFQVRFX09CSkVDVChoYXNoLCBmb3J3YXJkT2Zmc2V0LngsIGZvcndhcmRPZmZzZXQueSwgZm9yd2FyZE9mZnNldC56ICsgMSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkKICAgIEVOVElUWS5TRVRfRU5USVRZX0hFQURJTkcoYjEsIHBoZWFkaW5nICsgOTApCiAgICBmYXN0TmV0KGIxLCBwaWQpCiAgICB1dGlsLnlpZWxkKDUwMCkKICAgIGRlbGV0ZV9lbnRpdHkoYTEpCiAgICBkZWxldGVfZW50aXR5KGIxKQplbmQKCgotLS0t5pWM5a+55Lqk6YCaCmZ1bmN0aW9uIEdFVF9ORUFSQllfVkVISUNMRVMocGlkLCByYWRpdXMpIAoJbG9jYWwgdmVoaWNsZXMgPSB7fQoJbG9jYWwgcCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCglsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMocCkKCWxvY2FsIHYgPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0lOKHAsIGZhbHNlKQoJZm9yIF8sIHZlaGljbGUgaW4gaXBhaXJzKGVudGl0aWVzLmdldF9hbGxfdmVoaWNsZXNfYXNfaGFuZGxlcygpKSBkbyAKCQlsb2NhbCB2ZWhfcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHZlaGljbGUpCgkJaWYgdmVoaWNsZSB+PSB2IGFuZCB2ZWN0b3IzLmRpc3RhbmNlKHBvcywgdmVoX3BvcykgPD0gcmFkaXVzIHRoZW4gdGFibGUuaW5zZXJ0KHZlaGljbGVzLCB2ZWhpY2xlKSBlbmQKCWVuZAoJcmV0dXJuIHZlaGljbGVzCmVuZApmdW5jdGlvbiBSRVFVRVNUX0NPTlRST0xfTE9PUChlbnRpdHkpCglsb2NhbCB0aWNrID0gMAoJd2hpbGUgbm90IE5FVFdPUksuTkVUV09SS19IQVNfQ09OVFJPTF9PRl9FTlRJVFkoZW50aXR5KSBhbmQgdGljayA8IDI1IGRvCgkJdXRpbC55aWVsZCgpCgkJTkVUV09SSy5ORVRXT1JLX1JFUVVFU1RfQ09OVFJPTF9PRl9FTlRJVFkoZW50aXR5KQoJCXRpY2sgPSB0aWNrICsgMQoJZW5kCglpZiBORVRXT1JLLk5FVFdPUktfSVNfU0VTU0lPTl9TVEFSVEVEKCkgdGhlbgoJCWxvY2FsIG5ldElkID0gTkVUV09SSy5ORVRXT1JLX0dFVF9ORVRXT1JLX0lEX0ZST01fRU5USVRZKGVudGl0eSkKCQlORVRXT1JLLk5FVFdPUktfUkVRVUVTVF9DT05UUk9MX09GX0VOVElUWShlbnRpdHkpCgkJTkVUV09SSy5TRVRfTkVUV09SS19JRF9DQU5fTUlHUkFURShuZXRJZCwgdHJ1ZSkKCWVuZAplbmQKZnVuY3Rpb24gSG9zdGlsZV90cmFmZmljKHBpZCkKICAgIAogICAgbG9jYWwgcGxheWVyX3BlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICBmb3IgaywgdmVoaWNsZSBpbiBwYWlycyhHRVRfTkVBUkJZX1ZFSElDTEVTKHBpZCwgMjAwMCkpIGRvCQogICAgICAgIGlmIG5vdCBWRUhJQ0xFLklTX1ZFSElDTEVfU0VBVF9GUkVFKHZlaGljbGUsIC0xKSB0aGVuCiAgICAgICAgICAgIGxvY2FsIGRyaXZlciA9IFZFSElDTEUuR0VUX1BFRF9JTl9WRUhJQ0xFX1NFQVQodmVoaWNsZSwgLTEpCiAgICAgICAgICAgIGlmIG5vdCBQRUQuSVNfUEVEX0FfUExBWUVSKGRyaXZlcikgdGhlbiAKICAgICAgICAgICAgICAgIFJFUVVFU1RfQ09OVFJPTF9MT09QKGRyaXZlcikKICAgICAgICAgICAgICAgIFBFRC5TRVRfQkxPQ0tJTkdfT0ZfTk9OX1RFTVBPUkFSWV9FVkVOVFMoZHJpdmVyLCB0cnVlKQogICAgICAgICAgICAgICAgUEVELlNFVF9QRURfTUFYX0hFQUxUSChkcml2ZXIsIDMwMCkKICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0lOVklOQ0lCTEUoZHJpdmVyLCB0cnVlKQogICAgICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRSh2ZWhpY2xlLCB0cnVlKQogICAgICAgICAgICAgICAgVkVISUNMRS5NT0RJRllfVkVISUNMRV9UT1BfU1BFRUQodmVoaWNsZSwgNTApCiAgICAgICAgICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0RPT1JTX0xPQ0tFRCh2ZWhpY2xlLC0xLCAzKQogICAgICAgICAgICAgICAgVEFTSy5DTEVBUl9QRURfVEFTS1NfSU1NRURJQVRFTFkoZHJpdmVyKQogICAgICAgICAgICAgICAgUEVELlNFVF9QRURfSU5UT19WRUhJQ0xFKGRyaXZlciwgdmVoaWNsZSwgLTEpCiAgICAgICAgICAgICAgICBQRUQuU0VUX1BFRF9DT01CQVRfQVRUUklCVVRFUyhkcml2ZXIsIDQ2LCB0cnVlKQogICAgICAgICAgICAgICAgVEFTSy5UQVNLX0NPTUJBVF9QRUQoZHJpdmVyLCBwbGF5ZXJfcGVkLCAwLCAwKQogICAgICAgICAgICAgICAgVEFTSy5UQVNLX1ZFSElDTEVfTUlTU0lPTl9QRURfVEFSR0VUKGRyaXZlciwgdmVoaWNsZSwgcGxheWVyX3BlZCwgNiwgMTAwLCAwLCAwLCAwLCB0cnVlKQogICAgICAgICAgICAgICAgdXRpbC55aWVsZCgxMCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgoKLS0tLeWPmOaIkOaBkOm+mQpmdW5jdGlvbiBnaXZlX2Nhcl9hZGRvbihwaWQsIGhhc2gsIGNlbnRlciwgYW5nKQogICAgbG9jYWwgY2FyID0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19JTihQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSwgdHJ1ZSkKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhjYXIsIHRydWUpCiAgICBwb3MueCA9IHBvc1sneCddCiAgICBwb3MueSA9IHBvc1sneSddCiAgICBwb3MueiA9IHBvc1sneiddCiAgICByZXF1ZXN0X21vZGVsKGhhc2gpCiAgICBsb2NhbCByYW1wID0gT0JKRUNULkNSRUFURV9PQkpFQ1RfTk9fT0ZGU0VUKGhhc2gsIHBvc1sneCddLCBwb3NbJ3knXSwgcG9zWyd6J10sIHRydWUsIGZhbHNlLCBmYWxzZSkKICAgIGxvY2FsIHNpemUgPSBnZXRfbW9kZWxfc2l6ZShFTlRJVFkuR0VUX0VOVElUWV9NT0RFTChjYXIpKQogICAgaWYgY2VudGVyIHRoZW4KICAgICAgICBFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkocmFtcCwgY2FyLCAwLCAwLjAsIDAuMCwgMC4wLCAwLjAsIDAuMCwgYW5nLCB0cnVlLCB0cnVlLCB0cnVlLCBmYWxzZSwgMCwgdHJ1ZSwgMCkKICAgIGVsc2UKICAgICAgICBFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkocmFtcCwgY2FyLCAwLCAwLjAsIHNpemVbJ3knXSsxLjAsIDAuMCwgMC4wLCAwLjAsIGFuZywgdHJ1ZSwgdHJ1ZSwgdHJ1ZSwgZmFsc2UsIDAsIHRydWUsIDApCiAgICBlbmQKZW5kCmZ1bmN0aW9uIGNoYW5nZW1vZGVsKHBpZCkKICAgIAogICAgZ2l2ZV9jYXJfYWRkb24ocGlkLCB1dGlsLmpvYWF0KCJoNF9wcm9wX2g0X2xvY2hfbW9uc3RlciIpLCB0cnVlLCAtOTAuMCkKZW5kCi0tLS3nu5novb3lhbflpZfnrLzlrZAKZnVuY3Rpb24gbG9uZ3ppX3ZlaChwaWQpCiAgICAKICAgIGdpdmVfY2FyX2FkZG9uKHBpZCwgdXRpbC5qb2FhdCgicHJvcF9nb2xkX2NvbnRfMDFiIiksIHRydWUsIC05MC4wKQplbmQKCgotLS0t5Zyo6L2m5YaF55Sf5oiQTlBDCmZ1bmN0aW9uIG5wY2ZpbGx0aGVjYXIocGlkLCBpbmRleCx2YWx1ZSkKICAgIAogICAgbG9jYWwgdGFyZ2V0X3BlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICBpZiBQRUQuSVNfUEVEX0lOX0FOWV9WRUhJQ0xFKHRhcmdldF9wZWQsIHRydWUpIHRoZW4KICAgICAgICBsb2NhbCB2ZWggPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0lOKHRhcmdldF9wZWQsIGZhbHNlKQogICAgICAgIGxvY2FsIHN1Y2Nlc3MgPSB0cnVlCiAgICAgICAgZm9yIGkgPSAwLCBWRUhJQ0xFLkdFVF9WRUhJQ0xFX01PREVMX05VTUJFUl9PRl9TRUFUUyhFTlRJVFkuR0VUX0VOVElUWV9NT0RFTCh2ZWgpKSBkbwogICAgICAgICAgICBpZiBWRUhJQ0xFLklTX1ZFSElDTEVfU0VBVF9GUkVFKHZlaCwgaSkgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgYyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyh2ZWgpCiAgICAgICAgICAgICAgICBsb2NhbCBwZWQgPSAwCiAgICAgICAgICAgICAgICBpZiBpbmRleCA9PSAxIHRoZW4KICAgICAgICAgICAgICAgICAgICBwZWQgPSBQRUQuQ1JFQVRFX1JBTkRPTV9QRUQoYy54LCBjLnksIGMueikKICAgICAgICAgICAgICAgIGVsc2VpZiBpbmRleCA9PSAyIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBjb3BzID0geydzX2ZfeV9jb3BfMDEnLCAnc19tX21fc25vd2NvcF8wJywgJ3NfbV95X2h3YXljb3BfMDEnLCAnY3NiX2NvcCcsICdzX21feV9jb3BfMDEnfQogICAgICAgICAgICAgICAgICAgIGxvY2FsIHBpY2sgPSBjb3BzW21hdGgucmFuZG9tKDEsICNjb3BzKV0KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0X21vZGVsKHV0aWwuam9hYXQocGljaykpCiAgICAgICAgICAgICAgICAgICAgcGVkID0gZW50aXRpZXMuY3JlYXRlX3BlZCg2LCB1dGlsLmpvYWF0KHBpY2spLCBjLCAwKQogICAgICAgICAgICAgICAgICAgIFBFRC5TRVRfUEVEX0FTX0NPUChwZWQsIHRydWUpCiAgICAgICAgICAgICAgICAgICAgV0VBUE9OLkdJVkVfV0VBUE9OX1RPX1BFRChwZWQsIHV0aWwuam9hYXQoIndlYXBvbl9waXN0b2wiKSwgMTAwMCwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICAgICAgZWxzZWlmIGluZGV4ID09IDMgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIHN0cmlwcGVycyA9IHsnY3NiX3N0cmlwcGVyXzAxJywgJ2NzYl9zdHJpcHBlcl8wMicsICdzX2ZfeV9zdHJpcHBlcl8wMScsICdzX2ZfeV9zdHJpcHBlcl8wMicsICdzX2ZfeV9zdHJpcHBlcmxpdGUnfQogICAgICAgICAgICAgICAgICAgIGxvY2FsIHBpY2syID0gc3RyaXBwZXJzW21hdGgucmFuZG9tKDEsICNzdHJpcHBlcnMpXQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3RfbW9kZWwodXRpbC5qb2FhdChwaWNrMikpCiAgICAgICAgICAgICAgICAgICAgcGVkID0gZW50aXRpZXMuY3JlYXRlX3BlZCg2LCB1dGlsLmpvYWF0KHBpY2syKSwgYywgMCkKICAgICAgICAgICAgICAgIGVsc2VpZiBpbmRleCA9PSA0IHRoZW4KICAgICAgICAgICAgICAgICAgICByZXF1ZXN0X21vZGVsKHV0aWwuam9hYXQoJ2lnX2xlc3RlcmNyZXN0JykpCiAgICAgICAgICAgICAgICAgICAgcGVkID0gZW50aXRpZXMuY3JlYXRlX3BlZCg2LCB1dGlsLmpvYWF0KCdpZ19sZXN0ZXJjcmVzdCcpLCBjLCAwKQogICAgICAgICAgICAgICAgZWxzZWlmIGluZGV4ID09IDUgdGhlbgogICAgICAgICAgICAgICAgICAgIHJlcXVlc3RfbW9kZWwodXRpbC5qb2FhdCgnaWdfbGVzdGVyY3Jlc3QnKSkKICAgICAgICAgICAgICAgICAgICBwZWQgPSBlbnRpdGllcy5jcmVhdGVfcGVkKDYsIHV0aWwuam9hYXQoJ2lnX2xlc3RlcmNyZXN0JyksIGMsIDApCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIFBFRC5TRVRfUEVEX0lOVE9fVkVISUNMRShwZWQsIHZlaCwgaSkKICAgICAgICAgICAgICAgIFBFRC5TRVRfUEVEX0NPTUJBVF9BVFRSSUJVVEVTKHBlZCwgNSwgdHJ1ZSkKICAgICAgICAgICAgICAgIFBFRC5TRVRfUEVEX0ZMRUVfQVRUUklCVVRFUyhwZWQsIDAsIGZhbHNlKQogICAgICAgICAgICAgICAgUEVELlNFVF9QRURfQ09NQkFUX0FUVFJJQlVURVMocGVkLCA0NiwgdHJ1ZSkKICAgICAgICAgICAgICAgIFBFRC5TRVRfUEVEX0NBTl9CRV9EUkFHR0VEX09VVChwZWQsIGZhbHNlKQogICAgICAgICAgICAgICAgUEVELlNFVF9QRURfQ0FOX0JFX0tOT0NLRURfT0ZGX1ZFSElDTEUocGVkLCBmYWxzZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgoKLS0tLee9quWfjueahOawtApmdW5jdGlvbiBWaWNlY2l0eVdhdGVyKCkKICAgIGlmIEVOVElUWS5JU19FTlRJVFlfSU5fV0FURVIoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgYW5kIG5vdCBQRUQuSVNfUEVEX0RFQURfT1JfRFlJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgdGhlbgogICAgICAgIG1lbnUudHJpZ2dlcl9jb21tYW5kcygiZXdvIikKICAgIGVuZAplbmQKCgotLS0t5Yqb5Zy6CmZ1bmN0aW9uIGZvcmNlX0ZpZWxkKG9uKQogICAgbG9jYWwgbWRsID0gdXRpbC5qb2FhdCgicF9zcGlubmluZ19hbnVzX3MiKQogICAgbG9jYWwgcGxheWVycG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKQogICAgcmVxdWVzdF9tb2RlbChtZGwpCiAgICBpZiBvbiB0aGVuCiAgICAgICAgb2JqID0gZW50aXRpZXMuY3JlYXRlX29iamVjdChtZGwsIHBsYXllcnBvcykKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9WSVNJQkxFKG9iaiwgZmFsc2UpCiAgICAgICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKG9iaiwgUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgZmFsc2UsIGZhbHNlLCB0cnVlLCBmYWxzZSwgMCwgZmFsc2UsIDApCiAgICBlbHNlIAogICAgICAgIGRlbGV0ZV9lbnRpdHkob2JqKQogICAgZW5kCmVuZAoKCi0tLS3lipvlnLpwcm8KbG9jYWwgc19mb3JjZWZpZWxkID0gMApsb2NhbCBzX2ZvcmNlZmllbGRfcmFuZ2UgPSAyMApmdW5jdGlvbiBmb3JjZV9GaWVsZF9kaXJlY3Rpb24odmFsKQogICAgc19mb3JjZWZpZWxkID0gdmFsCmVuZApmdW5jdGlvbiBmb3JjZV9GaWVsZF9yYW5nZSh2YWx1ZSkKICAgIHNfZm9yY2VmaWVsZF9yYW5nZSA9IHZhbHVlIC8gMTAwCmVuZApmdW5jdGlvbiBmb3JjZV9GaWVsZF9wcm8oKQogICAgbG9jYWwgX2VudGl0aWVzID0ge30KICAgIGxvY2FsIHBsYXllcl9wb3MgPSBwbGF5ZXJzLmdldF9wb3NpdGlvbihQTEFZRVIuUExBWUVSX0lEKCkpCiAgICBmb3IgXywgdmVoaWNsZSBpbiBwYWlycyhlbnRpdGllcy5nZXRfYWxsX3ZlaGljbGVzX2FzX2hhbmRsZXMoKSkgZG8KICAgICAgICBsb2NhbCB2ZWhpY2xlX3BvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyh2ZWhpY2xlLCBmYWxzZSkKICAgICAgICBpZiB2My5kaXN0YW5jZShwbGF5ZXJfcG9zLCB2ZWhpY2xlX3BvcykgPD0gc19mb3JjZWZpZWxkX3JhbmdlIHRoZW4KICAgICAgICAgICAgdGFibGUuaW5zZXJ0KF9lbnRpdGllcywgdmVoaWNsZSkKICAgICAgICBlbmQKICAgIGVuZAogICAgZm9yIF8sIHBlZCBpbiBwYWlycyhlbnRpdGllcy5nZXRfYWxsX3BlZHNfYXNfaGFuZGxlcygpKSBkbwogICAgICAgIGxvY2FsIHBlZF9wb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMocGVkLCBmYWxzZSkKICAgICAgICBpZiAodjMuZGlzdGFuY2UocGxheWVyX3BvcywgcGVkX3BvcykgPD0gc19mb3JjZWZpZWxkX3JhbmdlKSBhbmQgbm90IFBFRC5JU19QRURfQV9QTEFZRVIocGVkKSB0aGVuCiAgICAgICAgICAgIHRhYmxlLmluc2VydChfZW50aXRpZXMsIHBlZCkKICAgICAgICBlbmQKICAgIGVuZAogICAgZm9yIF8sIGVudGl0eSBpbiBwYWlycyhfZW50aXRpZXMpIGRvCiAgICAgICAgbG9jYWwgcGxheWVyX3ZlaGljbGUgPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0lOKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUpCiAgICAgICAgbG9jYWwgZW50aXR5X3R5cGUgPSBFTlRJVFkuR0VUX0VOVElUWV9UWVBFKGVudGl0eSkKICAgICAgICBpZiBORVRXT1JLLk5FVFdPUktfUkVRVUVTVF9DT05UUk9MX09GX0VOVElUWShlbnRpdHkpIGFuZCBwbGF5ZXJfdmVoaWNsZSB+PSBlbnRpdHkgdGhlbgogICAgICAgICAgICBpZiBlbnRpdHlfdHlwZSA9PSAxIHRoZW4KICAgICAgICAgICAgICAgIFBFRC5TRVRfUEVEX1RPX1JBR0RPTEwoZW50aXR5LCA1MDAsIDAsIDAsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBzX2ZvcmNlZmllbGQgPT0gMSB0aGVuCiAgICAgICAgICAgICAgICBFTlRJVFkuQVBQTFlfRk9SQ0VfVE9fRU5USVRZKGVudGl0eSwgMywgMCwgMCwgMSwgMCwgMCwgMC41LCAwLCBmYWxzZSwgZmFsc2UsIHRydWUsIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgbG9jYWwgZm9yY2UgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoZW50aXR5KQogICAgICAgICAgICAgICAgdjMuc3ViKGZvcmNlLCBwbGF5ZXJfcG9zKQogICAgICAgICAgICAgICAgdjMubm9ybWFsaXNlKGZvcmNlKQogICAgICAgICAgICAgICAgaWYgc19mb3JjZWZpZWxkID09IDIgdGhlbgogICAgICAgICAgICAgICAgICAgIHYzLm11bChmb3JjZSwgLTEpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIEVOVElUWS5BUFBMWV9GT1JDRV9UT19FTlRJVFkoZW50aXR5LCAzLCBmb3JjZS54LCBmb3JjZS55LCBmb3JjZS56LCAwLCAwLCAwLjUsIDAsIGZhbHNlLCBmYWxzZSwgdHJ1ZSwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQKZnVuY3Rpb24gUGxvdF9mb3JjZV9maWVsZF9yYW5nZSgpCiAgICBsb2NhbCBwb3MgPSBwbGF5ZXJzLmdldF9wb3NpdGlvbihQTEFZRVIuUExBWUVSX0lEKCkpCiAgICBHUkFQSElDUy5EUkFXX01BUktFUl9TUEhFUkUocG9zLngsIHBvcy55LCBwb3Mueiwgc19mb3JjZWZpZWxkX3JhbmdlLCAyMjMsIDk5LCAyMzEsIDAuNSkKZW5kCgoKCi0tLS3loIblj6DooYzkuroKZnVuY3Rpb24gc3RhY2tfbnBjKCkKICAgIGxvY2FsIGMgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgIGFsbF9wZWRzID0gZW50aXRpZXMuZ2V0X2FsbF9wZWRzX2FzX2hhbmRsZXMoKQogICAgbG9jYWwgbGFzdF9wZWQgPSAwCiAgICBsb2NhbCBsYXN0X3BlZF9odCA9IDAKICAgIGZvciBrLHBlZCBpbiBwYWlycyhhbGxfcGVkcykgZG8KICAgICAgICBpZiBub3QgUEVELklTX1BFRF9BX1BMQVlFUihwZWQpIGFuZCBub3QgUEVELklTX1BFRF9GQVRBTExZX0lOSlVSRUQocGVkKSB0aGVuCiAgICAgICAgICAgIHJlcXVlc3RfY29udHJvbChwZWQpCiAgICAgICAgICAgIGlmIFBFRC5JU19QRURfSU5fQU5ZX1ZFSElDTEUocGVkLCB0cnVlKSB0aGVuCiAgICAgICAgICAgICAgICBUQVNLLkNMRUFSX1BFRF9UQVNLU19JTU1FRElBVEVMWShwZWQpCiAgICAgICAgICAgICAgICBUQVNLLlRBU0tfTEVBVkVfQU5ZX1ZFSElDTEUocGVkLCAwLCAxNikKICAgICAgICAgICAgZW5kCiAgICAKICAgICAgICAgICAgRU5USVRZLkRFVEFDSF9FTlRJVFkocGVkLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgICAgIGlmIGxhc3RfcGVkIH49IDAgdGhlbgogICAgICAgICAgICAgICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKHBlZCwgbGFzdF9wZWQsIDAsIDAuMCwgMC4wLCBsYXN0X3BlZF9odC0wLjUsIDAuMCwgMC4wLCAwLjAsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCAwLCB0cnVlLCAwKQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFMocGVkLCBjLngsIGMueSwgYy56KQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgbGFzdF9wZWQgPSBwZWQKICAgICAgICAgICAgbGFzdF9wZWRfaHQgPSBnZXRfbW9kZWxfc2l6ZShFTlRJVFkuR0VUX0VOVElUWV9NT0RFTChwZWQpKS56CiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgoKCi0tLS1OUEPpm6gKZnVuY3Rpb24gTnBjX1JhaW4oKQogICAgZm9yIGssIHBlZCBpbiBwYWlycyhlbnRpdGllcy5nZXRfYWxsX3BlZHNfYXNfaGFuZGxlcygpKSBkbwogICAgICAgIGlmIG5vdCBQRUQuSVNfUEVEX0FfUExBWUVSKHBlZCkgYW5kIG5vdCBFTlRJVFkuSVNfRU5USVRZX0lOX0FJUihwZWQpIHRoZW4KICAgICAgICAgICAgbG9jYWwgcGVkX2MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgICAgICAgICAgcGVkX2MueCA9IHBlZF9jLnggKyBtYXRoLnJhbmRvbSgtNTAsIDUwKQogICAgICAgICAgICBwZWRfYy55ID0gcGVkX2MueSArIG1hdGgucmFuZG9tKC01MCwgNTApCiAgICAgICAgICAgIHBlZF9jLnogPSBwZWRfYy56ICsgbWF0aC5yYW5kb20oNTAsIDEwMCkKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTKHBlZCwgcGVkX2MueCwgcGVkX2MueSwgcGVkX2MueikKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfVkVMT0NJVFkocGVkLCAwLjAsIDAuMCwgLTEuMCkKICAgICAgICBlbmQKICAgIGVuZAplbmQKLS0tLei9veWFt+mbqApmdW5jdGlvbiBWZWhpY2xlX1JhaW4oKSAgICAKICAgIGZvciBrLCB2ZWggaW4gcGFpcnMoZW50aXRpZXMuZ2V0X2FsbF92ZWhpY2xlc19hc19oYW5kbGVzKCkpIGRvCiAgICAgICAgbG9jYWwgbXl2ZWggPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0lOKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKQogICAgICAgIGlmIG15dmVoIH49IHZlaCBhbmQgbm90IEVOVElUWS5JU19FTlRJVFlfSU5fQUlSKHZlaCkgdGhlbiAKICAgICAgICAgICAgbG9jYWwgcGVkX2MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgICAgICAgICAgcGVkX2MueCA9IHBlZF9jLnggKyBtYXRoLnJhbmRvbSgtNTAsIDUwKQogICAgICAgICAgICBwZWRfYy55ID0gcGVkX2MueSArIG1hdGgucmFuZG9tKC01MCwgNTApCiAgICAgICAgICAgIHBlZF9jLnogPSBwZWRfYy56ICsgbWF0aC5yYW5kb20oMTAwLCAxMjApCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEUyh2ZWgsIHBlZF9jLngsIHBlZF9jLnksIHBlZF9jLnopCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgoKLS0tLemxvOmbqApsb2NhbCBmaXNodGFiID0ge30KZnVuY3Rpb24gZmlzaF9yYWluKCkKICAgIGxvY2FsIGhhc2hlcyA9IHt1dGlsLmpvYWF0KCdhX2NfZmlzaCcpLCB1dGlsLmpvYWF0KCdhX2Nfc3RpbmdyYXknKX0KICAgIGxvY2FsIGZpc2hfaGFzaCA9IGhhc2hlc1ttYXRoLnJhbmRvbSgjaGFzaGVzKV0KICAgIGxvY2FsIGMgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpCiAgICBjLnggPSBjLnggKyBtYXRoLnJhbmRvbSgtMzAsIDMwKQogICAgYy55ID0gYy55ICsgbWF0aC5yYW5kb20oLTMwLCAzMCkKICAgIGMueiA9IGMueiArIDUwCiAgICBmaXNodGFiWyNmaXNodGFiICsgMV0gPSBjcmVhdGVfcGVkKDI4LCBmaXNoX2hhc2gsIGMueCwgYy55LCBjLnosIG1hdGgucmFuZG9tKDAsMzYwKSkKICAgIEVOVElUWS5TRVRfRU5USVRZX0hFQUxUSChmaXNodGFiWyNmaXNodGFiICsgMV0sIDAuMCwgMSkKICAgIEVOVElUWS5BUFBMWV9GT1JDRV9UT19FTlRJVFkoZmlzaHRhYlsjZmlzaHRhYiArIDFdLCAxLCAwLjAsIDAuMCwgMS4wLCAwLjAsIDAuMCwgMC4wLCAwLCBmYWxzZSwgZmFsc2UsIHRydWUsIGZhbHNlLCB0cnVlKQogICAgaWYgI2Zpc2h0YWIgPiA1MCB0aGVuCiAgICAgICAgZGVsZXRlX2VudGl0eShmaXNodGFiWzFdKQogICAgICAgIHRhYmxlLnJlbW92ZShmaXNodGFiLCAxKQogICAgZW5kCiAgICB1dGlsLnlpZWxkKDEwMCkKZW5kCgoKLS0tLeeUn+aIkOWkmuexs+ivuumqqOeJjApmdW5jdGlvbiBEb21pbm9lcygpCiAgICBsb2NhbCBoYXNoID0gdXRpbC5qb2FhdCgicHJvcF9ib29naWVib2FyZF8wMSIpCiAgICByZXF1ZXN0X21vZGVsKGhhc2gpCiAgICBsb2NhbCBsYXN0X2VudCA9IFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkKICAgIGZvciBpPSAyLCAyNSBkbyAKICAgICAgICBsb2NhbCBjID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKGxhc3RfZW50LCAwLCBpLCAwKQogICAgICAgIGxvY2FsIGQgPSBlbnRpdGllcy5jcmVhdGVfb2JqZWN0KGhhc2gsIGMpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSEVBRElORyhkLCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKGxhc3RfZW50KSkKICAgICAgICBPQkpFQ1QuUExBQ0VfT0JKRUNUX09OX0dST1VORF9QUk9QRVJMWShkKQogICAgZW5kCmVuZAoKCi0tLS3lrp7kvZPlvJXlipsKZW50aXR5UGFpcnMgPSB7fQpzaG90RW50aXRpZXMgPSB7fQpjb3VudGVyID0gMApFbnRpdHlQYWlyID0ge2VudDEgPSAwLCBlbnQyID0gMH0KRW50aXR5UGFpci5fX2luZGV4ID0gRW50aXR5UGFpcgpmdW5jdGlvbiBFbnRpdHlQYWlyLm5ldyhlbnQxLCBlbnQyKQoJbG9jYWwgaW5zdGFuY2UgPSBzZXRtZXRhdGFibGUoe30sIEVudGl0eVBhaXIpCglpbnN0YW5jZS5lbnQxID0gZW50MQoJaW5zdGFuY2UuZW50MiA9IGVudDIKCXJldHVybiBpbnN0YW5jZQplbmQKZnVuY3Rpb24gRW50aXR5UGFpcjpleGlzdHMoKQoJcmV0dXJuIEVOVElUWS5ET0VTX0VOVElUWV9FWElTVChzZWxmLmVudDEpIGFuZCBFTlRJVFkuRE9FU19FTlRJVFlfRVhJU1Qoc2VsZi5lbnQyKQplbmQKZnVuY3Rpb24gYXBwbHlfZm9yY2VfdG9fZW50KGVudCwgZm9yY2UsIGZsYWcpCglpZiBFTlRJVFkuSVNfRU5USVRZX0FfUEVEKGVudCkgdGhlbgoJCWlmIFBFRC5JU19QRURfQV9QTEFZRVIoZW50KSB0aGVuIHJldHVybiBlbmQKCQlQRUQuU0VUX1BFRF9UT19SQUdET0xMKGVudCwgMTAwMCwgMTAwMCwgMCwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKCWVuZAoJaWYgcmVxdWVzdF9jb250cm9sKGVudCkgdGhlbgoJCUVOVElUWS5BUFBMWV9GT1JDRV9UT19FTlRJVFkoZW50LCBmbGFnIG9yIDEsIGZvcmNlLngsIGZvcmNlLnksIGZvcmNlLnosIDAuMCwgMC4wLCAwLjAsIDAsIGZhbHNlLCBmYWxzZSwgdHJ1ZSwgZmFsc2UsIGZhbHNlKQoJZW5kCmVuZApmdW5jdGlvbiBFbnRpdHlQYWlyOmF0dHJhY3QoKQoJbG9jYWwgcG9zMSA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhzZWxmLmVudDEsIGZhbHNlKQoJbG9jYWwgcG9zMiA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhzZWxmLmVudDIsIGZhbHNlKQoJbG9jYWwgZm9yY2UgPSB2My5uZXcocG9zMikKCWZvcmNlOnN1Yihwb3MxKQoJZm9yY2U6bXVsKDAuMDUpCglhcHBseV9mb3JjZV90b19lbnQoc2VsZi5lbnQxLCBmb3JjZSkKCWZvcmNlOm11bCgtMSkKCWFwcGx5X2ZvcmNlX3RvX2VudChzZWxmLmVudDIsIGZvcmNlKQplbmQKZnVuY3Rpb24gdGFibGUuZmluZCh0LCB2YWx1ZSkKCWZvciBrLCB2IGluIHBhaXJzKHQpIGRvCgkJaWYgdmFsdWUgPT0gdiB0aGVuIHJldHVybiBrIGVuZAoJZW5kCglyZXR1cm4gbmlsCmVuZApmdW5jdGlvbiB0YWJsZS5pbnNlcnRfb25jZSh0LCB2YWx1ZSkKCWlmIG5vdCB0YWJsZS5maW5kKHQsIHZhbHVlKSB0aGVuIHRhYmxlLmluc2VydCh0LCB2YWx1ZSkgZW5kCmVuZApmdW5jdGlvbiBFbnRpdHlQYWlyX25ldyhlbnQxLCBlbnQyKS0tLS3ljp/lh73mlbDlkI1FbnRpdHlQYWlyLm5ldygpCglsb2NhbCBpbnN0YW5jZSA9IHNldG1ldGF0YWJsZSh7fSwgRW50aXR5UGFpcikKCWluc3RhbmNlLmVudDEgPSBlbnQxCglpbnN0YW5jZS5lbnQyID0gZW50MgoJcmV0dXJuIGluc3RhbmNlCmVuZApmdW5jdGlvbiBjdHN0KCkKICAgIGxvY2FsIGVudGl0eSA9IGdldF9lbnRpdHlfcGxheWVyX2lzX2FpbWluZ19hdChQTEFZRVIuUExBWUVSX0lEKCkpCglpZiBlbnRpdHkgfj0gMCBhbmQgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKGVudGl0eSkgdGhlbgoJCWRyYXdfYm91bmRpbmdfYm94KGVudGl0eSwgdHJ1ZSwge3IgPSAyNTUsIGcgPSAyNTUsIGIgPSAyNTUsIGEgPSA4MX0pCgoJCWlmIFBFRC5JU19QRURfU0hPT1RJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgYW5kCgkJbm90IChzaG90RW50aXRpZXNbMV0gYW5kIHNob3RFbnRpdGllc1sxXSA9PSBlbnRpdHkpIHRoZW4KCQkJY291bnRlciA9IGNvdW50ZXIgKyAxCgkJCXNob3RFbnRpdGllc1tjb3VudGVyXSA9IGVudGl0eQoJCWVuZAoKCQlpZiBjb3VudGVyID09IDIgdGhlbgoJCQlsb2NhbCBlbnRQYWlyID0gRW50aXR5UGFpcl9uZXcodGFibGUudW5wYWNrKHNob3RFbnRpdGllcykpCgkJCXRhYmxlLmluc2VydF9vbmNlKGVudGl0eVBhaXJzLCBlbnRQYWlyKQoJCQljb3VudGVyID0gMAoJCQlzaG90RW50aXRpZXMgPSB7fQoJCWVuZAoJZW5kCglmb3IgaSA9ICNlbnRpdHlQYWlycywgMSwgLTEgZG8KCQlsb2NhbCBlbnRQYWlyID0gZW50aXR5UGFpcnNbaV0KCQlpZiBlbnRQYWlyOmV4aXN0cygpIHRoZW4gCiAgICAgICAgICAgIGVudFBhaXI6YXR0cmFjdCgpIAogICAgICAgIGVsc2UgCiAgICAgICAgICAgIHRhYmxlLnJlbW92ZShlbnRpdHlQYWlycywgaSkgCiAgICAgICAgZW5kCgllbmQKZW5kCmZ1bmN0aW9uIGN0c3Rfc3RvcCgpCiAgICBjb3VudGVyID0gMAoJc2hvdEVudGl0aWVzID0ge307IGVudGl0eVBhaXJzID0ge30KZW5kCgoKLS0tLS3kv53plZbnm7TljYfmnLoKbG9jYWwgaGVsaV9saXN0ID0ge30gLS3nlJ/miJDnmoTnm7TljYfmnLoKbG9jYWwgaGVsaV9wZWRfbGlzdCA9IHt9IC0t55u05Y2H5py65YaF55qE5L+d6ZWWCmxvY2FsIGJvZHlndWFyZF9oZWxpID0ge25hbWUgPSAiYnV6emFyZCIsIGhlbGlfZ29kbW9kZSA9IGZhbHNlLCBwZWRfZ29kbW9kZSA9IGZhbHNlfQpsb2NhbCBzZWxfaGVsaV9tb2RlbF9saXN0ID0geyAiYnV6emFyZCIsICJ2YWxreXJpZSIsICJhbm5paGlsYXRvciIsICJwb2xtYXYiIH0KZnVuY3Rpb24gQm9keWd1YXJkX2hlbGljb3B0ZXIodmFsdWUpCiAgICBib2R5Z3VhcmRfaGVsaS5uYW1lID0gc2VsX2hlbGlfbW9kZWxfbGlzdFt2YWx1ZV0KZW5kCmZ1bmN0aW9uIEJvZHlndWFyZF9oZWxpY29wdGVyX2ludmluY2libGUodG9nZ2xlKQogICAgYm9keWd1YXJkX2hlbGkuaGVsaV9nb2Rtb2RlID0gdG9nZ2xlCmVuZApmdW5jdGlvbiBTcGF3bl9ib2R5Z3VhcmRfaGVsaWNvcHRlcigpCiAgICBsb2NhbCBoZWxpX2hhc2ggPSB1dGlsLmpvYWF0KGJvZHlndWFyZF9oZWxpLm5hbWUpCiAgICBsb2NhbCBwZWRfaGFzaCA9IHV0aWwuam9hYXQoInNfbV95X2JsYWNrb3BzXzAxIikKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhwbGF5ZXJzLnVzZXJfcGVkKCkpCiAgICBwb3MueCA9IHBvcy54ICsgbWF0aC5yYW5kb20oLTEwLCAxMCkKICAgIHBvcy55ID0gcG9zLnkgKyBtYXRoLnJhbmRvbSgtMTAsIDEwKQogICAgcG9zLnogPSBwb3MueiArIDMwCgogICAgcmVxdWVzdF9tb2RlbHMocGVkX2hhc2gsIGhlbGlfaGFzaCkKICAgIHJlbGF0aW9uc2hpcDpmcmllbmRseShwbGF5ZXJzLnVzZXJfcGVkKCkpCiAgICBsb2NhbCBoZWxpID0gZW50aXRpZXMuY3JlYXRlX3ZlaGljbGUoaGVsaV9oYXNoLCBwb3MsIENBTS5HRVRfR0FNRVBMQVlfQ0FNX1JPVCgwKS56KQogICAgbG9jYWwgaGVsaU5ldElkID0gTkVUV09SSy5WRUhfVE9fTkVUKGhlbGkpCiAgICBpZiBORVRXT1JLLk5FVFdPUktfR0VUX0VOVElUWV9JU19ORVRXT1JLRUQoTkVUV09SSy5ORVRfVE9fUEVEKGhlbGlOZXRJZCkpIHRoZW4KICAgICAgICBORVRXT1JLLlNFVF9ORVRXT1JLX0lEX0VYSVNUU19PTl9BTExfTUFDSElORVMoaGVsaU5ldElkLCB0cnVlKQogICAgZW5kCiAgICBORVRXT1JLLlNFVF9ORVRXT1JLX0lEX0FMV0FZU19FWElTVFNfRk9SX1BMQVlFUihoZWxpTmV0SWQsIHBsYXllcnMudXNlcigpLCB0cnVlKQogICAgVkVISUNMRS5TRVRfVkVISUNMRV9FTkdJTkVfT04oaGVsaSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkKICAgIFZFSElDTEUuU0VUX0hFTElfQkxBREVTX0ZVTExfU1BFRUQoaGVsaSkKICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfU0VBUkNITElHSFQoaGVsaSwgdHJ1ZSwgdHJ1ZSkKICAgIGFkZEJsaXBGb3JFbnRpdHkoaGVsaSwgNDIyLCAyNikKICAgIC0taGVhbHRoCiAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKGhlbGksIGJvZHlndWFyZF9oZWxpLmhlbGlfZ29kbW9kZSkKICAgIEVOVElUWS5TRVRfRU5USVRZX01BWF9IRUFMVEgoaGVsaSwgMTAwMDApCiAgICBFTlRJVFkuU0VUX0VOVElUWV9IRUFMVEgoaGVsaSwgMTAwMDApCgogICAgdGFibGUuaW5zZXJ0KGhlbGlfbGlzdCwgaGVsaSkKCiAgICBsb2NhbCBwaWxvdCA9IGVudGl0aWVzLmNyZWF0ZV9wZWQoMjksIHBlZF9oYXNoLCBwb3MsIENBTS5HRVRfR0FNRVBMQVlfQ0FNX1JPVCgwKS56KQogICAgUEVELlNFVF9QRURfSU5UT19WRUhJQ0xFKHBpbG90LCBoZWxpLCAtMSkKICAgIFBFRC5TRVRfQkxPQ0tJTkdfT0ZfTk9OX1RFTVBPUkFSWV9FVkVOVFMocGlsb3QsIHRydWUpCiAgICBUQVNLLlRBU0tfSEVMSV9NSVNTSU9OKHBpbG90LCBoZWxpLCAwLCBwbGF5ZXJzLnVzZXJfcGVkKCksIDAuMCwgMC4wLCAwLjAsIDIzLCA4MC4wLCA1MC4wLCAtMS4wLCAwLCAxMCwgLTEuMCwgMCkKICAgIFBFRC5TRVRfUEVEX0tFRVBfVEFTSyhwaWxvdCwgdHJ1ZSkKICAgIC0taGVhbHRoCiAgICBQRUQuU0VUX1BFRF9NQVhfSEVBTFRIKHBpbG90LCAxMDAwKQogICAgRU5USVRZLlNFVF9FTlRJVFlfSEVBTFRIKHBpbG90LCAxMDAwKQogICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRShwaWxvdCwgYm9keWd1YXJkX2hlbGkucGVkX2dvZG1vZGUpCgogICAgdGFibGUuaW5zZXJ0KGhlbGlfcGVkX2xpc3QsIHBpbG90KQoKICAgIGxvY2FsIHNlYXRzID0gVkVISUNMRS5HRVRfVkVISUNMRV9NQVhfTlVNQkVSX09GX1BBU1NFTkdFUlMoaGVsaSkKICAgIGZvciBzZWF0ID0gMCwgc2VhdHMgLSAxIGRvCiAgICAgICAgbG9jYWwgcGVkID0gZW50aXRpZXMuY3JlYXRlX3BlZCgyOSwgcGVkX2hhc2gsIHBvcywgQ0FNLkdFVF9HQU1FUExBWV9DQU1fUk9UKDApLnopCiAgICAgICAgbG9jYWwgcGVkTmV0SWQgPSBORVRXT1JLLlBFRF9UT19ORVQocGVkKQogICAgICAgIGlmIE5FVFdPUksuTkVUV09SS19HRVRfRU5USVRZX0lTX05FVFdPUktFRChwZWQpIHRoZW4KICAgICAgICAgICAgTkVUV09SSy5TRVRfTkVUV09SS19JRF9FWElTVFNfT05fQUxMX01BQ0hJTkVTKHBlZE5ldElkLCB0cnVlKQogICAgICAgIGVuZAogICAgICAgIE5FVFdPUksuU0VUX05FVFdPUktfSURfQUxXQVlTX0VYSVNUU19GT1JfUExBWUVSKHBlZE5ldElkLCBwbGF5ZXJzLnVzZXIoKSwgdHJ1ZSkKICAgICAgICBQRUQuU0VUX1BFRF9JTlRPX1ZFSElDTEUocGVkLCBoZWxpLCBzZWF0KQogICAgICAgIC0tZmlnaHQKICAgICAgICBXRUFQT04uR0lWRV9XRUFQT05fVE9fUEVEKHBlZCwgdXRpbC5qb2FhdCgid2VhcG9uX21nIiksIC0xLCBmYWxzZSwgdHJ1ZSkKICAgICAgICBXRUFQT04uU0VUX1BFRF9JTkZJTklURV9BTU1PX0NMSVAocGVkLCB0cnVlKQogICAgICAgIFBFRC5TRVRfUEVEX0NPTUJBVF9BVFRSSUJVVEVTKHBlZCwgNSwgdHJ1ZSkKICAgICAgICBQRUQuU0VUX1BFRF9DT01CQVRfQVRUUklCVVRFUyhwZWQsIDMsIGZhbHNlKQogICAgICAgIFBFRC5TRVRfUEVEX0NPTUJBVF9NT1ZFTUVOVChwZWQsIDIpCiAgICAgICAgUEVELlNFVF9QRURfQ09NQkFUX0FCSUxJVFkocGVkLCAyKQogICAgICAgIFBFRC5TRVRfUEVEX0NPTUJBVF9SQU5HRShwZWQsIDIpCiAgICAgICAgUEVELlNFVF9QRURfU0VFSU5HX1JBTkdFKHBlZCwgNTAwLjApCiAgICAgICAgUEVELlNFVF9QRURfSEVBUklOR19SQU5HRShwZWQsIDUwMC4wKQogICAgICAgIFBFRC5TRVRfUEVEX1RBUkdFVF9MT1NTX1JFU1BPTlNFKHBlZCwgMSkKICAgICAgICBQRUQuU0VUX1BFRF9ISUdITFlfUEVSQ0VQVElWRShwZWQsIHRydWUpCiAgICAgICAgUEVELlNFVF9QRURfVklTVUFMX0ZJRUxEX1BFUklQSEVSQUxfUkFOR0UocGVkLCA1MDAuMCkKICAgICAgICBQRUQuU0VUX0NPTUJBVF9GTE9BVChwZWQsIDEwLCA1MDAuMCkKICAgICAgICBQRUQuU0VUX1BFRF9TSE9PVF9SQVRFKHBlZCwgMTAwMC4wKQogICAgICAgIFBFRC5TRVRfUEVEX0FDQ1VSQUNZKHBlZCwgMTAwLjApCiAgICAgICAgUEVELlNFVF9QRURfQ0FOX0JFX1NIT1RfSU5fVkVISUNMRShwZWQsIHRydWUpCiAgICAgICAgLS1oZWFsdGgKICAgICAgICBQRUQuU0VUX1BFRF9NQVhfSEVBTFRIKHBlZCwgMTAwMCkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9IRUFMVEgocGVkLCAxMDAwKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0lOVklOQ0lCTEUocGVkLCBib2R5Z3VhcmRfaGVsaS5wZWRfZ29kbW9kZSkKCiAgICAgICAgcmVsYXRpb25zaGlwOmZyaWVuZGx5KHBlZCkKCiAgICAgICAgdGFibGUuaW5zZXJ0KGhlbGlfcGVkX2xpc3QsIHBlZCkKICAgIGVuZAoKICAgIFNUUkVBTUlORy5TRVRfTU9ERUxfQVNfTk9fTE9OR0VSX05FRURFRChoZWxpX2hhc2gpCiAgICBTVFJFQU1JTkcuU0VUX01PREVMX0FTX05PX0xPTkdFUl9ORUVERUQocGVkX2hhc2gpCmVuZApmdW5jdGlvbiBkZWxldGVfYm9keWd1YXJkX2hlbGljb3B0ZXIoKQogICAgZm9yIGssIGVudCBpbiBwYWlycyhoZWxpX3BlZF9saXN0KSBkbwogICAgICAgIGRlbGV0ZV9lbnRpdHkoZW50KQogICAgZW5kCiAgICBmb3IgaywgZW50IGluIHBhaXJzKGhlbGlfbGlzdCkgZG8KICAgICAgICBkZWxldGVfZW50aXR5KGVudCkKICAgIGVuZAplbmQKCgotLS0t54K46bG8CmZ1bmN0aW9uIGZyaWVkX2Zpc2gocGlkKQogICAgCiAgICBsb2NhbCBQdG9vbHNfUGFuVGFibGUgPSB7fQogICAgbG9jYWwgUHRvb2xzX1BhbkNvdW50ID0gMQogICAgbG9jYWwgdGFyZ2V0cGVkID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgIGxvY2FsIHRhcmdldGNvb3JkcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyh0YXJnZXRwZWQpCiAgICBsb2NhbCBoYXNoID0gdXRpbC5qb2FhdCgidHVnIikKICAgIHJlcXVlc3RfbW9kZWwoaGFzaCkKICAgIGZvciBpID0gMSwgMjAgZG8KICAgICAgICBQdG9vbHNfUGFuVGFibGVbUHRvb2xzX1BhbkNvdW50XSA9IFZFSElDTEUuQ1JFQVRFX1ZFSElDTEUoaGFzaCwgdGFyZ2V0Y29vcmRzLngsIHRhcmdldGNvb3Jkcy55LCB0YXJnZXRjb29yZHMueiwgMCwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkKICAgICAgICBsb2NhbCBuZXRJRCA9IE5FVFdPUksuTkVUV09SS19HRVRfTkVUV09SS19JRF9GUk9NX0VOVElUWShQdG9vbHNfUGFuVGFibGVbUHRvb2xzX1BhbkNvdW50XSkKICAgICAgICBORVRXT1JLLk5FVFdPUktfUkVRVUVTVF9DT05UUk9MX09GX0VOVElUWShQdG9vbHNfUGFuVGFibGVbUHRvb2xzX1BhbkNvdW50XSkKICAgICAgICBORVRXT1JLLk5FVFdPUktfUkVRVUVTVF9DT05UUk9MX09GX05FVFdPUktfSUQobmV0SUQpCiAgICAgICAgTkVUV09SSy5TRVRfTkVUV09SS19JRF9FWElTVFNfT05fQUxMX01BQ0hJTkVTKG5ldElEKQogICAgICAgIE5FVFdPUksuU0VUX05FVFdPUktfSURfQ0FOX01JR1JBVEUobmV0SUQsIGZhbHNlKQogICAgICAgIE5FVFdPUksuU0VUX05FVFdPUktfSURfQUxXQVlTX0VYSVNUU19GT1JfUExBWUVSKG5ldElELCBwaWQsIHRydWUpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQVNfTUlTU0lPTl9FTlRJVFkoUHRvb2xzX1BhblRhYmxlW1B0b29sc19QYW5Db3VudF0sIHRydWUsIGZhbHNlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1ZJU0lCTEUoUHRvb2xzX1BhblRhYmxlW1B0b29sc19QYW5Db3VudF0sIGZhbHNlLCAwKQogICAgICAgIFB0b29sc19QYW5Db3VudCA9IFB0b29sc19QYW5Db3VudCArIDEKICAgIGVuZAplbmQKCgotLS0t5rOw5Z2m5Y+36L2w54K4CmZ1bmN0aW9uIFRpdGFuX2JvbWJpbmcocGlkKQogICAgCiAgICBsb2NhbCBwbGF5ZXJfcGVkID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgIGxvY2FsIFBsYXllclBlZENvb3JkcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhwbGF5ZXJfcGVkLCB0cnVlKQogICAgcmVxdWVzdF9tb2RlbCg0NDc1NDg5MDkpCiAgICBsb2NhbCBzcGFtX2Ftb3VudCA9IDMwMAogICAgd2hpbGUgc3BhbV9hbW91bnQgPj0gMSBkbwogICAgICAgIGVudGl0aWVzLmNyZWF0ZV92ZWhpY2xlKDQ0NzU0ODkwOSwgUGxheWVyUGVkQ29vcmRzLCAwKQogICAgICAgIHNwYW1fYW1vdW50ID0gc3BhbV9hbW91bnQgLSAxCiAgICAgICAgdXRpbC55aWVsZCgxMCkKICAgIGVuZAplbmQKCgotLS0t5riy5p+T57KS5a2QCmZ1bmN0aW9uIFJlbmRlcl9wYXJ0aWNsZXMocGlkKQogICAgCiAgICBsb2NhbCBwbGF5ZXJfcG9zID0gcGxheWVycy5nZXRfcG9zaXRpb24ocGlkKQogICAgcmVxdWVzdF9wdGZ4X2Fzc2V0KCJzY3JfcmNiYXJyeTIiKQogICAgR1JBUEhJQ1MuVVNFX1BBUlRJQ0xFX0ZYX0FTU0VUKCJzY3JfcmNiYXJyeTIiKQogICAgR1JBUEhJQ1MuU1RBUlRfTkVUV09SS0VEX1BBUlRJQ0xFX0ZYX05PTl9MT09QRURfQVRfQ09PUkQoInNjcl9jbG93bl9kZWF0aCIsIHBsYXllcl9wb3MueCwgcGxheWVyX3Bvcy55LCBwbGF5ZXJfcG9zLnosIDAsIDAsIDAsIDIuNSwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgIEdSQVBISUNTLlVTRV9QQVJUSUNMRV9GWF9BU1NFVCgic2NyX3JjYmFycnkyIikKICAgIEdSQVBISUNTLlNUQVJUX05FVFdPUktFRF9QQVJUSUNMRV9GWF9OT05fTE9PUEVEX0FUX0NPT1JEKCJzY3JfZXhwX2Nsb3duIiwgcGxheWVyX3Bvcy54LCBwbGF5ZXJfcG9zLnksIHBsYXllcl9wb3MueiwgMCwgMCwgMCwgMi41LCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgcmVxdWVzdF9wdGZ4X2Fzc2V0KCJzY3JfY2hfZmluYWxlIikKICAgIEdSQVBISUNTLlVTRV9QQVJUSUNMRV9GWF9BU1NFVCgic2NyX2NoX2ZpbmFsZSIpCiAgICBHUkFQSElDUy5TVEFSVF9ORVRXT1JLRURfUEFSVElDTEVfRlhfTk9OX0xPT1BFRF9BVF9DT09SRCgic2NyX2NoX2ZpbmFsZV9kcmlsbF9zcGFya3MiLCBwbGF5ZXJfcG9zLngsIHBsYXllcl9wb3MueSwgcGxheWVyX3Bvcy56LCAwLCAwLCAwLCAyLjUsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCiAgICB1dGlsLnlpZWxkKDEwMCkKZW5kCgoKLS3kvKDpgIHmiYDmnIlQRUTnu5nnjqnlrrYKZnVuY3Rpb24gdHBUYWJsZVRvUGxheWVyKHRibCwgcGlkKQogICAgaWYgTkVUV09SSy5ORVRXT1JLX0lTX1BMQVlFUl9DT05ORUNURUQocGlkKSB0aGVuCiAgICAgICAgbG9jYWwgYyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSkKICAgICAgICBmb3IgXywgdiBpbiBwYWlycyh0YmwpIGRvCiAgICAgICAgICAgIGlmIChub3QgUEVELklTX1BFRF9BX1BMQVlFUih2KSkgdGhlbgogICAgICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTX05PX09GRlNFVCh2LCBjLngsIGMueSwgYy56LCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQKZnVuY3Rpb24gVHBBbGxQZWRzKHBpZCkKICAgIAogICAgbG9jYWwgcGVkSGFuZGxlcyA9IGVudGl0aWVzLmdldF9hbGxfcGVkc19hc19oYW5kbGVzKCkKICAgIHRwVGFibGVUb1BsYXllcihwZWRIYW5kbGVzLCBwaWQpCmVuZAotLeS8oOmAgeaJgOaciei9veWFt+e7meeOqeWutgpmdW5jdGlvbiBUcEFsbFZlaHMocGlkKQogICAgCiAgICBsb2NhbCB2ZWhIYW5kbGVzID0gZW50aXRpZXMuZ2V0X2FsbF92ZWhpY2xlc19hc19oYW5kbGVzKCkKICAgIHRwVGFibGVUb1BsYXllcih2ZWhIYW5kbGVzLCBwaWQpCmVuZAotLeS8oOmAgeaJgOacieeJqeS9k+e7meeOqeWutgpmdW5jdGlvbiBUcEFsbE9iamVjdHMocGlkKQogICAgCiAgICBsb2NhbCBvYmpIYW5kbGVzID0gZW50aXRpZXMuZ2V0X2FsbF9vYmplY3RzX2FzX2hhbmRsZXMoKQogICAgdHBUYWJsZVRvUGxheWVyKG9iakhhbmRsZXMsIHBpZCkKZW5kCgotLS0t6ZWt5bCE54KuCmxvY2FsIExhc2VyaGFzaCA9IHV0aWwuam9hYXQoIlZFSElDTEVfV0VBUE9OX1BMQVlFUl9MQVpFUiIpCmxvY2FsIExhc2Vyc291bmQgPSBTb3VuZF9uZXcoIkZpcmVfTG9vcCIsICJETENfSUVfVlZfR3VuX1BsYXllcl9Tb3VuZHMiKQpmdW5jdGlvbiBMYXNlcnNvdW5kOmhhc0ZpbmlzaGVkKCkKCXJldHVybiBBVURJTy5IQVNfU09VTkRfRklOSVNIRUQoc2VsZi5JZCkKZW5kCmZ1bmN0aW9uIExhc2Vyc291bmQ6c3RvcCgpCglpZiBzZWxmLklkIH49IC0xIHRoZW4KICAgICAgICBBVURJTy5TVE9QX1NPVU5EKHNlbGYuSWQpCiAgICAgICAgQVVESU8uUkVMRUFTRV9TT1VORF9JRChzZWxmLklkKQogICAgICAgIHNlbGYuSWQgPSAtMQogICAgZW5kCmVuZApmdW5jdGlvbiBMYXNlcnNvdW5kOnBsYXlGcm9tRW50aXR5KGVudGl0eSkKCWlmIHNlbGYuSWQgPT0gLTEgdGhlbgoJCXNlbGYuSWQgPSBBVURJTy5HRVRfU09VTkRfSUQoKQoJCUFVRElPLlBMQVlfU09VTkRfRlJPTV9FTlRJVFkoc2VsZi5JZCwgc2VsZi5uYW1lLCBlbnRpdHksIHNlbGYucmVmZXJlbmNlLCB0cnVlLCAwKQoJZW5kCmVuZApmdW5jdGlvbiBMYXNlcl9jYW5ub24oKQogICAgLS3mmL7npLrmjInplK4KICAgIGRpc3BsYXlfYnV0dG9ucyh7ezAsIDQ2LCAn6ZWt5bCE54KuJ319KQogICAgZGlzYWJsZV9jb250cm9sX2FjdGlvbigxMDYsIDEyMiwgMTM1LCAxNDAsIDE0MSwgMTQyLCAyNjMsIDI2NCkKCiAgICBIVUQuRElTUExBWV9TTklQRVJfU0NPUEVfVEhJU19GUkFNRSgpCiAgICBpZiBub3QgV0VBUE9OLkhBU19XRUFQT05fQVNTRVRfTE9BREVEKExhc2VyaGFzaCkgdGhlbgogICAgICAgIFdFQVBPTi5SRVFVRVNUX1dFQVBPTl9BU1NFVChMYXNlcmhhc2gsIDMxLCAyNikKICAgIGVuZAogICAgaWYgbm90IFBBRC5JU19ESVNBQkxFRF9DT05UUk9MX1BSRVNTRUQoNTEsIDUxKSB0aGVuCiAgICAgICAgaWYgbm90IExhc2Vyc291bmQ6aGFzRmluaXNoZWQoKSB0aGVuCiAgICAgICAgICAgIExhc2Vyc291bmQ6c3RvcCgpCiAgICAgICAgZW5kCiAgICBlbHNlaWYgdGltZXIuZWxhcHNlZCgpID4gMTAwIHRoZW4KICAgICAgICBsb2NhbCBwb3MgPSBQRUQuR0VUX1BFRF9CT05FX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAweDMyMkMsIDAuMCwgMC4wLCAwLjApCiAgICAgICAgbG9jYWwgb2Zmc2V0ID0gZ2V0X29mZnNldF9mcm9tX2NhbWVyYSg4MCkKICAgICAgICBpZiAgTGFzZXJzb3VuZDpoYXNGaW5pc2hlZCgpIHRoZW4KICAgICAgICAgICAgTGFzZXJzb3VuZDpwbGF5RnJvbUVudGl0eShQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgICAgICBBVURJTy5TRVRfVkFSSUFCTEVfT05fU09VTkQoTGFzZXJzb3VuZC5JZCwgImZpcmVSYXRlIiwgMTAuMCkKICAgICAgICBlbmQKICAgICAgICBNSVNDLlNIT09UX1NJTkdMRV9CVUxMRVRfQkVUV0VFTl9DT09SRFMoCiAgICAgICAgICAgIHBvcy54LCBwb3MueSwgcG9zLnosCiAgICAgICAgICAgIG9mZnNldC54LCBvZmZzZXQueSwgb2Zmc2V0LnosCiAgICAgICAgICAgIDIwMCwKICAgICAgICAgICAgdHJ1ZSwKICAgICAgICAgICAgTGFzZXJoYXNoLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlLCB0cnVlLCAtMS4wCiAgICAgICAgKQogICAgICAgIHRpbWVyLnJlc2V0KCkKICAgIGVuZAplbmQKCgoKCi0tLS1SUEfoh6rliqjnnoTlh4blmagKZnVuY3Rpb24gR2V0Q2xvc2VzdFBsYXllcldpdGhSYW5nZV9XaGl0ZWxpc3QocmFuZ2UsIGluYWlyKQogICAgbG9jYWwgcGVkUG9pbnRlcnMgPSBlbnRpdGllcy5nZXRfYWxsX3BlZHNfYXNfcG9pbnRlcnMoKQogICAgbG9jYWwgcmFuZ2VzcSA9IHJhbmdlICogcmFuZ2UKICAgIGxvY2FsIG91ckNvb3JkcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgbG9jYWwgdGJsID0ge30KICAgIGxvY2FsIGNsb3Nlc3RfcGxheWVyID0gMAogICAgZm9yIGkgPSAxLCAjcGVkUG9pbnRlcnMgZG8KICAgICAgICBsb2NhbCB0YXJjb29yZHMgPSBlbnRpdGllcy5nZXRfcG9zaXRpb24ocGVkUG9pbnRlcnNbaV0pCiAgICAgICAgbG9jYWwgdmRpc3QgPSBTWVNURU0uVkRJU1QyKG91ckNvb3Jkcy54LCBvdXJDb29yZHMueSwgb3VyQ29vcmRzLnosIHRhcmNvb3Jkcy54LCB0YXJjb29yZHMueSwgdGFyY29vcmRzLnopCiAgICAgICAgaWYgdmRpc3QgPD0gcmFuZ2VzcSB0aGVuCiAgICAgICAgICAgIGxvY2FsIGhhbmRsZSA9IGVudGl0aWVzLnBvaW50ZXJfdG9faGFuZGxlKHBlZFBvaW50ZXJzW2ldKQogICAgICAgICAgICBpZiAoaW5haXIgYW5kIChFTlRJVFkuR0VUX0VOVElUWV9IRUlHSFRfQUJPVkVfR1JPVU5EKGhhbmRsZSkgPj0gOSkpIG9yIChub3QgaW5haXIpIHRoZW4gLS1haXIgY2hlY2sKICAgICAgICAgICAgICAgIGxvY2FsIHBpZCA9IE5FVFdPUksuTkVUV09SS19HRVRfUExBWUVSX0lOREVYX0ZST01fUEVEKGhhbmRsZSkKICAgICAgICAgICAgICAgIGlmIG5vdCBBSU1fV0hJVEVMSVNUW3BpZF0gdGhlbiAtLXRoaXMgaXMgdGhlIHdoaXRlbGlzdCBjaGVjay4KICAgICAgICAgICAgICAgICAgICB0YmxbI3RibCsxXSA9IGhhbmRsZQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCiAgICBpZiB0Ymwgfj0gbmlsIHRoZW4KICAgICAgICBsb2NhbCBkaXN0ID0gOTk5OTk5CiAgICAgICAgZm9yIGkgPSAxLCAjdGJsIGRvCiAgICAgICAgICAgIGlmIHRibFtpXSB+PSBQTEFZRVIuUExBWUVSX1BFRF9JRCgpIHRoZW4KICAgICAgICAgICAgICAgIGlmIFBFRC5JU19QRURfQV9QTEFZRVIodGJsW2ldKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgdGFyY29vcmRzID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHRibFtpXSkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBlID0gU1lTVEVNLlZESVNUMihvdXJDb29yZHMueCwgb3VyQ29vcmRzLnksIG91ckNvb3Jkcy56LCB0YXJjb29yZHMueCwgdGFyY29vcmRzLnksIHRhcmNvb3Jkcy56KQogICAgICAgICAgICAgICAgICAgIGlmIGUgPCBkaXN0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZGlzdCA9IGUKICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VzdF9wbGF5ZXIgPSB0YmxbaV0KICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogICAgaWYgY2xvc2VzdF9wbGF5ZXIgfj0gMCB0aGVuCiAgICAgICAgcmV0dXJuIGNsb3Nlc3RfcGxheWVyCiAgICBlbHNlCiAgICAgICAgcmV0dXJuIG5pbAogICAgZW5kCmVuZApmdW5jdGlvbiBSUEdfQXV0b21hdGljX3NpZ2h0KG9uKQogICAgaWYgb24gdGhlbgogICAgICAgIGxvY2FsIENob3Nlbl9Sb2NrZXRfSGFzaCA9ICItMTcwNzk5NzI1NyIKICAgICAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgICAgIGxvY2FsIGxvY2FscGVkID0gUExBWUVSLlBMQVlFUl9QRURfSUQoKQogICAgICAgICAgICBsb2NhbCBsb2NhbGNvb3JkcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgICAgICBsb2NhbCBmb3JPZmZzZXQgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMobG9jYWxwZWQsIDAsIDUsIDApCiAgICAgICAgICAgIFJSb2NrZXQgPSBPQkpFQ1QuR0VUX0NMT1NFU1RfT0JKRUNUX09GX1RZUEUoZm9yT2Zmc2V0LngsIGZvck9mZnNldC55LCBmb3JPZmZzZXQueiwgMTAsIENob3Nlbl9Sb2NrZXRfSGFzaCwgZmFsc2UsIHRydWUsIHRydWUsIHRydWUpCiAgICAgICAgICAgIGxvY2FsIHAKICAgICAgICAgICAgaWYgbWlzc2lsZV9zZXR0aW5ncy5tdWx0aXRhcmdldCB0aGVuCiAgICAgICAgICAgICAgICBpZiBtaXNzaWxlX3NldHRpbmdzLmFpcl90YXJnZXQgdGhlbgogICAgICAgICAgICAgICAgICAgIHAgPSBHZXRDbG9zZXN0UGxheWVyV2l0aFJhbmdlX1doaXRlbGlzdF9EaXNhbGxvd0VudGl0aWVzKG1pc3NpbGVfc2V0dGluZ3MucmFkaXVzLCBNSVNTSUxFX0VOVElUWV9UQUJMRSwgdHJ1ZSkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBwID0gR2V0Q2xvc2VzdFBsYXllcldpdGhSYW5nZV9XaGl0ZWxpc3RfRGlzYWxsb3dFbnRpdGllcyhtaXNzaWxlX3NldHRpbmdzLnJhZGl1cywgTUlTU0lMRV9FTlRJVFlfVEFCTEUsIGZhbHNlKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVsc2VpZiBtaXNzaWxlX3NldHRpbmdzLm11bHRpcGVkIHRoZW4KICAgICAgICAgICAgICAgIGlmIG1pc3NpbGVfc2V0dGluZ3MuYWlyX3RhcmdldCB0aGVuCiAgICAgICAgICAgICAgICAgICAgcCA9IEdldENsb3Nlc3ROb25QbGF5ZXJQZWRXaXRoUmFuZ2VfRGlzYWxsb3dlZEVudGl0aWVzKG1pc3NpbGVfc2V0dGluZ3MucmFkaXVzLCBNSVNTSUxFX0VOVElUWV9UQUJMRSwgdHJ1ZSkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBwID0gR2V0Q2xvc2VzdE5vblBsYXllclBlZFdpdGhSYW5nZV9EaXNhbGxvd2VkRW50aXRpZXMobWlzc2lsZV9zZXR0aW5ncy5yYWRpdXMsIE1JU1NJTEVfRU5USVRZX1RBQkxFLCBmYWxzZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbHNlaWYgbm90IG1pc3NpbGVfc2V0dGluZ3MubXVsdGl0YXJnZXQgdGhlbgogICAgICAgICAgICAgICAgaWYgbWlzc2lsZV9zZXR0aW5ncy5haXJfdGFyZ2V0IHRoZW4KICAgICAgICAgICAgICAgICAgICBwID0gR2V0Q2xvc2VzdFBsYXllcldpdGhSYW5nZV9XaGl0ZWxpc3QobWlzc2lsZV9zZXR0aW5ncy5yYWRpdXMsIHRydWUpCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgcCA9IEdldENsb3Nlc3RQbGF5ZXJXaXRoUmFuZ2VfV2hpdGVsaXN0KG1pc3NpbGVfc2V0dGluZ3MucmFkaXVzLCBmYWxzZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgbG9jYWwgcHBjb29yZHMgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMocCwgZmFsc2UpCiAgICAgICAgICAgIGlmIChSUm9ja2V0IH49IDApIGFuZCAocCB+PSBuaWwpIGFuZCAobm90IFBFRC5JU19QRURfREVBRF9PUl9EWUlORyhwKSkgYW5kIChub3QgQUlNX1dISVRFTElTVFtORVRXT1JLLk5FVFdPUktfR0VUX1BMQVlFUl9JTkRFWF9GUk9NX1BFRChwKV0pIGFuZCAoUEVELklTX1BFRF9TSE9PVElORyhsb2NhbHBlZCkpIGFuZCAobm90IHBsYXllcnMuaXNfaW5faW50ZXJpb3IoTkVUV09SSy5ORVRXT1JLX0dFVF9QTEFZRVJfSU5ERVhfRlJPTV9QRUQocCkpKSBhbmQgKHBwY29vcmRzLnogPiAxKSB0aGVuCiAgICAgICAgICAgICAgICB1dGlsLmNyZWF0ZV90aHJlYWQoZnVuY3Rpb24gKCkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBwbG9jYWxpemVkID0gcAogICAgICAgICAgICAgICAgICAgIGxvY2FsIG1zbCA9IFJSb2NrZXQKICAgICAgICAgICAgICAgICAgICBpZiBtaXNzaWxlX3NldHRpbmdzLm11bHRpdGFyZ2V0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgTUlTU0lMRV9FTlRJVFlfVEFCTEVbI01JU1NJTEVfRU5USVRZX1RBQkxFKzFdID0gcGxvY2FsaXplZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIChFTlRJVFkuSEFTX0VOVElUWV9DTEVBUl9MT1NfVE9fRU5USVRZKGxvY2FscGVkLCBwbG9jYWxpemVkLCAxNykgYW5kIG1pc3NpbGVfc2V0dGluZ3MubG9zKSBvciBub3QgbWlzc2lsZV9zZXR0aW5ncy5sb3Mgb3IgTUlTTF9BSVIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRpbC50b2FzdCgi5YmN5YWG5a6M5oiQ77yBIikKICAgICAgICAgICAgICAgICAgICAgICAgTkVUV09SSy5ORVRXT1JLX1JFUVVFU1RfQ09OVFJPTF9PRl9FTlRJVFkobXNsKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgTkVUV09SSy5ORVRXT1JLX0hBU19DT05UUk9MX09GX0VOVElUWShtc2wpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpID0gMSwgMTAgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBORVRXT1JLLk5FVFdPUktfUkVRVUVTVF9DT05UUk9MX09GX0VOVElUWShtc2wpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0aWwudG9hc3QoIuacieaOp+WItuadgyIpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhaXJjb3VudCA9IDEKICAgICAgICAgICAgICAgICAgICAgICAgTWlzc2lsZV9DYW1lcmEgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgIFNUUkVBTUlORy5SRVFVRVNUX05BTUVEX1BURlhfQVNTRVQobWlzc2lsZV9wYXJ0aWNsZXMuZGljdGlvbmFyeSkKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgbm90IFNUUkVBTUlORy5IQVNfTkFNRURfUFRGWF9BU1NFVF9MT0FERUQobWlzc2lsZV9wYXJ0aWNsZXMuZGljdGlvbmFyeSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNUUkVBTUlORy5SRVFVRVNUX05BTUVEX1BURlhfQVNTRVQobWlzc2lsZV9wYXJ0aWNsZXMuZGljdGlvbmFyeSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0aWwueWllbGQoKQogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgR1JBUEhJQ1MuVVNFX1BBUlRJQ0xFX0ZYX0FTU0VUKG1pc3NpbGVfcGFydGljbGVzLmRpY3Rpb25hcnkpCiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlIEVOVElUWS5ET0VTX0VOVElUWV9FWElTVChtc2wpIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRpbC50b2FzdCgi54Gr566t5a2Y5ZyoIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIHBjb29yZHMyID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHBsb2NhbGl6ZWQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBwY29vcmRzID0gR2V0VGFibGVGcm9tVjNJbnN0YW5jZShwY29vcmRzMikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGxjMiA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhtc2wpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBsYyA9IEdldFRhYmxlRnJvbVYzSW5zdGFuY2UobGMyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgbG9vazIgPSB2My5sb29rQXQobGMyLCBwY29vcmRzMikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGxvb2sgPSBHZXRUYWJsZUZyb21WM0luc3RhbmNlKGxvb2syKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZGlyMiA9IHYzLnRvRGlyKGxvb2syKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZGlyID0gR2V0VGFibGVGcm9tVjNJbnN0YW5jZShkaXIyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbWlzc2lsZV9zZXR0aW5ncy5wdGZ4IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTVFJFQU1JTkcuUkVRVUVTVF9OQU1FRF9QVEZYX0FTU0VUKG1pc3NpbGVfcGFydGljbGVzLmRpY3Rpb25hcnkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgbm90IFNUUkVBTUlORy5IQVNfTkFNRURfUFRGWF9BU1NFVF9MT0FERUQobWlzc2lsZV9wYXJ0aWNsZXMuZGljdGlvbmFyeSkgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU1RSRUFNSU5HLlJFUVVFU1RfTkFNRURfUFRGWF9BU1NFVChtaXNzaWxlX3BhcnRpY2xlcy5kaWN0aW9uYXJ5KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGlsLnlpZWxkKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHUkFQSElDUy5VU0VfUEFSVElDTEVfRlhfQVNTRVQobWlzc2lsZV9wYXJ0aWNsZXMuZGljdGlvbmFyeSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHUkFQSElDUy5TVEFSVF9ORVRXT1JLRURfUEFSVElDTEVfRlhfTk9OX0xPT1BFRF9BVF9DT09SRChtaXNzaWxlX3BhcnRpY2xlcy5uYW1lLCBsYy54LCBsYy55LCBsYy56LCAwLCAwLCAwLCAwLjQgKiBtaXNzaWxlX3NldHRpbmdzLnB0Znhfc2NhbGUsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIHRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFpcmNvdW50IDwgMiBhbmQgTUlTTF9BSVIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIEVOVElUWS5ET0VTX0VOVElUWV9FWElTVChtc2wpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRU5USVRZLkFQUExZX0ZPUkNFX1RPX0VOVElUWV9DRU5URVJfT0ZfTUFTUyhtc2wsIDEsIDAsIDAsIDI3MDAsIHRydWUsIGZhbHNlLCB0cnVlLCB0cnVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhaXJjb3VudCA9IGFpcmNvdW50ICsgMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGlsLnlpZWxkKDExMDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGxvb2tDb3VudEQgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBNSVNMX0FJUiB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbWlzc2lsZV9zZXR0aW5ncy5jYW0gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgQ0FNLkRPRVNfQ0FNX0VYSVNUKE1pc3NpbGVfQ2FtZXJhKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRpbC50b2FzdCgi55u45py66K6+572uIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENBTS5ERVNUUk9ZX0FMTF9DQU1TKHRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNaXNzaWxlX0NhbWVyYSA9IENBTS5DUkVBVEVfQ0FNKCJERUZBVUxUX1NDUklQVEVEX0NBTUVSQSIsIHRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDQU0uU0VUX0NBTV9BQ1RJVkUoTWlzc2lsZV9DYW1lcmEsIHRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDQU0uUkVOREVSX1NDUklQVF9DQU1TKHRydWUsIGZhbHNlLCAwLCB0cnVlLCB0cnVlLCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBkaXN0eCA9IG1hdGguYWJzKGxjLnggLSBwY29vcmRzLngpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZGlzdHkgPSBtYXRoLmFicyhsYy55IC0gcGNvb3Jkcy55KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGRpc3R6ID0gbWF0aC5hYnMobGMueiAtIHBjb29yZHMueikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBtaXNzaWxlX3NldHRpbmdzLmNhbSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGRkaXNzdCA9IEdFTkVSSUNfU1lTVEVNLlZESVNUKHBjb29yZHMueCwgcGNvb3Jkcy55LCBwY29vcmRzLnosIGxjLngsIGxjLnksIGxjLnopCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGRkaXNzdCA+IDUwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGNhbWNvb3JkdjMgPSBDQU0uR0VUX0NBTV9DT09SRChNaXNzaWxlX0NhbWVyYSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGxvb2szID0gdjMubG9va0F0KGNhbWNvb3JkdjMsIGxjMikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGxvb2s0ID0gR2V0VGFibGVGcm9tVjNJbnN0YW5jZShsb29rMykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGJhY2tvZmZzZXQgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMobXNsLCAxMCwgMTAsIC0yKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ0FNLlNFVF9DQU1fQ09PUkQoTWlzc2lsZV9DYW1lcmEsIGJhY2tvZmZzZXQueCwgYmFja29mZnNldC55LCBiYWNrb2Zmc2V0LnopCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBsb29rQ291bnREIDwgMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ0FNLlNFVF9DQU1fUk9UKE1pc3NpbGVfQ2FtZXJhLCBsb29rNC54LCBsb29rNC55LCBsb29rNC56LCAyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvb2tDb3VudEQgPSBsb29rQ291bnREICsgMQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGNhbWNvb3JkdjMgPSBDQU0uR0VUX0NBTV9DT09SRChNaXNzaWxlX0NhbWVyYSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGxvb2szID0gdjMubG9va0F0KGNhbWNvb3JkdjMsIGxjMikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGxvb2s0ID0gR2V0VGFibGVGcm9tVjNJbnN0YW5jZShsb29rMykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENBTS5TRVRfQ0FNX1JPVChNaXNzaWxlX0NhbWVyYSwgbG9vazQueCwgbG9vazQueSwgbG9vazQueiwgMikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04obXNsLCBsb29rLngsIGxvb2sueSwgbG9vay56LCAyLCB0cnVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVOVElUWS5BUFBMWV9GT1JDRV9UT19FTlRJVFlfQ0VOVEVSX09GX01BU1MobXNsLCAxLCBkaXIueCAqIG1pc3NpbGVfc2V0dGluZ3Muc3BlZWQgKiBkaXN0eCwgZGlyLnkgKiBtaXNzaWxlX3NldHRpbmdzLnNwZWVkICogZGlzdHksIGRpci56ICogbWlzc2lsZV9zZXR0aW5ncy5zcGVlZCAqIGRpc3R6LCB0cnVlLCBmYWxzZSwgdHJ1ZSwgdHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGlsLnlpZWxkKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9ST1RBVElPTihtc2wsIGxvb2sueCwgbG9vay55LCBsb29rLnosIDIsIHRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRU5USVRZLkFQUExZX0ZPUkNFX1RPX0VOVElUWV9DRU5URVJfT0ZfTUFTUyhtc2wsIDEsIGRpci54ICogbWlzc2lsZV9zZXR0aW5ncy5zcGVlZCwgZGlyLnkgKiBtaXNzaWxlX3NldHRpbmdzLnNwZWVkLCBkaXIueiAqIG1pc3NpbGVfc2V0dGluZ3Muc3BlZWQsIHRydWUsIGZhbHNlLCB0cnVlLCB0cnVlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0aWwueWllbGQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBpZiBtaXNzaWxlX3NldHRpbmdzLmNhbSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dGlsLnlpZWxkKDIwMDApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXRpbC50b2FzdCgi55u45py65Yig6ZmkIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENBTS5SRU5ERVJfU0NSSVBUX0NBTVMoZmFsc2UsIGZhbHNlLCAwLCB0cnVlLCB0cnVlLCAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgQ0FNLklTX0NBTV9BQ1RJVkUoTWlzc2lsZV9DYW1lcmEpIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDQU0uU0VUX0NBTV9BQ1RJVkUoTWlzc2lsZV9DYW1lcmEsIGZhbHNlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBDQU0uREVTVFJPWV9DQU0oTWlzc2lsZV9DYW1lcmEsIHRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGlmIG1pc3NpbGVfc2V0dGluZ3MubXVsdGl0YXJnZXQgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5yZW1vdmUoTUlTU0lMRV9FTlRJVFlfVEFCTEUsIEdldFZhbHVlSW5kZXhGcm9tVGFibGUoTUlTU0lMRV9FTlRJVFlfVEFCTEUsIHBsb2NhbGl6ZWQpKQogICAgICAgICAgICAgICAgICAgICAgICB1dGlsLnRvYXN0KCLlt7LliKDpmaTnmoTlgLwiIC4uIHRvc3RyaW5nKHBsb2NhbGl6ZWQpIC4uICIgYXQgaW5kZXggIiAuLiB0b3N0cmluZyhHZXRWYWx1ZUluZGV4RnJvbVRhYmxlKE1JU1NJTEVfRU5USVRZX1RBQkxFLCBwKSkpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICB1dGlsLnlpZWxkKCkKICAgICAgICBlbmQKICAgIGVuZAplbmQKCi0t6Ieq5Yqo6am+6am25Yiw5Z2Q5qCHCmZ1bmN0aW9uIGF1dG9fZHJpdmluZ190b19jb29yZChwZWQsIHgsIHksIHosIHNwZWVkLCBzdHlsZSwgc3RvcFJhbmdlKQogICAgaWYgUEVELklTX1BFRF9JTl9BTllfVkVISUNMRShwZWQsIGZhbHNlKSB0aGVuIAogICAgICAgIGxvY2FsIHZlaGljbGUgPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX1VTSU5HKHBlZCkKICAgICAgICBpZiBWRUhJQ0xFLkdFVF9QRURfSU5fVkVISUNMRV9TRUFUKHZlaGljbGUsIC0xKSA9PSBwZWQgdGhlbgoKICAgICAgICAgICAgaWYgVkVISUNMRS5JU19USElTX01PREVMX0FfSEVMSShFTlRJVFkuR0VUX0VOVElUWV9NT0RFTCh2ZWhpY2xlKSkgdGhlbi0t55u05Y2H5py6CiAgICAgICAgICAgICAgICBQRUQuU0VUX0JMT0NLSU5HX09GX05PTl9URU1QT1JBUllfRVZFTlRTKHBlZCwgdHJ1ZSkKICAgICAgICAgICAgICAgIFRBU0suVEFTS19IRUxJX01JU1NJT04ocGVkLCB2ZWhpY2xlLCAwLCAwLCB4LCB5LCB6LCA0LCA4MC4wLCA1MC4wLCAtMS4wLCAwLjAsIDUwMC4wLCAwLCAwKQogICAgICAgICAgICAgICAgUEVELlNFVF9QRURfS0VFUF9UQVNLKHBlZCwgdHJ1ZSkKICAgICAgICAgICAgZWxzZWlmIFZFSElDTEUuSVNfVEhJU19NT0RFTF9BX1BMQU5FKEVOVElUWS5HRVRfRU5USVRZX01PREVMKHZlaGljbGUpKSB0aGVuLS3po57mnLoKICAgICAgICAgICAgICAgIFBFRC5TRVRfQkxPQ0tJTkdfT0ZfTk9OX1RFTVBPUkFSWV9FVkVOVFMocGVkLCB0cnVlKQogICAgICAgICAgICAgICAgVEFTSy5UQVNLX1BMQU5FX01JU1NJT04ocGVkLCB2ZWhpY2xlLCAwLCAwLCB4LCB5LCB6LCA0LCA4MC4wLCA1MC4wLCAtMS4wLCA5MDAuMCw1MDAuMCwgdHJ1ZSkKICAgICAgICAgICAgICAgIFBFRC5TRVRfUEVEX0tFRVBfVEFTSyhwZWQsIHRydWUpCiAgICAgICAgICAgIGVsc2VpZiBWRUhJQ0xFLklTX1RISVNfTU9ERUxfQV9CT0FUKEVOVElUWS5HRVRfRU5USVRZX01PREVMKHZlaGljbGUpKSB0aGVuLS3oiLkKICAgICAgICAgICAgICAgIFBFRC5TRVRfQkxPQ0tJTkdfT0ZfTk9OX1RFTVBPUkFSWV9FVkVOVFMocGVkLCB0cnVlKQogICAgICAgICAgICAgICAgVEFTSy5UQVNLX0JPQVRfTUlTU0lPTihwZWQsIHZlaGljbGUsIDAsIDAsIHgsIHksIHosIDQsIHNwZWVkLCBzdHlsZSwgMCwgMCkKICAgICAgICAgICAgICAgIFBFRC5TRVRfUEVEX0tFRVBfVEFTSyhwZWQsIHRydWUpCiAgICAgICAgICAgIGVsc2UtLei9pgogICAgICAgICAgICAgICAgVEFTSzEuVEFTS19WRUhJQ0xFX0RSSVZFX1RPX0NPT1JEX0xPTkdSQU5HRShwZWQsIHZlaGljbGUsIHgsIHksIHosIHNwZWVkIC8gMy42LCBzdHlsZSwgc3RvcFJhbmdlKQogICAgICAgICAgICBlbmQKCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgoKCgotLS0tLS3oh6rliqjpqb7pqbYKbG9jYWwgZHJpdmVzdHlsZSA9IDc4NjYwMwpsb2NhbCBkcml2ZXNwZWVkID0gNzAKbG9jYWwgQXV0b19kcml2aW5nX3BlZCAtLeWumuS5ieWxgOmDqApmdW5jdGlvbiBkcml2ZXN0eWxlZShpbmRleCwgbWVudV9uYW1lLCBwcmV2X3ZhbHVlLCBjbGlja190eXBlKQogICAgZHJpdmVzdHlsZSA9IGRyaXZlc3R5bGV0YWJsZXNbaW5kZXhdCmVuZApmdW5jdGlvbiBkcml2ZXNwZWVkZCh2YWx1ZSkKICAgIGRyaXZlc3BlZWQgPSB2YWx1ZQplbmQKZnVuY3Rpb24gQXV0b19kcml2aW5nKHRvZ2dsZSkKICAgIEF1dG9fZHJpdmVkX3RvZ2dsZWQgPSB0b2dnbGUKICAgIHdoaWxlIEF1dG9fZHJpdmVkX3RvZ2dsZWQgZG8KICAgICAgICBsb2NhbCB2ZWhpY2xlID0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19VU0lORyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgIGlmIEhVRC5JU19XQVlQT0lOVF9BQ1RJVkUoKSB0aGVuCiAgICAgICAgICAgIGxvY2FsIHdheXBvaW50ID0gSFVELkdFVF9CTElQX0NPT1JEUyhIVUQuR0VUX0ZJUlNUX0JMSVBfSU5GT19JRCg4KSkKICAgICAgICAgICAgYXV0b19kcml2aW5nX3RvX2Nvb3JkKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHdheXBvaW50LngsIHdheXBvaW50LnksIHdheXBvaW50LnosIGRyaXZlc3BlZWQsIGRyaXZlc3R5bGUsIDAuMCkKICAgICAgICBlbmQKICAgICAgICB1dGlsLnlpZWxkKDEwMDApCiAgICBlbmQKICAgIFRBU0suQ0xFQVJfUEVEX1RBU0tTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpIC0t5riF6Zmk6am+6am2dGFzawplbmQKCi0tLS0t54m55pav5ouJ6Ieq5Yqo6am+6am2CmZ1bmN0aW9uIFRlc2xhX0F1dG9waWxvdCh0b2dnbGVkKQogICAgbG9jYWwgcGxheWVyID0gUExBWUVSLlBMQVlFUl9QRURfSUQoKQogICAgbG9jYWwgcGxheWVycG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHBsYXllciwgZmFsc2UpCiAgICBsb2NhbCB0ZXNsYV9haSA9IHV0aWwuam9hYXQoInVfbV95X2JheWdvciIpCiAgICBsb2NhbCB0ZXNsYSA9IHV0aWwuam9hYXQoInJhaWRlbiIpCiAgICByZXF1ZXN0X21vZGVsKHRlc2xhX2FpKQogICAgcmVxdWVzdF9tb2RlbCh0ZXNsYSkKICAgIGlmIHRvZ2dsZWQgdGhlbiAgICAgCiAgICAgICAgaWYgUEVELklTX1BFRF9JTl9BTllfVkVISUNMRShwbGF5ZXIsIHRydWUpIHRoZW4KICAgICAgICAgICAgbG9jYWwgdmVoaWNsZSA9IFBFRC5HRVRfVkVISUNMRV9QRURfSVNfSU4ocGxheWVyLCBmYWxzZSkKICAgICAgICAgICAgZGVsZXRlX2VudGl0eSh2ZWhpY2xlKQogICAgICAgIGVuZAogICAgICAgIHRlc2xhX2FpX3BlZCA9IFBFRC5DTE9ORV9QRUQoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSwgZmFsc2UsIHRydWUpCiAgICAgICAgdGVzbGFfdmVoaWNsZSA9IGVudGl0aWVzLmNyZWF0ZV92ZWhpY2xlKHRlc2xhLCBwbGF5ZXJwb3MsIDApCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRSh0ZXNsYV9haV9wZWQsIHRydWUpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfVklTSUJMRSh0ZXNsYV9haV9wZWQsIGZhbHNlKQogICAgICAgIFBFRC5TRVRfQkxPQ0tJTkdfT0ZfTk9OX1RFTVBPUkFSWV9FVkVOVFModGVzbGFfYWlfcGVkLCB0cnVlKQogICAgICAgIFBFRC5TRVRfUEVEX0lOVE9fVkVISUNMRShwbGF5ZXIsIHRlc2xhX3ZlaGljbGUsIC0yKQogICAgICAgIFBFRC5TRVRfUEVEX0lOVE9fVkVISUNMRSh0ZXNsYV9haV9wZWQsIHRlc2xhX3ZlaGljbGUsIC0xKQogICAgICAgIFBFRC5TRVRfUEVEX0tFRVBfVEFTSyh0ZXNsYV9haV9wZWQsIHRydWUpCiAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9DT0xPVVJTKHRlc2xhX3ZlaGljbGUsIDExMSwgMTExKQogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfTU9EKHRlc2xhX3ZlaGljbGUsIDIzLCA4LCBmYWxzZSkKICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX01PRCh0ZXNsYV92ZWhpY2xlLCAxNSwgMSwgZmFsc2UpCiAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9FWFRSQV9DT0xPVVJTKHRlc2xhX3ZlaGljbGUsIDExMSwgMTQ3KQogICAgICAgIGlmIEhVRC5JU19XQVlQT0lOVF9BQ1RJVkUoKSB0aGVuCiAgICAgICAgICAgIGxvY2FsIHBvcyA9IEhVRC5HRVRfQkxJUF9DT09SRFMoSFVELkdFVF9GSVJTVF9CTElQX0lORk9fSUQoOCkpCiAgICAgICAgICAgIFRBU0suVEFTS19WRUhJQ0xFX0RSSVZFX1RPX0NPT1JEX0xPTkdSQU5HRSh0ZXNsYV9haV9wZWQsIHRlc2xhX3ZlaGljbGUsIHBvcy54LCBwb3MueSwgcG9zLnosIDIwLCA3ODY2MDMsIDApCiAgICAgICAgZWxzZQogICAgICAgICAgICBUQVNLLlRBU0tfVkVISUNMRV9EUklWRV9XQU5ERVIodGVzbGFfYWlfcGVkLCB0ZXNsYV92ZWhpY2xlLCAyMCwgNzg2NjAzKQogICAgICAgIGVuZAogICAgZWxzZQogICAgICAgIGlmIHRlc2xhX2FpX3BlZCB+PSBuaWwgdGhlbiAKICAgICAgICAgICAgZGVsZXRlX2VudGl0eSh0ZXNsYV9haV9wZWQpCiAgICAgICAgZW5kCiAgICAgICAgaWYgdGVzbGFfdmVoaWNsZSB+PSBuaWwgdGhlbiAKICAgICAgICAgICAgZGVsZXRlX2VudGl0eSh0ZXNsYV92ZWhpY2xlKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKCi0tLS0t6L295YW35pWI5p6cCmxvY2FsIHZmeHNlbGVjdGVkT3B0ID0gMQpmdW5jdGlvbiBzZWxlY3RlZE9wdHQoaW5kZXgsIG1lbnVfbmFtZSwgcHJldl92YWx1ZSwgY2xpY2tfdHlwZSkKICAgIHZmeHNlbGVjdGVkT3B0ID0gaW5kZXggCmVuZApmdW5jdGlvbiB2ZWhpY2xlX2VmZmVjdHQoKQogICAgbG9jYWwgZWZmZWN0ZCA9IHZlZmZlY3RzW3ZmeHNlbGVjdGVkT3B0XQogICAgbG9jYWwgdmVoaWNsZSA9IFBFRC5HRVRfVkVISUNMRV9QRURfSVNfSU4oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpCiAgICBpZiBFTlRJVFkuRE9FU19FTlRJVFlfRVhJU1QodmVoaWNsZSkgYW5kIG5vdCBFTlRJVFkuSVNfRU5USVRZX0RFQUQodmVoaWNsZSwgZmFsc2UpIGFuZAogICAgICAgIFZFSElDTEUuSVNfVkVISUNMRV9EUklWRUFCTEUodmVoaWNsZSwgZmFsc2UpIGFuZCB0aW1lci5lbGFwc2VkKCkgPiBlZmZlY3RkWzRdIHRoZW4KICAgICAgICAgICAgcmVxdWVzdF9wdGZ4X2Fzc2V0KGVmZmVjdGRbMV0pCiAgICAgICAgZm9yIF8sIGJvbmVOYW1lIGluIHBhaXJzKHsid2hlZWxfbGYiLCAid2hlZWxfbHIiLCAid2hlZWxfcmYiLCAid2hlZWxfcnIifSkgZG8KICAgICAgICAgICAgbG9jYWwgYm9uZSA9IEVOVElUWS5HRVRfRU5USVRZX0JPTkVfSU5ERVhfQllfTkFNRSh2ZWhpY2xlLCBib25lTmFtZSkKICAgICAgICAgICAgR1JBUEhJQ1MuVVNFX1BBUlRJQ0xFX0ZYX0FTU0VUKGVmZmVjdGRbMV0pCiAgICAgICAgICAgIEdSQVBISUNTLlNUQVJUX1BBUlRJQ0xFX0ZYX05PTl9MT09QRURfT05fRU5USVRZX0JPTkUoCiAgICAgICAgICAgICAgICBlZmZlY3RkWzJdLAogICAgICAgICAgICAgICAgdmVoaWNsZSwKICAgICAgICAgICAgICAgIDAuMCwgMC4wLCAwLjAsCiAgICAgICAgICAgICAgICAwLjAsIDAuMCwgMC4wLAogICAgICAgICAgICAgICAgYm9uZSwKICAgICAgICAgICAgICAgIGVmZmVjdGRbM10sCiAgICAgICAgICAgICAgICBmYWxzZSwgZmFsc2UsIGZhbHNlCiAgICAgICAgICAgICkKICAgICAgICBlbmQKICAgICAgICB0aW1lci5yZXNldCgpCiAgICBlbmQKZW5kCgoKLS0tLS0t5aSp5Z+654KuCmZ1bmN0aW9uIG51Y2xlYXJfd2VhcG9uMSgpCiAgICBsb2NhbCBsYXN0X2hpdF9jb29yZHMgPSB2My5uZXcoKQoJaWYgV0VBUE9OLkdFVF9QRURfTEFTVF9XRUFQT05fSU1QQUNUX0NPT1JEKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGxhc3RfaGl0X2Nvb3JkcykgdGhlbgogICAgICAgIHJlcXVlc3RfcHRmeF9hc3NldCgic2NyX3htX29yYml0YWwiKQogICAgICAgIEdSQVBISUNTLlVTRV9QQVJUSUNMRV9GWF9BU1NFVCgic2NyX3htX29yYml0YWwiKQogICAgICAgIEZJUkUuQUREX0VYUExPU0lPTihsYXN0X2hpdF9jb29yZHMueCwgbGFzdF9oaXRfY29vcmRzLnksIGxhc3RfaGl0X2Nvb3Jkcy56LCA1OSwgMSwgdHJ1ZSwgZmFsc2UsIDEuMCwgZmFsc2UpCiAgICAgICAgR1JBUEhJQ1MuU1RBUlRfTkVUV09SS0VEX1BBUlRJQ0xFX0ZYX05PTl9MT09QRURfQVRfQ09PUkQoInNjcl94bV9vcmJpdGFsX2JsYXN0IiwgbGFzdF9oaXRfY29vcmRzLngsIGxhc3RfaGl0X2Nvb3Jkcy55LCBsYXN0X2hpdF9jb29yZHMueiwgMCwgMTgwLCAwLCAxLjAsIHRydWUsIHRydWUsIHRydWUpCiAgICAgICAgZm9yIGkgPSAxLCA0IGRvCiAgICAgICAgICAgIEFVRElPLlBMQVlfU09VTkRfRlJPTV9FTlRJVFkoLTEsICJETENfWE1fRXhwbG9zaW9uc19PcmJpdGFsX0Nhbm5vbiIsIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDAsIHRydWUsIDApCiAgICAgICAgZW5kCgllbmQKZW5kCi0tLS0t5qC45by5CmZ1bmN0aW9uIGdldF9kaXN0YW5jZV9iZXR3ZWVuKHBvczEsIHBvczIpCglpZiBtYXRoLnR5cGUocG9zMSkgPT0gImludGVnZXIiIHRoZW4KCQlwb3MxID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHBvczEpCgllbmQKCWlmIG1hdGgudHlwZShwb3MyKSA9PSAiaW50ZWdlciIgdGhlbiAKCQlwb3MyID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHBvczIpCgllbmQKCXJldHVybiBwb3MxOmRpc3RhbmNlKHBvczIpCmVuZApmdW5jdGlvbiBudWtlX2V4cGwxKFBvc2l0aW9uKQogICAgbG9jYWwgb2Zmc2V0cyA9IHsKICAgICAgICB7MTAsIDAsIDB9LCB7MCwgMTAsIDB9LCB7MTAsIDEwLCAwfSwgey0xMCwgMCwgMH0sIHswLCAtMTAsIDB9LCB7LTEwLCAtMTAsIDB9LCB7MTAsIC0xMCwgMH0sIHstMTAsIDEwLCAwfSwKICAgICAgICB7MjAsIDAsIDB9LCB7MCwgMjAsIDB9LCB7MjAsIDIwLCAwfSwgey0yMCwgMCwgMH0sIHswLCAtMjAsIDB9LCB7LTIwLCAtMjAsIDB9LCB7MjAsIC0yMCwgMH0sIHstMjAsIDEwLCAwfSwKICAgICAgICB7MzAsIDAsIDB9LCB7MCwgMzAsIDB9LCB7MzAsIDMwLCAwfSwgey0zMCwgMCwgMH0sIHswLCAtMzAsIDB9LCB7LTMwLCAtMzAsIDB9LCB7MzAsIC0zMCwgMH0sIHstMzAsIDEwLCAwfSwKICAgICAgICB7MTAsIDMwLCAwfSwgezMwLCAxMCwgMH0sIHstMzAsIC0xMCwgMH0sIHstMTAsIC0zMCwgMH0sIHstMTAsIDMwLCAwfSwgey0zMCwgMTAsIDB9LCB7MzAsIC0xMCwgMH0sIHsxMCwgLTMwLCAwfSwKICAgICAgICB7MCwgMCwgMTB9LCB7MCwgMCwgLTEwfSwgezAsIDAsIDIwfSwgezAsIDAsIC0yMH0KICAgIH0KICAgIGZvciBfLCBvZmZzZXQgaW4gaXBhaXJzKG9mZnNldHMpIGRvCiAgICAgICAgRklSRS5BRERfRVhQTE9TSU9OKFBvc2l0aW9uLnggKyBvZmZzZXRbMV0sIFBvc2l0aW9uLnkgKyBvZmZzZXRbMl0sIFBvc2l0aW9uLnogKyBvZmZzZXRbM10sIDU5LCAxLjAsIHRydWUsIGZhbHNlLCAxLjAsIGZhbHNlKQogICAgZW5kCmVuZApmdW5jdGlvbiBudWtlX2V4cGwyKFBvc2l0aW9uKQogICAgbG9jYWwgb2Zmc2V0cyA9IHt7MCwwLC0xMH0sIHsxMCwwLC0xMH0sIHswLDEwLC0xMH0sIHsxMCwxMCwtMTB9LCB7LTEwLDAsLTEwfSwgezAsLTEwLC0xMH0sIHstMTAsLTEwLC0xMH0sIHsxMCwtMTAsLTEwfSwgey0xMCwxMCwtMTB9fQogICAgZm9yIF8sIG9mZnNldCBpbiBpcGFpcnMob2Zmc2V0cykgZG8KICAgICAgICBGSVJFLkFERF9FWFBMT1NJT04oUG9zaXRpb24ueCArIG9mZnNldFsxXSwgUG9zaXRpb24ueSArIG9mZnNldFsyXSwgUG9zaXRpb24ueiArIG9mZnNldFszXSwgNTksIDEuMCwgdHJ1ZSwgZmFsc2UsIDEuMCwgZmFsc2UpCiAgICBlbmQKZW5kCmZ1bmN0aW9uIG51a2VfZXhwbDMoUG9zaXRpb24pCiAgICBsb2NhbCBvZmZzZXRzID0ge3sxMCwwLDB9LCB7MCwxMCwwfSwgezEwLDEwLDB9LCB7LTEwLDAsMH0sIHswLC0xMCwwfSwgey0xMCwtMTAsMH0sIHsxMCwtMTAsMH0sIHstMTAsMTAsMH0sIHswLDAsMH19CiAgICBmb3IgXywgb2Zmc2V0IGluIGlwYWlycyhvZmZzZXRzKSBkbwogICAgICAgIEZJUkUuQUREX0VYUExPU0lPTihQb3NpdGlvbi54ICsgb2Zmc2V0WzFdLCBQb3NpdGlvbi55ICsgb2Zmc2V0WzJdLCBQb3NpdGlvbi56ICsgb2Zmc2V0WzNdLCA1OSwgMS4wLCB0cnVlLCBmYWxzZSwgMS4wLCBmYWxzZSkKICAgIGVuZAplbmQKZnVuY3Rpb24gY3JlYXRlX251a2VfZXhwbG9zaW9uKFBvc2l0aW9uKQogICAgZm9yIGNvdW50ID0gMSwgMTcgZG8KICAgICAgICBpZiBjb3VudCA9PSAxIHRoZW4KCSAgICAgICAgRklSRS5BRERfRVhQTE9TSU9OKFBvc2l0aW9uLngsIFBvc2l0aW9uLnksIFBvc2l0aW9uLnosIDU5LCAxLCB0cnVlLCBmYWxzZSwgNS4wLCBmYWxzZSkKICAgICAgICBlbHNlaWYgY291bnQgPT0gMiB0aGVuCiAgICAgICAgICAgIEZJUkUuQUREX0VYUExPU0lPTihQb3NpdGlvbi54LCBQb3NpdGlvbi55LCBQb3NpdGlvbi56LCA1OSwgMSwgdHJ1ZSwgZmFsc2UsIDEuMCwgZmFsc2UpCiAgICAgICAgZW5kCgkJcmVxdWVzdF9wdGZ4X2Fzc2V0KCJzY3JfeG1fb3JiaXRhbCIpCiAgICAgICAgR1JBUEhJQ1MuVVNFX1BBUlRJQ0xFX0ZYX0FTU0VUKCJzY3JfeG1fb3JiaXRhbCIpCgkgICAgR1JBUEhJQ1MuU1RBUlRfTkVUV09SS0VEX1BBUlRJQ0xFX0ZYX05PTl9MT09QRURfQVRfQ09PUkQoInNjcl94bV9vcmJpdGFsX2JsYXN0IiwgUG9zaXRpb24ueCwgUG9zaXRpb24ueSwgUG9zaXRpb24ueiwgMCwgMTgwLCAwLCA0LjUsIHRydWUsIHRydWUsIHRydWUpCiAgICBlbmQKICAgIG51a2VfZXhwbDEoUG9zaXRpb24pCglmb3IgaSA9IDEsIDQgZG8KCQlBVURJTy5QTEFZX1NPVU5EX0ZST01fRU5USVRZKC0xLCAiRExDX1hNX0V4cGxvc2lvbnNfT3JiaXRhbF9DYW5ub24iLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwLCB0cnVlLCAwKQoJZW5kCiAgICBmb3IgY291bnQgPSAxLCAyIGRvCiAgICAgICAgaWYgY291bnQgPT0gMSB0aGVuCgkgICAgICAgIEZJUkUuQUREX0VYUExPU0lPTihQb3NpdGlvbi54LCBQb3NpdGlvbi55LCBQb3NpdGlvbi56LTEwLCA1OSwgMSwgdHJ1ZSwgZmFsc2UsIDUuMCwgZmFsc2UpCiAgICAgICAgZW5kCgkJcmVxdWVzdF9wdGZ4X2Fzc2V0KCJzY3JfeG1fb3JiaXRhbCIpCiAgICAgICAgR1JBUEhJQ1MuVVNFX1BBUlRJQ0xFX0ZYX0FTU0VUKCJzY3JfeG1fb3JiaXRhbCIpCgkgICAgR1JBUEhJQ1MuU1RBUlRfTkVUV09SS0VEX1BBUlRJQ0xFX0ZYX05PTl9MT09QRURfQVRfQ09PUkQoInNjcl94bV9vcmJpdGFsX2JsYXN0IiwgUG9zaXRpb24ueCwgUG9zaXRpb24ueSwgUG9zaXRpb24uei0xMCwgMCwgMTgwLCAwLCA0LjUsIHRydWUsIHRydWUsIHRydWUpCiAgICBlbmQKICAgIG51a2VfZXhwbDIoUG9zaXRpb24pCiAgICBsb2NhbCBzaXplID0gMS41CiAgICBsb2NhbCBwb3NpdGlvbnNaID0gezEsIDMsIDUsIDcsIDEwLCAxMiwgMTUsIDE3LCAyMCwgMjIsIDI1LCAyNywgMzAsIDMyLCAzNSwgMzcsIDQwLCA0MiwgNDUsIDQ3LCA1MCwgNTIsIDU1LCA1NywgNTksIDYxLCA2MywgNjUsIDcwLCA3NSwgNzUsIDc1LCA3NSwgODAsIDgwfQogICAgZm9yIGksIHBvcyBpbiBpcGFpcnMocG9zaXRpb25zWikgZG8KICAgICAgICBpZiBpID09IDMgb3IgaSA9PSA1IG9yIGkgPT0gNyBvciBpID09IDkgb3IgaSA9PSAxMSBvciBpID09IDEzIG9yIGkgPT0gMTUgb3IgaSA9PSAxNyBvciBpID09IDE5IG9yIGkgPT0gMjEgb3IgaSA9PSAyMyBvciBpID09IDI1IG9yIGkgPT0gMjkgb3IgaSA9PSAzMCB0aGVuCiAgICAgICAgRklSRS5BRERfRVhQTE9TSU9OKFBvc2l0aW9uLngsIFBvc2l0aW9uLnksIFBvc2l0aW9uLnorcG9zLCA1OSwgMS4wLCB0cnVlLCBmYWxzZSwgMS4wLCBmYWxzZSkKICAgICAgICBlbmQKICAgICAgICByZXF1ZXN0X3B0ZnhfYXNzZXQoInNjcl94bV9vcmJpdGFsIikKICAgICAgICBHUkFQSElDUy5VU0VfUEFSVElDTEVfRlhfQVNTRVQoInNjcl94bV9vcmJpdGFsIikKCSAgICBHUkFQSElDUy5TVEFSVF9ORVRXT1JLRURfUEFSVElDTEVfRlhfTk9OX0xPT1BFRF9BVF9DT09SRCgic2NyX3htX29yYml0YWxfYmxhc3QiLCBQb3NpdGlvbi54LCBQb3NpdGlvbi55LCBQb3NpdGlvbi56K3BvcywgMCwgMTgwLCAwLCBzaXplLCB0cnVlLCB0cnVlLCB0cnVlKQoKICAgICAgICBpZiBpID49IDMwIGFuZCBpIDw9IDMzIHRoZW4gc2l6ZSA9IDMuNQogICAgICAgIGVsc2VpZiBpID49IDM0IGFuZCBpIDw9IDM1IHRoZW4gc2l6ZSA9IDMuMAogICAgICAgIGVsc2Ugc2l6ZSA9IDEuNSBlbmQKICAgICAgICB1dGlsLnlpZWxkKDEwKQogICAgZW5kCiAgICBudWtlX2V4cGwzKFBvc2l0aW9uKQoJZm9yIF8sIHBpZCBpbiBwYWlycyhwbGF5ZXJzLmxpc3QoZmFsc2UsIHRydWUsIHRydWUpKSBkbwogICAgICAgIGxvY2FsIGRpc3RhbmNlID0gZ2V0X2Rpc3RhbmNlX2JldHdlZW4ocGxheWVycy5nZXRfcG9zaXRpb24ocGlkKSwgUG9zaXRpb24pCgkJaWYgZGlzdGFuY2UgPCAyMDAgdGhlbgoJCQlsb2NhbCBwaWRfcG9zID0gcGxheWVycy5nZXRfcG9zaXRpb24ocGlkKQoJCQlGSVJFLkFERF9FWFBMT1NJT04ocGlkX3Bvcy54LCBwaWRfcG9zLnksIHBpZF9wb3MueiwgNTksIDEuMCwgdHJ1ZSwgZmFsc2UsIDEuMCwgZmFsc2UpCgkJZW5kCgllbmQKCWxvY2FsIHBlZHMgPSBlbnRpdGllcy5nZXRfYWxsX3BlZHNfYXNfaGFuZGxlcygpCglmb3IgXywgcGVkIGluIHBhaXJzKHBlZHMpIGRvCgkJaWYgZ2V0X2Rpc3RhbmNlX2JldHdlZW4ocGVkLCBQb3NpdGlvbikgPiAyMDAgYW5kIGdldF9kaXN0YW5jZV9iZXR3ZWVuKHBlZCwgUG9zaXRpb24pIDwgNDAwIGFuZCBwZWQgfj0gUExBWUVSLlBMQVlFUl9QRURfSUQoKSB0aGVuCgkJCWxvY2FsIHBlZF9wb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMocGVkKQoJCQlGSVJFLkFERF9FWFBMT1NJT04ocGVkX3Bvcy54LCBwZWRfcG9zLnksIHBlZF9wb3MueiwgMywgMS4wLCB0cnVlLCB0cnVlLCAwLjEsIGZhbHNlKQoJCWVuZAoJZW5kCglsb2NhbCB2ZWhpY2xlcyA9IGVudGl0aWVzLmdldF9hbGxfdmVoaWNsZXNfYXNfaGFuZGxlcygpCiAgICBmb3IgXywgdmVoaWNsZSBpbiBwYWlycyh2ZWhpY2xlcykgZG8KCQlpZiBnZXRfZGlzdGFuY2VfYmV0d2Vlbih2ZWhpY2xlLCBQb3NpdGlvbikgPCA0MDAgdGhlbgoJCQlWRUhJQ0xFLkVYUExPREVfVkVISUNMRSh2ZWhpY2xlLCB0cnVlLCBmYWxzZSkKCQllbHNlaWYgZ2V0X2Rpc3RhbmNlX2JldHdlZW4odmVoaWNsZSwgUG9zaXRpb24pID4gMjAwIGFuZCBnZXRfZGlzdGFuY2VfYmV0d2Vlbih2ZWhpY2xlLCBQb3NpdGlvbikgPCA0MDAgdGhlbgoJCQlWRUhJQ0xFLkVYUExPREVfVkVISUNMRSh2ZWhpY2xlLCB0cnVlLCBmYWxzZSkKCQllbmQKCWVuZAplbmQKZnVuY3Rpb24gbnVjbGVhcl93ZWFwb24yKCkKICAgIGlmIFBFRC5JU19QRURfU0hPT1RJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkgdGhlbgoJCWxvY2FsIGhhc2ggPSB1dGlsLmpvYWF0KCJwcm9wX21pbGl0YXJ5X3BpY2t1cF8wMSIpCgkJcmVxdWVzdF9tb2RlbChoYXNoKQoJCWxvY2FsIHBsYXllcl9wb3MgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMC4wLCA1LjAsIDMuMCkKCQlsb2NhbCBkaXIgPSB7fQoJCWxvY2FsIGMyID0ge30KCQljMiA9IGdldF9vZmZzZXRfZnJvbV9jYW1lcmEoMTAwMCkKCQlkaXIueCA9IChjMi54IC0gcGxheWVyX3Bvcy54KSAqIDEwMDAKCQlkaXIueSA9IChjMi55IC0gcGxheWVyX3Bvcy55KSAqIDEwMDAKCQlkaXIueiA9IChjMi56IC0gcGxheWVyX3Bvcy56KSAqIDEwMDAKCQlsb2NhbCBudWtlID0gT0JKRUNULkNSRUFURV9PQkpFQ1RfTk9fT0ZGU0VUKGhhc2gsIHBsYXllcl9wb3MueCwgcGxheWVyX3Bvcy55LCBwbGF5ZXJfcG9zLnosIHRydWUsIGZhbHNlLCBmYWxzZSkKCQlFTlRJVFkuU0VUX0VOVElUWV9OT19DT0xMSVNJT05fRU5USVRZKG51a2UsIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKQoJCUVOVElUWS5BUFBMWV9GT1JDRV9UT19FTlRJVFkobnVrZSwgMCwgZGlyLngsIGRpci55LCBkaXIueiwgMC4wLCAwLjAsIDAuMCwgMCwgdHJ1ZSwgZmFsc2UsIHRydWUsIGZhbHNlLCB0cnVlKQoJCUVOVElUWS5TRVRfRU5USVRZX0hBU19HUkFWSVRZKG51a2UsIHRydWUpCgkJd2hpbGUgbm90IEVOVElUWS5IQVNfRU5USVRZX0NPTExJREVEX1dJVEhfQU5ZVEhJTkcobnVrZSkgYW5kIG5vdCBFTlRJVFkuSVNfRU5USVRZX0lOX1dBVEVSKG51a2UpIGRvCgkJCXV0aWwueWllbGQoMCkKCQllbmQKCQlsb2NhbCBudWtlUG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKG51a2UsIHRydWUpCgkJZGVsZXRlX2VudGl0eShudWtlKQogICAgICAgIGNyZWF0ZV9udWtlX2V4cGxvc2lvbihudWtlUG9zKQoJZW5kCmVuZAoKCgoKCi0tLS3miqTpgIHmoLjlvLnovaYKZnVuY3Rpb24gZXNjb3J0X251a2Uob24scGlkKQogICAgaWYgb24gdGhlbgogICAgICAgIGxvY2FsIHBlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICAgICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKHBlZCwgMC4wLCA1LjAsIDAuMCkKICAgICAgICBsb2NhbCBoYXNoID0gdXRpbC5qb2FhdCgidGlwdHJ1Y2siKQogICAgICAgIHJlcXVlc3RfbW9kZWwoaGFzaCkKICAgICAgICBudWtldHJ1Y2sgPSBWRUhJQ0xFLkNSRUFURV9WRUhJQ0xFKGhhc2gsIHBvcy54ICwgcG9zLnksIHBvcy56LCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKHBlZCksIHRydWUsIGZhbHNlLCB0cnVlKQogICAgICAgIGxvY2FsIGhhc2gyID0gdXRpbC5qb2FhdCgicHJvcF9taWxpdGFyeV9waWNrdXBfMDEiKQogICAgICAgIHJlcXVlc3RfbW9kZWwoaGFzaDIpCiAgICAgICAgbG9jYWwgdHJ1Y2tfcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKG51a2V0cnVjaywgdHJ1ZSkKICAgICAgICBsb2NhbCB0cnVja19yb3QgPSBFTlRJVFkuR0VUX0VOVElUWV9ST1RBVElPTihudWtldHJ1Y2ssIDApCiAgICAgICAgZXNudWtlID0gT0JKRUNULkNSRUFURV9PQkpFQ1RfTk9fT0ZGU0VUKGhhc2gyLCB0cnVja19wb3MueCwgdHJ1Y2tfcG9zLnksIHRydWNrX3Bvcy56ICsgMiwgdHJ1ZSwgZmFsc2UsIHRydWUpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSEFTX0dSQVZJVFkoZXNudWtlLCB0cnVlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKGVzbnVrZSwgdHJ1Y2tfcm90LngsIHRydWNrX3JvdC55LCB0cnVja19yb3Queis5MCwgMCwgdHJ1ZSkKICAgICAgICBFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkoZXNudWtlLCBudWtldHJ1Y2ssIDAsIDAuMCwgLTEuNSwgMS43LCAwLjAsIDAuMCwgOTAuMCwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDIsIHRydWUsIDApCiAgICAgICAgdXRpbC5jcmVhdGVfdGlja19oYW5kbGVyKGZ1bmN0aW9uKCkKICAgICAgICAgICAgaWYgVkVISUNMRS5HRVRfVkVISUNMRV9FTkdJTkVfSEVBTFRIKG51a2V0cnVjaykgPD0gMCBhbmQgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKGVzbnVrZSkgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgbnVrZVBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhlc251a2UsIHRydWUpCiAgICAgICAgICAgICAgICBkZWxldGVfZW50aXR5KGVzbnVrZSkKICAgICAgICAgICAgICAgIGNyZWF0ZV9udWtlX2V4cGxvc2lvbihudWtlUG9zKQogICAgICAgICAgICAgICAgbWVudS5zZXRfdmFsdWUoc2FmZV9udWtlLCBmYWxzZSkKICAgICAgICAgICAgICAgIHV0aWwudG9hc3QoIuaguOW8ueW3suiiq+W8leeIhiIpCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQogICAgZWxzZQogICAgICAgIGlmIEVOVElUWS5ET0VTX0VOVElUWV9FWElTVChlc251a2UpIHRoZW4KICAgICAgICAgICAgZGVsZXRlX2VudGl0eShlc251a2UpCiAgICAgICAgZW5kCiAgICAgICAgaWYgRU5USVRZLkRPRVNfRU5USVRZX0VYSVNUKG51a2V0cnVjaykgdGhlbgogICAgICAgICAgICBkZWxldGVfZW50aXR5KG51a2V0cnVjaykKICAgICAgICBlbmQKICAgIGVuZAplbmQKCgoKLS0tLei/kOi+k+aguOW8uQpmdW5jdGlvbiB0cmFuc3BvcnRfbnVrZSgpCiAgICBsb2NhbCBtc2cgPSAifnl+5oyJIH4lc34g5oqV5o635qC45by5IgogICAgdXRpbC5zaG93X2Nvcm5lcl9oZWxwKG1zZzpmb3JtYXQoIklOUFVUX1ZFSF9IT1JOIikpCiAgICBsb2NhbCBwZWQgPSBQTEFZRVIuUExBWUVSX1BFRF9JRCgpCiAgICBsb2NhbCBoYXNoID0gdXRpbC5qb2FhdCgicHJvcF9taWxpdGFyeV9waWNrdXBfMDEiKQogICAgbG9jYWwgcG9zID0gcGxheWVycy5nZXRfcG9zaXRpb24oUExBWUVSLlBMQVlFUl9JRCgpKQogICAgcmVxdWVzdF9tb2RlbCh1dGlsLmpvYWF0KCJza3lsaWZ0IikpCiAgICByZXF1ZXN0X21vZGVsKGhhc2gpCiAgICBsb2NhbCBza3lsaWZ0ID0gVkVISUNMRS5DUkVBVEVfVkVISUNMRSh1dGlsLmpvYWF0KCJza3lsaWZ0IiksIHBvcy54LCBwb3MueSwgcG9zLnosIEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcocGVkKSwgdHJ1ZSwgZmFsc2UsIGZhbHNlKQogICAgUEVELlNFVF9QRURfSU5UT19WRUhJQ0xFKHBlZCwgc2t5bGlmdCwgLTEpCiAgICBsb2NhbCBudWtlID0gT0JKRUNULkNSRUFURV9PQkpFQ1RfTk9fT0ZGU0VUKGhhc2gsIHBvcy54LCBwb3MueSwgcG9zLnosIHRydWUsIGZhbHNlLCB0cnVlKQogICAgRU5USVRZLlNFVF9FTlRJVFlfQVNfTUlTU0lPTl9FTlRJVFkobnVrZSwgdHJ1ZSwgdHJ1ZSktLemYsuatoua2iOWksQogICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKG51a2UsIHNreWxpZnQsIDAsIDAsIC0yLjgsIC0xLjAsIDAuMCwgMC4wLCAwLjAsIHRydWUsIHRydWUsIHRydWUsIGZhbHNlLCAwLCB0cnVlLCAwKQogICAgd2hpbGUgdHJ1ZSBkbwogICAgICAgIGxvY2FsIHNreWxpZnRQb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoc2t5bGlmdCwgdHJ1ZSkKICAgICAgICBsb2NhbCBzdHJnID0gIn5ifiBFbGV2YXRpb24gfnd+Ii4ubWF0aC5jZWlsKHNreWxpZnRQb3MueikKICAgICAgICBkcmF3X3N0cmluZyhzdHJnLCAwLjAzLCAwLjEsIDAuNiwgNCkKICAgICAgICBpZiBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsNDYpIHRoZW4KICAgICAgICAgICAgaWYgRU5USVRZLklTX0VOVElUWV9BVFRBQ0hFRChudWtlKSB0aGVuCiAgICAgICAgICAgICAgICBFTlRJVFkuREVUQUNIX0VOVElUWShudWtlLCB0cnVlLCB0cnVlKQogICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uKCJ+Ym9sZH5+eX7ngrjlvLnlt7LmipXmlL4iLCBIdWRDb2xvdXIuYmx1ZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIEVOVElUWS5BUFBMWV9GT1JDRV9UT19FTlRJVFkobnVrZSwgMywgMC4wLCAwLjAsIC01MCwgMC4wLCAwLjAsIDAuMCwgMCwgdHJ1ZSwgZmFsc2UsIHRydWUsIGZhbHNlLCB0cnVlKQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9IQVNfR1JBVklUWShudWtlLCB0cnVlKQogICAgICAgICAgICB3aGlsZSBub3QgRU5USVRZLkhBU19FTlRJVFlfQ09MTElERURfV0lUSF9BTllUSElORyhudWtlKSBhbmQgbm90IEVOVElUWS5JU19FTlRJVFlfSU5fV0FURVIobnVrZSkgZG8KICAgICAgICAgICAgICAgIHV0aWwueWllbGQoMCkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGlmIEVOVElUWS5ET0VTX0VOVElUWV9FWElTVChudWtlKSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBudWtlUG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKG51a2UsIHRydWUpCiAgICAgICAgICAgICAgICBkZWxldGVfZW50aXR5KG51a2UpCiAgICAgICAgICAgICAgICBjcmVhdGVfbnVrZV9leHBsb3Npb24obnVrZVBvcykKICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbigifmJvbGR+fnl+5qC45by55bey54iG54K4IiwgSHVkQ29sb3VyLmJsdWUpCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAplbmQKCgoKLS0tLS0t5YmN5rua57+7CmxvY2FsIGlfZm9yd2FyZCA9IDM2MApmdW5jdGlvbiBmb3J3YXJkX3JvbGwoKQogICAgcmVxdWVzdF9hbmltX2RpY3QoIm1pc3NjaGluZXNlMl9jcnlzdGFsbWF6ZSIpCiAgICBUQVNLLlRBU0tfUExBWV9BTklNKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksICJtaXNzY2hpbmVzZTJfY3J5c3RhbG1hemUiLCAiMmludF9sb29wX2FfdGFvdHJhbnNsYXRvciIsIDguMCwgOC4wLCAtMSwgMCwgMC4wLCAwLCAwLCAwKQogICAgbG9jYWwgY2FtX3JvdCA9IENBTS5HRVRfR0FNRVBMQVlfQ0FNX1JPVCgwKQogICAgbG9jYWwgdXNlcl9yb3QgPSBFTlRJVFkuR0VUX0VOVElUWV9ST1RBVElPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwKQogICAgbG9jYWwgZndkX3ZlY3QgPSBFTlRJVFkuR0VUX0VOVElUWV9GT1JXQVJEX1ZFQ1RPUihQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgbG9jYWwgc3BlZWQgPSBFTlRJVFkuR0VUX0VOVElUWV9TUEVFRChQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSAqIDIuMjM2OTM2CiAgICBQRUQuU0VUX1BFRF9DQU5fUkFHRE9MTChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGlfZm9yd2FyZCwgdXNlcl9yb3QueSwgY2FtX3JvdC56LCAyLCB0cnVlKQogICAgaWYgc3BlZWQgPD0gNzAgdGhlbgogICAgICAgIEVOVElUWS5BUFBMWV9GT1JDRV9UT19FTlRJVFkoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMywgZndkX3ZlY3QueCwgZndkX3ZlY3QueSwgMC4wLCAwLjAsIDAuMCwgMC4wLCAwLjAsIGZhbHNlLCBmYWxzZSwgdHJ1ZSwgZmFsc2UsIGZhbHNlKQogICAgZW5kCiAgICBpZiBpX2ZvcndhcmQgPD0gMCB0aGVuIGlfZm9yd2FyZCA9IDM2MCBlbHNlIGlfZm9yd2FyZCA9IGlfZm9yd2FyZCAtIDYgZW5kIAplbmQKZnVuY3Rpb24gZW5kX2ZvcndhcmRfcm9sbCgpCiAgICB1dGlsLnlpZWxkKDEwMCkKICAgIFBFRC5TRVRfUEVEX0NBTl9SQUdET0xMKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUpCiAgICBUQVNLLlNUT1BfQU5JTV9UQVNLKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksICJtaXNzY2hpbmVzZTJfY3J5c3RhbG1hemUiLCAiMmludF9sb29wX2FfdGFvdHJhbnNsYXRvciIsIDEpCmVuZAoKLS0tLeihl+iIngpsb2NhbCBkYW5yb3RhdGlvbiA9IDAKbG9jYWwgZGFubG9vcF9jb3VudCA9IDAKZnVuY3Rpb24gYnJlYWtkYW5jZSgpCiAgICBsb2NhbCBkaWN0LCBuYW1lCiAgICBpZiBkYW5sb29wX2NvdW50IDw9IDIwMCB0aGVuCiAgICAgICAgZGljdCA9ICJtaXNzZmJpNWlnXzIwYiIKICAgICAgICBuYW1lID0gImhhbmRzX3VwX3NjaWVudGlzdCIKICAgIGVsc2VpZiBkYW5sb29wX2NvdW50IDw9IDQwMCB0aGVuCiAgICAgICAgZGljdCA9ICJubUBoYW5kcyIKICAgICAgICBuYW1lID0gImhhbmRzX3VwIgogICAgZWxzZWlmIGRhbmxvb3BfY291bnQgPD0gNjAwIHRoZW4KICAgICAgICBkaWN0ID0gIm1pc3NoZWlzdF9hZ2VuY3kyYWhhbmRzX3VwIgogICAgICAgIG5hbWUgPSAiaGFuZHN1cF9hbnhpb3VzIgogICAgZWxzZWlmIGRhbmxvb3BfY291bnQgPD0gODAwIHRoZW4KICAgICAgICBkaWN0ID0gIm1pc3NoZWlzdF9hZ2VuY3kyYWhhbmRzX3VwIgogICAgICAgIG5hbWUgPSAiaGFuZHN1cF9sb29wIgogICAgZW5kCiAgICBFTlRJVFkuU0VUX0VOVElUWV9ST1RBVElPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAxODAsIDAsIGRhbnJvdGF0aW9uLCAxLCB0cnVlKQogICAgcmVxdWVzdF9hbmltX2RpY3QoZGljdCkKICAgIFRBU0suVEFTS19QTEFZX0FOSU0oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZGljdCwgbmFtZSwgOC4wLCAwLCAtMSwgMCwgMC4wLCAwLCAwLCAwKQogICAgZGFucm90YXRpb24gPSBkYW5yb3RhdGlvbiArIDUKICAgIGlmIGRhbmxvb3BfY291bnQgPCAxMDAwIHRoZW4KICAgICAgICBkYW5sb29wX2NvdW50ID0gZGFubG9vcF9jb3VudCArIDEKICAgIGVsc2UKICAgICAgICBkYW5sb29wX2NvdW50ID0gMAogICAgZW5kCmVuZApmdW5jdGlvbiBlbmRfYnJlYWtkYW5jZSgpCiAgICBUQVNLLkNMRUFSX1BFRF9UQVNLU19JTU1FRElBVEVMWShQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQplbmQKCgoKLS0tLeS8oOmAgeWIsOacgOi/keeOqeWutgpmdW5jdGlvbiBnZXRDbG9zZXN0UGxheWVyKG15UG9zKQogICAgbG9jYWwgY2xvc2VzdERpc3QgPSAxMDAwMDAwCiAgICBsb2NhbCBjbG9zZXN0X3BsYXllciA9IG5pbAogICAgZm9yIHBpZCA9IDAsIDMxIGRvCgkJbG9jYWwgcGVkID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKCQlpZiBub3QgRU5USVRZLklTX0VOVElUWV9ERUFEKHBlZCkgYW5kIHBlZCB+PSAwIGFuZCBwZWQgfj0gUExBWUVSLlBMQVlFUl9QRURfSUQoKSB0aGVuCiAgICAgICAgICAgIGxvY2FsIHBsYXllcnBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhwZWQsIGZhbHNlKQogICAgICAgICAgICBsb2NhbCBkaXN0ID0gbXlQb3M6ZGlzdGFuY2UocGxheWVycG9zKQogICAgICAgICAgICBpZiBkaXN0IDwgY2xvc2VzdERpc3QgdGhlbgogICAgICAgICAgICAgICAgY2xvc2VzdERpc3QgPSBkaXN0CiAgICAgICAgICAgICAgICBjbG9zZXN0X3BsYXllciA9IHBpZAogICAgICAgICAgICBlbmQKCQllbmQKICAgIGVuZAogICAgcmV0dXJuIGNsb3Nlc3RfcGxheWVyCmVuZApmdW5jdGlvbiB0cF9jbG9zZXN0X3BsYXllcigpCiAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpCglsb2NhbCBwbGF5ZXIgPSBnZXRDbG9zZXN0UGxheWVyKHBvcykKICAgIGlmIFBMQVlFUi5HRVRfUExBWUVSX1BFRChwbGF5ZXIpIH49IDAgYW5kIHBsYXllciB+PSBuaWwgdGhlbgogICAgICAgIGxvY2FsIHBsYXllcl9wb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBsYXllciksIGZhbHNlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBwbGF5ZXJfcG9zLngsIHBsYXllcl9wb3MueSwgcGxheWVyX3Bvcy56LCBmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgIGVuZAplbmQKCgoKLS0tLS3ph5HoibLnv4XohoAKZnVuY3Rpb24gR29sZGVuX3dpbmdzKG9uKQogICAgaWYgb24gdGhlbgkKICAgICAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSkKICAgICAgICBHb3dpbmdzID0gT0JKRUNULkNSRUFURV9PQkpFQ1QodXRpbC5qb2FhdCgidndfcHJvcF9hcnRfd2luZ3NfMDFhIiksIHBvcy54LCBwb3MueSwgcG9zLnosIHRydWUsIHRydWUsIHRydWUpCiAgICAgICAgU1RSRUFNSU5HLlNFVF9NT0RFTF9BU19OT19MT05HRVJfTkVFREVEKHV0aWwuam9hYXQoInZ3X3Byb3BfYXJ0X3dpbmdzXzAxYSIpKQogICAgICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWShHb3dpbmdzLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBQRUQuR0VUX1BFRF9CT05FX0lOREVYKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDB4NWMwMSksIC0xLjAsIDAuMCwgMC4wLCAwLjAsIDkwLjAsIDAuMCwgZmFsc2UsIHRydWUsIGZhbHNlLCB0cnVlLCAwLCB0cnVlLCAwKQogICAgZWxzZQogICAgICAgIGRlbGV0ZV9lbnRpdHkoR293aW5ncykKICAgIGVuZAplbmQKCi0tLS0t6ZO26Imy57+F6IaACmZ1bmN0aW9uIGFyZ2VudF93aW5ncyhvbikKICAgIGlmIG9uIHRoZW4JCiAgICAgICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUpCiAgICAgICAgYXJnd2luZ3MgPSBPQkpFQ1QuQ1JFQVRFX09CSkVDVCgtMTEyMzg0NjYxLCBwb3MueCwgcG9zLnksIHBvcy56LCB0cnVlLCB0cnVlLCB0cnVlKQogICAgICAgIFNUUkVBTUlORy5TRVRfTU9ERUxfQVNfTk9fTE9OR0VSX05FRURFRCgtMTEyMzg0NjYxKQogICAgICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWShhcmd3aW5ncywgUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgUEVELkdFVF9QRURfQk9ORV9JTkRFWChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAweDVjMDEpLCAtMS4wLCAwLjAsIDAuMCwgMC4wLCA5MC4wLCAwLjAsIGZhbHNlLCB0cnVlLCBmYWxzZSwgdHJ1ZSwgMCwgdHJ1ZSwgMCkKICAgIGVsc2UKICAgICAgICBkZWxldGVfZW50aXR5KGFyZ3dpbmdzKQogICAgZW5kCmVuZAoKCgoKLS0tLeeBq+e/heiGgApsb2NhbCBmaXJld2luZyA9IHt9CmZ1bmN0aW9uIGZpcmVXaW5nKHRvZ2dsZWQpCiAgICBpZiB0b2dnbGVkIHRoZW4KICAgICAgICBpZiBmaXJld2luZ1sxXSB0aGVuIHJldHVybiBlbmQKICAgICAgICBsb2NhbCBmaXJlV2luZ3IgPSAyNTU7bG9jYWwgZmlyZVdpbmdnID0gMTY1O2xvY2FsIGZpcmVXaW5nYiA9IDUwCiAgICAgICAgbG9jYWwgZGljdGlvbmFyeSA9ICJ3ZWFwX3hzX3ZlaGljbGVfd2VhcG9ucyIKICAgICAgICBsb2NhbCBwdGZ4X25hbWUgPSAibXV6X3hzX3R1cnJldF9mbGFtZXRocm93ZXJfbG9vcGluZyIKICAgICAgICBmb3IgaSA9IDEsICNmaXJlV2luZ3MgZG8KICAgICAgICAgICAgcmVxdWVzdF9wdGZ4X2Fzc2V0KGRpY3Rpb25hcnkpCiAgICAgICAgICAgIEdSQVBISUNTLlVTRV9QQVJUSUNMRV9GWF9BU1NFVChkaWN0aW9uYXJ5KQogICAgICAgICAgICBmaXJld2luZ1tpXSA9IEdSQVBISUNTLlNUQVJUX05FVFdPUktFRF9QQVJUSUNMRV9GWF9MT09QRURfT05fRU5USVRZKHB0ZnhfbmFtZSwgUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMCwgMCwgMC4xLCBmaXJlV2luZ3NbaV0ucG9zWzFdLCAwLCBmaXJlV2luZ3NbaV0ucG9zWzJdLCAwLjIsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgICAgIC0tR1JBUEhJQ1MuU0VUX1BBUlRJQ0xFX0ZYX0xPT1BFRF9TQ0FMRShmaXJld2luZ1tpXSwgMC4zKQogICAgICAgICAgICBHUkFQSElDUy5TRVRfUEFSVElDTEVfRlhfTE9PUEVEX0NPTE9VUihmaXJld2luZ1tpXSwgZmlyZVdpbmdyLCBmaXJlV2luZ2csIGZpcmVXaW5nYiwgZmFsc2UpCQkKICAgICAgICBlbmQJCQkKICAgIGVsc2UKICAgICAgICBmb3IgaSA9IDEsICNmaXJlV2luZ3MgZG8KICAgICAgICAgICAgaWYgZmlyZXdpbmdbaV0gdGhlbgogICAgICAgICAgICAgICAgR1JBUEhJQ1MuU1RPUF9QQVJUSUNMRV9GWF9MT09QRUQoZmlyZXdpbmdbaV0sIGZhbHNlKQogICAgICAgICAgICAgICAgR1JBUEhJQ1MuUkVNT1ZFX1BBUlRJQ0xFX0ZYKGZpcmV3aW5nW2ldLCBmYWxzZSkKICAgICAgICAgICAgICAgIGZpcmV3aW5nW2ldID0gbmlsCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIEdSQVBISUNTLlJFTU9WRV9QQVJUSUNMRV9GWF9GUk9NX0VOVElUWShQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgZW5kCmVuZAotLS0t5b2p6Imy57+F6IaACmxvY2FsIGNvbG9yX2ZpcmV3aW5nID0ge30KZnVuY3Rpb24gY29sb3JmdWxfZmlyZVdpbmcodG9nZ2xlZCkKICAgIGlmIHRvZ2dsZWQgdGhlbgogICAgICAgIGZvciBpID0gMSwgI2ZpcmVXaW5ncyBkbwogICAgICAgICAgICByZXF1ZXN0X3B0ZnhfYXNzZXQoJ3dlYXBfeHNfdmVoaWNsZV93ZWFwb25zJykKICAgICAgICAgICAgR1JBUEhJQ1MuVVNFX1BBUlRJQ0xFX0ZYX0FTU0VUKCd3ZWFwX3hzX3ZlaGljbGVfd2VhcG9ucycpCiAgICAgICAgICAgIGNvbG9yX2ZpcmV3aW5nW2ldID0gR1JBUEhJQ1MuU1RBUlRfTkVUV09SS0VEX1BBUlRJQ0xFX0ZYX0xPT1BFRF9PTl9FTlRJVFkoJ211el94c190dXJyZXRfZmxhbWV0aHJvd2VyX2xvb3BpbmcnLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwLCAwLCAwLjEsIGZpcmVXaW5nc1tpXS5wb3NbMV0sIDAsIGZpcmVXaW5nc1tpXS5wb3NbMl0sIDAuMiwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgdXRpbC5jcmVhdGVfdGlja19oYW5kbGVyKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIGlmICNjb2xvcl9maXJld2luZyA8IDEgdGhlbiByZXR1cm4gZmFsc2UgZW5kCiAgICAgICAgICAgICAgICBmb3IgdiA9IDEsICNmaXJlV2luZ3MgZG8KICAgICAgICAgICAgICAgICAgICBHUkFQSElDUy5TRVRfUEFSVElDTEVfRlhfTE9PUEVEX1NDQUxFKGNvbG9yX2ZpcmV3aW5nW3ZdLCAwLjMpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgdGltZXIgPSBNSVNDLkdFVF9HQU1FX1RJTUVSKCkKICAgICAgICAgICAgICAgICAgICBsb2NhbCBjb2xvcmZ1bF9jb2xvciA9IGdyYWRpZW50X2NvbG91cih0aW1lciwgMSkKICAgICAgICAgICAgICAgICAgICBHUkFQSElDUy5TRVRfUEFSVElDTEVfRlhfTE9PUEVEX0NPTE9VUihjb2xvcl9maXJld2luZ1t2XSwgY29sb3JmdWxfY29sb3Iuci8yNTUsIGNvbG9yZnVsX2NvbG9yLmcvMjU1LCBjb2xvcmZ1bF9jb2xvci5iLzI1NSwgZmFsc2UpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQkJCQkKICAgICAgICBlbmQJCQkKICAgIGVsc2UKICAgICAgICBmb3IgaSA9IDEsICNmaXJlV2luZ3MgZG8KICAgICAgICAgICAgaWYgY29sb3JfZmlyZXdpbmdbaV0gdGhlbgogICAgICAgICAgICAgICAgR1JBUEhJQ1MuU1RPUF9QQVJUSUNMRV9GWF9MT09QRUQoY29sb3JfZmlyZXdpbmdbaV0sIGZhbHNlKQogICAgICAgICAgICAgICAgR1JBUEhJQ1MuUkVNT1ZFX1BBUlRJQ0xFX0ZYKGNvbG9yX2ZpcmV3aW5nW2ldLCBmYWxzZSkKICAgICAgICAgICAgICAgIGNvbG9yX2ZpcmV3aW5nW2ldID0gbmlsCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIEdSQVBISUNTLlJFTU9WRV9QQVJUSUNMRV9GWF9GUk9NX0VOVElUWShQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgZW5kCmVuZAotLS0tWFDngavnv4XohoAKZnVuY3Rpb24geHBfZmlyZVdpbmcodG9nZ2xlZCkKICAgIHhwX3RvZ2dsZWQgPSB0b2dnbGVkCiAgICBpZiB4cF90b2dnbGVkIHRoZW4KICAgICAgICB3aGlsZSB4cF90b2dnbGVkIGRvCiAgICAgICAgICAgIGxvY2FsIGZpcmVXaW5nciA9IDI1NTtsb2NhbCBmaXJlV2luZ2cgPSAxNjU7bG9jYWwgZmlyZVdpbmdiID0gNTAKICAgICAgICAgICAgbG9jYWwgZGljdGlvbmFyeSA9ICJjb3JlIgogICAgICAgICAgICBsb2NhbCBwdGZ4X25hbWUgPSAiZW50X3NodF9mbGFtZSIKICAgICAgICAgICAgbG9jYWwgcG9zMSA9IDY1O2xvY2FsIHBvczIgPSA3NTsKICAgICAgICAgICAgbG9jYWwgcG9zeiA9IHstMC4yLCAtMC4yLCAwLCAwLCAwLjIsIDAuMiwgMC40LCAwLjQsIDAuNiwgMC42fQogICAgICAgICAgICBmb3IgaSA9IDEsIDggZG8KICAgICAgICAgICAgICAgIHJlcXVlc3RfcHRmeF9hc3NldChkaWN0aW9uYXJ5KQogICAgICAgICAgICAgICAgR1JBUEhJQ1MuVVNFX1BBUlRJQ0xFX0ZYX0FTU0VUKGRpY3Rpb25hcnkpCiAgICAgICAgICAgICAgICBHUkFQSElDUy5TVEFSVF9ORVRXT1JLRURfUEFSVElDTEVfRlhfTk9OX0xPT1BFRF9PTl9FTlRJVFkocHRmeF9uYW1lLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwLCAwLCBwb3N6W2ldLCBwb3MxLCAwLCBwb3MyLCAxLCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICAgICAgR1JBUEhJQ1MuU0VUX1BBUlRJQ0xFX0ZYX05PTl9MT09QRURfQ09MT1VSKGZpcmVXaW5nciwgZmlyZVdpbmdnLCBmaXJlV2luZ2IpCQogICAgICAgICAgICAgICAgcG9zMiA9IHBvczIgKiAtMQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgdXRpbC55aWVsZCgzNTAwKQogICAgICAgIGVuZAogICAgZWxzZQogICAgICAgIEdSQVBISUNTLlJFTU9WRV9QQVJUSUNMRV9GWF9GUk9NX0VOVElUWShQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgZW5kCmVuZAoKLS0tLS3pkqLpk4HkvqAKZnVuY3Rpb24gSXJvbl9NYW4xKHRvZ2dsZWQpCiAgICBJcm9uX01hbl90b2dnbGVkID0gdG9nZ2xlZAogICAgCiAgICBsb2NhbCBjb250ZXh0ID0gQ0FNLkdFVF9DQU1fQUNUSVZFX1ZJRVdfTU9ERV9DT05URVhUKCkKICAgIGxvY2FsIHN0YXJ0Vmlld01vZGUgPSBDQU0uR0VUX0NBTV9WSUVXX01PREVfRk9SX0NPTlRFWFQoY29udGV4dCkKICAgIHdoaWxlIElyb25fTWFuX3RvZ2dsZWQgZG8KICAgICAgICAtLee7meS6iOWktOeblAogICAgICAgIGlmIG5vdCBQRUQuSVNfUEVEX1dFQVJJTkdfSEVMTUVUKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpIHRoZW4KICAgICAgICAgICAgUEVELkdJVkVfUEVEX0hFTE1FVChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlLCA0MDk2LCAtMSkKICAgICAgICBlbmQKCiAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJsZXZpdGF0ZSBvbiIpCiAgICAgICAgUEVELlNFVF9QRURfQ0FOX1NXSVRDSF9XRUFQT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSxmYWxzZSkgLS3npoHmraLliIfmjaLmrablmagKICAgICAgICBXRUFQT04uU0VUX0NVUlJFTlRfUEVEX1dFQVBPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAtMTU2OTYxNTI2MSwgdHJ1ZSktLS0t57uZ5LqI5b6S5omLCgogICAgICAgIGlmIENBTS5HRVRfQ0FNX1ZJRVdfTU9ERV9GT1JfQ09OVEVYVChjb250ZXh0KSB+PSA0IHRoZW4KICAgICAgICAgICAgQ0FNLlNFVF9DQU1fVklFV19NT0RFX0ZPUl9DT05URVhUKGNvbnRleHQsIDQpCiAgICAgICAgZW5kCgogICAgICAgIC0t5Yqo55S7CiAgICAgICAgR1JBUEhJQ1MuQkVHSU5fU0NBTEVGT1JNX01PVklFX01FVEhPRChHUkFQSElDUy5SRVFVRVNUX1NDQUxFRk9STV9NT1ZJRSgnUkVNT1RFX1NOSVBFUl9IVUQnKSwgJ1JFTU9URV9TTklQRVJfSFVEJykKICAgICAgICBHUkFQSElDUy5EUkFXX1NDQUxFRk9STV9NT1ZJRV9GVUxMU0NSRUVOKEdSQVBISUNTLlJFUVVFU1RfU0NBTEVGT1JNX01PVklFKCdSRU1PVEVfU05JUEVSX0hVRCcpLCAyNTUsIDI1NSwgMjU1LCAyNTUsIDApCiAgICAgICAgR1JBUEhJQ1MuRU5EX1NDQUxFRk9STV9NT1ZJRV9NRVRIT0QoKQogICAgICAgIAogICAgICAgIC0t5pi+56S65oyJ6ZSuCiAgICAgICAgZGlzcGxheV9idXR0b25zKHt7MCwgNDYsICfngavnrq3lvLknfSx7MSwgMjUsICfljp/lrZDmnqonfSx7MiwgMTgsICfmnLrngq4nfX0pCiAgICAgICAgLS3mjInplK7npoHmraIKICAgICAgICBkaXNhYmxlX2NvbnRyb2xfYWN0aW9uKDE0MCwgMTAzLCAyNCwgMjUpCiAgICAgICAgCiAgICAgICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICAgICAgbG9jYWwgYiA9IGdldF9vZmZzZXRfZnJvbV9jYW1lcmEoODApCiAgICAgICAgbG9jYWwgaGFzaAogICAgICAgIGlmIFBBRC5JU19ESVNBQkxFRF9DT05UUk9MX1BSRVNTRUQoMCwgMjQpIHRoZW4gLS1MRUZUIE1PVVNFCiAgICAgICAgICAgIGhhc2ggPSB1dGlsLmpvYWF0KCdWRUhJQ0xFX1dFQVBPTl9QTEFZRVJfTEFaRVInKQogICAgICAgICAgICByZXF1ZXN0X3dlYXBvbl9hc3NldChoYXNoKQoKICAgICAgICBlbHNlaWYgUEFELklTX0RJU0FCTEVEX0NPTlRST0xfUFJFU1NFRCgwLCAyNSkgdGhlbgogICAgICAgICAgICBoYXNoID0gdXRpbC5qb2FhdCgnV0VBUE9OX1JBWVBJU1RPTCcpCiAgICAgICAgICAgIHJlcXVlc3Rfd2VhcG9uX2Fzc2V0KGhhc2gpCiAgICAgICAgICAgIGlmIG5vdCBXRUFQT04uSEFTX1BFRF9HT1RfV0VBUE9OKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGhhc2gsIGZhbHNlKSB0aGVuCiAgICAgICAgICAgICAgICBXRUFQT04uR0lWRV9XRUFQT05fVE9fUEVEKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGhhc2gsIDk5OTksIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgZW5kCgogICAgICAgIGVsc2VpZiBQQUQuSVNfRElTQUJMRURfQ09OVFJPTF9QUkVTU0VEKDAsIDM4KSB0aGVuCiAgICAgICAgICAgIGhhc2ggPSB1dGlsLmpvYWF0KCdXRUFQT05fUlBHJykKICAgICAgICAgICAgcmVxdWVzdF93ZWFwb25fYXNzZXQoaGFzaCkKICAgICAgICAgICAgaWYgbm90IFdFQVBPTi5IQVNfUEVEX0dPVF9XRUFQT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgaGFzaCwgZmFsc2UpIHRoZW4KICAgICAgICAgICAgICAgIFdFQVBPTi5HSVZFX1dFQVBPTl9UT19QRUQoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgaGFzaCwgOTk5OSwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgcG9zLnggPSBwb3MueCArIG1hdGgucmFuZG9tKDAsIDEwMCkgLyAxMDAKICAgICAgICAgICAgcG9zLnkgPSBwb3MueSArIG1hdGgucmFuZG9tKDAsIDEwMCkgLyAxMDAKICAgICAgICAgICAgcG9zLnogPSBwb3MueiArIG1hdGgucmFuZG9tKDAsIDEwMCkgLyAxMDAKICAgICAgICBlbmQKICAgICAgICBNSVNDLlNIT09UX1NJTkdMRV9CVUxMRVRfQkVUV0VFTl9DT09SRFMocG9zLngsIHBvcy55LCBwb3MueiwgYi54LCBiLnksIGIueiwyMDAsIHRydWUsIGhhc2gsIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUsIHRydWUsIC0xLjApCgogICAgICAgIHV0aWwueWllbGQoKQogICAgZW5kCgogICAgUEVELlJFTU9WRV9QRURfSEVMTUVUKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUpIC0t56e76Zmk5aS055uUCiAgICBQRUQuU0VUX1BFRF9DQU5fU1dJVENIX1dFQVBPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlKSAtLeWFgeiuuOWIh+aNouatpuWZqAogICAgLS3ph43nva7liqjnlLsKICAgIGxvY2FsIHBTY2FsZWZvcm0gPSBtZW1vcnkuYWxsb2NfaW50KCkKICAgIG1lbW9yeS53cml0ZV9pbnQocFNjYWxlZm9ybSwgR1JBUEhJQ1MuUkVRVUVTVF9TQ0FMRUZPUk1fTU9WSUUoJ1JFTU9URV9TTklQRVJfSFVEJykpCiAgICBHUkFQSElDUy5TRVRfU0NBTEVGT1JNX01PVklFX0FTX05PX0xPTkdFUl9ORUVERUQocFNjYWxlZm9ybSkKICAgIG1lbnUudHJpZ2dlcl9jb21tYW5kcygibGV2aXRhdGUgb2ZmIikKCiAgICAtLeaBouWkjeinhuinkgogICAgQ0FNLlNFVF9DQU1fVklFV19NT0RFX0ZPUl9DT05URVhUKENBTS5HRVRfQ0FNX0FDVElWRV9WSUVXX01PREVfQ09OVEVYVCgpLCBzdGFydFZpZXdNb2RlKQplbmQKCgoKLS0tLeS8oOmAgeWIsOWOouWei+i9pgpmdW5jdGlvbiBnZXRfY2xvc2VzdF92ZWhpY2xlX25vZGUoY29vcmRzLCBub2RlVHlwZSkKICAgIGxvY2FsIG91dENvb3JkcyA9IHYzLm5ldygpCiAgICBsb2NhbCBvdXRIZWFkaW5nID0gbWVtb3J5LmFsbG9jKDQpCiAgICBpZiBQQVRIRklORC5HRVRfQ0xPU0VTVF9WRUhJQ0xFX05PREVfV0lUSF9IRUFESU5HKGNvb3Jkcy54LCBjb29yZHMueSwgY29vcmRzLnosCiAgICAgICAgICAgIG1lbW9yeS5hZGRyb2Yob3V0Q29vcmRzKSwgb3V0SGVhZGluZywgbm9kZVR5cGUsIDMuMCwgMCkgdGhlbgogICAgICAgIHJldHVybiB0cnVlLCBvdXRDb29yZHMsIG1lbW9yeS5yZWFkX2Zsb2F0KG91dEhlYWRpbmcpCiAgICBlbHNlCiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICBlbmQKZW5kCmZ1bmN0aW9uIHRwX2d1bl92YW4oKQogICAgaWYgbm90IEhVRC5ET0VTX0JMSVBfRVhJU1QoSFVELkdFVF9GSVJTVF9CTElQX0lORk9fSUQoODQ0KSkgdGhlbgogICAgICAgIGxvY2FsIGNvb3JkcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgICAgICBsb2NhbCBib29sLCBzcGF3bl9wb2ludCwgaGVhZGluZyA9IGdldF9jbG9zZXN0X3ZlaGljbGVfbm9kZShjb29yZHMsIDEpCiAgICAgICAgaWYgYm9vbCB0aGVuCiAgICAgICAgICAgIGxvY2FsIEFkZHIgPSBtZW1vcnkuc2NyaXB0X2dsb2JhbChHbG9iYWxfQmFzZS5ndW5fdmFuKQogICAgICAgICAgICBpZiBBZGRyIH49IDAgdGhlbgogICAgICAgICAgICAgICAgbWVtb3J5LndyaXRlX3ZlY3RvcjMoQWRkciwgc3Bhd25fcG9pbnQpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCiAgICBjb25kaXRpb25fd2FpdChub3QgSFVELkRPRVNfQkxJUF9FWElTVChIVUQuR0VUX0ZJUlNUX0JMSVBfSU5GT19JRCg4NDQpKSwgMykKICAgIGxvY2FsIHBvcyA9IEhVRC5HRVRfQkxJUF9DT09SRFMoSFVELkdFVF9GSVJTVF9CTElQX0lORk9fSUQoODQ0KSkKICAgIHRlbGVwb3J0KHBvcy54LCBwb3MueSwgcG9zLnosIGZhbHNlKQplbmQKCgotLS0tLee7mOWItuaOp+WItuWPsApsb2NhbCBsb2dfZGlyID0gZmlsZXN5c3RlbS5zdGFuZF9kaXIoKSAuLiAnXFxMb2cudHh0Jwpsb2NhbCBkaXNwX3N0ZG91dCA9ICIiCmxvY2FsIG1heF9jaGFycyA9IDExMApsb2NhbCBtYXhfbGluZXMgPSAyNQpsb2NhbCBmb250X3NpemUgPSAwLjQ1CmZ1bmN0aW9uIGNvbnNvbGVfbWF4X2NoYXJzKHMpCiAgICBtYXhfY2hhcnMgPSBzCmVuZApmdW5jdGlvbiBjb25zb2xlX21heF9saW5lcyhzKQogICAgbWF4X2xpbmVzID0gcwplbmQKZnVuY3Rpb24gY29uc29sZV9mb250X3NpemUocykKICAgIGZvbnRfc2l6ZSA9IHMqMC4wMQplbmQKZnVuY3Rpb24gZ2V0X3N0YW5kX3N0ZG91dCh0YmwsIG4pCiAgICBsb2NhbCBhbGxfbGluZXMgPSB7fQogICAgbG9jYWwgZGlzcF9saW5lcyA9IHt9CiAgICBsb2NhbCBzaXplID0gI3RibAogICAgbG9jYWwgaW5kZXggPSAxCiAgICBpZiBzaXplID49IG4gdGhlbiAKICAgICAgICBpbmRleCA9ICN0YmwgLSBuCiAgICBlbmQKICAgIGZvciBpPWluZGV4LCBzaXplIGRvIAogICAgICAgIGxvY2FsIGxpbmUgPSB0YmxbaV0KICAgICAgICBsb2NhbCBsaW5lX2NvcHkgPSBsaW5lCiAgICAgICAgaWYgbGluZSB+PSAiIiBhbmQgbGluZSB+PSAnXG4nIHRoZW4KICAgICAgICAgICAgYWxsX2xpbmVzWyNhbGxfbGluZXMgKyAxXSA9IGxpbmUKICAgICAgICAgICAgaWYgc3RyaW5nLmxlbihsaW5lKSA+IG1heF9jaGFycyB0aGVuCiAgICAgICAgICAgICAgICBkaXNwX2xpbmVzWyNkaXNwX2xpbmVzICsgMV0gPSBsaW5lOnN1YigxLCBtYXhfY2hhcnMpIC4uICcgLi4uJwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBkaXNwX2xpbmVzWyNkaXNwX2xpbmVzICsgMV0gPSBsaW5lCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCiAgICBkaXNwX3N0ZG91dCA9IHRhYmxlLmNvbmNhdChkaXNwX2xpbmVzLCAnXG4nKQplbmQKZnVuY3Rpb24gZ2V0X2xhc3RfbGluZXMoZmlsZSkKICAgIGxvY2FsIGYgPSBpby5vcGVuKGZpbGUsICJyIikKICAgIGxvY2FsIGxlbiA9IGY6c2VlaygiZW5kIikKICAgIGY6c2Vlaygic2V0IiwgbGVuIC0gbWF4X2xpbmVzKjEwMDApCiAgICBsb2NhbCB0ZXh0ID0gZjpyZWFkKCIqYSIpCiAgICBsb2NhbCBsaW5lcyA9IHN0cmluZy5zcGxpdCh0ZXh0LCAnXG4nKQogICAgZjpjbG9zZSgpCiAgICBnZXRfc3RhbmRfc3Rkb3V0KGxpbmVzLCBtYXhfbGluZXMpCmVuZApmdW5jdGlvbiBEcmF3X2NvbnNvbGUoKQogICAgbG9jYWwgdGV4dCA9IGdldF9sYXN0X2xpbmVzKGxvZ19kaXIpCiAgICBsb2NhbCBzaXplX3gsIHNpemVfeSA9IGRpcmVjdHguZ2V0X3RleHRfc2l6ZShkaXNwX3N0ZG91dCwgZm9udF9zaXplKQogICAgc2l6ZV94ID0gc2l6ZV94ICsgMC4wMQogICAgc2l6ZV95ID0gc2l6ZV95ICsgMC4wMQogICAgZGlyZWN0eC5kcmF3X3JlY3QoMC4wLCAwLjA1LCBzaXplX3gsIHNpemVfeSwge3IgPSAwLCBnID0gMCwgYiA9IDAsIGEgPSAwLjV9KQogICAgZGlyZWN0eC5kcmF3X3RleHQoMC4wLCAwLjA1LCBkaXNwX3N0ZG91dCwgMCwgZm9udF9zaXplLCB7ciA9IDAuMjgsIGcgPSAxLCBiID0gMSwgYSA9IDF9LCB0cnVlKQplbmQKCgoKCi0tLS0tLS0t5ri45oiP5rC05Y2wCmxvY2FsIGljb24gPSBkaXJlY3R4LmNyZWF0ZV90ZXh0dXJlKGZpbGVzeXN0ZW0ucmVzb3VyY2VzX2RpcigpIC4uICdTYWt1cmFTY3JpcHRcXHdhdGVybWFya1xcaWNvbi5qcGcnKQpmdW5jdGlvbiB3YXRlcm1hcmtfeCh4XykKICAgIHdhdGVybWFya19wb3MueCA9IHhfIC8gMTAwMDAKZW5kCmZ1bmN0aW9uIHdhdGVybWFya195KHlfKQogICAgd2F0ZXJtYXJrX3Bvcy55ID0geV8gLyAxMDAwMAplbmQKZnVuY3Rpb24gd2F0ZXJtYXJrX2JneCh4XykKICAgIHdhdGVybWFya19zZXR0aW5ncy5hZGRfeCA9IHhfIC8gMTAwMDAKZW5kCmZ1bmN0aW9uIHdhdGVybWFya19iZ3koeV8pCiAgICB3YXRlcm1hcmtfc2V0dGluZ3MuYWRkX3kgPSB5XyAvIDEwMDAwCmVuZApmdW5jdGlvbiB3YXRlcm1hcmtfYmdjKGNvbCkKICAgIHdhdGVybWFya19zZXR0aW5ncy5iZ19jb2xvciA9IGNvbAplbmQKZnVuY3Rpb24gd2F0ZXJtYXJrX3R4dGMoY29sKQogICAgd2F0ZXJtYXJrX3NldHRpbmdzLnR4X2NvbG9yID0gY29sCmVuZApmdW5jdGlvbiB3YXRlcm1hcmtfbGFibGUodmFsKQogICAgd2F0ZXJtYXJrX3NldHRpbmdzLnNob3dfZmlyc3RsID0gdmFsCmVuZApmdW5jdGlvbiB3YXRlcm1hcmtfbmFtZSh2YWwpCiAgICB3YXRlcm1hcmtfc2V0dGluZ3Muc2hvd19uYW1lID0gdmFsCmVuZApmdW5jdGlvbiB3YXRlcm1hcmtfcGxheWVycyh2YWwpCiAgICB3YXRlcm1hcmtfc2V0dGluZ3Muc2hvd19wbGF5ZXJzID0gdmFsCmVuZApmdW5jdGlvbiB3YXRlcm1hcmtfdGltZSh2YWwpCiAgICB3YXRlcm1hcmtfc2V0dGluZ3Muc2hvd19kYXRlID0gdmFsCmVuZApmdW5jdGlvbiB3YXRlcm1hcmtfdG9nZ2xlKCkKICAgIGxvY2FsIHdtX3RleHQgPSAoCiAgICAgICAgd2F0ZXJtYXJrX3NldHRpbmdzLnNob3dfZmlyc3RsID09IDIgYW5kICdTYWt1cmEnIAogICAgICAgIG9yIHdhdGVybWFya19zZXR0aW5ncy5zaG93X2ZpcnN0bCA9PSA1IGFuZCAnXl8tJyAKICAgICAgICBvciB3YXRlcm1hcmtfc2V0dGluZ3Muc2hvd19maXJzdGwgPT0gNiBhbmQgJ093TycgCiAgICAgICAgb3Igd2F0ZXJtYXJrX3NldHRpbmdzLnNob3dfZmlyc3RsID09IDQgYW5kICdTdGFuZCcgCiAgICAgICAgb3Igd2F0ZXJtYXJrX3NldHRpbmdzLnNob3dfZmlyc3RsID09IDMgYW5kIHN0YW5kX3ZlcnNpb24uZWRpdGlvbnNbc3RhbmRfdmVyc2lvbi5lZGl0aW9uKzFdIAogICAgICAgIG9yICcnKSAuLiAod2F0ZXJtYXJrX3NldHRpbmdzLnNob3dfbmFtZSBhbmQgJyB8ICcuLiBwbGF5ZXJzLmdldF9uYW1lKFBMQVlFUi5QTEFZRVJfSUQoKSkgCiAgICAgICAgb3IgJycpIC4uICh3YXRlcm1hcmtfc2V0dGluZ3Muc2hvd19wbGF5ZXJzIGFuZCBORVRXT1JLLk5FVFdPUktfSVNfU0VTU0lPTl9TVEFSVEVEKCkgYW5kICcgfCBQbGF5ZXJzOiAnLi4jcGxheWVycy5saXN0KHRydWUsIHRydWUsIHRydWUpIAogICAgICAgIG9yICcnKSAuLiAod2F0ZXJtYXJrX3NldHRpbmdzLnNob3dfZGF0ZSBhbmQgb3MuZGF0ZSgnIHwgJUg6JU06JVMgJykgCiAgICAgICAgb3IgJycpCgogICAgbG9jYWwgdHhfc2l6ZSA9IGRpcmVjdHguZ2V0X3RleHRfc2l6ZSh3bV90ZXh0LCAwLjUyKQoKICAgIGRpcmVjdHguZHJhd19yZWN0KAogICAgICAgIHdhdGVybWFya19wb3MueCArIHdhdGVybWFya19zZXR0aW5ncy5hZGRfeCAqIDAuNSwgCiAgICAgICAgd2F0ZXJtYXJrX3Bvcy55LCAKICAgICAgICAtKHR4X3NpemUgKyAwLjAxMDUgKyB3YXRlcm1hcmtfc2V0dGluZ3MuYWRkX3gpLCAgLS0gYWRkIHdhdGVybWFyayBzaXplCiAgICAgICAgMC4wMjUgKyB3YXRlcm1hcmtfc2V0dGluZ3MuYWRkX3ksIAogICAgICAgIHdhdGVybWFya19zZXR0aW5ncy5iZ19jb2xvcgogICAgKQogICAgZGlyZWN0eC5kcmF3X3RleHR1cmUoaWNvbiwgCiAgICAgICAgMC4wMDU1LCAKICAgICAgICAwLjAwNTUsIAogICAgICAgIDAuNSwgCiAgICAgICAgMC41LCAKICAgICAgICB3YXRlcm1hcmtfcG9zLnggLSB0eF9zaXplIC0gMC4wMDU1LCAKICAgICAgICB3YXRlcm1hcmtfcG9zLnkgKyAwLjAxMywgCiAgICAgICAgMCwgCiAgICAgICAge1siciJdID0gMS4wLFsiZyJdID0gMS4wLFsiYiJdID0gMS4wLFsiYSJdID0gMS4wfQogICAgKQogICAgZGlyZWN0eC5kcmF3X3RleHQoCiAgICAgICAgd2F0ZXJtYXJrX3Bvcy54LCAKICAgICAgICB3YXRlcm1hcmtfcG9zLnkgKyAwLjAwNCwgCiAgICAgICAgd21fdGV4dCwgCiAgICAgICAgQUxJR05fVE9QX1JJR0hULCAKICAgICAgICAwLjUsIAogICAgICAgIHdhdGVybWFya19zZXR0aW5ncy50eF9jb2xvciwgCiAgICAgICAgZmFsc2UKICAgICkKZW5kCgoKCgoKLS0tLS0t6IOh5qGDCmZ1bmN0aW9uIFNFVF9PVVRGSVRfVkFMVUUoVmFsdWVOYW1lLCBWYWx1ZSwgdmFyaWF0aW9uKQogICAgbG9jYWwgY29tbWFuZE5hbWUgPSBWYWx1ZU5hbWUKICAgIGlmIHZhcmlhdGlvbiA9PSB0cnVlIHRoZW4KICAgICAgICBjb21tYW5kTmFtZSA9IGNvbW1hbmROYW1lLi4idmFyIgogICAgZW5kCiAgICBtZW51LnRyaWdnZXJfY29tbWFuZHMoY29tbWFuZE5hbWUuLiIgIi4uVmFsdWUpCmVuZApmdW5jdGlvbiBiZWNvbWVfd2FsbnV0cygpCiAgICBtZW51LnRyaWdnZXJfY29tbWFuZHMoIm1wbWFsZSIpCiAgICBTRVRfT1VURklUX1ZBTFVFKCJoZWFkIiwgMzIpCiAgICBTRVRfT1VURklUX1ZBTFVFKCJoZWFkIiwgMCwgdHJ1ZSkKICAgIFNFVF9PVVRGSVRfVkFMVUUoIm1hc2siLCAyMTUpCiAgICBTRVRfT1VURklUX1ZBTFVFKCJtYXNrIiwgMCwgdHJ1ZSkKICAgIFNFVF9PVVRGSVRfVkFMVUUoImhhaXIiLCAwKQogICAgU0VUX09VVEZJVF9WQUxVRSgiaGFpciIsIDU4LCB0cnVlKQogICAgU0VUX09VVEZJVF9WQUxVRSgidG9wIiwgNDQ2KQogICAgU0VUX09VVEZJVF9WQUxVRSgidG9wIiwgMCwgdHJ1ZSkKICAgIFNFVF9PVVRGSVRfVkFMVUUoImdsb3ZlcyIsIDApCiAgICBTRVRfT1VURklUX1ZBTFVFKCJnbG92ZXMiLCAwLCB0cnVlKQogICAgU0VUX09VVEZJVF9WQUxVRSgidG9wMiIsIC0xKQogICAgU0VUX09VVEZJVF9WQUxVRSgidG9wMiIsIDAsIHRydWUpCiAgICBTRVRfT1VURklUX1ZBTFVFKCJ0b3AzIiwgLTEpCiAgICBTRVRfT1VURklUX1ZBTFVFKCJ0b3AzIiwgMCwgdHJ1ZSkKICAgIFNFVF9PVVRGSVRfVkFMVUUoInBhcmFjaHV0ZSIsIDApCiAgICBTRVRfT1VURklUX1ZBTFVFKCJwYXJhY2h1dGUiLCAwLCB0cnVlKQogICAgU0VUX09VVEZJVF9WQUxVRSgicGFudHMiLCAxNjApCiAgICBTRVRfT1VURklUX1ZBTFVFKCJwYW50cyIsIDAsIHRydWUpCiAgICBTRVRfT1VURklUX1ZBTFVFKCJzaG9lcyIsIDExOSkKICAgIG1lbnUudHJpZ2dlcl9jb21tYW5kcygiZmVldHZhciAwIikKICAgIFNFVF9PVVRGSVRfVkFMVUUoImFjY2Vzc29yaWVzIiwgLTEpCiAgICBTRVRfT1VURklUX1ZBTFVFKCJhY2Nlc3NvcmllcyIsIDAsIHRydWUpCiAgICBTRVRfT1VURklUX1ZBTFVFKCJkZWNhbHMiLCAtMSkKICAgIFNFVF9PVVRGSVRfVkFMVUUoImRlY2FscyIsIDAsIHRydWUpCiAgICBTRVRfT1VURklUX1ZBTFVFKCJoYXQiLCAxOTMpCiAgICBTRVRfT1VURklUX1ZBTFVFKCJoYXQiLCAwLCB0cnVlKQogICAgU0VUX09VVEZJVF9WQUxVRSgiZ2xhc3NlcyIsIC0xKQogICAgU0VUX09VVEZJVF9WQUxVRSgiZ2xhc3NlcyIsIC0xLCB0cnVlKQogICAgU0VUX09VVEZJVF9WQUxVRSgiZWFycyIsIC0xKQogICAgU0VUX09VVEZJVF9WQUxVRSgiZWFycyIsIC0xLCB0cnVlKQogICAgU0VUX09VVEZJVF9WQUxVRSgid2F0Y2giLCAtMSkKICAgIFNFVF9PVVRGSVRfVkFMVUUoIndhdGNoIiwgLTEsIHRydWUpCiAgICBTRVRfT1VURklUX1ZBTFVFKCJicmFjZWxldCIsIC0xKQogICAgU0VUX09VVEZJVF9WQUxVRSgiYnJhY2VsZXQiLCAtMSwgdHJ1ZSkKZW5kCgoKCgoKLS0tLS0tLeawtOS4iuepuuS4rempvumptgpmdW5jdGlvbiBvbl91c2VyX2NoYW5nZV92ZWhpY2xlKHZlaGljbGUpCiAgICBpZiB2ZWhpY2xlIH49IDAgdGhlbgogICAgZW5kCmVuZApsb2NhbCBsYXN0X2NhciA9IDAKZnVuY3Rpb24gYWxsX2RyaXZlX3N0eWxlKCkKICAgIGxvY2FsIHBsYXllcl9jdXJfY2FyID0gZW50aXRpZXMuZ2V0X3VzZXJfdmVoaWNsZV9hc19oYW5kbGUoKQogICAgaWYgbGFzdF9jYXIgfj0gcGxheWVyX2N1cl9jYXIgYW5kIHBsYXllcl9jdXJfY2FyIH49IDAgdGhlbiAKICAgICAgICBvbl91c2VyX2NoYW5nZV92ZWhpY2xlKHBsYXllcl9jdXJfY2FyKQogICAgICAgIGxhc3RfY2FyID0gcGxheWVyX2N1cl9jYXIKICAgIGVuZAogICAgaWYgcmVuZGVyc2NvcmNoZWQgdGhlbgogICAgICAgIGlmIHBsYXllcl9jdXJfY2FyIH49IDAgdGhlbgogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9SRU5ERVJfU0NPUkNIRUQocGxheWVyX2N1cl9jYXIsIHRydWUpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBpZiB3YWxrb253YXRlciBvciBkcml2ZW9ud2F0ZXIgb3IgZHJpdmVvbmFpciB0aGVuCiAgICAgICAgaWYgZG93X2Jsb2NrID09IDAgb3Igbm90IEVOVElUWS5ET0VTX0VOVElUWV9FWElTVChkb3dfYmxvY2spIHRoZW4KICAgICAgICAgICAgbG9jYWwgaGFzaCA9IHV0aWwuam9hYXQoInN0dF9wcm9wX3N0dW50X2JibG9ja19tZG0zIikKICAgICAgICAgICAgcmVxdWVzdF9tb2RlbChoYXNoKQogICAgICAgICAgICBsb2NhbCBjID0ge3ggPSAwLCB5ID0gMCwgeiA9IDB9CiAgICAgICAgICAgIGRvd19ibG9jayA9IE9CSkVDVC5DUkVBVEVfT0JKRUNUX05PX09GRlNFVChoYXNoLCBjWyd4J10sIGNbJ3knXSwgY1sneiddLCB0cnVlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0FMUEhBKGRvd19ibG9jaywgMCkKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfVklTSUJMRShkb3dfYmxvY2ssIGZhbHNlLCAwKQogICAgICAgIGVuZAogICAgZW5kCiAgICBpZiBkb3dfYmxvY2sgfj0gMCBhbmQgbm90IHdhbGtvbndhdGVyIGFuZCBub3QgZHJpdmVvbndhdGVyIGFuZCBub3QgZHJpdmVvbmFpciB0aGVuCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTX05PX09GRlNFVChkb3dfYmxvY2ssIDAsIDAsIDAsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCiAgICBlbmQKICAgIGlmIHdhbGtvbndhdGVyIHRoZW4KICAgICAgICB2ZWhpY2xlID0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19JTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgICAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMC4wLCAyLjAsIDAuMCkKICAgICAgICAtLSB3ZSBuZWVkIHRvIG9mZnNldCB0aGlzIGJlY2F1c2Ugb3RoZXJ3aXNlIHRoZSBwbGF5ZXIga2VlcHMgZGl2aW5nIG9mZiB0aGUgdGhpbmcsIGxpa2UgYSBmdWNraW5nIGR1bWJhc3MKICAgICAgICAtLSBodCBpc250IGFjdHVhbGx5IHVzZWQgaGVyZSwgYnV0IGltIGFsbG9jYXRpbmcgc29tZSBtZW1vcnkgYW55d2F5cyB0byBwcmV2ZW50IGEgcG9zc2libGUgY3Jhc2gsIHByb2JhYmx5LiBpZGsgaW0gbm8gY29tcHV0ZXIgZW5naW5lZXIKICAgICAgICBsb2NhbCBodCA9IG1lbW9yeS5hbGxvYyg0KQogICAgICAgIC0tIHRoaXMgaXMgYmV0dGVyIHRoYW4gRU5USVRZLklTX0VOVElUWV9JTl9XQVRFUiBiZWNhdXNlIGl0IGNhbiBkZXRlY3QgaWYgYSBwbGF5ZXIgaXMgYWN0dWFsbHkgYWJvdmUgd2F0ZXIgd2l0aG91dCB0aGVtIGV2ZW4gYmVpbmcgImluIiBpdAogICAgICAgIGlmIFdBVEVSLkdFVF9XQVRFUl9IRUlHSFQocG9zWyd4J10sIHBvc1sneSddLCBwb3NbJ3onXSwgaHQpIHRoZW4KICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTX05PX09GRlNFVChkb3dfYmxvY2ssIHBvc1sneCddLCBwb3NbJ3knXSwgbWVtb3J5LnJlYWRfZmxvYXQoaHQpLCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9IRUFESU5HKGRvd19ibG9jaywgRU5USVRZLkdFVF9FTlRJVFlfSEVBRElORyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSkKICAgICAgICBlbmQKICAgIGVuZAogICAgaWYgZHJpdmVvbndhdGVyIHRoZW4KICAgICAgICBpZiBwbGF5ZXJfY3VyX2NhciB+PSAwIHRoZW4KICAgICAgICAgICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHBsYXllcl9jdXJfY2FyLCB0cnVlKQogICAgICAgICAgICAtLSBodCBpc250IGFjdHVhbGx5IHVzZWQgaGVyZSwgYnV0IGltIGFsbG9jYXRpbmcgc29tZSBtZW1vcnkgYW55d2F5cyB0byBwcmV2ZW50IGEgcG9zc2libGUgY3Jhc2gsIHByb2JhYmx5LiBpZGsgaW0gbm8gY29tcHV0ZXIgZW5naW5lZXIKICAgICAgICAgICAgbG9jYWwgaHQgPSBtZW1vcnkuYWxsb2MoNCkKICAgICAgICAgICAgLS0gdGhpcyBpcyBiZXR0ZXIgdGhhbiBFTlRJVFkuSVNfRU5USVRZX0lOX1dBVEVSIGJlY2F1c2UgaXQgY2FuIGRldGVjdCBpZiBhIHBsYXllciBpcyBhY3R1YWxseSBhYm92ZSB3YXRlciB3aXRob3V0IHRoZW0gZXZlbiBiZWluZyAiaW4iIGl0CiAgICAgICAgICAgIGlmIFdBVEVSLkdFVF9XQVRFUl9IRUlHSFQocG9zWyd4J10sIHBvc1sneSddLCBwb3NbJ3onXSwgaHQpIHRoZW4KICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQoZG93X2Jsb2NrLCBwb3NbJ3gnXSwgcG9zWyd5J10sIG1lbW9yeS5yZWFkX2Zsb2F0KGh0KSwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0hFQURJTkcoZG93X2Jsb2NrLCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKHBsYXllcl9jdXJfY2FyKSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZWxzZQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFNfTk9fT0ZGU0VUKGRvd19ibG9jaywgMCwgMCwgMCwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgICAgICBlbmQKICAgIGVuZAogICAgaWYgZHJpdmVvbmFpciB0aGVuCiAgICAgICAgaWYgcGxheWVyX2N1cl9jYXIgfj0gMCB0aGVuCiAgICAgICAgICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhwbGF5ZXJfY3VyX2NhciwgdHJ1ZSkKICAgICAgICAgICAgbG9jYWwgYm94X3BvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhkb3dfYmxvY2ssIHRydWUpCiAgICAgICAgICAgIGlmIEdldF9kaXN0YW5jZShwb3MsIGJveF9wb3MsIHRydWUpID49IDUgdGhlbgogICAgICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTX05PX09GRlNFVChkb3dfYmxvY2ssIHBvc1sneCddLCBwb3NbJ3knXSwgZG9hX2h0LCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSEVBRElORyhkb3dfYmxvY2ssIEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcoY2FyX2hkbCkpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsIDIyKSB0aGVuCiAgICAgICAgICAgICAgICBkb2FfaHQgPSBkb2FfaHQgKyAwLjEKICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQoZG93X2Jsb2NrLCBwb3NbJ3gnXSwgcG9zWyd5J10sIGRvYV9odCwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEUyhwbGF5ZXJfY3VyX2NhciwgcG9zWyd4J10sIHBvc1sneSddLCBkb2FfaHQgKyAxLCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSEVBRElORyhkb3dfYmxvY2ssIEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcoY2FyX2hkbCkgKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgaWYgUEFELklTX0NPTlRST0xfUFJFU1NFRCgwLCAzNikgdGhlbgogICAgICAgICAgICAgICAgZG9hX2h0ID0gZG9hX2h0IC0gMC4xCiAgICAgICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFNfTk9fT0ZGU0VUKGRvd19ibG9jaywgcG9zWyd4J10sIHBvc1sneSddLCBkb2FfaHQsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFMocGxheWVyX2N1cl9jYXIsIHBvc1sneCddLCBwb3NbJ3knXSwgZG9hX2h0ICsgMSwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0hFQURJTkcoZG93X2Jsb2NrLCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKGNhcl9oZGwpKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCAgCmVuZAoKCi0tLS0tLS3lhYjov5vov73ouKrlr7zlvLkKZnVuY3Rpb24gbWVtb3J5U2NhbihuYW1lLCBwYXR0ZXJuLCBjYWxsYmFjaykKCWxvY2FsIGFkZHJlc3MgPSBtZW1vcnkuc2NhbihwYXR0ZXJuKQoJYXNzZXJ0KGFkZHJlc3Mgfj0gTlVMTCwgIuWGheWtmOaJq+aPj+Wksei0pe+8miAiIC4uIG5hbWUpCgljYWxsYmFjayhhZGRyZXNzKQplbmQKbWVtb3J5U2NhbigiR2V0TmV0R2FtZVBsYXllciIsICI0OCA4MyBFQyA/IDMzIEMwIDM4IDA1ID8gPyA/ID8gNzQgPyA4MyBGOSIsIGZ1bmN0aW9uIChhZGRyZXNzKQoJR2V0TmV0R2FtZVBsYXllcl9hZGRyID0gYWRkcmVzcwplbmQpCmZ1bmN0aW9uIEdldE5ldEdhbWVQbGF5ZXIocGxheWVyKQoJcmV0dXJuIHV0aWwuY2FsbF9mb3JlaWduX2Z1bmN0aW9uKEdldE5ldEdhbWVQbGF5ZXJfYWRkciwgcGxheWVyKQplbmQKCgotLS0tLS0tLei9veWFt+atpuWZqApmdW5jdGlvbiBnZXRfdmVoaWNsZV9jYW1fcmVsYXRpdmVfaGVhZGluZyh2ZWhpY2xlKQoJbG9jYWwgY2FtRGlyID0gQ0FNLkdFVF9HQU1FUExBWV9DQU1fUk9UKDApOnRvRGlyKCkKCWxvY2FsIGZ3ZFZlY3RvciA9IEVOVElUWS5HRVRfRU5USVRZX0ZPUldBUkRfVkVDVE9SKHZlaGljbGUpCgljYW1EaXIueiwgZndkVmVjdG9yLnogPSAwLjAsIDAuMAoJbG9jYWwgYW5nbGUgPSBtYXRoLmFjb3MoZndkVmVjdG9yOmRvdChjYW1EaXIpIC8gKCNjYW1EaXIgKiAjZndkVmVjdG9yKSkKCXJldHVybiBtYXRoLmRlZyhhbmdsZSkKZW5kCmZ1bmN0aW9uIHNob290X2Zyb21fdmVoaWNsZSh2ZWhpY2xlLCBkYW1hZ2UsIHdlYXBvbkhhc2gsIG93bmVyUGVkLCBpc0F1ZGlibGUsIGlzVmlzaWJsZSwgc3BlZWQsIHRhcmdldCwgcG9zaXRpb24pCglsb2NhbCBtaW4sIG1heCA9IHYzLm5ldygpLCB2My5uZXcoKQoJbG9jYWwgb2Zmc2V0CglNSVNDLkdFVF9NT0RFTF9ESU1FTlNJT05TKEVOVElUWS5HRVRfRU5USVRZX01PREVMKHZlaGljbGUpLCBtaW4sIG1heCkKCWlmIHBvc2l0aW9uID09IDAgdGhlbgoJCW9mZnNldCA9IHYzLm5ldyhtaW4ueCwgbWF4LnkgKyAwLjI1LCAwLjMpCgllbHNlaWYgcG9zaXRpb24gPT0gMSB0aGVuCgkJb2Zmc2V0ID0gdjMubmV3KG1pbi54LCBtaW4ueSwgMC4zKQoJZWxzZWlmIHBvc2l0aW9uID09IDIgdGhlbgoJCW9mZnNldCA9IHYzLm5ldyhtYXgueCwgbWF4LnkgKyAwLjI1LCAwLjMpCgllbHNlaWYgcG9zaXRpb24gPT0gMyB0aGVuCgkJb2Zmc2V0ID0gdjMubmV3KG1heC54LCBtaW4ueSwgMC4zKQoJZWxzZQoJCWVycm9yKCLlvpfliLDkuobmhI/mg7PkuI3liLDnmoTkvY3nva4iKQoJZW5kCglsb2NhbCBhID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKHZlaGljbGUsIG9mZnNldC54LCBvZmZzZXQueSwgb2Zmc2V0LnopCglsb2NhbCBkaXJlY3Rpb24gPSBFTlRJVFkuR0VUX0VOVElUWV9ST1RBVElPTih2ZWhpY2xlLCAyKTp0b0RpcigpCglpZiBnZXRfdmVoaWNsZV9jYW1fcmVsYXRpdmVfaGVhZGluZyh2ZWhpY2xlKSA+IDk1LjAgdGhlbgoJCWRpcmVjdGlvbjptdWwoLTEpCgllbmQKCWxvY2FsIGIgPSB2My5uZXcoZGlyZWN0aW9uKQoJYjptdWwoMzAwLjApOyBiOmFkZChhKQoKCU1JU0MuU0hPT1RfU0lOR0xFX0JVTExFVF9CRVRXRUVOX0NPT1JEU19JR05PUkVfRU5USVRZX05FVyhhLngsIGEueSwgYS56LGIueCwgYi55LCBiLnosZGFtYWdlLHRydWUsd2VhcG9uSGFzaCxvd25lclBlZCxpc0F1ZGlibGUsbm90IGlzVmlzaWJsZSxzcGVlZCx2ZWhpY2xlLGZhbHNlLCBmYWxzZSwgdGFyZ2V0LCBmYWxzZSwgMCwgMCwgMCkKZW5kCmZ1bmN0aW9uIHZlaGxhc2VyKCkKICAgIGlmIFBFRC5JU19QRURfSU5fQU5ZX1ZFSElDTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpIHRoZW4KCQlsb2NhbCB2ZWhpY2xlID0gZ2V0X3ZlaGljbGVfcGxheWVyX2lzX2luKFBMQVlFUi5QTEFZRVJfSUQoKSkKCQlsb2NhbCBtaW4sIG1heCA9IHYzLm5ldygpLCB2My5uZXcoKQoJCU1JU0MuR0VUX01PREVMX0RJTUVOU0lPTlMoRU5USVRZLkdFVF9FTlRJVFlfTU9ERUwodmVoaWNsZSksIG1pbiwgbWF4KQoJCWxvY2FsIHN0YXJ0TGVmdCA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyh2ZWhpY2xlLCAgbWluLngsIG1heC55LCAwLjApCgkJbG9jYWwgZW5kTGVmdCA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyh2ZWhpY2xlLCBtaW4ueCwgbWF4LnkgKyAyNS4wLCAwLjApCgkJR1JBUEhJQ1MuRFJBV19MSU5FKHN0YXJ0TGVmdC54LCBzdGFydExlZnQueSwgc3RhcnRMZWZ0LnosIGVuZExlZnQueCwgZW5kTGVmdC55LCBlbmRMZWZ0LnosIDI1NSwgMCwgMCwgMTUwKQoKCQlsb2NhbCBzdGFydFJpZ2h0ID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKHZlaGljbGUsIG1heC54LCBtYXgueSwgMC4wKQoJCWxvY2FsIGVuZFJpZ2h0ID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKHZlaGljbGUsIG1heC54LCBtYXgueSArIDI1LjAsIDApCgkJR1JBUEhJQ1MuRFJBV19MSU5FKHN0YXJ0UmlnaHQueCwgc3RhcnRSaWdodC55LCBzdGFydFJpZ2h0LnosIGVuZFJpZ2h0LngsIGVuZFJpZ2h0LnksIGVuZFJpZ2h0LnosIDI1NSwgMCwgMCwgMTUwKQoJZW5kCmVuZApWZWhpY2xlV2VhcG9uID0ge21vZGVsTmFtZSA9ICIiLCB0aW1lQmV0d2VlblNob3RzID0gMH0KVmVoaWNsZVdlYXBvbi5fX2luZGV4ID0gVmVoaWNsZVdlYXBvbgpmdW5jdGlvbiBWZWhpY2xlV2VhcG9uLm5ldyhtb2RlbE5hbWUsIHRpbWVCZXR3ZWVuU2hvdHMpCglsb2NhbCBpbnN0YW5jZSA9IHNldG1ldGF0YWJsZSh7fSwgVmVoaWNsZVdlYXBvbikKCWluc3RhbmNlLm1vZGVsTmFtZSA9IG1vZGVsTmFtZQoJaW5zdGFuY2UudGltZUJldHdlZW5TaG90cyA9IHRpbWVCZXR3ZWVuU2hvdHMKCXJldHVybiBpbnN0YW5jZQplbmQKdmVoaWNsZVdlYXBvbkxpc3QgPSB7CglWZWhpY2xlV2VhcG9uLm5ldygid2VhcG9uX3ZlaGljbGVfcm9ja2V0IiwgMjIwKSwKCVZlaGljbGVXZWFwb24ubmV3KCJ3ZWFwb25fcmF5cGlzdG9sIiwgNTApLAoJVmVoaWNsZVdlYXBvbi5uZXcoIndlYXBvbl9maXJld29yayIsIDIyMCksCglWZWhpY2xlV2VhcG9uLm5ldygidmVoaWNsZV93ZWFwb25fdGFuayIsIDIyMCksCglWZWhpY2xlV2VhcG9uLm5ldygidmVoaWNsZV93ZWFwb25fcGxheWVyX2xhemVyIiwgMzApCn0KSW1wdXRzX3ZlaHdlYXBvbiA9IHsKCUlOUFVUX0pVTVAgPSB7IlNwYWNlYmFyOyBYIiwgMjJ9LAoJSU5QVVRfVkVIX0FUVEFDSyA9IHsiTW91c2UgTDsgUkIiLCA2OX0sCglJTlBVVF9WRUhfQUlNID0geyJNb3VzZSBSOyBMQiIsIDY4fSwKCUlOUFVUX1ZFSF9EVUNLID0geyJYOyBBIiwgNzN9LAoJSU5QVVRfVkVIX0hPUk4gPSB7IkU7IEwzIiwgODZ9LAoJSU5QVVRfVkVIX0NJTkVNQVRJQ19VUF9PTkxZID0geyJOdW1wYWQgKzsgbm9uZSIsIDk2fSwKCUlOUFVUX1ZFSF9DSU5FTUFUSUNfRE9XTl9PTkxZID0geyJOdW1wYWQgLTsgbm9uZSIsIDk3fQp9CnRyYW5zX3BsYW5lID0gewoJQWlyc3RyaWtlQWlyY3JhZnQgPSAi5oyJIH4lc34g5Lul5L2/55So56m66KKt6aOe5py6IiwKCUtleWJvYXJkID0gIumUruebmCIsCglDb250cm9sbGVyID0gIuaJi+afhCIsCglWZWhpY2xlV2VhcG9ucyA9ICLmjIkgfiVzfiDkvb/nlKjovb3lhbfmrablmagiCn0KCmxvY2FsIFZ3X3N0YXRlID0gMApsb2NhbCBWd19zZWxlY3RlZE9wdCA9IDEKbG9jYWwgbXNnID0gIuaMiSB+JXN+IOS9v+eUqOi9veWFt+atpuWZqCIKZnVuY3Rpb24gdmVod2VhcG9uX3ZlaCgpCiAgICBsb2NhbCBjb250cm9sID0gZnVuQ29uZmlnLmNvbnRyb2xzLnZlaGljbGV3ZWFwb25zCglpZiBWd19zdGF0ZSA9PSAwIG9yIHRpbWVyLmVsYXBzZWQoKSA+IDEyMDAwMCB0aGVuCgkJbG9jYWwgY29udHJvbE5hbWUgPSB0YWJsZS5maW5kX2lmKEltcHV0c192ZWh3ZWFwb24sIGZ1bmN0aW9uKGssIHRibCkKCQkJcmV0dXJuIHRibFsyXSA9PSBjb250cm9sCgkJZW5kKQoJCWFzc2VydChjb250cm9sTmFtZSwgIuacquaJvuWIsOaOp+S7tuWQjeensCIpCgkJdXRpbC5zaG93X2Nvcm5lcl9oZWxwKG1zZzpmb3JtYXQoY29udHJvbE5hbWUpKQoJCVZ3X3N0YXRlID0gMQoJCXRpbWVyLnJlc2V0KCkKCWVuZAoJbG9jYWwgc2VsZWN0ZWRXZWFwb24gPSB2ZWhpY2xlV2VhcG9uTGlzdFtWd19zZWxlY3RlZE9wdF0KCWxvY2FsIHZlaGljbGUgPSBnZXRfdmVoaWNsZV9wbGF5ZXJfaXNfaW4oUExBWUVSLlBMQVlFUl9JRCgpKQoJbG9jYWwgd2VhcG9uSGFzaCA9IHV0aWwuam9hYXQoc2VsZWN0ZWRXZWFwb24ubW9kZWxOYW1lKQoJcmVxdWVzdF93ZWFwb25fYXNzZXQod2VhcG9uSGFzaCkKCWlmIG5vdCBFTlRJVFkuRE9FU19FTlRJVFlfRVhJU1QodmVoaWNsZSkgb3Igbm90IFBBRC5JU19DT05UUk9MX1BSRVNTRUQoMCwgY29udHJvbCkgb3IKCXRpbWVyLmVsYXBzZWQoKSA8IHNlbGVjdGVkV2VhcG9uLnRpbWVCZXR3ZWVuU2hvdHMgdGhlbgoJCXJldHVybgoJZWxzZWlmIGdldF92ZWhpY2xlX2NhbV9yZWxhdGl2ZV9oZWFkaW5nKHZlaGljbGUpIDwgOTUuMCB0aGVuCgkJc2hvb3RfZnJvbV92ZWhpY2xlKHZlaGljbGUsIDIwMCwgd2VhcG9uSGFzaCwgUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSwgdHJ1ZSwgMjAwMC4wLCAwLCAwKQoJCXNob290X2Zyb21fdmVoaWNsZSh2ZWhpY2xlLCAyMDAsIHdlYXBvbkhhc2gsIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUsIHRydWUsIDIwMDAuMCwgMCwgMikKCQl0aW1lci5yZXNldCgpCgllbHNlCgkJc2hvb3RfZnJvbV92ZWhpY2xlKHZlaGljbGUsIDIwMCwgd2VhcG9uSGFzaCwgUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSwgdHJ1ZSwgMjAwMC4wLCAwLCAxKQoJCXNob290X2Zyb21fdmVoaWNsZSh2ZWhpY2xlLCAyMDAsIHdlYXBvbkhhc2gsIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUsIHRydWUsIDIwMDAuMCwgMCwgMykKCQl0aW1lci5yZXNldCgpCgllbmQKZW5kCmZ1bmN0aW9uIHNldHZlaHdlYXBvbihpbmRleCwgbWVudV9uYW1lLCBwcmV2X3ZhbHVlLCBjbGlja190eXBlKQogICAgVndfc2VsZWN0ZWRPcHQgPSBpbmRleCAKZW5kCgoKCgotLS0t6a2U5bm75r+A5YWJ5oiY6amsCmxvY2FsIExzZGNhcgpsb2NhbCBsc2RoID0geyd3ZWFwb25fcmF5Y2FyYmluZScsJ3dlYXBvbl9yYXlwaXN0b2wnfQpsb2NhbCBMc2RjYXJfaGFzaCA9ICd3ZWFwb25fcmF5Y2FyYmluZScKZnVuY3Rpb24gTWFnaWNfV2FyaG9yc2VfVyh2d2VhcCkKICAgIExzZGNhcl9oYXNoID0gbHNkaFt2d2VhcF0KZW5kCmZ1bmN0aW9uIHNob290X2Zyb21fdmVoaWNsZV9MYXplcl9TcGFjZV9DYXIodmVoaWNsZSwgZGFtYWdlLCB3ZWFwb25IYXNoLCBvd25lclBlZCwgaXNBdWRpYmxlLCBpc1Zpc2libGUsIHNwZWVkLCB0YXJnZXQsIHBvc2l0aW9uKQogICAgbG9jYWwgbWluLCBtYXggPSB2My5uZXcoKSwgdjMubmV3KCkKICAgIGxvY2FsIG9mZnNldAogICAgTUlTQy5HRVRfTU9ERUxfRElNRU5TSU9OUyhFTlRJVFkuR0VUX0VOVElUWV9NT0RFTCh2ZWhpY2xlKSwgbWluLCBtYXgpCiAgICBpZiBwb3NpdGlvbiA9PSAwIHRoZW4KICAgICAgICBvZmZzZXQgPSB2My5uZXcobWluLnggKyAwLjMsIG1heC55ICsgMC4yNSwgMC41KQogICAgZWxzZWlmIHBvc2l0aW9uID09IDEgdGhlbgogICAgICAgIG9mZnNldCA9IHYzLm5ldyhtaW4ueCArIDAuMywgbWluLnkgKyA0LCAwLjUpCiAgICBlbHNlaWYgcG9zaXRpb24gPT0gMiB0aGVuCiAgICAgICAgb2Zmc2V0ID0gdjMubmV3KG1heC54IC0gMC4zLCBtYXgueSArIDAuMjUsIDAuNSkKICAgIGVsc2VpZiBwb3NpdGlvbiA9PSAzIHRoZW4KICAgICAgICBvZmZzZXQgPSB2My5uZXcobWF4LnggLSAwLjMsIG1pbi55ICsgNCwgMC41KQogICAgZWxzZQogICAgICAgIGVycm9yKCJnb3QgdW5leHBlY3RlZCBwb3NpdGlvbiIpCiAgICBlbmQKICAgIGxvY2FsIGEgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFModmVoaWNsZSwgb2Zmc2V0LngsIG9mZnNldC55IC0gMy4xNSwgb2Zmc2V0LnogKyAxLjA1KQogICAgbG9jYWwgZGlyZWN0aW9uID0gRU5USVRZLkdFVF9FTlRJVFlfUk9UQVRJT04odmVoaWNsZSwgMik6dG9EaXIoKQogICAgbG9jYWwgYiA9IHYzLm5ldyhkaXJlY3Rpb24pCiAgICBiOm11bCgzMDAuMCk7IGI6YWRkKGEpCiAgICBNSVNDLlNIT09UX1NJTkdMRV9CVUxMRVRfQkVUV0VFTl9DT09SRFNfSUdOT1JFX0VOVElUWV9ORVcoYS54LCBhLnksIGEueixiLngsIGIueSwgYi56IC0gMTUsZGFtYWdlLHRydWUsd2VhcG9uSGFzaCxvd25lclBlZCxpc0F1ZGlibGUsbm90IGlzVmlzaWJsZSxzcGVlZCx2ZWhpY2xlLGZhbHNlLCBmYWxzZSwgdGFyZ2V0LCBmYWxzZSwgMCwgMCwgMCkKZW5kCmZ1bmN0aW9uIExhemVyX1NwYWNlX0Nhcih0b2dnbGVkKQogICAgTGF6ZXJfU3BhY2VfQ2FyX3RvZ2dsZWQgPSB0b2dnbGVkCiAgICBpZiBMYXplcl9TcGFjZV9DYXJfdG9nZ2xlZCB0aGVuCiAgICAgICAgbG9jYWwgdmhhc2ggPSB1dGlsLmpvYWF0KCdkdW5lMicpCiAgICAgICAgbG9jYWwgcENvb3IgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgICAgICByZXF1ZXN0X21vZGVsKHZoYXNoKQogICAgICAgIExzZGNhciA9IFZFSElDTEUuQ1JFQVRFX1ZFSElDTEUodmhhc2gsIHBDb29yLngsIHBDb29yLnksIHBDb29yLnosIEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSksIHRydWUsIHRydWUsIGZhbHNlKQogICAgICAgIFBFRC5TRVRfUEVEX0lOVE9fVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBMc2RjYXIsIC0xKQogICAgZWxzZQogICAgICAgIGRlbGV0ZV9lbnRpdHkoTHNkY2FyKQogICAgZW5kCiAgICB3aGlsZSBMYXplcl9TcGFjZV9DYXJfdG9nZ2xlZCBkbwogICAgICAgIGlmIFBFRC5JU19QRURfSU5fVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBMc2RjYXIsIGZhbHNlKSB0aGVuCiAgICAgICAgICAgIGRpc3BsYXlfYnV0dG9ucyh7ezAsIDg2LCAn6ZWt5bCEJ319KQogICAgICAgICAgICBpZiBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsIDg2KSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCB3ZWFwID0gdXRpbC5qb2FhdChMc2RjYXJfaGFzaCkKICAgICAgICAgICAgICAgIHJlcXVlc3Rfd2VhcG9uX2Fzc2V0KHdlYXApCiAgICAgICAgICAgICAgICBzaG9vdF9mcm9tX3ZlaGljbGVfTGF6ZXJfU3BhY2VfQ2FyKExzZGNhciwgMjAwLCB3ZWFwLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlLCB0cnVlLCAyMDAwLjAsIDAsIDApCiAgICAgICAgICAgICAgICBzaG9vdF9mcm9tX3ZlaGljbGVfTGF6ZXJfU3BhY2VfQ2FyKExzZGNhciwgMjAwLCB3ZWFwLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlLCB0cnVlLCAyMDAwLjAsIDAsIDIpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIHV0aWwueWllbGQoKQogICAgZW5kCmVuZAoKCgoKLS0tLemBk+Wlh+aImOmprApmdW5jdGlvbiBTRl9mZjkoKQogICAgSFVELkhJREVfSFVEX0NPTVBPTkVOVF9USElTX0ZSQU1FKDYpCiAgICBIVUQuSElERV9IVURfQ09NUE9ORU5UX1RISVNfRlJBTUUoNykKICAgIEhVRC5ISURFX0hVRF9DT01QT05FTlRfVEhJU19GUkFNRSg4KQogICAgSFVELkhJREVfSFVEX0NPTVBPTkVOVF9USElTX0ZSQU1FKDkpCiAgICBtZW1vcnkud3JpdGVfaW50KG1lbW9yeS5zY3JpcHRfZ2xvYmFsKDE2NDU3MzkrMTEyMSksIDEpCiAgICBzZi5DTEVBUl9BTEwoKQogICAgc2YuVE9HR0xFX01PVVNFX0JVVFRPTlMoZmFsc2UpCiAgICBzZi5TRVRfREFUQV9TTE9UKDAsUEFEMi5HRVRfQ09OVFJPTF9JTlNUUlVDVElPTkFMX0JVVFRPTigwLCA4NiwgdHJ1ZSksICfnlLXno4HohInlhrInKQogICAgc2YuRFJBV19JTlNUUlVDVElPTkFMX0JVVFRPTlMoKQogICAgc2Y6ZHJhd19mdWxsc2NyZWVuKCkKZW5kCgptYWd0ZiA9IHt0cnVlLCBmYWxzZX0KbWFnbGlzdCA9IHt7MSwn5o6o5byAJ30sIHsyLCfniIbngrgnfX0KbWFndmFsX3N0eWxlID0gdHJ1ZQpmdW5jdGlvbiBkYW9xaXpoYW5tYV9zdHlsZShtYWdpbnQsIG1lbnVfbmFtZSwgcHJldl92YWx1ZSwgY2xpY2tfdHlwZSkKICAgIG1hZ3ZhbF9zdHlsZSA9IG1hZ3RmW21hZ2ludF0KZW5kCmNoYXJnZXIgPSB7Y2hhcmcgPSB1dGlsLmpvYWF0KCdkdWtlczInKSxlbXAgPSB1dGlsLmpvYWF0KCdoZWlfcHJvcF9oZWlzdF9lbXAnKX0KZnVuY3Rpb24gQ2NyZWF0ZShwQ29vciwgcGVkU2kpCiAgICBGRmNoYXIgPSBWRUhJQ0xFLkNSRUFURV9WRUhJQ0xFKGNoYXJnZXIuY2hhcmcsIHBDb29yLngsIHBDb29yLnksIHBDb29yLnosIDAsIHRydWUsIHRydWUsIGZhbHNlKQogICAgUEVELlNFVF9QRURfSU5UT19WRUhJQ0xFKHBlZFNpLCBGRmNoYXIsIC0xKQogICAgVkVISUNMRS5TRVRfVkVISUNMRV9DT0xPVVJTKEZGY2hhciwgMTE4LCAwKQogICAgICAgIGZvciBNPTAsIDQ5IGRvCiAgICAgICAgICAgIGxvY2FsIG1vZG4gPSBWRUhJQ0xFLkdFVF9OVU1fVkVISUNMRV9NT0RTKEZGY2hhciwgTSkKICAgICAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9NT0QoRkZjaGFyLCBNLCBtb2RuIC0xLCBmYWxzZSkKICAgICAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9OVU1CRVJfUExBVEVfVEVYVChGRmNoYXIsICdNT1BBUicpCiAgICAgICAgICAgIFZFSElDTEUuR0VUX1ZFSElDTEVfTU9EX0tJVChGRmNoYXIsIDApCiAgICAgICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfTU9EX0tJVChGRmNoYXIsIDApCiAgICAgICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfTU9EKEZGY2hhciwgMTQsIDApCiAgICAgICAgICAgIFZFSElDTEUuVE9HR0xFX1ZFSElDTEVfTU9EKEZGY2hhciwgMjIsIHRydWUpCiAgICAgICAgICAgIFZFSElDTEUuVE9HR0xFX1ZFSElDTEVfTU9EKEZGY2hhciwgMTgsIHRydWUpCiAgICAgICAgICAgIFZFSElDTEUuVE9HR0xFX1ZFSElDTEVfTU9EKEZGY2hhciwgMjAsIHRydWUpCiAgICAgICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfVFlSRV9TTU9LRV9DT0xPUihGRmNoYXIsIDAsIDAsIDApCiAgICAgICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfV0hFRUxfVFlQRShGRmNoYXIsIDcpCiAgICAgICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfTU9EKEZGY2hhciwgMjMsIDI2KQogICAgICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX01BWF9TUEVFRChGRmNoYXIsIDEwMCkKICAgICAgICAgICAgVkVISUNMRS5NT0RJRllfVkVISUNMRV9UT1BfU1BFRUQoRkZjaGFyLCA0MCkKICAgICAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9CVVJOT1VUKEZGY2hhciwgZmFsc2UpCiAgICAgICAgZW5kCiAgICAgICAgdXRpbC55aWVsZCgxNTApCiAgICBsb2NhbCBjY29vciA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhGRmNoYXIpCiAgICAgICAgRW1wYSA9IE9CSkVDVC5DUkVBVEVfT0JKRUNUKGNoYXJnZXIuZW1wLCBjY29vci54LCBjY29vci55IC0xLCBjY29vci56IC0xLCB0cnVlLCB0cnVlLCB0cnVlKQogICAgICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWShFbXBhLCBGRmNoYXIsIDAsIDAuMCwgLTIuMCwgMC41LCAwLjAsIDAuMCwgMC4wLCBmYWxzZSwgdHJ1ZSwgZmFsc2UsIGZhbHNlLCAwLCB0cnVlLCAwKQogICAgICAgIGxvY2FsIENWID0gQ0FNLkdFVF9HQU1FUExBWV9DQU1fUkVMQVRJVkVfSEVBRElORygpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSEVBRElORyhGRmNoYXIsIENWKQogICAgICAgIHV0aWwueWllbGQoKQogICAgZnVuY3Rpb24gTWFnb3V0KCkKICAgICAgICBpZiAgUEFELklTX0NPTlRST0xfUFJFU1NFRCgwLCA4NikgdGhlbgogICAgICAgICAgICBsb2NhbCBjYXIgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgICAgICAgICAgRklSRS5BRERfRVhQTE9TSU9OKGNhci54LCBjYXIueSwgY2FyLnosIDgxLCA1MDAwLjAsIGZhbHNlLCB0cnVlLCAwLjAsIG1hZ3ZhbF9zdHlsZSkKICAgICAgICBlbmQKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAogICAgICAgIHV0aWwuY3JlYXRlX3RpY2tfaGFuZGxlcihmdW5jdGlvbiAoKQogICAgICAgICAgICBpZiBQRUQuSVNfUEVEX0lOX1ZFSElDTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgRkZjaGFyLCBmYWxzZSkgPT10cnVlIHRoZW4KICAgICAgICAgICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRElSVF9MRVZFTChGRmNoYXIsIDApCiAgICAgICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKEZGY2hhciwgdHJ1ZSkKICAgICAgICAgICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfQ0FOX0JFX1ZJU0lCTFlfREFNQUdFRChGRmNoYXIsIGZhbHNlKQogICAgICAgICAgICAgICAgU0ZfZmY5KCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kKQplbmQKZnVuY3Rpb24gZGFvcWl6aGFubWEoKQogICAgcmVxdWVzdF9tb2RlbChjaGFyZ2VyLmNoYXJnKQogICAgcmVxdWVzdF9tb2RlbChjaGFyZ2VyLmVtcCkKICAgIGxvY2FsIHBlZFNpID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEX1NDUklQVF9JTkRFWChQTEFZRVIuUExBWUVSX0lEKCkpCiAgICBsb2NhbCBwQ29vciA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgbG9jYWwgcEggPSBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCgogICAgaWYgcGxheWVycy5pc19pbl9pbnRlcmlvcihQTEFZRVIuUExBWUVSX0lEKCkpID09dHJ1ZSB0aGVuCiAgICAgICAgdXRpbC50b2FzdCgn5peg5rOV5Zyo5a6k5YaF55Sf5oiQ6YGT5aWH5oiY6amsJykKICAgICAgICBtZW51LnNldF92YWx1ZShTcGF3biwgZmFsc2UpCiAgICAgICAgcmV0dXJuCiAgICBlbmQKICAgIGlmIFBFRC5JU19QRURfSU5fVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBGRmNoYXIsIHRydWUpID09IGZhbHNlIGFuZCBQRUQuSVNfUEVEX0lOX0FOWV9WRUhJQ0xFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpID09IHRydWUgdGhlbgogICAgICAgIGxvY2FsIGN1cmNhciA9IGVudGl0aWVzLmdldF91c2VyX3ZlaGljbGVfYXNfaGFuZGxlKCkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9BU19NSVNTSU9OX0VOVElUWShjdXJjYXIpCiAgICAgICAgZGVsZXRlX2VudGl0eShjdXJjYXIpCiAgICAgICAgdXRpbC50b2FzdCgn5bey5Li65oKo5pu05o2i5paw55qEJykKICAgICAgICBDY3JlYXRlKHBDb29yLCBwZWRTaSkKICAgIGVsc2VpZiBQRUQuSVNfUEVEX0lOX1ZFSElDTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgRkZjaGFyLCB0cnVlKSA9PXRydWUgdGhlbgogICAgICAgIE1hZ291dCgpCiAgICBlbHNlaWYgUEVELklTX1BFRF9JTl9BTllfVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSA9PSBmYWxzZSB0aGVuCiAgICAgICAgQ2NyZWF0ZShwQ29vciwgcGVkU2kpCiAgICBlbmQKICAgIGlmIFBFRC5JU19QRURfR0VUVElOR19JTlRPX0FfVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSA9PWZhbHNlIGFuZCBQRUQuSVNfUEVEX0lOX1ZFSElDTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgRkZjaGFyICwgZmFsc2UpID09ZmFsc2UgdGhlbgogICAgICAgIHV0aWwudG9hc3QoJ+W3suemu+W8gOaImOmprCzmiJjpqazlt7LooqvliKDpmaQnKQogICAgICAgIG1lbnUuc2V0X3ZhbHVlKFNwYXduLCBmYWxzZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9BU19NSVNTSU9OX0VOVElUWShGRmNoYXIpCiAgICAgICAgZGVsZXRlX2VudGl0eShGRmNoYXIpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQVNfTUlTU0lPTl9FTlRJVFkoRW1wYSkKICAgICAgICBkZWxldGVfZW50aXR5KEVtcGEpCiAgICAgICAgU1RSRUFNSU5HLlNFVF9NT0RFTF9BU19OT19MT05HRVJfTkVFREVEKGNoYXJnZXIuY2hhcmcpCiAgICAgICAgU1RSRUFNSU5HLlNFVF9NT0RFTF9BU19OT19MT05HRVJfTkVFREVEKGNoYXJnZXIuZW1wKQogICAgICAgIHV0aWwuc3RvcF90aHJlYWQoKQogICAgZW5kCmVuZApmdW5jdGlvbiBzdG9wX2Rhb3Fpemhhbm1hKCkKICAgIGlmIEZGY2hhciBvciBFbXBhIHRoZW4KICAgICAgICBkZWxldGVfZW50aXR5KEZGY2hhcikKICAgICAgICBkZWxldGVfZW50aXR5KEVtcGEpCiAgICBlbmQKZW5kCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgoKCgoKCgoKCgoKLS0tLS0tLS0tLS0t5bCE5Ye76aaGCmxvY2FsIHNob290X3RleHRfY29sb3VyID0gewogICAgciA9IDEuMCwKICAgIGcgPSAxLjAsCiAgICBiID0gMS4wLAogICAgYSA9IDEuMAp9CmxvY2FsIHNob290X2JnX2NvbG91ciA9IHsKICAgIHIgPSAwLjc1LAogICAgZyA9IDAuODIsCiAgICBiID0gMC45NCwKICAgIGEgPSAxCn0KbG9jYWwgc2hvb3RfcG9zID0gewogICAgeCA9IC0yOTgzLjM4NjUsCiAgICB5ID0gLTUxNDcuNTAwLAogICAgeiA9IDQzNy4xNTQ4OAp9CnRpbWVfc2VsZWN0b3IgPXsKICAgIGRpc3BsYXlfb3B0aW9ucyA9IHt7MSwi5peg6ZmQ5Yi2In0sIHsyLCIzMHMifSwgezMsIjYwcyJ9LCB7NCwiOTBzIn0sIHs1LCIxMjBzIn0sIHs2LCIxODBzIn0sIHs3LCIzMDBzIn19LAogICAgdmFsdWUgPSB7IDAsIDMwMDAwLCA2MDAwMCwgOTAwMDAsIDEyMDAwMCwgMTgwMDAwLCAzMDAwMDB9Cn0KbG9jYWwgc2hvb3RfbWF4X2hlaWdodCA9IDUKc2ltcGxlM2RfdGFyZ2V0X21heF9oZWlnaHQgPSB7CiAgICBkaXNwbGF5X29wdGlvbnMgPSB7ezEsIuWcsOmdoiJ9LCB7Miwi5L2OIn0sIHszLCLkuK0ifSwgezQsIumrmCJ9LCB7NSwi5beF5bOwIn19LAogICAgaGVpZ2h0X3ZhbHVlID0gezAsIDMsIDUsIDcsIDl9Cn0KbG9jYWwgcGVkX2hlYWx0aCA9IDIwMApwZWRfaGVhbHRoX3NlbGVjdG9yID0gewogICAgZGlzcGxheV9vcHRpb25zID0ge3sxLCJOUEMifSwgezIsIlBsYXllciJ9LCB7Mywi5LiA5p6q5Ye75p2AIn0sIHs0LCLku4XniIblpLRb54uZ5Ye75omLTUtJSV0ifX0sCiAgICBoZWFsaF92YWx1ZXMgPSB7MjAwLCAzMjgsIDEwNSwgMTAwMDAwfQp9CmZ1bmN0aW9uIGNsZWFyX2FsbF9wZWRzKCkKICAgIGZvciBfLCBwZWQgaW4gaXBhaXJzKGVudGl0aWVzLmdldF9hbGxfcGVkc19hc19oYW5kbGVzKCkpIGRvCiAgICAgICAgaWYgcGVkIH49IFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkgYW5kIG5vdCBQRUQuSVNfUEVEX0FfUExBWUVSKHBlZCkgdGhlbgogICAgICAgICAgICBkZWxldGVfZW50aXR5KHBlZCkKICAgICAgICBlbmQKICAgIGVuZAplbmQKZnVuY3Rpb24gY2xlYXJfZGVhZF9wZWRzKCkKICAgIGZvciBfLCBwZWQgaW4gaXBhaXJzKGVudGl0aWVzLmdldF9hbGxfcGVkc19hc19oYW5kbGVzKCkpIGRvCiAgICAgICAgaWYgcGVkIH49IFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkgYW5kIG5vdCBQRUQuSVNfUEVEX0FfUExBWUVSKHBlZCkgYW5kIEVOVElUWS5JU19FTlRJVFlfREVBRChwZWQpIHRoZW4KICAgICAgICAgICAgZGVsZXRlX2VudGl0eShwZWQpCiAgICAgICAgZW5kICAgICAgICAgICAgICAgCiAgICBlbmQKZW5kCgotLS0t5YWB6K64UEVE56e75YqoCmxvY2FsIEFsbG93X3RhcmdldF9tb3ZlID0gZmFsc2UKZnVuY3Rpb24gdGFyZ2V0X21vdmUodG9nZ2xlKQogICAgQWxsb3dfdGFyZ2V0X21vdmUgPSB0b2dnbGUKZW5kCmZ1bmN0aW9uIGNyZWF0ZV9wZWRfc2ltcGxlXzNkKG1heF9oZWlnaHQsIGhlYWx0aCkKICAgIGlmIG1heF9oZWlnaHQgfj0gMCB0aGVuCiAgICAgICAgenJhbmRvbSA9IG1hdGgucmFuZG9tKDAsIG1heF9oZWlnaHQpCiAgICBlbHNlCiAgICAgICAgenJhbmRvbSA9IDAKICAgIGVuZAogICAgeHJhbmRvbSwgeXJhbmRvbSA9IG1hdGgucmFuZG9tKDAsIDYzKSwgbWF0aC5yYW5kb20oMCwgODIpCiAgICB0YXJnZXRfcGVkID0gUEVELkNSRUFURV9SQU5ET01fUEVEKC0yOTUxLjUxMzQ1LXhyYW5kb20sIC01MTg4Ljg5NTM0NSt5cmFuZG9tLCA0MzcuMzUzMzQ1K3pyYW5kb20pCiAgICAtLeaWsOWingogICAgaWYgQWxsb3dfdGFyZ2V0X21vdmUgPT0gdHJ1ZSB0aGVuCiAgICAgICAgbG9jYWwgdGFyZ2V0X3BlZDIgPSBQRUQuQ1JFQVRFX1JBTkRPTV9QRUQoLTI5NTEuNTEzNDUtbWF0aC5yYW5kb20oMCwgNjMpLCAtNTE4OC44OTUzNDUrbWF0aC5yYW5kb20oMCwgODIpLCA0MzcuMzUzMzQ1K3pyYW5kb20pCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQUxQSEEodGFyZ2V0X3BlZDIsIDAsIGZhbHNlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0hFQUxUSCh0YXJnZXRfcGVkLCBoZWFsdGgsIDApCiAgICAgICAgVEFTSy5UQVNLX0NPTUJBVF9QRUQodGFyZ2V0X3BlZCwgdGFyZ2V0X3BlZDIsIDAsIDE2KQogICAgZWxzZS0t5Y6fCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSEVBTFRIKHRhcmdldF9wZWQsIGhlYWx0aCwgMCkKICAgICAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTih0YXJnZXRfcGVkLCB0cnVlKQogICAgZW5kCiAgICByZXR1cm4gdGFyZ2V0X3BlZAplbmQKZnVuY3Rpb24gY3JlYXRlX3BlZF9zaW1wbGVfMmQoaGVhbHRoKQogICAgeHJhbmRvbSwgeXJhbmRvbSwgenJhbmRvbSA9IG1hdGgucmFuZG9tKDAsIDYzKSwgMCwgbWF0aC5yYW5kb20oMCwgMTApCiAgICB0YXJnZXRfcGVkID0gUEVELkNSRUFURV9SQU5ET01fUEVEKC0yOTUxLjUxMzQ1LXhyYW5kb20sIC01MTg4Ljg5NTM0NSt5cmFuZG9tLCA0MzcuMzUzMzQ1K3pyYW5kb20pCiAgICBFTlRJVFkuU0VUX0VOVElUWV9IRUFMVEgodGFyZ2V0X3BlZCwgaGVhbHRoLCAwKQogICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04odGFyZ2V0X3BlZCwgdHJ1ZSkKICAgIHJldHVybiB0YXJnZXRfcGVkCmVuZApmdW5jdGlvbiB0ZWxlcG9ydF90b19sYWIoKQogICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTX05PX09GRlNFVChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBzaG9vdF9wb3MueCwgc2hvb3RfcG9zLnkrMjAsIHNob290X3Bvcy56ICsgMiwgMCwgMCwgMSkKZW5kCmZ1bmN0aW9uIHRvaW50KG4pCiAgICBsb2NhbCBzID0gdG9zdHJpbmcobikKICAgIGxvY2FsIGksIGogPSBzOmZpbmQoJyUuJykKICAgIGlmIGkgdGhlbgogICAgICAgIHJldHVybiB0b251bWJlcihzOnN1YigxLCBpLTEpKQogICAgZWxzZQogICAgICAgIHJldHVybiBuCiAgICBlbmQKZW5kCmZ1bmN0aW9uIGVuZF9taW5pZ2FtZShtaW5pZ2FtZSkKICAgIG1pbmlnYW1lOnRyaWdnZXIoZmFsc2UpCiAgICB1dGlsLnlpZWxkKDEwMDApCiAgICBjbGVhcl9hbGxfcGVkcygpIAplbmQKLS0tLS0tLS0t5Yib5bu66K6t57uD5Zy6CmxvY2FsIHRyYWlub2JqZWN0cyA9IHt9CmZ1bmN0aW9uIGxvYWRfbGFiKCkKICAgIGxvY2FsIHByb3BfaGFzaCA9IHV0aWwuam9hYXQoInN0dF9wcm9wX3N0dW50X2JibG9ja19odWdlXzAzIikKICAgIGxvY2FsIHBlZF9zaG9vdF9wb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSkKICAgIHJlcXVlc3RfbW9kZWwocHJvcF9oYXNoKQoJCiAgICB0cmFpbm9iamVjdHNbMV0gPSBPQkpFQ1QuQ1JFQVRFX09CSkVDVF9OT19PRkZTRVQocHJvcF9oYXNoLCBzaG9vdF9wb3MueCwgc2hvb3RfcG9zLnksIHNob290X3Bvcy56LCB0cnVlLCB0cnVlLCBmYWxzZSkKICAgIHRyYWlub2JqZWN0c1syXSA9IE9CSkVDVC5DUkVBVEVfT0JKRUNUX05PX09GRlNFVChwcm9wX2hhc2gsIHNob290X3Bvcy54LCBzaG9vdF9wb3MueSwgc2hvb3RfcG9zLnorIDE1LCB0cnVlLCB0cnVlLCBmYWxzZSkKICAgIHRyYWlub2JqZWN0c1szXSA9IE9CSkVDVC5DUkVBVEVfT0JKRUNUX05PX09GRlNFVChwcm9wX2hhc2gsIHNob290X3Bvcy54LCBzaG9vdF9wb3MueSs0Miwgc2hvb3RfcG9zLnotMi42LCB0cnVlLCB0cnVlLCBmYWxzZSkKICAgIHRyYWlub2JqZWN0c1s0XSA9IE9CSkVDVC5DUkVBVEVfT0JKRUNUX05PX09GRlNFVChwcm9wX2hhc2gsIHNob290X3Bvcy54LCBzaG9vdF9wb3MueS00Miwgc2hvb3RfcG9zLnotMi42LCB0cnVlLCB0cnVlLCBmYWxzZSkKICAgIHRyYWlub2JqZWN0c1s1XSA9IE9CSkVDVC5DUkVBVEVfT0JKRUNUX05PX09GRlNFVChwcm9wX2hhc2gsIHNob290X3Bvcy54IC0zMi41LCBzaG9vdF9wb3MueSwgc2hvb3RfcG9zLnosIHRydWUsIHRydWUsIGZhbHNlKQogICAgdHJhaW5vYmplY3RzWzZdID0gT0JKRUNULkNSRUFURV9PQkpFQ1RfTk9fT0ZGU0VUKHByb3BfaGFzaCwgc2hvb3RfcG9zLnggKzMyLjUsIHNob290X3Bvcy55LCBzaG9vdF9wb3MueiwgdHJ1ZSwgdHJ1ZSwgZmFsc2UpCgogICAgdXRpbC55aWVsZCg1MCkKICAgIGxvY2FsIHJvdCA9IEVOVElUWS5HRVRfRU5USVRZX1JPVEFUSU9OKHRyYWlub2JqZWN0c1szXSwgMCkKICAgIHJvdC54ID0gOTAKCUVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKHRyYWlub2JqZWN0c1szXSwgcm90Lngscm90Lnkscm90LnosMSx0cnVlKQogICAgcm90ID0gRU5USVRZLkdFVF9FTlRJVFlfUk9UQVRJT04odHJhaW5vYmplY3RzWzRdLCAwKQogICAgcm90LnggPSA5MAoJRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04odHJhaW5vYmplY3RzWzRdLCByb3QueCxyb3QueSxyb3QueiwxLHRydWUpCiAgICByb3QgPSBFTlRJVFkuR0VUX0VOVElUWV9ST1RBVElPTih0cmFpbm9iamVjdHNbNV0sIDApCiAgICByb3QueSA9IDkwCglFTlRJVFkuU0VUX0VOVElUWV9ST1RBVElPTih0cmFpbm9iamVjdHNbNV0sIHJvdC54LHJvdC55LHJvdC56LDEsdHJ1ZSkKICAgIHJvdCA9IEVOVElUWS5HRVRfRU5USVRZX1JPVEFUSU9OKHRyYWlub2JqZWN0c1s2XSwgMCkKICAgIHJvdC55ID0gLTkwCglFTlRJVFkuU0VUX0VOVElUWV9ST1RBVElPTih0cmFpbm9iamVjdHNbNl0sIHJvdC54LHJvdC55LHJvdC56LDEsdHJ1ZSkKICAgIHV0aWwueWllbGQoNTAwKQogICAgdGVsZXBvcnRfdG9fbGFiKCkKICAgIGNsZWFyX2FsbF9wZWRzKCkKZW5kCi0tLS3nu5PmnZ8KZnVuY3Rpb24gQ2xlYW5fdHJhaW5pbmdfZ3JvdW5kKCkKICAgIHRlbGVwb3J0KC0xMzE0LCAtMzA1NywgMTMsIGZhbHNlKQogICAgdXRpbC55aWVsZCg1MDApCiAgICAgICAgZm9yIF8sIHBlZCBpbiBpcGFpcnMoZW50aXRpZXMuZ2V0X2FsbF9wZWRzX2FzX2hhbmRsZXMoKSkgZG8KICAgICAgICAgICAgaWYgcGVkIH49IFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkgYW5kIG5vdCBQRUQuSVNfUEVEX0FfUExBWUVSKHBlZCkgdGhlbgogICAgICAgICAgICAgICAgZGVsZXRlX2VudGl0eShwZWQpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIGZvciBrZXksIHZhbHVlIGluIHBhaXJzKHRyYWlub2JqZWN0cykgZG8KICAgICAgICAgICAgZGVsZXRlX2VudGl0eSh2YWx1ZSkKICAgICAgICBlbmQKZW5kCi0tLS0tLS0tM0TlsITlh7sKcGVkX2hlYWx0aF8zZCA9IHBlZF9oZWFsdGgKbG9jYWwgdGltZV8zZCA9IDAKZnVuY3Rpb24gU2hvb3Rpbmdfc2ltdWxhdGlvbl8zRCh0b2dnbGUpCiAgICBvbiA9IHRvZ2dsZQogICAgcGVkX2hlYWx0aF8zZCA9IHBlZF9oZWFsdGhfM2QKICAgIHNpbXBsZV8zZF9zdGFydGVkID0gdHJ1ZQogICAgc2ltcGxlXzJkX3RvZ2dsZTp0cmlnZ2VyKGZhbHNlKQogICAgdGltZSA9IHRpbWVfM2QKICAgIG1lbnUudHJpZ2dlcl9jb21tYW5kcygidGltZSAxMTsgbG9ja3RpbWUgb24iKQogICAgdXRpbC55aWVsZCgxMDAwKQogICAgY2xlYXJfYWxsX3BlZHMoKQogICAgdXRpbC55aWVsZCgxMDApCiAgICBsb2NhbCB0YXJnZXRfcGVkID0gY3JlYXRlX3BlZF9zaW1wbGVfM2Qoc2hvb3RfbWF4X2hlaWdodCwgcGVkX2hlYWx0aF8zZCkKICAgIEhVRC5BRERfQkxJUF9GT1JfRU5USVRZKHRhcmdldF9wZWQpCiAgICBsb2NhbCBraWxscyA9IDAKICAgIGxvY2FsIGVuZF90aW1lID0gdXRpbC5jdXJyZW50X3RpbWVfbWlsbGlzKCkgKyB0aW1lCiAgICB3aGlsZSBvbiBkbwogICAgICAgIGlmIEFsbG93X3RhcmdldF9tb3ZlID09IGZhbHNlIHRoZW4tLeaWsOWingogICAgICAgICAgICBUQVNLLlRBU0tfU1RBTkRfU1RJTEwodGFyZ2V0X3BlZCwgMTAwMDAwMCkKICAgICAgICBlbmQKICAgICAgICAtLS0tLURSQVcgSU5GTyBCT1gKICAgICAgICBsb2NhbCBjdXJfdGltZSA9IHV0aWwuY3VycmVudF90aW1lX21pbGxpcygpCiAgICAgICAgbG9jYWwgdGltZXIgPSAoKGVuZF90aW1lIC0gY3VyX3RpbWUpLzEwMDApCiAgICAgICAgaWYgdGltZSA+IDAgdGhlbgogICAgICAgICAgICB0eHQgPSAoIuW+l+WIhjogIi4ua2lsbHMuLiIgfCDml7bpl7Q6ICIuLnRvaW50KHRpbWVyKSkKICAgICAgICBlbHNlCiAgICAgICAgICAgIHR4dCA9ICgi5b6X5YiGOiAiLi5raWxscy4uIiB8IOaXtumXtDog4oieIikKICAgICAgICBlbmQKICAgICAgICBsb2NhbCBzaXplX3gsIHNpemVfeSA9IGRpcmVjdHguZ2V0X3RleHRfc2l6ZSgodHh0KSwgMC43KQogICAgICAgIGxvY2FsIHNob290X3Bvc194ID0gKDAuNSAtIHNpemVfeC8yKQogICAgICAgIGxvY2FsIHNob290X3Bvc195ID0gMC4wMTUKICAgICAgICBkaXJlY3R4LmRyYXdfcmVjdChzaG9vdF9wb3NfeCAtIDAuMDEsIHNob290X3Bvc195IC0gMC4wMSwgc2l6ZV94ICsgMC4wMiwgc2l6ZV95ICsgMC4wMiwgc2hvb3RfYmdfY29sb3VyKQogICAgICAgIGRpcmVjdHguZHJhd190ZXh0KHNob290X3Bvc194LCBzaG9vdF9wb3NfeSwgdHh0LCAwLCAwLjcwLCBzaG9vdF90ZXh0X2NvbG91ciwgdHJ1ZSApIAogICAgICAgIGlmIHRpbWVyIDw9IDAgYW5kIHRpbWUgPiAwIHRoZW4KICAgICAgICAgICAgdXRpbC50b2FzdCgiM0TlsITlh7vlt7Lnu4/nu5PmnZ8gfCDlvpfliIY6ICIuLmtpbGxzLi4iIHwg5pe26Ze0OiAiLi50b2ludCh0aW1lLzEwMDApLi4icy4iKQogICAgICAgICAgICBzaW1wbGVfM2Rfc3RhcnRlZCA9IGZhbHNlCiAgICAgICAgICAgIGVuZF9taW5pZ2FtZShzaW1wbGVfM2RfdG9nZ2xlKQogICAgICAgIGVuZAogICAgICAgIC0tLS0tLVRBUkdFVCBIQU5ETEVSCiAgICAgICAgaWYgRU5USVRZLklTX0VOVElUWV9ERUFEKHRhcmdldF9wZWQpIHRoZW4KICAgICAgICAgICAgY2xlYXJfZGVhZF9wZWRzKCkKICAgICAgICAgICAgaWYgdGltZXIgPiAwIG9yIHRpbWUgPT0gMCB0aGVuCiAgICAgICAgICAgICAgICBraWxscyA9IGtpbGxzICsgMQogICAgICAgICAgICAgICAgdGFyZ2V0X3BlZCA9IGNyZWF0ZV9wZWRfc2ltcGxlXzNkKHNob290X21heF9oZWlnaHQsIHBlZF9oZWFsdGhfM2QpCiAgICAgICAgICAgICAgICBIVUQuQUREX0JMSVBfRk9SX0VOVElUWSh0YXJnZXRfcGVkKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAogICAgaWYgbm90IG9uIHRoZW4gCiAgICAgICAgY2xlYXJfYWxsX3BlZHMoKQogICAgICAgIHNpbXBsZV8zZF9zdGFydGVkID0gZmFsc2UKICAgIGVuZAplbmQKZnVuY3Rpb24gU2V0X2NvbmRpdGlvbl8zRChpbmRleCkKICAgIHBlZF9oZWFsdGhfM2QgPSBwZWRfaGVhbHRoX3NlbGVjdG9yLmhlYWxoX3ZhbHVlc1tpbmRleF0KICAgIGlmIHNpbXBsZV8zZF9zdGFydGVkIHRoZW4KICAgICAgICB1dGlsLnRvYXN0KCLlsIborr7lrprnirblhrXkv67mlLnkuLo+Ii4ucGVkX2hlYWx0aF9zZWxlY3Rvci5kaXNwbGF5X29wdGlvbnNbaW5kZXhdWzJdLi4iPCDmm7TmlLnlsIblupTnlKjkuo7kuIvkuIDlnLrmr5TotZsiKQogICAgZWxzZQogICAgICAgIHV0aWwudG9hc3QoIuWwhuiuvuWumueKtuWGteS/ruaUueS4uj4iLi5wZWRfaGVhbHRoX3NlbGVjdG9yLmRpc3BsYXlfb3B0aW9uc1tpbmRleF1bMl0uLiI8IikKICAgIGVuZAplbmQKZnVuY3Rpb24gU2V0X3Nob290X3RpbWVfM0QoaW5kZXgpCiAgICB0aW1lXzNkID0gdGltZV9zZWxlY3Rvci52YWx1ZVtpbmRleF0KICAgIGlmIHNpbXBsZV8zZF9zdGFydGVkIHRoZW4KICAgICAgICB1dGlsLnRvYXN0KCLkv67mlLnmuLjmiI/ml7bpl7Toh7M+Ii4udGltZV9zZWxlY3Rvci5kaXNwbGF5X29wdGlvbnNbaW5kZXhdWzJdLi4iPCDmm7TmlLnlsIblupTnlKjkuo7kuIvkuIDlnLrmr5TotZsiKQogICAgZWxzZQogICAgICAgIHV0aWwudG9hc3QoIuS/ruaUuea4uOaIj+aXtumXtOiHsz4iLi50aW1lX3NlbGVjdG9yLmRpc3BsYXlfb3B0aW9uc1tpbmRleF1bMl0uLiI8IikKICAgIGVuZAplbmQKZnVuY3Rpb24gVGFyZ2V0X2J1aWxkX2hlaWdodF8zRChpbmRleCkKICAgIHNob290X21heF9oZWlnaHQgPSBzaW1wbGUzZF90YXJnZXRfbWF4X2hlaWdodC5oZWlnaHRfdmFsdWVbaW5kZXhdCiAgICBpZiBzaW1wbGVfM2Rfc3RhcnRlZCB0aGVuCiAgICAgICAgdXRpbC50b2FzdCgi5bCG566A5Y2VM0TnlJ/miJDpq5jluqbkv67mlLnkuLogPiIuLnNpbXBsZTNkX3RhcmdldF9tYXhfaGVpZ2h0LmRpc3BsYXlfb3B0aW9uc1tpbmRleF1bMl0uLiI8IOabtOaUueWwhuW6lOeUqOS6juS4i+S4gOWcuuavlOi1myIpCiAgICBlbHNlCiAgICAgICAgdXRpbC50b2FzdCgi5bCG566A5Y2VM0TnlJ/miJDpq5jluqbkv67mlLnkuLogPiIuLnNpbXBsZTNkX3RhcmdldF9tYXhfaGVpZ2h0LmRpc3BsYXlfb3B0aW9uc1tpbmRleF1bMl0uLiI8IikKICAgIGVuZAplbmQKLS0tLS0tLS0yROWwhOWHuwpwZWRfaGVhbHRoXzJkID0gcGVkX2hlYWx0aApsb2NhbCB0aW1lXzJkID0gMApmdW5jdGlvbiBTaG9vdGluZ19zaW11bGF0aW9uXzJEKHRvZ2dsZSkKICAgIG9uID0gdG9nZ2xlCiAgICBzaW1wbGVfMmRfc3RhcnRlZCA9IHRydWUKICAgIHNpbXBsZV8zZF90b2dnbGU6dHJpZ2dlcihmYWxzZSkKICAgIHRpbWUgPSB0aW1lXzJkCiAgICBtZW51LnRyaWdnZXJfY29tbWFuZHMoInRpbWUgMTE7IGxvY2t0aW1lIG9uIikKICAgIGNsZWFyX2FsbF9wZWRzKCkKICAgIGxvY2FsIHRhcmdldF9wZWQgPSBjcmVhdGVfcGVkX3NpbXBsZV8yZChwZWRfaGVhbHRoXzJkKQogICAgSFVELkFERF9CTElQX0ZPUl9FTlRJVFkodGFyZ2V0X3BlZCkKICAgIGxvY2FsIGtpbGxzID0gMAogICAgbG9jYWwgZW5kX3RpbWUgPSB1dGlsLmN1cnJlbnRfdGltZV9taWxsaXMoKSArIHRpbWUKICAgIHdoaWxlIG9uIGRvIAogICAgICAgIFRBU0suVEFTS19TVEFORF9TVElMTCh0YXJnZXRfcGVkLCAxMDAwMDAwKQogICAgICAgIC0tLS0tRFJBVyBJTkZPIEJPWAogICAgICAgIGxvY2FsIGN1cl90aW1lID0gdXRpbC5jdXJyZW50X3RpbWVfbWlsbGlzKCkKICAgICAgICBsb2NhbCB0aW1lciA9ICgoZW5kX3RpbWUgLSBjdXJfdGltZSkvMTAwMCkKICAgICAgICBpZiB0aW1lID4gMCB0aGVuCiAgICAgICAgICAgIHR4dCA9ICgi5b6X5YiGOiAiLi5raWxscy4uIiB8IOaXtumXtDogIi4udG9pbnQodGltZXIpKQogICAgICAgIGVsc2UKICAgICAgICAgICAgdHh0ID0gKCLlvpfliIY6ICIuLmtpbGxzLi4iIHwg5pe26Ze0OiDiiJ4iKQogICAgICAgIGVuZAogICAgICAgIGxvY2FsIHNpemVfeCwgc2l6ZV95ID0gZGlyZWN0eC5nZXRfdGV4dF9zaXplKCh0eHQpLCAwLjcpCiAgICAgICAgbG9jYWwgc2hvb3RfcG9zX3ggPSAoMC41IC0gc2l6ZV94LzIpCiAgICAgICAgbG9jYWwgc2hvb3RfcG9zX3kgPSAwLjAxNQogICAgICAgIGRpcmVjdHguZHJhd19yZWN0KHNob290X3Bvc194IC0gMC4wMSwgc2hvb3RfcG9zX3kgLSAwLjAxLCBzaXplX3ggKyAwLjAyLCBzaXplX3kgKyAwLjAyLCBzaG9vdF9iZ19jb2xvdXIpCiAgICAgICAgZGlyZWN0eC5kcmF3X3RleHQoc2hvb3RfcG9zX3gsIHNob290X3Bvc195LCB0eHQsIDAsIDAuNzAsIHNob290X3RleHRfY29sb3VyLCB0cnVlICkgCiAgICAgICAgaWYgdGltZXIgPD0gMCBhbmQgdGltZSA+IDAgdGhlbgogICAgICAgICAgICB1dGlsLnRvYXN0KCIyROWwhOWHu+W3sue7j+e7k+adnyB8IOW+l+WIhjogIi4ua2lsbHMuLiIgfCDml7bpl7Q6ICIuLnRvaW50KHRpbWUvMTAwMCkuLiJzLiIpCiAgICAgICAgICAgIHNpbXBsZV8yZF9zdGFydGVkID0gZmFsc2UKICAgICAgICAgICAgZW5kX21pbmlnYW1lKHNpbXBsZV8yZF90b2dnbGUpCiAgICAgICAgZW5kCiAgICAgICAgLS0tLS0tVEFSR0VUIEhBTkRMRVIKICAgICAgICBpZiBFTlRJVFkuSVNfRU5USVRZX0RFQUQodGFyZ2V0X3BlZCkgdGhlbgogICAgICAgICAgICBjbGVhcl9kZWFkX3BlZHMoKQogICAgICAgICAgICBpZiB0aW1lciA+IDAgb3IgdGltZSA9PSAwIHRoZW4KICAgICAgICAgICAgICAgIGtpbGxzID0ga2lsbHMgKyAxCiAgICAgICAgICAgICAgICB0YXJnZXRfcGVkID0gY3JlYXRlX3BlZF9zaW1wbGVfMmQocGVkX2hlYWx0aF8yZCkKICAgICAgICAgICAgICAgIEhVRC5BRERfQkxJUF9GT1JfRU5USVRZKHRhcmdldF9wZWQpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIHV0aWwueWllbGQoKQogICAgZW5kCiAgICBpZiBub3Qgb24gdGhlbiAKICAgICAgICBzaW1wbGVfMmRfc3RhcnRlZCA9IGZhbHNlCiAgICAgICAgY2xlYXJfYWxsX3BlZHMoKQogICAgZW5kCmVuZApmdW5jdGlvbiBTZXRfY29uZGl0aW9uXzJEKGluZGV4KQogICAgcGVkX2hlYWx0aF8yZCA9IHBlZF9oZWFsdGhfc2VsZWN0b3IuaGVhbGhfdmFsdWVzW2luZGV4XQogICAgaWYgc2ltcGxlXzJkX3N0YXJ0ZWQgdGhlbgogICAgICAgIHV0aWwudG9hc3QoIuWwhuiuvuWumueKtuWGteS/ruaUueS4uj4iLi5wZWRfaGVhbHRoX3NlbGVjdG9yLmRpc3BsYXlfb3B0aW9uc1tpbmRleF1bMl0uLiI85pu05pS55bCG5Zyo5LiL5LiA5Zy65q+U6LWb5Lit5bqU55SoIikKICAgIGVsc2UKICAgICAgICB1dGlsLnRvYXN0KCLlsIborr7lrprnirblhrXkv67mlLnkuLo+Ii4ucGVkX2hlYWx0aF9zZWxlY3Rvci5kaXNwbGF5X29wdGlvbnNbaW5kZXhdWzJdLi4iPCIpCiAgICBlbmQKZW5kCmZ1bmN0aW9uIFNldF9zaG9vdF90aW1lXzJEKGluZGV4KQogICAgdGltZV8yZCA9IHRpbWVfc2VsZWN0b3IudmFsdWVbaW5kZXhdCiAgICBpZiBzaW1wbGVfMmRfc3RhcnRlZCB0aGVuCiAgICAgICAgdXRpbC50b2FzdCgi5L+u5pS55ri45oiP5pe26Ze06IezPiIuLnRpbWVfc2VsZWN0b3IuZGlzcGxheV9vcHRpb25zW2luZGV4XVsyXS4uIjwg5pu05pS55bCG5Zyo5LiL5LiA5Zy65q+U6LWb5Lit5bqU55So44CCIikKICAgIGVsc2UKICAgICAgICB1dGlsLnRvYXN0KCLkv67mlLnmuLjmiI/ml7bpl7Toh7M+Ii4udGltZV9zZWxlY3Rvci5kaXNwbGF5X29wdGlvbnNbaW5kZXhdWzJdLi4iPCIpCiAgICBlbmQKZW5kCgoKCi0tLS0tLS0t6L295YW35ZaH5Y+t6Z+z5LmQCmxvY2FsIHBpdGNoX21hcCA9IHtyZXN0ID0gMCwgQyA9IDE2LCBEID0gMTcsIEUgPSAxOCwgRiA9IDE5LCBHID0gMjAsIEEgPSAyMSwgQiA9IDIyLCBDMiA9IDIzLH0KbG9jYWwgcmVzdCA9IDAKbG9jYWwgcXVhcnRlciA9IDAuMjUKbG9jYWwgTU9EX0hPUk4gPSAxNApsb2NhbCBob3JuX29uID0gZmFsc2UKZnVuY3Rpb24gZ2V0X25vdGUobm90ZSkKICAgIGlmIHR5cGUobm90ZSkgfj0gInRhYmxlIiB0aGVuCiAgICAgICAgbm90ZSA9IHtwaXRjaD1ub3RlfQogICAgZW5kCiAgICBpZiB0eXBlKG5vdGUucGl0Y2gpIH49ICJudW1iZXIiIHRoZW4KICAgICAgICBub3RlLnBpdGNoID0gcGl0Y2hfbWFwW25vdGUucGl0Y2hdCiAgICBlbmQKICAgIGlmIG5vdGUubGVuZ3RoID09IG5pbCB0aGVuCiAgICAgICAgbm90ZS5sZW5ndGggPSBxdWFydGVyCiAgICBlbmQKICAgIHJldHVybiBub3RlCmVuZApmdW5jdGlvbiBwbGF5X25vdGUodmVoaWNsZSwgc29uZywgbm90ZSwgaW5kZXgpCiAgICBub3RlID0gZ2V0X25vdGUobm90ZSkKICAgIGxvY2FsIG5vdGVfcGxheXRpbWUgPSBtYXRoLmZsb29yKHNvbmcuYmVhdF9sZW5ndGggKiBub3RlLmxlbmd0aCkKICAgIGlmIG5vdGUucGl0Y2ggfj0gcmVzdCB0aGVuCiAgICAgICAgaG9ybl9vbiA9IHRydWUKICAgIGVuZAogICAgdXRpbC55aWVsZChub3RlX3BsYXl0aW1lKQogICAgaG9ybl9vbiA9IGZhbHNlCiAgICBpZiBzb25nLm5vdGVzW2luZGV4KzFdIH49IG5pbCB0aGVuCiAgICAgICAgbG9jYWwgbmV4dF9ub3RlID0gZ2V0X25vdGUoc29uZy5ub3Rlc1tpbmRleCsxXSkKICAgICAgICBpZiBuZXh0X25vdGUucGl0Y2ggfj0gcmVzdCB0aGVuCiAgICAgICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfTU9EKHZlaGljbGUsIE1PRF9IT1JOLCBuZXh0X25vdGUucGl0Y2gpCiAgICAgICAgZW5kCiAgICBlbmQKICAgIHV0aWwueWllbGQoc29uZy5iZWF0X2xlbmd0aCAtIG5vdGVfcGxheXRpbWUpCmVuZApmdW5jdGlvbiBwbGF5X3Nvbmcoc29uZykKICAgIHNvbmcuYmVhdF9sZW5ndGggPSBtYXRoLmZsb29yKDYwMDAwIC8gc29uZy5icG0pCiAgICBpZiBub3QgUEVELklTX1BFRF9JTl9BTllfVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlKSB0aGVuCiAgICAgICAgdXRpbC50b2FzdCgi5L2g5b+F6aG75Zyo6L2m5YaFLOWQpuWImeaXoOazleW8gOWQr+WWh+WPremfs+S5kC4iKQogICAgICAgIHJldHVybgogICAgZW5kCiAgICBsb2NhbCB2ZWhpY2xlID0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19JTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgIGlmIHZlaGljbGUgdGhlbgogICAgICAgIGxvY2FsIG9yaWdpbmFsX2hvcm4gPSBWRUhJQ0xFLkdFVF9WRUhJQ0xFX01PRCh2ZWhpY2xlLCBNT0RfSE9STikKICAgICAgICBwbGF5X25vdGUodmVoaWNsZSwgc29uZywgcmVzdCwgMCkKICAgICAgICBmb3IgaW5kZXgsIG5vdGUgaW4gcGFpcnMoc29uZy5ub3RlcykgZG8KICAgICAgICAgICAgcGxheV9ub3RlKHZlaGljbGUsIHNvbmcsIG5vdGUsIGluZGV4KQogICAgICAgIGVuZAogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfTU9EKHZlaGljbGUsIE1PRF9IT1JOLCBvcmlnaW5hbF9ob3JuKQogICAgZW5kCmVuZApmdW5jdGlvbiBsb2FkX2hvcm5fZnJvbV9maWxlKGZpbGVwYXRoKQogICAgbG9jYWwgZmlsZSA9IGlvLm9wZW4oZmlsZXBhdGgsICJyIikKICAgIGlmIGZpbGUgdGhlbgogICAgICAgIGxvY2FsIGRhdGEgPSBqc29uLmRlY29kZShmaWxlOnJlYWQoIiphIikpCiAgICAgICAgaWYgbm90IGRhdGEudGFyZ2V0X3ZlcnNpb24gdGhlbgogICAgICAgICAgICB1dGlsLnRvYXN0KCLml6DmlYjnmoTlloflj63mlofku7bmoLzlvI8iKQogICAgICAgICAgICByZXR1cm4gMAogICAgICAgIGVuZAogICAgICAgIGZpbGU6Y2xvc2UoKQogICAgICAgIHJldHVybiBkYXRhCiAgICBlbHNlCiAgICAgICAgZXJyb3IoIuaXoOazleivu+WPluaWh+S7tiIgLi4gZmlsZXBhdGgpCiAgICBlbmQKICAgIHJldHVybiAwCmVuZApmdW5jdGlvbiBsb2FkX3NvbmdzKGRpcmVjdG9yeSkKICAgIGxvY2FsIGxvYWRlZF9zb25ncyA9IHt9CiAgICBmb3IgXywgZmlsZXBhdGggaW4gaXBhaXJzKGZpbGVzeXN0ZW0ubGlzdF9maWxlcyhkaXJlY3RvcnkpKSBkbwogICAgICAgIGxvY2FsIGV4dCA9IHN0cmluZy5tYXRjaChmaWxlcGF0aCwgIi4rJS4oJXcrKSQiKQogICAgICAgIGlmIG5vdCBmaWxlc3lzdGVtLmlzX2RpcihmaWxlcGF0aCkgYW5kIGV4dCA9PSAiaG9ybiIgdGhlbgogICAgICAgICAgICBsb2NhbCB2YWwgPSBsb2FkX2hvcm5fZnJvbV9maWxlKGZpbGVwYXRoKQogICAgICAgICAgICBpZiB2YWwgfj0gMCB0aGVuIHRhYmxlLmluc2VydChsb2FkZWRfc29uZ3MsIHZhbCkgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIHJldHVybiBsb2FkZWRfc29uZ3MKZW5kCnV0aWwuY3JlYXRlX3RpY2tfaGFuZGxlcihmdW5jdGlvbigpCiAgICBpZiBob3JuX29uIHRoZW4KICAgICAgICBQQUQyLl9TRVRfQ09OVFJPTF9OT1JNQUwoMCwgODYsIDEpCiAgICBlbmQKICAgIHJldHVybiB0cnVlCmVuZCkKCgoKCi0tLS0t5riF55CG5a6e5L2TCmZ1bmN0aW9uIGNsZWFuX3NlbGVjdF9lbnRpdGllcyh2YWwpCiAgICBpZiB2YWwgPT0gMSB0aGVuCiAgICAgICAgZm9yIGssZW50IGluIHBhaXJzKGVudGl0aWVzLmdldF9hbGxfcGVkc19hc19oYW5kbGVzKCkpIGRvCiAgICAgICAgICAgIGlmIG5vdCBQRUQuSVNfUEVEX0FfUExBWUVSKGVudCkgdGhlbgogICAgICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQVNfTUlTU0lPTl9FTlRJVFkoZW50LCBmYWxzZSwgZmFsc2UpCiAgICAgICAgICAgICAgICBkZWxldGVfZW50aXR5KGVudCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICAgICAgdXRpbC50b2FzdCgiTlBD5riF6Zmk5a6M5oiQIikKICAgICAgICByZXR1cm4KICAgIGVuZAogICAgaWYgdmFsID09IDIgdGhlbgogICAgICAgIGZvciBrLCBlbnQgaW4gcGFpcnMoZW50aXRpZXMuZ2V0X2FsbF92ZWhpY2xlc19hc19oYW5kbGVzKCkpIGRvCiAgICAgICAgICAgIGxvY2FsIFBlZEluU2VhdCA9IFZFSElDTEUuR0VUX1BFRF9JTl9WRUhJQ0xFX1NFQVQoZW50LCAtMSwgZmFsc2UpCiAgICAgICAgICAgIGlmIG5vdCBQRUQuSVNfUEVEX0FfUExBWUVSKFBlZEluU2VhdCkgdGhlbgogICAgICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQVNfTUlTU0lPTl9FTlRJVFkoZW50LCBmYWxzZSwgZmFsc2UpCiAgICAgICAgICAgICAgICBkZWxldGVfZW50aXR5KGVudCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICAgICAgdXRpbC50b2FzdCgi6L295YW35riF6Zmk5a6M5oiQIikKICAgICAgICByZXR1cm4KICAgIGVuZAogICAgaWYgdmFsID09IDMgdGhlbgogICAgICAgIGZvciBrLGVudCBpbiBwYWlycyhlbnRpdGllcy5nZXRfYWxsX29iamVjdHNfYXNfaGFuZGxlcygpKSBkbwogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9BU19NSVNTSU9OX0VOVElUWShlbnQsIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgZGVsZXRlX2VudGl0eShlbnQpCiAgICAgICAgZW5kCiAgICAgICAgdXRpbC50b2FzdCgi54mp5L2T5bey5riF6ZmkIikKICAgICAgICByZXR1cm4KICAgIGVuZAogICAgaWYgdmFsID09IDQgdGhlbgogICAgICAgIGZvciBrLGVudCBpbiBwYWlycyhlbnRpdGllcy5nZXRfYWxsX3BpY2t1cHNfYXNfaGFuZGxlcygpKSBkbwogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9BU19NSVNTSU9OX0VOVElUWShlbnQsIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgZGVsZXRlX2VudGl0eShlbnQpCiAgICAgICAgZW5kCiAgICAgICAgdXRpbC50b2FzdCgi5ou+5Y+W54mp5bey5riF6ZmkIikKICAgICAgICByZXR1cm4KICAgIGVuZAogICAgaWYgdmFsID09IDUgdGhlbgogICAgICAgIGxvY2FsIHRlbXAgPSBtZW1vcnkuYWxsb2MoNCkKICAgICAgICBmb3IgaSA9IDAsIDEwMCBkbwogICAgICAgICAgICBtZW1vcnkud3JpdGVfaW50KHRlbXAsIGkpCiAgICAgICAgICAgIFBIWVNJQ1MuREVMRVRFX1JPUEUodGVtcCkKICAgICAgICBlbmQKICAgICAgICB1dGlsLnRvYXN0KCLnu7PntKLlt7LmuIXpmaQiKQogICAgICAgIHJldHVybgogICAgZW5kCiAgICBpZiB2YWwgPT0gNiB0aGVuCiAgICAgICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKQogICAgICAgIE1JU0MuQ0xFQVJfQVJFQV9PRl9QUk9KRUNUSUxFUyhwb3MueCwgcG9zLnksIHBvcy56LCA0MDAsIDApCiAgICAgICAgdXRpbC50b2FzdCgi5oqV5o6354mp5bey5riF6ZmkIikKICAgICAgICByZXR1cm4KICAgIGVuZAogICAgaWYgdmFsID09IDcgdGhlbgogICAgICAgIENBTS5ERVNUUk9ZX0FMTF9DQU1TKHRydWUpCiAgICAgICAgdXRpbC50b2FzdCgi55u45py65bey5riF6ZmkIikKICAgICAgICByZXR1cm4KICAgIGVuZAplbmQKLS0tLS0t5pmu6YCa5riF6ZmkCmZ1bmN0aW9uIE5vcm1hbF9jbGVhcmFuY2UoKQogICAgbG9jYWwgY3QgPSAwCiAgICBmb3IgayxlbnQgaW4gcGFpcnMoZW50aXRpZXMuZ2V0X2FsbF92ZWhpY2xlc19hc19oYW5kbGVzKCkpIGRvCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQVNfTUlTU0lPTl9FTlRJVFkoZW50LCBmYWxzZSwgZmFsc2UpCiAgICAgICAgZGVsZXRlX2VudGl0eShlbnQpCiAgICAgICAgY3QgPSBjdCArIDEKICAgIGVuZAogICAgZm9yIGssZW50IGluIHBhaXJzKGVudGl0aWVzLmdldF9hbGxfcGVkc19hc19oYW5kbGVzKCkpIGRvCiAgICAgICAgaWYgbm90IFBFRC5JU19QRURfQV9QTEFZRVIoZW50KSB0aGVuCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0FTX01JU1NJT05fRU5USVRZKGVudCwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICBkZWxldGVfZW50aXR5KGVudCkKICAgICAgICBlbmQKICAgICAgICAgICAgY3QgPSBjdCArIDEKICAgICAgICBlbmQKZW5kCi0tLS0t6LaF57qn5riF6ZmkCmZ1bmN0aW9uIHN1cGVyX2NsZWFyKCkKICAgIGxvY2FsIGNsZWFuc2VfZW50aXR5Y291bnQgPSAwCiAgICBmb3IgXywgcGVkIGluIHBhaXJzKGVudGl0aWVzLmdldF9hbGxfcGVkc19hc19oYW5kbGVzKCkpIGRvCiAgICAgICAgaWYgcGVkIH49IFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkgYW5kIG5vdCBQRUQuSVNfUEVEX0FfUExBWUVSKHBlZCkgYW5kIE5FVFdPUksuTkVUV09SS19IQVNfQ09OVFJPTF9PRl9FTlRJVFkocGVkKSBhbmQgKG5vdCBORVRXT1JLLk5FVFdPUktfSVNfQUNUSVZJVFlfU0VTU0lPTigpIG9yIE5FVFdPUksuTkVUV09SS19JU19BQ1RJVklUWV9TRVNTSU9OKCkgYW5kIG5vdCBFTlRJVFkuSVNfRU5USVRZX0FfTUlTU0lPTl9FTlRJVFkocGVkKSkgdGhlbgogICAgICAgICAgICBkZWxldGVfZW50aXR5KHBlZCkKICAgICAgICAgICAgY2xlYW5zZV9lbnRpdHljb3VudCA9IGNsZWFuc2VfZW50aXR5Y291bnQgKyAxCiAgICAgICAgICAgIHV0aWwueWllbGQoKQogICAgICAgIGVuZAogICAgZW5kCiAgICB1dGlsLnRvYXN0KCLlt7LmuIXpmaQgIiAuLiBjbGVhbnNlX2VudGl0eWNvdW50IC4uICIgUGVkcyIpCiAgICBjbGVhbnNlX2VudGl0eWNvdW50ID0gMAogICAgZm9yIF8sIHZlaGljbGUgaW4gaXBhaXJzKGVudGl0aWVzLmdldF9hbGxfdmVoaWNsZXNfYXNfaGFuZGxlcygpKSBkbwogICAgICAgIGlmIHZlaGljbGUgfj0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19JTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkgYW5kIERFQ09SQVRPUi5ERUNPUl9HRVRfSU5UKHZlaGljbGUsICJQbGF5ZXJfVmVoaWNsZSIpID09IDAgYW5kIE5FVFdPUksuTkVUV09SS19IQVNfQ09OVFJPTF9PRl9FTlRJVFkodmVoaWNsZSkgdGhlbgogICAgICAgICAgICBkZWxldGVfZW50aXR5KHZlaGljbGUpCiAgICAgICAgICAgIGNsZWFuc2VfZW50aXR5Y291bnQgPSBjbGVhbnNlX2VudGl0eWNvdW50ICsgMQogICAgICAgICAgICB1dGlsLnlpZWxkKCkKICAgICAgICBlbmQKICAgIGVuZAogICAgdXRpbC50b2FzdCgi5bey5riF6ZmkICIuLiBjbGVhbnNlX2VudGl0eWNvdW50IC4uIiDovb3lhbciKQogICAgY2xlYW5zZV9lbnRpdHljb3VudCA9IDAKICAgIGZvciBfLCBvYmplY3QgaW4gcGFpcnMoZW50aXRpZXMuZ2V0X2FsbF9vYmplY3RzX2FzX2hhbmRsZXMoKSkgZG8KICAgICAgICBkZWxldGVfZW50aXR5KG9iamVjdCkKICAgICAgICBjbGVhbnNlX2VudGl0eWNvdW50ID0gY2xlYW5zZV9lbnRpdHljb3VudCArIDEKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAogICAgdXRpbC50b2FzdCgi5bey5riF6ZmkICIgLi4gY2xlYW5zZV9lbnRpdHljb3VudCAuLiAiIOeJqeS9kyIpCiAgICBjbGVhbnNlX2VudGl0eWNvdW50ID0gMAogICAgZm9yIF8sIHBpY2t1cCBpbiBwYWlycyhlbnRpdGllcy5nZXRfYWxsX3BpY2t1cHNfYXNfaGFuZGxlcygpKSBkbwogICAgICAgIGRlbGV0ZV9lbnRpdHkocGlja3VwKQogICAgICAgIGNsZWFuc2VfZW50aXR5Y291bnQgPSBjbGVhbnNlX2VudGl0eWNvdW50ICsgMQogICAgICAgIHV0aWwueWllbGQoKQogICAgZW5kCiAgICB1dGlsLnRvYXN0KCLlt7LmuIXpmaQgIiAuLiBjbGVhbnNlX2VudGl0eWNvdW50IC4uICIg5Y+v5ou+5Y+W54mp5L2TIikKICAgIGxvY2FsIHRlbXAgPSBtZW1vcnkuYWxsb2MoNCkKICAgIGZvciBpID0gMCwgMTAwIGRvCiAgICAgICAgbWVtb3J5LndyaXRlX2ludCh0ZW1wLCBpKQogICAgICAgIFBIWVNJQ1MuREVMRVRFX1JPUEUodGVtcCkKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAogICAgdXRpbC50b2FzdCgi5bey5riF6Zmk5omA5pyJ57uz57SiIikKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgTUlTQy5DTEVBUl9BUkVBX09GX1BST0pFQ1RJTEVTKHBvcy54LCBwb3MueSwgcG9zLnosIDQwMCwgMCkKICAgIHV0aWwudG9hc3QoIuW3sua4hemZpOaJgOacieaKleaOt+eJqSIpCiAgICBDQU0uREVTVFJPWV9BTExfQ0FNUyh0cnVlKQogICAgdXRpbC50b2FzdCgi5bey5riF6Zmk5omA5pyJ55u45py6IikKZW5kCgoKLS0tLS3lnKjnjqnlrrbouqvkuIrkuIvpm6gKZnVuY3Rpb24gRGVsY2FyKHZpYykKICAgIGlmIFBFRC5JU19QRURfSU5fQU5ZX1ZFSElDTEUodmljKSA9PXRydWUgdGhlbgogICAgICAgIGxvY2FsIHRhcmNhciA9IFBFRC5HRVRfVkVISUNMRV9QRURfSVNfSU4odmljLCB0cnVlKQogICAgICAgIE5FVFdPUksuTkVUV09SS19SRVFVRVNUX0NPTlRST0xfT0ZfRU5USVRZKHRhcmNhcikKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9BU19NSVNTSU9OX0VOVElUWSh0YXJjYXIpCiAgICAgICAgZGVsZXRlX2VudGl0eSh0YXJjYXIpCiAgICBlbmQKZW5kCmxvY2FsIG1pciA9IHt3ZWFwID0gJ1dFQVBPTl9TTk9XQkFMTCd9CmZ1bmN0aW9uIFJhaW5fb25fcGxheWVycyhwaWQpCiAgICAKICAgIGxvY2FsIHRhcmdldHMgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKQogICAgbG9jYWwgdGFyMSA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyh0YXJnZXRzLCB0cnVlKQogICAgbG9jYWwgd2VhcCA9IHV0aWwuam9hYXQobWlyLndlYXApCiAgICBEZWxjYXIodGFyZ2V0cykKICAgIFdFQVBPTi5SRVFVRVNUX1dFQVBPTl9BU1NFVCh3ZWFwKQogICAgTUlTQy5TSE9PVF9TSU5HTEVfQlVMTEVUX0JFVFdFRU5fQ09PUkRTKHRhcjEueCwgdGFyMS55LCB0YXIxLnosIHRhcjEueCAsIHRhcjEueSwgdGFyMS56IC0gMi4wLCAyMDAsIDAsIHdlYXAsIDAsIHRydWUsIGZhbHNlLCAxMDAwKQogICAgTUlTQy5TSE9PVF9TSU5HTEVfQlVMTEVUX0JFVFdFRU5fQ09PUkRTKHRhcjEueCwgdGFyMS55LCB0YXIxLnogKyAxLjAsIHRhcjEueCAsIHRhcjEueSwgdGFyMS56LCAyMDAsIDAsIHdlYXAsIDAsIHRydWUsIGZhbHNlLCAxMDAwKQogICAgTUlTQy5TSE9PVF9TSU5HTEVfQlVMTEVUX0JFVFdFRU5fQ09PUkRTKHRhcjEueCwgdGFyMS55ICsgMS4wLCB0YXIxLnosIHRhcjEueCAsIHRhcjEueSwgdGFyMS56LCAyMDAsIDAsIHdlYXAsIDAsIHRydWUsIGZhbHNlLCAxMDAwKQogICAgTUlTQy5TSE9PVF9TSU5HTEVfQlVMTEVUX0JFVFdFRU5fQ09PUkRTKHRhcjEueCArIDEuMCwgdGFyMS55ICwgdGFyMS56LCB0YXIxLnggLCB0YXIxLnksIHRhcjEueiwgMjAwLCAwLCB3ZWFwLCAwLCB0cnVlLCBmYWxzZSwgMTAwMCkKICAgIE1JU0MuU0hPT1RfU0lOR0xFX0JVTExFVF9CRVRXRUVOX0NPT1JEUyh0YXIxLnggKyAxLjAsIHRhcjEueSArIDEuMCwgdGFyMS56LCB0YXIxLnggLCB0YXIxLnksIHRhcjEueiwgMjAwLCAwLCB3ZWFwLCAwLCB0cnVlLCBmYWxzZSwgMTAwMCkKICAgIE1JU0MuU0hPT1RfU0lOR0xFX0JVTExFVF9CRVRXRUVOX0NPT1JEUyh0YXIxLnggLSAxLjAsIHRhcjEueSwgdGFyMS56LCB0YXIxLnggLCB0YXIxLnksIHRhcjEueiwgMjAwLCAwLCB3ZWFwLCAwLCB0cnVlLCBmYWxzZSwgMTAwMCkKICAgIE1JU0MuU0hPT1RfU0lOR0xFX0JVTExFVF9CRVRXRUVOX0NPT1JEUyh0YXIxLngsIHRhcjEueSAtIDEuMCwgdGFyMS56LCB0YXIxLnggLCB0YXIxLnksIHRhcjEueiwgMjAwLCAwLCB3ZWFwLCAwLCB0cnVlLCBmYWxzZSwgMTAwMCkKICAgIE1JU0MuU0hPT1RfU0lOR0xFX0JVTExFVF9CRVRXRUVOX0NPT1JEUyh0YXIxLnggLSAxLjAsIHRhcjEueSAtIDEuMCwgdGFyMS56LCB0YXIxLnggLCB0YXIxLnksIHRhcjEueiwgMjAwLCAwLCB3ZWFwLCAwLCB0cnVlLCBmYWxzZSwgMTAwMCkKZW5kCmZ1bmN0aW9uIFJhaW5fb25fcGxheWVyc190eXBlKHdlYXBzZWwsIHRleHQpCiAgICBtaXIud2VhcCA9IFdlYXBbd2VhcHNlbF0KICAgIG1lbnUuc2V0X21lbnVfbmFtZShtaXJsb29wLCAn5Zyo546p5a626Lqr5LiK5LiL6ZuoICcgLi4nOiAnLi4gdGV4dCkKZW5kCgoKLS0tLS3lnoLnm7TloIblj6AKZnVuY3Rpb24gZ2V0X21vZGVsX3NpemUoaGFzaCkKICAgIGxvY2FsIG1pbnB0ciA9IG1lbW9yeS5hbGxvYygyNCkKICAgIGxvY2FsIG1heHB0ciA9IG1lbW9yeS5hbGxvYygyNCkKICAgIE1JU0MuR0VUX01PREVMX0RJTUVOU0lPTlMoaGFzaCwgbWlucHRyLCBtYXhwdHIpCiAgICBsb2NhbCBtaW4gPSBtZW1vcnkucmVhZF92ZWN0b3IzKG1pbnB0cikKICAgIGxvY2FsIG1heCA9IG1lbW9yeS5yZWFkX3ZlY3RvcjMobWF4cHRyKQogICAgbG9jYWwgc2l6ZSA9IHt9CiAgICBzaXplWyd4J10gPSBtYXhbJ3gnXSAtIG1pblsneCddCiAgICBzaXplWyd5J10gPSBtYXhbJ3knXSAtIG1pblsneSddCiAgICBzaXplWyd6J10gPSBtYXhbJ3onXSAtIG1pblsneiddCiAgICBzaXplWydtYXgnXSA9IG1hdGgubWF4KHNpemVbJ3gnXSwgc2l6ZVsneSddLCBzaXplWyd6J10pCiAgICByZXR1cm4gc2l6ZQplbmQKZnVuY3Rpb24gc2V0c3RhY2t5KHMpCiAgICBsb2NhbCBwbGF5ZXJfY3VyX2NhciA9IGVudGl0aWVzLmdldF91c2VyX3ZlaGljbGVfYXNfaGFuZGxlKCkKICAgIGlmIHBsYXllcl9jdXJfY2FyIH49IDAgdGhlbgogICAgICAgIG9sZF92ZWggPSBwbGF5ZXJfY3VyX2NhcgogICAgICAgIGZvciBpPTEsIHMgZG8KICAgICAgICAgICAgbG9jYWwgYyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhvbGRfdmVoLCBmYWxzZSkKICAgICAgICAgICAgbG9jYWwgbWRsID0gRU5USVRZLkdFVF9FTlRJVFlfTU9ERUwocGxheWVyX2N1cl9jYXIpCiAgICAgICAgICAgIGxvY2FsIHNpemUgPSBnZXRfbW9kZWxfc2l6ZShtZGwpCiAgICAgICAgICAgIGxvY2FsIHIgPSBFTlRJVFkuR0VUX0VOVElUWV9ST1RBVElPTihvbGRfdmVoLCAwKQogICAgICAgICAgICBuZXdfdmVoID0gZW50aXRpZXMuY3JlYXRlX3ZlaGljbGUobWRsLCBwbGF5ZXJzLmdldF9wb3NpdGlvbihQTEFZRVIuUExBWUVSX0lEKCkpLCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKG9sZF92ZWgpKQogICAgICAgICAgICBFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkobmV3X3ZlaCwgb2xkX3ZlaCwgMCwgMC4wLCAwLjAsIHNpemUueiwgMC4wLCAwLjAsIDAuMCwgdHJ1ZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgMCwgdHJ1ZSwgMCkKICAgICAgICAgICAgb2xkX3ZlaCA9IG5ld192ZWgKICAgICAgICBlbmQKICAgIGVuZAplbmQKLS0tLeawtOW5s+WghuWPoApmdW5jdGlvbiBzZXRzdGFja3gocykKICAgIGxvY2FsIHBsYXllcl9jdXJfY2FyID0gZW50aXRpZXMuZ2V0X3VzZXJfdmVoaWNsZV9hc19oYW5kbGUoKQogICAgaWYgcGxheWVyX2N1cl9jYXIgfj0gMCB0aGVuCiAgICAgICAgZm9yIGk9MSwgcyBkbwogICAgICAgICAgICBtYWluX3ZlaCA9IHBsYXllcl9jdXJfY2FyCiAgICAgICAgICAgIGxvY2FsIGMgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMobWFpbl92ZWgsIGZhbHNlKQogICAgICAgICAgICBsb2NhbCBtZGwgPSBFTlRJVFkuR0VUX0VOVElUWV9NT0RFTChtYWluX3ZlaCkKICAgICAgICAgICAgbG9jYWwgc2l6ZSA9IGdldF9tb2RlbF9zaXplKG1kbCkKICAgICAgICAgICAgbG9jYWwgciA9IEVOVElUWS5HRVRfRU5USVRZX1JPVEFUSU9OKG1haW5fdmVoLCAwKQogICAgICAgICAgICBsZWZ0X25ldyA9IGVudGl0aWVzLmNyZWF0ZV92ZWhpY2xlKG1kbCwgcGxheWVycy5nZXRfcG9zaXRpb24oUExBWUVSLlBMQVlFUl9JRCgpKSwgRU5USVRZLkdFVF9FTlRJVFlfSEVBRElORyhtYWluX3ZlaCkpCiAgICAgICAgICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWShsZWZ0X25ldywgbWFpbl92ZWgsIDAsIC1zaXplLngqaSwgMC4wLCAwLjAsIDAuMCwgMC4wLCAwLjAsIHRydWUsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDAsIHRydWUsIDApCiAgICAgICAgICAgIHJpZ2h0X25ldyA9IGVudGl0aWVzLmNyZWF0ZV92ZWhpY2xlKG1kbCwgcGxheWVycy5nZXRfcG9zaXRpb24oUExBWUVSLlBMQVlFUl9JRCgpKSwgRU5USVRZLkdFVF9FTlRJVFlfSEVBRElORyhtYWluX3ZlaCkpCiAgICAgICAgICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWShyaWdodF9uZXcsIG1haW5fdmVoLCAwLCBzaXplLngqaSwgMC4wLCAwLjAsIDAuMCwgMC4wLCAwLjAsIHRydWUsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDAsIHRydWUsIDApCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgoKLS0tLS0tLS3mipvmjrfovb3lhbcKZnVuY3Rpb24gdGhyb3dfdmVocyh0b2dnbGVkKQogICAgbG9jYWwgaGFuZHNfdXAgPSBub3QgdG9nZ2xlZAogICAgbG9jYWwgZW50aXR5X2hlbGQgPSAwCiAgICB0aHJvd192ZWhzX3RvZ2dsZWQgPSB0b2dnbGVkCiAgICB3aGlsZSB0aHJvd192ZWhzX3RvZ2dsZWQgZG8KICAgICAgICBpZiBQQUQuSVNfRElTQUJMRURfQ09OVFJPTF9KVVNUX1BSRVNTRUQoMCwgMzgpIGFuZCBub3QgUEVELklTX1BFRF9JTl9BTllfVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlKSAgdGhlbgogICAgICAgICAgICBpZiBub3QgaGFuZHNfdXAgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgdmVoID0gZ2V0X2Nsb3Nlc3RfdmVoaWNsZShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCA1KQogICAgICAgICAgICAgICAgaWYgRU5USVRZLklTX0VOVElUWV9BX1ZFSElDTEUodmVoKSB0aGVuIAogICAgICAgICAgICAgICAgICAgIHJlcXVlc3RfYW5pbV9kaWN0KCJtaXNzbWludXRlbWFuXzFpZ18yIikKICAgICAgICAgICAgICAgICAgICBUQVNLLlRBU0tfUExBWV9BTklNKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksICJtaXNzbWludXRlbWFuXzFpZ18yIiwgImhhbmRzdXBfZW50ZXIiLCA4LjAsIDAuMCwgLTEsIDUwLCAwLCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICAgICAgICAgIHV0aWwueWllbGQoNTAwKQogICAgICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0FMUEhBKHZlaCwgMTAwKQogICAgICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0hFQURJTkcodmVoLCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpKQogICAgICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0lOVklOQ0lCTEUodmVoLCB0cnVlKQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3RfY29udHJvbCh2ZWgpCiAgICAgICAgICAgICAgICAgICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKHZlaCwgUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMCwgMCwgMCwgZ2V0X21vZGVsX3NpemUoRU5USVRZLkdFVF9FTlRJVFlfTU9ERUwodmVoKSkueiAvIDIsIDE4MCwgMTgwLCAtMTgwLCB0cnVlLCBmYWxzZSwgdHJ1ZSwgZmFsc2UsIDAsIHRydWUsIDApCiAgICAgICAgICAgICAgICAgICAgaGFuZHNfdXAgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgZW50aXR5X2hlbGQgPSB2ZWgKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBpZiBFTlRJVFkuRE9FU19FTlRJVFlfRVhJU1QoZW50aXR5X2hlbGQpIHRoZW4KICAgICAgICAgICAgICAgICAgICBFTlRJVFkuREVUQUNIX0VOVElUWShlbnRpdHlfaGVsZCkKICAgICAgICAgICAgICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0ZPUldBUkRfU1BFRUQoZW50aXR5X2hlbGQsIDEwMC4wKQogICAgICAgICAgICAgICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfT1VUX09GX0NPTlRST0woZW50aXR5X2hlbGQsIHRydWUsIHRydWUpCiAgICAgICAgICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQUxQSEEoZW50aXR5X2hlbGQsIDI1NSkKICAgICAgICAgICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKGVudGl0eV9oZWxkLCBmYWxzZSkKICAgICAgICAgICAgICAgICAgICBUQVNLLkNMRUFSX1BFRF9UQVNLU19JTU1FRElBVEVMWShQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgICAgICAgICAgICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUpCiAgICAgICAgICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfTk9fQ09MTElTSU9OX0VOVElUWShlbnRpdHlfaGVsZCwgUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdF9hbmltX2RpY3QoIm1lbGVlQHVuYXJtZWRAc3RyZWFtZWRfY29yZSIpCiAgICAgICAgICAgICAgICAgICAgVEFTSy5UQVNLX1BMQVlfQU5JTShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAibWVsZWVAdW5hcm1lZEBzdHJlYW1lZF9jb3JlIiwgImhlYXZ5X3B1bmNoX2EiLCA4LjAsIDguMCwgLTEsIDAsIDAuMywgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgICAgICAgICB1dGlsLnlpZWxkKDUwMCkKICAgICAgICAgICAgICAgICAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgICAgICAgICAgICAgICAgICBlbnRpdHlfaGVsZCA9IDAKICAgICAgICAgICAgICAgICAgICBoYW5kc191cCA9IGZhbHNlCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgaGFuZHNfdXAgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIGVudGl0eV9oZWxkID0gMAogICAgICAgICAgICAgICAgICAgIFRBU0suQ0xFQVJfUEVEX1RBU0tTX0lNTUVESUFURUxZKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICAgICAgdXRpbC55aWVsZCgpCiAgICBlbmQKZW5kCgoKCi0tLS0tLeaKm+aOt05QQwpmdW5jdGlvbiB0aHJvd19wZWRzKHRvZ2dsZWQpCiAgICBsb2NhbCBoYW5kc191cCA9IG5vdCB0b2dnbGVkCiAgICBsb2NhbCBlbnRpdHlfaGVsZCA9IDAKICAgIHRocm93X3BlZHNfdG9nZ2xlZCA9IHRvZ2dsZWQKICAgIHdoaWxlIHRocm93X3BlZHNfdG9nZ2xlZCBkbwogICAgICAgIGlmIFBBRC5JU19DT05UUk9MX0pVU1RfUkVMRUFTRUQoMzgsIDM4KSBhbmQgbm90IFBFRC5JU19QRURfSU5fQU5ZX1ZFSElDTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSkgdGhlbgogICAgICAgICAgICBpZiBlbnRpdHlfaGVsZCA9PSAwIHRoZW4KICAgICAgICAgICAgICAgIGlmIG5vdCBoYW5kc191cCB0aGVuIAogICAgICAgICAgICAgICAgICAgIGxvY2FsIHBlZCA9IGdldF9jbG9zZXN0X3BlZChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCA1KQogICAgICAgICAgICAgICAgICAgIGlmIHBlZCB+PSBuaWwgYW5kIG5vdCBQRUQuSVNfUEVEX0lOX0FOWV9WRUhJQ0xFKHBlZCwgdHJ1ZSkgYW5kIEVOVElUWS5HRVRfRU5USVRZX0hFQUxUSChwZWQpIH49IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBjYWxtX3BlZChwZWQsIHRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3RfYW5pbV9kaWN0KCJtaXNzbWludXRlbWFuXzFpZ18yIikKICAgICAgICAgICAgICAgICAgICAgICAgVEFTSy5UQVNLX1BMQVlfQU5JTShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAibWlzc21pbnV0ZW1hbl8xaWdfMiIsICJoYW5kc3VwX2VudGVyIiwgOC4wLCAwLjAsIC0xLCA1MCwgMCwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgICAgICAgICAgICAgdXRpbC55aWVsZCg1MDApCiAgICAgICAgICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0FMUEhBKHBlZCwgMTAwKQogICAgICAgICAgICAgICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9IRUFMVEgocGVkLCAzMDAsIDApCiAgICAgICAgICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0hFQURJTkcocGVkLCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpKQogICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0X2NvbnRyb2wocGVkKQogICAgICAgICAgICAgICAgICAgICAgICBFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkocGVkLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwLCAwLCAwLCAxLjMsIDE4MCwgMTgwLCAtMTgwLCB0cnVlLCBmYWxzZSwgdHJ1ZSwgdHJ1ZSwgMCwgdHJ1ZSwgMCkKICAgICAgICAgICAgICAgICAgICAgICAgZW50aXR5X2hlbGQgPSBwZWQKICAgICAgICAgICAgICAgICAgICAgICAgaGFuZHNfdXAgPSB0cnVlCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgaWYgRU5USVRZLklTX0VOVElUWV9BX1BFRChlbnRpdHlfaGVsZCkgdGhlbgogICAgICAgICAgICAgICAgICAgIEVOVElUWS5ERVRBQ0hfRU5USVRZKGVudGl0eV9oZWxkKQogICAgICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0FMUEhBKGVudGl0eV9oZWxkLCAyNTUpCiAgICAgICAgICAgICAgICAgICAgUEVELlNFVF9QRURfVE9fUkFHRE9MTChlbnRpdHlfaGVsZCwgMTAsIDEwLCAwLCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICAgICAgICAgIC0tRU5USVRZLlNFVF9FTlRJVFlfVkVMT0NJVFkoZW50aXR5X2hlbGQsIDAsIDEwMCwgMCkKICAgICAgICAgICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9NQVhfU1BFRUQoZW50aXR5X2hlbGQsIDEwMC4wKQogICAgICAgICAgICAgICAgICAgIEVOVElUWS5BUFBMWV9GT1JDRV9UT19FTlRJVFkoZW50aXR5X2hlbGQsIDEsIDAsIDEwMCwgMCwgMCwgMCwgMCwgMCwgdHJ1ZSwgZmFsc2UsIHRydWUsIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgICAgICAgICBBVURJTy5QTEFZX1BBSU4oZW50aXR5X2hlbGQsIDcsIDAsIDApCiAgICAgICAgICAgICAgICAgICAgVEFTSy5DTEVBUl9QRURfVEFTS1NfSU1NRURJQVRFTFkoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgICAgICAgICAgICAgICAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlKQogICAgICAgICAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX05PX0NPTExJU0lPTl9FTlRJVFkoZW50aXR5X2hlbGQsIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKQogICAgICAgICAgICAgICAgICAgIHJlcXVlc3RfYW5pbV9kaWN0KCJtZWxlZUB1bmFybWVkQHN0cmVhbWVkX2NvcmUiKQogICAgICAgICAgICAgICAgICAgIFRBU0suVEFTS19QTEFZX0FOSU0oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgIm1lbGVlQHVuYXJtZWRAc3RyZWFtZWRfY29yZSIsICJoZWF2eV9wdW5jaF9hIiwgOC4wLCA4LjAsIC0xLCAwLCAwLjMsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgICAgICAgICAgICAgdXRpbC55aWVsZCg1MDApCiAgICAgICAgICAgICAgICAgICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpCiAgICAgICAgICAgICAgICAgICAgZW50aXR5X2hlbGQgPSAwCiAgICAgICAgICAgICAgICAgICAgaGFuZHNfdXAgPSBmYWxzZQogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGhhbmRzX3VwID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICBlbnRpdHlfaGVsZCA9IDAKICAgICAgICAgICAgICAgICAgICBUQVNLLkNMRUFSX1BFRF9UQVNLU19JTU1FRElBVEVMWShQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIHV0aWwueWllbGQoKQogICAgZW5kCmVuZAoKCi0tLS0tLS3lj7jmnLrmnI3liqEKbG9jYWwgdGF4aV9wZWQgPSAwCmxvY2FsIHRheGlfdmVoID0gMApsb2NhbCB0YXhpX2JsaXAgPSAtMQpmdW5jdGlvbiBtYXhfb3V0X2Nhcih2ZWgpCiAgICBmb3IgaT0wLCA0OSBkbwogICAgICAgIG51bSA9IFZFSElDTEUuR0VUX05VTV9WRUhJQ0xFX01PRFModmVoLCBpKQogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfTU9EKHZlaCwgaSwgbnVtIC0xLCB0cnVlKQogICAgZW5kCmVuZApmdW5jdGlvbiBzdW1tX2NhcihpbmRleCwgdmFsdWUpCiAgICBsb2NhbCB2aGFzaCA9IHV0aWwuam9hYXQodmFsdWUpCiAgICBsb2NhbCBwaGFzaCA9IHV0aWwuam9hYXQoInNfbV95X2Nhc2lub18wMSIpCiAgICBpZiB0YXhpX3ZlaCB+PSAwIHRoZW4KICAgICAgICBkZWxldGVfZW50aXR5KHRheGlfdmVoKQogICAgZW5kCiAgICBpZiB0YXhpX3BlZCB+PSAwIHRoZW4KICAgICAgICB1dGlsLnJlbW92ZV9ibGlwKHRheGlfYmxpcCkKICAgICAgICBkZWxldGVfZW50aXR5KHRheGlfcGVkKQogICAgZW5kIAogICAgbG9jYWwgcGx5ciA9IFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkKICAgIGxvY2FsIGNvb3JkcyA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhwbHlyLCAwLjAsIDUuMCwgMC4wKQogICAgcmVxdWVzdF9tb2RlbCh2aGFzaCkKICAgIHJlcXVlc3RfbW9kZWwocGhhc2gpCiAgICB0YXhpX3ZlaCA9IGVudGl0aWVzLmNyZWF0ZV92ZWhpY2xlKHZoYXNoLCBjb29yZHMsIEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcocGx5cikpCiAgICBtYXhfb3V0X2Nhcih0YXhpX3ZlaCkKICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfTlVNQkVSX1BMQVRFX1RFWFQodGF4aV92ZWgsICJMQU5DRSIpCiAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0NPTE9VUlModGF4aV92ZWgsIDE0NSwgMTQ1KQogICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRSh0YXhpX3ZlaCwgdHJ1ZSkKICAgIHRheGlfcGVkID0gZW50aXRpZXMuY3JlYXRlX3BlZCgzMiwgcGhhc2gsIGNvb3JkcywgRU5USVRZLkdFVF9FTlRJVFlfSEVBRElORyhwbHlyKSkKICAgIFBFRC5TRVRfUEVEX1JFTEFUSU9OU0hJUF9HUk9VUF9IQVNIKHRheGlfcGVkLCB1dGlsLmpvYWF0KCJyZ0ZNX0FpTGlrZSIpKQogICAgdGF4aV9ibGlwID0gSFVELkFERF9CTElQX0ZPUl9FTlRJVFkodGF4aV9wZWQpCiAgICBIVUQuU0VUX0JMSVBfQ09MT1VSKHRheGlfYmxpcCwgNykKICAgIEVOVElUWS5TRVRfRU5USVRZX0lOVklOQ0lCTEUodGF4aV9wZWQsIHRydWUpCiAgICBQRUQuU0VUX0JMT0NLSU5HX09GX05PTl9URU1QT1JBUllfRVZFTlRTKHRheGlfcGVkLCB0cnVlKQogICAgUEVELlNFVF9QRURfRkxFRV9BVFRSSUJVVEVTKHRheGlfcGVkLCAwLCBmYWxzZSkKICAgIFBFRC5TRVRfUEVEX0NBTl9CRV9EUkFHR0VEX09VVCh0YXhpX3BlZCwgZmFsc2UpCiAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0VYQ0xVU0lWRV9EUklWRVIodGF4aV92ZWgsIHRheGlfcGVkLCAtMSkKICAgIFBFRC5TRVRfUEVEX0lOVE9fVkVISUNMRSh0YXhpX3BlZCwgdGF4aV92ZWgsIC0xKQogICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRSh0YXhpX3BlZCwgdHJ1ZSkKICAgIFBFRC5TRVRfUEVEX0lOVE9fVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0YXhpX3ZlaCwgMCkKICAgIHV0aWwudG9hc3QoIuaCqOeahOWPuOacuuW3suWIm+W7uu+8gSIpCmVuZApmdW5jdGlvbiBzdW1tX2Nhcl90b3BvaW50KCkKICAgIGlmIHRheGlfcGVkID09IDAgdGhlbgogICAgICAgIHV0aWwudG9hc3QoIuS9oOayoeacieeUn+aIkOWPuOacuiIpCiAgICBlbHNlCiAgICAgICAgbG9jYWwgZ290b19jb29yZHMgPSBnZXRfd2F5cG9pbnRfY29vcmRzKCkKICAgICAgICBpZiBnb3RvX2Nvb3JkcyB+PSBuaWwgdGhlbgogICAgICAgICAgICBUQVNLLlRBU0tfVkVISUNMRV9EUklWRV9UT19DT09SRF9MT05HUkFOR0UodGF4aV9wZWQsIHRheGlfdmVoLCBnb3RvX2Nvb3Jkc1sneCddLCBnb3RvX2Nvb3Jkc1sneSddLCBnb3RvX2Nvb3Jkc1sneiddLCAzMDAuMCwgNzg2OTk2LCA1KQogICAgICAgIGVuZAogICAgZW5kCmVuZApmdW5jdGlvbiBzdW1tX2Nhcl90cCgpCiAgICBpZiB0YXhpX3BlZCA9PSAwIHRoZW4KICAgICAgICB1dGlsLnRvYXN0KCLkvaDmsqHmnInnlJ/miJDlj7jmnLouIikKICAgIGVsc2UKICAgICAgICBQRUQuU0VUX1BFRF9JTlRPX1ZFSElDTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdGF4aV92ZWgsIDApCiAgICBlbmQKZW5kCmZ1bmN0aW9uIHN1bW1fY2FyX2Jtb2IoKQogICAgaWYgdGF4aV9wZWQgPT0gMCB0aGVuCiAgICAgICAgdXRpbC50b2FzdCgi5L2g5rKh5pyJ55Sf5oiQ5Y+45py6LiIpCiAgICBlbHNlCiAgICAgICAgbG9jYWwgcGVkX2NvcHkgPSB0YXhpX3BlZAogICAgICAgIGxvY2FsIHZlaF9jb3B5ID0gdGF4aV92ZWgKICAgICAgICB0YXhpX3BlZCA9IDAKICAgICAgICB0YXhpX3ZlaCA9IDAKICAgICAgICBsb2NhbCBjb29yZHMgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFModmVoX2NvcHkpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRSh2ZWhfY29weSwgZmFsc2UpCiAgICAgICAgRklSRS5BRERfRVhQTE9TSU9OKGNvb3Jkc1sneCddLCBjb29yZHNbJ3knXSwgY29vcmRzWyd6J10sIDcsIDEwMC4wLCB0cnVlLCBmYWxzZSwgMS4wKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0hFQUxUSCh2ZWhfY29weSwgMCkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKHBlZF9jb3B5LCBmYWxzZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9IRUFMVEgocGVkX2NvcHksIDApCiAgICAgICAgaWYgbWF0aC5yYW5kb20oNSkgPT0gMyB0aGVuCiAgICAgICAgICAgIHV0aWwudG9hc3QoIuS7luacieiAgeWphuWtqeWtkC4uLiIpCiAgICAgICAgZW5kCiAgICAgICAgdXRpbC55aWVsZCgzMDAwKQogICAgICAgIGRlbGV0ZV9lbnRpdHkocGVkX2NvcHkpCiAgICAgICAgZGVsZXRlX2VudGl0eSh2ZWhfY29weSkKICAgIGVuZAplbmQKCgotLS0t6Ieq5a6a5LmJ6L2s5byvCmZ1bmN0aW9uIGN1c3RvbV9UdXJuVmVoaWNsZSgpCiAgICBsb2NhbCB2ZWggPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0lOKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKQogICAgbG9jYWwgdnYgPSBFTlRJVFkuR0VUX0VOVElUWV9ST1RBVElPTih2ZWgsIDIpCiAgICBpZiBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsIDYzKSB0aGVuIAogICAgICAgIGxvY2FsIHlhd0FmdGVyUHJlc3MgPSB2di56ICsgMwogICAgICAgIGlmIHlhd0FmdGVyUHJlc3MgPiAxODAgdGhlbiAKICAgICAgICAgICAgbG9jYWwgb3ZlckZsb3dOZWcgPSBtYXRoLmFicyh2di56KSotMSAKICAgICAgICAgICAgbG9jYWwgdG9TZXRZYXcgPSBvdmVyRmxvd05lZyArIDMKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04odmVoLCB2di54LCB2di55LCB0b1NldFlhdywgMiwgdHJ1ZSkKICAgICAgICBlbHNlCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKHZlaCwgdnYueCwgdnYueSwgeWF3QWZ0ZXJQcmVzcywgMiwgdHJ1ZSkKICAgICAgICBlbmQKICAgIGVsc2VpZiBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsIDY0KSB0aGVuCiAgICAgICAgbG9jYWwgeWF3QWZ0ZXJQcmVzcyA9IHZ2LnogLSAzCiAgICAgICAgaWYgeWF3QWZ0ZXJQcmVzcyA8IC0xODAgdGhlbiAKICAgICAgICAgICAgbG9jYWwgb3ZlckZsb3dOZWcgPSBtYXRoLmFicyh2di56KSAKICAgICAgICAgICAgbG9jYWwgdG9TZXRZYXcgPSBvdmVyRmxvd05lZyAtIDMKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04odmVoLCB2di54LCB2di55LCB0b1NldFlhdywgMiwgdHJ1ZSkKICAgICAgICBlbHNlCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKHZlaCwgdnYueCwgdnYueSwgeWF3QWZ0ZXJQcmVzcywgMiwgdHJ1ZSkKICAgICAgICBlbmQKICAgIGVuZAplbmQKCgotLS0t6K+V6aqM5Y2H6ZmN5py6CmZ1bmN0aW9uIHRlc3RfZWxldmF0b3IocGlkKQogICAgCiAgICBsb2NhbCBoYXNoID0gdXRpbC5qb2FhdCgncHJvcF90ZXN0X2VsZXZhdG9yJykKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSwgZmFsc2UpCiAgICBmb3IgaSA9IDAsIDkwLCA5MCBkbwogICAgICAgIGxvY2FsIGNhZ2UgPSBjcmVhdGVfb2JqZWN0KGhhc2gsIHBvcy54LCBwb3MueSwgcG9zLnopCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSEVBRElORyhjYWdlLCBpKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0lOVklOQ0lCTEUoY2FnZSx0cnVlKQogICAgICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKGNhZ2UsIHRydWUpCiAgICBlbmQKZW5kCi0tLS3nm5Hni7HnrLzlrZAKZnVuY3Rpb24gUHJpc29uX2NhZ2VzKHBpZCkKICAgIAogICAgbG9jYWwgY2FnZSA9IHt9CiAgICBsb2NhbCBkb29yID0gdXRpbC5qb2FhdCgidl9pbGV2X3BoX2NlbGxnYXRlIikKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSwgZmFsc2UpCgogICAgY2FnZVsxXSA9IGNyZWF0ZV9vYmplY3QoZG9vciwgcG9zLnggKyAwLjUsIHBvcy55ICsgMC41LCBwb3MueikKICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKGNhZ2VbMV0sIHRydWUpCgogICAgY2FnZVsyXSA9IGNyZWF0ZV9vYmplY3QoZG9vciwgcG9zLnggKyAwLjUsIHBvcy55IC0gMC44LCBwb3MueikKICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKGNhZ2VbMl0sIHRydWUpCgogICAgY2FnZVszXSA9IGNyZWF0ZV9vYmplY3QoZG9vciwgcG9zLnggKyAwLjUsIHBvcy55ICsgMC41LCBwb3MueikKICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKGNhZ2VbM10sIDAuMCwgMC4wLCA5MC4wLCAxLCB0cnVlKQogICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04oY2FnZVszXSwgdHJ1ZSkKCiAgICBjYWdlWzRdID0gY3JlYXRlX29iamVjdChkb29yLCBwb3MueCAtIDAuOCwgcG9zLnkgKyAwLjUsIHBvcy56KQogICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04oY2FnZVs0XSwgMC4wLCAwLjAsIDkwLjAsIDEsIHRydWUpCiAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihjYWdlWzRdLCB0cnVlKQplbmQKLS0tLeafseW9ouesvApmdW5jdGlvbiBwaWxsYXJfY2FnZShwaWQpCiAgICAKICAgIGxvY2FsIGhhc2ggPSB1dGlsLmpvYWF0KCd2X3JldF9maF9kb29yZnJhbWUnKQogICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpLCBmYWxzZSkKICAgIGZvciBpID0gMCwgMTM1LCA0NSBkbwogICAgICAgIGxvY2FsIGNhZ2UgPSBjcmVhdGVfb2JqZWN0KGhhc2gsIHBvcy54LCBwb3MueSwgcG9zLnopCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSEVBRElORyhjYWdlLCBpKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0lOVklOQ0lCTEUoY2FnZSx0cnVlKQogICAgICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKGNhZ2UsIHRydWUpCiAgICBlbmQKZW5kCgotLS0t5qCF5qCPCmZ1bmN0aW9uIGZlbmNlX2NhZ2UocGlkKQogICAgCiAgICBsb2NhbCBvYmpIYXNoID0gdXRpbC5qb2FhdCgicHJvcF9mbmNsaW5rXzAzZSIpCiAgICByZXF1ZXN0X21vZGVsKG9iakhhc2gpCiAgICBsb2NhbCBwb3MgPSBwbGF5ZXJzLmdldF9wb3NpdGlvbihwaWQpCiAgICBwb3MueiA9IHBvcy56IC0gMS4wCiAgICBsb2NhbCBvYmplY3QgPSB7fQogICAgb2JqZWN0WzFdID0gZW50aXRpZXMuY3JlYXRlX29iamVjdChvYmpIYXNoLCB2My5uZXcocG9zLnggLSAxLjUsIHBvcy55ICsgMS41LCBwb3MueikpCiAgICBvYmplY3RbMl0gPSBlbnRpdGllcy5jcmVhdGVfb2JqZWN0KG9iakhhc2gsIHYzLm5ldyhwb3MueCAtIDEuNSwgcG9zLnkgLSAxLjUsIHBvcy56KSkKICAgIG9iamVjdFszXSA9IGVudGl0aWVzLmNyZWF0ZV9vYmplY3Qob2JqSGFzaCwgdjMubmV3KHBvcy54ICsgMS41LCBwb3MueSArIDEuNSwgcG9zLnopKQogICAgbG9jYWwgcm90XzMgPSBFTlRJVFkuR0VUX0VOVElUWV9ST1RBVElPTihvYmplY3RbM10sIDIpCiAgICByb3RfMy56ID0gLTkwLjAKICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKG9iamVjdFszXSwgcm90XzMueCwgcm90XzMueSwgcm90XzMueiwgMSwgdHJ1ZSkKICAgIG9iamVjdFs0XSA9IGVudGl0aWVzLmNyZWF0ZV9vYmplY3Qob2JqSGFzaCwgdjMubmV3KHBvcy54IC0gMS41LCBwb3MueSArIDEuNSwgcG9zLnopKQogICAgbG9jYWwgcm90XzQgPSBFTlRJVFkuR0VUX0VOVElUWV9ST1RBVElPTihvYmplY3RbNF0sIDIpCiAgICByb3RfNC56ID0gLTkwLjAKICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKG9iamVjdFs0XSwgcm90XzQueCwgcm90XzQueSwgcm90XzQueiwgMSwgdHJ1ZSkKICAgIGZvciBpID0gMSwgNCBkbyBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihvYmplY3RbaV0sIHRydWUpIGVuZAogICAgU1RSRUFNSU5HLlNFVF9NT0RFTF9BU19OT19MT05HRVJfTkVFREVEKG9iakhhc2gpCmVuZAoKLS0tLeWcsOeLseesvOWtkApmdW5jdGlvbiBoZWxsX2NhZ2UocGlkKQogICAgCiAgICBsb2NhbCBvYmpIYXNoID0gdXRpbC5qb2FhdCgiaGVpX3Byb3Bfc3RhdGlvbl9nYXRlIikKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSwgZmFsc2UpCiAgICBwb3MueiA9IHBvcy56IC0gMS4wCiAgICBsb2NhbCBvYmplY3QgPSB7fQoKICAgIG9iamVjdFsxXSA9IGNyZWF0ZV9vYmplY3Qob2JqSGFzaCwgcG9zLnggKyAyLjc1LCBwb3MueSArIDIuNzUsIHBvcy56KQogICAgb2JqZWN0WzJdID0gY3JlYXRlX29iamVjdChvYmpIYXNoLCBwb3MueCArIDIuNzUsIHBvcy55ICsgMi43NSwgcG9zLnogKyAyKQogICAgb2JqZWN0WzNdID0gY3JlYXRlX29iamVjdChvYmpIYXNoLCBwb3MueCArIDIuNzUsIHBvcy55IC0gMi43NSwgcG9zLnopCiAgICBvYmplY3RbNF0gPSBjcmVhdGVfb2JqZWN0KG9iakhhc2gsIHBvcy54ICsgMi43NSwgcG9zLnkgLSAyLjc1LCBwb3MueiArIDIpCiAgICBvYmplY3RbNV0gPSBjcmVhdGVfb2JqZWN0KG9iakhhc2gsIHBvcy54ICsgMi43NSwgcG9zLnkgLSAyLjc1LCBwb3MueikKICAgIG9iamVjdFs2XSA9IGNyZWF0ZV9vYmplY3Qob2JqSGFzaCwgcG9zLnggKyAyLjc1LCBwb3MueSAtIDIuNzUsIHBvcy56ICsgMikKICAgIGxvY2FsIHJvdDUgPSBFTlRJVFkuR0VUX0VOVElUWV9ST1RBVElPTihvYmplY3RbNV0sIDIpCiAgICBFTlRJVFkuU0VUX0VOVElUWV9ST1RBVElPTihvYmplY3RbNV0sIHJvdDUueCwgcm90NS55LCAtOTAuMCwgMiwgdHJ1ZSkKICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKG9iamVjdFs2XSwgcm90NS54LCByb3Q1LnksIC05MC4wLCAyLCB0cnVlKQoKICAgIG9iamVjdFs3XSA9IGNyZWF0ZV9vYmplY3Qob2JqSGFzaCwgcG9zLnggLSAyLjc1LCBwb3MueSAtIDIuNzUsIHBvcy56KQogICAgb2JqZWN0WzhdID0gY3JlYXRlX29iamVjdChvYmpIYXNoLCBwb3MueCAtIDIuNzUsIHBvcy55IC0gMi43NSwgcG9zLnogKyAyKQogICAgbG9jYWwgcm90NyA9IEVOVElUWS5HRVRfRU5USVRZX1JPVEFUSU9OKG9iamVjdFs3XSwgMikKICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKG9iamVjdFs3XSwgcm90Ny54LCByb3Q3LnksIC05MC4wLCAyLCB0cnVlKQogICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04ob2JqZWN0WzhdLCByb3Q3LngsIHJvdDcueSwgLTkwLjAsIDIsIHRydWUpCgogICAgb2JqZWN0WzldID0gY3JlYXRlX29iamVjdChvYmpIYXNoLCBwb3MueCwgcG9zLnkgKyAyLjc1LCBwb3MueiArIDUpCiAgICBsb2NhbCByb3Q5ID0gRU5USVRZLkdFVF9FTlRJVFlfUk9UQVRJT04ob2JqZWN0WzldLCAyKQogICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04ob2JqZWN0WzldLCA5MCwgOTAsIHJvdDkueiwgMiwgdHJ1ZSkKCiAgICBvYmplY3RbMTBdID0gY3JlYXRlX29iamVjdChvYmpIYXNoLCBwb3MueCwgcG9zLnkgKyAyLjc1LCBwb3MueiArIDUpCiAgICBsb2NhbCByb3QxMCA9IEVOVElUWS5HRVRfRU5USVRZX1JPVEFUSU9OKG9iamVjdFs5XSwgMikKICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKG9iamVjdFsxMF0sIC05MCwgLTkwLCByb3QxMC56LCAyLCB0cnVlKQoKICAgIG9iamVjdFsxMV0gPSBjcmVhdGVfb2JqZWN0KG9iakhhc2gsIHBvcy54LCBwb3MueSArIDIuNzUsIHBvcy56KQogICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04ob2JqZWN0WzExXSwgOTAsIDkwLCByb3Q5LnosIDIsIHRydWUpCgogICAgb2JqZWN0WzEyXSA9IGNyZWF0ZV9vYmplY3Qob2JqSGFzaCwgcG9zLngsIHBvcy55ICsgMi43NSwgcG9zLnopCiAgICBFTlRJVFkuU0VUX0VOVElUWV9ST1RBVElPTihvYmplY3RbMTJdLCAtOTAsIC05MCwgcm90MTAueiwgMiwgdHJ1ZSkKCiAgICBmb3IgaSA9IDEsIDEyIGRvCiAgICAgICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04ob2JqZWN0W2ldLCB0cnVlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1ZJU0lCTEUob2JqZWN0W2ldLCB0cnVlKQogICAgZW5kCmVuZAoKLS0tLeenu+WKqOesvOWtkApmdW5jdGlvbiBraWRuYXBwbGF5ZXIocGlkLCBpbmRleCwgdmFsdWUpCiAgICAKICAgIGxvY2FsIHBfaGFzaCA9IHV0aWwuam9hYXQoInNfbV95X2ZhY3RvcnlfMDEiKQogICAgICAgIGxvY2FsIHZfaGFzaCA9IDAKICAgICAgICBpZiBpbmRleCA9PSAxIHRoZW4KICAgICAgICAgICAgdl9oYXNoID0gdXRpbC5qb2FhdCgiYm94dmlsbGUzIikKICAgICAgICBlbHNlaWYgaW5kZXggPT0gMiB0aGVuIAogICAgICAgICAgICB2X2hhc2ggPSB1dGlsLmpvYWF0KCJjYXJnb2JvYiIpCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIHVzZXJfcGVkID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgICAgICByZXF1ZXN0X21vZGVsKHZfaGFzaCkKICAgICAgICByZXF1ZXN0X21vZGVsKHBfaGFzaCkKICAgICAgICBsb2NhbCBjID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKHVzZXJfcGVkLCAwLjAsIDIuMCwgMC4wKQogICAgICAgIGxvY2FsIHRydWNrID0gZW50aXRpZXMuY3JlYXRlX3ZlaGljbGUodl9oYXNoLCBjLCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKHVzZXJfcGVkKSkKICAgICAgICBsb2NhbCBkcml2ZXIgPSBlbnRpdGllcy5jcmVhdGVfcGVkKDUsIHBfaGFzaCwgYywgMCkKICAgICAgICBQRUQuU0VUX1BFRF9JTlRPX1ZFSElDTEUoZHJpdmVyLCB0cnVjaywgLTEpCiAgICAgICAgUEVELlNFVF9QRURfRkxFRV9BVFRSSUJVVEVTKGRyaXZlciwgMCwgZmFsc2UpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRShkcml2ZXIsIHRydWUpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRSh0cnVjaywgdHJ1ZSkKICAgICAgICByZXF1ZXN0X21vZGVsKHByb3BfaGFzaCkKICAgICAgICBQRUQuU0VUX1BFRF9DQU5fQkVfRFJBR0dFRF9PVVQoZHJpdmVyLCBmYWxzZSkKICAgICAgICBQRUQuU0VUX0JMT0NLSU5HX09GX05PTl9URU1QT1JBUllfRVZFTlRTKGRyaXZlciwgdHJ1ZSkKICAgICAgICB1dGlsLnlpZWxkKDIwMDApCiAgICAgICAgaWYgaW5kZXggPT0gMSB0aGVuCiAgICAgICAgICAgIFRBU0suVEFTS19WRUhJQ0xFX0RSSVZFX1RPX0NPT1JEKGRyaXZlciwgdHJ1Y2ssIG1hdGgucmFuZG9tKDEwMDApLCBtYXRoLnJhbmRvbSgxMDAwKSwgbWF0aC5yYW5kb20oMTAwKSwgMTAwLCAxLCBFTlRJVFkuR0VUX0VOVElUWV9NT0RFTCh0cnVjayksIDc4Njk5NiwgNSwgMCkKICAgICAgICBlbHNlaWYgaW5kZXggPT0gMiB0aGVuIAogICAgICAgICAgICBUQVNLLlRBU0tfSEVMSV9NSVNTSU9OKGRyaXZlciwgdHJ1Y2ssIDAsIDAsIG1hdGgucmFuZG9tKDEwMDApLCBtYXRoLnJhbmRvbSgxMDAwKSwgMTUwMCwgNCwgMjAwLjAsIDAuMCwgMCwgMTAwLCAxMDAwLCAwLjAsIDE2KQogICAgICAgIGVuZAplbmQKLS0tLee8hui9puesvOWtkApmdW5jdGlvbiB0cmFtd2F5X2NhZ2UocGlkKQogICAgCiAgICBsb2NhbCBoYXNoID0gdXRpbC5qb2FhdCgicF9jYWJsZWNhcl9zIikKICAgIGxvY2FsIHBvcyA9IHBsYXllcnMuZ2V0X3Bvc2l0aW9uKHBpZCkKICAgIGxvY2FsIG9iaiA9IE9CSkVDVC5DUkVBVEVfT0JKRUNUX05PX09GRlNFVChoYXNoLCBwb3MueCwgcG9zLnkgLSAwLjEsIHBvcy56ICsgNC4yLCB0cnVlLCBmYWxzZSwgZmFsc2UpCiAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihvYmosIHRydWUpCmVuZAotLS0t5bCP5qG256y85a2QCmZ1bmN0aW9uIEtlZ3NfY2FnZShwaWQpCiAgICAKICAgIGxvY2FsIGNvbnRhaW5lcl9oYXNoID0gdXRpbC5qb2FhdCgicHJvcF9mZWVkZXIxX2NyIikKICAgIGxvY2FsIHBvcyA9IHBsYXllcnMuZ2V0X3Bvc2l0aW9uKHBpZCkKICAgIGVudGl0aWVzLmNyZWF0ZV9vYmplY3QoY29udGFpbmVyX2hhc2gsIHYzKHBvcy54LCBwb3MueSwgcG9zLnogLSAxKSkKICAgIGVudGl0aWVzLmNyZWF0ZV9vYmplY3QoY29udGFpbmVyX2hhc2gsIHYzKHBvcy54LCBwb3MueSwgcG9zLnogKyAxKSkKZW5kCi0tLS0t55S15Ye756y85a2QCmZ1bmN0aW9uIFNob2NrX2NhZ2UocGlkKQogICAgCiAgICBsb2NhbCBudW1iZXJfb2ZfY2FnZXMgPSA2CiAgICBsb2NhbCBlbGVjX2JveCA9IHV0aWwuam9hYXQoInByb3BfZWxlY2JveF8xMiIpCiAgICBsb2NhbCBwb3MgPSBwbGF5ZXJzLmdldF9wb3NpdGlvbihwaWQpCiAgICBwb3MueiA9IHBvcy56IC0gMC41CiAgICByZXF1ZXN0X21vZGVsKGVsZWNfYm94KQogICAgbG9jYWwgdGVtcF92MyA9IHYzLm5ldygwLCAwLCAwKQogICAgZm9yIGkgPSAxLCBudW1iZXJfb2ZfY2FnZXMgZG8KICAgICAgICBsb2NhbCBhbmdsZSA9IChpIC8gbnVtYmVyX29mX2NhZ2VzKSAqIDM2MAogICAgICAgIHRlbXBfdjMueiA9IGFuZ2xlCiAgICAgICAgbG9jYWwgb2JqX3BvcyA9IHRlbXBfdjM6dG9EaXIoKQogICAgICAgIG9ial9wb3M6bXVsKDIuNSkKICAgICAgICBvYmpfcG9zOmFkZChwb3MpCiAgICAgICAgZm9yIG9mZnNfeiA9IDEsIDUgZG8KICAgICAgICAgICAgbG9jYWwgZWxlY3RyaWNfY2FnZSA9IGVudGl0aWVzLmNyZWF0ZV9vYmplY3QoZWxlY19ib3gsIG9ial9wb3MpCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKGVsZWN0cmljX2NhZ2UsIDkwLjAsIDAuMCwgYW5nbGUsIDIsIDApCiAgICAgICAgICAgIG9ial9wb3MueiA9IG9ial9wb3MueiArIDAuNzUKICAgICAgICAgICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04oZWxlY3RyaWNfY2FnZSwgdHJ1ZSkKICAgICAgICBlbmQKICAgIGVuZAplbmQKLS0tLeiLseWbveWls+eOi+esvOWtkApmdW5jdGlvbiBndWVlbmNhZ2UocGlkKQogICAgCiAgICBsb2NhbCBudW1iZXJfb2ZfY2FnZXMgPSA2CiAgICBsb2NhbCBjb2ZmaW5faGFzaCA9IHV0aWwuam9hYXQoInByb3BfY29mZmluXzAyYiIpCiAgICBsb2NhbCBwZWQgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKQogICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHBlZCkKICAgIHJlcXVlc3RfbW9kZWwoY29mZmluX2hhc2gpCiAgICBsb2NhbCB0ZW1wX3YzID0gdjMubmV3KDAsIDAsIDApCiAgICBmb3IgaSA9IDEsIG51bWJlcl9vZl9jYWdlcyBkbwogICAgICAgIGxvY2FsIGFuZ2xlID0gKGkgLyBudW1iZXJfb2ZfY2FnZXMpICogMzYwCiAgICAgICAgdGVtcF92My56ID0gYW5nbGUKICAgICAgICBsb2NhbCBvYmpfcG9zID0gdGVtcF92Mzp0b0RpcigpCiAgICAgICAgb2JqX3BvczptdWwoMC44KQogICAgICAgIG9ial9wb3M6YWRkKHBvcykKICAgICAgICBvYmpfcG9zLnogPSBvYmpfcG9zLnogKyAwLjEKICAgICAgIGxvY2FsIGNvZmZpbiA9IGVudGl0aWVzLmNyZWF0ZV9vYmplY3QoY29mZmluX2hhc2gsIG9ial9wb3MpCiAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9ST1RBVElPTihjb2ZmaW4sIDkwLjAsIDAuMCwgYW5nbGUsICAyLCAwKQogICAgICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04oY29mZmluLCB0cnVlKQogICAgZW5kCmVuZAotLS0t54eD5rCU56y8CmZ1bmN0aW9uIGdhc2NhZ2UocGlkKQogICAgCiAgICBsb2NhbCBnYXNfY2FnZV9oYXNoID0gdXRpbC5qb2FhdCgicHJvcF9nYXNjYWdlMDEiKQogICAgbG9jYWwgcGVkID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhwZWQpCiAgICByZXF1ZXN0X21vZGVsKGdhc19jYWdlX2hhc2gpCiAgICBwb3MueiA9IHBvcy56IC0gMQogICAgbG9jYWwgZ2FzX2NhZ2UgPSBlbnRpdGllcy5jcmVhdGVfb2JqZWN0KGdhc19jYWdlX2hhc2gsIHBvcywgMCkKICAgIHBvcy56ID0gcG9zLnogKyAxCiAgICBsb2NhbCBnYXNfY2FnZTIgPSBlbnRpdGllcy5jcmVhdGVfb2JqZWN0KGdhc19jYWdlX2hhc2gsIHBvcywgMCkKICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKGdhc19jYWdlLCB0cnVlKQogICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04oZ2FzX2NhZ2UyLCB0cnVlKQplbmQKLS0tLembhuijheeuseesvOWtkApmdW5jdGlvbiBDb250YWluZXJfY2FnZShwaWQpCiAgICAKICAgIGxvY2FsIGNvbnRhaW5lcl9oYXNoID0gdXRpbC5qb2FhdCgicHJvcF9jb250YWluZXJfbGRfcHUiKQogICAgbG9jYWwgcG9zID0gcGxheWVycy5nZXRfcG9zaXRpb24ocGlkKQogICAgcmVxdWVzdF9tb2RlbChjb250YWluZXJfaGFzaCkKICAgIHBvcy56ID0gcG9zLnogLSAxCiAgICBsb2NhbCBjb250YWluZXIgPSBlbnRpdGllcy5jcmVhdGVfb2JqZWN0KGNvbnRhaW5lcl9oYXNoLCBwb3MsIDApCiAgICBFTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihjb250YWluZXIsIHRydWUpCmVuZAotLS0tLemakOW9ouesvOWtkApmdW5jdGlvbiBWZWhpY2xlX2NhZ2UocGlkKQogICAgCiAgICBsb2NhbCBjb250YWluZXJfaGFzaCA9IHV0aWwuam9hYXQoImJveHZpbGxlMyIpCiAgICBsb2NhbCBwZWQgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKQogICAgbG9jYWwgcG9zID0gcGxheWVycy5nZXRfcG9zaXRpb24ocGlkKQogICAgcmVxdWVzdF9tb2RlbChjb250YWluZXJfaGFzaCkKICAgIGxvY2FsIGNvbnRhaW5lciA9IGVudGl0aWVzLmNyZWF0ZV92ZWhpY2xlKGNvbnRhaW5lcl9oYXNoLCBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMocGVkLCAwLjAsIDIuMCwgMC4wKSwgRU5USVRZLkdFVF9FTlRJVFlfSEVBRElORyhwZWQpKQogICAgRU5USVRZLlNFVF9FTlRJVFlfVklTSUJMRShjb250YWluZXIsIGZhbHNlKQogICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04oY29udGFpbmVyLCB0cnVlKQplbmQKLS0tLS3lhbPpl6jmlL7ni5cKZnVuY3Rpb24gQ2xvc2VfZG9nKHBpZCkKICAgIAogICAgbG9jYWwgcGVkID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgIGxvY2FsIGNvb3JkcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhwZWQsIHRydWUpCiAgICBjb29yZHMueCA9IGNvb3Jkc1sneCddCiAgICBjb29yZHMueSA9IGNvb3Jkc1sneSddCiAgICBjb29yZHMueiA9IGNvb3Jkc1sneiddCiAgICBsb2NhbCBoYXNoID0gNzc5Mjc3NjgyCiAgICByZXF1ZXN0X21vZGVsKGhhc2gpCiAgICBsb2NhbCBjYWdlMSA9IE9CSkVDVC5DUkVBVEVfT0JKRUNUX05PX09GRlNFVChoYXNoLCBjb29yZHNbJ3gnXSwgY29vcmRzWyd5J10sIGNvb3Jkc1sneiddLCB0cnVlLCBmYWxzZSwgZmFsc2UpCiAgICBFTlRJVFkuU0VUX0VOVElUWV9ST1RBVElPTihjYWdlMSwgMC4wLCAtOTAuMCwgMC4wLCAxLCB0cnVlKQogICAgbG9jYWwgY2FnZTIgPSBPQkpFQ1QuQ1JFQVRFX09CSkVDVF9OT19PRkZTRVQoaGFzaCwgY29vcmRzWyd4J10sIGNvb3Jkc1sneSddLCBjb29yZHNbJ3onXSwgdHJ1ZSwgZmFsc2UsIGZhbHNlKQogICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04oY2FnZTIsIDAuMCwgOTAuMCwgMC4wLCAxLCB0cnVlKQogICAgdXRpbC55aWVsZCgxMDApCiAgICBmb3IgaSA9IDEsIDIwIGRvCiAgICAgICAgc2VuZF9hdHRhY2tlcigtMTc4ODY2NTMxNSwgcGlkLCBmYWxzZSkKICAgICAgICB1dGlsLnlpZWxkKDEpCiAgICBlbmQKZW5kCi0tLS3mgZDmgJbkuYvniaIKZnVuY3Rpb24gVGVycm9yX1ByaXNvbihwaWQpCiAgICAKICAgIGxvY2FsIHBlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICBsb2NhbCBjb29yZHMgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMocGVkLCB0cnVlKQogICAgY29vcmRzLnggPSBjb29yZHNbJ3gnXQogICAgY29vcmRzLnkgPSBjb29yZHNbJ3knXQogICAgY29vcmRzLnogPSBjb29yZHNbJ3onXQogICAgbG9jYWwgaGFzaCA9IDc3OTI3NzY4MgogICAgcmVxdWVzdF9tb2RlbChoYXNoKQogICAgbG9jYWwgY2FnZTEgPSBPQkpFQ1QuQ1JFQVRFX09CSkVDVF9OT19PRkZTRVQoaGFzaCwgY29vcmRzWyd4J10sIGNvb3Jkc1sneSddLCBjb29yZHNbJ3onXSwgdHJ1ZSwgZmFsc2UsIGZhbHNlKQogICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04oY2FnZTEsIDAuMCwgLTkwLjAsIDAuMCwgMSwgdHJ1ZSkKICAgIGxvY2FsIGNhZ2UyID0gT0JKRUNULkNSRUFURV9PQkpFQ1RfTk9fT0ZGU0VUKGhhc2gsIGNvb3Jkc1sneCddLCBjb29yZHNbJ3knXSwgY29vcmRzWyd6J10sIHRydWUsIGZhbHNlLCBmYWxzZSkKICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKGNhZ2UyLCAwLjAsIDkwLjAsIDAuMCwgMSwgdHJ1ZSkKICAgIHV0aWwueWllbGQoMTAwKQogICAgZm9yIGkgPSAxLCAyMCBkbwogICAgICAgIHNlbmRfYXR0YWNrZXIodXRpbC5qb2FhdCgiQ1NfQnJhZENhZGF2ZXIiKSwgcGlkLCBmYWxzZSkKICAgICAgICB1dGlsLnlpZWxkKDEpCiAgICBlbmQKZW5kCi0tLS0tLeWwj+eahOernuaKgOeuoQpmdW5jdGlvbiBTbWFsbF9hdGhsZXRpY3MocGlkKQogICAgCiAgICBsb2NhbCBwZWQgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKQogICAgbG9jYWwgY29vcmRzID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHBlZCwgdHJ1ZSkKICAgIGNvb3Jkcy54ID0gY29vcmRzWyd4J10KICAgIGNvb3Jkcy55ID0gY29vcmRzWyd5J10KICAgIGNvb3Jkcy56ID0gY29vcmRzWyd6J10KICAgIGxvY2FsIGhhc2ggPSA3NzkyNzc2ODIKICAgIHJlcXVlc3RfbW9kZWwoaGFzaCkKICAgIGxvY2FsIGNhZ2UxID0gT0JKRUNULkNSRUFURV9PQkpFQ1RfTk9fT0ZGU0VUKGhhc2gsIGNvb3Jkc1sneCddLCBjb29yZHNbJ3knXSwgY29vcmRzWyd6J10sIHRydWUsIGZhbHNlLCBmYWxzZSkKICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKGNhZ2UxLCAwLjAsIC05MC4wLCAwLjAsIDEsIHRydWUpCiAgICBsb2NhbCBjYWdlMiA9IE9CSkVDVC5DUkVBVEVfT0JKRUNUX05PX09GRlNFVChoYXNoLCBjb29yZHNbJ3gnXSwgY29vcmRzWyd5J10sIGNvb3Jkc1sneiddLCB0cnVlLCBmYWxzZSwgZmFsc2UpCiAgICBFTlRJVFkuU0VUX0VOVElUWV9ST1RBVElPTihjYWdlMiwgMC4wLCA5MC4wLCAwLjAsIDEsIHRydWUpCmVuZAotLS0tLeerluWQkei0p+acuuesvOWtkApmdW5jdGlvbiBWZXJ0aWNhbF9mcmVpZ2h0ZXJfY2FnZShwaWQpCiAgICAKICAgIGxvY2FsIHBlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICBsb2NhbCBjb29yZHMgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMocGVkLCAwLjAsIDAuMCwgNS4wKQogICAgLS1sb2NhbCBoYXNoID0gdXRpbC5qb2FhdCgicHJvcF9sZF9jcmF0ZV8wMSIpCiAgICBsb2NhbCBoYXNoID0gdXRpbC5qb2FhdCgndGl0YW4nKQogICAgcmVxdWVzdF9tb2RlbChoYXNoKQogICAgbG9jYWwgY2FnZSA9IGVudGl0aWVzLmNyZWF0ZV92ZWhpY2xlKGhhc2gsIGNvb3JkcywgMCkKICAgIEVOVElUWS5TRVRfRU5USVRZX1JPVEFUSU9OKGNhZ2UsIDkwLCAwLCAwLCAxLCB0cnVlKQogICAgLS1FTlRJVFkuRlJFRVpFX0VOVElUWV9QT1NJVElPTihjYWdlLCB0cnVlKQogICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRShjYWdlLCB0cnVlKQogICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04oY2FnZSwgdHJ1ZSkKZW5kCi0tLS0tLS3mqKrooYzotKfmnLrnrLzlrZAKZnVuY3Rpb24gUmFtcGFnZV9wbGFuZV9jYWdlKHBpZCkKICAgIAogICAgbG9jYWwgcGVkID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgIGxvY2FsIGNvb3JkcyA9IEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhwZWQsIDAuMCwgMC4wLCAwLjApCiAgICBsb2NhbCBoYXNoID0gdXRpbC5qb2FhdCgiY2FyZ29wbGFuZSIpCiAgICByZXF1ZXN0X21vZGVsKGhhc2gpCiAgICBsb2NhbCBjYXJnbyA9IGVudGl0aWVzLmNyZWF0ZV92ZWhpY2xlKGhhc2gsIGNvb3JkcywgRU5USVRZLkdFVF9FTlRJVFlfSEVBRElORyhwZWQpKQogICAgRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04oY2FyZ28sIHRydWUpCiAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFNfTk9fT0ZGU0VUKGNhcmdvLCBjb29yZHMueCwgY29vcmRzLnksIGNvb3Jkcy56LTAuMSwgdHJ1ZSwgZmFsc2UsIGZhbHNlKQogICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRShjYXJnbywgdHJ1ZSkKICAgIGZvciBpPTEsIDUgZG8KICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0RPT1JfTEFUQ0hFRChjYXJnbywgaSwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkKICAgIGVuZAplbmQKLS0tLeaUr+afseesvOWtkApmdW5jdGlvbiBydWJfY2FnZShwaWQpCiAgICAKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSkKICAgIGxvY2FsIGhhc2ggPSAyMDYzOTYyMTc5Cglwb3MueiA9IHBvcy56IC0gMQoJbG9jYWwgb2JqZWN0MSA9IGNyZWF0ZV9vYmplY3QoaGFzaCwgcG9zLngsIHBvcy55LCBwb3MueikKICAgIGxvY2FsIG9iamVjdDIgPSBjcmVhdGVfb2JqZWN0KGhhc2gsIHBvcy54LCBwb3MueSwgcG9zLnopCiAgICBFTlRJVFkuU0VUX0VOVElUWV9ST1RBVElPTihvYmplY3QxLCAwLCAwLCAwLCAxLCB0cnVlKQogICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04ob2JqZWN0MiwgMCwgMCwgOTAsIDEsIHRydWUpCQkJCQkJCQkJCQkJCQkJCQoJRU5USVRZLkZSRUVaRV9FTlRJVFlfUE9TSVRJT04ob2JqZWN0MSwgdHJ1ZSkKICAgIEVOVElUWS5GUkVFWkVfRU5USVRZX1BPU0lUSU9OKG9iamVjdDIsIHRydWUpCmVuZAoKLS0tLS0t5aSp54We5oiY5paX5py6CmZ1bmN0aW9uIENlbGVzdGlhbF9GaWdodGVyKHBpZCkKICAgIAogICAgbG9jYWwgdGFyZ2V0X3BlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICBjb29yZHMgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFModGFyZ2V0X3BlZCwgMS4wLCAwLjAsIDUwMC4wKQogICAgY29vcmRzLnggPSBjb29yZHNbJ3gnXQogICAgY29vcmRzLnkgPSBjb29yZHNbJ3knXQogICAgY29vcmRzLnogPSBjb29yZHNbJ3onXQogICAgbG9jYWwgaGFzaCA9IHV0aWwuam9hYXQoImxhemVyIikKICAgIHJlcXVlc3RfbW9kZWwoaGFzaCkKICAgIHJlcXVlc3RfbW9kZWwoLTE2MzcxNDg0NykKICAgIGNvb3Jkcy54ID0gY29vcmRzLnggKyAyCiAgICBjb29yZHMueSA9IGNvb3Jkcy55ICsgMgogICAgbG9jYWwgamV0ID0gZW50aXRpZXMuY3JlYXRlX3ZlaGljbGUoaGFzaCwgY29vcmRzLCAwLjApCiAgICBWRUhJQ0xFLkNPTlRST0xfTEFORElOR19HRUFSKGpldCwgMykKICAgIFZFSElDTEUuU0VUX0hFTElfQkxBREVTX0ZVTExfU1BFRUQoamV0KQogICAgVkVISUNMRS5TRVRfVkVISUNMRV9GT1JXQVJEX1NQRUVEKGpldCwgVkVISUNMRS5HRVRfVkVISUNMRV9FU1RJTUFURURfTUFYX1NQRUVEKGpldCkpCiAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKGpldCwgdHJ1ZSkKICAgIGxvY2FsIHBpbG90ID0gZW50aXRpZXMuY3JlYXRlX3BlZCgyOCwgLTE2MzcxNDg0NywgY29vcmRzLCAzMC4wKQogICAgUEVELlNFVF9QRURfQ09NQkFUX0FUVFJJQlVURVMocGlsb3QsIDUsIHRydWUpCiAgICBQRUQuU0VUX1BFRF9DT01CQVRfQVRUUklCVVRFUyhwaWxvdCwgNDYsIHRydWUpCiAgICBQRUQuU0VUX1BFRF9JTlRPX1ZFSElDTEUocGlsb3QsIGpldCwgLTEpCiAgICBUQVNLLlRBU0tfUExBTkVfTUlTU0lPTihwaWxvdCwgamV0LCAwLCB0YXJnZXRfcGVkLCAwLCAwLCAwLCA2LCAwLjAsIDAsIDAuMCwgNTAuMCwgNDAuMCkKICAgIFRBU0suVEFTS19DT01CQVRfUEVEKHBpbG90LCB0YXJnZXRfcGVkLCAwLCAxNikKICAgIFBFRC5TRVRfUEVEX0FDQ1VSQUNZKHBpbG90LCAxMDAuMCkKICAgIFBFRC5TRVRfUEVEX0NPTUJBVF9BQklMSVRZKHBpbG90LCAyKQplbmQKCgoKLS0tLVhG5bSp5rqDCmZ1bmN0aW9uIFhGX2NyYXNoKHBpZCkKICAgIAogICAgZm9yIGkgPSAxLCAxMCBkbwogICAgICAgIGxvY2FsIFRhcmdldFBsYXllclBlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCgkJbG9jYWwgY29yZCA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhUYXJnZXRQbGF5ZXJQZWQsIHRydWUpCiAgICAgICAgcmVxdWVzdF9tb2RlbCgtOTMwODc5NjY1KQogICAgICAgIHV0aWwueWllbGQoMTApCiAgICAgICAgcmVxdWVzdF9tb2RlbCgzNjEzMjYyMjQ2KQogICAgICAgIHV0aWwueWllbGQoMTApCiAgICAgICAgcmVxdWVzdF9tb2RlbCg0NTI2MTg3NjIpCiAgICAgICAgdXRpbC55aWVsZCgxMCkKICAgICAgICBsb2NhbCBhMSA9IGVudGl0aWVzLmNyZWF0ZV9vYmplY3QoLTkzMDg3OTY2NSwgY29yZCkKICAgICAgICB1dGlsLnlpZWxkKDEwKQogICAgICAgIGxvY2FsIGEyID0gZW50aXRpZXMuY3JlYXRlX29iamVjdCgzNjEzMjYyMjQ2LCBjb3JkKQogICAgICAgIHV0aWwueWllbGQoMTApCiAgICAgICAgbG9jYWwgYjEgPSBlbnRpdGllcy5jcmVhdGVfb2JqZWN0KDQ1MjYxODc2MiwgY29yZCkKICAgICAgICB1dGlsLnlpZWxkKDEwKQogICAgICAgIGxvY2FsIGIyID0gZW50aXRpZXMuY3JlYXRlX29iamVjdCgzNjEzMjYyMjQ2LCBjb3JkKQogICAgICAgIHV0aWwueWllbGQoMzAwKQogICAgICAgIGRlbGV0ZV9lbnRpdHkoYTEpCiAgICAgICAgZGVsZXRlX2VudGl0eShhMikKICAgICAgICBkZWxldGVfZW50aXR5KGIxKQogICAgICAgIGRlbGV0ZV9lbnRpdHkoYjIpCiAgICAgICAgU1RSRUFNSU5HLlNFVF9NT0RFTF9BU19OT19MT05HRVJfTkVFREVEKDQ1MjYxODc2MikKICAgICAgICB1dGlsLnlpZWxkKDEwKQogICAgICAgIFNUUkVBTUlORy5TRVRfTU9ERUxfQVNfTk9fTE9OR0VSX05FRURFRCgzNjEzMjYyMjQ2KQogICAgICAgIHV0aWwueWllbGQoMTApCiAgICAgICAgU1RSRUFNSU5HLlNFVF9NT0RFTF9BU19OT19MT05HRVJfTkVFREVEKC05MzA4Nzk2NjUpCiAgICAgICAgdXRpbC55aWVsZCgxMCkKICAgIGVuZAplbmQKCi0tLS3luIPlsJTlgLzltKnmuoMKZnVuY3Rpb24gYm9vbGVhbl9jcmFzaChwaWQpCiAgICAKICAgIGxvY2FsIHBlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpCiAgICBsb2NhbCBjb29yZHMgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMocGVkKQogICAgbG9jYWwgbW9kZWwgPSB1dGlsLmpvYWF0KCJiYW5zaGVlIikKICAgIHJlcXVlc3RfbW9kZWwobW9kZWwpCiAgICBsb2NhbCB2ZWhpY2xlID0gZW50aXRpZXMuY3JlYXRlX3ZlaGljbGUobW9kZWwsY29vcmRzLDApCiAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX01PRF9LSVQodmVoaWNsZSwgMCkKICAgIEVOVElUWS5TRVRfRU5USVRZX0NPTExJU0lPTih2ZWhpY2xlLCBmYWxzZSwgdHJ1ZSkKICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfR1JBVklUWSh2ZWhpY2xlLCAwKQogICAgZm9yIGk9MCwgNDkgZG8KICAgICAgICBsb2NhbCBtYXhfbW9kID0gVkVISUNMRS5HRVRfTlVNX1ZFSElDTEVfTU9EUyh2ZWhpY2xlLCBpKSAtIDEKICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX01PRCh2ZWhpY2xlLCBpLCBtYXhfbW9kLCBmYWxzZSkKICAgIGVuZAplbmQKCi0tLS3ml6DmlYjovb3lhbfltKnmuoMKZnVuY3Rpb24gY2xvbmUodmVoaWNsZSkKICAgIGxvY2FsIHZlaGljbGVIZWFkaW5nPGNvbnN0PiA9IEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcodmVoaWNsZSkKICAgIGxvY2FsIHZlaGljbGVIYXNoPGNvbnN0PiA9IEVOVElUWS5HRVRfRU5USVRZX01PREVMKHZlaGljbGUpCiAgICBsb2NhbCBjb29yZHMgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFModmVoaWNsZSkKICAgIEVOVElUWS5TRVRfRU5USVRZX0FTX01JU1NJT05fRU5USVRZKHZlaGljbGUpCiAgICBsb2NhbCByb3QgPSB2My50b0RpcihFTlRJVFkuR0VUX0VOVElUWV9ST1RBVElPTih2ZWhpY2xlLCAyKSkKICAgIHYzLm11bChyb3QsIC1nZXREaW1lbnNpb25zKHZlaGljbGUpLnggLSAyKQogICAgdjMuYWRkKGNvb3Jkcywgcm90KQogICAgbG9jYWwgY2xvbmVWZWhpY2xlPGNvbnN0PiA9IGVudGl0aWVzLmNyZWF0ZV92ZWhpY2xlKHZlaGljbGVIYXNoLCBjb29yZHMsIHZlaGljbGVIZWFkaW5nKQogICAgY29weVZlaGljbGVEYXRhKHZlaGljbGUsIGNsb25lVmVoaWNsZSkKICAgIHJldHVybiBjbG9uZVZlaGljbGUKZW5kCmZ1bmN0aW9uIGdldERpbWVuc2lvbnMoZW50aXR5KQogICAgbG9jYWwgbWluaW11bSA9IG1lbW9yeS5hbGxvYygpCiAgICBsb2NhbCBtYXhpbXVtID0gbWVtb3J5LmFsbG9jKCkKICAgIE1JU0MuR0VUX01PREVMX0RJTUVOU0lPTlMoRU5USVRZLkdFVF9FTlRJVFlfTU9ERUwoZW50aXR5KSwgbWluaW11bSwgbWF4aW11bSkKICAgIGxvY2FsIG1pbmltdW1fdmVjPGNvbnN0PiA9IHYzLm5ldyhtaW5pbXVtKQogICAgbG9jYWwgbWF4aW11bV92ZWM8Y29uc3Q+ID0gdjMubmV3KG1heGltdW0pCiAgICBsb2NhbCBkaW1lbnNpb25zPGNvbnN0PiA9IHsKICAgICAgICB4ID0gbWF4aW11bV92ZWMueSAtIG1pbmltdW1fdmVjLnksCiAgICAgICAgeSA9IG1heGltdW1fdmVjLnggLSBtaW5pbXVtX3ZlYy54LAogICAgICAgIHogPSBtYXhpbXVtX3ZlYy56IC0gbWluaW11bV92ZWMuegogICAgfQogICAgcmV0dXJuIGRpbWVuc2lvbnMKZW5kCmxvY2FsIGNvbG9yUiwgY29sb3JHLCBjb2xvckIgPSBtZW1vcnkuYWxsb2MoMSksIG1lbW9yeS5hbGxvYygxKSwgbWVtb3J5LmFsbG9jKDEpCmZ1bmN0aW9uIGNvcHlWZWhpY2xlRGF0YSh2ZWhpY2xlLCBjbG9uZVZlaGljbGUpCiAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX01PRF9LSVQoY2xvbmVWZWhpY2xlLCAwKQogICAgZm9yIGkgPSAxNywgMjIgZG8KICAgICAgICBWRUhJQ0xFLlRPR0dMRV9WRUhJQ0xFX01PRChjbG9uZVZlaGljbGUsIGksIFZFSElDTEUuSVNfVE9HR0xFX01PRF9PTih2ZWhpY2xlLCBpKSkKICAgIGVuZAogICAgZm9yIGkgPSAwLCA0OSBkbwogICAgICAgIGxvY2FsIG1vZFZhbHVlPGNvbnN0PiA9IFZFSElDTEUuR0VUX1ZFSElDTEVfTU9EKHZlaGljbGUsIGkpCiAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9NT0QoY2xvbmVWZWhpY2xlLCBpLCBtb2RWYWx1ZSkKICAgIGVuZAogICAgaWYgVkVISUNMRS5HRVRfSVNfVkVISUNMRV9QUklNQVJZX0NPTE9VUl9DVVNUT00odmVoaWNsZSkgdGhlbgogICAgICAgIFZFSElDTEUuR0VUX1ZFSElDTEVfQ1VTVE9NX1BSSU1BUllfQ09MT1VSKHZlaGljbGUsIGNvbG9yUiwgY29sb3JHLCBjb2xvckIpCiAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9DVVNUT01fUFJJTUFSWV9DT0xPVVIoY2xvbmVWZWhpY2xlLCBtZW1vcnkucmVhZF91Ynl0ZShjb2xvclIpLCBtZW1vcnkucmVhZF91Ynl0ZShjb2xvckcpLCBtZW1vcnkucmVhZF91Ynl0ZShjb2xvckIpKQogICAgZWxzZQogICAgICAgIFZFSElDTEUuR0VUX1ZFSElDTEVfTU9EX0NPTE9SXzEodmVoaWNsZSwgY29sb3JSLCBjb2xvckcsIGNvbG9yQikKICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX01PRF9DT0xPUl8xKGNsb25lVmVoaWNsZSwgbWVtb3J5LnJlYWRfdWJ5dGUoY29sb3JSKSwgbWVtb3J5LnJlYWRfdWJ5dGUoY29sb3JHKSwgbWVtb3J5LnJlYWRfdWJ5dGUoY29sb3JCKSkKICAgIGVuZAogICAgaWYgVkVISUNMRS5HRVRfSVNfVkVISUNMRV9TRUNPTkRBUllfQ09MT1VSX0NVU1RPTSh2ZWhpY2xlKSB0aGVuCiAgICAgICAgVkVISUNMRS5HRVRfVkVISUNMRV9DVVNUT01fU0VDT05EQVJZX0NPTE9VUih2ZWhpY2xlLCBjb2xvclIsIGNvbG9yRywgY29sb3JCKQogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfQ1VTVE9NX1NFQ09OREFSWV9DT0xPVVIoY2xvbmVWZWhpY2xlLCBtZW1vcnkucmVhZF91Ynl0ZShjb2xvclIpLCBtZW1vcnkucmVhZF91Ynl0ZShjb2xvckcpLCBtZW1vcnkucmVhZF91Ynl0ZShjb2xvckIpKQogICAgZWxzZQogICAgICAgIFZFSElDTEUuR0VUX1ZFSElDTEVfTU9EX0NPTE9SXzIodmVoaWNsZSwgY29sb3JSLCBjb2xvckcpCiAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9NT0RfQ09MT1JfMihjbG9uZVZlaGljbGUsIG1lbW9yeS5yZWFkX3VieXRlKGNvbG9yUiksIG1lbW9yeS5yZWFkX3VieXRlKGNvbG9yRykpCiAgICBlbmQKICAgIFZFSElDTEUuR0VUX1ZFSElDTEVfQ09MT1VSUyh2ZWhpY2xlLCBjb2xvclIsIGNvbG9yRykKICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfQ09MT1VSUyhjbG9uZVZlaGljbGUsIG1lbW9yeS5yZWFkX3VieXRlKGNvbG9yUiksIG1lbW9yeS5yZWFkX3VieXRlKGNvbG9yRykpCiAgICBWRUhJQ0xFLkdFVF9WRUhJQ0xFX0VYVFJBX0NPTE9VUlModmVoaWNsZSwgY29sb3JSLCBjb2xvckcpCiAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0VYVFJBX0NPTE9VUlMoY2xvbmVWZWhpY2xlLCBtZW1vcnkucmVhZF91Ynl0ZShjb2xvclIpLCBtZW1vcnkucmVhZF91Ynl0ZShjb2xvckcpKQogICAgVkVISUNMRS5HRVRfVkVISUNMRV9FWFRSQV9DT0xPVVJfNSh2ZWhpY2xlLCBjb2xvclIpIC0tIGludGVyaW9yCiAgICBWRUhJQ0xFLkdFVF9WRUhJQ0xFX0VYVFJBX0NPTE9VUl82KHZlaGljbGUsIGNvbG9yRykKICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRVhUUkFfQ09MT1VSXzUoY2xvbmVWZWhpY2xlLCBtZW1vcnkucmVhZF91Ynl0ZShjb2xvclIpKSAtLSBkYXNoYm9hcmQKICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRVhUUkFfQ09MT1VSXzYoY2xvbmVWZWhpY2xlLCBtZW1vcnkucmVhZF91Ynl0ZShjb2xvckcpKSAtLSBpbnRlcmlvcgogICAgVkVISUNMRS5HRVRfVkVISUNMRV9UWVJFX1NNT0tFX0NPTE9SKHZlaGljbGUsIGNvbG9yUiwgY29sb3JHLCBjb2xvckIpCiAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX1RZUkVfU01PS0VfQ09MT1IoY2xvbmVWZWhpY2xlLCBtZW1vcnkucmVhZF91Ynl0ZShjb2xvclIpLCBtZW1vcnkucmVhZF91Ynl0ZShjb2xvckcpLCBtZW1vcnkucmVhZF91Ynl0ZShjb2xvckIpKQogICAgVkVISUNMRS5HRVRfVkVISUNMRV9ORU9OX0NPTE9VUih2ZWhpY2xlLCBjb2xvclIsIGNvbG9yRywgY29sb3JCKQogICAgVkVISUNMRS5TRVRfVkVISUNMRV9ORU9OX0NPTE9VUihjbG9uZVZlaGljbGUsIG1lbW9yeS5yZWFkX3VieXRlKGNvbG9yUiksIG1lbW9yeS5yZWFkX3VieXRlKGNvbG9yRyksIG1lbW9yeS5yZWFkX3VieXRlKGNvbG9yQikpCiAgICBmb3IgaSA9IDAsIDMgZG8KICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX05FT05fRU5BQkxFRChjbG9uZVZlaGljbGUsIGksIFZFSElDTEUuR0VUX1ZFSElDTEVfTkVPTl9FTkFCTEVEKHZlaGljbGUsIGkpKQogICAgZW5kCiAgICBsb2NhbCB3aW5kb3dUaW50PGNvbnN0PiA9IFZFSElDTEUuR0VUX1ZFSElDTEVfV0lORE9XX1RJTlQodmVoaWNsZSkKICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfV0lORE9XX1RJTlQoY2xvbmVWZWhpY2xlLCB3aW5kb3dUaW50KQogICAgbG9jYWwgbGlnaHRzQ29sb3I8Y29uc3Q+ID0gVkVISUNMRS5HRVRfVkVISUNMRV9YRU5PTl9MSUdIVF9DT0xPUl9JTkRFWCh2ZWhpY2xlKQogICAgVkVISUNMRS5TRVRfVkVISUNMRV9YRU5PTl9MSUdIVF9DT0xPUl9JTkRFWChjbG9uZVZlaGljbGUsIGxpZ2h0c0NvbG9yKQogICAgVkVISUNMRS5TRVRfVkVISUNMRV9OVU1CRVJfUExBVEVfVEVYVF9JTkRFWChjbG9uZVZlaGljbGUsIFZFSElDTEUuR0VUX1ZFSElDTEVfTlVNQkVSX1BMQVRFX1RFWFRfSU5ERVgodmVoaWNsZSkpCiAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX05VTUJFUl9QTEFURV9URVhUKGNsb25lVmVoaWNsZSwgVkVISUNMRS5HRVRfVkVISUNMRV9OVU1CRVJfUExBVEVfVEVYVCh2ZWhpY2xlKSkKICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfVFlSRVNfQ0FOX0JVUlNUKGNsb25lVmVoaWNsZSwgVkVISUNMRS5HRVRfVkVISUNMRV9UWVJFU19DQU5fQlVSU1QodmVoaWNsZSkpCiAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0RJUlRfTEVWRUwoY2xvbmVWZWhpY2xlLCBWRUhJQ0xFLkdFVF9WRUhJQ0xFX0RJUlRfTEVWRUwodmVoaWNsZSkpCiAgICBmb3IgaSA9IDEsIDE0IGRvCiAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9FWFRSQShjbG9uZVZlaGljbGUsIGksIG5vdCBWRUhJQ0xFLklTX1ZFSElDTEVfRVhUUkFfVFVSTkVEX09OKHZlaGljbGUsIGkpKQogICAgZW5kCiAgICBsb2NhbCByb29mU3RhdGU8Y29uc3Q+ID0gVkVISUNMRS5HRVRfQ09OVkVSVElCTEVfUk9PRl9TVEFURSh2ZWhpY2xlKQogICAgaWYgcm9vZlN0YXRlID09IDEgb3Igcm9vZlN0YXRlID09IDIgdGhlbgogICAgICAgIFZFSElDTEUuTE9XRVJfQ09OVkVSVElCTEVfUk9PRihjbG9uZVZlaGljbGUsIHRydWUpCiAgICBlbmQKICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRU5HSU5FX09OKGNsb25lVmVoaWNsZSwgVkVISUNMRS5HRVRfSVNfVkVISUNMRV9FTkdJTkVfUlVOTklORyh2ZWhpY2xlKSwgdHJ1ZSwgdHJ1ZSkKZW5kCmZ1bmN0aW9uIEludmFsaWRfdmVoaWNsZV9jcmFzaGVzKHBpZCkKICAgIAogICAgbG9jYWwgcENvb3JkcyA9IHBsYXllcnMuZ2V0X3Bvc2l0aW9uKHBpZCkKICAgIGxvY2FsIHRyYWZmaWNMaWdodHMgPSB7fQogICAgdXRpbC5yZXF1ZXN0X21vZGVsKC02NTU2NDQzODIpIC0tIHRyYWZmaWMgbGlnaHRzCiAgICBmb3IgaSA9IDEsIDIwIGRvCiAgICAgICAgbG9jYWwgb2JqZWN0ID0gZW50aXRpZXMuY3JlYXRlX29iamVjdCgtNjU1NjQ0MzgyLCB2My5uZXcocENvb3Jkcy54ICsgbWF0aC5yYW5kb20oLTUsIDUpLCBwQ29vcmRzLnkgKyBtYXRoLnJhbmRvbSgtNSwgNSksIHBDb29yZHMueiArIG1hdGgucmFuZG9tKC0xLCAwKSkpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfUk9UQVRJT04ob2JqZWN0LCAwLCAwLCBtYXRoLnJhbmRvbSgwLCAzNjApLCAxLCB0cnVlKQogICAgICAgIHRyYWZmaWNMaWdodHNbI3RyYWZmaWNMaWdodHMgKyAxXSA9IG9iamVjdAogICAgZW5kCiAgICBsb2NhbCBzdG9wTGlnaHRzID0gZmFsc2UKICAgIHV0aWwuY3JlYXRlX3RpY2tfaGFuZGxlcihmdW5jdGlvbigpCiAgICAgICAgaWYgc3RvcExpZ2h0cyB0aGVuCiAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgIGVuZAogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1RSQUZGSUNMSUdIVF9PVkVSUklERSh0cmFmZmljTGlnaHRzW21hdGgucmFuZG9tKDEsICN0cmFmZmljTGlnaHRzKV0sIG1hdGgucmFuZG9tKDAsIDMpKQogICAgZW5kKQogICAgdXRpbC5yZXF1ZXN0X21vZGVsKDMyNTMyNzQ4MzQpIC0tIGJ1ZmZhbG8KICAgIGxvY2FsIHZlaGljbGVzID0ge30KICAgIGxvY2FsIGNyYXNoVmVoaWNsZTxjb25zdD4gPSBlbnRpdGllcy5jcmVhdGVfdmVoaWNsZSgzMjUzMjc0ODM0LCBwQ29vcmRzLCAwKQogICAgdmVoaWNsZXNbI3ZlaGljbGVzICsgMV0gPSBjcmFzaFZlaGljbGUKICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfTU9EX0tJVChjcmFzaFZlaGljbGUsIDApCiAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX05VTUJFUl9QTEFURV9URVhUKGNyYXNoVmVoaWNsZSwgIklDUkFTSFUiKQogICAgVkVISUNMRS5TRVRfVkVISUNMRV9NT0QoY3Jhc2hWZWhpY2xlLCAzNCwgMykKICAgIGZvciBpID0gMSwgMTAgZG8KICAgICAgICB2ZWhpY2xlc1sjdmVoaWNsZXMgKyAxXSA9IGNsb25lKGNyYXNoVmVoaWNsZSkKICAgIGVuZAogICAgdXRpbC55aWVsZCg1MDApCiAgICBmb3IgaSA9IDEsICN2ZWhpY2xlcyBkbwogICAgICAgIGRlbGV0ZV9lbnRpdHkodmVoaWNsZXNbaV0pCiAgICBlbmQKICAgIHV0aWwueWllbGQoNTAwKQogICAgc3RvcExpZ2h0cyA9IHRydWUKICAgIHV0aWwueWllbGQoNTAwKQogICAgZm9yIGkgPSAxLCAjdHJhZmZpY0xpZ2h0cyBkbwogICAgICAgIGRlbGV0ZV9lbnRpdHkodHJhZmZpY0xpZ2h0c1tpXSkKICAgIGVuZAogICAgU1RSRUFNSU5HLlNFVF9NT0RFTF9BU19OT19MT05HRVJfTkVFREVEKDMyNTMyNzQ4MzQpCiAgICBTVFJFQU1JTkcuU0VUX01PREVMX0FTX05PX0xPTkdFUl9ORUVERUQoLTY1NTY0NDM4MikKZW5kCi0tLS0tLS0t5bSp5rqDWFAKZnVuY3Rpb24geHBfb3ZlcihwaWQpCiAgICAKICAgIGxvY2FsIG1vZGVsX2FycmF5ID0ge3V0aWwuam9hYXQoImJvYXR0cmFpbGVyIiksdXRpbC5qb2FhdCgidHJhaWxlcnNtYWxsIiksdXRpbC5qb2FhdCgicmFrZXRyYWlsZXIiKSx9CiAgICBsb2NhbCBCQURfYXR0YWNoID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRChwaWQpKQogICAgbG9jYWwgZnVja19wZWQgPSBjcmVhdGVfcGVkKDI2ICwgdXRpbC5qb2FhdCgiaWdfa2F5bGVlIiksIEJBRF9hdHRhY2gueCwgQkFEX2F0dGFjaC55LCBCQURfYXR0YWNoLnosIDApCiAgICBFTlRJVFkuU0VUX0VOVElUWV9WSVNJQkxFKGZ1Y2tfcGVkLCBmYWxzZSkKICAgIGZvciBpID0gMSwgMywgMSBkbwogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQoZnVja19wZWQsIEJBRF9hdHRhY2gueCwgQkFEX2F0dGFjaC55LCBCQURfYXR0YWNoLnopCiAgICAgICAgZm9yIHNwYXduLCB2YWx1ZSBpbiBwYWlycyhtb2RlbF9hcnJheSkgZG8KICAgICAgICAgICAgbG9jYWwgdmVscyA9IHt9CiAgICAgICAgICAgIHZlbHNbc3Bhd25dID0gY3JlYXRlX3ZlaGljbGUodmFsdWUsIEJBRF9hdHRhY2gueCwgQkFEX2F0dGFjaC55LCBCQURfYXR0YWNoLnosIDApCiAgICAgICAgICAgIGZvciBhdHRhY2gsIHZhbCBpbiBwYWlycyh2ZWxzKSBkbwogICAgICAgICAgICAgICAgRU5USVRZMS5BVFRBQ0hfRU5USVRZX0JPTkVfVE9fRU5USVRZX0JPTkVfWV9GT1JXQVJEKHZhbCwgZnVja19wZWQsIDAsIDAsIHRydWUsIHRydWUpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIHV0aWwueWllbGQoNTAwKQogICAgICAgIG1lbnUudHJpZ2dlcl9jb21tYW5kcygiZXhwbG9kZSIgLi4gIHBsYXllcnMuZ2V0X25hbWUocGlkKSkKICAgIGVuZAplbmQKCgotLS0tLeaXoOaViOmZjeiQveS8nuW0qea6gwpmdW5jdGlvbiByb3RhdGVQb2ludCh4LCB5LCBjZW50ZXIsIGRlZ3JlZXMpCiAgICBsb2NhbCByYWRpYW5zID0gbWF0aC5yYWQoZGVncmVlcykKICAgIGxvY2FsIG5ld194ID0gKHggLSBjZW50ZXIueCkgKiBtYXRoLmNvcyhyYWRpYW5zKSAtICh5IC0gY2VudGVyLnkpICogbWF0aC5zaW4ocmFkaWFucykKICAgIGxvY2FsIG5ld195ID0gKHggLSBjZW50ZXIueCkgKiBtYXRoLnNpbihyYWRpYW5zKSArICh5IC0gY2VudGVyLnkpICogbWF0aC5jb3MocmFkaWFucykKICAgIHJldHVybiBjZW50ZXIueCArIG5ld194LCBjZW50ZXIueSArIG5ld195ICogMTkyMCAvIDEwODAKZW5kCmZ1bmN0aW9uIEludmFsaWRfcGFyYWNodXRlKCkKICAgIGxvY2FsIFRUUGVkID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEX1NDUklQVF9JTkRFWCgwKQogICAgbG9jYWwgU2VsZlBsYXllclBlZCA9IFBMQVlFUi5HRVRfUExBWUVSX1BFRF9TQ1JJUFRfSU5ERVgoUExBWUVSLlBMQVlFUl9JRCgpKQogICAgbG9jYWwgUHJldmlvdXNQbGF5ZXJQb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoU2VsZlBsYXllclBlZCwgdHJ1ZSkKICAgIGxvY2FsIHVzZXIgPSBQTEFZRVIuUExBWUVSX0lEKCkKICAgIGxvY2FsIHVzZXJfcGVkID0gUExBWUVSLlBMQVlFUl9QRURfSUQoKQogICAgbG9jYWwgcG9zID0gcGxheWVycy5nZXRfcG9zaXRpb24odXNlcikKICAgIGxvY2FsIHNwcGVkID0gUExBWUVSLlBMQVlFUl9QRURfSUQoKQogICAgbG9jYWwgcHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhzcHBlZCwgdHJ1ZSkKICAgIGZvciBpID0gMSwgNSBkbwogICAgICAgIGxvY2FsIFNlbGZQbGF5ZXJQb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoc3BwZWQsIHRydWUpCiAgICAgICAgbG9jYWwgUnVpbmVyMiA9IGNyZWF0ZV92ZWhpY2xlKHV0aWwuam9hYXQoIlJ1aW5lcjIiKSwgU2VsZlBsYXllclBvcy54LCBTZWxmUGxheWVyUG9zLnksIFNlbGZQbGF5ZXJQb3MueiwgRU5USVRZLkdFVF9FTlRJVFlfSEVBRElORyhUVFBlZCkpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRShSdWluZXIyLCB0cnVlKQogICAgICAgIFBFRC5TRVRfUEVEX0lOVE9fVkVISUNMRShzcHBlZCwgUnVpbmVyMiwgLTEpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTX05PX09GRlNFVChSdWluZXIyLCBTZWxmUGxheWVyUG9zLngsIFNlbGZQbGF5ZXJQb3MueSwgMjAwLCBmYWxzZSwgdHJ1ZSwgdHJ1ZSkKICAgICAgICB1dGlsLnlpZWxkKDEwMCkKICAgICAgICBWRUhJQ0xFMS5fU0VUX1ZFSElDTEVfUEFSQUNIVVRFX01PREVMKFJ1aW5lcjIsIAkzMjM1MzE5OTk5KQogICAgICAgIFZFSElDTEUxLl9TRVRfVkVISUNMRV9QQVJBQ0hVVEVfQUNUSVZFKFJ1aW5lcjIsIHRydWUpCiAgICAgICAgdXRpbC55aWVsZCgxMDApCiAgICAgICAgZGVsZXRlX2VudGl0eShSdWluZXIyKQogICAgZW5kCiAgICBmb3IgaSA9IDEsIDEwIGRvCiAgICAgICAgbG9jYWwgU2VsZlBsYXllclBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhzcHBlZCwgdHJ1ZSkKICAgICAgICBsb2NhbCBSdWluZXIyID0gY3JlYXRlX3ZlaGljbGUodXRpbC5qb2FhdCgiUnVpbmVyMiIpLCBTZWxmUGxheWVyUG9zLngsIFNlbGZQbGF5ZXJQb3MueSwgU2VsZlBsYXllclBvcy56LCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKFRUUGVkKSkKICAgICAgICBQRUQuU0VUX1BFRF9JTlRPX1ZFSElDTEUoc3BwZWQsIFJ1aW5lcjIsIC0xKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQoUnVpbmVyMiwgU2VsZlBsYXllclBvcy54LCBTZWxmUGxheWVyUG9zLnksIDIwMDAsIGZhbHNlLCB0cnVlLCB0cnVlKQogICAgICAgIHV0aWwueWllbGQoMTIwKQogICAgICAgIFZFSElDTEUxLl9TRVRfVkVISUNMRV9QQVJBQ0hVVEVfTU9ERUwoUnVpbmVyMiwgCTI2MDg3MzkzMSkKICAgICAgICBWRUhJQ0xFMS5fU0VUX1ZFSElDTEVfUEFSQUNIVVRFX0FDVElWRShSdWluZXIyLCB0cnVlKQogICAgICAgIHV0aWwueWllbGQoMTIwKQogICAgICAgIGRlbGV0ZV9lbnRpdHkoUnVpbmVyMikKICAgIGVuZAogICAgZm9yIGkgPSAxLCAxMCBkbwogICAgICAgIGxvY2FsIFNlbGZQbGF5ZXJQb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoc3BwZWQsIHRydWUpCiAgICAgICAgbG9jYWwgUnVpbmVyMiA9IGNyZWF0ZV92ZWhpY2xlKHV0aWwuam9hYXQoIlJ1aW5lcjIiKSwgU2VsZlBsYXllclBvcy54LCBTZWxmUGxheWVyUG9zLnksIFNlbGZQbGF5ZXJQb3MueiwgRU5USVRZLkdFVF9FTlRJVFlfSEVBRElORyhUVFBlZCkpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRShSdWluZXIyLCB0cnVlKQogICAgICAgIFBFRC5TRVRfUEVEX0lOVE9fVkVISUNMRShzcHBlZCwgUnVpbmVyMiwgLTEpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTX05PX09GRlNFVChSdWluZXIyLCBTZWxmUGxheWVyUG9zLngsIFNlbGZQbGF5ZXJQb3MueSwgMTAwMCwgZmFsc2UsIHRydWUsIHRydWUpCiAgICAgICAgdXRpbC55aWVsZCgxMDApCiAgICAgICAgVkVISUNMRTEuX1NFVF9WRUhJQ0xFX1BBUkFDSFVURV9NT0RFTChSdWluZXIyLCAJNTQ2MjUyMjExKQogICAgICAgIFZFSElDTEUxLl9TRVRfVkVISUNMRV9QQVJBQ0hVVEVfQUNUSVZFKFJ1aW5lcjIsIHRydWUpCiAgICAgICAgdXRpbC55aWVsZCgxMDApCiAgICAgICAgZGVsZXRlX2VudGl0eShSdWluZXIyKQogICAgZW5kCiAgICBmb3IgaSA9IDEsIDggZG8KICAgICAgICBsb2NhbCBTZWxmUGxheWVyUG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHNwcGVkLCB0cnVlKQogICAgICAgIGxvY2FsIFJ1aW5lcjIgPSBjcmVhdGVfdmVoaWNsZSh1dGlsLmpvYWF0KCJSdWluZXIyIiksIFNlbGZQbGF5ZXJQb3MueCwgU2VsZlBsYXllclBvcy55LCBTZWxmUGxheWVyUG9zLnosIEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcoVFRQZWQpKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0lOVklOQ0lCTEUoUnVpbmVyMiwgdHJ1ZSkKICAgICAgICBQRUQuU0VUX1BFRF9JTlRPX1ZFSElDTEUoc3BwZWQsIFJ1aW5lcjIsIC0xKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQoUnVpbmVyMiwgU2VsZlBsYXllclBvcy54LCBTZWxmUGxheWVyUG9zLnksIDgwMCwgZmFsc2UsIHRydWUsIHRydWUpCiAgICAgICAgdXRpbC55aWVsZCgyMDApCiAgICAgICAgVkVISUNMRTEuX1NFVF9WRUhJQ0xFX1BBUkFDSFVURV9NT0RFTChSdWluZXIyLCAJMTQ4NTExNzU4KQogICAgICAgIFZFSElDTEUxLl9TRVRfVkVISUNMRV9QQVJBQ0hVVEVfQUNUSVZFKFJ1aW5lcjIsIHRydWUpCiAgICAgICAgdXRpbC55aWVsZCgyMDApCiAgICAgICAgZGVsZXRlX2VudGl0eShSdWluZXIyKQogICAgZW5kCiAgICBmb3IgaSA9IDEsIDEwIGRvCiAgICAgICAgbG9jYWwgU2VsZlBsYXllclBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhzcHBlZCwgdHJ1ZSkKICAgICAgICBsb2NhbCBSdWluZXIyID0gY3JlYXRlX3ZlaGljbGUodXRpbC5qb2FhdCgiUnVpbmVyMiIpLCBTZWxmUGxheWVyUG9zLngsIFNlbGZQbGF5ZXJQb3MueSwgU2VsZlBsYXllclBvcy56LCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKFRUUGVkKSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKFJ1aW5lcjIsIHRydWUpCiAgICAgICAgUEVELlNFVF9QRURfSU5UT19WRUhJQ0xFKHNwcGVkLCBSdWluZXIyLCAtMSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFNfTk9fT0ZGU0VUKFJ1aW5lcjIsIFNlbGZQbGF5ZXJQb3MueCwgU2VsZlBsYXllclBvcy55LCA1MDAsIGZhbHNlLCB0cnVlLCB0cnVlKQogICAgICAgIHV0aWwueWllbGQoMTAwKQogICAgICAgIFZFSElDTEUxLl9TRVRfVkVISUNMRV9QQVJBQ0hVVEVfTU9ERUwoUnVpbmVyMiwgCTI2MDg3MzkzMSkKICAgICAgICBWRUhJQ0xFMS5fU0VUX1ZFSElDTEVfUEFSQUNIVVRFX0FDVElWRShSdWluZXIyLCB0cnVlKQogICAgICAgIHV0aWwueWllbGQoMTAwKQogICAgICAgIGRlbGV0ZV9lbnRpdHkoUnVpbmVyMikKICAgIGVuZAogICAgdXRpbC55aWVsZCgyMDApCiAgICBmb3IgaSA9IDEsIDUgZG8KICAgICAgICBsb2NhbCBTZWxmUGxheWVyUG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHNwcGVkLCB0cnVlKQogICAgICAgIGxvY2FsIFJ1aW5lcjIgPSBjcmVhdGVfdmVoaWNsZSh1dGlsLmpvYWF0KCJSdWluZXIyIiksIFNlbGZQbGF5ZXJQb3MueCwgU2VsZlBsYXllclBvcy55LCBTZWxmUGxheWVyUG9zLnosIEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcoVFRQZWQpKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0lOVklOQ0lCTEUoUnVpbmVyMiwgdHJ1ZSkKICAgICAgICBQRUQuU0VUX1BFRF9JTlRPX1ZFSElDTEUoc3BwZWQsIFJ1aW5lcjIsIC0xKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQoUnVpbmVyMiwgU2VsZlBsYXllclBvcy54LCBTZWxmUGxheWVyUG9zLnksIDMwMCwgZmFsc2UsIHRydWUsIHRydWUpCiAgICAgICAgdXRpbC55aWVsZCg1MDApCiAgICAgICAgVkVISUNMRTEuX1NFVF9WRUhJQ0xFX1BBUkFDSFVURV9NT0RFTChSdWluZXIyLCAxMzgxMTA1ODg5KQogICAgICAgIFZFSElDTEUxLl9TRVRfVkVISUNMRV9QQVJBQ0hVVEVfQUNUSVZFKFJ1aW5lcjIsIHRydWUpCiAgICAgICAgdXRpbC55aWVsZCg1MDApCiAgICAgICAgZGVsZXRlX2VudGl0eShSdWluZXIyKQogICAgZW5kCiAgICBmb3IgaSA9IDEsIDI1IGRvCiAgICAgICAgbG9jYWwgU2VsZlBsYXllclBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhzcHBlZCwgdHJ1ZSkKICAgICAgICBsb2NhbCBSdWluZXIyID0gY3JlYXRlX3ZlaGljbGUodXRpbC5qb2FhdCgiUnVpbmVyMiIpLCBTZWxmUGxheWVyUG9zLngsIFNlbGZQbGF5ZXJQb3MueSwgU2VsZlBsYXllclBvcy56LCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKFRUUGVkKSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKFJ1aW5lcjIsIHRydWUpCiAgICAgICAgUEVELlNFVF9QRURfSU5UT19WRUhJQ0xFKHNwcGVkLCBSdWluZXIyLCAtMSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFNfTk9fT0ZGU0VUKFJ1aW5lcjIsIFNlbGZQbGF5ZXJQb3MueCwgU2VsZlBsYXllclBvcy55LCAyMDAsIGZhbHNlLCB0cnVlLCB0cnVlKQogICAgICAgIHV0aWwueWllbGQoMTUwKQogICAgICAgIFZFSElDTEUxLl9TRVRfVkVISUNMRV9QQVJBQ0hVVEVfTU9ERUwoUnVpbmVyMiwgCTE1MDA5MjUwMTYpCiAgICAgICAgVkVISUNMRTEuX1NFVF9WRUhJQ0xFX1BBUkFDSFVURV9BQ1RJVkUoUnVpbmVyMiwgdHJ1ZSkKICAgICAgICB1dGlsLnlpZWxkKDE1MCkKICAgICAgICBkZWxldGVfZW50aXR5KFJ1aW5lcjIpCiAgICBlbmQKICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQoc3BwZWQsIHBwb3MueCwgcHBvcy55LCBwcG9zLnosIGZhbHNlLCB0cnVlLCB0cnVlKQogICAgZm9yIG4gPSAwICwgMiBkbwogICAgICAgIGxvY2FsIG9iamVjdF9oYXNoID0gdXRpbC5qb2FhdCgicHJvcF9sb2dwaWxlXzA2YiIpCiAgICAgICAgcmVxdWVzdF9tb2RlbChvYmplY3RfaGFzaCkKICAgICAgICBQTEFZRVIuU0VUX1BMQVlFUl9QQVJBQ0hVVEVfTU9ERUxfT1ZFUlJJREUoUExBWUVSLlBMQVlFUl9JRCgpLG9iamVjdF9oYXNoKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQoU2VsZlBsYXllclBlZCwgMCwwLDEwMCwgZmFsc2UsIHRydWUsIHRydWUpCiAgICAgICAgV0VBUE9OLkdJVkVfREVMQVlFRF9XRUFQT05fVE9fUEVEKFNlbGZQbGF5ZXJQZWQsIDB4RkJBQjU3NzYsIDEwMCwgZmFsc2UpCiAgICAgICAgdXRpbC55aWVsZCg4MDApCiAgICAgICAgZm9yIGkgPSAwICwgMSBkbwogICAgICAgICAgICBQRUQuRk9SQ0VfUEVEX1RPX09QRU5fUEFSQUNIVVRFKFNlbGZQbGF5ZXJQZWQpCiAgICAgICAgZW5kCiAgICAgICAgdXRpbC55aWVsZCg4MDApCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTX05PX09GRlNFVChTZWxmUGxheWVyUGVkLCBQcmV2aW91c1BsYXllclBvcy54LCBQcmV2aW91c1BsYXllclBvcy55LCBQcmV2aW91c1BsYXllclBvcy56LCBmYWxzZSwgdHJ1ZSwgdHJ1ZSkKCiAgICAgICAgbG9jYWwgb2JqZWN0X2hhc2gyID0gdXRpbC5qb2FhdCgicHJvcF9iZWFjaF9wYXJhc29sXzAzIikKICAgICAgICByZXF1ZXN0X21vZGVsKG9iamVjdF9oYXNoMikKICAgICAgICBQTEFZRVIuU0VUX1BMQVlFUl9QQVJBQ0hVVEVfTU9ERUxfT1ZFUlJJREUoUExBWUVSLlBMQVlFUl9JRCgpLG9iamVjdF9oYXNoMikKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFNfTk9fT0ZGU0VUKFNlbGZQbGF5ZXJQZWQsIDAsMCwxMDAsIDAsIDAsIDEpCiAgICAgICAgV0VBUE9OLkdJVkVfREVMQVlFRF9XRUFQT05fVE9fUEVEKFNlbGZQbGF5ZXJQZWQsIDB4RkJBQjU3NzYsIDEwMCwgZmFsc2UpCiAgICAgICAgdXRpbC55aWVsZCg4MDApCiAgICAgICAgZm9yIGkgPSAwICwgMSBkbwogICAgICAgICAgICBQRUQuRk9SQ0VfUEVEX1RPX09QRU5fUEFSQUNIVVRFKFNlbGZQbGF5ZXJQZWQpCiAgICAgICAgZW5kCiAgICAgICAgdXRpbC55aWVsZCg4MDApCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTX05PX09GRlNFVChTZWxmUGxheWVyUGVkLCBQcmV2aW91c1BsYXllclBvcy54LCBQcmV2aW91c1BsYXllclBvcy55LCBQcmV2aW91c1BsYXllclBvcy56LCBmYWxzZSwgdHJ1ZSwgdHJ1ZSkKICAgIGVuZAogICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTX05PX09GRlNFVChTZWxmUGxheWVyUGVkLCBQcmV2aW91c1BsYXllclBvcy54LCBQcmV2aW91c1BsYXllclBvcy55LCBQcmV2aW91c1BsYXllclBvcy56LCBmYWxzZSwgdHJ1ZSwgdHJ1ZSkKICAgIFBMQVlFUi5TRVRfUExBWUVSX1BBUkFDSFVURV9QQUNLX01PREVMX09WRVJSSURFKFBMQVlFUi5QTEFZRVJfSUQoKSwgMHhGQkY3RDIxRikKICAgIFdFQVBPTi5HSVZFX0RFTEFZRURfV0VBUE9OX1RPX1BFRCh1c2VyX3BlZCwgMHhGQkFCNTc3NiwgMTAwLCBmYWxzZSkKICAgIFRBU0suVEFTS19QQVJBQ0hVVEVfVE9fVEFSR0VUKHVzZXJfcGVkLCBwb3MueCwgcG9zLnksIHBvcy56KQogICAgdXRpbC55aWVsZCgpCiAgICBUQVNLLkNMRUFSX1BFRF9UQVNLU19JTU1FRElBVEVMWSh1c2VyX3BlZCkKICAgIHV0aWwueWllbGQoMzAwKQogICAgV0VBUE9OLkdJVkVfREVMQVlFRF9XRUFQT05fVE9fUEVEKHVzZXJfcGVkLCAweEZCQUI1Nzc2LCAxMDAsIGZhbHNlKQogICAgUExBWUVSLkNMRUFSX1BMQVlFUl9QQVJBQ0hVVEVfUEFDS19NT0RFTF9PVkVSUklERSh1c2VyKQogICAgdXRpbC55aWVsZCgxMDAwKQogICAgZm9yIGkgPSAxLCAxMCBkbwogICAgICAgIHV0aWwuc3Bvb2Zfc2NyaXB0KCJmcmVlbW9kZSIsIFNZU1RFTS5XQUlUKQogICAgZW5kCiAgICBFTlRJVFkuU0VUX0VOVElUWV9IRUFMVEgodXNlcl9wZWQsIDApCiAgICBORVRXT1JLLk5FVFdPUktfUkVTVVJSRUNUX0xPQ0FMX1BMQVlFUihwb3MueCxwb3MueSxwb3MueiwgMCwgZmFsc2UsIGZhbHNlLCAwKQogICAgZm9yIGkgPSAxLCAyIGRvCiAgICAgICAgbG9jYWwgU2VsZlBsYXllclBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhzcHBlZCwgdHJ1ZSkKICAgICAgICBsb2NhbCBSdWluZXIyID0gY3JlYXRlX3ZlaGljbGUodXRpbC5qb2FhdCgiUnVpbmVyMiIpLCBTZWxmUGxheWVyUG9zLngsIFNlbGZQbGF5ZXJQb3MueSwgU2VsZlBsYXllclBvcy56LCBFTlRJVFkuR0VUX0VOVElUWV9IRUFESU5HKFRUUGVkKSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKFJ1aW5lcjIsIHRydWUpCiAgICAgICAgUEVELlNFVF9QRURfSU5UT19WRUhJQ0xFKHNwcGVkLCBSdWluZXIyLCAtMSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFNfTk9fT0ZGU0VUKFJ1aW5lcjIsIFNlbGZQbGF5ZXJQb3MueCwgU2VsZlBsYXllclBvcy55LCAxNTAsIGZhbHNlLCB0cnVlLCB0cnVlKQogICAgICAgIHV0aWwueWllbGQoMjAwKQogICAgICAgIFZFSElDTEUxLl9TRVRfVkVISUNMRV9QQVJBQ0hVVEVfTU9ERUwoUnVpbmVyMiwgCTE1MDA5MjUwMTYpCiAgICAgICAgVkVISUNMRTEuX1NFVF9WRUhJQ0xFX1BBUkFDSFVURV9BQ1RJVkUoUnVpbmVyMiwgdHJ1ZSkKICAgICAgICB1dGlsLnlpZWxkKDIwMCkKICAgICAgICBkZWxldGVfZW50aXR5KFJ1aW5lcjIpCiAgICBlbmQKICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQoc3BwZWQsIHBwb3MueCwgcHBvcy55LCBwcG9zLnosIGZhbHNlLCB0cnVlLCB0cnVlKQogICAgZm9yIGkgPSAxLCAyIGRvCiAgICAgICAgUExBWUVSLlNFVF9QTEFZRVJfUEFSQUNIVVRFX1BBQ0tfTU9ERUxfT1ZFUlJJREUoUExBWUVSLlBMQVlFUl9JRCgpLCAweEZCRjdEMjFGKQogICAgICAgIFdFQVBPTi5HSVZFX0RFTEFZRURfV0VBUE9OX1RPX1BFRCh1c2VyX3BlZCwgMHhGQkFCNTc3NiwgMTAwLCBmYWxzZSkKICAgICAgICBUQVNLLlRBU0tfUEFSQUNIVVRFX1RPX1RBUkdFVCh1c2VyX3BlZCwgcG9zLngsIHBvcy55LCBwb3MueikKICAgICAgICB1dGlsLnlpZWxkKCkKICAgICAgICBUQVNLLkNMRUFSX1BFRF9UQVNLU19JTU1FRElBVEVMWSh1c2VyX3BlZCkKICAgICAgICB1dGlsLnlpZWxkKDIwMCkKICAgICAgICBXRUFQT04uR0lWRV9ERUxBWUVEX1dFQVBPTl9UT19QRUQodXNlcl9wZWQsIDB4RkJBQjU3NzYsIDEwMCwgZmFsc2UpCiAgICAgICAgUExBWUVSLkNMRUFSX1BMQVlFUl9QQVJBQ0hVVEVfUEFDS19NT0RFTF9PVkVSUklERSh1c2VyKQogICAgICAgIHV0aWwueWllbGQoNDUwMCkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9IRUFMVEgodXNlcl9wZWQsIDApCiAgICAgICAgTkVUV09SSy5ORVRXT1JLX1JFU1VSUkVDVF9MT0NBTF9QTEFZRVIocG9zLngscG9zLnkscG9zLnosIDAsIGZhbHNlLCBmYWxzZSwgMCkKICAgIGVuZAplbmQKCgotLS0tLei4ouWHuuWupOWGhQpmdW5jdGlvbiBLaWNrX3Jvb20ocGlkKQogICAgCiAgICBsb2NhbCBwZWQgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKQogICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKHBlZCwgZmFsc2UpCiAgICBsb2NhbCBnbGl0Y2hfaGFzaCA9IHV0aWwuam9hYXQoInBfc3Bpbm5pbmdfYW51c19zIikKICAgIGxvY2FsIHBvb3B5X2J1dHQgPSB1dGlsLmpvYWF0KCJicmlja2FkZTIiKQogICAgcmVxdWVzdF9tb2RlbChnbGl0Y2hfaGFzaCkKICAgIHJlcXVlc3RfbW9kZWwocG9vcHlfYnV0dCkKICAgIGZvciBpID0gMSwgNSBkbwogICAgICAgIGxvY2FsIHN0dXBpZF9vYmplY3QgPSBlbnRpdGllcy5jcmVhdGVfb2JqZWN0KGdsaXRjaF9oYXNoLCBwb3MpCiAgICAgICAgbG9jYWwgZ2xpdGNoX3ZlaGljbGUgPSBlbnRpdGllcy5jcmVhdGVfdmVoaWNsZShwb29weV9idXR0LCBwb3MsIDApCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfVklTSUJMRShzdHVwaWRfb2JqZWN0LCBmYWxzZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9WSVNJQkxFKGdsaXRjaF92ZWhpY2xlLCBmYWxzZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKGdsaXRjaF92ZWhpY2xlLCB0cnVlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPTExJU0lPTihzdHVwaWRfb2JqZWN0LCB0cnVlLCB0cnVlKQogICAgICAgIEVOVElUWS5BUFBMWV9GT1JDRV9UT19FTlRJVFkoZ2xpdGNoX3ZlaGljbGUsIDEsIDAuMCwgMTAsIDEwLCAwLjAsIDAuMCwgMC4wLCAwLCAxLCAxLCAxLCAwLCAxKQogICAgICAgIHV0aWwueWllbGQoNTAwKQogICAgICAgIGRlbGV0ZV9lbnRpdHkoc3R1cGlkX29iamVjdCkKICAgICAgICBkZWxldGVfZW50aXR5KGdsaXRjaF92ZWhpY2xlKQogICAgICAgIHV0aWwueWllbGQoNTAwKSAgICAgCiAgICBlbmQKZW5kCgotLS0tLeaguOW8uQpmdW5jdGlvbiBudWNsZWFyX2JvbWJfcGxheWVyKHBpZCkKICAgIAogICAgbG9jYWwgVGFyZ2V0UGxheWVyUGVkID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhUYXJnZXRQbGF5ZXJQZWQsIHRydWUpCiAgICBsb2NhbCBPYmplY3RfcGl6emExID0gY3JlYXRlX3ZlaGljbGUoMTEzMTkxMjI3Nixwb3MueCwgcG9zLnksIHBvcy56LDApCiAgICBsb2NhbCBPYmplY3RfcGl6emEyID1jcmVhdGVfb2JqZWN0KDI1MzI3OTU4OCxwb3MueCwgcG9zLnksIHBvcy56KQogICAgICAgIHBvcy55ID0gcG9zLnkgKyAyCiAgICAgICAgcG9zLnogPSBwb3MueiArIDcwIAogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0FMUEhBKE9iamVjdF9waXp6YTEsIDI1NSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9WSVNJQkxFKE9iamVjdF9waXp6YTEsIGZhbHNlLCAwKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQoT2JqZWN0X3BpenphMSwgcG9zLngsIHBvcy55LCBwb3MueiwgZmFsc2UsIHRydWUsIHRydWUpCiAgICAgICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKE9iamVjdF9waXp6YTIsT2JqZWN0X3BpenphMSwgMCwgIDAuMCwgMC4wMCwgMC4wMCwgMS4wLCAxLjAsMSwgdHJ1ZSwgZmFsc2UsIHRydWUsIGZhbHNlLCAwLCB0cnVlLCAwKQogICAgdXRpbC55aWVsZCg1MDAwKQogICAgZG8KICAgICAgICBvcmJpdGFsKHBpZCkKICAgICAgICBkZWxldGVfZW50aXR5KE9iamVjdF9waXp6YTEpCiAgICAgICAgZGVsZXRlX2VudGl0eShPYmplY3RfcGl6emEyKQogICAgZW5kCmVuZAoKCi0tLS0t6ay855Wc546p5a62CmxvY2FsIG9iamVjdF9oYXNoID0gdXRpbC5qb2FhdCgicHJvcF9sZF9mZXJyaXNfd2hlZWwiKQpmdW5jdGlvbiBvYmpfY3JlYXQoaW5kZXgpCiAgICBvYmplY3RfaGFzaCA9IHV0aWwuam9hYXQob2JqZWN0X3N0dWZmLm9iamVjdHNbaW5kZXhdKQplbmQKbG9jYWwgZGVsYXkgPSAxNTAKZnVuY3Rpb24gb2JqX2NyZWF0X3NwZWVkKGFtb3VudCkKICAgIGRlbGF5ID0gYW1vdW50CmVuZApmdW5jdGlvbiBHaG9zdF9CZWFzdF9QbGF5ZXIocGlkKQogICAgCiAgICBpZiBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSB+PSAwIHRoZW4KICAgICAgICBsb2NhbCBwZWQgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKQogICAgICAgIGxvY2FsIHBvcyA9IHBsYXllcnMuZ2V0X3Bvc2l0aW9uKHBpZCkKICAgICAgICBsb2NhbCBnbGl0Y2hfaGFzaCA9IG9iamVjdF9oYXNoCiAgICAgICAgbG9jYWwgbWRsID0gdXRpbC5qb2FhdCgicmFsbHl0cnVjayIpCiAgICAgICAgcmVxdWVzdF9tb2RlbChnbGl0Y2hfaGFzaCkKICAgICAgICByZXF1ZXN0X21vZGVsKG1kbCkKICAgICAgICBsb2NhbCBvYmogPSBlbnRpdGllcy5jcmVhdGVfb2JqZWN0KGdsaXRjaF9oYXNoLCBwb3MpCiAgICAgICAgbG9jYWwgdmVoID0gZW50aXRpZXMuY3JlYXRlX3ZlaGljbGUobWRsLCBwb3MsIDApCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfVklTSUJMRShvYmosIGZhbHNlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1ZJU0lCTEUodmVoLCBmYWxzZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKG9iaiwgdHJ1ZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT0xMSVNJT04ob2JqLCB0cnVlLCB0cnVlKQogICAgICAgIEVOVElUWS5BUFBMWV9GT1JDRV9UT19FTlRJVFkodmVoLCAxLCAwLjAsIDEwLjAsIDEwLjAsIDAuMCwgMC4wLCAwLjAsIDAsIDEsIDEsIDEsIDAsIDEpCiAgICAgICAgdXRpbC55aWVsZChkZWxheSkKICAgICAgICBkZWxldGVfZW50aXR5KG9iaikKICAgICAgICBkZWxldGVfZW50aXR5KHZlaCkKICAgIGVuZAplbmQKCi0tLS0t5q275Lqh5bGP6Zqc5Ye75p2ACmZ1bmN0aW9uIERlYXRoX2JhcnJpZXIocGlkKQogICAgCiAgICBsb2NhbCBwZWQgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKQogICAgbG9jYWwgcG9zID0gcGxheWVycy5nZXRfcG9zaXRpb24ocGlkKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgIGxvY2FsIGhhc2ggPSB1dGlsLmpvYWF0KCJwcm9wX3dpbmRtaWxsXzAxIikKICAgIGxvY2FsIG1kbCA9IHV0aWwuam9hYXQoInJhbGx5dHJ1Y2siKQogICAgcmVxdWVzdF9tb2RlbChoYXNoKQogICAgcmVxdWVzdF9tb2RlbChtZGwpCiAgICBmb3IgaSA9IDAsIDUgZG8KICAgICAgICBpZiBUQVNLLklTX1BFRF9XQUxLSU5HKHBlZCkgdGhlbgogICAgICAgICAgICBzcGF3bl9wb3MgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMocGVkLCAwLjAsIDEuMywgMC4wKQogICAgICAgIGVsc2UKICAgICAgICAgICAgc3Bhd25fcG9zID0gcGxheWVycy5nZXRfcG9zaXRpb24ocGlkKQogICAgICAgIGVuZAogICAgICAgIGxvY2FsIG9iaiA9IGVudGl0aWVzLmNyZWF0ZV9vYmplY3QoaGFzaCwgc3Bhd25fcG9zKQogICAgICAgIGxvY2FsIHZlaCA9IGVudGl0aWVzLmNyZWF0ZV92ZWhpY2xlKG1kbCwgc3Bhd25fcG9zLCAwKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1ZJU0lCTEUob2JqLCBmYWxzZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9WSVNJQkxFKHZlaCwgZmFsc2UpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfSU5WSU5DSUJMRShvYmosIHRydWUpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09MTElTSU9OKG9iaiwgdHJ1ZSwgdHJ1ZSkKICAgICAgICBFTlRJVFkuQVBQTFlfRk9SQ0VfVE9fRU5USVRZKHZlaCwgMSwgMC4wLCAxMCwgMTAsIDAuMCwgMC4wLCAwLjAsIDAsIDEsIDEsIDEsIDAsIDEpCiAgICAgICAgdXRpbC55aWVsZCgxNTApCiAgICAgICAgZGVsZXRlX2VudGl0eShvYmopCiAgICAgICAgZGVsZXRlX2VudGl0eSh2ZWgpCiAgICBlbmQKZW5kCgotLS0tLeW8uuWItuWHu+adgApmdW5jdGlvbiBGb3JjZV9raWxsKGluZGV4LCB2ZWgsIHBpZCkKICAgIAogICAgbG9jYWwgcGVkID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhwZWQpCiAgICBsb2NhbCB2ZWhpY2xlID0gdXRpbC5qb2FhdCh2ZWgpCiAgICByZXF1ZXN0X21vZGVsKHZlaGljbGUpCgogICAgaWYgdmVoID09ICJLaGFuamFsaSIgdGhlbgogICAgICAgIGhlaWdodCA9IDIuOAogICAgICAgIG9mZnNldCA9IDAKICAgIGVsc2VpZiB2ZWggPT0gIkFQQyIgdGhlbgogICAgICAgIGhlaWdodCA9IDMuNAogICAgICAgIG9mZnNldCA9IC0xLjUKICAgIGVuZAoKICAgIGlmIFRBU0suSVNfUEVEX1NUSUxMKHBlZCkgdGhlbgogICAgICAgIGRpc3RhbmNlID0gMAogICAgZWxzZWlmIG5vdCBUQVNLLklTX1BFRF9TVElMTChwZWQpIHRoZW4KICAgICAgICBkaXN0YW5jZSA9IDMKZW5kCiAgICBsb2NhbCB2ZWhpY2xlMSA9IGVudGl0aWVzLmNyZWF0ZV92ZWhpY2xlKHZlaGljbGUsIEVOVElUWS5HRVRfT0ZGU0VUX0ZST01fRU5USVRZX0lOX1dPUkxEX0NPT1JEUyhwZWQsIG9mZnNldCwgZGlzdGFuY2UsIGhlaWdodCksIEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcocGVkKSkKICAgIGxvY2FsIHZlaGljbGUyID0gZW50aXRpZXMuY3JlYXRlX3ZlaGljbGUodmVoaWNsZSwgcG9zLCAwKQogICAgbG9jYWwgdmVoaWNsZTMgPSBlbnRpdGllcy5jcmVhdGVfdmVoaWNsZSh2ZWhpY2xlLCBwb3MsIDApCiAgICBsb2NhbCB2ZWhpY2xlNCA9IGVudGl0aWVzLmNyZWF0ZV92ZWhpY2xlKHZlaGljbGUsIHBvcywgMCkKICAgIGxvY2FsIHNwYXduZWRfdmVocyA9IHt2ZWhpY2xlNCwgdmVoaWNsZTMsIHZlaGljbGUyLCB2ZWhpY2xlMX0KICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWSh2ZWhpY2xlMiwgdmVoaWNsZTEsIDAsIDAsIDMsIDAsIDAsIDAsIC0xODAsIHRydWUsIGZhbHNlLCB0cnVlLCBmYWxzZSwgMCwgdHJ1ZSwgMCkKICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWSh2ZWhpY2xlMywgdmVoaWNsZTEsIDAsIDMsIDMsIDAsIDAsIDAsIC0xODAsIHRydWUsIGZhbHNlLCB0cnVlLCBmYWxzZSwgMCwgdHJ1ZSwgMCkKICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWSh2ZWhpY2xlNCwgdmVoaWNsZTEsIDAsIDMsIDAsIDAsIDAsIDAsIDAsIHRydWUsIGZhbHNlLCB0cnVlLCBmYWxzZSwgMCwgdHJ1ZSwgMCkKICAgIEVOVElUWS5TRVRfRU5USVRZX1ZJU0lCTEUodmVoaWNsZTEsIGZhbHNlKQogICAgdXRpbC55aWVsZCg1MDAwKQogICAgZm9yIGkgPSAxLCAjc3Bhd25lZF92ZWhzIGRvCiAgICAgICAgZGVsZXRlX2VudGl0eShzcGF3bmVkX3ZlaHNbaV0pCiAgICBlbmQKZW5kCgoKCi0tLS3lpKfng5/oirEKZnVuY3Rpb24gYmlnX2ZpcmV3b3JrcygpCiAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpCiAgICBsb2NhbCBoYXNoID0gdXRpbC5qb2FhdCgid2VhcG9uX2ZpcmV3b3JrIikKICAgIHJlcXVlc3Rfd2VhcG9uX2Fzc2V0KGhhc2gpCiAgICBXRUFQT04uR0lWRV9XRUFQT05fVE9fUEVEKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGhhc2gsIDEyMCwgdHJ1ZSwgZmFsc2UpCgogICAgTUlTQy5TSE9PVF9TSU5HTEVfQlVMTEVUX0JFVFdFRU5fQ09PUkRTKHBvcy54LTkwLW1hdGgucmFuZG9tKDAsIDQwKSwgcG9zLnktOTAsIHBvcy56LCBwb3MueC05MC1tYXRoLnJhbmRvbSgwLCA0MCksIHBvcy55LTkwLCBwb3MueisyMCwgMjAwLCBmYWxzZSwgaGFzaCwgMCwgdHJ1ZSwgZmFsc2UsIDE1MCkKICAgIHV0aWwueWllbGQoNTAwKQogICAgTUlTQy5TSE9PVF9TSU5HTEVfQlVMTEVUX0JFVFdFRU5fQ09PUkRTKHBvcy54LTkwLW1hdGgucmFuZG9tKDAsIDQwKSwgcG9zLnktOTAsIHBvcy56LCBwb3MueC05MC1tYXRoLnJhbmRvbSgwLCA0MCksIHBvcy55LTkwLCBwb3MueisyMCwgMjAwLCBmYWxzZSwgaGFzaCwgMCwgdHJ1ZSwgZmFsc2UsIDE1MCkKICAgIHV0aWwueWllbGQoNTAwKQogICAgTUlTQy5TSE9PVF9TSU5HTEVfQlVMTEVUX0JFVFdFRU5fQ09PUkRTKHBvcy54LTkwLW1hdGgucmFuZG9tKDAsIDQwKSwgcG9zLnktOTAsIHBvcy56LCBwb3MueC05MC1tYXRoLnJhbmRvbSgwLCA0MCksIHBvcy55LTkwLCBwb3MueisyMCwgMjAwLCBmYWxzZSwgaGFzaCwgMCwgdHJ1ZSwgZmFsc2UsIDE1MCkKICAgIHV0aWwueWllbGQoNTAwKQogICAgTUlTQy5TSE9PVF9TSU5HTEVfQlVMTEVUX0JFVFdFRU5fQ09PUkRTKHBvcy54LTkwLW1hdGgucmFuZG9tKDAsIDQwKSwgcG9zLnktOTAsIHBvcy56LCBwb3MueC05MC1tYXRoLnJhbmRvbSgwLCA0MCksIHBvcy55LTkwLCBwb3MueisyMCwgMjAwLCBmYWxzZSwgaGFzaCwgMCwgdHJ1ZSwgZmFsc2UsIDE1MCkKICAgIHV0aWwueWllbGQoNTAwKQogICAgTUlTQy5TSE9PVF9TSU5HTEVfQlVMTEVUX0JFVFdFRU5fQ09PUkRTKHBvcy54LTkwLW1hdGgucmFuZG9tKDAsIDQwKSwgcG9zLnktOTAsIHBvcy56LCBwb3MueC05MC1tYXRoLnJhbmRvbSgwLCA0MCksIHBvcy55LTkwLCBwb3MueisyMCwgMjAwLCBmYWxzZSwgaGFzaCwgMCwgdHJ1ZSwgZmFsc2UsIDE1MCkKICAgIHV0aWwueWllbGQoNTAwKQplbmQKLS3ngqvlvanng5/oirEKZnVuY3Rpb24gbmV3X2ZpcmV3b3JrKCkKICAgIGxvY2FsIGVmZmVjdCA9ICJzY3JfaW5kZXBfZmlyZXdvcmtzIgogICAgbG9jYWwgZWZmZWN0X25hbWUgPSAic2NyX2luZGVwX2ZpcmV3b3JrX3N0YXJidXJzdCIKICAgIHJlcXVlc3RfcHRmeF9hc3NldChlZmZlY3QpCiAgICBHUkFQSElDUy5VU0VfUEFSVElDTEVfRlhfQVNTRVQoZWZmZWN0KQogICAgaW5kZXBfZmlyZXdvcmtzX3IgPSBtYXRoLnJhbmRvbSgwLCAyNTUpIC8gMjU1CiAgICBpbmRlcF9maXJld29ya3NfZyA9IG1hdGgucmFuZG9tKDAsIDI1NSkgLyAyNTUKICAgIGluZGVwX2ZpcmV3b3Jrc19iID0gbWF0aC5yYW5kb20oMCwgMjU1KSAvIDI1NQogICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIG1hdGgucmFuZG9tKC0xNSwgMTUpLCA1MCttYXRoLnJhbmRvbSgwLCAxMCksIDApLS3lgY/np7vph4/lnZDmoIcs5YmN5ZCOLOW3puWPsyzkuIrkuIsKICAgIEdSQVBISUNTLlNUQVJUX05FVFdPUktFRF9QQVJUSUNMRV9GWF9OT05fTE9PUEVEX0FUX0NPT1JEKGVmZmVjdF9uYW1lLCBwb3MueCwgcG9zLnksIHBvcy56LCAwLCAwLCAwLCAxLjAsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgR1JBUEhJQ1MuU0VUX1BBUlRJQ0xFX0ZYX05PTl9MT09QRURfQ09MT1VSKGluZGVwX2ZpcmV3b3Jrc19yLCBpbmRlcF9maXJld29ya3NfZywgaW5kZXBfZmlyZXdvcmtzX2IpCiAgICB1dGlsLnlpZWxkKG1hdGgucmFuZG9tKDUwMCwgMjAwMCkpCmVuZAotLeekvOiKseahtgpmdW5jdGlvbiBuZXdfZmlyZXdvcmsyKCkKICAgIGxvY2FsIGVmZmVjdCA9ICJzY3JfaW5kZXBfZmlyZXdvcmtzIgogICAgbG9jYWwgZWZmZWN0X25hbWUgPSAic2NyX2luZGVwX2ZpcmV3b3JrX2ZvdW50YWluIgogICAgcmVxdWVzdF9wdGZ4X2Fzc2V0KGVmZmVjdCkKICAgIEdSQVBISUNTLlVTRV9QQVJUSUNMRV9GWF9BU1NFVChlZmZlY3QpCiAgICBpbmRlcF9maXJld29ya3NfciA9IG1hdGgucmFuZG9tKDAsIDI1NSkgLyAyNTUKICAgIGluZGVwX2ZpcmV3b3Jrc19nID0gbWF0aC5yYW5kb20oMCwgMjU1KSAvIDI1NQogICAgaW5kZXBfZmlyZXdvcmtzX2IgPSBtYXRoLnJhbmRvbSgwLCAyNTUpIC8gMjU1CiAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgbWF0aC5yYW5kb20oLTE1LCAxNSksIDUwK21hdGgucmFuZG9tKDAsIDEwKSwgMCktLeWBj+enu+mHj+WdkOaghyzliY3lkI4s5bem5Y+zLOS4iuS4iwogICAgR1JBUEhJQ1MuU1RBUlRfTkVUV09SS0VEX1BBUlRJQ0xFX0ZYX05PTl9MT09QRURfQVRfQ09PUkQoZWZmZWN0X25hbWUsIHBvcy54LCBwb3MueSwgcG9zLnosIDAsIDAsIDAsIDEuMCwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCiAgICBHUkFQSElDUy5TRVRfUEFSVElDTEVfRlhfTk9OX0xPT1BFRF9DT0xPVVIoaW5kZXBfZmlyZXdvcmtzX3IsIGluZGVwX2ZpcmV3b3Jrc19nLCBpbmRlcF9maXJld29ya3NfYikKICAgIHV0aWwueWllbGQobWF0aC5yYW5kb20oNTAwLCAyMDAwKSkKZW5kCgoKLS0tLeaEpOaAkueahOmjnuacugpsb2NhbCBudW1QbGFuZXMgPSAwCmxvY2FsIEFuZ3J5X3BsYW5lX2VudHMgPSB7fQpmdW5jdGlvbiBBbmdyeV9wbGFuZSh0b2dnbGVkKQogICAgYW5ncnlfcGxhbmVfdG9nZ2xlZCA9IHRvZ2dsZWQKICAgIHdoaWxlIGFuZ3J5X3BsYW5lX3RvZ2dsZWQgZG8KICAgICAgICBpZiAjQW5ncnlfcGxhbmVfZW50cyA8IDE1IHRoZW4KICAgICAgICAgICAgbG9jYWwgcGVkSGFzaCA9IHV0aWwuam9hYXQoInNfbV95X2JsYWNrb3BzXzAxIikKICAgICAgICAgICAgbG9jYWwgcGxhbmVNb2RlbCA9IHBsYW5lc1ttYXRoLnJhbmRvbSgjcGxhbmVzKV0KICAgICAgICAgICAgbG9jYWwgcGxhbmVIYXNoID0gdXRpbC5qb2FhdChwbGFuZU1vZGVsKQogICAgICAgICAgICByZXF1ZXN0X21vZGVscyhwbGFuZUhhc2gsIHBlZEhhc2gpCiAgICAgICAgICAgIGxvY2FsIHBvcyA9IHBsYXllcnMuZ2V0X3Bvc2l0aW9uKFBMQVlFUi5QTEFZRVJfSUQoKSkKICAgICAgICAgICAgbG9jYWwgcGxhbmUgPSBWRUhJQ0xFLkNSRUFURV9WRUhJQ0xFKHBsYW5lSGFzaCwgcG9zLngsIHBvcy55LCBwb3MueiwgQ0FNLkdFVF9HQU1FUExBWV9DQU1fUk9UKDApLnosIHRydWUsIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgREVDT1JBVE9SLkRFQ09SX1NFVF9JTlQocGxhbmUsICJDYXNpbm9fR2FtZV9JbmZvX0RlY29yYXRvciIsIDEgPDwgMykKCiAgICAgICAgICAgIE5FVFdPUksuU0VUX05FVFdPUktfSURfQ0FOX01JR1JBVEUoTkVUV09SSy5WRUhfVE9fTkVUKHBsYW5lKSwgZmFsc2UpCiAgICAgICAgICAgIGxvY2FsIHBpbG90ID0gZW50aXRpZXMuY3JlYXRlX3BlZCgyNiwgcGVkSGFzaCwgcG9zLCAwKQogICAgICAgICAgICBQRUQuU0VUX1BFRF9JTlRPX1ZFSElDTEUocGlsb3QsIHBsYW5lLCAtMSkKICAgICAgICAgICAgcG9zID0gZ2V0X3JhbmRvbV9vZmZzZXRfZnJvbV9lbnRpdHkoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgNTAuMCwgMTUwLjApCiAgICAgICAgICAgIHBvcy56ID0gcG9zLnogKyA3NS4wCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEUyhwbGFuZSwgcG9zLngsIHBvcy55LCBwb3MueiwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UpCiAgICAgICAgICAgIGxvY2FsIHRoZXRhID0gcmFuZG9tX2Zsb2F0KDAsIDIgKiBtYXRoLnBpKQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9IRUFESU5HKHBsYW5lLCBtYXRoLmRlZyh0aGV0YSkpCiAgICAgICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRk9SV0FSRF9TUEVFRChwbGFuZSwgNjAuMCkKICAgICAgICAgICAgVkVISUNMRS5TRVRfSEVMSV9CTEFERVNfRlVMTF9TUEVFRChwbGFuZSkKICAgICAgICAgICAgVkVISUNMRS5DT05UUk9MX0xBTkRJTkdfR0VBUihwbGFuZSwgMykKICAgICAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9GT1JDRV9BRlRFUkJVUk5FUihwbGFuZSwgdHJ1ZSkKICAgICAgICAgICAgVEFTSy5UQVNLX1BMQU5FX01JU1NJT04ocGlsb3QsIHBsYW5lLCAwLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwLjAsIDAuMCwgMC4wLCA2LCAxMDAuMCwgMC4wLCAwLjAsIDgwLjAsIDUwLjAsIGZhbHNlKQogICAgICAgICAgICB0YWJsZS5pbnNlcnQoQW5ncnlfcGxhbmVfZW50cywgcGxhbmUpO3RhYmxlLmluc2VydChBbmdyeV9wbGFuZV9lbnRzLCBwaWxvdCkKICAgICAgICAgICAgbnVtUGxhbmVzID0gbnVtUGxhbmVzICsgMQogICAgICAgICAgICB1dGlsLnlpZWxkKDMwMCkKICAgICAgICBlbmQKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAogICAgZm9yIGssIGVudCBpbiBwYWlycyhBbmdyeV9wbGFuZV9lbnRzKSBkbwogICAgICAgIGRlbGV0ZV9lbnRpdHkoZW50KQogICAgICAgIEFuZ3J5X3BsYW5lX2VudHMgPSB7fQogICAgZW5kCmVuZAoKLS0tLS3nu5jliLbooYDph4/mnaEKbG9jYWwgdHRzZWxlY3RlZE9wdCA9IDEKbG9jYWwgc2VsZmFpbWVkUGVkID0gMApmdW5jdGlvbiBwZWRfZHJhd19tZXRob2Qob3B0KQogICAgdHRzZWxlY3RlZE9wdCA9IG9wdAplbmQKZnVuY3Rpb24gUGVkSGVhbHRoQmFybWFpbkxvb3AoKQogICAgaWYgdHRzZWxlY3RlZE9wdCA9PSA0IHRoZW4KICAgICAgICBpZiBub3QgUExBWUVSLklTX1BMQVlFUl9GUkVFX0FJTUlORyhQTEFZRVIuUExBWUVSX0lEKCkpIHRoZW4KICAgICAgICAgICAgc2VsZmFpbWVkUGVkID0gMCByZXR1cm4KICAgICAgICBlbmQKICAgICAgICBsb2NhbCBwRW50aXR5IDxjb25zdD4gPSBtZW1vcnkuYWxsb2NfaW50KCkKICAgICAgICBpZiBQTEFZRVIuR0VUX0VOVElUWV9QTEFZRVJfSVNfRlJFRV9BSU1JTkdfQVQoUExBWUVSLlBMQVlFUl9JRCgpLCBwRW50aXR5KSB0aGVuCiAgICAgICAgICAgIGxvY2FsIGVudGl0eSA9IG1lbW9yeS5yZWFkX2ludChwRW50aXR5KQogICAgICAgICAgICBpZiBFTlRJVFkuSVNfRU5USVRZX0FfUEVEKGVudGl0eSkgdGhlbiBzZWxmYWltZWRQZWQgPSBlbnRpdHkgZW5kCiAgICAgICAgZW5kCiAgICAgICAgZHJhd19oZWFsdGhfYmFyKHNlbGZhaW1lZFBlZCwgMTAwMC4wKQogICAgZWxzZQogICAgICAgIGZvciBfLCBwZWQgaW4gaXBhaXJzKGdldF9wZWRzX2luX3BsYXllcl9yYW5nZShQTEFZRVIuUExBWUVSX0lEKCksIDUwMC4wKSkgZG8KICAgICAgICAgICAgaWYgRU5USVRZLklTX0VOVElUWV9PTl9TQ1JFRU4ocGVkKSBvciBFTlRJVFkuSEFTX0VOVElUWV9DTEVBUl9MT1NfVE9fRU5USVRZKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHBlZCwgVHJhY2VGbGFnLndvcmxkKSB0aGVuCiAgICAgICAgICAgICAgaWYgdHRzZWxlY3RlZE9wdCA9PSAxIGFuZCBQRUQuSVNfUEVEX0FfUExBWUVSKHBlZCkgdGhlbgogICAgICAgICAgICAgICAgZHJhd19oZWFsdGhfYmFyKHBlZCwgMzUwLjApCiAgICAgICAgICAgICAgZWxzZWlmIHR0c2VsZWN0ZWRPcHQgPT0gMiBhbmQgbm90IFBFRC5JU19QRURfQV9QTEFZRVIocGVkKSB0aGVuCiAgICAgICAgICAgICAgICBkcmF3X2hlYWx0aF9iYXIocGVkLCAzNTAuMCkKICAgICAgICAgICAgICBlbHNlaWYgdHRzZWxlY3RlZE9wdCA9PSAzIHRoZW4KICAgICAgICAgICAgICAgIGRyYXdfaGVhbHRoX2JhcihwZWQsIDM1MC4wKQogICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQKCi0tLS0tLeWIh+aNouWKqOS9nAotLS0t5by55ZCJ5LuWCmZ1bmN0aW9uIFBsYXlfZ3VpdGFyKG9uKQogICAgaWYgb24gdGhlbgogICAgICAgIHJlcXVlc3RfYW5pbV9kaWN0KCJhbWJAd29ybGRfaHVtYW5fbXVzaWNpYW5AZ3VpdGFyQG1hbGVAaWRsZV9hIikKICAgICAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSx0cnVlKQogICAgICAgIHBndWl0YXIgPSBjcmVhdGVfb2JqZWN0KHV0aWwuam9hYXQoInByb3BfYWNjX2d1aXRhcl8wMSIpLCBwb3MueCwgcG9zLnksIHBvcy56KQogICAgICAgIFRBU0suVEFTS19QTEFZX0FOSU0oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgImFtYkB3b3JsZF9odW1hbl9tdXNpY2lhbkBndWl0YXJAbWFsZUBpZGxlX2EiLCAiaWRsZV9iIiwgMywgMywgLTEsIDUxLCAwLCBmYWxzZSwgZmFsc2UsIGZhbHNlKSAtLXBsYXkgYW5pbSAKICAgICAgICBFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkocGd1aXRhciwgUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgUEVELkdFVF9QRURfQk9ORV9JTkRFWChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAyNDgxOCksIC0wLjEsMC4zMSwwLjEsMC4wLDIwLjAsMTUwLjAsIGZhbHNlLCB0cnVlLCBmYWxzZSwgdHJ1ZSwgMSwgdHJ1ZSwgMCkKICAgICAgICBQRUQuU0VUX0VOQUJMRV9IQU5EQ1VGRlMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSkKICAgIGVsc2UKICAgICAgICBUQVNLLkNMRUFSX1BFRF9UQVNLU19JTU1FRElBVEVMWShQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgIFBFRC5TRVRfRU5BQkxFX0hBTkRDVUZGUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgICAgICBkZWxldGVfZW50aXR5KHBndWl0YXIpCiAgICBlbmQKZW5kCi0tLS0t5o6M5peL55CDCmZ1bmN0aW9uIFBhbG1fc3Bpbl9iYWxsKG9uKQogICAgaWYgb24gdGhlbgogICAgICAgIHJlcXVlc3RfYW5pbV9kaWN0KCJhbmltQG1wX3BsYXllcl9pbnRpbmNhcmZyZWFrb3V0c3RkQHBzQCIpCiAgICAgICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksdHJ1ZSkKICAgICAgICBoYW5kX2JvbGwgPSBjcmVhdGVfb2JqZWN0KHV0aWwuam9hYXQoInByb3BfYm93bGluZ19iYWxsIiksIHBvcy54LCBwb3MueSwgcG9zLnopCiAgICAgICAgVEFTSy5UQVNLX1BMQVlfQU5JTShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAiYW5pbUBtcF9wbGF5ZXJfaW50aW5jYXJmcmVha291dHN0ZEBwc0AiLCAiaWRsZV9hX2ZwIiwgMTAsIDMsIC0xLCA1MSwgNSwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgICAgICBFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkoaGFuZF9ib2xsLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBQRUQuR0VUX1BFRF9CT05FX0lOREVYKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDI0ODE4KSwgMC4zMCwwLjUzLDAsMC4yLDcwLDM0MCwgZmFsc2UsIHRydWUsIGZhbHNlLCB0cnVlLCAxLCB0cnVlLCAwKQogICAgICAgIFBFRC5TRVRfRU5BQkxFX0hBTkRDVUZGUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlKQogICAgZWxzZQogICAgICAgIFRBU0suQ0xFQVJfUEVEX1RBU0tTX0lNTUVESUFURUxZKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICAgICAgUEVELlNFVF9FTkFCTEVfSEFORENVRkZTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKQogICAgICAgIGRlbGV0ZV9lbnRpdHkoaGFuZF9ib2xsKQogICAgZW5kCmVuZAotLS0tLeS5nuaxggpmdW5jdGlvbiBzZWVrX2hlbHAob24pCiAgICBpZiBvbiB0aGVuCiAgICAgICAgcmVxdWVzdF9hbmltX2RpY3QoImFtYkB3b3JsZF9odW1hbl9idW1fZnJlZXdheUBtYWxlQGJhc2UiKQogICAgICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLHRydWUpCiAgICAgICAgYmVnZ2VycyA9IGNyZWF0ZV9vYmplY3QodXRpbC5qb2FhdCgicHJvcF9iZWdnZXJzX3NpZ25fMDMiKSwgcG9zLngsIHBvcy55LCBwb3MueikKICAgICAgICBUQVNLLlRBU0tfUExBWV9BTklNKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksICJhbWJAd29ybGRfaHVtYW5fYnVtX2ZyZWV3YXlAbWFsZUBiYXNlIiwgImJhc2UiLCAzLCAzLCAtMSwgNTEsIDAsIGZhbHNlLCBmYWxzZSwgZmFsc2UpIC0tcGxheSBhbmltIAogICAgICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWShiZWdnZXJzLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBQRUQuR0VUX1BFRF9CT05FX0lOREVYKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDU4ODY4KSwgMC4xOSwwLjE4LDAuMCw1LjAsMC4wLDQwLjAsIGZhbHNlLCB0cnVlLCBmYWxzZSwgdHJ1ZSwgMSwgdHJ1ZSwgMCkKICAgICAgICBQRUQuU0VUX0VOQUJMRV9IQU5EQ1VGRlMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSkKICAgIGVsc2UKICAgICAgICBUQVNLLkNMRUFSX1BFRF9UQVNLU19JTU1FRElBVEVMWShQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgIFBFRC5TRVRfRU5BQkxFX0hBTkRDVUZGUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgICAgICBkZWxldGVfZW50aXR5KGJlZ2dlcnMpCiAgICBlbmQKZW5kCi0tLS0t54yu6IqxCmZ1bmN0aW9uIG9mZmVyX2Zsb3dlcihvbikKICAgIGlmIG9uIHRoZW4KICAgICAgICByZXF1ZXN0X2FuaW1fZGljdCgiYW5pbUBoZWlzdHNAaHVtYW5lX2xhYnNAZmluYWxlQGtleWNhcmRzIikKICAgICAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSx0cnVlKQogICAgICAgIHJvc2UgPSBjcmVhdGVfb2JqZWN0KHV0aWwuam9hYXQoInByb3Bfc2luZ2xlX3Jvc2UiKSwgcG9zLngsIHBvcy55LCBwb3MueikKICAgICAgICBUQVNLLlRBU0tfUExBWV9BTklNKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksICJhbmltQGhlaXN0c0BodW1hbmVfbGFic0BmaW5hbGVAa2V5Y2FyZHMiLCAicGVkX2FfZW50ZXJfbG9vcCIsIDMsIDMsIC0xLCA1MSwgMCwgZmFsc2UsIGZhbHNlLCBmYWxzZSkgLS1wbGF5IGFuaW0gCiAgICAgICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKHJvc2UsIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIFBFRC5HRVRfUEVEX0JPTkVfSU5ERVgoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMTg5MDUpLCAwLjEzLDAuMTUsMC4wLC0xMDAuMCwwLjAsLTIwLjAsIGZhbHNlLCB0cnVlLCBmYWxzZSwgdHJ1ZSwgMSwgdHJ1ZSwgMCkKICAgICAgICBQRUQuU0VUX0VOQUJMRV9IQU5EQ1VGRlMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSkKICAgIGVsc2UKICAgICAgICBUQVNLLkNMRUFSX1BFRF9UQVNLU19JTU1FRElBVEVMWShQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgIFBFRC5TRVRfRU5BQkxFX0hBTkRDVUZGUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgICAgICBkZWxldGVfZW50aXR5KHJvc2UpCiAgICBlbmQKZW5kCi0tLS3miZPkvJ4KZnVuY3Rpb24gaG9sZF91bWJyZWxsYShvbikKICAgIGlmIG9uIHRoZW4KICAgICAgICByZXF1ZXN0X2FuaW1fZGljdCgicmNtbmlnZWwxZCIpCiAgICAgICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksdHJ1ZSkKICAgICAgICBteXVtYnJlbGxhID0gY3JlYXRlX29iamVjdCh1dGlsLmpvYWF0KCJwX2FtYl9icm9sbHlfMDEiKSwgcG9zLngsIHBvcy55LCBwb3MueikKICAgICAgICBUQVNLLlRBU0tfUExBWV9BTklNKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksICJyY21uaWdlbDFkIiwgImJhc2VfY2x1Yl9zaG91bGRlciIsIDMsIDMsIC0xLCA1MSwgMCwgZmFsc2UsIGZhbHNlLCBmYWxzZSkgLS1wbGF5IGFuaW0gCiAgICAgICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKG15dW1icmVsbGEsIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIFBFRC5HRVRfUEVEX0JPTkVfSU5ERVgoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMjg0MjIpLCAwLjA3MDAsMC4wMTAwLDAuMTEwMCwyLjM0MDIzOTMsLTE1MC45NjA1NzIxLDU3LjMzNzQ5MTYsIGZhbHNlLCB0cnVlLCBmYWxzZSwgdHJ1ZSwgMSwgdHJ1ZSwgMCkKICAgICAgICBQRUQuU0VUX0VOQUJMRV9IQU5EQ1VGRlMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSkKICAgIGVsc2UKICAgICAgICBUQVNLLkNMRUFSX1BFRF9UQVNLU19JTU1FRElBVEVMWShQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgIFBFRC5TRVRfRU5BQkxFX0hBTkRDVUZGUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgICAgICBkZWxldGVfZW50aXR5KG15dW1icmVsbGEpCiAgICBlbmQKZW5kCgoKCi0tLS0t54G16a2C5Ye656qNCmZ1bmN0aW9uIE91dF9ib2R5KHRvZ2dsZSkKICAgIGlmIHRvZ2dsZSB0aGVuCiAgICAgICAgc291bF9jbG9uZSA9IFBFRC5DTE9ORV9QRUQoUExBWUVSLlBMQVlFUl9QRURfSUQoKSx0cnVlLCB0cnVlLCB0cnVlKQogICAgICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhzb3VsX2Nsb25lLCBmYWxzZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgcG9zLngtMiwgcG9zLnksIHBvcy56KQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0FMUEhBKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDg3LCBmYWxzZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKHNvdWxfY2xvbmUsdHJ1ZSkKICAgICAgICByZXF1ZXN0X2FuaW1fZGljdCgibW92ZV9jcmF3bCIpCiAgICAgICAgY2FsbV9wZWQoc291bF9jbG9uZSwgdHJ1ZSkKICAgIGVsc2UKICAgICAgICBsb2NhbCBjbG9uZXBlZHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhzb3VsX2Nsb25lLCBmYWxzZSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgY2xvbmVwZWRwb3MueCxjbG9uZXBlZHBvcy55LGNsb25lcGVkcG9zLnosIGZhbHNlLCBmYWxzZSkKICAgICAgICBkZWxldGVfZW50aXR5KHNvdWxfY2xvbmUpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQUxQSEEoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMjU1LCBmYWxzZSkKICAgIGVuZAplbmQKCgotLS0tLemZhOWKoOWbveaXlwpmdW5jdGlvbiBhdHRhY2hfZmxhZyhpbmRleCkKICAgIGxvY2FsIHBsYXllcl9jdXJfY2FyID0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19JTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgIGlmIHBsYXllcl9jdXJfY2FyIH49IDAgdGhlbiAKICAgICAgICBsb2NhbCBoYXNoID0gdXRpbC5qb2FhdChjb3VudHJ5X2ZsYWdzW2luZGV4XSkKICAgICAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoc291bF9jbG9uZSwgZmFsc2UpCiAgICAgICAgbG9jYWwgZmxhZyA9IGNyZWF0ZV9vYmplY3QoaGFzaCwgcG9zLngsIHBvcy55LCBwb3MueikKICAgICAgICBsb2NhbCBodCA9IGdldF9tb2RlbF9zaXplKEVOVElUWS5HRVRfRU5USVRZX01PREVMKHBsYXllcl9jdXJfY2FyKSkuegogICAgICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWShmbGFnLCBwbGF5ZXJfY3VyX2NhciwgMCwgMCwgMCwgaHQsIDAsIDAsIDAsIHRydWUsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDAsIHRydWUsIDApCiAgICBlbmQKZW5kCgoKLS0tLS1ob21lcueykuWtkApmdW5jdGlvbiBob21lcl9wYXJ0aWNsZSgpCiAgICBsb2NhbCBwbGF5ZXJfcG9zID0gcGxheWVycy5nZXRfcG9zaXRpb24oUExBWUVSLlBMQVlFUl9JRCgpKQogICAgcmVxdWVzdF9wdGZ4X2Fzc2V0KCJzY3Jfc3VtMl9oYWwiKQogICAgR1JBUEhJQ1MuVVNFX1BBUlRJQ0xFX0ZYX0FTU0VUKCJzY3Jfc3VtMl9oYWwiKQogICAgR1JBUEhJQ1MuU1RBUlRfTkVUV09SS0VEX1BBUlRJQ0xFX0ZYX05PTl9MT09QRURfQVRfQ09PUkQodGJsX3RvX3JhbmRvbShob21lcl9wdHhmKSwgcGxheWVyX3Bvcy54LCBwbGF5ZXJfcG9zLnksIHBsYXllcl9wb3MueiwgMCwgMCwgMCwgMi41LCBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgdXRpbC55aWVsZCgyMDApCmVuZAoKCi0tLei9rOmtguaeqgpmdW5jdGlvbiBTb3VsX0d1bigpCiAgICBsb2NhbCBlbnQgPSBnZXRfZW50aXR5X3BsYXllcl9pc19haW1pbmdfYXQoUExBWUVSLlBMQVlFUl9JRCgpKQogICAgaWYgUEVELklTX1BFRF9TSE9PVElORyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSB0aGVuCiAgICAgICAgaWYgRU5USVRZLklTX0VOVElUWV9BX1BFRChlbnQpIHRoZW4KICAgICAgICAgICAgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKGVudCwgZmFsc2UpCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPT1JEU19OT19PRkZTRVQoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgcG9zLngsIHBvcy55LCBwb3MueiwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgaWYgUEVELklTX1BFRF9BX1BMQVlFUihlbnQpIHRoZW4KICAgICAgICAgICAgICAgIGxvY2FsIHBpZCA9IE5FVFdPUksuTkVUV09SS19HRVRfUExBWUVSX0lOREVYX0ZST01fUEVEKGVudCkKICAgICAgICAgICAgICAgIGNvcHlfb3V0Zml0KHBpZCkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgbG9jYWwgc291bCA9IEVOVElUWS5HRVRfRU5USVRZX01PREVMKGVudCkKICAgICAgICAgICAgICAgIGNoYW5nZV9tb2RlbChQTEFZRVIuUExBWUVSX0lEKCksIHNvdWwpCiAgICAgICAgICAgICAgICBkZWxldGVfZW50aXR5KGVudCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZWxzZWlmIEVOVElUWS5JU19FTlRJVFlfQV9WRUhJQ0xFKGVudCkgdGhlbgogICAgICAgICAgICBsb2NhbCBkcml2ZXIgPSBWRUhJQ0xFLkdFVF9QRURfSU5fVkVISUNMRV9TRUFUKGVudCwgLTEpCiAgICAgICAgICAgIGlmIFZFSElDTEUuR0VUX1ZFSElDTEVfTlVNQkVSX09GX1BBU1NFTkdFUlMoZW50LHRydWUsZmFsc2UpID49IDEgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgc291bHZlaCA9IEVOVElUWS5HRVRfRU5USVRZX01PREVMKGRyaXZlcikKICAgICAgICAgICAgICAgIGlmIG5vdCBQRUQuSVNfUEVEX0FfUExBWUVSKGRyaXZlcikgdGhlbgogICAgICAgICAgICAgICAgICAgIGRlbGV0ZV9lbnRpdHkoZHJpdmVyKQogICAgICAgICAgICAgICAgICAgIGNoYW5nZV9tb2RlbChQTEFZRVIuUExBWUVSX0lEKCksIHNvdWx2ZWgpCiAgICAgICAgICAgICAgICAgICAgUEVELlNFVF9QRURfSU5UT19WRUhJQ0xFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGVudCwgLTEpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgotLS0tLUJsYWNrbGlzdAotLeS6keabtOaWsEJsYWNrbGlzdAphc3luY19odHRwLmluaXQoImh0dHA6Ly9jaGVjay5jbnNha3VyYS50b3AiLCAiL3N0YW5kL2JsYWNrbGlzdC5qc29uIixmdW5jdGlvbihpbmZvLGhlYWRlcixyZXNwb25zZSkKICAgIGlmIHJlc3BvbnNlID09IDIwMCB0aGVuCiAgICAgICAgbG9jYWwgbGlzdCA9IEpzb25Ub1RhYmxlKGluZm8pCiAgICAgICAgbG9jYWwgY29udGVudCA9IFRhYmxlVG9Kc29uKGxpc3QpCiAgICAgICAgbG9jYWwgZGlyID0gZmlsZXN5c3RlbS5zY3JpcHRzX2RpcigpIC4uICdkYWlkYWlTY3JpcHQvYmxhY2tsaXN0Lmpzb24nCiAgICAgICAgZmlsZXdyaXRlKGRpciwgIncrIiwgY29udGVudCkKICAgIGVuZAplbmQpO2FzeW5jX2h0dHAuZGlzcGF0Y2goKSAKCi0t5omn6KGMQmxhY2tsaXN0CmxvY2FsIGJsYWNrbGlzdHBsYXllcnMgPSB7fQpmdW5jdGlvbiBCbGFja19saXN0KCkKICAgIC0tLS3or7vlj5bpu5HlkI3ljZUKICAgIGlmICNibGFja2xpc3RwbGF5ZXJzIDwgMSB0aGVuCiAgICAgICAgbG9jYWwgcGF0aCA9IGZpbGVzeXN0ZW0uc2NyaXB0c19kaXIoKSAuLiAnZGFpZGFpU2NyaXB0L2JsYWNrbGlzdC5qc29uJwogICAgICAgIGxvY2FsIGRhdGEgPSBmaWxlcmVhZChwYXRoLCAncicsICcqYWxsJykKICAgICAgICBibGFja2xpc3RwbGF5ZXJzID0gSnNvblRvVGFibGUoZGF0YSkKICAgIGVuZAogICAgLS0tLeWIpOaWrem7keWQjeWNlQogICAgZm9yIHBpZCA9IDAsIDMxIGRvCiAgICAgICAgbG9jYWwgbmFtZSA9IFBMQVlFUi5HRVRfUExBWUVSX05BTUUocGlkKXBsYXllcnMuZXhpc3RzKHBpZCkKICAgICAgICBsb2NhbCBteW5hbWUgPSBQTEFZRVIuR0VUX1BMQVlFUl9OQU1FKFBMQVlFUi5QTEFZRVJfSUQoKSkKCiAgICAgICAgaWYgdGFibGVfZmluZChibGFja2xpc3RwbGF5ZXJzLCBteW5hbWUpIHRoZW4KICAgICAgICAgICAgTUlTQy5RVUlUX0dBTUUoKQogICAgICAgIGVsc2UKICAgICAgICAgICAgaWYgdGFibGVfZmluZChibGFja2xpc3RwbGF5ZXJzLCBuYW1lKSBhbmQgKHBsYXllcnMuZ2V0X2hvc3QoKSA9PSBQTEFZRVIuUExBWUVSX0lEKCkpIGFuZCBwbGF5ZXJzLmV4aXN0cyhwaWQpIHRoZW4KICAgICAgICAgICAgICAgIHV0aWwudG9hc3QoIuajgOa1i+WIsOS6kem7keeOqeWutjogIi4ubmFtZS4uIlxu5bey5omn6KGM6Lii5Ye6IikKICAgICAgICAgICAgICAgIG1lbnUudHJpZ2dlcl9jb21tYW5kcygia2ljayAiIC4uIG5hbWUpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZAoKCgotLS0tLeWcqOe6v+eOqeWutgpsb2NhbCBwbGF5ZXJzbGlzdCA9IHt9CmxvY2FsIHBsYXllcl9pZHN0YWIgPSB7fQpmdW5jdGlvbiBwbGF5ZXJfbGlzdChwaWQpCiAgICBpZiBORVRXT1JLLk5FVFdPUktfSVNfU0VTU0lPTl9BQ1RJVkUoKXRoZW4KICAgICAgICAtLS3pmLLmraLmlLnlkI3lop7liqDliJfooagKICAgICAgICBwbGF5ZXJfaWRzdGFiW3BpZF0gPSBORVRXT1JLLk5FVFdPUktfR0VUX1BMQVlFUl9BQ0NPVU5UX0lEKHBpZCkKICAgICAgICBmb3IgaSwgcmlkIGluIHBhaXJzKHBsYXllcl9pZHN0YWIpIGRvCiAgICAgICAgICAgIGxvY2FsIHByaWQgPSBORVRXT1JLLk5FVFdPUktfR0VUX1BMQVlFUl9BQ0NPVU5UX0lEKHBpZCkKICAgICAgICAgICAgaWYgcmlkID09IHByaWQgYW5kIHBsYXllcnNsaXN0W3BpZF0gfj0gbmlsIGFuZCBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKSB+PSAwIHRoZW4gCiAgICAgICAgICAgICAgICBtZW51LmRlbGV0ZShwbGF5ZXJzbGlzdFtwaWRdKQogICAgICAgICAgICAgICAgcGxheWVyc2xpc3RbcGlkXSA9IG5pbAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgcGxheWVyc2xpc3RbcGlkXSA9IG1lbnUubGlzdChwbGF5ZXJzX2xpc3QsIHBsYXllcnMuZ2V0X25hbWUocGlkKSwge30sICIiKQogICAgZW5kCiAgICBpZiBwbGF5ZXJzbGlzdFtwaWRdIHRoZW4KICAgICAgICAKICAgICAgICBtZW51LmRpdmlkZXIocGxheWVyc2xpc3RbcGlkXSwi546p5a625L+h5oGvIikKICAgICAgICBtZW51LnJlYWRvbmx5KHBsYXllcnNsaXN0W3BpZF0sICLnjqnlrrbmmLXnp7A6ICIsIHBsYXllcnMuZ2V0X25hbWUocGlkKSkKICAgICAgICBtZW51LnJlYWRvbmx5KHBsYXllcnNsaXN0W3BpZF0sICLnjqnlrrZyaWQ6ICIsIHBsYXllcnMuZ2V0X3JvY2tzdGFyX2lkKHBpZCkpCiAgICAgICAgbWVudS5yZWFkb25seShwbGF5ZXJzbGlzdFtwaWRdLCAi546p5a626YeR6ZKxOiAiLCBwbGF5ZXJzLmdldF9tb25leShwaWQpKQogICAgICAgIG1lbnUucmVhZG9ubHkocGxheWVyc2xpc3RbcGlkXSwgIueOqeWutmtkOiAiLCBzdHJpbmcuZm9ybWF0KCIlLjJmIiwgcGxheWVycy5nZXRfa2QocGlkKSkpCiAgICAgICAgbWVudS5kaXZpZGVyKHBsYXllcnNsaXN0W3BpZF0sIuWFtuS7lumAiemhuSIpCiAgICAgICAgbWVudS5hY3Rpb24ocGxheWVyc2xpc3RbcGlkXSwi6Lii5Ye6546p5a62Iix7fSwiIixmdW5jdGlvbigpCiAgICAgICAgICAgIG1lbnUudHJpZ2dlcl9jb21tYW5kcygia2ljayAiIC4uIHBsYXllcnMuZ2V0X25hbWUocGlkKSkKICAgICAgICBlbmQpCiAgICAgICAgbG9jYWwgbWFyayA9IDAgLS3mnKrmoIforrAKICAgICAgICBtZW51LmFjdGlvbihwbGF5ZXJzbGlzdFtwaWRdLCLmoIforrDnjqnlrrYiLHt9LCLmoIforrDmiJbogIXlj5bmtojmoIforrDnjqnlrrZcbuagh+iusOWQjuS8mui2heaXtueOqeWutiIsZnVuY3Rpb24oKQogICAgICAgICAgICBpZiBtYXJrID09IDAgdGhlbgogICAgICAgICAgICAgICAgbWVudS5zZXRfbWVudV9uYW1lKHBsYXllcnNsaXN0W3BpZF0sIHBsYXllcnMuZ2V0X25hbWUocGlkKS4uIiBb5qCH6K6wXSIpCiAgICAgICAgICAgICAgICBtZW51LnRyaWdnZXJfY29tbWFuZHMoInRpbWVvdXQgIiAuLiBwbGF5ZXJzLmdldF9uYW1lKHBpZCkgLi4gIiBvbiIpCiAgICAgICAgICAgICAgICBtYXJrID0gMQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBtZW51LnNldF9tZW51X25hbWUocGxheWVyc2xpc3RbcGlkXSwgcGxheWVycy5nZXRfbmFtZShwaWQpKQogICAgICAgICAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJ0aW1lb3V0ICIgLi4gcGxheWVycy5nZXRfbmFtZShwaWQpIC4uICIgb2ZmIikKICAgICAgICAgICAgICAgIG1hcmsgPSAwCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZCkKCiAgICBlbmQKZW5kCmZ1bmN0aW9uIGhhbmRsZV9wbGF5ZXJfbGlzdChwaWQpCiAgICBsb2NhbCByZWYgPSBwbGF5ZXJzbGlzdFtwaWRdCiAgICBpZiBub3QgcGxheWVycy5leGlzdHMocGlkKSBhbmQgcmVmIHRoZW4KICAgICAgICBtZW51LmRlbGV0ZShyZWYpCiAgICAgICAgcGxheWVyc2xpc3RbcGlkXSA9IG5pbAogICAgICAgIC0tLS3pmLLmraLmlLnlkI3lop7liqDliJfooagKICAgICAgICBmb3IgaSwgcmlkIGluIHBhaXJzKHBsYXllcl9pZHN0YWIpIGRvCiAgICAgICAgICAgIGxvY2FsIHByaWQgPSBORVRXT1JLLk5FVFdPUktfR0VUX1BMQVlFUl9BQ0NPVU5UX0lEKHBpZCkKICAgICAgICAgICAgaWYgcmlkID09IHByaWQgdGhlbiAKICAgICAgICAgICAgICAgIHBsYXllcl9pZHN0YWJbcGlkXSA9IG5pbAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQKCgotLS0t5oG25Yqj546p5a62CmZ1bmN0aW9uIEJhZFNwb3J0U2V0dGVyKHZhbDEsIHZhbDIsIHZhbDMpCiAgICBTVEFUX1NFVF9JTlQoIk1QUExZX0JBRFNQT1JUX01FU1NBR0UiLCB2YWwxKQogICAgU1RBVF9TRVRfSU5UKCJNUFBMWV9CRUNBTUVfQkFEU1BPUlRfTlVNIiwgdmFsMSkKICAgIFNUQVRTLlNUQVRfU0VUX0ZMT0FUKE1JU0MuR0VUX0hBU0hfS0VZKCJNUFBMWV9PVkVSQUxMX0JBRFNQT1JUIiksIHZhbDIsIHRydWUpCiAgICBTVEFUX1NFVF9CT09MKCJNUFBMWV9DSEFSX0lTX0JBRFNQT1JUIiwgdmFsMykKZW5kCgotLS0t5YWB6K645b2T5YmN6L2m6L6G6L+b5YWl6L2m5bqTCmZ1bmN0aW9uIGNhcmludG8oKQogICAgbG9jYWwgaGFzaCA9IE5FVFdPUksuTkVUV09SS19IQVNIX0ZST01fUExBWUVSX0hBTkRMRShQTEFZRVIuUExBWUVSX0lEKCkpCiAgICBpZiBQRUQuSVNfUEVEX0lOX0FOWV9WRUhJQ0xFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpIHRoZW4KICAgICAgICBsb2NhbCB2ZWggPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX1VTSU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICAgICAgbG9jYWwgc3Bhd25lZF9tb2RlbCA9IHV0aWwucmV2ZXJzZV9qb2FhdChFTlRJVFkuR0VUX0VOVElUWV9NT0RFTCh2ZWgpKQogICAgICAgIG1lbW9yeS53cml0ZV9pbnQobWVtb3J5LnNjcmlwdF9nbG9iYWwoR2xvYmFsX0Jhc2UuaW5fbXVsdGlwbGF5ZXIpLCAwKQogICAgICAgIGxvY2FsIGJpdHNldCA9IERFQ09SQVRPUi5ERUNPUl9HRVRfSU5UKHZlaCwgIk1QQml0c2V0IikKICAgICAgICBiaXRzZXQgPSBDTEVBUl9CSVQoYml0c2V0LCAzKQogICAgICAgIGJpdHNldCA9IFNFVF9CSVQoYml0c2V0LCAyNCkKICAgICAgICBERUNPUkFUT1IuREVDT1JfU0VUX0lOVCh2ZWgsICJNUEJpdHNldCIsIGJpdHNldCkKICAgICAgICBERUNPUkFUT1IuREVDT1JfU0VUX0lOVCh2ZWgsICJQcmV2aW91c19Pd25lciIsIDApCiAgICAgICAgREVDT1JBVE9SLkRFQ09SX1NFVF9JTlQodmVoLCAiUFZfU2xvdCIsIDApCiAgICAgICAgREVDT1JBVE9SLkRFQ09SX1NFVF9JTlQodmVoLCAiUGxheWVyX1ZlaGljbGUiLCBoYXNoKQogICAgICAgIERFQ09SQVRPUi5ERUNPUl9TRVRfSU5UKHZlaCwgIlZlaF9Nb2RkZWRfQnlfUGxheWVyIiwgaGFzaCkKICAgICAgICBsb2NhbCBpbnRlcmlvciA9IElOVEVSSU9SLkdFVF9JTlRFUklPUl9GUk9NX0VOVElUWShQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlKQogICAgICAgIHV0aWwudG9hc3QoIuWujOaIkCIpCiAgICAgICAgd2hpbGUgaW50ZXJpb3IgPT0gMCBkbwogICAgICAgICAgICBpbnRlcmlvciA9IElOVEVSSU9SLkdFVF9JTlRFUklPUl9GUk9NX0VOVElUWShQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgICAgICB1dGlsLnlpZWxkX29uY2UoKQogICAgICAgIGVuZAogICAgICAgIG1lbW9yeS53cml0ZV9pbnQobWVtb3J5LnNjcmlwdF9nbG9iYWwoR2xvYmFsX0Jhc2UuaW5fbXVsdGlwbGF5ZXIpLCAxKQogICAgICAgIHdoaWxlIGludGVyaW9yIH49IDAgZG8KICAgICAgICAgICAgaW50ZXJpb3IgPSBJTlRFUklPUi5HRVRfSU5URVJJT1JfRlJPTV9FTlRJVFkoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgICAgICAgICAgdXRpbC55aWVsZF9vbmNlKCkKICAgICAgICBlbmQKICAgICAgICBmb3IgaSwgdmVoMSBpbiBwYWlycyhlbnRpdGllcy5nZXRfYWxsX3ZlaGljbGVzX2FzX2hhbmRsZXMoKSkgZG8KICAgICAgICAgICAgbG9jYWwgbW9kZWwgPSB1dGlsLnJldmVyc2Vfam9hYXQoRU5USVRZLkdFVF9FTlRJVFlfTU9ERUwodmVoMSkpCiAgICAgICAgICAgIGlmIG1vZGVsOmZpbmQoc3Bhd25lZF9tb2RlbCkgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgdmVoX3BvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyh2ZWgxLCB0cnVlKQogICAgICAgICAgICAgICAgaWYgR2V0X2Rpc3RhbmNlKHBvcywgdmVoX3BvcywgdHJ1ZSkgPCA1LjAgdGhlbgogICAgICAgICAgICAgICAgICAgIGRlbGV0ZV9lbnRpdHkodmVoMSkKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZWxzZQogICAgICAgIHV0aWwudG9hc3QoIuS9oOi/mOayoei/m+i9veWFt+WRoiIpCiAgICBlbmQKZW5kCgotLS0t6YCa55+l6JeP5Yy/5bGL5a+G56CBCmZ1bmN0aW9uIG5vdGlmeV9wYXNzd29yZCgpCiAgICBmb3IgXywgb2JqIGluIHBhaXJzKGVudGl0aWVzLmdldF9hbGxfb2JqZWN0c19hc19oYW5kbGVzKCkpIGRvCiAgICAgICAgaWYgRU5USVRZLklTX0VOVElUWV9BX01JU1NJT05fRU5USVRZKG9iaikgdGhlbgogICAgICAgICAgICBsb2NhbCBoYXNoID0gRU5USVRZLkdFVF9FTlRJVFlfTU9ERUwob2JqKQogICAgICAgICAgICBpZiBoaWRkZW5faG91c2VfcGFzc3dvcmRbaGFzaF0gfj0gbmlsIHRoZW4KICAgICAgICAgICAgICAgIHV0aWwudG9hc3QoIuiXj+WMv+Wxi+WvhueggSIgLi4gaGlkZGVuX2hvdXNlX3Bhc3N3b3JkW2hhc2hdKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCiAgICB1dGlsLnRvYXN0KCLmnKrmib7liLDlr4bnoIEiKQplbmQKLS0tLeiOt+WPluadsOaLieW+t+WMheijueS9jee9rgpmdW5jdGlvbiBnZXRfcGFja2FnZSgpCiAgICBsb2NhbCBwYWNrYWdlID0gezc2NTA4Nzc4NCwgLTE2MjA3MzQyODcsIDEzODc3NzMyNSx9CiAgICBmb3IgXywgb2JqIGluIHBhaXJzKGVudGl0aWVzLmdldF9hbGxfb2JqZWN0c19hc19oYW5kbGVzKCkpIGRvCiAgICAgICAgaWYgdGFibGVfZmluZChwYWNrYWdlLCBFTlRJVFkuR0VUX0VOVElUWV9NT0RFTChvYmopKSB0aGVuCiAgICAgICAgICAgIHV0aWwudG9hc3QoIuaJvuWIsOWMheijuSIpCiAgICAgICAgICAgIGxvY2FsIHBvczEgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMob2JqLCBmYWxzZSkKICAgICAgICAgICAgdGVsZXBvcnQocG9zMS54LCBwb3MxLnksIHBvczEueiwgZmFsc2UpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAogICAgZW5kCiAgICB1dGlsLnRvYXN0KCLmnKrmib7liLDljIXoo7kiKQplbmQKCi0tLS3mmL7npLrkvZnpop0KZnVuY3Rpb24gc2hvd19jcmVkaXQodG9nZ2xlZCkKICAgIGlmIHRvZ2dsZWQgdGhlbgogICAgICAgIEhVRC5TRVRfTVVMVElQTEFZRVJfV0FMTEVUX0NBU0goKQogICAgICAgIEhVRC5TRVRfTVVMVElQTEFZRVJfQkFOS19DQVNIKCkKICAgIGVsc2UKICAgICAgICBIVUQuUkVNT1ZFX01VTFRJUExBWUVSX1dBTExFVF9DQVNIKCkKICAgICAgICBIVUQuUkVNT1ZFX01VTFRJUExBWUVSX0JBTktfQ0FTSCgpCiAgICBlbmQKZW5kCgotLS0tLVVGT+WLh+mXr+a0m+WfjgpmdW5jdGlvbiBVRk9fTG9zX0FuZ2VsZXMoKQogICAgbG9jYWwgdWZvID0gdXRpbC5qb2FhdCgic3VtX3Byb3BfZHVmb2NvcmVfMDFhIikKICAgIGxvY2FsIGMgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgIGxvY2FsIHIgPSBtYXRoLnJhbmRvbSgxLCAzNSkKICAgIGMueCA9IG1hdGgucmFuZG9tKDAuMCwxLjApID49IDAuNSBhbmQgYy54ICsgciArIDUgb3IgYy54IC0gciAtIDUgLS1zZXQgeCBjb29yZHMKICAgIGMueSA9IG1hdGgucmFuZG9tKDAuMCwxLjApID49IDAuNSBhbmQgYy55ICsgciArIDUgb3IgYy55IC0gciAtIDUgLS1zZXQgeSBjb29yZHMKICAgIGMueiA9IGMueiArIHIgKyA4IC0tc2V0IHogY29vcmRzCiAgICByZXF1ZXN0X21vZGVsKHVmbykKICAgIHV0aWwueWllbGQoMjUwMCkKICAgIGxvY2FsIHNwYXduZWR1Zm8gPSBlbnRpdGllcy5jcmVhdGVfb2JqZWN0KHVmbywgYykgLS1zcGF3biB1Zm8KICAgIHV0aWwueWllbGQoNTAwKQogICAgbG9jYWwgdWZvYyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhzcGF3bmVkdWZvKSAtLWdldCB1Zm8gcG9zCiAgICB1Zm9jID0gd2F5cG9pbnRfY29vcmQodWZvYy54LCB1Zm9jLnksIHVmb2MueikKICAgIEZJUkUuQUREX0VYUExPU0lPTih1Zm9jLngsIHVmb2MueSwgdWZvYy56ICsgMTAsIDEsIDEwMC4wLCB0cnVlLCBmYWxzZSwgMS4wLCBmYWxzZSkgLS1leHBsb2RlIGF0IGZsb29yCiAgICB1dGlsLnlpZWxkKDE1MDApCiAgICBkZWxldGVfZW50aXR5KHNwYXduZWR1Zm8pIC0tZGVsZXRlIHVmbwplbmQKCi0tLS0tLemfs+S5kApmdW5jdGlvbiBtdXNpYyhvbikKCWlmIG9uIHRoZW4KICAgICAgICBBVURJTy5TRVRfTU9CSUxFX1JBRElPX0VOQUJMRURfRFVSSU5HX0dBTUVQTEFZKHRydWUpLS3lvLrliLbmiZPlvIDnlLXlj7AKICAgICAgICBBVURJTy5TRVRfUkFESU9fVE9fU1RBVElPTl9OQU1FKCJSQURJT18xOV9VU0VSIiktLeiuvue9rueUteWPsOmikemBkwogICAgICAgIC0tQVVESU8uTE9DS19SQURJT19TVEFUSU9OKCJSQURJT18xOV9VU0VSIixmYWxzZSktLeemgeeUqOeUteWPsAogICAgICAgIC0tQVVESU8uRlJFRVpFX1JBRElPX1NUQVRJT04oQVVESU8uR0VUX1BMQVlFUl9SQURJT19TVEFUSU9OX0lOREVYKCkpCiAgICBlbHNlCiAgICAgICAgQVVESU8uU0VUX01PQklMRV9SQURJT19FTkFCTEVEX0RVUklOR19HQU1FUExBWShmYWxzZSkKICAgICAgICBBVURJTy5TRVRfUkFESU9fVE9fU1RBVElPTl9OQU1FKCJPRkYiKQogICAgZW5kCmVuZAoKLS0tLeeIhueCuOWciApsb2NhbCBleHBsb3Npb25fY2lyY2xlX2FuZ2xlID0gMApmdW5jdGlvbiBleHBsb3Npb25fY2lyY2xlKHBlZCwgYW5nbGUsIHJhZGl1cykKICAgIGxvY2FsIHBlZF9jb29yZHMgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMocGVkKQogICAgbG9jYWwgb2Zmc2V0X3ggPSBwZWRfY29vcmRzLngKICAgIGxvY2FsIG9mZnNldF95ID0gcGVkX2Nvb3Jkcy55CiAgICBsb2NhbCB4ID0gb2Zmc2V0X3ggKyByYWRpdXMgKiBtYXRoLmNvcyhhbmdsZSkKICAgIGxvY2FsIHkgPSBvZmZzZXRfeSArIHJhZGl1cyAqIG1hdGguc2luKGFuZ2xlKQogICAgRklSRS5BRERfRVhQTE9TSU9OKHgsIHksIHBlZF9jb29yZHMueiwgNCwgMSwgdHJ1ZSwgZmFsc2UsIDApCmVuZApmdW5jdGlvbiBleHBsb3Npb25fcmFuZ2UocGlkKQogICAgbG9jYWwgcGVkID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgIGV4cGxvc2lvbl9jaXJjbGUocGVkLCBleHBsb3Npb25fY2lyY2xlX2FuZ2xlLCAyNSkKICAgIGV4cGxvc2lvbl9jaXJjbGVfYW5nbGUgPSBleHBsb3Npb25fY2lyY2xlX2FuZ2xlICsgMC4xNQogICAgdXRpbC55aWVsZCg1MCkKZW5kCgotLeinkuW6pui9rOaNouS4uuW8p+W6pgpmdW5jdGlvbiBkZWdUb1JhZChkZWdyZWVzKQogICAgcmV0dXJuIGRlZ3JlZXMgKiAobWF0aC5waSAvIDE4MCkKZW5kCi0tLS3otoXnuqfpo57kvqAKZnVuY3Rpb24gU3VwZXJfV2luZ3ModG9nZ2xlZCkKICAgIGxvY2FsIHJ1bl9jYXAgPSAxMDAuMAogICAgbG9jYWwgcnVuX3NwZWVkID0gMTAuMAogICAgbG9jYWwgcHRmeHMgPSB7fQogICAgc3VwZXJfd2luZ3NfdG9nZ2xlZCA9IHRvZ2dsZWQKICAgIHdoaWxlIHN1cGVyX3dpbmdzX3RvZ2dsZWQgZG8KICAgICAgICBpZiBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsIDIxKSBhbmQgUEFELklTX0NPTlRST0xfUFJFU1NFRCgwLCAzMikgdGhlbgogICAgICAgICAgICBpZiBub3QgR1JBUEhJQ1MuRE9FU19QQVJUSUNMRV9GWF9MT09QRURfRVhJU1QocHRmeHNbM10pIHRoZW4KICAgICAgICAgICAgICAgIHJlcXVlc3RfcHRmeF9hc3NldCgiY29yZSIpCiAgICAgICAgICAgICAgICBwdGZ4c1sxXSA9IEdSQVBISUNTLlNUQVJUX05FVFdPUktFRF9QQVJUSUNMRV9GWF9MT09QRURfT05fRU5USVRZX0JPTkUoInZlaF9leGhhdXN0X3NwYWNlY3JhZnQiLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwLCAzLCAwLCAwLCAwLCAwLCBQRUQuR0VUX1BFRF9CT05FX0lOREVYKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDB4MzIyYyksIDIsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDI1NSwgMjU1LCAyNTUsIDI1NSkKICAgICAgICAgICAgICAgIEdSQVBISUNTLlVTRV9QQVJUSUNMRV9GWF9BU1NFVCgiY29yZSIpCiAgICAgICAgICAgICAgICBwdGZ4c1syXSA9IEdSQVBISUNTLlNUQVJUX05FVFdPUktFRF9QQVJUSUNMRV9GWF9MT09QRURfT05fRU5USVRZX0JPTkUoImVudF9hbWJfZm91bmRyeV9tb2x0ZW5fcG91ciIsIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDAsIDMsIDAsIDAsIDAsIDAsIFBFRC5HRVRfUEVEX0JPTkVfSU5ERVgoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMHg0OUQ5KSwgMiwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgMjU1LCAyNTUsIDI1NSwgMjU1KQogICAgICAgICAgICAgICAgR1JBUEhJQ1MuVVNFX1BBUlRJQ0xFX0ZYX0FTU0VUKCJjb3JlIikKICAgICAgICAgICAgICAgIHB0ZnhzWzNdID0gR1JBUEhJQ1MuU1RBUlRfTkVUV09SS0VEX1BBUlRJQ0xFX0ZYX0xPT1BFRF9PTl9FTlRJVFlfQk9ORSgiZW50X2FtYl9mb3VuZHJ5X21vbHRlbl9wb3VyIiwgUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMCwgMywgMCwgMCwgMCwgMCwgUEVELkdFVF9QRURfQk9ORV9JTkRFWChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAweERFQUQpLCAyLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCAyNTUsIDI1NSwgMjU1LCAyNTUpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQUxQSEEoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMCwgZmFsc2UpCgogICAgICAgICAgICBpZiBydW5fc3BlZWQgPCBydW5fY2FwIHRoZW4KICAgICAgICAgICAgICAgIHJ1bl9zcGVlZCA9IHJ1bl9zcGVlZCArIDAuNQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGxvY2FsIGxvY2F0aW9uID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUpCiAgICAgICAgICAgIGxvY2FsIHBlZCA9IFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkKICAgICAgICAgICAgbG9jYWwgcm90ID0gRU5USVRZLkdFVF9FTlRJVFlfUk9UQVRJT04ocGVkLCAyKQogICAgICAgICAgICBsb2NhbCB5YXcgPSBkZWdUb1JhZChyb3QueiArIDkwKQoKICAgICAgICAgICAgbG9jYWwgb2Zmc2V0ID0gewogICAgICAgICAgICAgICAgeCA9IGxvY2F0aW9uLnggKyAocnVuX3NwZWVkICogbWF0aC5jb3MoeWF3KSksCiAgICAgICAgICAgICAgICB5ID0gbG9jYXRpb24ueSArIChydW5fc3BlZWQgKiBtYXRoLnNpbih5YXcpKSwKICAgICAgICAgICAgICAgIHogPSBsb2NhdGlvbi56ICsgMC4yCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxvY2FsIGdyb3VuZFogPSAwLjAKICAgICAgICAgICAgTUlTQy5HRVRfR1JPVU5EX1pfRk9SXzNEX0NPT1JEKG9mZnNldC54LCBvZmZzZXQueSwgMTAwMC4wLCBncm91bmRaLCBmYWxzZSkKICAgICAgICAgICAgaWYgZ3JvdW5kWiA8IGxvY2F0aW9uLnogdGhlbgogICAgICAgICAgICAgICAgb2Zmc2V0LnogPSBncm91bmRaCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbG9jYWwgdmVsID0gewogICAgICAgICAgICAgICAgeCA9IG9mZnNldC54IC0gbG9jYXRpb24ueCwKICAgICAgICAgICAgICAgIHkgPSBvZmZzZXQueSAtIGxvY2F0aW9uLnksCiAgICAgICAgICAgICAgICB6ID0gb2Zmc2V0LnogLSBsb2NhdGlvbi56CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1ZFTE9DSVRZKHBlZCwgdmVsLngsIHZlbC55LCB2ZWwueikKICAgICAgICBlbHNlCiAgICAgICAgICAgIGlmIEVOVElUWS5HRVRfRU5USVRZX1NQRUVEKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpID4gNSB0aGVuCiAgICAgICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9WRUxPQ0lUWShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwLCAwLCAwKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgcmVtb3ZlX3BhcnRpY2xlX2Z4KHB0ZnhzKQogICAgICAgICAgICBFTlRJVFkuUkVTRVRfRU5USVRZX0FMUEhBKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICAgICAgICAgIHB0ZnhzID0ge30KICAgICAgICBlbmQKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAogICAgRU5USVRZLlJFU0VUX0VOVElUWV9BTFBIQShQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgcmVtb3ZlX3BhcnRpY2xlX2Z4KHB0ZnhzKQplbmQKCgoKLS0tLS3kuLvmnLrluo/liJcKCi0tZnBz5bin5pWwCmxvY2FsIGZwcyA9IDAKbG9jYWwgZnBzdG9nZ2xlID0gZmFsc2UKZnVuY3Rpb24gZ2V0X2Zwcyh0b2dnbGVkKQogICAgaWYgdG9nZ2xlZCB0aGVuCiAgICAgICAgaWYgbWVudS5nZXRfdmFsdWUoaG9zdF9zZXF1ZW5jZSkgPT0gdHJ1ZSB0aGVuCiAgICAgICAgICAgIGZwc3RvZ2dsZSA9IHRydWUKICAgICAgICAgICAgdXRpbC5jcmVhdGVfdGhyZWFkKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIHdoaWxlIGZwc3RvZ2dsZSBkbwogICAgICAgICAgICAgICAgICAgIGZwcyA9IG1hdGguY2VpbCgxL1NZU1RFTS5USU1FU1RFUCgpKQogICAgICAgICAgICAgICAgICAgIHV0aWwueWllbGQoNTAwKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZCkKICAgICAgICBlbHNlCiAgICAgICAgICAgIHV0aWwudG9hc3QoIuivt+WFiOW8gOWQr+S4u+acuuW6j+WIlyIpCiAgICAgICAgICAgIG1lbnUuc2V0X3ZhbHVlKG51bWZwcywgZmFsc2UpCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgZnBzdG9nZ2xlID0gZmFsc2UKICAgIGVuZAplbmQKCmxvY2FsIHJlcGxheUludGVyZmFjZSA9IG1lbW9yeS5yZWFkX2xvbmcobWVtb3J5LnJpcChtZW1vcnkuc2NhbigiNDggOEQgMEQgPyA/ID8gPyA0OCA4QiBENyBFOCA/ID8gPyA/IDQ4IDhEIDBEID8gPyA/ID8gOEEgRDggRTggPyA/ID8gPyA4NCBEQiA3NSAxMyA0OCA4RCAwRCIpICsgMykpCmxvY2FsIHBlZEludGVyZmFjZSA9IG1lbW9yeS5yZWFkX2xvbmcocmVwbGF5SW50ZXJmYWNlICsgMHgwMDE4KQpsb2NhbCB2ZWhJbnRlcmZhY2UgPSBtZW1vcnkucmVhZF9sb25nKHJlcGxheUludGVyZmFjZSArIDB4MDAxMCkKbG9jYWwgb2JqZWN0SW50ZXJmYWNlID0gbWVtb3J5LnJlYWRfbG9uZyhyZXBsYXlJbnRlcmZhY2UgKyAweDAwMjgpCmxvY2FsIHBpY2t1cEludGVyZmFjZSA9IG1lbW9yeS5yZWFkX2xvbmcocmVwbGF5SW50ZXJmYWNlICsgMHgwMDIwKQoKbG9jYWwgemh1aml4dmxpZV9wb3N4ID0gKGx1YUNvbmZpZy5ob3N0X3NlcXVlbmNlX3ggb3IgMTc1KSAvIDEwMDAKbG9jYWwgemh1aml4dmxpZV9wb3N5ID0gKGx1YUNvbmZpZy5ob3N0X3NlcXVlbmNlX3kgb3IgNzIwKSAvIDEwMDAgCmZ1bmN0aW9uIHpodWppeHZsaWVfeCh4XykKICAgIHpodWppeHZsaWVfcG9zeCA9IHhfIC8gMTAwMAplbmQKZnVuY3Rpb24gemh1aml4dmxpZV95KHlfKQogICAgemh1aml4dmxpZV9wb3N5ID0geV8gLyAxMDAwCmVuZApmdW5jdGlvbiB6aHVqaXh2bGllKCkKICAgIC0t5LiL5L2N5Li75py6CiAgICBsb2NhbCBuZXh0aG9zdF9uYW1lID0gIuS4jeWPr+eUqCIKICAgIGZvciBwaWQgPSAwLCAzMSBkbwogICAgICAgIGxvY2FsIGhvc3RfcXVldWUgPSBwbGF5ZXJzLmdldF9ob3N0X3F1ZXVlX3Bvc2l0aW9uKHBpZCkKICAgICAgICBpZiAjcGxheWVycy5saXN0KCkgPiAxIGFuZCBob3N0X3F1ZXVlID09IDEgYW5kIHBsYXllcnMuZ2V0X25hbWUocGlkKSB+PSAiVW5kaXNjb3ZlcmVkUGxheWVyIiB0aGVuCiAgICAgICAgICAgIG5leHRob3N0X25hbWUgPSBQTEFZRVIuR0VUX1BMQVlFUl9OQU1FKHBpZCkKICAgICAgICBlbmQKICAgIGVuZAoKICAgIC0t5p2C6aG5CiAgICBsb2NhbCBpbnZpY2lhbW91bnRpbnQgPSAwCiAgICBmb3IgcGlkID0gMCwgMzEgZG8KICAgICAgICAtLeS9nOW8iuiAheS6uuaVsAogICAgICAgIGlmIHBsYXllcnMuZXhpc3RzKHBpZCkgYW5kIHBpZCB+PSBQTEFZRVIuUExBWUVSX0lEKCkgdGhlbgogICAgICAgICAgICBpZiBwbGF5ZXJzLmlzX21hcmtlZF9hc19tb2RkZXIocGlkKSB0aGVuCiAgICAgICAgICAgICAgICBpbnZpY2lhbW91bnRpbnQgPSBpbnZpY2lhbW91bnRpbnQgKyAxCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCgogICAgLS3ml7bpgJ8KICAgIGxvY2FsIHNwZWVkID0gbWF0aC5jZWlsKEVOVElUWS5HRVRfRU5USVRZX1NQRUVEKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpICogMy42KQogICAgaWYgUEVELklTX1BFRF9JTl9BTllfVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlKSB0aGVuCiAgICAgICAgbG9jYWwgdmVoID0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19VU0lORyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgIHNwZWVkID0gbWF0aC5jZWlsKEVOVElUWS5HRVRfRU5USVRZX1NQRUVEKHZlaCkgKiAzLjYpCiAgICBlbmQKICAgIAoKLS1+aXRhbGljfiDmlpzkvZMKLS1+Ym9sZH4g5Yqg57KXCi0tfj9+IGNvbG9yCiAgICBpZiBmcHN0b2dnbGUgdGhlbgogICAgICAgIGRyYXdfc3RyaW5nKHN0cmluZy5mb3JtYXQoIn5ib2xkfn5vfkZQUzogfmJ+Ii4uZnBzKSwgemh1aml4dmxpZV9wb3N4LCB6aHVqaXh2bGllX3Bvc3kgLSAwLjAwMiwgMC4zLDEpCiAgICBlbmQKCglkcmF3X3N0cmluZyhzdHJpbmcuZm9ybWF0KCJ+Ym9sZH5+Yn4iLi5zcGVlZC4uIiB+Z35rbS9oIiksIHpodWppeHZsaWVfcG9zeCx6aHVqaXh2bGllX3Bvc3kgKyAwLjAyNiwgMC4zLDEpLS0tLS3pgJ/luqYKCWRyYXdfc3RyaW5nKHN0cmluZy5mb3JtYXQoIn5ib2xkfn55fiIuLm9zLmRhdGUoIiVYIikpLCB6aHVqaXh2bGllX3Bvc3gsIHpodWppeHZsaWVfcG9zeSArIDAuMDU0LCAwLjMsMSkgICAgLS0tLS0tLS0tLS0tLS0tLS3ml7bpl7QKCWRyYXdfc3RyaW5nKHN0cmluZy5mb3JtYXQoIn5ib2xkfuaImOWxgOS6uuaVsDogfmd+Ii4uI3BsYXllcnMubGlzdCgpKSwgemh1aml4dmxpZV9wb3N4LCB6aHVqaXh2bGllX3Bvc3kgKyAwLjA4MiwgMC4zLDEpIAoJZHJhd19zdHJpbmcoc3RyaW5nLmZvcm1hdCgifmJvbGR+5L2c5byK5Lq65pWwOiB+cn4iLi5pbnZpY2lhbW91bnRpbnQpLCB6aHVqaXh2bGllX3Bvc3gsIHpodWppeHZsaWVfcG9zeSArIDAuMTEsIDAuMywxKQoKICAgIGlmIFBMQVlFUi5HRVRfUExBWUVSX05BTUUocGxheWVycy5nZXRfaG9zdCgpKSA9PSAiKipJbnZhbGlkKioiIHRoZW4KICAgICAgICBkcmF3X3N0cmluZyhzdHJpbmcuZm9ybWF0KCJ+Ym9sZH7miJjlsYDkuLvmnLo6IH55fuS4jeWPr+eUqCIsIEFMSUdOX1RPUF9MRUZUKSwgemh1aml4dmxpZV9wb3N4LCB6aHVqaXh2bGllX3Bvc3kgKyAwLjEzOCwgMC4zLDEpCiAgICBlbHNlCiAgICAgICAgZHJhd19zdHJpbmcoc3RyaW5nLmZvcm1hdCgifmJvbGR+5oiY5bGA5Li75py6OiB+eX4iLi5wbGF5ZXJzLmdldF9uYW1lKHBsYXllcnMuZ2V0X2hvc3QoKSkpLCB6aHVqaXh2bGllX3Bvc3gsIHpodWppeHZsaWVfcG9zeSArIDAuMTM4LCAwLjMsMSkKICAgIGVuZAoKICAgIGlmIFBMQVlFUi5HRVRfUExBWUVSX05BTUUocGxheWVycy5nZXRfc2NyaXB0X2hvc3QoKSkgPT0gIioqSW52YWxpZCoqIiB0aGVuCiAgICAgICAgZHJhd19zdHJpbmcoc3RyaW5nLmZvcm1hdCgifmJvbGR+6ISa5pys5Li75py6OiB+Yn7kuI3lj6/nlKgiLCBBTElHTl9UT1BfTEVGVCksIHpodWppeHZsaWVfcG9zeCwgemh1aml4dmxpZV9wb3N5ICsgMC4xNjYsIDAuMywxKSAKICAgIGVsc2UKICAgICAgICBkcmF3X3N0cmluZyhzdHJpbmcuZm9ybWF0KCJ+Ym9sZH7ohJrmnKzkuLvmnLo6IH5ifiIuLnBsYXllcnMuZ2V0X25hbWUocGxheWVycy5nZXRfc2NyaXB0X2hvc3QoKSkpLCB6aHVqaXh2bGllX3Bvc3gsIHpodWppeHZsaWVfcG9zeSArIDAuMTY2LCAwLjMsMSkKICAgIGVuZAoKICAgIGRyYXdfc3RyaW5nKHN0cmluZy5mb3JtYXQoIn5ib2xkfn5nfuS4i+S4gOS9jeS4u+acujogfnB+Ii4ubmV4dGhvc3RfbmFtZSksIHpodWppeHZsaWVfcG9zeCwgemh1aml4dmxpZV9wb3N5ICsgMC4xOTQsIDAuMywxKSAKCiAgICBsb2NhbCBob3N0eHZsaWUgPSBwbGF5ZXJzLmdldF9ob3N0X3F1ZXVlX3Bvc2l0aW9uKFBMQVlFUi5QTEFZRVJfSUQoKSkKICAgIGlmIGhvc3R4dmxpZSA9PSAwIHRoZW4KICAgICAgICBkcmF3X3N0cmluZyhzdHJpbmcuZm9ybWF0KCJ+Ym9sZH5+cX7kvaDnjrDlnKjmmK/miJjlsYDkuLvmnLoiKSwgemh1aml4dmxpZV9wb3N4LCB6aHVqaXh2bGllX3Bvc3kgKyAwLjIyMiwgMC4zLDEpIAogICAgZWxzZQogICAgICAgIGRyYXdfc3RyaW5nKHN0cmluZy5mb3JtYXQoIn5ib2xkfn5xfuS9oOeahOS4u+acuuS8mOWFiOW6pjp+cX4gIi4uaG9zdHh2bGllKSwgemh1aml4dmxpZV9wb3N4LCB6aHVqaXh2bGllX3Bvc3kgKyAwLjIyMiwgMC4zLDEpIAogICAgZW5kCgogICAgaWYgaXNfVWx0aW1hdGVVc2VyKFBMQVlFUi5QTEFZRVJfSUQoKSkgdGhlbgogICAgICAgIGRyYXdfc3RyaW5nKHN0cmluZy5mb3JtYXQoIn5ib2xkfn5vflNha3VyYSAiLi4gU0NSSVBUX1ZFUlNJT04gLi4iIChVbHRpbWF0ZSkiKSwgemh1aml4dmxpZV9wb3N4LCB6aHVqaXh2bGllX3Bvc3kgKyAwLjI1LCAwLjMsMSkKICAgIGVsc2UKICAgICAgICBkcmF3X3N0cmluZyhzdHJpbmcuZm9ybWF0KCJ+Ym9sZH5+bX5TYWt1cmEgIi4uIFNDUklQVF9WRVJTSU9OIC4uIiAoRnJlZSkiKSwgemh1aml4dmxpZV9wb3N4LCB6aHVqaXh2bGllX3Bvc3kgKyAwLjI1LCAwLjMsMSkgCiAgICBlbmQKCmVuZAoKCgoKLS0tLeWunuS9k+axoOS/oeaBrwpmdW5jdGlvbiBlbnRpdHlpbmZvKCkKICAgIGRyYXdfc3RyaW5nKHN0cmluZy5mb3JtYXQoIn5ofn5mfuWunuS9k+axoEluZm9+IiksIDAsMCwgMC4zMiwxKQogICAgZHJhd19zdHJpbmcoc3RyaW5nLmZvcm1hdCgifmh+cGVkOiB+Z34iLi5tZW1vcnkucmVhZF9pbnQocGVkSW50ZXJmYWNlICsgMHgwMTEwKS4uIi8iLi5tZW1vcnkucmVhZF9pbnQocGVkSW50ZXJmYWNlICsgMHgwMTA4KSksIDAsMC4wMywgMC4zLDEpCiAgICBkcmF3X3N0cmluZyhzdHJpbmcuZm9ybWF0KCJ+aH52ZWg6IH55fiIuLm1lbW9yeS5yZWFkX2ludCh2ZWhJbnRlcmZhY2UgKyAweDAxOTApLi4iLyIuLm1lbW9yeS5yZWFkX2ludCh2ZWhJbnRlcmZhY2UgKyAweDAxODgpKSwgMCwwLjA2LCAwLjMsMSkKICAgIGRyYXdfc3RyaW5nKHN0cmluZy5mb3JtYXQoIn5ofm9iajogfnJ+Ii4ubWVtb3J5LnJlYWRfaW50KG9iamVjdEludGVyZmFjZSArIDB4MDE2OCkuLiIvIi4ubWVtb3J5LnJlYWRfaW50KG9iamVjdEludGVyZmFjZSArIDB4MDE2MCkpLCAwLDAuMDksIDAuMywxKQogICAgZHJhd19zdHJpbmcoc3RyaW5nLmZvcm1hdCgifmh+5ou+5Y+W54mpOiB+cX4gIi4ubWVtb3J5LnJlYWRfaW50KHBpY2t1cEludGVyZmFjZSArIDB4MDExMCkuLiIvIi4ubWVtb3J5LnJlYWRfaW50KHBpY2t1cEludGVyZmFjZSArIDB4MDEwOCkpLCAwLDAuMTIsIDAuMywxKQplbmQKCi0tLS0t5pi+56S65pe26Ze0CmZ1bmN0aW9uIHJlYWxfdGltZShzdGF0ZSkKICAgIGxvY2FsIHN0cmluZ3MgPSBvcy5kYXRlKCd+Ym9sZH4gfm9+ICVZLSVtLSVkIH5ifiVIOiVNOiVTJywgb3MudGltZSgpKQogICAgZHJhd19zdHJpbmcoc3RyaW5ncywgMC40NSwgMC4wNSwgMC41LCA0KQplbmQKCi0tLS3ohJrmnKzmmLXnp7AKZnVuY3Rpb24gc2NyaXB0bmFtZSgpCiAgICBsb2NhbCB0aW1lciA9IE1JU0MuR0VUX0dBTUVfVElNRVIoKQogICAgbG9jYWwgY29sb3IgPSAgZ3JhZGllbnRfY29sb3VyKHRpbWVyLCAwLjUpICAgICAgIAogICAgSFVELlNFVF9URVhUX0NPTE9VUihjb2xvci5yLCBjb2xvci5nLCBjb2xvci5iLCAyNTUpCiAgICBpZiBpc19VbHRpbWF0ZVVzZXIoUExBWUVSLlBMQVlFUl9JRCgpKSB0aGVuCiAgICAgICAgZHJhd19zdHJpbmcoc3RyaW5nLmZvcm1hdCgifml0YWxpY34gfmJvbGR+IC3iiJEgU2FrdXJhIFVsdGltYXRlIC3iiJEiKSwgMC40MDUsIDAuMSwgMC41LCA1KSAtLcKmLeKIkQogICAgZWxzZQogICAgICAgIGRyYXdfc3RyaW5nKHN0cmluZy5mb3JtYXQoIn5pdGFsaWN+IH5ib2xkfiAt4oiRIFNha3VyYSBTY3JpcHQgdiIuLlNDUklQVF9WRVJTSU9OKSwgMC40MDUsIDAuMSwgMC41LCA1KSAtLcKmLeKIkQogICAgZW5kCmVuZAoKCi0tLS3mmL7npLpsb2dvCmZ1bmN0aW9uIHNob3dfbG9nbyh0b2dnbGVkKQogICAgbG9nb190b2dnbGVkID0gdG9nZ2xlZAogICAgbG9jYWwgbG9nbyA9IGRpcmVjdHguY3JlYXRlX3RleHR1cmUoZmlsZXN5c3RlbS5yZXNvdXJjZXNfZGlyKCkgLi4gJy9TYWt1cmFTY3JpcHQvSW1nL2Jhbm5lci5wbmcnKQogICAgd2hpbGUgbG9nb190b2dnbGVkIGRvCiAgICAgICAgZGlyZWN0eC5kcmF3X3RleHR1cmUobG9nbywgMC4wNiwgMC4xLCAwLjAsIDAuMCwgMC44NiwgMC41NywgMCwgMSwgMSwgMSwgMSkKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAplbmQKLS0tLVRvbSZKZXJyeQpmdW5jdGlvbiBzaG93X1RvbSh0b2dnbGVkKQogICAgVG9tX3RvZ2dsZWQgPSB0b2dnbGVkCiAgICBsb2NhbCBsb2dvID0gZGlyZWN0eC5jcmVhdGVfdGV4dHVyZShmaWxlc3lzdGVtLnJlc291cmNlc19kaXIoKSAuLiAnL1Nha3VyYVNjcmlwdC9JbWcvMS5wbmcnKQogICAgd2hpbGUgVG9tX3RvZ2dsZWQgZG8KICAgICAgICBkaXJlY3R4LmRyYXdfdGV4dHVyZShsb2dvLCAwLjEsIDAuMSwgMS4zLCAtMS4xLCAwLjUsIDAuNSwgMCwgMSwgMSwgMSwgMSkKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAplbmQKCgoKCgoKLS0tLeeJueauiuatpuWZqAotLeWkp+mUpApmdW5jdGlvbiBoYW1tZXIob24pCiAgICBpZiBvbiB0aGVuCiAgICAgICAgUEVELlNFVF9QRURfQ0FOX1NXSVRDSF9XRUFQT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSxmYWxzZSktLeemgeatouWIh+aNouatpuWZqAogICAgICAgIFdFQVBPTi5HSVZFX1dFQVBPTl9UT19QRUQoUExBWUVSLkdFVF9QTEFZRVJfUEVEX1NDUklQVF9JTkRFWChQTEFZRVIuUExBWUVSX0lEKCkpLC0xODEwNzk1NzcxLDE1LHRydWUsdHJ1ZSktLee7meS6iOaMh+WumuatpuWZqAogICAgICAgIFdFQVBPTi5TRVRfUEVEX0NVUlJFTlRfV0VBUE9OX1ZJU0lCTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UpLS3mrablmajpmpDlvaIKCiAgICAgICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksdHJ1ZSkKICAgICAgICBoYW5kbGViYXIgPSBPQkpFQ1QuQ1JFQVRFX09CSkVDVCh1dGlsLmpvYWF0KCJwcm9wX2JvbGxhcmRfMDJhIiksIHBvcy54LCBwb3MueSwgcG9zLnosIHRydWUsIHRydWUsIGZhbHNlKS0t5aSn6ZSk5omL5p+ECiAgICAgICAgZGFjaHVpID0gT0JKRUNULkNSRUFURV9PQkpFQ1QodXRpbC5qb2FhdCgicHJvcF9iYXJyZWxfMDJhIiksIHBvcy54LCBwb3MueSwgcG9zLnosIHRydWUsIHRydWUsIGZhbHNlKS0t5aSn6ZSkCiAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJkYW1hZ2VtdWx0aXBsaWVyIDEwMDAiKQogICAgICAgIG1lbnUudHJpZ2dlcl9jb21tYW5kcygicmFuZ2VtdWx0aXBsaWVyIDEuNSIpCiAgICAgICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKGhhbmRsZWJhciwgUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgUEVELkdFVF9QRURfQk9ORV9JTkRFWChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAyODQyMiksIDAuMiwgMC45NSwgMC4yLCAxMDUsIDMwLjAsIDAsIHRydWUsIHRydWUsIGZhbHNlLCBmYWxzZSwgMCwgdHJ1ZSwgMCkKICAgICAgICBFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkoZGFjaHVpLGhhbmRsZWJhciwgMCwgIDAsIDAsIC0wLjIsIC0zNS4wLCAxMDAuMCwwLCB0cnVlLCB0cnVlLCBmYWxzZSwgZmFsc2UsIDAsIHRydWUsIDApCiAgICBlbHNlCiAgICAgICAgUEVELlNFVF9QRURfQ0FOX1NXSVRDSF9XRUFQT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSx0cnVlKQogICAgICAgIG1lbnUudHJpZ2dlcl9jb21tYW5kcygiZGFtYWdlbXVsdGlwbGllciAxIikKICAgICAgICBtZW51LnRyaWdnZXJfY29tbWFuZHMoInJhbmdlbXVsdGlwbGllciAxIikKICAgICAgICBkZWxldGVfZW50aXR5KGhhbmRsZWJhcikKICAgICAgICBkZWxldGVfZW50aXR5KGRhY2h1aSkKICAgICAgICBXRUFQT04uR0lWRV9XRUFQT05fVE9fUEVEKFBMQVlFUi5HRVRfUExBWUVSX1BFRF9TQ1JJUFRfSU5ERVgoUExBWUVSLlBMQVlFUl9JRCgpKSwtMTU2OTYxNTI2MSwxNSx0cnVlLHRydWUpLS3nu5nkuojlvpLmiYsKICAgIGVuZAplbmQKCi0t6Zu356We6ZSkCmZ1bmN0aW9uIHRodW5kZXJfaGFtbWVyKG9uKQogICAgaWYgb24gdGhlbgogICAgICAgIFBFRC5TRVRfUEVEX0NBTl9TV0lUQ0hfV0VBUE9OKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksZmFsc2UpLS3npoHmraLliIfmjaLmrablmagKICAgICAgICBXRUFQT04uR0lWRV9XRUFQT05fVE9fUEVEKFBMQVlFUi5HRVRfUExBWUVSX1BFRF9TQ1JJUFRfSU5ERVgoUExBWUVSLlBMQVlFUl9JRCgpKSwtMTgxMDc5NTc3MSwxNSx0cnVlLHRydWUpLS3nu5nkuojmjIflrprmrablmagKICAgICAgICBXRUFQT04uU0VUX1BFRF9DVVJSRU5UX1dFQVBPTl9WSVNJQkxFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlLCBmYWxzZSwgZmFsc2UsIGZhbHNlKS0t5q2m5Zmo6ZqQ5b2iCgogICAgICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLHRydWUpCiAgICAgICAgdGh1bmRlcmxlYmFyID0gT0JKRUNULkNSRUFURV9PQkpFQ1QoLTE5MjQyNzE5NzIsIHBvcy54LCBwb3MueSwgcG9zLnosIHRydWUsIHRydWUsIGZhbHNlKS0t5aSn6ZSk5omL5p+ECiAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJkYW1hZ2VtdWx0aXBsaWVyIDEwMDAiKQogICAgICAgIG1lbnUudHJpZ2dlcl9jb21tYW5kcygicmFuZ2VtdWx0aXBsaWVyIDEuNSIpCiAgICAgICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKHRodW5kZXJsZWJhciwgUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgUEVELkdFVF9QRURfQk9ORV9JTkRFWChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAyODQyMiksIDAuMDgsIDAuMjIsIDAuMDUsIC03NSwgNDUuMCwgMCwgdHJ1ZSwgdHJ1ZSwgZmFsc2UsIGZhbHNlLCAwLCB0cnVlLCAwKQogICAgZWxzZQogICAgICAgIG1lbnUudHJpZ2dlcl9jb21tYW5kcygiZGFtYWdlbXVsdGlwbGllciAxIikKICAgICAgICBtZW51LnRyaWdnZXJfY29tbWFuZHMoInJhbmdlbXVsdGlwbGllciAxIikKICAgICAgICBkZWxldGVfZW50aXR5KHRodW5kZXJsZWJhcikKCiAgICAgICAgUEVELlNFVF9QRURfQ0FOX1NXSVRDSF9XRUFQT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSx0cnVlKS0t6Kej6Zmk56aB5q2i5YiH5o2i5q2m5ZmoCiAgICAgICAgV0VBUE9OLlNFVF9QRURfQ1VSUkVOVF9XRUFQT05fVklTSUJMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlLCBmYWxzZSwgZmFsc2UsIGZhbHNlKS0t6Kej6Zmk5q2m5Zmo6ZqQ5b2iCiAgICAgICAgV0VBUE9OLkdJVkVfV0VBUE9OX1RPX1BFRChQTEFZRVIuR0VUX1BMQVlFUl9QRURfU0NSSVBUX0lOREVYKFBMQVlFUi5QTEFZRVJfSUQoKSksLTE1Njk2MTUyNjEsMTUsdHJ1ZSx0cnVlKS0t57uZ5LqI5b6S5omLCiAgICBlbmQKZW5kCi0t5rWB5pif6ZSkCmZ1bmN0aW9uIG1ldGVvcmhhbW1lcihvbikKICAgIGlmIG9uIHRoZW4KICAgICAgICBQRUQuU0VUX1BFRF9DQU5fU1dJVENIX1dFQVBPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLGZhbHNlKS0t56aB5q2i5YiH5o2i5q2m5ZmoCiAgICAgICAgV0VBUE9OLkdJVkVfV0VBUE9OX1RPX1BFRChQTEFZRVIuR0VUX1BMQVlFUl9QRURfU0NSSVBUX0lOREVYKFBMQVlFUi5QTEFZRVJfSUQoKSksLTE4MTA3OTU3NzEsMTUsdHJ1ZSx0cnVlKS0t57uZ5LqI5oyH5a6a5q2m5ZmoCgogICAgICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLHRydWUpCiAgICAgICAgbWV0ZW9yaGFuZGxlYmFyID0gT0JKRUNULkNSRUFURV9PQkpFQ1QodXRpbC5qb2FhdCgicHJvcF9nbGFzc19zdGFja18wMyIpLCBwb3MueCwgcG9zLnksIHBvcy56LCB0cnVlLCB0cnVlLCBmYWxzZSktLXByb3BfZ2F0ZV9mYXJtX3Bvc3QKICAgICAgICBtZXRlb3JkYWNodWkgPSBPQkpFQ1QuQ1JFQVRFX09CSkVDVCh1dGlsLmpvYWF0KCJwcm9wX2JhcnJlbF9waWxlXzAzIiksIHBvcy54LCBwb3MueSwgcG9zLnosIHRydWUsIHRydWUsIGZhbHNlKS0taDRfcHJvcF9oNF9iYXJyZWxfMDFhCiAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJkYW1hZ2VtdWx0aXBsaWVyIDEwMDAiKQogICAgICAgIG1lbnUudHJpZ2dlcl9jb21tYW5kcygicmFuZ2VtdWx0aXBsaWVyIDEuNSIpCiAgICAgICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKG1ldGVvcmhhbmRsZWJhciwgUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgUEVELkdFVF9QRURfQk9ORV9JTkRFWChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAyODQyMiksIDAuMiwgMC45NSwgMC4yLCAxMTUsIDMwLjAsIDAsIHRydWUsIHRydWUsIGZhbHNlLCBmYWxzZSwgMCwgdHJ1ZSwgMCkKICAgICAgICBFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkobWV0ZW9yZGFjaHVpLG1ldGVvcmhhbmRsZWJhciwgMCwgIDAsIDAsIC0wLjIsIC0zNS4wLCAxMDAuMCwwLCB0cnVlLCB0cnVlLCBmYWxzZSwgZmFsc2UsIDAsIHRydWUsIDApCiAgICBlbHNlCiAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJkYW1hZ2VtdWx0aXBsaWVyIDEiKQogICAgICAgIG1lbnUudHJpZ2dlcl9jb21tYW5kcygicmFuZ2VtdWx0aXBsaWVyIDEiKQogICAgICAgIGRlbGV0ZV9lbnRpdHkobWV0ZW9yaGFuZGxlYmFyKQogICAgICAgIGRlbGV0ZV9lbnRpdHkobWV0ZW9yZGFjaHVpKQoKICAgICAgICBQRUQuU0VUX1BFRF9DQU5fU1dJVENIX1dFQVBPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLHRydWUpLS3op6PpmaTnpoHmraLliIfmjaLmrablmagKICAgICAgICBXRUFQT04uR0lWRV9XRUFQT05fVE9fUEVEKFBMQVlFUi5HRVRfUExBWUVSX1BFRF9TQ1JJUFRfSU5ERVgoUExBWUVSLlBMQVlFUl9JRCgpKSwtMTU2OTYxNTI2MSwxNSx0cnVlLHRydWUpLS3nu5nkuojlvpLmiYsKICAgIGVuZAplbmQKLS3ljp/lrZDplKQKZnVuY3Rpb24gYXRvbWhhbW1lcihvbikKICAgIGlmIG9uIHRoZW4KICAgICAgICBQRUQuU0VUX1BFRF9DQU5fU1dJVENIX1dFQVBPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLGZhbHNlKS0t56aB5q2i5YiH5o2i5q2m5ZmoCiAgICAgICAgV0VBUE9OLkdJVkVfV0VBUE9OX1RPX1BFRChQTEFZRVIuR0VUX1BMQVlFUl9QRURfU0NSSVBUX0lOREVYKFBMQVlFUi5QTEFZRVJfSUQoKSksLTE4MTA3OTU3NzEsMTUsdHJ1ZSx0cnVlKS0t57uZ5LqI5oyH5a6a5q2m5ZmoCiAgICAgICAgV0VBUE9OLlNFVF9QRURfQ1VSUkVOVF9XRUFQT05fVklTSUJMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSktLeatpuWZqOmakOW9ogoKICAgICAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSx0cnVlKQogICAgICAgIGF0b21oYW5kbGViYXIgPSBPQkpFQ1QuQ1JFQVRFX09CSkVDVCh1dGlsLmpvYWF0KCJwcm9wX2JvbGxhcmRfMDQiKSwgcG9zLngsIHBvcy55LCBwb3MueiwgdHJ1ZSwgdHJ1ZSwgZmFsc2UpCiAgICAgICAgYXRvbWRhY2h1aSA9IE9CSkVDVC5DUkVBVEVfT0JKRUNUKHV0aWwuam9hYXQoInByb3BfYmFycmVsXzAzZCIpLCBwb3MueCwgcG9zLnksIHBvcy56LCB0cnVlLCB0cnVlLCBmYWxzZSkKICAgICAgICBhdG9tZGFjaHVpMSA9IE9CSkVDVC5DUkVBVEVfT0JKRUNUKHV0aWwuam9hYXQoInByb3BfYmFycmVsXzAzZCIpLCBwb3MueCwgcG9zLnksIHBvcy56LCB0cnVlLCB0cnVlLCBmYWxzZSkKICAgICAgICBtZW51LnRyaWdnZXJfY29tbWFuZHMoImRhbWFnZW11bHRpcGxpZXIgMTAwMCIpCiAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJyYW5nZW11bHRpcGxpZXIgMS41IikKICAgICAgICBFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkoYXRvbWhhbmRsZWJhciwgUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgUEVELkdFVF9QRURfQk9ORV9JTkRFWChQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAyODQyMiksIDAuMiwgMC45NSwgMC4yLCAxMDUsIDMwLjAsIDAsIHRydWUsIHRydWUsIGZhbHNlLCBmYWxzZSwgMCwgdHJ1ZSwgMCkKICAgICAgICBFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkoYXRvbWRhY2h1aSxhdG9taGFuZGxlYmFyLCAwLCAgMCwgMCwgLTAuMiwgLTM1LjAsIDEwMC4wLDAsIHRydWUsIHRydWUsIGZhbHNlLCBmYWxzZSwgMCwgdHJ1ZSwgMCkKICAgICAgICBFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkoYXRvbWRhY2h1aTEsYXRvbWhhbmRsZWJhciwgMCwgIDAsIDAsIC0wLjIwMSwgMTQ1LCAxMDAuMCwwLCB0cnVlLCB0cnVlLCBmYWxzZSwgZmFsc2UsIDAsIHRydWUsIDApCiAgICBlbHNlCiAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJkYW1hZ2VtdWx0aXBsaWVyIDEiKQogICAgICAgIG1lbnUudHJpZ2dlcl9jb21tYW5kcygicmFuZ2VtdWx0aXBsaWVyIDEiKQogICAgICAgIGRlbGV0ZV9lbnRpdHkoYXRvbWhhbmRsZWJhcikKICAgICAgICBkZWxldGVfZW50aXR5KGF0b21kYWNodWkpCiAgICAgICAgZGVsZXRlX2VudGl0eShhdG9tZGFjaHVpMSkKCiAgICAgICAgUEVELlNFVF9QRURfQ0FOX1NXSVRDSF9XRUFQT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSx0cnVlKS0t6Kej6Zmk56aB5q2i5YiH5o2i5q2m5ZmoCiAgICAgICAgV0VBUE9OLlNFVF9QRURfQ1VSUkVOVF9XRUFQT05fVklTSUJMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlLCBmYWxzZSwgZmFsc2UsIGZhbHNlKS0t6Kej6Zmk5q2m5Zmo6ZqQ5b2iCiAgICAgICAgV0VBUE9OLkdJVkVfV0VBUE9OX1RPX1BFRChQTEFZRVIuR0VUX1BMQVlFUl9QRURfU0NSSVBUX0lOREVYKFBMQVlFUi5QTEFZRVJfSUQoKSksLTE1Njk2MTUyNjEsMTUsdHJ1ZSx0cnVlKS0t57uZ5LqI5b6S5omLCiAgICBlbmQKZW5kCi0t5bCP54aK5aSn6ZSkCmZ1bmN0aW9uIGJlYXJoYW1tZXIob24pCiAgICBpZiBvbiB0aGVuCiAgICAgICAgUEVELlNFVF9QRURfQ0FOX1NXSVRDSF9XRUFQT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSxmYWxzZSktLeemgeatouWIh+aNouatpuWZqAogICAgICAgIFdFQVBPTi5HSVZFX1dFQVBPTl9UT19QRUQoUExBWUVSLkdFVF9QTEFZRVJfUEVEX1NDUklQVF9JTkRFWChQTEFZRVIuUExBWUVSX0lEKCkpLC0xODEwNzk1NzcxLDE1LHRydWUsdHJ1ZSktLee7meS6iOaMh+WumuatpuWZqAoKICAgICAgICBsb2NhbCBwb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSx0cnVlKQogICAgICAgIGJlYXJoYW5kbGViYXIgPSBPQkpFQ1QuQ1JFQVRFX09CSkVDVCh1dGlsLmpvYWF0KCJiYV9wcm9wX2JhdHRsZV9jYW1lcmFkcm9uZSIpLCBwb3MueCwgcG9zLnksIHBvcy56LCB0cnVlLCB0cnVlLCBmYWxzZSkKICAgICAgICBiZWFyZGFjaHVpID0gT0JKRUNULkNSRUFURV9PQkpFQ1QodXRpbC5qb2FhdCgicHJvcF9tcl9yYXNwYmVycnlfMDEiKSwgcG9zLngsIHBvcy55LCBwb3MueiwgdHJ1ZSwgdHJ1ZSwgZmFsc2UpCiAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJkYW1hZ2VtdWx0aXBsaWVyIDEwMDAiKQogICAgICAgIG1lbnUudHJpZ2dlcl9jb21tYW5kcygicmFuZ2VtdWx0aXBsaWVyIDEuNSIpCiAgICAgICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKGJlYXJoYW5kbGViYXIsIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIFBFRC5HRVRfUEVEX0JPTkVfSU5ERVgoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMjg0MjIpLCAwLjIsIDAuOTUsIDAuMiwgMTA1LCAzMC4wLCAwLCB0cnVlLCB0cnVlLCBmYWxzZSwgZmFsc2UsIDAsIHRydWUsIDApCiAgICAgICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKGJlYXJkYWNodWksYmVhcmhhbmRsZWJhciwgMCwgIDAsIDAsIDAuMTUsIDAsIDE4MCwxODAsIHRydWUsIHRydWUsIGZhbHNlLCBmYWxzZSwgMCwgdHJ1ZSwgMCkKICAgIGVsc2UKICAgICAgICBtZW51LnRyaWdnZXJfY29tbWFuZHMoImRhbWFnZW11bHRpcGxpZXIgMSIpCiAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJyYW5nZW11bHRpcGxpZXIgMSIpCiAgICAgICAgZGVsZXRlX2VudGl0eShiZWFyaGFuZGxlYmFyKQogICAgICAgIGRlbGV0ZV9lbnRpdHkoYmVhcmRhY2h1aSkKCiAgICAgICAgUEVELlNFVF9QRURfQ0FOX1NXSVRDSF9XRUFQT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSx0cnVlKS0t6Kej6Zmk56aB5q2i5YiH5o2i5q2m5ZmoCiAgICAgICAgV0VBUE9OLkdJVkVfV0VBUE9OX1RPX1BFRChQTEFZRVIuR0VUX1BMQVlFUl9QRURfU0NSSVBUX0lOREVYKFBMQVlFUi5QTEFZRVJfSUQoKSksLTE1Njk2MTUyNjEsMTUsdHJ1ZSx0cnVlKS0t57uZ5LqI5b6S5omLCiAgICBlbmQKZW5kCi0t57KJ6Imy54us6KeS5YW9CmZ1bmN0aW9uIHVuaWNvcm4ob24pCiAgICBpZiBvbiB0aGVuCiAgICAgICAgUEVELlNFVF9QRURfQ0FOX1NXSVRDSF9XRUFQT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSxmYWxzZSktLeemgeatouWIh+aNouatpuWZqAogICAgICAgIFdFQVBPTi5HSVZFX1dFQVBPTl9UT19QRUQoUExBWUVSLkdFVF9QTEFZRVJfUEVEX1NDUklQVF9JTkRFWChQTEFZRVIuUExBWUVSX0lEKCkpLC0xODEwNzk1NzcxLDE1LHRydWUsdHJ1ZSktLee7meS6iOaMh+WumuatpuWZqAogICAgICAgIFdFQVBPTi5TRVRfUEVEX0NVUlJFTlRfV0VBUE9OX1ZJU0lCTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UpLS3mrablmajpmpDlvaIKCiAgICAgICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksdHJ1ZSkKICAgICAgICB1bmljb3JuaGFuZGxlYmFyID0gT0JKRUNULkNSRUFURV9PQkpFQ1QodXRpbC5qb2FhdCgiYmFfcHJvcF9iYXR0bGVfY2FtZXJhZHJvbmUiKSwgcG9zLngsIHBvcy55LCBwb3MueiwgdHJ1ZSwgdHJ1ZSwgZmFsc2UpCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfVklTSUJMRSh1bmljb3JuaGFuZGxlYmFyLCBmYWxzZSwgMCkKICAgICAgICB1bmljb3JuZGFjaHVpID0gT0JKRUNULkNSRUFURV9PQkpFQ1QodXRpbC5qb2FhdCgiYmFfcHJvcF9iYXR0bGVfaG9iYnlfaG9yc2UiKSwgcG9zLngsIHBvcy55LCBwb3MueiwgdHJ1ZSwgdHJ1ZSwgZmFsc2UpCiAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJkYW1hZ2VtdWx0aXBsaWVyIDEwMDAiKQogICAgICAgIG1lbnUudHJpZ2dlcl9jb21tYW5kcygicmFuZ2VtdWx0aXBsaWVyIDEuNSIpCiAgICAgICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKHVuaWNvcm5oYW5kbGViYXIsIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIFBFRC5HRVRfUEVEX0JPTkVfSU5ERVgoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMjg0MjIpLCAwLjE2NSwgMC45LCAwLjIwNSwgMTA1LCAzMCwgMSwgdHJ1ZSwgdHJ1ZSwgZmFsc2UsIGZhbHNlLCAwLCB0cnVlLCAwKQogICAgICAgIEVOVElUWS5BVFRBQ0hfRU5USVRZX1RPX0VOVElUWSh1bmljb3JuZGFjaHVpLHVuaWNvcm5oYW5kbGViYXIsIDAsIDAsIDAsIDAuNzQsIC0xLjksIDE4NCwgMjMzLCB0cnVlLCB0cnVlLCBmYWxzZSwgZmFsc2UsIDAsIHRydWUsIDApCiAgICBlbHNlCiAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmRzKCJkYW1hZ2VtdWx0aXBsaWVyIDEiKQogICAgICAgIG1lbnUudHJpZ2dlcl9jb21tYW5kcygicmFuZ2VtdWx0aXBsaWVyIDEiKQogICAgICAgIGRlbGV0ZV9lbnRpdHkodW5pY29ybmhhbmRsZWJhcikKICAgICAgICBkZWxldGVfZW50aXR5KHVuaWNvcm5kYWNodWkpCgogICAgICAgIFBFRC5TRVRfUEVEX0NBTl9TV0lUQ0hfV0VBUE9OKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksdHJ1ZSktLeino+mZpOemgeatouWIh+aNouatpuWZqAogICAgICAgIFdFQVBPTi5TRVRfUEVEX0NVUlJFTlRfV0VBUE9OX1ZJU0lCTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSktLeino+mZpOatpuWZqOmakOW9ogogICAgICAgIFdFQVBPTi5HSVZFX1dFQVBPTl9UT19QRUQoUExBWUVSLkdFVF9QTEFZRVJfUEVEX1NDUklQVF9JTkRFWChQTEFZRVIuUExBWUVSX0lEKCkpLC0xNTY5NjE1MjYxLDE1LHRydWUsdHJ1ZSktLee7meS6iOW+kuaJiwogICAgZW5kCmVuZAotLeWkquWIgApmdW5jdGlvbiBrbmlmZShvbikKICAgIGlmIG9uIHRoZW4KICAgICAgICBQRUQuU0VUX1BFRF9DQU5fU1dJVENIX1dFQVBPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpLGZhbHNlKS0t56aB5q2i5YiH5o2i5q2m5ZmoCiAgICAgICAgbG9jYWwgcG9zID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICAgICAgc2FiZXIgPSBPQkpFQ1QuQ1JFQVRFX09CSkVDVCh1dGlsLmpvYWF0KCJwcm9wX2NzX2thdGFuYV8wMSIpLCBwb3MueCwgcG9zLnksIHBvcy56LCB0cnVlLCB0cnVlLCBmYWxzZSkKICAgICAgICBXRUFQT04uR0lWRV9XRUFQT05fVE9fUEVEKFBMQVlFUi5HRVRfUExBWUVSX1BFRF9TQ1JJUFRfSU5ERVgoUExBWUVSLlBMQVlFUl9JRCgpKSwxMzE3NDk0NjQzLDE1LHRydWUsdHJ1ZSkKICAgICAgICBXRUFQT04uU0VUX1BFRF9DVVJSRU5UX1dFQVBPTl9WSVNJQkxFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIG5vdCBvbiwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgICAgICBFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkoc2FiZXIsIFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIFBFRC5HRVRfUEVEX0JPTkVfSU5ERVgoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMjg0MjIpLCAwLjA3LCAwLCAwLCAtMTAwLCAwLjAsIDAsIHRydWUsIHRydWUsIHRydWUsIHRydWUsIDAsIHRydWUsIDApCiAgICBlbHNlCiAgICAgICAgUEVELlNFVF9QRURfQ0FOX1NXSVRDSF9XRUFQT04oUExBWUVSLlBMQVlFUl9QRURfSUQoKSx0cnVlKQogICAgICAgIGRlbGV0ZV9lbnRpdHkoc2FiZXIpCiAgICAgICAgV0VBUE9OLkdJVkVfV0VBUE9OX1RPX1BFRChQTEFZRVIuR0VUX1BMQVlFUl9QRURfU0NSSVBUX0lOREVYKFBMQVlFUi5QTEFZRVJfSUQoKSksLTE1Njk2MTUyNjEsMTUsdHJ1ZSx0cnVlKS0t57uZ5LqI5b6S5omLCiAgICBlbmQKZW5kCgotLS3lsI/mjILku7YKCmZ1bmN0aW9uIGRkX3Nob3dwbmcoKQogICAgbG9jYWwgSW1nID0gZGlyZWN0eC5jcmVhdGVfdGV4dHVyZShmaWxlc3lzdGVtLnJlc291cmNlc19kaXIoKSAuLiAiU2FrdXJhU2NyaXB0XFxJbWdcXDEucG5nIikKICAgIGRpcmVjdHguZHJhd190ZXh0dXJlKEltZywgMC4xLCAwLjEsIDEuMywgLTEuMSwgMC41LCAwLjUsIDAsIDEsIDEsIDEsIDEpCmVuZAoKLS0tLS0tLeWWt+eBq+WZqApmbGFtZW1pbGRPcmFuZ2VGaXJlID0gbmV3X2NvbG91ciggMjU1LCAxMjcsIDgwICkKZmxhbWVUaHJvd2VyID0gewogICAgY29sb3VyID0gZmxhbWVtaWxkT3JhbmdlRmlyZQp9CmZ1bmN0aW9uIGZsYW1lZ3VuKCkKICAgIGlmIFdFQVBPTi5HRVRfU0VMRUNURURfUEVEX1dFQVBPTihQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSB+PSAxMTE5ODQ5MDkzIG9yIG5vdCBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDIsIDI1KSB0aGVuCiAgICAgICAgaWYgbm90IGZsYW1lVGhyb3dlci5wdGZ4IHRoZW4gcmV0dXJuIGVuZAogICAgICAgIEdSQVBISUNTLlJFTU9WRV9QQVJUSUNMRV9GWChmbGFtZVRocm93ZXIucHRmeCwgZmFsc2UpCiAgICAgICAgU1RSRUFNSU5HLlJFTU9WRV9OQU1FRF9QVEZYX0FTU0VUKCd3ZWFwX3hzX3ZlaGljbGVfd2VhcG9ucycpCiAgICAgICAgZmxhbWVUaHJvd2VyLnB0ZnggPSBuaWwKICAgICAgICByZXR1cm4KICAgIGVuZAogICAgUExBWUVSLkRJU0FCTEVfUExBWUVSX0ZJUklORyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCB0cnVlKQogICAgd2hpbGUgbm90IFNUUkVBTUlORy5IQVNfTkFNRURfUFRGWF9BU1NFVF9MT0FERUQoJ3dlYXBfeHNfdmVoaWNsZV93ZWFwb25zJykgZG8KICAgICAgICBTVFJFQU1JTkcuUkVRVUVTVF9OQU1FRF9QVEZYX0FTU0VUKCd3ZWFwX3hzX3ZlaGljbGVfd2VhcG9ucycpCiAgICAgICAgdXRpbC55aWVsZCgpCiAgICBlbmQKICAgIEdSQVBISUNTLlVTRV9QQVJUSUNMRV9GWF9BU1NFVCgnd2VhcF94c192ZWhpY2xlX3dlYXBvbnMnKQogICAgaWYgZmxhbWVUaHJvd2VyLnB0ZnggPT0gbmlsIHRoZW4KICAgICAgICBmbGFtZVRocm93ZXIucHRmeCA9IEdSQVBISUNTLlNUQVJUX05FVFdPUktFRF9QQVJUSUNMRV9GWF9MT09QRURfT05fRU5USVRZX0JPTkUoCiAgICAgICAgICAgICAgICAnbXV6X3hzX3R1cnJldF9mbGFtZXRocm93ZXJfbG9vcGluZycsCiAgICAgICAgICAgICAgICBXRUFQT04uR0VUX0NVUlJFTlRfUEVEX1dFQVBPTl9FTlRJVFlfSU5ERVgoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMCksCiAgICAgICAgICAgICAgICAwLjgsIDAsIDAsIDAsIDAsIDI3MCwKICAgICAgICAgICAgICAgIEVOVElUWS5HRVRfRU5USVRZX0JPTkVfSU5ERVhfQllfTkFNRShXRUFQT04uR0VUX0NVUlJFTlRfUEVEX1dFQVBPTl9FTlRJVFlfSU5ERVgoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMCksICdHdW5fTnV6emxlJyksCiAgICAgICAgICAgICAgICAwLjUsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDAsIDAsIDAsIDAKICAgICAgICAgICAgKQogICAgICAgIEdSQVBISUNTLlNFVF9QQVJUSUNMRV9GWF9MT09QRURfQ09MT1VSKGZsYW1lVGhyb3dlci5wdGZ4LCBmbGFtZVRocm93ZXIuY29sb3VyLnIsIGZsYW1lVGhyb3dlci5jb2xvdXIuZywgZmxhbWVUaHJvd2VyLmNvbG91ci5iLCBmYWxzZSkKICAgIGVuZAplbmQKCgoKLS3lj4zmi7MKbG9jYWwgYm9uZXMgPSB7CiAgICAyNjYxMiwKICAgIDU4ODY4LAp9CmZ1bmN0aW9uIEZpcmVfRmlzdChvbikKICAgIGlmIG9uIHRoZW4KICAgICAgICBmb3IgXywgYm9uZUlkIGluIGlwYWlycyhib25lcykgZG8KICAgICAgICByZXF1ZXN0X3B0ZnhfYXNzZXQoImNvcmUiKQogICAgICAgIEdSQVBISUNTLlVTRV9QQVJUSUNMRV9GWF9BU1NFVCgiY29yZSIpCiAgICAgICAgR1JBUEhJQ1MuU1RBUlRfTkVUV09SS0VEX1BBUlRJQ0xFX0ZYX0xPT1BFRF9PTl9FTlRJVFlfQk9ORSgiZmlyZV93cmVja2VkX3BsYW5lX2NvY2twaXQiLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwLCAwLCAwLCAwLCAwICwgMCxQRUQuR0VUX1BFRF9CT05FX0lOREVYKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGJvbmVJZCksIDAuMzUsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDAsIDAsIDAsIDApCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgR1JBUEhJQ1MuUkVNT1ZFX1BBUlRJQ0xFX0ZYX0ZST01fRU5USVRZKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICBlbmQKZW5kCmZ1bmN0aW9uIEJsb29kX0Zpc3Qob24pCiAgICBpZiBvbiB0aGVuCiAgICAgICAgZm9yIF8sIGJvbmVJZCBpbiBpcGFpcnMoYm9uZXMpIGRvCiAgICAgICAgcmVxdWVzdF9wdGZ4X2Fzc2V0KCJjb3JlIikKICAgICAgICBHUkFQSElDUy5VU0VfUEFSVElDTEVfRlhfQVNTRVQoImNvcmUiKQogICAgICAgIEdSQVBISUNTLlNUQVJUX05FVFdPUktFRF9QQVJUSUNMRV9GWF9MT09QRURfT05fRU5USVRZX0JPTkUoInNjcmFwZV9ibG9vZF9jYXIiLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwLCAwLCAwLCAwLCAwICwgMCxQRUQuR0VUX1BFRF9CT05FX0lOREVYKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGJvbmVJZCksIDAuMzUsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDAsIDAsIDAsIDApCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgR1JBUEhJQ1MuUkVNT1ZFX1BBUlRJQ0xFX0ZYX0ZST01fRU5USVRZKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICBlbmQKZW5kCmZ1bmN0aW9uIFJhaWRlbl9GaXN0KG9uKQogICAgaWYgb24gdGhlbgogICAgICAgIGZvciBfLCBib25lSWQgaW4gaXBhaXJzKGJvbmVzKSBkbwogICAgICAgIHJlcXVlc3RfcHRmeF9hc3NldCgic2NyX3JlY29uc3RydWN0aW9uYWNjaWRlbnQiKQogICAgICAgIEdSQVBISUNTLlVTRV9QQVJUSUNMRV9GWF9BU1NFVCgic2NyX3JlY29uc3RydWN0aW9uYWNjaWRlbnQiKQogICAgICAgIEdSQVBISUNTLlNUQVJUX05FVFdPUktFRF9QQVJUSUNMRV9GWF9MT09QRURfT05fRU5USVRZX0JPTkUoInNjcl9zcGFya2luZ19nZW5lcmF0b3IiLCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCAwLCAwLCAwLCAwLCAwICwgMCxQRUQuR0VUX1BFRF9CT05FX0lOREVYKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGJvbmVJZCksIDIsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDAsIDAsIDAsIDApCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgR1JBUEhJQ1MuUkVNT1ZFX1BBUlRJQ0xFX0ZYX0ZST01fRU5USVRZKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICBlbmQKZW5kCgoKCi0tLS0t6Ieq5Yqo6IqC5rWB5ZmoCnBlZF9saW1pdCA9IDEwMAp2ZWhfbGltaXQgPSAxODAKb2JqX2xpbWl0ID0gNTAwCmZ1bmN0aW9uIGVudGl0eV9saW1pdCgpCiAgICBsb2NhbCBwZWRfY291bnQgPSAwCiAgICBmb3IgXywgcGVkIGluIHBhaXJzKGVudGl0aWVzLmdldF9hbGxfcGVkc19hc19oYW5kbGVzKCkpIGRvCiAgICAgICAgaWYgcGVkIH49IFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkgdGhlbgogICAgICAgICAgICBwZWRfY291bnQgPSBwZWRfY291bnQgKyAxCiAgICAgICAgZW5kCiAgICBlbmQKICAgIGlmIHBlZF9jb3VudCA+PSBwZWRfbGltaXQgdGhlbgogICAgICAgIHV0aWwudG9hc3QoIlBlZOaxoOi+vuWIsOS4iumZkCzmraPlnKjmuIXnkIYuLi4iKQogICAgICAgIGZvciBpLCBwZWQgaW4gcGFpcnMoZW50aXRpZXMuZ2V0X2FsbF9wZWRzX2FzX2hhbmRsZXMoKSkgZG8KICAgICAgICAgICAgZGVsZXRlX2VudGl0eShwZWQpCiAgICAgICAgICAgIHV0aWwueWllbGQoMTApCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBsb2NhbCB2ZWhfX2NvdW50ID0gMAogICAgZm9yIF8sIHZlaCBpbiBpcGFpcnMoZW50aXRpZXMuZ2V0X2FsbF92ZWhpY2xlc19hc19oYW5kbGVzKCkpIGRvCiAgICAgICAgdmVoX19jb3VudCA9IHZlaF9fY291bnQgKyAxCiAgICBlbmQKICAgIGlmIHZlaF9fY291bnQgPj0gdmVoX2xpbWl0IHRoZW4KICAgICAgICB1dGlsLnRvYXN0KCLovb3lhbfmsaDovr7liLDkuIrpmZAs5q2j5Zyo5riF55CGLi4uIikKICAgICAgICBmb3IgaSwgdmVoIGluIGlwYWlycyhlbnRpdGllcy5nZXRfYWxsX3ZlaGljbGVzX2FzX2hhbmRsZXMoKSkgZG8gCiAgICAgICAgICAgIGRlbGV0ZV9lbnRpdHkodmVoKQogICAgICAgICAgICB1dGlsLnlpZWxkKDEwKQogICAgICAgIGVuZCAgICAgCiAgICBlbmQgCgogICAgbG9jYWwgb2JqX2NvdW50ID0gMCAgICAKICAgIGZvciBfLCBvYmogaW4gcGFpcnMoZW50aXRpZXMuZ2V0X2FsbF9vYmplY3RzX2FzX2hhbmRsZXMoKSkgZG8gICAgCiAgICAgICAgb2JqX2NvdW50ID0gb2JqX2NvdW50ICsgMSAgIAogICAgZW5kCiAgICBpZiBvYmpfY291bnQgPj0gb2JqX2xpbWl0IHRoZW4gCiAgICAgICAgdXRpbC50b2FzdCgi54mp5L2T5rGg6L6+5Yiw5LiK6ZmQLOato+WcqOa4heeQhi4uLiIpCiAgICAgICAgZm9yIGksIG9iaiBpbiBwYWlycyhlbnRpdGllcy5nZXRfYWxsX29iamVjdHNfYXNfaGFuZGxlcygpKSBkbwogICAgICAgICAgICBkZWxldGVfZW50aXR5KG9iaikKICAgICAgICAgICAgdXRpbC55aWVsZCgxMCkKICAgICAgICBlbmQKICAgIGVuZAoKICAgIHV0aWwueWllbGQoMTAwMCkKZW5kCgoKLS0tLemHjeWKm+WunuS9k+aeqgpzaG9vdGVudCA9IC00MjI4Nzc2NjYKZnVuY3Rpb24gZWVudGl0eV9ndW4oKQogICAgaWYgUEVELklTX1BFRF9TSE9PVElORyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSB0aGVuCiAgICAgICAgbG9jYWwgaGFzaCA9IHNob290ZW50CiAgICAgICAgcmVxdWVzdF9tb2RlbChoYXNoKQogICAgICAgIGxvY2FsIGMxID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIDAuMCwgNS4wLCAwLjApCiAgICAgICAgbG9jYWwgcmVzID0gcmF5Y2FzdF9nYW1lcGxheV9jYW0oLTEsIDEwMDAuMCkKICAgICAgICBsb2NhbCBkaXIgPSB7fQogICAgICAgIGxvY2FsIGMyID0ge30KICAgICAgICBpZiByZXNbMV0gfj0gMCB0aGVuCiAgICAgICAgICAgIGMyID0gcmVzWzJdCiAgICAgICAgICAgIGRpclsneCddID0gKGMyWyd4J10gLSBjMVsneCddKSoxMDAwCiAgICAgICAgICAgIGRpclsneSddID0gKGMyWyd5J10gLSBjMVsneSddKSoxMDAwCiAgICAgICAgICAgIGRpclsneiddID0gKGMyWyd6J10gLSBjMVsneiddKSoxMDAwCiAgICAgICAgZWxzZSAKICAgICAgICAgICAgYzIgPSBnZXRfb2Zmc2V0X2Zyb21fY2FtZXJhKDEwMDApCiAgICAgICAgICAgIGRpclsneCddID0gKGMyWyd4J10gLSBjMVsneCddKSoxMDAwCiAgICAgICAgICAgIGRpclsneSddID0gKGMyWyd5J10gLSBjMVsneSddKSoxMDAwCiAgICAgICAgICAgIGRpclsneiddID0gKGMyWyd6J10gLSBjMVsneiddKSoxMDAwCiAgICAgICAgZW5kCiAgICAgICAgbG9jYWwgZW50ID0gY3JlYXRlX29iamVjdChoYXNoLCBjMVsneCddLCBjMVsneSddLCBjMVsneiddKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX05PX0NPTExJU0lPTl9FTlRJVFkoZW50LCBQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgICAgICBFTlRJVFkuQVBQTFlfRk9SQ0VfVE9fRU5USVRZKGVudCwgMCwgZGlyWyd4J10sIGRpclsneSddLCBkaXJbJ3onXSwgMC4wLCAwLjAsIDAuMCwgMCwgdHJ1ZSwgZmFsc2UsIHRydWUsIGZhbHNlLCB0cnVlKQogICAgZW5kCmVuZAoKLS0tLS0t6L295YW36YCJ6aG5CgotLS0t5aSx5o6n6am+6am2CmZ1bmN0aW9uIGluY29udHJvbGxhYmxlX2RyaXZpbmcodG9nZ2xlZCkKICAgIGxvY2FsIGxhc3RfdmVoaWNsZSA9IFBFRC5HRVRfVkVISUNMRV9QRURfSVNfSU4oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSkKICAgIGlmIHRvZ2dsZWQgdGhlbgogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfUkVEVUNFX0dSSVAobGFzdF92ZWhpY2xlLCB0cnVlKQogICAgICAgIFZFSElDTEUxLl9TRVRfVkVISUNMRV9SRURVQ0VfVFJBQ1RJT04obGFzdF92ZWhpY2xlLCA1MCkKICAgIGVsc2UKICAgICAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX1JFRFVDRV9HUklQKGxhc3RfdmVoaWNsZSwgZmFsc2UpCiAgICAgICAgVkVISUNMRTEuX1NFVF9WRUhJQ0xFX1JFRFVDRV9UUkFDVElPTihsYXN0X3ZlaGljbGUsIDEwMCkKICAgIGVuZAplbmQKCi0tLS3lv6vpgJ/liLnovaYKZnVuY3Rpb24gUXVpY2tfYnJha2UoKQogICAgbG9jYWwgdmVoaWNsZSA9IFBFRC5HRVRfVkVISUNMRV9QRURfSVNfVVNJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgIGlmIFBBRC5JU19DT05UUk9MX0pVU1RfUFJFU1NFRCgwLCA3MikgYW5kIEVOVElUWS5HRVRfRU5USVRZX1NQRUVEKHZlaGljbGUpID49IDAgYW5kIG5vdCBFTlRJVFkuSVNfRU5USVRZX0lOX0FJUih2ZWhpY2xlKSBhbmQgVkVISUNMRS5HRVRfUEVEX0lOX1ZFSElDTEVfU0VBVCh2ZWhpY2xlLCAtMSwgZmFsc2UpID09IFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkgdGhlbgogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfRk9SV0FSRF9TUEVFRCh2ZWhpY2xlLCBFTlRJVFkuR0VUX0VOVElUWV9TUEVFRCh2ZWhpY2xlKSAvIDIpCiAgICAgICAgdXRpbC55aWVsZCgyNTApCiAgICBlbmQKZW5kCgotLS0t5ryC56e75qih5byPCmZ1bmN0aW9uIERyaWZ0X21vZGUoKQogICAgbG9jYWwgdmVoaWNsZSA9IFBFRC5HRVRfVkVISUNMRV9QRURfSVNfSU4oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpCiAgICBpZiBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsIDIxKSB0aGVuCiAgICAgICAgVkVISUNMRS5TRVRfVkVISUNMRV9SRURVQ0VfR1JJUCh2ZWhpY2xlLCB0cnVlKQogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfUkVEVUNFX0dSSVBfTEVWRUwodmVoaWNsZSwgMC4wKQogICAgZWxzZQogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfUkVEVUNFX0dSSVAodmVoaWNsZSwgZmFsc2UpCiAgICBlbmQKZW5kCgotLS0t6JC95Zyw5by56LezCmxvY2FsIEx3YXNJbkFpcgpmdW5jdGlvbiBMYW5kaW5nX2JvdW5jZSgpCiAgICBsb2NhbCB2ZWhpY2xlID0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19VU0lORyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgbG9jYWwgaXNJbkFpciA9IEVOVElUWS5JU19FTlRJVFlfSU5fQUlSKHZlaGljbGUpCiAgICBpZiBMd2FzSW5BaXIgYW5kIG5vdCBpc0luQWlyIHRoZW4KICAgICAgICBsb2NhbCB2ZWMgPSBFTlRJVFkuR0VUX0VOVElUWV9WRUxPQ0lUWSh2ZWhpY2xlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1ZFTE9DSVRZKHZlaGljbGUsIHZlYy54LCB2ZWMueSwgKHZlYy56ICogLTEgKiAwLjUpKQogICAgZW5kCiAgICBMd2FzSW5BaXIgPSBpc0luQWlyCmVuZAoKLS0tLei9veWFt+aVsuWktApmdW5jdGlvbiBtdXNjbGVfY2FyKCkKICAgIGlmIFBFRC5JU19QRURfSU5fQU5ZX1ZFSElDTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSkgdGhlbgogICAgICAgIGxvY2FsIENBdXRvbW9iaWxlID0gZW50aXRpZXMuZ2V0X3VzZXJfdmVoaWNsZV9hc19wb2ludGVyKCkKICAgICAgICBsb2NhbCB2ZWhpY2xlTW9kZWwgPSBFTlRJVFkuR0VUX0VOVElUWV9NT0RFTChlbnRpdGllcy5nZXRfdXNlcl92ZWhpY2xlX2FzX2hhbmRsZSgpKQogICAgICAgIGlmIFZFSElDTEUuSVNfVEhJU19NT0RFTF9BX0NBUih2ZWhpY2xlTW9kZWwpIG9yIFZFSElDTEUuSVNfVEhJU19NT0RFTF9BTl9BTVBISUJJT1VTX0NBUih2ZWhpY2xlTW9kZWwpIHRoZW4gCiAgICAgICAgICAgIGxvY2FsIENIYW5kbGluZ0RhdGEgPSBlbnRpdGllcy52ZWhpY2xlX2dldF9oYW5kbGluZyhDQXV0b21vYmlsZSkKICAgICAgICAgICAgbWVtb3J5LndyaXRlX2Zsb2F0KENIYW5kbGluZ0RhdGEgKyAweDAwRUMsIFBBRC5JU19DT05UUk9MX1BSRVNTRUQoMCwgNzEpIGFuZCBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsIDI4MCkgYW5kIC0wLjM1IG9yIDAuNSkKICAgICAgICBlbmQKICAgIGVuZAplbmQKCi0tLS3nibnmrorog73lipsKZnVuY3Rpb24gdmVoX2NhcGFjaXR5KGNvbmRpdGlvbiwgb2Zmc2V0LCB2YWx1ZSkKICAgIHdoaWxlIF9HW2NvbmRpdGlvbl0gZG8KICAgICAgICBpZiBQRUQuSVNfUEVEX0lOX0FOWV9WRUhJQ0xFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHRydWUpIHRoZW4KICAgICAgICAgICAgLS1wQ1ZlaGljbGUgPSBNZW06bmV3KHdvcmxkUHRyKTpvZmZzZXQoMHgwOCk6b2Zmc2V0KDB4RDEwKS5yZWFkTG9uZygpCiAgICAgICAgICAgIGxvY2FsIHBDVmVoaWNsZSA9IGVudGl0aWVzLmhhbmRsZV90b19wb2ludGVyKFBFRC5HRVRfVkVISUNMRV9QRURfSVNfVVNJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkpCiAgICAgICAgICAgIGxvY2FsIHBDTW9kZWxJbmZvID0gbWVtb3J5LnJlYWRfbG9uZyhwQ1ZlaGljbGUgKyAweDIwKQogICAgICAgICAgICBtZW1vcnkud3JpdGVfYnl0ZShwQ01vZGVsSW5mbyArIG9mZnNldCwgdmFsdWUpCiAgICAgICAgZW5kCiAgICAgICAgdXRpbC55aWVsZCgpCiAgICBlbmQKICAgIGlmIFBFRC5JU19QRURfSU5fQU5ZX1ZFSElDTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSkgdGhlbgogICAgICAgIGxvY2FsIHBDVmVoaWNsZSA9IGVudGl0aWVzLmhhbmRsZV90b19wb2ludGVyKFBFRC5HRVRfVkVISUNMRV9QRURfSVNfVVNJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkpCiAgICAgICAgbG9jYWwgcENNb2RlbEluZm8gPSBtZW1vcnkucmVhZF9sb25nKHBDVmVoaWNsZSArIDB4MjApCiAgICAgICAgbWVtb3J5LndyaXRlX2J5dGUocENNb2RlbEluZm8gKyBvZmZzZXQsIDB4MDApCiAgICBlbmQKZW5kCgotLS0t57KY5Zyo5Zyw5LiKCmZ1bmN0aW9uIGdyb3VuZF9kcml2aW5nKCkKICAgIGxvY2FsIHZlaGljbGUgPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX1VTSU5HKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICBsb2NhbCB2ZWxvY2l0eSA9IEVOVElUWS5HRVRfRU5USVRZX1ZFTE9DSVRZKHZlaGljbGUpCiAgICBsb2NhbCBoZWlnaHQgPSBFTlRJVFkuR0VUX0VOVElUWV9IRUlHSFRfQUJPVkVfR1JPVU5EKHZlaGljbGUpCiAgICBsb2NhbCBjb250cm9scyA9IHszMiwgMzMsIDM0LCAzNX0KICAgIGlmIGhlaWdodCA8IDUuMCB0aGVuCiAgICAgICAgaWYgRU5USVRZLklTX0VOVElUWV9JTl9BSVIodmVoaWNsZSkgdGhlbgogICAgICAgICAgICBWRUhJQ0xFMS5TRVRfVkVISUNMRV9PTl9HUk9VTkRfUFJPUEVSTFkodmVoaWNsZSkKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICBmb3IgXywga2V5IGluIGlwYWlycyhjb250cm9scykgZG8KICAgICAgICAgICAgaWYgdmVoaWNsZSB+PSAwIGFuZCBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDAsIGtleSkgdGhlbgogICAgICAgICAgICAgICAgd2hpbGUgbm90IFBBRC5JU19DT05UUk9MX1JFTEVBU0VEKDAsIGtleSkgYW5kIEVOVElUWS5JU19FTlRJVFlfSU5fQUlSKHZlaGljbGUpIGRvCiAgICAgICAgICAgICAgICAgICAgRU5USVRZLkFQUExZX0ZPUkNFX1RPX0VOVElUWSh2ZWhpY2xlLCAyLCAwLCAwLCAtNTAwIC0gdmVsb2NpdHkueiwgMCwgMCwgMCwgMCwgdHJ1ZSwgZmFsc2UsIHRydWUsIGZhbHNlLCB0cnVlKQogICAgICAgICAgICAgICAgICAgIHV0aWwueWllbGQoKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCmVuZAoKLS0tLeWPjeWQkeaOp+WItgpmdW5jdGlvbiBjYXJfY3Jhc2goc3RhdGUpCiAgICB2ZWggPSBlbnRpdGllcy5nZXRfdXNlcl92ZWhpY2xlX2FzX2hhbmRsZSgpCiAgICBpZiBzdGF0ZSB0aGVuCiAgICAgICAgVkVISUNMRTEuX1NFVF9WRUhJQ0xFX0NPTlRST0xTX0lOVkVSVEVEKHZlaCwgdHJ1ZSkKICAgIGVsc2UKICAgICAgICBWRUhJQ0xFMS5fU0VUX1ZFSElDTEVfQ09OVFJPTFNfSU5WRVJURUQodmVoLCBmYWxzZSkKICAgIGVuZAplbmQKCi0t5rCu5rCU5Yqg6YCfCmxvY2FsIG5pdHJvX2R1cmF0aW9uID0gMjAwMApsb2NhbCBuaXRyb19wb3dlciA9IDIwMDAKZnVuY3Rpb24gbm5pdHJvZ2VuX2FjY2VsZXJhdGlvbigpCiAgICBsb2NhbCBwbGF5ZXJfY3VyX2NhciA9IGVudGl0aWVzLmdldF91c2VyX3ZlaGljbGVfYXNfaGFuZGxlKCkKICAgIGlmIFBFRC5JU19QRURfSU5fQU5ZX1ZFSElDTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdHJ1ZSkgYW5kIHBsYXllcl9jdXJfY2FyIH49IDAgdGhlbgogICAgICAgIGlmIFBBRC5JU19DT05UUk9MX0pVU1RfUFJFU1NFRCgzNTcsIDM1NykgdGhlbiAtLXgKICAgICAgICAgICAgcmVxdWVzdF9wdGZ4X2Fzc2V0KCd2ZWhfeHNfdmVoaWNsZV9tb2RzJykKICAgICAgICAgICAgR1JBUEhJQ1MuVVNFX1BBUlRJQ0xFX0ZYX0FTU0VUKCd2ZWhfeHNfdmVoaWNsZV9tb2RzJykKICAgICAgICAgICAgVkVISUNMRTEuU0VUX09WRVJSSURFX05JVFJPVVNfTEVWRUwocGxheWVyX2N1cl9jYXIsIHRydWUsIDEwMCwgbml0cm9fcG93ZXIsIDk5OTk5OTk5OTk5LCBmYWxzZSkKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfTUFYX1NQRUVEKHBsYXllcl9jdXJfY2FyLCAyMDAwKQogICAgICAgICAgICBWRUhJQ0xFMS5TRVRfVkVISUNMRV9NQVhfU1BFRUQocGxheWVyX2N1cl9jYXIsIDIwMDApCiAgICAgICAgICAgIHV0aWwueWllbGQobml0cm9fZHVyYXRpb24pCiAgICAgICAgICAgIFZFSElDTEUxLlNFVF9PVkVSUklERV9OSVRST1VTX0xFVkVMKHBsYXllcl9jdXJfY2FyLCBmYWxzZSwgMCwgMCwgMCwgZmFsc2UpCiAgICAgICAgICAgIFZFSElDTEUxLlNFVF9WRUhJQ0xFX01BWF9TUEVFRChwbGF5ZXJfY3VyX2NhciwgMC4wKQogICAgICAgIGVuZAogICAgZW5kCmVuZApmdW5jdGlvbiBubml0cm9fZHVyYXRpb24odmFsKQogICAgbml0cm9fZHVyYXRpb24gPSB2YWwgKiAxMDAwCmVuZApmdW5jdGlvbiBubml0cm9fcG93ZXIodmFsKQogICAgbml0cm9fcG93ZXIgPSB2YWwKZW5kCmluaXRpYWxfZF9tb2RlID0gZmFsc2UKaW5pdGlhbF9kX3Njb3JlID0gZmFsc2UKZnVuY3Rpb24gb25fdXNlcl9jaGFuZ2VfdmVoaWNsZSh2ZWhpY2xlKQogICAgaWYgdmVoaWNsZSB+PSAwIHRoZW4KICAgICAgICBpZiBpbml0aWFsX2RfbW9kZSB0aGVuIAogICAgICAgICAgICBzZXRfdmVoaWNsZV9pbnRvX2RyaWZ0X21vZGUodmVoaWNsZSkKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgZGVlel9udXRzID0ge30KICAgICAgICBsb2NhbCBudW1fc2VhdHMgPSBWRUhJQ0xFLkdFVF9WRUhJQ0xFX01PREVMX05VTUJFUl9PRl9TRUFUUyhFTlRJVFkuR0VUX0VOVElUWV9NT0RFTCh2ZWhpY2xlKSkKICAgICAgICBmb3IgaT0xLCBudW1fc2VhdHMgZG8KICAgICAgICAgICAgaWYgbnVtX3NlYXRzID49IDIgdGhlbgogICAgICAgICAgICAgICAgZGVlel9udXRzWyNkZWV6X251dHMgKyAxXSA9IHRvc3RyaW5nKGkgLSAyKQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBkZWV6X251dHNbI2RlZXpfbnV0cyArIDFdID0gdG9zdHJpbmcoaSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICAgICAgaWYgdHJ1ZSB0aGVuIAogICAgICAgICAgICBuYXRpdmVfaW52b2tlci5iZWdpbl9jYWxsKCkKICAgICAgICAgICAgbmF0aXZlX2ludm9rZXIucHVzaF9hcmdfaW50KHZlaGljbGUpCiAgICAgICAgICAgIG5hdGl2ZV9pbnZva2VyLmVuZF9jYWxsKCI3NkQyNkEyMjc1MEU4NDlFIikKICAgICAgICBlbmQKICAgIGVuZAplbmQKCgotLS0tLS0t5ouJ6L2mCmZ1bmN0aW9uIHVwZGF0ZV9hdHRhY2htZW50X3Bvc2l0aW9uKGF0dGFjaG1lbnQpCiAgICBpZiBhdHRhY2htZW50Lm9mZnNldCA9PSBuaWwgdGhlbgogICAgICAgIGF0dGFjaG1lbnQub2Zmc2V0ID0ge3g9MCx5PTAsej0wfQogICAgZW5kCiAgICBpZiBhdHRhY2htZW50LnJvdGF0aW9uID09IG5pbCB0aGVuCiAgICAgICAgYXR0YWNobWVudC5yb3RhdGlvbiA9IHt4PTAseT0wLHo9MH0KICAgIGVuZAogICAgaWYgYXR0YWNobWVudC5jb2xsaXNpb24gPT0gbmlsIHRoZW4KICAgICAgICBhdHRhY2htZW50LmNvbGxpc2lvbiA9IHRydWUKICAgIGVuZAogICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKAogICAgICAgIGF0dGFjaG1lbnQuaGFuZGxlLCBhdHRhY2htZW50LnJvb3QsIGF0dGFjaG1lbnQuYm9uZV9pbmRleCBvciAwLAogICAgICAgIGF0dGFjaG1lbnQub2Zmc2V0Lnggb3IgMCwgYXR0YWNobWVudC5vZmZzZXQueSBvciAwLCBhdHRhY2htZW50Lm9mZnNldC56IG9yIDAsCiAgICAgICAgYXR0YWNobWVudC5yb3RhdGlvbi54IG9yIDAsIGF0dGFjaG1lbnQucm90YXRpb24ueSBvciAwLCBhdHRhY2htZW50LnJvdGF0aW9uLnogb3IgMCwKICAgICAgICBmYWxzZSwgdHJ1ZSwgYXR0YWNobWVudC5jb2xsaXNpb24sIGZhbHNlLCAyLCB0cnVlLCAwCiAgICApCmVuZApmdW5jdGlvbiBnZXRfdmVoaWNsZV9kaW1lbnNpb24odmVoaWNsZSkKICAgIGxvY2FsIG1pbmltdW0gPSBtZW1vcnkuYWxsb2MoKQogICAgbG9jYWwgbWF4aW11bSA9IG1lbW9yeS5hbGxvYygpCiAgICBNSVNDLkdFVF9NT0RFTF9ESU1FTlNJT05TKEVOVElUWS5HRVRfRU5USVRZX01PREVMKHZlaGljbGUpLCBtaW5pbXVtLCBtYXhpbXVtKQogICAgbG9jYWwgbWluaW11bV92ZWMgPSB2My5uZXcobWluaW11bSkKICAgIGxvY2FsIG1heGltdW1fdmVjID0gdjMubmV3KG1heGltdW0pCiAgICByZXR1cm4ge3ggPSBtYXhpbXVtX3ZlYy55IC0gbWluaW11bV92ZWMueSwgeSA9IG1heGltdW1fdmVjLnggLSBtaW5pbXVtX3ZlYy54LCB6ID0gbWF4aW11bV92ZWMueiAtIG1pbmltdW1fdmVjLnp9CmVuZApmdW5jdGlvbiBzZXRfYXR0YWNobWVudF9vZmZzZXRfZm9yX3Jvb3QoYXR0YWNobWVudCkKICAgIGxvY2FsIHJvb3RfbW9kZWwgPSB1dGlsLnJldmVyc2Vfam9hYXQoRU5USVRZLkdFVF9FTlRJVFlfTU9ERUwoYXR0YWNobWVudC5yb290KSkKICAgIGxvY2FsIGRpbWVuc2lvbnMgPSBnZXRfdmVoaWNsZV9kaW1lbnNpb24oYXR0YWNobWVudC5oYW5kbGUpCiAgICBpZiByb290X21vZGVsID09ICJ3YXN0ZWxhbmRlciIgdGhlbgogICAgICAgIGF0dGFjaG1lbnQub2Zmc2V0ID0gewogICAgICAgICAgICB4PTAsCiAgICAgICAgICAgIHk9KGRpbWVuc2lvbnMueSAvIDIpIC0gMiwKICAgICAgICAgICAgej0oZGltZW5zaW9ucy56IC8gMikgKyAwLjgKICAgICAgICB9CiAgICBlbmQKICAgIGlmIHJvb3RfbW9kZWwgPT0gInNsYW10cnVjayIgdGhlbgogICAgICAgIGF0dGFjaG1lbnQub2Zmc2V0ID0gewogICAgICAgICAgICB4PTAsCiAgICAgICAgICAgIHk9KGRpbWVuc2lvbnMueSAvIDIpIC0gMywKICAgICAgICAgICAgej0oZGltZW5zaW9ucy56IC8gMikgKyAwLjMKICAgICAgICB9CiAgICAgICAgYXR0YWNobWVudC5yb3RhdGlvbiA9IHsKICAgICAgICAgICAgeD04LAogICAgICAgICAgICB5PTAsCiAgICAgICAgICAgIHo9MCwKICAgICAgICB9CiAgICBlbmQKZW5kCmZ1bmN0aW9uIGF0dGFjaChhdHRhY2htZW50KQogICAgYXR0YWNobWVudC5wb3NpdGlvbiA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhhdHRhY2htZW50LnJvb3QpCiAgICBFTlRJVFkuU0VUX0VOVElUWV9IQVNfR1JBVklUWShhdHRhY2htZW50LmhhbmRsZSwgZmFsc2UpCiAgICBzZXRfYXR0YWNobWVudF9vZmZzZXRfZm9yX3Jvb3QoYXR0YWNobWVudCkKICAgIHVwZGF0ZV9hdHRhY2htZW50X3Bvc2l0aW9uKGF0dGFjaG1lbnQpCiAgICBFTlRJVFkuU0VUX0VOVElUWV9OT19DT0xMSVNJT05fRU5USVRZKGF0dGFjaG1lbnQucm9vdCwgYXR0YWNobWVudC5oYW5kbGUpCiAgICByZXR1cm4gYXR0YWNobWVudAplbmQKc3RhdGVjYXIgPSB7fQpmdW5jdGlvbiBkZXRhY2hfYXR0YWNoZWRfdmVoaWNsZSgpCiAgICBpZiBzdGF0ZWNhci5hdHRhY2hlZF92ZWhpY2xlIH49IG5pbCB0aGVuCiAgICAgICAgdXRpbC50b2FzdCgi5bey5YiG56a7ICIuLnN0YXRlY2FyLmF0dGFjaGVkX3ZlaGljbGUubmFtZSkKICAgICAgICBFTlRJVFkuREVUQUNIX0VOVElUWShzdGF0ZWNhci5hdHRhY2hlZF92ZWhpY2xlLmhhbmRsZSwgdHJ1ZSwgdHJ1ZSkKICAgICAgICBzdGF0ZWNhci5hdHRhY2hlZF92ZWhpY2xlID0gbmlsCiAgICBlbmQKZW5kCmZ1bmN0aW9uIGF0dGFjaF9uZWFyZXN0X3ZlaGljbGUoKQogICAgbG9jYWwgcGxheWVyX3ZlaGljbGUgPSBlbnRpdGllcy5nZXRfdXNlcl92ZWhpY2xlX2FzX2hhbmRsZSgpCiAgICBpZiBub3QgcGxheWVyX3ZlaGljbGUgdGhlbgogICAgICAgIHV0aWwudG9hc3QoIuaCqOW/hemhu+WcqOi9pui+huS4reaJjeiDvemZhOWKoCIpCiAgICAgICAgcmV0dXJuCiAgICBlbmQKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhwbGF5ZXJfdmVoaWNsZSwgMSkKICAgIGxvY2FsIHJhbmdlID0gMjAKICAgIGxvY2FsIG5lYXJieV92ZWhpY2xlcyA9IGVudGl0aWVzLmdldF9hbGxfdmVoaWNsZXNfYXNfaGFuZGxlcygpCiAgICBsb2NhbCBjb3VudCA9IDAKICAgIGZvciBfLCB2ZWhpY2xlX2hhbmRsZSBpbiBpcGFpcnMobmVhcmJ5X3ZlaGljbGVzKSBkbwogICAgICAgIGlmIHZlaGljbGVfaGFuZGxlIH49IHBsYXllcl92ZWhpY2xlIHRoZW4KICAgICAgICAgICAgbG9jYWwgYXR0YWNobWVudCA9IHtoYW5kbGU9dmVoaWNsZV9oYW5kbGUsIHJvb3Q9cGxheWVyX3ZlaGljbGV9CiAgICAgICAgICAgIGF0dGFjaG1lbnQucG9zaXRpb24gPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoYXR0YWNobWVudC5oYW5kbGUsIDEpCiAgICAgICAgICAgIGF0dGFjaG1lbnQuZGlzdGFuY2UgPSBTWVNURU0uVkRJU1QocG9zLngsIHBvcy55LCBwb3MueiwgYXR0YWNobWVudC5wb3NpdGlvbi54LCBhdHRhY2htZW50LnBvc2l0aW9uLnksIGF0dGFjaG1lbnQucG9zaXRpb24ueikKICAgICAgICAgICAgaWYgYXR0YWNobWVudC5kaXN0YW5jZSA8PSByYW5nZSB0aGVuCiAgICAgICAgICAgICAgICBkZXRhY2hfYXR0YWNoZWRfdmVoaWNsZSgpCiAgICAgICAgICAgICAgICBhdHRhY2htZW50Lm5hbWUgPSBWRUhJQ0xFLkdFVF9ESVNQTEFZX05BTUVfRlJPTV9WRUhJQ0xFX01PREVMKEVOVElUWS5HRVRfRU5USVRZX01PREVMKGF0dGFjaG1lbnQuaGFuZGxlKSkKICAgICAgICAgICAgICAgIHV0aWwudG9hc3QoIuW3sumZhOWKoCAiLi5hdHRhY2htZW50Lm5hbWUpCiAgICAgICAgICAgICAgICBhdHRhY2goYXR0YWNobWVudCkKICAgICAgICAgICAgICAgIHN0YXRlY2FyLmF0dGFjaGVkX3ZlaGljbGUgPSBhdHRhY2htZW50CiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgoKLS3ng5/pm77mjonluKcKZnVuY3Rpb24gZnVtZXMocGlkKQogICAgCiAgICBsb2NhbCBmcmVlemVfdG9nZ2xlID0gbWVudS5yZWZfYnlfcmVsX3BhdGgobWVudS5wbGF5ZXJfcm9vdChwaWQpLCAiVHJvbGxpbmc+RnJlZXplIikKICAgIGxvY2FsIHBsYXllcl9wb3MgPSBwbGF5ZXJzLmdldF9wb3NpdGlvbihwaWQpCiAgICBtZW51LnNldF92YWx1ZShmcmVlemVfdG9nZ2xlLCB0cnVlKQogICAgcmVxdWVzdF9wdGZ4X2Fzc2V0KCJjb3JlIikKICAgIEdSQVBISUNTLlVTRV9QQVJUSUNMRV9GWF9BU1NFVCgiY29yZSIpCiAgICBHUkFQSElDUy5TVEFSVF9ORVRXT1JLRURfUEFSVElDTEVfRlhfTk9OX0xPT1BFRF9BVF9DT09SRCgiZXhwX2V4dGluZ3Vpc2hlciIsIHBsYXllcl9wb3MueCwgcGxheWVyX3Bvcy55LCBwbGF5ZXJfcG9zLnosIDAsIDAsIDAsIDIuNSwgZmFsc2UsIGZhbHNlLCBmYWxzZSkKICAgIG1lbnUuc2V0X3ZhbHVlKGZyZWV6ZV90b2dnbGUsIGZhbHNlKQplbmQKCgotLS0t5oyJ6ZSu5pi+56S6CmZ1bmN0aW9uIG5ld0NvbG9yKFIsIEcsIEIsIEEpCiAgICByZXR1cm4ge3IgPSBSLCBnID0gRywgYiA9IEIsIGEgPSBBfQplbmQKc2l6ZSA9IDAuMDMKYm94TWFyZ2luID0gc2l6ZSAvIDcKb3ZlcmxheV94ID0gMC4wNDAwCm92ZXJsYXlfeSA9IDAuMTg1MApsb2NhbCBwdXNoX3gsIHB1c2hfeSA9IGRpcmVjdHguZ2V0X2NsaWVudF9zaXplKCkKbG9jYWwgcmF0aW8gPSBwdXNoX3ggLyBwdXNoX3kKbG9jYWwgc3BhY2VCYXJMZW5ndGggPSAzCmxvY2FsIHNwYWNlQmFyU2xpbSA9IDEKbG9jYWwgYWx0U3BhY2VCYXIgPSAwCmxvY2FsIGtleV90ZXh0X2NvbG9yID0gbmV3Q29sb3IoMSwgMSwgMSwgMSkKbG9jYWwgYmFja2dyb3VuZF9jb2xvdXIgPSBuZXdDb2xvcigwLCAwLCAwLCAwLjIpCmxvY2FsIHByZXNzZWRfYmFja2dyb3VuZF9jb2xvdXIgPSBuZXdDb2xvcigyLjU1LzI1NSwgMi41NS8yNTUsIDIuNTUvMjU1LCAwLjU0OTAxOTYwNzg0MzEzNzMpCmxvY2FsIHdhc2QgPSB7CiAgICBbMV0gID0geyBrZXlzID0gezQ0LCA1MiwgODUsIDEzOCwgMTQxLCAxNTIsIDIwNSwgMjY0fSwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZXNzZWQgPSBmYWxzZSwga2V5ID0gJ1EnLCAgICAgc2hvdyA9IHRydWUgfSwKICAgIFsyXSAgPSB7IGtleXMgPSB7MzIsIDcxLCA3NywgODcsIDEyOSwgMTM2LCAxNTAsIDIzMn0sICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJlc3NlZCA9IGZhbHNlLCBrZXkgPSAnVycsICAgICBzaG93ID0gdHJ1ZSB9LAogICAgWzNdICA9IHsga2V5cyA9IHszOCwgNDYsIDUxLCA1NCwgODYsIDEwMywgMTE5LCAxNTMsIDE4NCwgMjA2LCAzNTAsIDM1MSwgMzU1LCAzNTZ9LCAgICAgICAgICAgICAgICAgICBwcmVzc2VkID0gZmFsc2UsIGtleSA9ICdFJywgICAgIHNob3cgPSB0cnVlIH0sCiAgICBbNF0gID0geyBrZXlzID0gezQ1LCA4MCwgMTQwLCAyNTAsIDI2MywgMzEwfSwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZXNzZWQgPSBmYWxzZSwga2V5ID0gJ1InLCAgICAgc2hvdyA9IHRydWUgfSwKICAgIFs1XSAgPSB7IGtleXMgPSB7MzQgLDYzLCA4OSwgMTMzLCAxNDcsIDIzNCwgMzM4fSwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJlc3NlZCA9IGZhbHNlLCBrZXkgPSAnQScsICAgICBzaG93ID0gdHJ1ZSB9LAogICAgWzZdICA9IHsga2V5cyA9IHs4LCAzMSwgMzMsIDcyLCA3OCwgODgsIDEzMCwgMTM5LCAxNDksIDE1MSwgMTk2LCAyMTksIDIzMywgMjY4LCAyNjksIDMwMn0sICAgICAgICAgICBwcmVzc2VkID0gZmFsc2UsIGtleSA9ICdTJywgICAgIHNob3cgPSB0cnVlIH0sCiAgICBbN10gID0geyBrZXlzID0gezksIDMwLCAzNSwgNTksIDY0LCA5MCwgMTM0LCAxNDYsIDE0OCwgMTk1LCAyMTgsIDIzNSwgMjY2LCAyNjcsIDI3OCwgMjc5LCAzMzksIDM0Mn0sIHByZXNzZWQgPSBmYWxzZSwga2V5ID0gJ0QnLCAgICAgc2hvdyA9IHRydWUgfSwKICAgIFs4XSAgPSB7IGtleXMgPSB7MjMsIDQ5LCA3NSwgMTQ1LCAxODUsIDI1MX0sICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJlc3NlZCA9IGZhbHNlLCBrZXkgPSAnRicsICAgICBzaG93ID0gdHJ1ZSB9LAogICAgWzldICA9IHsga2V5cyA9IHsyMSwgNjEsIDEzMSwgMTU1LCAyMDksIDI1NCwgMzQwLCAzNTJ9LCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVzc2VkID0gZmFsc2UsIGtleSA9ICdTaGlmdCcsIHNob3cgPSB0cnVlIH0sCiAgICBbMTBdID0geyBrZXlzID0gezM2LCA2MCwgNjIsIDEzMiwgMjI0LCAyODAsIDI4MSwgMzI2LCAzNDEsIDM0M30sICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZXNzZWQgPSBmYWxzZSwga2V5ID0gJ0N0cmwnLCAgc2hvdyA9IHRydWUgfSwKICAgIFsxMV0gPSB7IGtleXMgPSB7MTgsIDIyLCA1NSwgNzYsIDEwMiwgMTQzLCAxNzksIDIwMywgMjE2LCAyNTUsIDI5OCwgMzIxLCAzMjgsIDM1M30sICAgICAgICAgICAgICAgICAgcHJlc3NlZCA9IGZhbHNlLCBrZXkgPSAnU3BhY2UnLCBzaG93ID0gdHJ1ZSB9LAp9CmZ1bmN0aW9uIGtleV9kaXNwbGF5KCkKICAgIGZvciBpID0gMSwgI3dhc2QgZG8KICAgICAgICB3YXNkW2ldLnByZXNzZWQgPSBmYWxzZQogICAgICAgIGZvciBqID0gMSwgI3dhc2RbaV0ua2V5cyBkbwogICAgICAgICAgICBpZiBQQUQuSVNfQ09OVFJPTF9QUkVTU0VEKDIsIHdhc2RbaV0ua2V5c1tqXSkgdGhlbgogICAgICAgICAgICAgICAgd2FzZFtpXS5wcmVzc2VkID0gdHJ1ZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogICAgZm9yIGkgPSAxLCAjd2FzZCAtIDMgZG8KICAgICAgICBpZiB3YXNkW2ldLnNob3cgdGhlbgogICAgICAgICAgICBkaXJlY3R4LmRyYXdfcmVjdChvdmVybGF5X3ggKyAoYm94TWFyZ2luICsgc2l6ZSkgKiAoaSA+IDQgYW5kIGkgLSA1IG9yIGkgLSAxKSwgb3ZlcmxheV95ICsgKGkgPiA0IGFuZCAoYm94TWFyZ2luICsgc2l6ZSAqIHJhdGlvKSBvciAwKSogMS4wNSwgc2l6ZSwgc2l6ZSAqIHJhdGlvLCB3YXNkW2ldLnByZXNzZWQgYW5kIHByZXNzZWRfYmFja2dyb3VuZF9jb2xvdXIgb3IgYmFja2dyb3VuZF9jb2xvdXIpCiAgICAgICAgICAgIGlmIG5vdCBoaWRlS2V5IHRoZW4KICAgICAgICAgICAgICAgIGRpcmVjdHguZHJhd190ZXh0KG92ZXJsYXlfeCArIChib3hNYXJnaW4gKyBzaXplKSAqIChpID4gNCBhbmQgaSAtIDUgb3IgaSAtIDEpKyBzaXplICogMC40NSwoaSA+IDQgYW5kICBvdmVybGF5X3kgKyAoYm94TWFyZ2luICsgc2l6ZSAqIHJhdGlvKSogMS4yIG9yICBvdmVybGF5X3kqMS4wNykgLCB3YXNkW2ldLmtleSwgMSwgc2l6ZSAqMjAsIGtleV90ZXh0X2NvbG9yLCBmYWxzZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIGlmIGFsdFNoaWZ0Q3RybCB0aGVuCiAgICAgICAgaWYgd2FzZFsjd2FzZCAtIDJdLnNob3cgdGhlbgogICAgICAgICAgICBkaXJlY3R4LmRyYXdfcmVjdChvdmVybGF5X3gsIG92ZXJsYXlfeSArIChib3hNYXJnaW4gKyBzaXplKSogcmF0aW8gKiAyLChib3hNYXJnaW4gKyBzaXplKSAtIGJveE1hcmdpbiwgc2l6ZSAqIHJhdGlvIC8gMiwgd2FzZFsjd2FzZCAtIDJdLnByZXNzZWQgYW5kIHByZXNzZWRfYmFja2dyb3VuZF9jb2xvdXIgb3IgYmFja2dyb3VuZF9jb2xvdXIpCiAgICAgICAgZW5kCiAgICAgICAgaWYgd2FzZFsjd2FzZCAtIDFdLnNob3cgdGhlbgogICAgICAgICAgICBkaXJlY3R4LmRyYXdfcmVjdChvdmVybGF5X3gsIG92ZXJsYXlfeSArIChib3hNYXJnaW4gKyBzaXplKSogcmF0aW8gKiAyLjUsKGJveE1hcmdpbiArIHNpemUpIC0gYm94TWFyZ2luLCBzaXplICogcmF0aW8gLyAyLCB3YXNkWyN3YXNkIC0gMV0ucHJlc3NlZCBhbmQgcHJlc3NlZF9iYWNrZ3JvdW5kX2NvbG91ciBvciBiYWNrZ3JvdW5kX2NvbG91cikKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICBmb3IgaSA9IDksIDEwIGRvCiAgICAgICAgICAgIGlmIHdhc2RbaV0uc2hvdyB0aGVuCiAgICAgICAgICAgIGRpcmVjdHguZHJhd19yZWN0KG92ZXJsYXlfeCAtIChib3hNYXJnaW4gKyBzaXplKSwgb3ZlcmxheV95ICsgKGJveE1hcmdpbiArIHNpemUgKiByYXRpbykgKiAoaSAtIDgpICogMS4wNSwgc2l6ZSwgc2l6ZSAqIHJhdGlvLCB3YXNkW2ldLnByZXNzZWQgYW5kIHByZXNzZWRfYmFja2dyb3VuZF9jb2xvdXIgb3IgYmFja2dyb3VuZF9jb2xvdXIpCiAgICAgICAgICAgIGlmIG5vdCBoaWRlS2V5IHRoZW4KICAgICAgICAgICAgICAgIGRpcmVjdHguZHJhd190ZXh0KG92ZXJsYXlfeCAtIChib3hNYXJnaW4gKyBzaXplKSsgc2l6ZSAqIDAuNDUsKGkgPiA0IGFuZCAgb3ZlcmxheV95ICsgKGJveE1hcmdpbiArIHNpemUgKiByYXRpbykgKiAoaSAtIDgpKiAxLjIgb3IgIG92ZXJsYXlfeSoxLjA3KSAsIHdhc2RbaV0ua2V5LCAxLCBzaXplICoyMCwga2V5X3RleHRfY29sb3IsIGZhbHNlKQoKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCiAgICBpZiB3YXNkWyN3YXNkXS5zaG93IHRoZW4KICAgICAgICBkaXJlY3R4LmRyYXdfcmVjdChvdmVybGF5X3ggKyAoYm94TWFyZ2luICsgc2l6ZSkgKiBhbHRTcGFjZUJhciwgb3ZlcmxheV95ICsgKGJveE1hcmdpbiArIHNpemUpKiByYXRpbyAqIDIsKGJveE1hcmdpbiArIHNpemUpICogc3BhY2VCYXJMZW5ndGggLSBib3hNYXJnaW4sIHNpemUgKiByYXRpbyAvIHNwYWNlQmFyU2xpbSwgd2FzZFsjd2FzZF0ucHJlc3NlZCBhbmQgcHJlc3NlZF9iYWNrZ3JvdW5kX2NvbG91ciBvciBiYWNrZ3JvdW5kX2NvbG91cikKICAgIGVuZAplbmQKCgotLS0tLee7mOWItuihgOmHj+adoQpmdW5jdGlvbiBuZHJhd19yZWN0KHgsIHksIHdpZHRoLCBoZWlnaHQsIGNvbG91cmQpCglHUkFQSElDUy5EUkFXX1JFQ1QoeCwgeSwgd2lkdGgsIGhlaWdodCwgY29sb3VyZC5yLCBjb2xvdXJkLmcsIGNvbG91cmQuYiwgY29sb3VyZC5hLCBmYWxzZSkKZW5kCmZ1bmN0aW9uIGRyYXdfaGVhbHRoX2JhcihwZWQsIG1heERpc3RhbmNlKQoJbG9jYWwgbXlQb3MgPSBwbGF5ZXJzLmdldF9wb3NpdGlvbihQTEFZRVIuUExBWUVSX0lEKCkpCglsb2NhbCBwZWRQb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMocGVkLCB0cnVlKQoJbG9jYWwgZGlzdGFuY2UgPSBteVBvczpkaXN0YW5jZShwZWRQb3MpCglpZiBkaXN0YW5jZSA+PSBtYXhEaXN0YW5jZSB0aGVuIHJldHVybiBlbmQKCWxvY2FsIGRpc3RQZXJjID0gMS4wIC0gZGlzdGFuY2UgLyBtYXhEaXN0YW5jZQoJbG9jYWwgaGVhbHRoUGVyYyA9IDAuMAoJbG9jYWwgYXJtb3VyUGVyYyA9IDAuMAoJaWYgbm90IFBFRC5JU19QRURfRkFUQUxMWV9JTkpVUkVEKHBlZCkgdGhlbgoJCWxvY2FsIGFybW91ciA9IFBFRC5HRVRfUEVEX0FSTU9VUihwZWQpCgkJYXJtb3VyUGVyYyA9IGFybW91ciAvIDEwMC4wCgkJaWYgYXJtb3VyUGVyYyA+IDEuMCB0aGVuIGFybW91clBlcmMgPSAxLjAgZW5kCgkJbG9jYWwgaGVhbHRoID0gRU5USVRZLkdFVF9FTlRJVFlfSEVBTFRIKHBlZCkgLSAxMDAuMAoJCWxvY2FsIG1heEhlYWx0aCA9IFBFRC5HRVRfUEVEX01BWF9IRUFMVEgocGVkKSAtIDEwMC4wCgkJaGVhbHRoUGVyYyA9IGhlYWx0aCAvIG1heEhlYWx0aAoJCWlmIGhlYWx0aFBlcmMgPiAxLjAgdGhlbiBoZWFsdGhQZXJjID0gMS4wIGVuZAoJZW5kCglsb2NhbCBtYXhMZW5ndGggPSAwLjA1ICogZGlzdFBlcmMgXjMKCWxvY2FsIGhlaWdodCA9IDAuMDA4ICogZGlzdFBlcmMgXjEuNQoJbG9jYWwgcG9zID0gUEVELkdFVF9QRURfQk9ORV9DT09SRFMocGVkLCAweDMyMkMgLS1bW2hlYWRdXSwgMC4zNSwgMC4wLCAwLjApCglsb2NhbCBwU2NyZWVuWCwgcFNjcmVlblkgPSBtZW1vcnkuYWxsb2MoNCksIG1lbW9yeS5hbGxvYyg0KQoJaWYgbm90IEdSQVBISUNTLkdFVF9TQ1JFRU5fQ09PUkRfRlJPTV9XT1JMRF9DT09SRChwb3MueCwgcG9zLnksIHBvcy56LCBwU2NyZWVuWCwgcFNjcmVlblkpIHRoZW4KCQlyZXR1cm4KCWVuZAoJbG9jYWwgc2NyZWVuWCA9IG1lbW9yeS5yZWFkX2Zsb2F0KHBTY3JlZW5YKQoJbG9jYWwgc2NyZWVuWSA9IG1lbW9yeS5yZWFkX2Zsb2F0KHBTY3JlZW5ZKQoJbG9jYWwgYmFyTGVuZ3RoID0gaW50ZXJwb2xhdGUoMC4wLCBtYXhMZW5ndGgsIGhlYWx0aFBlcmMpCglsb2NhbCBjb2xvdXIgPSBnZXRfYmxlbmRlZF9jb2xvdXIoaGVhbHRoUGVyYykKCW5kcmF3X3JlY3Qoc2NyZWVuWCwgc2NyZWVuWSwgbWF4TGVuZ3RoICsgMC4wMDIsIGhlaWdodCArIDAuMDAyLCB7ciA9IDAsIGcgPSAwLCBiID0gMCwgYSA9IDEyMH0pCgluZHJhd19yZWN0KHNjcmVlblggLSBtYXhMZW5ndGgvMiArIGJhckxlbmd0aC8yLCBzY3JlZW5ZLCBiYXJMZW5ndGgsIGhlaWdodCwgY29sb3VyKQoJYmFyTGVuZ3RoID0gaW50ZXJwb2xhdGUoMC4wLCBtYXhMZW5ndGgsIGFybW91clBlcmMpCgljb2xvdXIgPSBnZXRfaHVkX2NvbG91cihIdWRDb2xvdXIucmFkYXJBcm1vdXIpCgluZHJhd19yZWN0KHNjcmVlblgsIHNjcmVlblkgKyAxLjUgKiBoZWlnaHQsIG1heExlbmd0aCArIDAuMDAyLCBoZWlnaHQgKyAwLjAwMiwge3IgPSAwLCBnID0gMCwgYiA9IDAsIGEgPSAxMjB9KQoJbmRyYXdfcmVjdChzY3JlZW5YIC0gbWF4TGVuZ3RoLzIgKyBiYXJMZW5ndGgvMiwgc2NyZWVuWSArIDEuNSAqIGhlaWdodCwgYmFyTGVuZ3RoLCBoZWlnaHQsIGNvbG91cikKZW5kCgoKLS0tLS0tLS0tLUdQU+WvvOiIqi8vLy8vbGliCmJfY29tbW9uX2Z1bmNzID0ge30KYl9jb21tb25fZnVuY3MubmV3ID0gZnVuY3Rpb24gKCkKICAgIGxvY2FsIHNlbGYgPSB7fQogICAgc2VsZi5hZGRyZXNzX2Zyb21fcG9pbnRlcl9jaGFpbiA9IGZ1bmN0aW9uIChiYXNlUHRyLCBvZmZzZXRzKQogICAgICAgIGxvY2FsIGFkZHIgPSBtZW1vcnkucmVhZF9sb25nKGJhc2VQdHIpCiAgICAgICAgZm9yIGsgPSAxLCAoI29mZnNldHMgLSAxKSBkbwogICAgICAgICAgICBhZGRyID0gbWVtb3J5LnJlYWRfbG9uZyhhZGRyICsgb2Zmc2V0c1trXSkKICAgICAgICAgICAgaWYgYWRkciA9PSAwIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIGFkZHIgPSBhZGRyICsgb2Zmc2V0c1sjb2Zmc2V0c10KICAgICAgICByZXR1cm4gYWRkcgogICAgZW5kCiAgICBzZWxmLmdldF9wbGF5ZXJfdmVoaWNsZV9jbGFzcyA9IGZ1bmN0aW9uICgpCiAgICAgICAgbG9jYWwgdmVoID0gZW50aXRpZXMuZ2V0X3VzZXJfdmVoaWNsZV9hc19oYW5kbGUoKQogICAgICAgIHJldHVybiBWRUhJQ0xFLkdFVF9WRUhJQ0xFX0NMQVNTKHZlaCkKICAgIGVuZAogICAgc2VsZi5nZXRfYXNjcGVjdF9yYXRpbyA9IGZ1bmN0aW9uKCkKICAgICAgICBsb2NhbCBzY3JlZW5feCwgc2NyZWVuX3kgPSBkaXJlY3R4LmdldF9jbGllbnRfc2l6ZSgpCiAgICAKICAgICAgICByZXR1cm4gc2NyZWVuX3ggLyBzY3JlZW5feQogICAgZW5kCiAgICBzZWxmLnRvX2JpdHMgPSBmdW5jdGlvbihudW0pCiAgICAgICAgbG9jYWwgdD17fQogICAgICAgIHdoaWxlIG51bT4wIGRvCiAgICAgICAgICAgIHJlc3Q9bWF0aC5mbW9kKG51bSwyKQogICAgICAgICAgICB0WyN0KzFdPXJlc3QKICAgICAgICAgICAgbnVtPShudW0tcmVzdCkvMgogICAgICAgIGVuZAogICAgICAgIHJldHVybiB0CiAgICBlbmQKICAgIHNlbGYuc3BsaXQgPSBmdW5jdGlvbiAoaW5wdXQsIHNlcCkKICAgICAgICBsb2NhbCB0PXt9CiAgICAgICAgZm9yIHN0ciBpbiBzdHJpbmcuZ21hdGNoKGlucHV0LCAiKFteIi4uc2VwLi4iXSspIikgZG8KICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydCh0LCBzdHIpCiAgICAgICAgZW5kCiAgICAgICAgcmV0dXJuIHQKICAgIGVuZAogICAgbG9jYWwgbWluaW11bSA9IG1lbW9yeS5hbGxvYygpCiAgICBsb2NhbCBtYXhpbXVtID0gbWVtb3J5LmFsbG9jKCkKICAgIHNlbGYuZ2V0X3Bvc19hYm92ZV9lbnRpdHkgPSBmdW5jdGlvbiAoZW50aXR5KQogICAgICAgIE1JU0MuR0VUX01PREVMX0RJTUVOU0lPTlMoRU5USVRZLkdFVF9FTlRJVFlfTU9ERUwoZW50aXR5KSwgbWluaW11bSwgbWF4aW11bSkKICAgICAgICBsb2NhbCBtYXhpbXVtX3ZlYyA9IG1lbW9yeS5yZWFkX3ZlY3RvcjMobWF4aW11bSkKICAgICAgICByZXR1cm4gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKGVudGl0eSwgMCwgMCwgbWF4aW11bV92ZWMueikKICAgIGVuZAogICAgc2VsZi5jb3B5X0ZpbGUgPSBmdW5jdGlvbihvbGRfcGF0aCwgbmV3X3BhdGgpCiAgICAgICAgbG9jYWwgb2xkX2ZpbGUgPSBpby5vcGVuKG9sZF9wYXRoLCAicmIiKQogICAgICAgIGxvY2FsIG5ld19maWxlID0gaW8ub3BlbihuZXdfcGF0aCwgIndiIikKICAgICAgICBsb2NhbCBvbGRfZmlsZV9zeiwgbmV3X2ZpbGVfc3ogPSAwLCAwCiAgICAgICAgaWYgbm90IG9sZF9maWxlIG9yIG5vdCBuZXdfZmlsZSB0aGVuCiAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICBlbmQKICAgICAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgICBsb2NhbCBibG9jayA9IG9sZF9maWxlOnJlYWQoMl4xMykKICAgICAgICAgIGlmIG5vdCBibG9jayB0aGVuIAogICAgICAgICAgICBvbGRfZmlsZV9zeiA9IG9sZF9maWxlOnNlZWsoICJlbmQiICkKICAgICAgICAgICAgYnJlYWsKICAgICAgICAgIGVuZAogICAgICAgICAgbmV3X2ZpbGU6d3JpdGUoYmxvY2spCiAgICAgICAgZW5kCiAgICAgICAgb2xkX2ZpbGU6Y2xvc2UoKQogICAgICAgIG5ld19maWxlX3N6ID0gbmV3X2ZpbGU6c2VlayggImVuZCIgKQogICAgICAgIG5ld19maWxlOmNsb3NlKCkKICAgICAgICByZXR1cm4gbmV3X2ZpbGVfc3ogPT0gb2xkX2ZpbGVfc3oKICAgICAgZW5kCiAgICByZXR1cm4gc2VsZgplbmQKYl9tYXRoX2Z1bmNzID0ge30KYl9tYXRoX2Z1bmNzLm5ldyA9IGZ1bmN0aW9uICgpCiAgICBsb2NhbCBzZWxmID0ge30KICAgIHNlbGYubGVycCA9IGZ1bmN0aW9uKGEsIGIsIHQpCiAgICAgICAgcmV0dXJuIGEgKyAoYiAtIGEpICogdAogICAgZW5kCiAgICBsb2NhbCBFUFNJTE9OID0gMC4wMDAwMDAxCiAgICBzZWxmLlJheUludGVyc2VjdHNUcmlhbmdsZSA9IGZ1bmN0aW9uKHJheU9yaWdpbiwgcmF5RGlyZWN0aW9uLCB2ZXJ0ZXgxLCB2ZXJ0ZXgyLCB2ZXJ0ZXgzKQogICAgICAgIGxvY2FsIGVkZ2UxLCBlZGdlMiwgaCwgcywgcSwgYSwgZiwgdSwgdgogICAgICAgIGVkZ2UxID0ge3ggPSB2ZXJ0ZXgyLnggLSB2ZXJ0ZXgxLngsIHkgPSB2ZXJ0ZXgyLnkgLSB2ZXJ0ZXgxLnksIHogPSB2ZXJ0ZXgyLnogLSB2ZXJ0ZXgxLnp9CiAgICAgICAgZWRnZTIgPSB7eCA9IHZlcnRleDMueCAtIHZlcnRleDEueCwgeSA9IHZlcnRleDMueSAtIHZlcnRleDEueSwgeiA9IHZlcnRleDMueiAtIHZlcnRleDEuen0KICAgICAgICBoID0gewogICAgICAgICAgICB4ID0gICAgZWRnZTIueSAqIHJheURpcmVjdGlvbi56IC0gZWRnZTIueiAqIHJheURpcmVjdGlvbi55LAogICAgICAgICAgICB5ID0gICAgZWRnZTIueiAqIHJheURpcmVjdGlvbi54IC0gZWRnZTIueCAqIHJheURpcmVjdGlvbi56LAogICAgICAgICAgICB6ID0gICAgZWRnZTIueCAqIHJheURpcmVjdGlvbi55IC0gZWRnZTIueSAqIHJheURpcmVjdGlvbi54CiAgICAgICAgfQogICAgICAgIGEgPSBoLnggKiBlZGdlMS54ICsgaC55ICogZWRnZTEueSArIGgueiAqIGVkZ2UxLnoKCiAgICAgICAgaWYgYSA+IC1FUFNJTE9OIGFuZCBhIDwgRVBTSUxPTiB0aGVuIHJldHVybiBmYWxzZSBlbmQKCiAgICAgICAgZiA9IDEuMC9hCiAgICAgICAgcyA9IHt4ID0gcmF5T3JpZ2luLnggLSB2ZXJ0ZXgxLngsIHkgPSByYXlPcmlnaW4ueSAtIHZlcnRleDEueSwgeiA9IHJheU9yaWdpbi56IC0gdmVydGV4MS56fQogICAgICAgIHUgPSBmICogKGgueCAqIHMueCArIGgueSAqIHMueSArIGgueiAqIHMueikKICAgICAgICBpZiB1IDwgMC4wIG9yIHUgPiAxLjAgdGhlbiByZXR1cm4gZmFsc2UgZW5kCiAgICAgICAgcSA9IHsKICAgICAgICAgICAgeCA9ICAgIGVkZ2UxLnkgKiBzLnogLSBlZGdlMS56ICogcy55LAogICAgICAgICAgICB5ID0gICAgZWRnZTEueiAqIHMueCAtIGVkZ2UxLnggKiBzLnosCiAgICAgICAgICAgIHogPSAgICBlZGdlMS54ICogcy55IC0gZWRnZTEueSAqIHMueAogICAgICAgIH0KICAgICAgICB2ID0gZiAqIChyYXlEaXJlY3Rpb24ueCAqIHEueCArIHJheURpcmVjdGlvbi55ICogcS55ICsgcmF5RGlyZWN0aW9uLnogKiBxLnopCiAgICAgICAgaWYgdiA8IDAuMCBvciB1ICsgdiA+IDEuMCB0aGVuIHJldHVybiBmYWxzZSBlbmQKICAgICAgICB0ID0gZiAqICAoZWRnZTIueCAqIHEueCArIGVkZ2UyLnkgKiBxLnkgKyBlZGdlMi56ICogcS56KQogICAgICAgIGlmIHQgPiBFUFNJTE9OIHRoZW4KICAgICAgICAgICAgcmV0dXJuIHRydWUsIHsKICAgICAgICAgICAgICAgIHggPSByYXlPcmlnaW4ueCArIHJheURpcmVjdGlvbi54ICogdCwKICAgICAgICAgICAgICAgIHkgPSByYXlPcmlnaW4ueSArIHJheURpcmVjdGlvbi55ICogdCwKICAgICAgICAgICAgICAgIHogPSByYXlPcmlnaW4ueiArIHJheURpcmVjdGlvbi56ICogdAogICAgICAgICAgICB9CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICBlbmQKICAgIGVuZAogICAgcmV0dXJuIHNlbGYKZW5kCmJfdmVjdG9ycyA9IHt9CmJfdmVjdG9ycy5uZXcgPSBmdW5jdGlvbiAoKQogICAgbG9jYWwgc2VsZiA9IHt9CiAgICBzZWxmLnZlY3RvcjIgPSB7fQogICAgc2VsZi52ZWN0b3IyLm5ldyA9IGZ1bmN0aW9uICh4LCB5KQogICAgICAgIHJldHVybiB7eCA9IHgsIHkgPSB5fQogICAgZW5kCiAgICBzZWxmLnZlY3RvcjIuZG90ID0gZnVuY3Rpb24odmVjdG9yX2EsIHZlY3Rvcl9iKQogICAgICAgIHJldHVybiAodmVjdG9yX2EueCAqIHZlY3Rvcl9iLngpICsgKHZlY3Rvcl9hLnkgKiB2ZWN0b3JfYi55KQogICAgZW5kCiAgICBzZWxmLnZlY3RvcjIubWFnbml0dWRlID0gZnVuY3Rpb24odmVjdG9yKQogICAgICAgIHJldHVybiBtYXRoLnNxcnQoKHZlY3Rvci54ICogdmVjdG9yLngpICsgKHZlY3Rvci55ICogdmVjdG9yLnkpKQogICAgZW5kCiAgICBzZWxmLnZlY3RvcjIuZ2V0X2FuZ2xlID0gZnVuY3Rpb24odmVjdG9yX2EsIHZlY3Rvcl9iKQogICAgICAgIHJldHVybiBtYXRoLmFjb3Moc2VsZi52ZWN0b3IyLmRvdCh2ZWN0b3JfYSwgdmVjdG9yX2IpIC8gc2VsZi52ZWN0b3IyLm1hZ25pdHVkZSh2ZWN0b3JfYSkgLyBzZWxmLnZlY3RvcjIubWFnbml0dWRlKHZlY3Rvcl9iKSkKICAgIGVuZAogICAgc2VsZi52ZWN0b3IzID0ge30KICAgIHNlbGYudmVjdG9yMy5uZXcgPSBmdW5jdGlvbiAoeCwgeSwgeikKICAgICAgICByZXR1cm4ge3ggPSB4LCB5ID0geSwgeiA9IHp9CiAgICBlbmQKICAgIHNlbGYudmVjdG9yMy5hZGQgPSBmdW5jdGlvbihhLCBiKQogICAgICAgIHJldHVybiBzZWxmLnZlY3RvcjMubmV3KGEueCArIGIueCwgYS55ICsgYi55LCBhLnogKyBiLnopCiAgICBlbmQKICAgIHNlbGYudmVjdG9yMy5zdWIgPSBmdW5jdGlvbihhLCBiKQogICAgICAgIHJldHVybiBzZWxmLnZlY3RvcjMubmV3KGEueCAtIGIueCwgYS55IC0gYi55LCBhLnogLSBiLnopCiAgICBlbmQKICAgIHNlbGYudmVjdG9yMy5tdWx0aXBseSA9IGZ1bmN0aW9uICh2ZWMsIG51bSkKICAgICAgICByZXR1cm4ge3ggPSB2ZWMueCAqIG51bSwgeSA9IHZlYy55ICogbnVtLCB6ID0gdmVjLnogKiBudW19CiAgICBlbmQKICAgIHJldHVybiBzZWxmCmVuZAoKCmxvY2FsIHBsYXllcl9wZWRfaWQKbG9jYWwgZGVsdGFfdGltZQpsb2NhbCBwbGF5ZXJfcG9zCnV0aWwuY3JlYXRlX3RpY2tfaGFuZGxlcihmdW5jdGlvbiAoKQogICAgcGxheWVyX3BlZF9pZCA9IFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkKICAgIGRlbHRhX3RpbWUgPSBNSVNDLkdFVF9GUkFNRV9USU1FKCkKICAgIHBsYXllcl9wb3MgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMocGxheWVyX3BlZF9pZCkKICAgIHJldHVybiB0cnVlCmVuZCkKbG9jYWwgbWF0aF9mdW5jcyA9IGJfbWF0aF9mdW5jcy5uZXcoKQpsb2NhbCBzaGl0dHlfZ3BzX2NvbG91cl9hID0ge3IgPSAxLGcgPSAwLGIgPSAxLGEgPSAxfQpsb2NhbCBzaGl0dHlfZ3BzX3J1biA9IGZhbHNlCmZ1bmN0aW9uIEdQU19uYXZpZ2F0aW9uKHZhbHVlKQogICAgbG9jYWwgcF9kaXJlY3Rpb24gPSBtZW1vcnkuYWxsb2MoMSkgLS1ib29sCiAgICBsb2NhbCBwXzUgPSBtZW1vcnkuYWxsb2MoNCkgLS1mbG9hdAogICAgbG9jYWwgcF9kaXN0VG9OeEp1bmN0aW9uID0gbWVtb3J5LmFsbG9jKDQpIC0tZmxvYXQKICAgIGxvY2FsIHBfc2NyZWVuWCA9IG1lbW9yeS5hbGxvYyg0KSAtLWZsb2F0CiAgICBsb2NhbCBwX3NjcmVlblkgPSBtZW1vcnkuYWxsb2MoNCkgLS1mbG9hdAogICAgbG9jYWwgdHVybl9kaXIgPSAwCiAgICBzaGl0dHlfZ3BzX3J1biA9IHZhbHVlCiAgICBpZiB2YWx1ZSB0aGVuCiAgICAgICAgdXRpbC5jcmVhdGVfdGlja19oYW5kbGVyKGZ1bmN0aW9uICgpCiAgICAgICAgICAgIGxvY2FsIHZlaGljbGUgPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0lOKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKQogICAgICAgICAgICBsb2NhbCB3YXlwb2ludF9wb3MgPSBnZXRfd2F5cG9pbnRfY29vcmRzKCkKICAgICAgICAgICAgbG9jYWwgdG90YWwgPSB3YXlwb2ludF9wb3MueCArIHdheXBvaW50X3Bvcy55ICsgd2F5cG9pbnRfcG9zLnoKICAgICAgICAgICAgaWYgdG90YWwgfj0gMCBhbmQgRU5USVRZLklTX0VOVElUWV9BX1ZFSElDTEUodmVoaWNsZSkgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgaGVpZ2h0ID0gRU5USVRZLkdFVF9FTlRJVFlfSEVJR0hUKHZlaGljbGUsIHBsYXllcl9wb3MueCwgcGxheWVyX3Bvcy55LCBwbGF5ZXJfcG9zLnosIHRydWUsIGZhbHNlKQogICAgICAgICAgICAgICAgUEFUSEZJTkQuR0VORVJBVEVfRElSRUNUSU9OU19UT19DT09SRCgKICAgICAgICAgICAgICAgICAgICB3YXlwb2ludF9wb3MueCwKICAgICAgICAgICAgICAgICAgICB3YXlwb2ludF9wb3MueSwKICAgICAgICAgICAgICAgICAgICB3YXlwb2ludF9wb3MueiwKICAgICAgICAgICAgICAgICAgICAwLAogICAgICAgICAgICAgICAgICAgIHBfZGlyZWN0aW9uLAogICAgICAgICAgICAgICAgICAgIHBfNSwKICAgICAgICAgICAgICAgICAgICBwX2Rpc3RUb054SnVuY3Rpb24KICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGxvY2FsIGRpcmVjdGlvbiA9IG1lbW9yeS5yZWFkX2J5dGUocF9kaXJlY3Rpb24pCiAgICAgICAgICAgICAgICBsb2NhbCBkaXN0VG9OeEp1bmN0aW9uID0gbWVtb3J5LnJlYWRfZmxvYXQocF9kaXN0VG9OeEp1bmN0aW9uKSAtIDE4CiAgICAgICAgICAgICAgICBHUkFQSElDUy5HRVRfU0NSRUVOX0NPT1JEX0ZST01fV09STERfQ09PUkQoCiAgICAgICAgICAgICAgICAgICAgcGxheWVyX3Bvcy54LAogICAgICAgICAgICAgICAgICAgIHBsYXllcl9wb3MueSwKICAgICAgICAgICAgICAgICAgICBwbGF5ZXJfcG9zLnogKyAxLjUgKyBoZWlnaHQsCiAgICAgICAgICAgICAgICAgICAgcF9zY3JlZW5YLAogICAgICAgICAgICAgICAgICAgIHBfc2NyZWVuWQogICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgbG9jYWwgc2NyZWVuX3ggPSBtZW1vcnkucmVhZF9mbG9hdChwX3NjcmVlblgpCiAgICAgICAgICAgICAgICBsb2NhbCBzY3JlZW5feSA9IG1lbW9yeS5yZWFkX2Zsb2F0KHBfc2NyZWVuWSkKICAgICAgICAgICAgaWYgZGlyZWN0aW9uID09IDEgdGhlbgogICAgICAgICAgICAgICAgICAgIHR1cm5fZGlyID0gbWF0aF9mdW5jcy5sZXJwKHR1cm5fZGlyLCAxODAsIDUgKiBkZWx0YV90aW1lKQogICAgICAgICAgICAgICAgICAgIGRpcmVjdHguZHJhd190ZXh0KHNjcmVlbl94LCBzY3JlZW5feSwgIuivt+WcqOWJjeaWuei3r+WPo+iwg+WktCIsIEFMSUdOX0NFTlRSRSwgMSwgc2hpdHR5X2dwc19jb2xvdXJfYSkKICAgICAgICAgICAgICAgIGVsc2VpZiBkaXJlY3Rpb24gPT0gMyB0aGVuICAgICAgCiAgICAgICAgICAgICAgICAgICAgdHVybl9kaXIgPSAgbWF0aF9mdW5jcy5sZXJwKHR1cm5fZGlyLCAtOTAsIDUgKiBkZWx0YV90aW1lKQogICAgICAgICAgICAgICAgICAgIGlmIG1hdGguZmxvb3IoZGlzdFRvTnhKdW5jdGlvbikgPiAtMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdHguZHJhd190ZXh0KHNjcmVlbl94LHNjcmVlbl95LCLor7flnKjliY3mlrnot6/lj6MiIC4uIG1hdGguZmxvb3IoZGlzdFRvTnhKdW5jdGlvbikgLi4gIiDnsbPlkI7lt6bovawgIixBTElHTl9DRU5UUkUsMSxzaGl0dHlfZ3BzX2NvbG91cl9hKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZWlmIGRpcmVjdGlvbiA9PSA2IHRoZW4KICAgICAgICAgICAgICAgICAgICB0dXJuX2RpciA9ICBtYXRoX2Z1bmNzLmxlcnAodHVybl9kaXIsIC0xNDUsIDUgKiBkZWx0YV90aW1lKQogICAgICAgICAgICAgICAgICAgIGlmIG1hdGguZmxvb3IoZGlzdFRvTnhKdW5jdGlvbikgPiAtMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdHguZHJhd190ZXh0KHNjcmVlbl94LHNjcmVlbl95LCBtYXRoLmZsb29yKGRpc3RUb054SnVuY3Rpb24pIC4uICIg57Gz5ZCO5ZCR5bem5oCl6L2s5byvICIsQUxJR05fQ0VOVFJFLDEsc2hpdHR5X2dwc19jb2xvdXJfYSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVsc2VpZiBkaXJlY3Rpb24gPT0gNCB0aGVuICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHR1cm5fZGlyID0gIG1hdGhfZnVuY3MubGVycCh0dXJuX2RpciwgOTAsIDUgKiBkZWx0YV90aW1lKQogICAgICAgICAgICAgICAgICAgIGlmIG1hdGguZmxvb3IoZGlzdFRvTnhKdW5jdGlvbikgPiAtMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdHguZHJhd190ZXh0KHNjcmVlbl94LHNjcmVlbl95LCLor7flnKjliY3mlrnot6/lj6MgIiAuLiBtYXRoLmZsb29yKGRpc3RUb054SnVuY3Rpb24pIC4uICIg57Gz5ZCO5Y+z6L2sIixBTElHTl9DRU5UUkUsMSxzaGl0dHlfZ3BzX2NvbG91cl9hKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZWlmIGRpcmVjdGlvbiA9PSA3IHRoZW4KICAgICAgICAgICAgICAgICAgICB0dXJuX2RpciA9ICBtYXRoX2Z1bmNzLmxlcnAodHVybl9kaXIsIDE0NSwgNSAqIGRlbHRhX3RpbWUpCiAgICAgICAgICAgICAgICAgICAgaWYgbWF0aC5mbG9vcihkaXN0VG9OeEp1bmN0aW9uKSA+IC0xIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgZGlyZWN0eC5kcmF3X3RleHQoc2NyZWVuX3gsc2NyZWVuX3ksbWF0aC5mbG9vcihkaXN0VG9OeEp1bmN0aW9uKSAuLiAiIOexs+WQjuWQkeWPs+aApei9rOW8ryAiICxBTElHTl9DRU5UUkUsMSxzaGl0dHlfZ3BzX2NvbG91cl9hKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZWlmIGRpcmVjdGlvbiA9PSA4IHRoZW4KICAgICAgICAgICAgICAgICAgICB0dXJuX2RpciA9ICBtYXRoX2Z1bmNzLmxlcnAodHVybl9kaXIsIDAsIDUgKiBkZWx0YV90aW1lKQogICAgICAgICAgICAgICAgICAgIGRpcmVjdHguZHJhd190ZXh0KHNjcmVlbl94LCBzY3JlZW5feSwgIuato+WcqOmHjeaWsOinhOWIkui3r+e6vyAgICAiLCBBTElHTl9DRU5UUkUsIDEsIHNoaXR0eV9ncHNfY29sb3VyX2EpCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgdHVybl9kaXIgPSAgbWF0aF9mdW5jcy5sZXJwKHR1cm5fZGlyLCAwLCA1ICogZGVsdGFfdGltZSkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZGlyZWN0aW9uID0gRU5USVRZLkdFVF9FTlRJVFlfRk9SV0FSRF9WRUNUT1IocGxheWVyX3BlZF9pZCkKICAgICAgICAgICAgICAgIGxvY2FsIGFuZ2xlID0gYl92ZWN0b3JzLm5ldygpLnZlY3RvcjIuZ2V0X2FuZ2xlKGRpcmVjdGlvbiwge3ggPSAwLCB5ID0gMX0pCiAgICAgICAgICAgICAgICBpZiBiX3ZlY3RvcnMubmV3KCkudmVjdG9yMi5kb3Qoe3ggPSBkaXJlY3Rpb24ueCwgeSA9IGRpcmVjdGlvbi55fSwge3ggPSAxLCB5ID0gMH0pID4gMCB0aGVuCiAgICAgICAgICAgICAgICAgICAgYW5nbGUgPSAtYW5nbGUKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgbG9jYWwgZHJhd19wb3MgPSBiX2NvbW1vbl9mdW5jcy5uZXcoKS5nZXRfcG9zX2Fib3ZlX2VudGl0eSh2ZWhpY2xlKQogICAgICAgICAgICAgICAgZHJhd19wb3MueiA9IGRyYXdfcG9zLnogKyAwLjQKICAgICAgICAgICAgICAgIGRyYXdpbmdfZnVuY3MuZHJhd19hcnJvdyhkcmF3X3BvcywgYW5nbGUgLSBtYXRoLnJhZCh0dXJuX2RpciksIDEsIHtyID0gMjU1LGcgPSAwLGIgPSAyNTUsYSA9IDI1NX0sIHtyID0gMjU1LGcgPSAyNTUsYiA9IDI1NSxhID0gMjU1fSkKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHJldHVybiBzaGl0dHlfZ3BzX3J1bgogICAgICAgIGVuZCkKICAgIGVuZAplbmQKCgotLS0t5YWo5bGA5bm954G1CmZ1bmN0aW9uIGdpdmVfYWxsX2dob3N0KHRvZ2dsZWQpCiAgICBhbGxQZ2hvc3QgPSB0b2dnbGVkCiAgICB3aGlsZSBhbGxQZ2hvc3QgZG8KICAgICAgICBmb3IgcGlkID0gMCwgMzEgZG8KICAgICAgICAgICAgTkVUV09SSy5TRVRfUkVNT1RFX1BMQVlFUl9BU19HSE9TVChwaWQsIHRydWUpCiAgICAgICAgZW5kCiAgICAgICAgdXRpbC55aWVsZCgpCiAgICBlbmQKICAgIGZvciBwaWQgPSAwLCAzMSBkbwogICAgICAgIE5FVFdPUksuU0VUX1JFTU9URV9QTEFZRVJfQVNfR0hPU1QocGlkLCBmYWxzZSkKICAgIGVuZAplbmQKCi0tLS3pm6rnkIPlpKfmiJgKZnVuY3Rpb24gc25vd2JhbGxfV2FyKCkKICAgIGxvY2FsIHBsaXN0ID0gcGxheWVycy5saXN0KCkKICAgIGxvY2FsIHNub3diYWxscyA9IHV0aWwuam9hYXQoJ1dFQVBPTl9TTk9XQkFMTCcpCiAgICBmb3IgaSA9IDEsICNwbGlzdCBkbwogICAgICAgIGxvY2FsIHBseXIgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRURfU0NSSVBUX0lOREVYKHBsaXN0W2ldKQogICAgICAgIFdFQVBPTi5HSVZFX0RFTEFZRURfV0VBUE9OX1RPX1BFRChwbHlyLCBzbm93YmFsbHMsIDIwLCB0cnVlKQogICAgICAgIFdFQVBPTi5TRVRfUEVEX0FNTU8ocGx5ciwgc25vd2JhbGxzLCAyMCkKICAgICAgICBwbGF5ZXJzLnNlbmRfc21zKHBsaXN0W2ldLCBQTEFZRVIuUExBWUVSX0lEKCksICfpm6rnkIPlpKfmiJgh5L2g6I635b6X5LqG6Zuq55CDJykKICAgICAgICB1dGlsLnlpZWxkKCkKICAgIGVuZAplbmQKCi0tLS3ng5/oirHlpKfmiJgKZnVuY3Rpb24gRmlyZXdvcmtzX1dhcigpCiAgICBsb2NhbCBwbGlzdCA9IHBsYXllcnMubGlzdCgpCiAgICBsb2NhbCBmaXJld29ya3MgPSB1dGlsLmpvYWF0KCd3ZWFwb25fZmlyZXdvcmsnKQogICAgZm9yIGkgPSAxLCAjcGxpc3QgZG8KICAgICAgICBsb2NhbCBwbHlyID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEX1NDUklQVF9JTkRFWChwbGlzdFtpXSkKICAgICAgICBXRUFQT04uR0lWRV9ERUxBWUVEX1dFQVBPTl9UT19QRUQocGx5ciwgZmlyZXdvcmtzLCAyMCwgdHJ1ZSkKICAgICAgICBXRUFQT04uU0VUX1BFRF9BTU1PKHBseXIsIGZpcmV3b3JrcywgMjApCiAgICAgICAgcGxheWVycy5zZW5kX3NtcyhwbGlzdFtpXSwgUExBWUVSLlBMQVlFUl9JRCgpLCAn54Of6Iqx5aSn5oiYIeS9oOiOt+W+l+S6hueDn+iKsScpCiAgICAgICAgdXRpbC55aWVsZCgpCiAgICBlbmQKZW5kCgotLS0t5Y2H57qn6L295YW3CmZ1bmN0aW9uIHVwZ3JhZGVfdmVoaWNsZSh2ZWhpY2xlKQogICAgVkVISUNMRS5TRVRfVkVISUNMRV9NT0RfS0lUKHZlaGljbGUsIDApCiAgICBmb3IgaSA9IDAsIDUwIGRvCiAgICAgICAgbG9jYWwgbnVtID0gVkVISUNMRS5HRVRfTlVNX1ZFSElDTEVfTU9EUyh2ZWhpY2xlLCBpKQogICAgICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfTU9EKHZlaGljbGUsIGksIG51bSAtIDEsIHRydWUpCiAgICBlbmQKCiAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX1RZUkVTX0NBTl9CVVJTVCh2ZWhpY2xlLCBmYWxzZSkKICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfV0hFRUxTX0NBTl9CUkVBSyh2ZWhpY2xlLCBmYWxzZSkKICAgIFZFSElDTEUuU0VUX1ZFSElDTEVfSEFTX1VOQlJFQUtBQkxFX0xJR0hUUyh2ZWhpY2xlLCB0cnVlKQogICAgVkVISUNMRS5TRVRfVkVISUNMRV9DQU5fRU5HSU5FX01JU1NGSVJFKHZlaGljbGUsIGZhbHNlKQogICAgVkVISUNMRS5TRVRfVkVISUNMRV9DQU5fTEVBS19PSUwodmVoaWNsZSwgZmFsc2UpCiAgICBWRUhJQ0xFLlNFVF9WRUhJQ0xFX0NBTl9MRUFLX1BFVFJPTCh2ZWhpY2xlLCBmYWxzZSkKCiAgICBWRUhJQ0xFLlNFVF9ESVNBQkxFX1ZFSElDTEVfRU5HSU5FX0ZJUkVTKHZlaGljbGUsIHRydWUpCiAgICBWRUhJQ0xFLlNFVF9ESVNBQkxFX1ZFSElDTEVfUEVUUk9MX1RBTktfRklSRVModmVoaWNsZSwgdHJ1ZSkKICAgIFZFSElDTEUuU0VUX0RJU0FCTEVfVkVISUNMRV9QRVRST0xfVEFOS19EQU1BR0UodmVoaWNsZSwgdHJ1ZSkKCiAgICBmb3IgaSA9IDAsIDMgZG8KICAgICAgICBWRUhJQ0xFLlNFVF9ET09SX0FMTE9XRURfVE9fQkVfQlJPS0VOX09GRih2ZWhpY2xlLCBpLCBmYWxzZSkKICAgIGVuZAogICAgVkVISUNMRS5TRVRfSEVMSV9UQUlMX0JPT01fQ0FOX0JSRUFLX09GRih2ZWhpY2xlLCBmYWxzZSkKCmVuZAoKLS0tLee7meS6iOaJgOacieeOqeWutk1LLTIKZnVuY3Rpb24gZ2l2ZV9vcHByZXNzb3IoKQogICAgZm9yIGssIHBpZCBpbiBwYWlycyhwbGF5ZXJzLmxpc3QodHJ1ZSwgdHJ1ZSwgdHJ1ZSkpIGRvCiAgICAgICAgbG9jYWwgcGVkID0gUExBWUVSLkdFVF9QTEFZRVJfUEVEKHBpZCkKICAgICAgICBsb2NhbCBjID0gRU5USVRZLkdFVF9PRkZTRVRfRlJPTV9FTlRJVFlfSU5fV09STERfQ09PUkRTKHBlZCwgMC4wLCA1LjAsIDAuMCkKICAgICAgICBsb2NhbCBoYXNoID0gdXRpbC5qb2FhdCgib3BwcmVzc29yMiIpCiAgICAgICAgcmVxdWVzdF9tb2RlbChoYXNoKQogICAgICAgIGxvY2FsIG9wcHJlc3NvciA9IGVudGl0aWVzLmNyZWF0ZV92ZWhpY2xlKGhhc2gsIGMsIEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcocGVkKSkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKG9wcHJlc3NvcikKICAgICAgICB1cGdyYWRlX3ZlaGljbGUob3BwcmVzc29yKQogICAgZW5kCmVuZAoKCi0tLS0tLemjnuacuuaooeWei+W0qea6gwpsb2NhbCBjcmFzaF9wbGFuZXMgPSB7J21pY3JvbGlnaHQnLCAnY3ViYW44MDAnLCAndHVsYScsICdhbHBoYXoxJywgJ3ZlbHVtMicsICduaW1idXMnLCAnc2VhYnJlZXplJ30KbG9jYWwgcGxhbmVfY3Jhc2hfY29vcmRzID0gewogICAgey0xNzE4LjU4NzgsIC05ODIuMDI0MDUsIDMyMi44MzExNX0sCiAgICB7LTI2NzEuNTAwNywgMzQwNC4yNjM3LCA0NTUuMTk3Mn0sCiAgICB7OS45NzcyNjYsIDY2MjEuNDA2LCAzMDYuNDY1MzYgfSwKICAgIHszNTI5LjE0NTgsIDM3NTQuNTQ1MiwgMTA5Ljk2NDcyfSwKICAgIHsyNTIsIDI4MTUsIDEyMH0sCn0KbG9jYWwgdG9fcGx5ID0gMQpmdW5jdGlvbiBhaXJwbGFuZV9jb2xsYXBzZWQxKCkKICAgIGlmIFBFRC5JU19QRURfSU5fQU5ZX1ZFSElDTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpIHRoZW4KICAgICAgICBsb2NhbCBqZXQgPSBQRUQuR0VUX1ZFSElDTEVfUEVEX0lTX0lOKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGZhbHNlKQogICAgICAgIEVOVElUWS5TRVRfRU5USVRZX1BST09GUyhqZXQsIHRydWUsIHRydWUsIHRydWUsIHRydWUsIHRydWUsIHRydWUsIHRydWUsIHRydWUpCiAgICAgICAgaWYgcGxheWVycy5leGlzdHModG9fcGx5KSB0aGVuIAogICAgICAgICAgICBsb2NhbCBhc2RhID0gRU5USVRZLkdFVF9FTlRJVFlfQ09PUkRTKFBMQVlFUi5HRVRfUExBWUVSX1BFRF9TQ1JJUFRfSU5ERVgodG9fcGx5KSkgCiAgICAgICAgICAgIHV0aWwudG9hc3QoJ1BsYXllciBJRDogJy4udG9fcGx5Li4nIHwgYXNkYS54OiAnLi4gYXNkYS54Li4gJ2FzZGEueTogJy4uIGFzZGEueS4uJ2FzZGEuejogJy4uIGFzZGEueikKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09PUkRTKGpldCwgYXNkYS54LCBhc2RhLnksIGFzZGEueiArIDUwLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCB0cnVlKSAKICAgICAgICAgICAgdG9fcGx5ID0gdG9fcGx5ICsxCiAgICAgICAgZWxzZSAKICAgICAgICAgICAgaWYgdG9fcGx5ID49IDMyIHRoZW4gdG9fcGx5ID0gMCBlbmQKICAgICAgICAgICAgdG9fcGx5ID0gdG9fcGx5ICsxIAogICAgICAgICAgICBsb2NhbCBsZXRfY29vcmRzID0gcGxhbmVfY3Jhc2hfY29vcmRzW21hdGgucmFuZG9tKDEsICNwbGFuZV9jcmFzaF9jb29yZHMpXQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFMoamV0LCBsZXRfY29vcmRzWzFdLCBsZXRfY29vcmRzWzJdLCBsZXRfY29vcmRzWzNdLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCB0cnVlKSAKICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfVkVMT0NJVFkoamV0LCAwLCAwLCAwKSAtLSB2ZWxvY2l0eSBzeW5jIGZ1Y2sKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9ST1RBVElPTihqZXQsIDAsIDAsIDAsIDIsIHRydWUpIC0tIHJvdGF0aW9uIHN5bmMgZnVjawogICAgICAgIGxvY2FsIHBlZHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgIHBlZHBvcy56ID0gcGVkcG9zLnogKyAxMAogICAgICAgIGZvciBpID0gMSwgMiBkbwogICAgICAgICAgICBsb2NhbCBzX3BsYW5lID0gY3Jhc2hfcGxhbmVzW21hdGgucmFuZG9tKDEsICNjcmFzaF9wbGFuZXMpXQogICAgICAgICAgICByZXF1ZXN0X21vZGVsKHV0aWwuam9hYXQoc19wbGFuZSkpCiAgICAgICAgICAgIGxvY2FsIHZlaGExID0gZW50aXRpZXMuY3JlYXRlX3ZlaGljbGUodXRpbC5qb2FhdChzX3BsYW5lKSwgcGVkcG9zLCAwKQoKICAgICAgICAgICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZX1BIWVNJQ0FMTFkodmVoYTEsIGpldCwgMCwgMCwgMCwgMCwgNSArICgyICogaSksIDAsIDAsIDAsIDAsIDAsIDAsIDEwMDAsIHRydWUsIHRydWUsIHRydWUsIHRydWUsIDIpCiAgICAgICAgZW5kCiAgICAgICAgdXRpbC55aWVsZCgxMDApIC0tIDVrIGlzIG9yaWdpbmFsCiAgICAgICAgZm9yIGkgPSAxLCAyNSBkbyAtLSA1MCBpcyBvcmlnaW5hbAogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT09SRFNfTk9fT0ZGU0VUKGpldCwgbWF0aC5yYW5kb20oMCwgMjU1NSksIG1hdGgucmFuZG9tKDAsIDI4MTUpLCBtYXRoLnJhbmRvbSgxLCAxMjMyKSwgZmFsc2UsIGZhbHNlLCBmYWxzZSkgCiAgICAgICAgICAgIHV0aWwueWllbGQoKQogICAgICAgIGVuZAogICAgZWxzZQogICAgICAgIHJlcXVlc3RfbW9kZWwodXRpbC5qb2FhdCgnaHlkcmEnKSkKICAgICAgICBsb2NhbCBzcGF3bl9pbiA9IGVudGl0aWVzLmNyZWF0ZV92ZWhpY2xlKHV0aWwuam9hYXQoJ2h5ZHJhJyksIEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKSwgMC4wKQogICAgICAgIFBFRC5TRVRfUEVEX0lOVE9fVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBzcGF3bl9pbiwgLTEpCiAgICBlbmQKZW5kCgoKLS0tLee0oui1lOi9veWFtwpmdW5jdGlvbiBiaXRUZXN0KGFkZHIsIG9mZnNldCkKICAgIHJldHVybiAobWVtb3J5LnJlYWRfaW50KGFkZHIpICYgKDEgPDwgb2Zmc2V0KSkgfj0gMAplbmQKZnVuY3Rpb24gcmVjbGFpbVZlaGljbGVzKCkKICAgIGxvY2FsIGdsb2JhbCA9IEdsb2JhbF9CYXNlLnZlaGljbGVfZ2xvYmFsCiAgICBsb2NhbCBjb3VudCA9IG1lbW9yeS5yZWFkX2ludChtZW1vcnkuc2NyaXB0X2dsb2JhbChnbG9iYWwpKSAtLXZlaGljbGVfZ2xvYmFsIC0taHR0cHM6Ly9naXRodWIuY29tL1lpbU1lbnUvWWltTWVudS9ibG9iL21hc3Rlci9zcmMvY29yZS9zY3JfZ2xvYmFscy5ocHAKICAgIGZvciBpID0gMCwgY291bnQgZG8KICAgICAgICBsb2NhbCBjYW5GaXggPSAoYml0VGVzdChtZW1vcnkuc2NyaXB0X2dsb2JhbChnbG9iYWwgKyAxICsgKGkgKiAxNDIpICsgMTAzKSwgMSkgYW5kIGJpdFRlc3QobWVtb3J5LnNjcmlwdF9nbG9iYWwoZ2xvYmFsICsgMSArIChpICogMTQyKSArIDEwMyksIDIpKQogICAgICAgIGlmIGNhbkZpeCB0aGVuCiAgICAgICAgICAgIE1JU0MuQ0xFQVJfQklUKG1lbW9yeS5zY3JpcHRfZ2xvYmFsKGdsb2JhbCArIDEgKyAoaSAqIDE0MikgKyAxMDMpLCAxKQogICAgICAgICAgICBNSVNDLkNMRUFSX0JJVChtZW1vcnkuc2NyaXB0X2dsb2JhbChnbG9iYWwgKyAxICsgKGkgKiAxNDIpICsgMTAzKSwgMykKICAgICAgICAgICAgTUlTQy5DTEVBUl9CSVQobWVtb3J5LnNjcmlwdF9nbG9iYWwoZ2xvYmFsICsgMSArIChpICogMTQyKSArIDEwMyksIDE2KQogICAgICAgICAgICBub3RpZmljYXRpb24oIn5ib2xkfn55fue0oui1lOWujOaIkCIsIEh1ZENvbG91ci5ibHVlKQogICAgICAgIGVuZAogICAgZW5kCiAgICAtLVtbIGZvciBrLCB2IGluIG1lbnUuZ2V0X2NoaWxkcmVuKG1lbnUucmVmX2J5X3BhdGgoIlZlaGljbGU+UGVyc29uYWwgVmVoaWNsZXMiKSkgZG8KICAgICAgICBmb3IgazEsIHYxIGluIHYuY29tbWFuZF9uYW1lcyBkbwogICAgICAgICAgICBpZiB2MSB+PSAiZmluZHB2IiB0aGVuCiAgICAgICAgICAgICAgICBpZiB2MSA9PSAicHYyIiB0aGVuCiAgICAgICAgICAgICAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmRzKHYxLi4icmVxdWVzdCIpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgllbmRdXQplbmQKCi0tLS3po57lpKnmiavmiooKZnVuY3Rpb24gZmx5aW5nX2Jyb29tKCkKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBmYWxzZSkKICAgIGxvY2FsIGJyb29tc3RpY2sgPSB1dGlsLmpvYWF0KCJwcm9wX3Rvb2xfYnJvb20iKQogICAgbG9jYWwgb3BwcmVzc29yID0gdXRpbC5qb2FhdCgib3BwcmVzc29yMiIpCiAgICBsb2NhbCBvYmogPSBjcmVhdGVfb2JqZWN0KGJyb29tc3RpY2ssIHBvcy54LCBwb3MueSwgcG9zLnopCiAgICBsb2NhbCB2ZWggPSBjcmVhdGVfdmVoaWNsZShvcHByZXNzb3IsIHBvcy54LCBwb3MueSwgcG9zLnosIDApCiAgICBFTlRJVFkuU0VUX0VOVElUWV9WSVNJQkxFKHZlaCwgZmFsc2UsIGZhbHNlKQogICAgUEVELlNFVF9QRURfSU5UT19WRUhJQ0xFKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIHZlaCwgLTEpCiAgICBFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkob2JqLCB2ZWgsIDAsIDAsIDAsIDAuMywgLTgwLjAsIDAsIDAsIHRydWUsIGZhbHNlLCBmYWxzZSwgZmFsc2UsIDAsIHRydWUsIDApCmVuZAotLS0t6am+6am26LaF57qn6aOe5py6CmZ1bmN0aW9uIHN1cGVyX3BoYW5lKCkKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgbG9jYWwgSGVhZGluZyA9IEVOVElUWS5HRVRfRU5USVRZX0hFQURJTkcoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgIGxvY2FsIGNhcmhhc2ggPSAxNDgzMTcxMzIzIC0t5b63572X57SiCiAgICBsb2NhbCBwaGFuZWhhc2ggPSAtMTIxNDUwNTk5NSAtLemjnuacugogICAgbG9jYWwgY2FyID0gY3JlYXRlX3ZlaGljbGUoY2FyaGFzaCwgcG9zLngsIHBvcy55LCBwb3MueiwgSGVhZGluZykKICAgIFBFRC5TRVRfUEVEX0lOVE9fVkVISUNMRShQTEFZRVIuUExBWUVSX1BFRF9JRCgpLCBjYXIsIC0xKQogICAgRU5USVRZLlNFVF9FTlRJVFlfVklTSUJMRShjYXIsIGZhbHNlKQoKICAgIGxvY2FsIHBoYW5lID0gY3JlYXRlX3ZlaGljbGUocGhhbmVoYXNoLCBwb3MueCwgcG9zLnksIHBvcy56LCBIZWFkaW5nKQogICAgRU5USVRZLkFUVEFDSF9FTlRJVFlfVE9fRU5USVRZKHBoYW5lLCBjYXIsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIHRydWUsIGZhbHNlLCBmYWxzZSxmYWxzZSwgMCwgdHJ1ZSkKZW5kCgoKLS0tLeWIhuemu+WFg+e0oApmdW5jdGlvbiBkZXRhY2hfYWxsX2VudGl0aWVzKCkKICAgIGxvY2FsIHZlaHMgPSBlbnRpdGllcy5nZXRfYWxsX3ZlaGljbGVzX2FzX2hhbmRsZXMoKQogICAgbG9jYWwgb2JqcyA9IGVudGl0aWVzLmdldF9hbGxfb2JqZWN0c19hc19oYW5kbGVzKCkKICAgIGxvY2FsIHBlZHMgPSBlbnRpdGllcy5nZXRfYWxsX3BlZHNfYXNfaGFuZGxlcygpCiAgICBmb3Igayx2IGluIHBhaXJzKHZlaHMpIGRvCiAgICAgICAgaWYgRU5USVRZLklTX0VOVElUWV9BVFRBQ0hFRCh2KSB0aGVuCiAgICAgICAgICAgIHJlcXVlc3RfY29udHJvbCh2KQogICAgICAgICAgICBFTlRJVFkuREVUQUNIX0VOVElUWSh2LCBmYWxzZSwgZmFsc2UpCiAgICAgICAgICAgIC0tRU5USVRZLlNFVF9FTlRJVFlfQ09MTElTSU9OKHYsIGZhbHNlLCB0cnVlKQogICAgICAgIGVuZAogICAgZW5kCiAgICBmb3Igayx2IGluIHBhaXJzKG9ianMpIGRvCiAgICAgICAgaWYgRU5USVRZLklTX0VOVElUWV9BVFRBQ0hFRCh2KSB0aGVuCiAgICAgICAgICAgIHJlcXVlc3RfY29udHJvbCh2KQogICAgICAgICAgICBFTlRJVFkuREVUQUNIX0VOVElUWSh2LCBmYWxzZSwgZmFsc2UpCiAgICAgICAgICAgIC0tRU5USVRZLlNFVF9FTlRJVFlfQ09MTElTSU9OKHYsIGZhbHNlLCB0cnVlKQogICAgICAgIGVuZAogICAgZW5kCiAgICBmb3Igayx2IGluIHBhaXJzKHBlZHMpIGRvCiAgICAgICAgaWYgRU5USVRZLklTX0VOVElUWV9BVFRBQ0hFRCh2KSB0aGVuCiAgICAgICAgICAgIHJlcXVlc3RfY29udHJvbCh2KQogICAgICAgICAgICBFTlRJVFkuREVUQUNIX0VOVElUWSh2LCBmYWxzZSwgZmFsc2UpCiAgICAgICAgICAgIC0tRU5USVRZLlNFVF9FTlRJVFlfQ09MTElTSU9OKHYsIGZhbHNlLCB0cnVlKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKLS0tLemYu+atoumZhOWKoOaooeWeiwpmdW5jdGlvbiBCbG9ja19hdHRhY2hlZF9tb2RlbHMoKQogICAgbG9jYWwgdmVoaWNsZSA9IFBFRC5HRVRfVkVISUNMRV9QRURfSVNfSU4oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZmFsc2UpCiAgICBsb2NhbCB2ZWhzID0gZW50aXRpZXMuZ2V0X2FsbF92ZWhpY2xlc19hc19oYW5kbGVzKCkKICAgIGxvY2FsIG9ianMgPSBlbnRpdGllcy5nZXRfYWxsX29iamVjdHNfYXNfaGFuZGxlcygpCiAgICBsb2NhbCBwZWRzID0gZW50aXRpZXMuZ2V0X2FsbF9wZWRzX2FzX2hhbmRsZXMoKQogICAgZm9yIGssdiBpbiBwYWlycyh2ZWhzKSBkbwogICAgICAgIGlmIEVOVElUWS5JU19FTlRJVFlfQVRUQUNIRURfVE9fRU5USVRZKHYsIHZlaGljbGUpIHRoZW4KICAgICAgICAgICAgcmVxdWVzdF9jb250cm9sKHYpCiAgICAgICAgICAgIEVOVElUWS5ERVRBQ0hfRU5USVRZKHYsIGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgRU5USVRZLlNFVF9FTlRJVFlfQ09MTElTSU9OKHYsIGZhbHNlLCB0cnVlKQogICAgICAgIGVuZAogICAgZW5kCiAgICBmb3Igayx2IGluIHBhaXJzKG9ianMpIGRvCiAgICAgICAgaWYgRU5USVRZLklTX0VOVElUWV9BVFRBQ0hFRF9UT19FTlRJVFkodiwgdmVoaWNsZSkgdGhlbgogICAgICAgICAgICByZXF1ZXN0X2NvbnRyb2wodikKICAgICAgICAgICAgRU5USVRZLkRFVEFDSF9FTlRJVFkodiwgZmFsc2UsIGZhbHNlKQogICAgICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9DT0xMSVNJT04odiwgZmFsc2UsIHRydWUpCiAgICAgICAgZW5kCiAgICBlbmQKICAgIGZvciBrLHYgaW4gcGFpcnMocGVkcykgZG8KICAgICAgICBpZiBFTlRJVFkuSVNfRU5USVRZX0FUVEFDSEVEX1RPX0VOVElUWSh2LCB2ZWhpY2xlKSB0aGVuCiAgICAgICAgICAgIHJlcXVlc3RfY29udHJvbCh2KQogICAgICAgICAgICBFTlRJVFkuREVUQUNIX0VOVElUWSh2LCBmYWxzZSwgZmFsc2UpCiAgICAgICAgICAgIEVOVElUWS5TRVRfRU5USVRZX0NPTExJU0lPTih2LCBmYWxzZSwgdHJ1ZSkKICAgICAgICBlbmQKICAgIGVuZAplbmQKCgotLS0t54Ot5oiQ5YOP5p6qCmxvY2FsIHRoZXJtYWxfY29tbWFuZCA9IG1lbnUucmVmX2J5X3BhdGgoJ0dhbWU+UmVuZGVyaW5nPlRoZXJtYWwgVmlzaW9uJykKZnVuY3Rpb24gdGhlcm1hbGd1bigpCiAgICBsb2NhbCBhaW1pbmcgPSBQTEFZRVIuSVNfUExBWUVSX0ZSRUVfQUlNSU5HKFBMQVlFUi5QTEFZRVJfSUQoKSkKICAgIGlmIEdSQVBISUNTLkdFVF9VU0lOR1NFRVRIUk9VR0goKSBhbmQgbm90IGFpbWluZyB0aGVuCiAgICAgICAgbWVudS50cmlnZ2VyX2NvbW1hbmQodGhlcm1hbF9jb21tYW5kLCdvZmYnKQogICAgICAgIEdSQVBISUNTMS5fU0VFVEhST1VHSF9TRVRfTUFYX1RISUNLTkVTUygxKQogICAgZWxzZWlmIFBBRC5JU19DT05UUk9MX0pVU1RfUFJFU1NFRCgzOCwzOCkgdGhlbgogICAgICAgIGlmIG1lbnUuZ2V0X3ZhbHVlKHRoZXJtYWxfY29tbWFuZCkgb3Igbm90IGFpbWluZyB0aGVuCiAgICAgICAgICAgIG1lbnUudHJpZ2dlcl9jb21tYW5kKHRoZXJtYWxfY29tbWFuZCwib2ZmIikKICAgICAgICAgICAgR1JBUEhJQ1MxLl9TRUVUSFJPVUdIX1NFVF9NQVhfVEhJQ0tORVNTKDEpCiAgICAgICAgZWxzZQogICAgICAgICAgICBtZW51LnRyaWdnZXJfY29tbWFuZCh0aGVybWFsX2NvbW1hbmQsIm9uIikKICAgICAgICAgICAgR1JBUEhJQ1MxLl9TRUVUSFJPVUdIX1NFVF9NQVhfVEhJQ0tORVNTKDUwKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKCi0t5oG254G16aqR5aOrCmZ1bmN0aW9uIGVscXNzKG9uKQogICAgaWYgb24gdGhlbgogICAgICAgIG5vdGlmaWNhdGlvbigifmJvbGR+fnl+5oyJReS9v+eUqOaImOi9puaKgOiDvSIsIEh1ZENvbG91ci5ibHVlKQogICAgICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgIGxvY2FsIHZoYXNoID0gMTQ5MTI3NzUxMQogICAgICAgIGxvY2FsIG9iaiA9IDE3OTM2Njc2MzcKICAgICAgICByZXF1ZXN0X21vZGVsKHZoYXNoKQogICAgICAgIHJlcXVlc3RfbW9kZWwob2JqKQogICAgICAgIGdob3N0X2NhciA9IGVudGl0aWVzLmNyZWF0ZV92ZWhpY2xlKDE0OTEyNzc1MTEsIHBvcywgMCkKICAgICAgICBFTlRJVFkuU0VUX0VOVElUWV9JTlZJTkNJQkxFKGdob3N0X2Nhcix0cnVlKQogICAgICAgIGdob3N0X251dHMgPSBPQkpFQ1QuQ1JFQVRFX09CSkVDVCgxNzkzNjY3NjM3LCBwb3MueCwgcG9zLnksIHBvcy56LCB0cnVlLCBmYWxzZSwgdHJ1ZSkKICAgICAgICBFTlRJVFkuQVRUQUNIX0VOVElUWV9UT19FTlRJVFkoZ2hvc3RfbnV0cywgZ2hvc3RfY2FyLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCB0cnVlLCBmYWxzZSwgZmFsc2UsIGZhbHNlLCAwLCB0cnVlLCAwKQogICAgICAgIGxvY2FsIHRpdGxsZSA9ICJzY3JfbWFydGluMSIKICAgICAgICBsb2NhbCBoYXNoaWQgPSAic2NyX3NvbDFfcGxhbmVfZW5naW5lX2ZpcmUiCiAgICAgICAgcmVxdWVzdF9wdGZ4X2Fzc2V0KHRpdGxsZSkKICAgICAgICBHUkFQSElDUy5VU0VfUEFSVElDTEVfRlhfQVNTRVQodGl0bGxlKQogICAgICAgIEdSQVBISUNTLlNUQVJUX1BBUlRJQ0xFX0ZYX0xPT1BFRF9PTl9FTlRJVFkoaGFzaGlkLCBnaG9zdF9udXRzLCAwLCAwLjEsIC0wLjMsIDE4MCwgMCwgMCwgMC41LCAxLCAxLCAxKQogICAgICAgIFNZU1RFTS5XQUlUKDUwMCkKICAgICAgICBQRUQuU0VUX1BFRF9JTlRPX1ZFSElDTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgZ2hvc3RfY2FyLCAtMSkKICAgICAgICB3aGlsZSBnaG9zdF9jYXIgZG8KICAgICAgICAgICAgaWYgUEFELklTX0NPTlRST0xfUFJFU1NFRCgwLDQ2KSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCB0aXRsbGUxID0gIndlYXBfeHNfdmVoaWNsZV93ZWFwb25zIgogICAgICAgICAgICAgICAgbG9jYWwgaGFzaGlkMSA9ICJtdXpfeHNfdHVycmV0X2ZsYW1ldGhyb3dlcl9sb29waW5nIgogICAgICAgICAgICAgICAgcmVxdWVzdF9wdGZ4X2Fzc2V0KHRpdGxsZTEpCiAgICAgICAgICAgICAgICBHUkFQSElDUy5VU0VfUEFSVElDTEVfRlhfQVNTRVQodGl0bGxlMSkKICAgICAgICAgICAgICAgIEdSQVBISUNTLlNUQVJUX1BBUlRJQ0xFX0ZYX0xPT1BFRF9PTl9FTlRJVFkoaGFzaGlkMSwgZ2hvc3RfY2FyLCAwLCAxLCAwLjUsIDE4MCwgMCwgMCwgMSwgMSwgMSwgMSkKICAgICAgICAgICAgICAgIHV0aWwueWllbGQoNTAwKQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBHUkFQSElDUy5SRU1PVkVfUEFSVElDTEVfRlhfRlJPTV9FTlRJVFkoZ2hvc3RfY2FyKQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgdXRpbC55aWVsZCgpCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgZGVsZXRlX2VudGl0eShnaG9zdF9jYXIpCiAgICAgICAgZGVsZXRlX2VudGl0eShnaG9zdF9udXRzKQogICAgZW5kCmVuZAoKLS0tLeWFieeOrwpDb2xvdXIgPSB7fQpDb2xvdXIubmV3ID0gZnVuY3Rpb24oUiwgRywgQiwgQSkKICAgIHJldHVybiB7ciA9IFIgb3IgMCwgZyA9IEcgb3IgMCwgYiA9IEIgb3IgMCwgYSA9IEEgb3IgMH0KZW5kCmZ1bmN0aW9uIHBlcnNvbmxsaWdodCgpCiAgICBsb2NhbCBsb2NhbFBlZCA9IFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkKICAgIGxvY2FsIGZlY3QgPSBFZmZlY3QubmV3KCJzY3JfeG1fZmFybSIsICJzY3JfeG1fZHN0X2VsZWNfY3JhY2tsZSIpCiAgICBsb2NhbCBlZmZlY3QgPSBFZmZlY3QubmV3KCJzY3JfaWVfdHciLCAic2NyX2ltcGV4cF90d190YWtlX3pvbmUiKQogICAgbG9jYWwgY29sb3VyID0gQ29sb3VyLm5ldyg1LCAwLCAwLCAzMCkKICAgIGxvY2FsIGNvbG91cjIgPSBDb2xvdXIubmV3KDUsIDUwLCAxMCwgMzApCiAgICByZXF1ZXN0X3B0ZnhfYXNzZXQoZWZmZWN0LmFzc2V0KQogICAgR1JBUEhJQ1MuVVNFX1BBUlRJQ0xFX0ZYX0FTU0VUKGVmZmVjdC5hc3NldCkKICAgIEdSQVBISUNTLlNFVF9QQVJUSUNMRV9GWF9OT05fTE9PUEVEX0NPTE9VUihjb2xvdXIuciwgY29sb3VyLmcsIGNvbG91ci5iKQogICAgR1JBUEhJQ1MuU1RBUlRfTkVUV09SS0VEX1BBUlRJQ0xFX0ZYX05PTl9MT09QRURfT05fRU5USVRZKAogICAgICAgIGVmZmVjdC5uYW1lLAogICAgICAgIGxvY2FsUGVkLAogICAgICAgIDAuMCwgMC4wLCAwLjc1LAogICAgICAgIDAuMCwgMC4wLCAwLjAsCiAgICAgICAgMC4wOSwKICAgICAgICBmYWxzZSwgZmFsc2UsIGZhbHNlKQogICAgR1JBUEhJQ1MuVVNFX1BBUlRJQ0xFX0ZYX0FTU0VUKGVmZmVjdC5hc3NldCkKICAgIEdSQVBISUNTLlNFVF9QQVJUSUNMRV9GWF9OT05fTE9PUEVEX0NPTE9VUihjb2xvdXIyLnIsIGNvbG91cjIuZywgY29sb3VyMi5iKQogICAgR1JBUEhJQ1MuU1RBUlRfTkVUV09SS0VEX1BBUlRJQ0xFX0ZYX05PTl9MT09QRURfT05fRU5USVRZKAogICAgICAgIGVmZmVjdC5uYW1lLAogICAgICAgIGxvY2FsUGVkLAogICAgICAgIDAuMCwgMC4wLCAtMi45LAogICAgICAgIDAuMCwgMC4wLCAwLjAsCiAgICAgICAgMS4wLAogICAgICAgIGZhbHNlLCBmYWxzZSwgZmFsc2UpCmVuZAoKCi0tLS3mi4nkvr/kvr8KZnVuY3Rpb24gcGVyc29ubHNoaXQoKQogICAgbG9jYWwgYWdyb3VwID0gIm1pc3NmYmkzaWdfMCIKICAgIGxvY2FsIGFuaW0gPSAic2hpdF9sb29wX3RyZXYiCiAgICBsb2NhbCBtc2hpdCA9IE1JU0MuR0VUX0hBU0hfS0VZKCJwcm9wX2JpZ19zaGl0XzAyIikKICAgIGxvY2FsIGMgPSBFTlRJVFkuR0VUX0VOVElUWV9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSkKICAgIHJlcXVlc3RfYW5pbV9kaWN0KGFncm91cCkKICAgIFRBU0suVEFTS19QTEFZX0FOSU0oUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgYWdyb3VwLCBhbmltLCA4LjAsIDguMCwgMzAwMCwgMCwgMCwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkgLS1wbGF5IGFuaW0KICAgIHV0aWwueWllbGQoMTAwMCkKICAgIGNyZWF0ZV9vYmplY3QobXNoaXQsIGMueCwgYy55LCBjLnogLSAxKSAtLXNwYXduIHNoaXQKZW5kCi0t5omT6aOe5py6CmZ1bmN0aW9uIHBlcnNvbmxoaXRwbGFuZSgpIAogICAgbG9jYWwgYWdyb3VwMiA9ICJzd2l0Y2hAdHJldm9yQGplcmtpbmdfb2ZmIgogICAgbG9jYWwgYW5pbTIgPSAidHJldl9qZXJraW5nX29mZl9sb29wIgogICAgbG9jYWwgY3VtID0gTUlTQy5HRVRfSEFTSF9LRVkoInBfb2lsX3NsaWNrXzAxIikKICAgIGxvY2FsIGMgPSBFTlRJVFkuR0VUX09GRlNFVF9GUk9NX0VOVElUWV9JTl9XT1JMRF9DT09SRFMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMCwgMSwgMCkKICAgIHJlcXVlc3RfYW5pbV9kaWN0KGFncm91cDIpCiAgICBUQVNLLlRBU0tfUExBWV9BTklNKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCksIGFncm91cDIsIGFuaW0yLCA4LjAsIDguMCwgNTAwMCwgMSwgMCwgdHJ1ZSwgdHJ1ZSwgdHJ1ZSkgLS1wbGF5IGFuaW0KICAgIHV0aWwueWllbGQoNDUwMCkKICAgIGNyZWF0ZV9vYmplY3QoY3VtLCBjLngsIGMueSwgYy56IC0gMSkgLS1zcGF3biBjdW0KZW5kCgoKCi0t57KY5by554iG54K4CmxvY2FsIGRldG9uYXRlX3JhZGl1cyA9IDIKZnVuY3Rpb24gYXV0b0V4cGxvZGVTdGlja3lzKHBlZCkKICAgIGxvY2FsIHBvcyA9IEVOVElUWS5HRVRfRU5USVRZX0NPT1JEUyhwZWQsIHRydWUpCiAgICBpZiBNSVNDLklTX1BST0pFQ1RJTEVfVFlQRV9XSVRISU5fRElTVEFOQ0UocG9zLngsIHBvcy55LCBwb3MueiwgdXRpbC5qb2FhdCgnd2VhcG9uX3N0aWNreWJvbWInKSwgZGV0b25hdGVfcmFkaXVzLCB0cnVlKSB0aGVuCiAgICAgICAgV0VBUE9OLkVYUExPREVfUFJPSkVDVElMRVMoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgdXRpbC5qb2FhdCgnd2VhcG9uX3N0aWNreWJvbWInKSkKICAgIGVuZAplbmQKZnVuY3Rpb24gcHJveHlTdGlja3lzKCkKICAgIGlmIGRldG9uYXRlX3BsYXllcnMgdGhlbgogICAgICAgIGxvY2FsIHNwZWNpZmljV2hpdGVsaXN0R3JvdXAgPSB7dXNlciA9IGZhbHNlLCAgZnJpZW5kcyA9IHdoaXRlbGlzdEdyb3Vwcy5mcmllbmRzLCBzdHJhbmdlcnMgPSB3aGl0ZWxpc3RHcm91cHMuc3RyYW5nZXJzfQogICAgICAgIGZvciBfLCBwaWQgaW4gcGFpcnMocGxheWVycy5saXN0KHRydWUsIHRydWUsIHRydWUpKSBkbwogICAgICAgICAgICBsb2NhbCBwZWQgPSBQTEFZRVIuR0VUX1BMQVlFUl9QRUQocGlkKQogICAgICAgICAgICBhdXRvRXhwbG9kZVN0aWNreXMocGVkKQogICAgICAgIGVuZAogICAgZW5kCiAgICBpZiBkZXRvbmF0ZV9ucGNzIHRoZW4KICAgICAgICBsb2NhbCBwZWRIYW5kbGVzID0gZW50aXRpZXMuZ2V0X2FsbF9wZWRzX2FzX2hhbmRsZXMoKQogICAgICAgIGZvciBfLCBwZWQgaW4gcGFpcnMocGVkSGFuZGxlcykgZG8KICAgICAgICAgICAgaWYgbm90IFBFRC5JU19QRURfQV9QTEFZRVIocGVkKSB0aGVuCiAgICAgICAgICAgICAgICBhdXRvRXhwbG9kZVN0aWNreXMocGVkKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQKCgoKLS3nu5jliLbml7bpgJ8KZnVuY3Rpb24gc3BlZWRpbmZvKCkKICAgIGxvY2FsIGVudCA9IFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkKICAgIGlmIFBFRC5JU19QRURfSU5fQU5ZX1ZFSElDTEUoUExBWUVSLlBMQVlFUl9QRURfSUQoKSx0cnVlKSB0aGVuCiAgICAgICAgZW50ID0gUEVELkdFVF9WRUhJQ0xFX1BFRF9JU19VU0lORyhQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgZW5kCiAgICBsb2NhbCBzcGVlZCA9IG1hdGguY2VpbChFTlRJVFkuR0VUX0VOVElUWV9TUEVFRChlbnQpICogMy42KQogICAgZHJhd19zdHJpbmcoc3RyaW5nLmZvcm1hdCgifmJvbGR+fml0YWxpY35+b34iLi5zcGVlZCAuLiAiICB+d35LTS9IIiksIDAuNzYsMC44LCAxLDYpCmVuZAoKLS3mkZTlgJIKbG9jYWwgZmFsbFRpbWVvdXQgPSBmYWxzZQpmdW5jdGlvbiB0cmlwcGVkMSh0b2dnbGUpCiAgICBpZiB0b2dnbGUgdGhlbgogICAgICAgIGxvY2FsIHZlY3RvciA9IEVOVElUWS5HRVRfRU5USVRZX0ZPUldBUkRfVkVDVE9SKFBMQVlFUi5QTEFZRVJfUEVEX0lEKCkpCiAgICAgICAgUEVELlNFVF9QRURfVE9fUkFHRE9MTF9XSVRIX0ZBTEwoUExBWUVSLlBMQVlFUl9QRURfSUQoKSwgMTUwMCwgMjAwMCwgMiwgdmVjdG9yLngsIC12ZWN0b3IueSwgdmVjdG9yLnosIDEsIDAsIDAsIDAsIDAsIDAsIDApCiAgICBlbmQKICAgIGZhbGxUaW1lb3V0ID0gdG9nZ2xlCiAgICB3aGlsZSBmYWxsVGltZW91dCBkbwogICAgICAgIFBFRC5SRVNFVF9QRURfUkFHRE9MTF9USU1FUihQTEFZRVIuUExBWUVSX1BFRF9JRCgpKQogICAgICAgIHV0aWwueWllbGRfb25jZSgpCiAgICBlbmQKZW5k